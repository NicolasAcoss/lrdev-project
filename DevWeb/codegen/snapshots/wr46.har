{
    "log": {
        "version": "1.2",
        "creator": {
            "name": "DevWeb",
            "version": "1.2"
        },
        "pages": [
            {
                "startedDateTime": "2022-12-06T11:38:16.877908Z",
                "id": "page_1",
                "title": "https://mail.etu.univ-lorraine.fr/zimbra/js/Startup2_all.js.zgz",
                "pageTimings": {}
            }
        ],
        "entries": [
            {
                "pageref": "page_1",
                "startedDateTime": "2022-12-06T11:38:16.877908Z",
                "time": 0,
                "_isResource": false,
                "request": {
                    "method": "GET",
                    "url": "https://mail.etu.univ-lorraine.fr/zimbra/js/Startup2_all.js.zgz?v=220726112844",
                    "httpVersion": "HTTP/2.0",
                    "cookies": [
                        {
                            "name": "UL-AUTHTRACE",
                            "value": "TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA",
                            "httpOnly": false
                        },
                        {
                            "name": "JSESSIONID",
                            "value": "node01ewv5q86m64i21vkfxtflutla86873.node0",
                            "httpOnly": false
                        },
                        {
                            "name": "ZM_AUTH_TOKEN",
                            "value": "0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b",
                            "httpOnly": false
                        }
                    ],
                    "headers": [
                        {
                            "name": "accept",
                            "value": "*/*"
                        },
                        {
                            "name": "accept-encoding",
                            "value": "gzip, deflate, br"
                        },
                        {
                            "name": "accept-language",
                            "value": "fr,fr-FR;q=0.8,en-US;q=0.5,en;q=0.3"
                        },
                        {
                            "name": "cookie",
                            "value": "UL-AUTHTRACE=TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA; JSESSIONID=node01ewv5q86m64i21vkfxtflutla86873.node0; ZM_AUTH_TOKEN=0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b"
                        },
                        {
                            "name": "dnt",
                            "value": "1"
                        },
                        {
                            "name": "referer",
                            "value": "https://mail.etu.univ-lorraine.fr/"
                        },
                        {
                            "name": "sec-fetch-dest",
                            "value": "empty"
                        },
                        {
                            "name": "sec-fetch-mode",
                            "value": "cors"
                        },
                        {
                            "name": "sec-fetch-site",
                            "value": "same-origin"
                        },
                        {
                            "name": "te",
                            "value": "trailers"
                        },
                        {
                            "name": "user-agent",
                            "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101 Firefox/102.0"
                        }
                    ],
                    "queryString": [
                        {
                            "name": "v",
                            "value": "220726112844"
                        }
                    ],
                    "headersSize": -1,
                    "bodySize": -1
                },
                "response": {
                    "status": 200,
                    "statusText": "OK",
                    "httpVersion": "HTTP/2.0",
                    "cookies": null,
                    "headers": [
                        {
                            "name": "accept-ranges",
                            "value": "bytes"
                        },
                        {
                            "name": "cache-control",
                            "value": "public, max-age=2595600"
                        },
                        {
                            "name": "content-type",
                            "value": "text/javascript"
                        },
                        {
                            "name": "date",
                            "value": "Tue, 06 Dec 2022 10:38:17 GMT"
                        },
                        {
                            "name": "expires",
                            "value": "Thu, 5 Jan 2023 11:38:17 GMT"
                        },
                        {
                            "name": "last-modified",
                            "value": "Tue, 26 Jul 2022 15:30:10 GMT"
                        },
                        {
                            "name": "server",
                            "value": "nginx"
                        },
                        {
                            "name": "x-frame-options",
                            "value": "SAMEORIGIN"
                        },
                        {
                            "name": "x-recouv-allowed",
                            "value": "Recouv"
                        }
                    ],
                    "content": {
                        "size": 483713,
                        "mimeType": "",
                        "text": "\n/* \n* Zimbra Collaboration Suite Web Client\n* Copyright (C) 2004-2017 Synacor, Inc.\n* https://www.zimbra.com/license\n*/\nif(AjxPackage.define(\"Startup2\")){if(AjxPackage.define(\"ajax.util.AjxSelectionManager\")){AjxSelectionManager=function(a){this._owner=a\n};\nAjxSelectionManager.SELECT_ONE_CLEAR_OTHERS=0;\nAjxSelectionManager.TOGGLE_ONE_LEAVE_OTHERS=1;\nAjxSelectionManager.SELECT_TO_ANCHOR=2;\nAjxSelectionManager.DESELECT_ALL=3;\nAjxSelectionManager.SELECT_ALL=4;\nAjxSelectionManager.prototype.getItems=function(){if(this._selectedItems==null){this._selectedItems=this._createItemsCollection()\n}return this._selectedItems\n};\nAjxSelectionManager.prototype.getLength=function(){return this.getItems().length\n};\nAjxSelectionManager.prototype.getAnchor=function(){if(this._anchor==null){var a=this.getItems();\nif(a.length>0){this._anchor=a[0]\n}}return this._anchor\n};\nAjxSelectionManager.prototype.getCursor=function(){if(this._cursor==null){this._cursor=this.getAnchor()\n}return this._cursor\n};\nAjxSelectionManager.prototype.isSelected=function(a){return this.getItems().binarySearch(a)!=-1\n};\nAjxSelectionManager.prototype.selectOneItem=function(a){this.select(a,AjxSelectionManager.SELECT_ONE_CLEAR_OTHERS)\n};\nAjxSelectionManager.prototype.toggleItem=function(a){this.select(a,AjxSelectionManager.TOGGLE_ONE_LEAVE_OTHERS)\n};\nAjxSelectionManager.prototype.selectFromAnchorToItem=function(a){this.select(a,AjxSelectionManager.SELECT_TO_ANCHOR)\n};\nAjxSelectionManager.prototype.deselectAll=function(){this.select(null,AjxSelectionManager.DESELECT_ALL)\n};\nAjxSelectionManager.prototype.selectAll=function(){this.select(null,AjxSelectionManager.SELECT_ALL)\n};\nAjxSelectionManager.prototype.select=function(o,f){this._setAnchorAndCursor(o,f);\nvar n=this._selectedItems;\nvar e=(n==null)?0:n.length;\nthis._selectedItems=null;\nthis._selectedItems=this._createItemsCollection();\nvar a=this._owner.getItemCount();\nvar m=false;\nvar d=false;\nvar k=false;\nfor(var h=0;\nh<a;\n++h){var j=this._owner.getItem(h);\nvar l=this._isItemOldSelection(j,n);\nvar b=l;\nswitch(f){case AjxSelectionManager.SELECT_TO_ANCHOR:if(this._anchor==null){this._anchor=j\n}var c=(j==this._anchor||j==o);\nvar g=false;\nif(!k&&c){k=true;\ng=true\n}b=k;\nif((!g||this._anchor==o)&&k&&c){k=false\n}break;\ncase AjxSelectionManager.SELECT_ONE_CLEAR_OTHERS:b=(j==o);\nbreak;\ncase AjxSelectionManager.TOGGLE_ONE_LEAVE_OTHERS:if(j==o){b=!l\n}break;\ncase AjxSelectionManager.DESELECT_ALL:b=false;\nbreak;\ncase AjxSelectionManager.SELECT_ALL:b=true;\nbreak\n}if(b){this._selectedItems.add(j);\nm=(this._selectedItems.length>1)\n}if(b!=l){if(this._owner.itemSelectionChanged!=null){this._owner.itemSelectionChanged(j,h,b)\n}d=true\n}}d=d||(e!=this._selectedItems.length);\nif(m){this._selectedItems.sort()\n}if(d&&this._owner.selectionChanged!=null){this._owner.selectionChanged(o)\n}};\nAjxSelectionManager.prototype.removeItem=function(b){if(this._selectedItems){var a=this._selectedItems.binarySearch(b);\nif(a>-1){this._selectedItems.removeAt(a)\n}}};\nAjxSelectionManager.prototype._createItemsCollection=function(){return new AjxVector()\n};\nAjxSelectionManager.prototype._isItemOldSelection=function(b,d){var a=false;\nif(d){var c=d.binarySearch(b);\nif(c>-1){d.removeAt(c)\n}a=(c!=-1)\n}return a\n};\nAjxSelectionManager.prototype._setAnchorAndCursor=function(a,b){switch(b){case AjxSelectionManager.SELECT_TO_ANCHOR:this._cursor=a;\nbreak;\ncase AjxSelectionManager.SELECT_ONE_CLEAR_OTHERS:this._anchor=a;\nthis._cursor=a;\nbreak;\ncase AjxSelectionManager.TOGGLE_ONE_LEAVE_OTHERS:this._anchor=a;\nthis._cursor=a;\nbreak;\ncase AjxSelectionManager.DESELECT_ALL:this._anchor=null;\nthis._cursor=null;\nbreak;\ncase AjxSelectionManager.SELECT_ALL:return\n}}\n}if(AjxPackage.define(\"ajax.net.AjxPost\")){AjxPost=function(a){this._callback=null;\nthis._iframeId=a\n};\nAjxPost._reqIds=0;\nAjxPost._outStandingRequests=new Object();\nAjxPost.SC_CONTINUE=100;\nAjxPost.SC_OK=200;\nAjxPost.SC_ACCEPTED=202;\nAjxPost.SC_NO_CONTENT=204;\nAjxPost.SC_BAD_REQUEST=400;\nAjxPost.SC_UNAUTHORIZED=401;\nAjxPost.SC_REQUEST_TIMEOUT=408;\nAjxPost.SC_CONFLICT=409;\nAjxPost.SC_REQUEST_ENTITY_TOO_LARGE=413;\nAjxPost.SC_INTERNAL_SERVER_ERROR=500;\nAjxPost.SC_BAD_GATEWAY=502;\nAjxPost.SC_SERVICE_UNAVAILABLE=503;\nAjxPost.prototype.execute=function(j,a,h){var k=a.getElementsByTagName(\"input\");\nvar d=new Array();\nfor(var c=0;\nc<k.length;\nc++){var l=k[c];\nif(l.type==\"file\"){d.push(l);\ncontinue\n}if(l.name&&l.name.match(/^filename\\d+$/)){l.parentNode.removeChild(l);\nc--;\ncontinue\n}}if(window.csrfToken){this._addHiddenField(d[0],\"csrfToken\",window.csrfToken)\n}this._addHiddenFileNames(d);\na.target=this._iframeId;\nthis._callback=j;\nvar g=new AjxPostRequest(a);\nvar b=new AjxTimedAction(this,this._onFailure,[g.id]);\nvar f=h?h:5000;\nAjxPost._outStandingRequests[g.id]=g;\ntry{g.send(b,f)\n}catch(e){if(AjxEnv.isIE){if(e.number==-2147024891){throw new AjxException(ZmMsg.uploadErrorAccessDenied,e.number)\n}}throw e\n}};\nAjxPost.prototype._addHiddenFileNames=function(b){var a=0;\nfor(var d=0;\nd<b.length;\nd++){var g=b[d];\nif(g.files&&g.files.length>1){var e=g.files,k=[];\nfor(var c=0;\nc<e.length;\nc++){var h=e[c];\nk.push(h.name||h.fileName)\n}this._addHiddenFileName(b[d],k.join(\"\\n\"),++a)\n}else{this._addHiddenFileName(b[d],b[d].value,++a)\n}}};\nAjxPost.prototype._addHiddenFileName=function(a,c,b){this._addHiddenField(a,\"filename\"+(b),c)\n};\nAjxPost.prototype._addHiddenField=function(d,c,b){var a=document.createElement(\"input\");\na.type=\"hidden\";\na.name=c;\na.value=b;\nd.parentNode.insertBefore(a,d)\n};\nAjxPost.prototype._onFailure=function(b){var a=AjxPost._outStandingRequests[b];\na.cancel();\ndelete AjxPost._outStandingRequests[b];\nif(this._callback){this._callback.run([404]);\nthis._callback=null\n}};\nAjxPost.prototype.loaded=function(a,c,d){var b=AjxPost._outStandingRequests[c];\nif(b&&!b.hasBeenCancelled()){b.cancelTimeout()\n}delete AjxPost._outStandingRequests[c];\nif(this._callback){this._callback.run(a,d);\nthis._callback=null\n}};\nAjxPostRequest=function(b){this.id=AjxPost._reqIds++;\nthis._cancelled=false;\nthis._form=b;\nvar a=b.elements.namedItem(\"requestId\");\nif(!a){a=b.ownerDocument.createElement(\"input\");\na.type=\"hidden\";\na.name=\"requestId\"\n}a.value=this.id;\nb.appendChild(a)\n};\nAjxPostRequest.prototype.send=function(b,a){this._form.submit()\n};\nAjxPostRequest.prototype.hasBeenCancelled=function(){return this._cancelled\n};\nAjxPostRequest.prototype.cancelTimeout=function(){AjxTimedAction.cancelAction(this._timeoutId)\n};\nAjxPostRequest.prototype.cancel=function(){this._cancelled=true\n}\n}if(AjxPackage.define(\"ajax.util.AjxBuffer\")){AjxBuffer=function(){this.clear();\nif(arguments.length>0){arguments.join=this.buffer.join;\nthis.buffer[this.buffer.length]=arguments.join(\"\")\n}};\nAjxBuffer.prototype.toString=function(){return this.buffer.join(\"\")\n};\nAjxBuffer.prototype.join=function(a){if(a==null){a=\"\"\n}return this.buffer.join(a)\n};\nAjxBuffer.prototype.append=function(){arguments.join=this.buffer.join;\nthis.buffer[this.buffer.length]=arguments.join(\"\")\n};\nAjxBuffer.prototype.join=function(a){return this.buffer.join(a)\n};\nAjxBuffer.prototype.set=function(a){this.buffer=[a]\n};\nAjxBuffer.prototype.clear=function(){this.buffer=[]\n};\nAjxBuffer.concat=function(){arguments.join=Array.prototype.join;\nreturn arguments.join(\"\")\n};\nAjxBuffer.append=AjxBuffer.concat\n}if(AjxPackage.define(\"ajax.xslt.AjxXslt\")){AjxXslt=function(){var d=AjxXmlDoc.create();\nif(AjxEnv.isIE){var e=null;\nvar a=[\"MSXML2.FreeThreadedDOMDocument.5.0\",\"MSXML2.FreeThreadedDOMDocument.3.0\"];\nfor(var c=0;\nc<a.length;\nc++){try{e=new ActiveXObject(a[c]);\nbreak\n}catch(b){}}if(!e){throw new AjxException(\"FreeThreadedDOMDocument\",AjxException.UNSUPPORTED,\"AjxXslt\")\n}e.async=false;\nd._doc=e\n}this._doc=d\n};\nAjxXslt.prototype.toString=function(){return\"AjxXslt\"\n};\nAjxXslt.createFromUrl=function(a){var b=new AjxXslt();\nb.loadUrl(a);\nreturn b\n};\nAjxXslt.createFromString=function(b){var a=new AjxXslt();\na._doc.loadFromString(b);\na.createProcessor();\nreturn a\n};\nAjxXslt.prototype.createProcessor=function(){var f=this._doc.getDoc();\nif(AjxEnv.isIE){var e=f.parseError;\nif(e.errorCode!=0){throw new AjxException(e.reason,AjxException.INVALID_PARAM,\"AjxXslt.createProcessor\")\n}var a=null;\nvar b=[\"MSXML2.XSLTemplate.5.0\",\"MSXML2.XSLTemplate.3.0\"];\nfor(var d=0;\nd<b.length;\nd++){try{a=new ActiveXObject(b[d]);\nbreak\n}catch(c){}}if(!a){throw new AjxException(\"XSLTemplate\",AjxException.UNSUPPORTED,\"AjxXslt.createProcessor\")\n}this._processor=a;\nif(this._processor){this._processor.stylesheet=f\n}}else{this._processor=new XSLTProcessor();\nif(this._processor){this._processor.importStylesheet(f)\n}}};\nAjxXslt._finishedLoading=function(){var a=this._xslt;\na.createProcessor()\n};\nAjxXslt.prototype.loadUrl=function(a){var c=this._doc;\nif(AjxEnv.isNav){var b=c.getDoc();\nb._xslt=this;\nb.addEventListener(\"load\",AjxXslt._finishedLoading,false)\n}c.loadFromUrl(a);\nif(AjxEnv.isIE||AjxEnv.isChrome||AjxEnv.isSafari){this.createProcessor()\n}};\nAjxXslt.prototype.transformToDom=function(c){var a;\nif(AjxEnv.isIE){a=this.transformIE(c)\n}else{return this.transformNav(c)\n}var b=AjxXmlDoc.createFromXml(a);\nreturn b.getDoc()\n};\nAjxXslt.prototype.transformToString=function(c){var a;\nif(AjxEnv.isIE){return this.transformIE(c)\n}else{if(AjxEnv.isNav||AjxEnv.isChrome||AjxEnv.isSafari){a=this.transformNav(c)\n}else{return c.documentElement.innerHTML\n}}if(!a||!a.documentElement){throw new AjxException(\"XSL transformation failed.\",AjxException.INVALID_PARAM,\"AjxXslt.transformToString\")\n}var b=a.documentElement;\nif((b instanceof HTMLElement)||(b instanceof HTMLHtmlElement)){return b.innerHTML\n}else{if(b instanceof Element){return AjxXmlDoc.replaceInvalidChars(b.xml)\n}}return c.documentElement.innerHTML\n};\nAjxXslt.prototype.transformIE=function(b){try{var c=this._processor.createProcessor();\nc.input=b;\nc.transform();\nreturn c.output\n}catch(a){throw new AjxException(a.description,AjxException.INVALID_PARAM,\"AjxXslt.transformIE\")\n}};\nAjxXslt.prototype.transformNav=function(a){if(!this._processor){return\"\"\n}return this._processor.transformToDocument(a)\n};\nAjxXslt.prototype.transformNav2=function(a){this._fragment=document.implementation.createDocument(\"\",\"\",null);\nif(!this._processor){return\"\"\n}return this._processor.transformToFragment(a,this._fragment)\n}\n}if(AjxPackage.define(\"ajax.util.AjxSHA1\")){var AjxSHA1=function(){var p=0;\nvar u=\"\";\nvar c=8;\nfunction k(v){return j(e(t(v),v.length*c))\n}function h(v){return n(e(t(v),v.length*c))\n}function d(v){return r(e(t(v),v.length*c))\n}function b(v,w){return j(f(v,w))\n}function g(v,w){return n(f(v,w))\n}function m(v,w){return r(f(v,w))\n}function a(){return k(\"abc\")==\"a9993e364706816aba3e25717850c26c9cd0d89d\"\n}function e(K,E){K[E>>5]|=128<<(24-E%32);\nK[((E+64>>9)<<4)+15]=E;\nvar L=Array(80);\nvar J=1732584193;\nvar I=-271733879;\nvar H=-1732584194;\nvar G=271733878;\nvar F=-1009589776;\nfor(var B=0;\nB<K.length;\nB+=16){var D=J;\nvar C=I;\nvar A=H;\nvar z=G;\nvar v=F;\nfor(var y=0;\ny<80;\ny++){if(y<16){L[y]=K[B+y]\n}else{L[y]=o(L[y-3]^L[y-8]^L[y-14]^L[y-16],1)\n}var M=q(q(o(J,5),s(y,I,H,G)),q(q(F,L[y]),l(y)));\nF=G;\nG=H;\nH=o(I,30);\nI=J;\nJ=M\n}J=q(J,D);\nI=q(I,C);\nH=q(H,A);\nG=q(G,z);\nF=q(F,v)\n}return Array(J,I,H,G,F)\n}function s(w,v,y,x){if(w<20){return(v&y)|((~v)&x)\n}if(w<40){return v^y^x\n}if(w<60){return(v&y)|(v&x)|(y&x)\n}return v^y^x\n}function l(v){return(v<20)?1518500249:(v<40)?1859775393:(v<60)?-1894007588:-899497514\n}function f(x,A){var z=t(x);\nif(z.length>16){z=e(z,x.length*c)\n}var v=Array(16),y=Array(16);\nfor(var w=0;\nw<16;\nw++){v[w]=z[w]^909522486;\ny[w]=z[w]^1549556828\n}var B=e(v.concat(t(A)),512+A.length*c);\nreturn e(y.concat(B),512+160)\n}function q(v,A){var z=(v&65535)+(A&65535);\nvar w=(v>>16)+(A>>16)+(z>>16);\nreturn(w<<16)|(z&65535)\n}function o(v,w){return(v<<w)|(v>>>(32-w))\n}function t(y){var x=Array();\nvar v=(1<<c)-1;\nfor(var w=0;\nw<y.length*c;\nw+=c){x[w>>5]|=(y.charCodeAt(w/c)&v)<<(32-c-w%32)\n}return x\n}function r(x){var y=\"\";\nvar v=(1<<c)-1;\nfor(var w=0;\nw<x.length*32;\nw+=c){y+=String.fromCharCode((x[w>>5]>>>(32-c-w%32))&v)\n}return y\n}function j(x){var w=p?\"0123456789ABCDEF\":\"0123456789abcdef\";\nvar y=\"\";\nfor(var v=0;\nv<x.length*4;\nv++){y+=w.charAt((x[v>>2]>>((3-v%4)*8+4))&15)+w.charAt((x[v>>2]>>((3-v%4)*8))&15)\n}return y\n}function n(y){var x=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\nvar A=\"\";\nfor(var w=0;\nw<y.length*4;\nw+=3){var z=(((y[w>>2]>>8*(3-w%4))&255)<<16)|(((y[w+1>>2]>>8*(3-(w+1)%4))&255)<<8)|((y[w+2>>2]>>8*(3-(w+2)%4))&255);\nfor(var v=0;\nv<4;\nv++){if(w*8+v*6>y.length*32){A+=u\n}else{A+=x.charAt((z>>6*(3-v))&63)\n}}}return A\n}this.hex_sha1=k;\nthis.b64_sha1=h;\nthis.str_sha1=d;\nthis.hex_hmac_sha1=b;\nthis.b64_hmac_sha1=g;\nthis.str_hmac_sha1=m;\nthis.sha1_vm_test=a\n};\nAjxSHA1=new AjxSHA1()\n}if(AjxPackage.define(\"ajax.util.AjxPluginDetector\")){AjxPluginDetector=function(){};\nAjxPluginDetector.canDetectPlugins=function(){return AjxEnv.isIE||(navigator.plugins&&navigator.plugins.length>0)\n};\nAjxPluginDetector.detectFlash=function(){if(AjxEnv.isIE){return AjxPluginDetector.detectActiveXControl(\"ShockwaveFlash.ShockwaveFlash.1\")\n}else{return AjxPluginDetector.detectPlugin(\"Shockwave\",\"Flash\")\n}};\nAjxPluginDetector.detectPDFReader=function(){if(AjxEnv.isIE){return(AjxPluginDetector.detectActiveXControl(\"PDF.PdfCtrl.5\")||AjxPluginDetector.detectActiveXControl(\"AcroExch.Document\"))\n}else{var a=false;\nif(AjxEnv.isChrome){a=AjxPluginDetector.detectPlugin(\"Chrome PDF Viewer\")\n}else{if(AjxEnv.isFirefox){a=AjxPluginDetector.detectPlugin(\"Firefox PDF Plugin for Mac OS X\")\n}}if(!a){a=AjxPluginDetector.detectPlugin(\"Adobe Acrobat\")\n}return a\n}};\nAjxPluginDetector.detectDirector=function(){if(AjxEnv.isIE){return AjxPluginDetector.detectActiveXControl(\"SWCtl.SWCtl.1\")\n}else{return AjxPluginDetector.detectPlugin(\"Shockwave\",\"Director\")\n}};\nAjxPluginDetector.detectQuickTime=function(){if(AjxEnv.isIE){return AjxPluginDetector.detectQuickTimeActiveXControl()\n}else{return AjxPluginDetector.detectPlugin(\"QuickTime\")\n}};\nAjxPluginDetector.getQuickTimeVersion=function(){if(AjxEnv.isIE){var d=new ActiveXObject(\"QuickTimeCheckObject.QuickTimeCheck.1\");\nif(d.IsQuickTimeAvailable(0)){try{var b=Number(d.QuickTimeVersion).toString(16);\nvar a=[];\nfor(var f=0;\nf<3;\nf++){a[f]=Number(b.charAt(f))\n}return a\n}catch(g){}}return null\n}else{var c=AjxPluginDetector.matchPluginName(/QuickTime Plug-in (\\d+)\\.?(\\d+)?\\.?(\\d+)?/);\nif(c){var a=[];\nfor(var f=0;\nf<3;\nf++){a[f]=Number(c[f+1]||0)\n}return a\n}else{return null\n}}};\nAjxPluginDetector.getFlashVersion=function(){var a=\"0,0,0\";\ntry{try{var b=new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash.6\");\ntry{b.AllowScriptAccess=\"always\"\n}catch(c){return\"6,0,0\"\n}}catch(c){}a=new ActiveXObject(\"ShockwaveFlash.ShockwaveFlash\").GetVariable(\"$version\").replace(/\\D+/g,\",\").match(/^,?(.+),?$/)[1]\n}catch(c){try{if(navigator.mimeTypes[\"application/x-shockwave-flash\"].enabledPlugin){a=(navigator.plugins[\"Shockwave Flash 2.0\"]||navigator.plugins[\"Shockwave Flash\"]).description.replace(/\\D+/g,\",\").match(/^,?(.+),?$/)[1]\n}}catch(c){}}return a\n};\nAjxPluginDetector.detectReal=function(){if(AjxEnv.isIE){return AjxPluginDetector.detectActiveXControl(\"rmocx.RealPlayer G2 Control\")||AjxPluginDetector.detectActiveXControl(\"RealPlayer.RealPlayer(tm) ActiveX Control (32-bit)\")||AjxPluginDetector.detectActiveXControl(\"RealVideo.RealVideo(tm) ActiveX Control (32-bit)\")\n}else{return AjxPluginDetector.detectPlugin(\"RealPlayer\")\n}};\nAjxPluginDetector.detectWindowsMedia=function(){if(AjxEnv.isIE){return AjxPluginDetector.detectActiveXControl(\"MediaPlayer.MediaPlayer.1\")\n}else{return AjxPluginDetector.detectPlugin(\"Windows Media\")\n}};\nAjxPluginDetector.detectPlugin=function(){var e=AjxPluginDetector.detectPlugin.arguments;\nvar d=navigator.plugins;\nvar b=d.length;\nfor(var c=0;\nc<b;\nc++){var f=0;\nfor(var a=0;\na<e.length;\na++){if(d[c]){if((d[c].name.indexOf(e[a])>=0)){f++\n}else{if(d[c].description.indexOf(e[a])>=0){f++\n}}}}if(f==e.length){return true\n}else{if(f){}}}return false\n};\nAjxPluginDetector.matchPluginName=function(b){var e=navigator.plugins;\nvar c=e.length;\nfor(var d=0;\nd<c;\nd++){var a=e[d].name.match(b);\nif(a){return a\n}}return null\n};\nAjxPluginDetector.detectActiveXControl=function(a){try{new ActiveXObject(a);\nreturn true\n}catch(b){return false\n}};\nAjxPluginDetector.detectQuickTimeActiveXControl=function(b){try{var a=new ActiveXObject(\"QuickTimeCheckObject.QuickTimeCheck.1\");\nreturn a.IsQuickTimeAvailable(0)\n}catch(c){return false\n}};\nAjxPluginDetector._argumentsToString=function(a){var d=[];\nfor(var b=0,c=a.length;\nb<c;\nb++){d[b]=a[b]\n}return d.join(\",\")\n}\n}if(AjxPackage.define(\"ajax.util.AjxClipboard\")){AjxClipboard=function(){AjxDispatcher.require(\"Clipboard\")\n};\nAjxClipboard.isSupported=function(){return !AjxEnv.isIE8&&!(AjxEnv.isSafari&&!AjxEnv.isChrome)\n};\nAjxClipboard.prototype.init=function(b,a){if(a.onComplete){this._completionListener=a.onComplete.bind(null,this)\n}if(b&&a.onMouseDown){b.addSelectionListener(a.onMouseDown.bind(null,this))\n}};\nAjxClipboard.prototype.setText=function(a){if(window.clipboard){clipboard.copy(a).then(this._completionListener,this._onError)\n}};\nAjxClipboard.prototype._onError=function(a){appCtxt.setStatusMsg(a&&a.message,ZmStatusView.LEVEL_WARNING)\n}\n}if(AjxPackage.define(\"ajax.dwt.events.DwtDateRangeEvent\")){DwtDateRangeEvent=function(a){if(arguments.length==0){return\n}DwtEvent.call(this,true);\nthis.reset()\n};\nDwtDateRangeEvent.prototype=new DwtEvent;\nDwtDateRangeEvent.prototype.constructor=DwtDateRangeEvent;\nDwtDateRangeEvent.prototype.toString=function(){return\"DwtDateRangeEvent\"\n};\nDwtDateRangeEvent.prototype.reset=function(){this.start=null;\nthis.end=null\n}\n}if(AjxPackage.define(\"ajax.dwt.events.DwtIdleTimer\")){DwtIdleTimer=function(b,a){DwtIdleTimer._initEvents();\nthis.timeout=b;\nthis.handler=a;\nthis.idle=false;\nthis._onIdle=AjxCallback.simpleClosure(this.setIdle,this);\nthis._startTimer();\nDwtIdleTimer.getHandlers().add(this)\n};\nDwtIdleTimer.idleHandlers=0;\nDwtIdleTimer.prototype.toString=function(){return\"DwtIdleTimer\"\n};\nDwtIdleTimer.prototype.kill=function(){this._stopTimer();\nthis.idle=false;\nDwtIdleTimer.getHandlers().remove(this)\n};\nDwtIdleTimer.prototype.resurrect=function(a){this.idle=false;\nDwtIdleTimer.getHandlers().add(this,null,true);\nif(a!=null){this.timeout=a\n}this._startTimer()\n};\nDwtIdleTimer.prototype.setIdle=function(){if(!this.idle){DwtIdleTimer.idleHandlers++;\nthis.idle=true;\nthis.handler.run(true)\n}};\nDwtIdleTimer.prototype.resume=function(){if(this.idle){this.idle=false;\nthis.handler.run(false);\nDwtIdleTimer.idleHandlers--\n}};\nDwtIdleTimer.prototype._startTimer=function(){this._stopTimer();\nthis._timer=setTimeout(this._onIdle,this.timeout)\n};\nDwtIdleTimer.prototype._stopTimer=function(){if(this._timer){clearTimeout(this._timer);\nthis._timer=null\n}};\nDwtIdleTimer._initEvents=function(){if(!DwtIdleTimer._initialized){if(window.addEventListener){window.addEventListener(\"keydown\",DwtIdleTimer.resetIdle,true);\nwindow.addEventListener(\"mousemove\",DwtIdleTimer.resetIdle,true);\nwindow.addEventListener(\"mousedown\",DwtIdleTimer.resetIdle,true);\nwindow.addEventListener(\"focus\",DwtIdleTimer.resetIdle,true)\n}else{if(window.attachEvent){document.body.attachEvent(\"onkeydown\",DwtIdleTimer.resetIdle);\ndocument.body.attachEvent(\"onkeyup\",DwtIdleTimer.resetIdle);\ndocument.body.attachEvent(\"onmousedown\",DwtIdleTimer.resetIdle);\ndocument.body.attachEvent(\"onmousemove\",DwtIdleTimer.resetIdle);\ndocument.body.attachEvent(\"onmouseover\",DwtIdleTimer.resetIdle);\ndocument.body.attachEvent(\"onmouseout\",DwtIdleTimer.resetIdle);\nwindow.attachEvent(\"onfocus\",DwtIdleTimer.resetIdle)\n}}DwtIdleTimer._initialized=true\n}};\nDwtIdleTimer.getHandlers=function(){var b=DwtIdleTimer.HANDLERS;\nif(!b){b=DwtIdleTimer.HANDLERS=new AjxVector()\n}return b\n};\nDwtIdleTimer.resetIdle=function(){var b=DwtIdleTimer.getHandlers();\nb.foreach(\"_startTimer\");\nif(DwtIdleTimer.idleHandlers>0){b.foreach(\"resume\")\n}}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtColorPicker\")){DwtColorPicker=function(a){if(arguments.length==0){return\n}a=Dwt.getParams(arguments,DwtColorPicker.PARAMS);\na.className=a.className||\"DwtColorPicker\";\nDwtComposite.call(this,a);\nthis._hideNoFill=a.hideNoFill;\nthis._noFillLabel=a.noFillLabel;\nthis._allowColorInput=a.allowColorInput;\nthis._defaultColor=a.defaultColor||\"#000000\";\nthis._createHtml()\n};\nDwtColorPicker.prototype=new DwtComposite;\nDwtColorPicker.prototype.constructor=DwtColorPicker;\nDwtColorPicker.prototype.toString=function(){return\"DwtColorPicker\"\n};\nDwtColorPicker.PARAMS=[\"parent\",\"className\",\"posStyle\",\"noFillLabel\",\"allowColorInput\",\"defaultColor\"];\nDwtColorPicker._RGB_RE=/^rgb\\(([0-9]{1,3}),\\s*([0-9]{1,3}),\\s*([0-9]{1,3})\\)$/;\nDwtColorPicker._HEX_RE=/^\\#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i;\nDwtColorPicker.prototype.TEMPLATE=\"dwt.Widgets#DwtColorPicker\";\nDwtColorPicker.prototype.addSelectionListener=function(a){this.addListener(DwtEvent.SELECTION,a)\n};\nDwtColorPicker.prototype.removeSelectionListener=function(a){this.removeListener(DwtEvent.SELECTION,a)\n};\nDwtColorPicker.prototype.dispose=function(){if(this._disposed){return\n}DwtControl.prototype.dispose.call(this)\n};\nDwtColorPicker.prototype._createHtml=function(a){this._createHtmlFromTemplate(a||this.TEMPLATE,{id:this.getHtmlElement().id})\n};\nDwtColorPicker.prototype._createHtmlFromTemplate=function(b,f){f.allowColorInput=this._allowColorInput;\nf.hideNoFill=this._hideNoFill;\nf.noFillLabel=this._noFillLabel;\nDwtComposite.prototype._createHtmlFromTemplate.apply(this,arguments);\nif(f.allowColorInput){var n=document.getElementById(f.id+\"_input\");\nvar j={parent:this,validationStyle:DwtInputField.CONTINUAL_VALIDATION,errorIconStyle:DwtInputField.ERROR_ICON_RIGHT,validator:DwtColorPicker.__isValidInputValue};\nvar m=this._colorInput=new DwtInputField(j);\nm.replaceElement(n);\nvar d=new AjxCallback(this,this._updatePreview);\nm.setValidationCallback(d);\nvar l=this._error=new DwtLabel({parent:this});\nvar a=document.getElementById(f.id+\"_error\");\nl.replaceElement(a);\nl.setVisible(false);\nthis._preview=document.getElementById(f.id+\"_preview\");\nvar k=document.getElementById(f.id+\"_button\");\nvar g=new DwtButton({parent:this});\ng.setText(AjxMsg.setColor);\ng.replaceElement(k);\ng.addSelectionListener(new AjxListener(this,this._handleSetColor))\n}var k=document.getElementById(f.id+\"_default\");\nif(k){if(!DwtColorPicker.Button){DwtColorPicker.__defineClasses()\n}var g=this._defaultColorButton=new DwtColorPicker.Button({parent:this});\ng.setText(f.noFillLabel||AjxMsg.colorsUseDefault);\ng.replaceElement(k);\ng.addSelectionListener(new AjxListener(this,this._handleColorSelect,[0]))\n}var e=document.getElementById(f.id+\"_colors\");\nvar c=AjxEnv.isIE?DwtEvent.ONMOUSEENTER:DwtEvent.ONMOUSEOVER;\nvar h=AjxEnv.isIE?DwtEvent.ONMOUSELEAVE:DwtEvent.ONMOUSEOUT;\nDwt.setHandler(e,DwtEvent.ONMOUSEDOWN,AjxCallback.simpleClosure(this._handleMouseDown,this));\nDwt.setHandler(e,DwtEvent.ONMOUSEUP,AjxCallback.simpleClosure(this._handleMouseUp,this));\nDwt.setHandler(e,c,AjxCallback.simpleClosure(this._handleMouseOver,this));\nDwt.setHandler(e,h,AjxCallback.simpleClosure(this._handleMouseOut,this))\n};\nDwtColorPicker.prototype._handleMouseOver=function(a){var b=DwtUiEvent.getEvent(a);\nvar c=DwtUiEvent.getTarget(b);\nif(!Dwt.hasClass(c,\"Color\")){return\n}this._handleMouseOut(a);\nDwt.addClass(c,DwtControl.HOVER);\nthis._mouseOverEl=c\n};\nDwtColorPicker.prototype._handleMouseOut=function(a){if(this._mouseOverEl){Dwt.delClass(this._mouseOverEl,DwtControl.HOVER)\n}this._mouseOverEl=null\n};\nDwtColorPicker.prototype._handleMouseDown=function(a){var b=DwtUiEvent.getEvent(a);\nvar c=DwtUiEvent.getTarget(b);\nthis._mouseDownEl=Dwt.hasClass(c,\"Color\")?c:null\n};\nDwtColorPicker.prototype._handleMouseUp=function(a){var b=DwtUiEvent.getEvent(a);\nvar d=DwtUiEvent.getTarget(b);\nif(this._mouseDownEl!=d){return\n}var c=DwtCssStyle.getProperty(d,\"background-color\");\nthis._handleColorSelect(DwtColorPicker.__color2hex(c))\n};\nDwtColorPicker.prototype._handleSetColor=function(a){var b=this._colorInput.getValue();\nif(b){b=DwtColorPicker.__color2hex(b);\nif(!b){return\n}this._handleColorSelect(b)\n}};\nDwtColorPicker.prototype._handleColorSelect=function(a){this._inputColor=a;\nif(this.parent instanceof DwtMenu){DwtMenu.closeActiveMenu()\n}if(this.isListenerRegistered(DwtEvent.SELECTION)){var b=DwtShell.selectionEvent;\nb.item=this;\nb.detail=this._inputColor;\nthis.notifyListeners(DwtEvent.SELECTION,b)\n}};\nDwtColorPicker.prototype.getInputColor=function(){return this._inputColor\n};\nDwtColorPicker.prototype.setDefaultColor=function(a){if(this._defaultColorButton){this._defaultColorButton.setDefaultColor(a)\n}};\nDwtColorPicker.__color2hex=function(c){if(c==\"white\"){return\"#FFFFFF\"\n}if(c==\"black\"){return\"#000000\"\n}var a=c&&c.match(DwtColorPicker._RGB_RE);\nif(a){for(var b=1;\nb<=3;\nb++){if(parseInt(a[b])>255){return\"\"\n}}return AjxColor.color(a[1],a[2],a[3])\n}a=c&&c.match(DwtColorPicker._HEX_RE);\nif(a){return c\n}return\"\"\n};\nDwtColorPicker.__isValidInputValue=function(a){if(!a){return a\n}var b=DwtColorPicker.__color2hex(a);\nif(!b){throw AjxMsg.colorFormatError\n}return a\n};\nDwtColorPicker.prototype._updatePreview=function(c,b,a){if(b){a=DwtColorPicker.__color2hex(a);\nDwt.setVisible(this._preview,true);\nthis._preview.style.backgroundColor=a;\nthis._error.setVisible(false)\n}else{Dwt.setVisible(this._preview,false);\nthis._error.setVisible(true);\nthis._error.setText(AjxMsg.colorFormatError)\n}};\nDwtColorPicker.__defineClasses=function(){DwtColorPicker.Button=function(a){a.className=a.className||\"DwtColorPickerButton\";\nDwtButton.call(this,a);\nthis._colorDiv=document.getElementById(this.getHtmlElement().id+\"_color\")\n};\nDwtColorPicker.Button.prototype=new DwtButton;\nDwtColorPicker.Button.prototype.constructor=DwtColorPicker.Button;\nDwtColorPicker.Button.prototype.setDefaultColor=function(a){this._colorDiv.style.backgroundColor=(a===null)?\"\":a\n};\nDwtColorPicker.Button.prototype.toString=function(){return\"DwtColorPickerButton\"\n};\nDwtColorPicker.Button.prototype.TEMPLATE=\"dwt.Widgets#DwtColorPickerButton\"\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtCheckbox\")){DwtCheckbox=function(a){if(arguments.length==0){return\n}a=Dwt.getParams(arguments,DwtCheckbox.PARAMS);\na.className=a.className||\"DwtCheckbox\";\nDwtControl.call(this,a);\nthis._textPosition=DwtCheckbox.DEFAULT_POSITION;\nthis._initName=a.name;\nthis._initValue=a.value;\nthis._createHtml();\nthis.setSelected(a.checked)\n};\nDwtCheckbox.prototype=new DwtControl;\nDwtCheckbox.prototype.constructor=DwtCheckbox;\nDwtCheckbox.prototype.isDwtCheckbox=true;\nDwtCheckbox.prototype.isInputControl=true;\nDwtCheckbox.prototype.toString=function(){return\"DwtCheckbox\"\n};\nDwtCheckbox.PARAMS=[\"parent\",\"style\",\"name\",\"checked\",\"className\",\"posStyle\",\"id\",\"index\",\"value\"];\nDwtCheckbox.TEXT_LEFT=\"left\";\nDwtCheckbox.TEXT_RIGHT=\"right\";\nDwtCheckbox.DEFAULT_POSITION=DwtCheckbox.TEXT_RIGHT;\nDwtCheckbox.prototype.TEMPLATE=\"dwt.Widgets#DwtCheckbox\";\nDwtCheckbox.prototype.INPUT_TYPE=\"checkbox\";\nDwtCheckbox.prototype.getInputElement=function(){return this._inputEl\n};\nDwtCheckbox.prototype._focus=function(){Dwt.addClass(this.getHtmlElement(),DwtControl.FOCUSED)\n};\nDwtCheckbox.prototype._blur=function(){Dwt.delClass(this.getHtmlElement(),DwtControl.FOCUSED)\n};\nDwtCheckbox.prototype.addSelectionListener=function(a){this.addListener(DwtEvent.SELECTION,a)\n};\nDwtCheckbox.prototype.removeSelectionListener=function(a){this.removeListener(DwtEvent.SELECTION,a)\n};\nDwtCheckbox.prototype.setEnabled=function(a){if(a!=this._enabled){DwtControl.prototype.setEnabled.call(this,a);\nthis._inputEl.disabled=!a;\nvar b=a?\"Text\":\"DisabledText\";\nif(this._textElLeft){this._textElLeft.className=b\n}if(this._textElRight){this._textElRight.className=b\n}}};\nDwtCheckbox.prototype.setSelected=function(a){if(this._inputEl&&this._inputEl.checked!=a){this._inputEl.checked=a\n}};\nDwtCheckbox.prototype.isSelected=function(){return this._inputEl&&this._inputEl.checked\n};\nDwtCheckbox.prototype.setText=function(a){if(this._textEl&&this._text!=a){this._text=a;\nthis._textEl.innerHTML=a||\"\"\n}};\nDwtCheckbox.prototype.getText=function(){return this._text\n};\nDwtCheckbox.prototype.setTextPosition=function(a){this._textEl=a==DwtCheckbox.TEXT_LEFT?this._textElLeft:this._textElRight;\nif(this._textPosition!=a){this._textPosition=a;\nif(this._textElLeft){this._textElLeft.innerHTML=\"\"\n}if(this._textElRight){this._textElRight.innerHTML=\"\"\n}this.setText(this._text)\n}};\nDwtCheckbox.prototype.getTextPosition=function(){return this._textPosition\n};\nDwtCheckbox.prototype.setValue=function(b){var a=this._inputEl||this;\nif(a.value!==b){a.value=b\n}};\nDwtCheckbox.prototype.getValue=function(){var a=this._inputEl||this;\nreturn a.value!=null?a.value:this.getText()\n};\nDwtCheckbox.prototype.getInputElement=function(){return this._inputEl\n};\nDwtCheckbox.prototype.setToolTipContent=function(a){if(a&&!this.__mouseEventsSet){this.__mouseEventsSet=true;\nthis._setMouseEvents()\n}DwtControl.prototype.setToolTipContent.apply(this,arguments)\n};\nDwtCheckbox.prototype._replaceElementHook=function(b,c,a,d){c=this.getInputElement();\nDwtControl.prototype._replaceElementHook.call(this,b,c,a,d);\nif(b.id){this.setHtmlElementId(b.id+\"_control\");\nc.id=b.id;\nif(this._textEl){this._textEl.setAttribute(AjxEnv.isIE?\"htmlFor\":\"for\",b.id)\n}}};\nDwtCheckbox.prototype._createHtml=function(a){var b={id:this._htmlElId};\nthis._createHtmlFromTemplate(a||this.TEMPLATE,b)\n};\nDwtCheckbox.prototype._createHtmlFromTemplate=function(b,c){c.name=this._initName||this._htmlElId;\nc.value=this._initValue;\nc.type=this.INPUT_TYPE;\nDwtControl.prototype._createHtmlFromTemplate.call(this,b,c);\nthis._inputEl=document.getElementById(c.id+\"_input\");\nif(this._inputEl){var a=DwtShell.getShell(window).getKeyboardMgr();\nvar d=AjxCallback.simpleClosure(a.grabFocus,a,this.getInputElement());\nDwt.setHandler(this._inputEl,DwtEvent.ONFOCUS,d);\nDwt.setHandler(this._inputEl,DwtEvent.ONCLICK,DwtCheckbox.__handleClick);\nthis.setFocusElement()\n}this._textElLeft=document.getElementById(c.id+\"_text_left\");\nthis._textElRight=document.getElementById(c.id+\"_text_right\");\nthis.setTextPosition(this._textPosition)\n};\nDwtCheckbox.__handleClick=function(a){var b=DwtUiEvent.getEvent(a);\nvar e=DwtUiEvent.getTarget(b);\nvar d=DwtShell.selectionEvent;\nDwtUiEvent.copy(d,b);\nd.item=this;\nd.detail=e.checked;\nvar c=DwtControl.findControl(e);\nc.setSelected(e.checked);\nc.focus();\nc.notifyListeners(DwtEvent.SELECTION,d)\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtRadioButton\")){DwtRadioButton=function(a){if(arguments.length==0){return\n}a=Dwt.getParams(arguments,DwtRadioButton.PARAMS);\na.className=a.className||\"DwtRadioButton\";\nDwtCheckbox.call(this,a)\n};\nDwtRadioButton.PARAMS=DwtCheckbox.PARAMS;\nDwtRadioButton.prototype=new DwtCheckbox;\nDwtRadioButton.prototype.constructor=DwtRadioButton;\nDwtRadioButton.prototype.isDwtRadioButton=true;\nDwtRadioButton.prototype.isInputControl=true;\nDwtRadioButton.prototype.toString=function(){return\"DwtRadioButton\"\n};\nDwtRadioButton.prototype.INPUT_TYPE=\"radio\"\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtPasswordField\")){DwtPasswordField=function(a){if(arguments.length==0){return\n}a=a||{parent:DwtShell.getShell(window)};\na.type=DwtInputField.PASSWORD;\nDwtInputField.call(this,a);\nthis._tabGroup=new DwtTabGroup(this._htmlElId);\nthis._createHtml()\n};\nDwtPasswordField.prototype=new DwtInputField;\nDwtPasswordField.prototype.constructor=DwtPasswordField;\nDwtPasswordField.prototype.TEMPLATE=\"dwt.Widgets#DwtPasswordField\";\nDwtPasswordField.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nDwtPasswordField.prototype.setShowPassword=function(a){this._showCheckbox.setSelected(a);\nthis.setInputType(a?DwtInputField.STRING:DwtInputField.PASSWORD)\n};\nDwtPasswordField.prototype._createHtml=function(a){var b={id:this._htmlElId};\nthis._createHtmlFromTemplate(a||this.TEMPLATE,b)\n};\nDwtPasswordField.prototype._createHtmlFromTemplate=function(c,e){this._tabGroup.removeAllMembers();\nvar a=document.createDocumentFragment();\nvar g=this.getHtmlElement().firstChild;\nwhile(g){var d=g.nextSibling;\na.appendChild(g);\ng=d\n}DwtInputField.prototype._createHtmlFromTemplate.apply(this,arguments);\nvar f=document.getElementById(e.id+\"_input\");\nf.appendChild(a);\nthis._tabGroup.addMember(this.getInputElement());\nvar b=document.getElementById(e.id+\"_show_password\");\nif(b){this._showCheckbox=new DwtCheckbox({parent:this});\nthis._showCheckbox.setText(AjxMsg.showPassword);\nthis._showCheckbox.addSelectionListener(new AjxListener(this,this._handleShowCheckbox));\nthis._showCheckbox.replaceElement(b);\nthis._tabGroup.addMember(this._showCheckbox)\n}};\nDwtPasswordField.prototype._handleShowCheckbox=function(a){this.setShowPassword(a.detail)\n};\nDwtPasswordField.prototype.getValue=function(){return this._inputField.value\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtCalendar\")){DwtCalendar=function(a){if(arguments.length==0){return\n}a=Dwt.getParams(arguments,DwtCalendar.PARAMS);\na.className=a.className||\"DwtCalendar\";\nDwtComposite.call(this,a);\nthis._skipNotifyOnPage=false;\nthis._hidePrevNextMo=a.hidePrevNextMo;\nthis._readOnly=a.readOnly;\nthis._showWeekNumber=a.showWeekNumber;\nthis._uuid=Dwt.getNextId();\nvar b=this._origDayClassName=a.className+\"Day\";\nthis._todayClassName=\" \"+a.className+\"Day-today\";\nthis._selectedDayClassName=\" \"+b+\"-\"+DwtCssStyle.SELECTED;\nthis._hoveredDayClassName=\" \"+b+\"-\"+DwtCssStyle.HOVER;\nthis._activeDayClassName=\" \"+b+\"-\"+DwtCssStyle.ACTIVE;\nthis._hiliteClassName=\" \"+b+\"-hilited\";\nthis._greyClassName=\" \"+b+\"-grey\";\nif(!this._readOnly){this._installListeners()\n}this._selectionMode=DwtCalendar.DAY;\nthis._init();\nthis._weekDays=new Array(7);\nthis._workingDays=a.workingDays||DwtCalendar._DEF_WORKING_DAYS;\nthis._useISO8601WeekNo=a.useISO8601WeekNo;\nthis.setFirstDayOfWeek(a.firstDayOfWeek||DwtCalendar.SUN);\nthis._forceRollOver=(a.forceRollOver!==false)\n};\nDwtCalendar.PARAMS=[\"parent\",\"className\",\"posStyle\",\"firstDayOfWeek\",\"forceRollOver\",\"workingDaysArray\",\"hidePrevNextMo\",\"readOnly\"];\nDwtCalendar.prototype=new DwtComposite;\nDwtCalendar.prototype.constructor=DwtCalendar;\nDwtCalendar.SUN=0;\nDwtCalendar.MON=1;\nDwtCalendar.TUE=2;\nDwtCalendar.WED=3;\nDwtCalendar.THU=4;\nDwtCalendar.FRI=5;\nDwtCalendar.SAT=6;\nDwtCalendar.DAY=1;\nDwtCalendar.WEEK=2;\nDwtCalendar.WORK_WEEK=3;\nDwtCalendar.MONTH=4;\nDwtCalendar.RANGE_CHANGE=\"DwtCalendar.RANGE_CHANGE\";\nDwtCalendar._FULL_WEEK=[1,1,1,1,1,1,1];\nDwtCalendar._DEF_WORKING_DAYS=[0,1,1,1,1,1,0];\nDwtCalendar._DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];\nDwtCalendar._NO_MONTH=-2;\nDwtCalendar._PREV_MONTH=-1;\nDwtCalendar._THIS_MONTH=0;\nDwtCalendar._NEXT_MONTH=1;\nDwtCalendar._NORMAL=1;\nDwtCalendar._HOVERED=2;\nDwtCalendar._ACTIVE=3;\nDwtCalendar._SELECTED=4;\nDwtCalendar._DESELECTED=5;\nDwtCalendar.DATE_SELECTED=1;\nDwtCalendar.DATE_DESELECTED=2;\nDwtCalendar.DATE_DBL_CLICKED=3;\nDwtCalendar._LAST_DAY_CELL_IDX=41;\nDwtCalendar._BUTTON_CLASS=\"DwtCalendarButton\";\nDwtCalendar._BUTTON_HOVERED_CLASS=DwtCalendar._BUTTON_CLASS+\"-\"+DwtCssStyle.HOVER;\nDwtCalendar._BUTTON_ACTIVE_CLASS=DwtCalendar._BUTTON_CLASS+\"-\"+DwtCssStyle.ACTIVE;\nDwtCalendar._TITLE_CLASS=\"DwtCalendarTitle\";\nDwtCalendar._TITLE_HOVERED_CLASS=DwtCalendar._TITLE_CLASS+\"-\"+DwtCssStyle.HOVER;\nDwtCalendar._TITLE_ACTIVE_CLASS=DwtCalendar._TITLE_CLASS+\"-\"+DwtCssStyle.ACTIVE;\nDwtCalendar.prototype.toString=function(){return\"DwtCalendar\"\n};\nDwtCalendar.prototype.addSelectionListener=function(a){this.addListener(DwtEvent.SELECTION,a)\n};\nDwtCalendar.prototype.removeSelectionListener=function(a){this.removeListener(DwtEvent.SELECTION,a)\n};\nDwtCalendar.prototype.addActionListener=function(a){this.addListener(DwtEvent.ACTION,a)\n};\nDwtCalendar.prototype.removeActionListener=function(a){this.removeListener(DwtEvent.ACTION,a)\n};\nDwtCalendar.prototype.addDateRangeListener=function(a){this.addListener(DwtEvent.DATE_RANGE,a)\n};\nDwtCalendar.prototype.removeDateRangeListener=function(a){this.removeListener(DwtEvent.DATE_RANGE,a)\n};\nDwtCalendar.prototype.setSkipNotifyOnPage=function(a){this._skipNotifyOnPage=a\n};\nDwtCalendar.prototype.getSkipNotifyOnPage=function(){return this._skipNotifyOnPage\n};\nDwtCalendar.prototype.setDate=function(d,g,c,b){c=(c==null)?this._forceRollOver:c;\nif(!d){d=new Date()\n}var k=new Date(d.getTime());\nvar e=this._date;\nvar f=false;\nvar m=false;\nvar a;\nif(this._date2CellId!=null){var j=(k.getFullYear()*10000)+(k.getMonth()*100)+k.getDate();\nvar a=this._date2CellId[j];\nif(a){if(a==this._selectedCellId){m=true\n}var l=document.getElementById(a);\nif(l._dayType==DwtCalendar._THIS_MONTH){m=true\n}else{if(c){m=f=true\n}else{m=true\n}}}else{m=f=true\n}}else{m=f=true\n}if(m){if(this._date){if(AjxDateUtil.isDayShifted(k)){AjxDateUtil.rollToNextDay(k)\n}k.setHours(this._date.getHours(),this._date.getMinutes(),this._date.getSeconds(),0)\n}this._date=k;\nif(!f&&!this._readOnly){this._setSelectedDate();\nthis._setToday()\n}}if(f){this._layout()\n}if(m&&!g){var h=b?DwtCalendar.DATE_DBL_CLICKED:DwtCalendar.DATE_SELECTED;\nthis._notifyListeners(DwtEvent.SELECTION,h,this._date)\n}return true\n};\nDwtCalendar.prototype.isSelected=function(b){if(b==this._selectedDayElId){return true\n}else{if(this._selectionMode!=DwtCalendar.DAY){var a=this._getDayCellIndex(b);\nif(Math.floor(a/7)==Math.floor(this._getDayCellIndex(this._selectedDayElId)/7)&&this._currWorkingDays[a%7]){return true\n}}}return false\n};\nDwtCalendar.prototype.getForceRollOver=function(){return this._forceRollOver\n};\nDwtCalendar.prototype.setForceRollOver=function(a){if(a==null){return\n}if(this._forceRollOver!=a){this._forceRollOver=a;\nthis._layout()\n}};\nDwtCalendar.prototype.getSelectionMode=function(){return this._selectionMode\n};\nDwtCalendar.prototype.setSelectionMode=function(a){if(this._selectionMode==a){return\n}this._selectionMode=a;\nif(a==DwtCalendar.WEEK){this._currWorkingDays=DwtCalendar._FULL_WEEK\n}else{if(a==DwtCalendar.WORK_WEEK){this._currWorkingDays=this._workingDays\n}}this._layout()\n};\nDwtCalendar.prototype.setWorkingWeek=function(a){this._workingDays=this._currWorkingDays=a;\nif(this._selectionMode==DwtCalendar.WORK_WEEK){this._layout()\n}};\nDwtCalendar.prototype.setHilite=function(f,c,b){if(this._date2CellId==null){return\n}var a;\nvar g;\nif(b){for(g in this._date2CellId){a=document.getElementById(this._date2CellId[g]);\nif(a._isHilited){a._isHilited=false;\nthis._setClassName(a,DwtCalendar._NORMAL)\n}}}var e;\nfor(var d in f){if(f.hasOwnProperty(d)){g=f[d];\ne=this._date2CellId[g.getFullYear()*10000+g.getMonth()*100+g.getDate()];\nif(e){a=document.getElementById(e);\nif(a._isHilited!=c){a._isHilited=c;\nthis._setClassName(a,DwtCalendar._NORMAL)\n}}}}};\nDwtCalendar.prototype.getDate=function(){return this._date\n};\nDwtCalendar.prototype.setFirstDayOfWeek=function(a){for(var c=0;\nc<7;\nc++){this._weekDays[c]=(c<a)?(6-(a-c-1)):(c-a);\nvar b=document.getElementById(this._getDOWCellId(c));\nb.innerHTML=AjxDateUtil.WEEKDAY_SHORT[(a+c)%7]\n}this._firstDayOfWeek=a;\nthis._layout()\n};\nDwtCalendar.prototype.getDateRange=function(){return this._range\n};\nDwtCalendar.prototype._getDayCellId=function(a){return(\"c:\"+a+\":\"+this._uuid)\n};\nDwtCalendar.prototype._getDayCellIndex=function(a){return a.substring(2,a.indexOf(\":\",3))\n};\nDwtCalendar.prototype._getDOWCellId=function(a){return(\"w:\"+a+\":\"+this._uuid)\n};\nDwtCalendar.prototype._getWeekNumberCellId=function(a){return(\"k:\"+a+\":\"+this._uuid)\n};\nDwtCalendar.prototype._getDaysInMonth=function(b,a){if(b!=1){return DwtCalendar._DAYS_IN_MONTH[b]\n}if(a%4!=0||(a%100==0&&a%400!=0)){return 28\n}return 29\n};\nDwtCalendar.prototype._installListeners=function(){this._setMouseEventHdlrs();\nthis.addListener(DwtEvent.ONMOUSEOVER,new AjxListener(this,this._mouseOverListener));\nthis.addListener(DwtEvent.ONMOUSEOUT,new AjxListener(this,this._mouseOutListener));\nthis.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._mouseDownListener));\nthis.addListener(DwtEvent.ONMOUSEUP,new AjxListener(this,this._mouseUpListener));\nthis.addListener(DwtEvent.ONDBLCLICK,new AjxListener(this,this._doubleClickListener))\n};\nDwtCalendar.prototype._notifyListeners=function(a,c,b,d){if(!this.isListenerRegistered(a)){return\n}var e=DwtShell.selectionEvent;\nif(d){DwtUiEvent.copy(e,d)\n}else{e.reset()\n}e.item=this;\ne.detail=b;\ne.type=c;\nthis.notifyListeners(a,e)\n};\nDwtCalendar.prototype._layout=function(){if(this._date==null){this._date=new Date()\n}if(!this._calWidgetInited){this._init()\n}var q=new Date(this._date.getTime());\nq.setDate(1);\nvar f=q.getFullYear();\nvar r=q.getMonth();\nvar e=q.getDay();\nvar c=this._getDaysInMonth(r,f);\nvar k=1;\nvar s=1;\nthis._date2CellId=new Object();\nthis._selectedDayElId=null;\nvar d,m,t,p,a;\nif(!this._hidePrevNextMo){if(r!=0){d=this._getDaysInMonth(r-1,f)-this._weekDays[e]+1;\nm=f;\nt=r-1;\nif(r!=11){p=r+1;\na=f\n}else{p=0;\na=f+1\n}}else{d=this._getDaysInMonth(11,f-1)-this._weekDays[e]+1;\nm=f-1;\nt=11;\np=1;\na=f\n}}for(var l=0;\nl<6;\nl++){for(var h=0;\nh<7;\nh++){var o=document.getElementById(this._getDayCellId(l*7+h));\nif(o._isHilited==null){o._isHilited=false\n}if(k<=c){if(l!=0||h>=this._weekDays[e]){this._date2CellId[(f*10000)+(r*100)+k]=o.id;\no._day=k;\no._month=r;\no._year=f;\no.innerHTML=k++;\no._dayType=DwtCalendar._THIS_MONTH;\nif(this._readOnly){o.style.fontFamily=\"Arial\";\no.style.fontSize=\"10px\"\n}}else{if(this._hidePrevNextMo){o.innerHTML=\"\"\n}else{this._date2CellId[(m*10000)+(t*100)+d]=o.id;\no._day=d;\no._month=t;\no._year=m;\no.innerHTML=d++;\no._dayType=DwtCalendar._PREV_MONTH\n}}}else{if(!this._hidePrevNextMo){this._date2CellId[(a*10000)+(p*100)+s]=o.id;\no._day=s;\no._month=p;\no._year=a;\no.innerHTML=s++;\no._dayType=DwtCalendar._NEXT_MONTH\n}}this._setClassName(o,DwtCalendar._NORMAL)\n}if(this._showWeekNumber){var g=this._getWeekNumberCellId(\"kw\"+l*7);\nvar n=document.getElementById(g);\nif(n){var b=document.getElementById(this._getDayCellId(l*7));\nn.innerHTML=AjxDateUtil.getWeekNumber(new Date(b._year,b._month,b._day),this._firstDayOfWeek,null,this._useISO8601WeekNo)\n}}}this._setTitle(r,f);\nif(!this._readOnly){this._setSelectedDate();\nthis._setToday()\n}this._setRange()\n};\nDwtCalendar.prototype._setRange=function(){var a=document.getElementById(this._getDayCellId(0));\nvar d=new Date(a._year,a._month,a._day,0,0,0,0);\na=document.getElementById(this._getDayCellId(DwtCalendar._LAST_DAY_CELL_IDX));\nvar c=this._getDaysInMonth(a._month,a._year);\nvar b;\nif(a._day<c){b=new Date(a._year,a._month,a._day+1,0,0,0,0)\n}else{if(a._month<11){b=new Date(a._year,a._month+1,1,0,0,0,0)\n}else{b=new Date(a._year+1,0,1,0,0,0,0)\n}}if(this._range==null){this._range={}\n}else{if(this._range.start.getTime()==d.getTime()&&this._range.end.getTime()==b.getTime()){return false\n}}this._range.start=d;\nthis._range.end=b;\nif(!this.isListenerRegistered(DwtEvent.DATE_RANGE)){return\n}if(!this._dateRangeEvent){this._dateRangeEvent=new DwtDateRangeEvent(true)\n}this._dateRangeEvent.item=this;\nthis._dateRangeEvent.start=d;\nthis._dateRangeEvent.end=b;\nthis.notifyListeners(DwtEvent.DATE_RANGE,this._dateRangeEvent)\n};\nDwtCalendar.prototype._setToday=function(){var a;\nvar b=new Date();\nvar c=b.getDate();\nif(!this._todayDay||this._todayDay!=c){if(this._todayCellId!=null){a=document.getElementById(this._todayCellId);\na._isToday=false;\nthis._setClassName(a,DwtCalendar._NORMAL)\n}this._todayCellId=this._date2CellId[(b.getFullYear()*10000)+(b.getMonth()*100)+c];\nif(this._todayCellId!=null){a=document.getElementById(this._todayCellId);\na._isToday=true;\nthis._setClassName(a,DwtCalendar._NORMAL)\n}}};\nDwtCalendar.prototype._setSelectedDate=function(){var b=this._date.getDate();\nvar e=this._date.getMonth();\nvar c=this._date.getFullYear();\nvar a;\nif(this._selectedDayElId){a=document.getElementById(this._selectedDayElId);\nthis._setClassName(a,DwtCalendar._DESELECTED)\n}var d=this._date2CellId[(c*10000)+(e*100)+b];\na=document.getElementById(d);\nthis._selectedDayElId=d;\nthis._setClassName(a,DwtCalendar._SELECTED)\n};\nDwtCalendar.prototype._setCellClassName=function(b,c,d){if(b._dayType!=DwtCalendar._THIS_MONTH){c+=this._greyClassName\n}if(this._selectionMode==DwtCalendar.DAY&&b.id==this._selectedDayElId&&d!=DwtCalendar._DESELECTED){c+=this._selectedDayClassName\n}else{if(this._selectionMode!=DwtCalendar.DAY&&d!=DwtCalendar._DESELECTED&&this._selectedDayElId!=null){var a=this._getDayCellIndex(b.id);\nif(Math.floor(this._getDayCellIndex(this._selectedDayElId)/7)==Math.floor(a/7)&&this._currWorkingDays[a%7]){c+=this._selectedDayClassName\n}}}if(b._isHilited){c+=this._hiliteClassName\n}if(b._isToday){c+=this._todayClassName\n}return c\n};\nDwtCalendar.prototype._setClassName=function(a,f){var c=\"\";\nif(f==DwtCalendar._NORMAL){c=this._origDayClassName\n}else{if(f==DwtCalendar._HOVERED){c=this._hoveredDayClassName\n}else{if(f==DwtCalendar._ACTIVE){c=this._activeDayClassName\n}else{if(f==DwtCalendar._DESELECTED&&this._selectionMode==DwtCalendar.DAY){c=this._origDayClassName\n}else{if(this._selectionMode!=DwtCalendar.DAY&&(f==DwtCalendar._SELECTED||f==DwtCalendar._DESELECTED)){var e=Math.floor(this._getDayCellIndex(this._selectedDayElId)/7)*7;\nfor(var b=0;\nb<7;\nb++){c=this._origDayClassName;\nvar d=document.getElementById(this._getDayCellId(e++));\nd.className=this._setCellClassName(d,c,f)\n}return\n}}}}}a.className=this._setCellClassName(a,c,f)\n};\nDwtCalendar.prototype._setTitle=function(e,d){var a=document.getElementById(this._monthCell);\nvar c=DwtCalendar.getMonthFormatter();\nvar b=new Date(d,e);\na.innerHTML=c.format(b)\n};\nDwtCalendar.prototype._init=function(){var d=new Array(100);\nvar a=0;\nthis._monthCell=\"t:\"+this._uuid;\nd[a++]=\"<table width=100%>\";\nd[a++]=\"<tr><td class='DwtCalendarTitlebar'>\";\nd[a++]=\"<table>\";\nd[a++]=\"<tr>\";\nd[a++]=\"<td align='center' class='\";\nd[a++]=DwtCalendar._BUTTON_CLASS;\nd[a++]=\"' id='b:py:\";\nd[a++]=this._uuid;\nd[a++]=\"'>\";\nd[a++]=AjxImg.getImageHtml(\"FastRevArrowSmall\",null,[\"id='b:py:img:\",this._uuid,\"'\"].join(\"\"));\nd[a++]=\"</td>\";\nd[a++]=\"<td align='center' class='\";\nd[a++]=DwtCalendar._BUTTON_CLASS;\nd[a++]=\"' id='b:pm:\";\nd[a++]=this._uuid;\nd[a++]=\"'>\";\nd[a++]=AjxImg.getImageHtml(\"RevArrowSmall\",null,[\"id='b:pm:img:\",this._uuid,\"'\"].join(\"\"));\nd[a++]=\"</td>\";\nd[a++]=\"<td class='DwtCalendarTitleCell' 'nowrap' style='width: 60%'><span class='\";\nd[a++]=DwtCalendar._TITLE_CLASS;\nd[a++]=\"' id='\";\nd[a++]=this._monthCell;\nd[a++]=\"'></span></td>\";\nd[a++]=\"<td align='center' class='\";\nd[a++]=DwtCalendar._BUTTON_CLASS;\nd[a++]=\"' id='b:nm:\";\nd[a++]=this._uuid;\nd[a++]=\"'>\";\nd[a++]=AjxImg.getImageHtml(\"FwdArrowSmall\",null,[\"id='b:nm:img:\",this._uuid,\"'\"].join(\"\"));\nd[a++]=\"</td>\";\nd[a++]=\"<td align='center' class='\";\nd[a++]=DwtCalendar._BUTTON_CLASS;\nd[a++]=\"' id='b:ny:\";\nd[a++]=this._uuid;\nd[a++]=\"'>\";\nd[a++]=AjxImg.getImageHtml(\"FastFwdArrowSmall\",null,[\"id='b:ny:img:\",this._uuid,\"'\"].join(\"\"));\nd[a++]=\"</td>\";\nd[a++]=\"</tr>\";\nd[a++]=\"</table>\";\nd[a++]=\"</td></tr>\";\nd[a++]=\"<tr><td class='DwtCalendarBody'>\";\nd[a++]=\"<table width='100%' style='border-collapse:separate;' cellspacing='0'>\";\nd[a++]=\"<tr>\";\nif(this._showWeekNumber){d[a++]=\"<td class='DwtCalendarWeekNoTitle' width='14%' id='\";\nd[a++]=this._getWeekNumberCellId(\"kw\");\nd[a++]=\"'>\";\nd[a++]=AjxMsg.calendarWeekTitle;\nd[a++]=\"</td>\"\n}for(var c=0;\nc<7;\nc++){d[a++]=\"<td class='DwtCalendarDow' width='\";\nd[a++]=(c<5?\"14%\":\"15%\");\nd[a++]=\"' id='\";\nd[a++]=this._getDOWCellId(c);\nd[a++]=\"'>&nbsp;</td>\"\n}d[a++]=\"</tr>\";\nfor(var c=0;\nc<6;\nc++){d[a++]=\"<tr>\";\nif(this._showWeekNumber){d[a++]=\"<td class='DwtCalendarWeekNo' id='\"+this._getWeekNumberCellId(\"kw\"+c*7)+\"'>&nbsp;</td>\"\n}for(var b=0;\nb<7;\nb++){d[a++]=\"<td id='\";\nd[a++]=this._getDayCellId(c*7+b);\nd[a++]=\"'>&nbsp;</td>\"\n}d[a++]=\"</tr>\"\n}d[a++]=\"</td></tr></table></table>\";\nthis.getHtmlElement().innerHTML=d.join(\"\");\nif(!this._readOnly){document.getElementById(\"b:py:img:\"+this._uuid)._origClassName=AjxImg.getClassForImage(\"FastRevArrowSmall\");\ndocument.getElementById(\"b:pm:img:\"+this._uuid)._origClassName=AjxImg.getClassForImage(\"RevArrowSmall\");\ndocument.getElementById(\"b:nm:img:\"+this._uuid)._origClassName=AjxImg.getClassForImage(\"FwdArrowSmall\");\ndocument.getElementById(\"b:ny:img:\"+this._uuid)._origClassName=AjxImg.getClassForImage(\"FastFwdArrowSmall\")\n}this._calWidgetInited=true\n};\nDwtCalendar.prototype.setMouseOverDayCallback=function(a){this._mouseOverDayCB=a\n};\nDwtCalendar.prototype.setMouseOutDayCallback=function(a){this._mouseOutDayCB=a\n};\nDwtCalendar.prototype.getDndDate=function(){var a=this._lastDndCell;\nif(a){return new Date(a._year,a._month,a._day)\n}return null\n};\nDwtCalendar._tmpDate=new Date();\nDwtCalendar._tmpDate.setHours(0,0,0,0);\nDwtCalendar.prototype._mouseOverListener=function(b){var c=b.target;\nif(c.id.charAt(0)==\"c\"){this._setClassName(c,DwtCalendar._HOVERED);\nif(this._mouseOverDayCB){DwtCalendar._tmpDate.setFullYear(c._year,c._month,c._day);\nthis._mouseOverDayCB.run(this,DwtCalendar._tmpDate)\n}}else{if(c.id.charAt(0)==\"t\"){return\n}else{if(c.id.charAt(0)==\"b\"){var a;\nif(c.firstChild==null){a=c;\nAjxImg.getParentElement(c).className=DwtCalendar._BUTTON_HOVERED_CLASS\n}else{c.className=DwtCalendar._BUTTON_HOVERED_CLASS;\na=AjxImg.getImageElement(c)\n}a.className=a._origClassName\n}}}b._stopPropagation=true\n};\nDwtCalendar.prototype._mouseOutListener=function(b){this.setToolTipContent(null);\nvar c=b.target;\nif(c.id.charAt(0)==\"c\"){this._setClassName(c,DwtCalendar._NORMAL);\nif(this._mouseOutDayCB){this._mouseOutDayCB.run(this)\n}}else{if(c.id.charAt(0)==\"b\"){var a;\nc.className=DwtCalendar._BUTTON_CLASS;\nif(c.firstChild==null){a=c;\nAjxImg.getParentElement(c).className=DwtCalendar._BUTTON_CLASS\n}else{c.className=DwtCalendar._BUTTON_CLASS;\na=AjxImg.getImageElement(c)\n}a.className=a._origClassName\n}}};\nDwtCalendar.prototype._mouseDownListener=function(b){if(b.button==DwtMouseEvent.LEFT){var c=b.target;\nif(c.id.charAt(0)==\"c\"){this._setClassName(c,DwtCalendar._ACTIVE)\n}else{if(c.id.charAt(0)==\"t\"){c.className=DwtCalendar._TITLE_ACTIVE_CLASS\n}else{if(c.id.charAt(0)==\"b\"){var a;\nif(c.firstChild==null){a=c;\nAjxImg.getParentElement(c).className=DwtCalendar._BUTTON_ACTIVE_CLASS\n}else{c.className=DwtCalendar._BUTTON_ACTIVE_CLASS;\na=AjxImg.getImageElement(c)\n}a.className=a._origClassName\n}else{if(c.id.charAt(0)==\"w\"){}}}}}};\nDwtCalendar.prototype._mouseUpListener=function(b){var d=b.target;\nif(b.button==DwtMouseEvent.LEFT){if(d.id.charAt(0)==\"c\"){if(this.parent instanceof DwtMenu){DwtMenu.closeActiveMenu()\n}var c=new Date(d._year,d._month,d._day);\nif(c.getDate()!=d._day){c.setDate(d._day)\n}if(this.setDate(c)){return\n}this._setClassName(d,DwtCalendar._HOVERED)\n}else{if(d.id.charAt(0)==\"b\"){var a;\nif(d.firstChild==null){a=d;\nAjxImg.getParentElement(d).className=DwtCalendar._BUTTON_HOVERED_CLASS\n}else{d.className=DwtCalendar._BUTTON_HOVERED_CLASS;\na=AjxImg.getImageElement(d)\n}a.className=a._origClassName;\nif(a.id.indexOf(\"py\")!=-1){this._prevYear()\n}else{if(a.id.indexOf(\"pm\")!=-1){this._prevMonth()\n}else{if(a.id.indexOf(\"nm\")!=-1){this._nextMonth()\n}else{this._nextYear()\n}}}}else{if(d.id.charAt(0)==\"t\"){d.className=DwtCalendar._TITLE_HOVERED_CLASS;\nthis.setDate(new Date(),this._skipNotifyOnPage);\nif(this.parent instanceof DwtMenu){DwtMenu.closeActiveMenu()\n}}}}}else{if(b.button==DwtMouseEvent.RIGHT&&d.id.charAt(0)==\"c\"){this._notifyListeners(DwtEvent.ACTION,0,new Date(d._year,d._month,d._day),b)\n}}};\nDwtCalendar.prototype._doubleClickListener=function(a){var b=a.target;\nif(this._selectionEvent){this._selectionEvent.type=DwtCalendar.DATE_DBL_CLICKED\n}if(b.id.charAt(0)==\"c\"){if(this.parent instanceof DwtMenu){DwtMenu.closeActiveMenu()\n}this.setDate(new Date(b._year,b._month,b._day),false,false,true)\n}};\nDwtCalendar.prototype._prevMonth=function(a){var b=new Date(this._date.getTime());\nthis.setDate(AjxDateUtil.roll(b,AjxDateUtil.MONTH,-1),this._skipNotifyOnPage)\n};\nDwtCalendar.prototype._nextMonth=function(a){var b=new Date(this._date.getTime());\nthis.setDate(AjxDateUtil.roll(b,AjxDateUtil.MONTH,1),this._skipNotifyOnPage)\n};\nDwtCalendar.prototype._prevYear=function(a){var b=new Date(this._date.getTime());\nthis.setDate(AjxDateUtil.roll(b,AjxDateUtil.YEAR,-1),this._skipNotifyOnPage)\n};\nDwtCalendar.prototype._nextYear=function(a){var b=new Date(this._date.getTime());\nthis.setDate(AjxDateUtil.roll(b,AjxDateUtil.YEAR,1),this._skipNotifyOnPage)\n};\nDwtCalendar.getDateFormatter=function(){if(!DwtCalendar._dateFormatter){DwtCalendar._dateFormatter=new AjxDateFormat(AjxMsg.formatCalDate)\n}return DwtCalendar._dateFormatter\n};\nDwtCalendar.getDateLongFormatter=function(){if(!DwtCalendar._dateLongFormatter){DwtCalendar._dateLongFormatter=new AjxDateFormat(AjxMsg.formatCalDateLong)\n}return DwtCalendar._dateLongFormatter\n};\nDwtCalendar.getDateFullFormatter=function(){if(!DwtCalendar._dateFullFormatter){DwtCalendar._dateFullFormatter=new AjxDateFormat(AjxMsg.formatCalDateFull)\n}return DwtCalendar._dateFullFormatter\n};\nDwtCalendar.getHourFormatter=function(){if(!DwtCalendar._hourFormatter){DwtCalendar._hourFormatter=new AjxMessageFormat(AjxMsg.formatCalHour)\n}return DwtCalendar._hourFormatter\n};\nDwtCalendar.getDayFormatter=function(){if(!DwtCalendar._dayFormatter){DwtCalendar._dayFormatter=new AjxDateFormat(AjxMsg.formatCalDay)\n}return DwtCalendar._dayFormatter\n};\nDwtCalendar.getMonthFormatter=function(){if(!DwtCalendar._monthFormatter){DwtCalendar._monthFormatter=new AjxDateFormat(AjxMsg.formatCalMonth)\n}return DwtCalendar._monthFormatter\n};\nDwtCalendar.getShortMonthFormatter=function(){if(!DwtCalendar._shortMonthFormatter){DwtCalendar._shortMonthFormatter=new AjxDateFormat(AjxMsg.formatShortCalMonth)\n}return DwtCalendar._shortMonthFormatter\n};\nDwtCalendar.prototype._dragEnter=function(a){};\nDwtCalendar.prototype._dragHover=function(a){};\nDwtCalendar.prototype._dragOver=function(a){var b=a.target;\nif(b.id.charAt(0)==\"c\"){this._setClassName(b,DwtCalendar._HOVERED);\nthis._lastDndCell=b\n}else{this._lastDndCell=null\n}};\nDwtCalendar.prototype._dragLeave=function(a){}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtPropertyPage\")){DwtPropertyPage=function(a){if(arguments.length==0){return\n}a=Dwt.getParams(arguments,DwtPropertyPage.PARAMS);\na.className=a.className||\"DwtPropertyPage\";\nDwtComposite.call(this,a);\nthis._fieldIds=new Object();\nthis._fildDivIds=new Object();\nthis._isDirty=false;\nthis._tabGroup=new DwtTabGroup(this.toString())\n};\nDwtPropertyPage.prototype=new DwtComposite;\nDwtPropertyPage.prototype.constructor=DwtPropertyPage;\nDwtPropertyPage.prototype.toString=function(){return\"DwtPropertyPage\"\n};\nDwtPropertyPage.PARAMS=DwtComposite.PARAMS;\nDwtPropertyPage.prototype.setDirty=function(a){this._isDirty=a\n};\nDwtPropertyPage.prototype.isDirty=function(){return this._isDirty\n};\nDwtPropertyPage.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nDwtPropertyPage.prototype._installOnKeyUpHandler=function(c,a){if(!c){return\n}var b=null;\nb=document.getElementById(this._fieldIds[c]);\nif(b){Dwt.setHandler(b,DwtEvent.ONKEYUP,a?a:this._onKeyUp);\nb._view=this;\nb._field=c\n}};\nDwtPropertyPage.prototype._installOnClickHandler=function(c,a){if(!c){return\n}var b=document.getElementById(this._fieldIds[c]);\nif(b){Dwt.setHandler(b,DwtEvent.ONCLICK,a?a:this._onClick);\nb._view=this;\nb._field=c\n}};\nDwtPropertyPage.prototype._onClick=function(a){this._view.setDirty(true);\nreturn true\n};\nDwtPropertyPage.prototype._onKeyUp=function(a){this._view.setDirty(true);\nreturn true\n};\nDwtPropertyPage.prototype._installOnChangeHandler=function(c,a){if(!c){return\n}var b=null;\nb=document.getElementById(this._fieldIds[c]);\nif(b){Dwt.setHandler(b,DwtEvent.ONCHANGE,a?a:this._onChange);\nb._view=this;\nb._field=c\n}};\nDwtPropertyPage._onChange=function(a){this._view.setDirty(true);\nreturn true\n};\nDwtPropertyPage.prototype._onChange2=function(a){this.setDirty(true);\nreturn true\n};\nDwtPropertyPage.prototype._addDwtSelectEntryRow=function(e,f,c,a,d){var b=\"30ex\";\nif(d){b=d\n}c[a++]=\"<tr valign='center'>\";\na=this._addDwtSelectEntryCell(e,f,c,a,b);\nc[a++]=\"</tr>\";\nreturn a\n};\nDwtPropertyPage.prototype._addDwtSelectEntryCell=function(c,d,b,a,f){var e=Dwt.getNextId();\nthis._fieldIds[c]=e;\nif(d){b[a++]=\"<td align='left' style='width:\"+f+\"'>\";\nb[a++]=AjxStringUtil.htmlEncode(d)+\":\";\nb[a++]=\"</td>\"\n}b[a++]=\"<td align='left'>\";\nb[a++]=\"<div id='\"+e+\"'></div></td>\";\nreturn a\n};\nDwtPropertyPage.prototype._addBoolEntryRow=function(c,d,b,a,e){b[a++]=\"<tr valign='center'>\";\na=this._addBoolEntryCell(c,d,b,a,e);\nb[a++]=\"</tr>\";\nreturn a\n};\nDwtPropertyPage.prototype._addBoolEntryCell=function(d,e,b,a,g){var f=Dwt.getNextId();\nthis._fieldIds[d]=f;\nvar c=\"20ex\";\nif(g){c=g\n}if(e){b[a++]=\"<td style='width:\"+c+\";' align='left'>\";\nb[a++]=AjxStringUtil.htmlEncode(e)+\":\";\nb[a++]=\"</td>\"\n}b[a++]=\"<td align='left'>\";\nb[a++]=\"<input type='checkbox' id='\"+f+\"'>\";\nb[a++]=\"</td>\";\nreturn a\n};\nDwtPropertyPage.prototype._addTextAreaEntryRow=function(d,e,b,a,g){var c=\"on\";\nif(g){c=\"off\"\n}var f=Dwt.getNextId();\nthis._fieldIds[d]=f;\nb[a++]=\"<tr valign='center'>\";\nb[a++]=\"<td align='left' style='width:60ex;'>\";\nb[a++]=AjxStringUtil.htmlEncode(e)+\":\";\nb[a++]=\"</td></tr>\";\nb[a++]=\"<tr valign='center'><td align='left' style='width:60ex;'><textarea wrap='\"+c+\"' rows='8' cols ='60' id='\";\nb[a++]=f;\nb[a++]=\"'/></textarea></td></tr>\";\nreturn a\n};\nDwtPropertyPage.prototype._addEntryRow=function(g,f,b,j,d,e,a,h,c){b[j++]=\"<tr valign='center'>\";\nj=this._addEntryCell(g,f,b,j,d,e,a,h,c);\nb[j++]=\"</tr>\";\nreturn j\n};\nDwtPropertyPage.prototype._addEntryCell=function(j,h,d,l,f,g,b,k,e){if(f==null){f=\"text\"\n}if(g==null){g=35\n}var c=\"20ex\";\nif(k){c=k\n}var a=Dwt.getNextId();\nthis._fieldIds[j]=a;\nif(h){d[l++]=\"<td align='left' style='width:\"+c+\";'>\";\nd[l++]=AjxStringUtil.htmlEncode(h)+\":\";\nd[l++]=\"</td>\"\n}d[l++]=\"<td \";\nif(e){d[l++]=\"class='redAsteric' \"\n}d[l++]=\"\talign='left'><input autocomplete='off' size='\"+g+\"' type='\"+f+\"' id='\";\nd[l++]=a;\nd[l++]=\"'\";\nif(e){d[l++]=\"/>*\"\n}else{d[l++]=\"/>&nbsp;\"\n}if(b!=null){d[l++]=b\n}d[l++]=\"</td>\";\nreturn l\n};\nDwtPropertyPage.prototype._createHTML=function(){}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtTabView\")){DwtTabView=function(b){if(arguments.length==0){return\n}b=Dwt.getParams(arguments,DwtListView.PARAMS);\nb.className=b.className||\"ZTabView\";\nb.posStyle=b.posStyle||DwtControl.ABSOLUTE_STYLE;\nDwtComposite.call(this,b);\nthis._stateChangeEv=new DwtEvent(true);\nthis._stateChangeEv.item=this;\nthis._tabs=[];\nthis._tabIx=1;\nthis._createHtml();\nvar a=[this.toString(),this._htmlElId].join(\" \");\nthis._tabGroup=new DwtTabGroup(a);\nthis._tabGroup.addMember(this._tabBar)\n};\nDwtTabView.PARAMS=[\"parent\",\"className\",\"posStyle\"];\nDwtTabView.prototype=new DwtComposite;\nDwtTabView.prototype.constructor=DwtTabView;\nDwtTabView.prototype.isDwtTabView=true;\nDwtTabView.prototype.toString=function(){return\"DwtTabView\"\n};\nDwtTabView.prototype.role=\"tablist\";\nDwtTabView.Z_ACTIVE_TAB=Dwt.Z_VIEW+10;\nDwtTabView.Z_HIDDEN_TAB=Dwt.Z_HIDDEN;\nDwtTabView.Z_TAB_PANEL=Dwt.Z_VIEW+20;\nDwtTabView.Z_CURTAIN=Dwt.Z_CURTAIN;\nDwtTabView.prototype.TEMPLATE=\"dwt.Widgets#ZTabView\";\nDwtTabView.prototype.addStateChangeListener=function(a){this._eventMgr.addListener(DwtEvent.STATE_CHANGE,a)\n};\nDwtTabView.prototype.removeStateChangeListener=function(a){this._eventMgr.removeListener(DwtEvent.STATE_CHANGE,a)\n};\nDwtTabView.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nDwtTabView.prototype.addTab=function(f,e,c,a){var d=this._tabIx++;\nthis._tabs[d]={title:f,button:this._tabBar.addButton(d,f,c,a)};\nthis.setTabView(d,e);\nif(d==1){var b=this.getTabView(d);\nif(b){e.showMe()\n}this._currentTabKey=d;\nthis.switchToTab(d)\n}else{if(e&&!(e instanceof AjxCallback)){e.hideMe();\nDwt.setVisible(e.getHtmlElement(),false)\n}}this._tabBar.addSelectionListener(d,new AjxListener(this,DwtTabView.prototype._tabButtonListener));\nreturn d\n};\nDwtTabView.prototype.enable=function(a){for(var c in this._tabs){var b=this._tabs[c].button;\nif(b){b.setEnabled(a)\n}}};\nDwtTabView.prototype.getCurrentTab=function(){return this._currentTabKey\n};\nDwtTabView.prototype.getNumTabs=function(){return(this._tabs.length-1)\n};\nDwtTabView.prototype.getTab=function(a){return(this._tabs&&this._tabs[a])?this._tabs[a]:null\n};\nDwtTabView.prototype.getTabBar=function(){return this._tabBar\n};\nDwtTabView.prototype.getTabTitle=function(a){return(this._tabs&&this._tabs[a])?this._tabs[a][\"title\"]:null\n};\nDwtTabView.prototype.getTabButton=function(a){return(this._tabs&&this._tabs[a])?this._tabs[a][\"button\"]:null\n};\nDwtTabView.prototype.setTabView=function(d,c){var b=this.getTab(d);\nb.view=c;\nif(c&&!(c instanceof AjxCallback)){this._pageEl.appendChild(c.getHtmlElement());\nc._tabKey=d;\nif(d==this._currentTabKey){var a=c.getTabGroupMember();\nthis._tabGroup.replaceMember(b.tabGroup,a);\nb.tabGroup=a\n}}};\nDwtTabView.prototype.getTabView=function(d){var c=this.getTab(d);\nvar b=c&&c.view;\nif(b instanceof AjxCallback){var e=b;\nb=e.run(d);\nthis.setTabView(d,b);\nvar a=this._getTabSize();\nb.setSize(a.x,a.y);\nb.setAttribute(\"aria-labelledby\",c.button.getHTMLElId())\n}return b\n};\nDwtTabView.prototype.switchToTab=function(c){var b=this.getTab(c);\nif(b){var a=this.getTab(this._currentTabKey);\nif(a){this._tabGroup.removeMember(a.tabGroup)\n}this._showTab(c);\nthis._tabBar.openTab(c);\nif(!b.tabGroup&&b.view){b.tabGroup=b.view.getTabGroupMember()\n}this._tabGroup.addMember(b.tabGroup);\nif(this._eventMgr.isListenerRegistered(DwtEvent.STATE_CHANGE)){this._eventMgr.notifyListeners(DwtEvent.STATE_CHANGE,this._stateChangeEv)\n}}};\nDwtTabView.prototype.setBounds=function(b,d,c,a){DwtComposite.prototype.setBounds.call(this,b,d,c,a);\nthis._resetTabSizes(c,a)\n};\nDwtTabView.prototype.getActiveView=function(){return this._tabs[this._currentTabKey].view\n};\nDwtTabView.prototype.getKeyMapName=function(){return DwtKeyMap.MAP_TAB_VIEW\n};\nDwtTabView.prototype.resetKeyBindings=function(){var b=this.shell.getKeyboardMgr();\nif(b.isEnabled()){var e=b.__keyMapMgr;\nif(!e){return\n}var d=this.getNumTabs();\nvar g=e.getKeySequences(DwtKeyMap.MAP_TAB_VIEW,\"GoToTab\");\nfor(var a=0;\na<g.length;\na++){var h=g[a];\nfor(var c=1;\nc<=d;\nc++){var f=48+c;\nvar j=h.replace(/NNN/,f);\ne.setMapping(DwtKeyMap.MAP_TAB_VIEW,j,\"GoToTab\"+c)\n}}e.reloadMap(DwtKeyMap.MAP_TAB_VIEW)\n}};\nDwtTabView.prototype.handleKeyAction=function(d){switch(d){case DwtKeyMap.NEXT_TAB:var c=this.getCurrentTab();\nif(c<this.getNumTabs()){this.switchToTab(c+1)\n}break;\ncase DwtKeyMap.PREV_TAB:var c=this.getCurrentTab();\nif(c>1){this.switchToTab(c-1)\n}break;\ndefault:var b=d.match(DwtKeyMap.GOTO_TAB_RE);\nif(b&&b.length){var a=b[1];\nif((a<=this.getNumTabs())&&(a!=this.getCurrentTab())){this.switchToTab(a)\n}}else{return false\n}}return true\n};\nDwtTabView.prototype._resetTabSizes=function(c,a){if(this._tabs&&this._tabs.length){for(var e in this._tabs){var b=this._tabs[e].view;\nif(b&&!(b instanceof AjxCallback)){var d;\nd=d||a-Dwt.getSize(this._tabBarEl).y;\nb.resetSize(c,d)\n}}}};\nDwtTabView.prototype._getTabSize=function(){var b=this.getSize();\nvar c=b.x||this.getHtmlElement().clientWidth;\nvar a=b.y||this.getHtmlElement().clientHeight;\nvar d=this._tabBar.getSize();\nvar e=d.y||this._tabBar.getHtmlElement().clientHeight;\nreturn new DwtPoint(c,(a-e))\n};\nDwtTabView.prototype._createHtml=function(a){this._createHtmlFromTemplate(a||this.TEMPLATE,{id:this._htmlElId})\n};\nDwtTabView.prototype._createHtmlFromTemplate=function(a,b){DwtComposite.prototype._createHtmlFromTemplate.call(this,a,b);\nthis._tabBarEl=document.getElementById(b.id+\"_tabbar\");\nthis._tabBar=new DwtTabBar(this);\nthis._tabBar.reparentHtmlElement(this._tabBarEl);\nthis._pageEl=document.getElementById(b.id+\"_page\")\n};\nDwtTabView.prototype._showTab=function(b){if(this._tabs&&this._tabs[b]){this._currentTabKey=b;\nthis._hideAllTabs();\nvar a=this.getTabView(b);\nif(a){a.setVisible(true);\na.showMe()\n}}};\nDwtTabView.prototype._hideAllTabs=function(){if(this._tabs&&this._tabs.length){for(var b in this._tabs){var a=this._tabs[b].view;\nif(a&&!(a instanceof AjxCallback)){a.hideMe();\nDwt.setVisible(a.getHtmlElement(),false)\n}}}};\nDwtTabView.prototype._tabButtonListener=function(a){this.switchToTab(a.item.getData(\"tabKey\"))\n};\nDwtTabViewPage=function(c,b,a,e){if(arguments.length==0){return\n}var d=Dwt.getParams(arguments,DwtTabViewPage.PARAMS);\nd.className=d.className||\"ZTabPage\";\nd.posStyle=d.posStyle||DwtControl.ABSOLUTE_STYLE;\nd.id=e||null;\nthis._rendered=true;\nDwtPropertyPage.call(this,d);\nthis._createHtml();\nthis.getHtmlElement().style.overflowY=\"auto\";\nthis.getHtmlElement().style.overflowX=\"visible\";\nif(d.contentTemplate){this.getContentHtmlElement().innerHTML=AjxTemplate.expand(d.contentTemplate,this._htmlElId)\n}};\nDwtTabViewPage.prototype=new DwtPropertyPage;\nDwtTabViewPage.prototype.constructor=DwtTabViewPage;\nDwtTabViewPage.prototype.isDwtTabViewPage=true;\nDwtTabViewPage.prototype.toString=function(){return\"DwtTabViewPage\"\n};\nDwtTabViewPage.prototype.role=\"tabpanel\";\nDwtTabViewPage.prototype.TEMPLATE=\"dwt.Widgets#ZTabPage\";\nDwtTabViewPage.PARAMS=DwtPropertyPage.PARAMS.concat(\"contentTemplate\");\nDwtTabViewPage.prototype.getContentHtmlElement=function(){return this._contentEl||this.getHtmlElement()\n};\nDwtTabViewPage.prototype.showMe=function(){this.setZIndex(DwtTabView.Z_ACTIVE_TAB);\nthis.setAttribute(\"aria-selected\",true);\nif(this.parent.getHtmlElement().offsetHeight>80){this._contentEl.style.height=this.parent.getHtmlElement().offsetHeight-80\n}else{var b=parseInt(this.parent.getHtmlElement().style.height);\nvar a=AjxStringUtil.getUnitsFromSizeString(this.parent.getHtmlElement().style.height);\nif(b>80){this._contentEl.style.height=(Number(b-80).toString()+a)\n}}this._contentEl.style.width=this.parent.getHtmlElement().style.width\n};\nDwtTabViewPage.prototype.hideMe=function(){this.setZIndex(DwtTabView.Z_HIDDEN_TAB);\nthis.setAttribute(\"aria-selected\",false)\n};\nDwtTabViewPage.prototype.resetSize=function(b,a){this.setSize(b,a)\n};\nDwtTabViewPage.prototype._createHtml=function(a){this._createHtmlFromTemplate(a||this.TEMPLATE,{id:this._htmlElId})\n};\nDwtTabViewPage.prototype._createHtmlFromTemplate=function(a,b){DwtPropertyPage.prototype._createHtmlFromTemplate.call(this,a,b);\nthis._contentEl=document.getElementById(b.id+\"_content\")||this.getHtmlElement()\n};\nDwtTabBar=function(c,b,d){if(arguments.length==0){return\n}this._buttons=[];\nthis._btnStyle=d||\"ZTab\";\nthis._btnImage=null;\nthis._currentTabKey=1;\nvar a=b||\"ZTabBar\";\nDwtToolBar.call(this,{parent:c,className:a,posStyle:DwtControl.STATIC_STYLE});\nif(AjxEnv.isFirefox){if(this._prefixEl&&this.constructor==DwtTabBar){this._prefixEl.style.cssFloat=\"none\"\n}}};\nDwtTabBar.prototype=new DwtToolBar;\nDwtTabBar.prototype.constructor=DwtTabBar;\nDwtTabBar.prototype.TEMPLATE=\"dwt.Widgets#ZTabBar\";\nDwtTabBar.prototype.toString=function(){return\"DwtTabBar\"\n};\nDwtTabBar.prototype.getCurrentTab=function(){return this._currentTabKey\n};\nDwtTabBar.prototype.addStateChangeListener=function(a){this._eventMgr.addListener(DwtEvent.STATE_CHANGE,a)\n};\nDwtTabBar.prototype.removeStateChangeListener=function(a){this._eventMgr.removeListener(DwtEvent.STATE_CHANGE,a)\n};\nDwtTabBar.prototype.addSelectionListener=function(b,a){this._buttons[b].addSelectionListener(a)\n};\nDwtTabBar.prototype.removeSelectionListener=function(b,a){this._buttons[b].removeSelectionListener(a)\n};\nDwtTabBar.prototype.addButton=function(g,f,h,d){var c=this._buttons[g]=new DwtTabButton(this,h,d);\nthis._buttons[g].addSelectionListener(new AjxListener(this,DwtTabBar._setActiveTab));\nif(this._btnImage!=null){c.setImage(this._btnImage)\n}if(f!=null){c.setText(f)\n}c.setEnabled(true);\nc.setData(\"tabKey\",g);\nif(parseInt(g)==1){this.openTab(g,true)\n}var a=this.__getButtonIndex(this._currentTabKey);\nif(a!=-1){var e=this.__getButtonIndex(g);\nif(e==a+1){Dwt.addClass(c.getHtmlElement(),DwtTabBar.SELECTED_NEXT)\n}}return c\n};\nDwtTabBar.prototype.getButton=function(a){return(this._buttons[a])?this._buttons[a]:null\n};\nDwtTabBar.prototype.openTab=function(a,e){this._currentTabKey=a;\nvar d=this._buttons.length;\nfor(var b=0;\nb<d;\nb++){if(b==a){continue\n}var c=this._buttons[b];\nif(c){this.__markPrevNext(b,false);\nc.setClosed()\n}}var c=this._buttons[a];\nif(c){c.setOpen();\nthis.__markPrevNext(a,true)\n}if(!e&&this._eventMgr.isListenerRegistered(DwtEvent.STATE_CHANGE)){this._eventMgr.notifyListeners(DwtEvent.STATE_CHANGE,this._stateChangeEv)\n}};\nDwtTabBar._setActiveTab=function(c){var a;\nif(c&&c.item){a=c.item.getData(\"tabKey\")\n}else{if(c&&c.target){var b=c.target;\nwhile(b.tagName!=\"TABLE\"&&b.offsetParent){b=b.offsetParent\n}a=b.getAttribute(\"tabKey\");\nif(a==null){return false\n}}else{return false\n}}this.openTab(a)\n};\nDwtTabButton=function(d,e,b,c){if(arguments.length==0){return\n}var a=c||\"ZTab\";\nDwtButton.call(this,{parent:d,className:a,id:e,index:b})\n};\nDwtTabButton.prototype=new DwtButton;\nDwtTabButton.prototype.constructor=DwtTabButton;\nDwtTabButton.prototype.TEMPLATE=\"dwt.Widgets#ZTab\";\nDwtTabButton.prototype.isDwtTabButton=true;\nDwtTabButton.prototype.toString=function(){return\"DwtTabButton\"\n};\nDwtTabButton.prototype.role=\"tab\";\nDwtTabButton.prototype.setOpen=function(){this._isSelected=true;\nthis.setDisplayState(DwtControl.SELECTED)\n};\nDwtTabButton.prototype.setClosed=function(){this._isSelected=false;\nthis.setDisplayState(DwtControl.NORMAL)\n};\nDwtTabButton.prototype.setDisplayState=function(a){if(this._isSelected&&a!=DwtControl.SELECTED){a=[DwtControl.SELECTED,a].join(\" \")\n}DwtButton.prototype.setDisplayState.call(this,a)\n};\nDwtTabBarFloat=function(b,a,c){if(arguments.length==0){return\n}DwtTabBar.call(this,b,a,c)\n};\nDwtTabBarFloat.prototype=new DwtTabBar;\nDwtTabBarFloat.prototype.constructor=DwtTabBarFloat;\nDwtTabBarFloat.prototype.TEMPLATE=\"dwt.Widgets#ZTabBarFloat\";\nDwtTabBarFloat.prototype.addButton=function(f,e,g){var c=this._buttons[f]=new DwtTabButtonFloat(this,g);\nthis._buttons[f].addSelectionListener(new AjxListener(this,DwtTabBar._setActiveTab));\nif(this._btnImage!=null){c.setImage(this._btnImage)\n}if(e!=null){c.setText(e)\n}c.setEnabled(true);\nc.setData(\"tabKey\",f);\nif(parseInt(f)==1){this.openTab(f,true)\n}var a=this.__getButtonIndex(this._currentTabKey);\nif(a!=-1){var d=this.__getButtonIndex(f);\nif(d==a+1){Dwt.addClass(c.getHtmlElement(),DwtTabBar.SELECTED_NEXT)\n}}return c\n};\nDwtTabButtonFloat=function(a,b){DwtTabButton.call(this,a,b,undefined,\"ZTab\")\n};\nDwtTabButtonFloat.prototype=new DwtTabButton;\nDwtTabButtonFloat.prototype.constructor=DwtTabButtonFloat;\nDwtTabButtonFloat.prototype.TEMPLATE=\"dwt.Widgets#ZTabFloat\"\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtSelect\")){DwtSelect=function(d){if(arguments.length==0){return\n}d=Dwt.getParams(arguments,DwtSelect.PARAMS);\nd.className=d.className||\"ZSelect\";\nd.posStyle=d.posStyle||Dwt.STATIC_STYLE;\nthis._legendId=d.legendId;\nDwtButton.call(this,d);\nvar c=AjxEnv.isIE?[DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP]:[DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP,DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT];\nthis._setEventHdlrs(c);\nthis._hasSetMouseEvents=true;\nthis._currentSelectedOption=null;\nthis._options=new AjxVector();\nthis._optionValuesToIndices={};\nthis._selectedValue=this._selectedOption=null;\nthis._maxRows=d.maxRows||0;\nthis._layout=d.layout;\nthis._congruent=d.congruent;\nthis._hrCount=0;\nvar a=d.options;\nif(a){for(var b=0;\nb<a.length;\n++b){this.addOption(a[b])\n}}this.setDropDownImages(\"SelectPullDownArrow\",\"SelectPullDownArrowDis\",\"SelectPullDownArrow\",\"SelectPullDownArrow\");\nthis._menuCallback=new AjxListener(this,this._createMenu);\nthis.setMenu(this._menuCallback,true)\n};\nDwtSelect.PARAMS=[\"parent\",\"options\",\"style\",\"className\",\"layout\"];\nDwtSelect.prototype=new DwtButton;\nDwtSelect.prototype.constructor=DwtSelect;\nDwtSelect.prototype.isDwtSelect=true;\nDwtSelect.prototype.toString=function(){return\"DwtSelect\"\n};\nDwtSelect.prototype.role=\"combobox\";\nDwtSelect._CONTAINER_TEMPLATE=\"dwt.Widgets#ZSelectAutoSizingContainer\";\nDwtSelect._objectIds=[null];\nDwtSelect.prototype.TEMPLATE=\"dwt.Widgets#ZSelect\";\nDwtSelect.getObjectFromElement=function(a){return a&&a.dwtObj?AjxCore.objectWithId(a.dwtObj):null\n};\nDwtSelect.prototype.addOption=function(f,e,g,d){if(!f){return -1\n}d=d||null;\nvar b=null;\nvar c=null;\nvar a=null;\nif(typeof(f)==\"string\"){c=g!=null?g:f;\nb=new DwtSelectOption(c,e,f,this,null,d)\n}else{if(f instanceof DwtSelectOption){b=f;\nif(g){b.setValue(g)\n}e=b.isSelected()\n}else{if(f instanceof DwtSelectOptionData||f.value!=null){c=g!=null?g:f.value;\nb=new DwtSelectOption(c,f.isSelected,f.displayValue,this,null,f.image,f.selectedValue,false,f.extraData,f.id);\ne=Boolean(f.isSelected);\na=f.id\n}else{return -1\n}}}this._options.add(b);\nif(this._options.size()==1||e){this._setSelectedOption(b)\n}var j=this._pseudoItemsEl;\nvar k=j.insertRow(-1);\nvar h=k.insertCell(-1);\nh.className=\"ZSelectPseudoItem\";\nh.innerHTML=[\"<div class='ZWidgetTitle'>\",AjxStringUtil.htmlEncode(b.getDisplayValue()),\"</div>\"].join(\"\");\nthis.fixedButtonWidth();\nthis.setMenu(this._menuCallback,true);\nthis._optionValuesToIndices[b.getValue()]=this._options.size()-1;\nreturn(this._options.size()-1)\n};\nDwtSelect.prototype.addHR=function(){opt=new DwtSelectOption(\"hr\"+this._hrCount.toString(),false,\"\",this,null,null,null,true);\nthis._hrCount++;\nthis._options.add(opt)\n};\nDwtSelect.prototype.removeOption=function(d){if(!d){return -1\n}this.setMenu(this._menuCallback,true);\nthis._options.remove(d);\nvar c=this._options.size();\nvar e=d.getValue();\nvar a=this._optionValuesToIndices[e];\nif(a!=null){this._pseudoItemsEl.deleteRow(a);\nif(this._selectedOption==d){if(c>0){var f=(a>=c)?c-1:a;\nthis._setSelectedOption(this._options.get(f))\n}this.removeAttribute(\"aria-activedescendant\")\n}this.fixedButtonWidth()\n}delete this._optionValuesToIndices[e];\nfor(var b=a;\nb<c;\nb++){var d=this._options.get(b);\nthis._optionValuesToIndices[d.getValue()]=b\n}return a\n};\nDwtSelect.prototype.removeOptionWithValue=function(b){var a=this.getOptionWithValue(b);\nreturn a?this.removeOption(a):-1\n};\nDwtSelect.prototype.popup=function(){var f=this.getMenu();\nif(!f){return\n}var d=this._selectEl;\nvar b=Dwt.getBounds(d);\nvar e=(d.style.borderLeftWidth==\"\")?0:parseInt(d.style.borderLeftWidth);\nvar h=(d.style.borderTopWidth==\"\")?0:parseInt(d.style.borderTopWidth);\nh+=(d.style.borderBottomWidth==\"\")?0:parseInt(d.style.borderBottomWidth);\nvar c=Dwt.toWindow(d,0,0);\nvar a=c.x+e;\nvar g=c.y+b.height+h;\nf.popup(0,a,g);\nif(this._currentSelectedOption){f.setSelectedItem(this._currentSelectedOption.getItem())\n}};\nDwtSelect.prototype.rename=function(b,c){var a=this.getOptionWithValue(b);\nif(!a){return\n}a._displayValue=c;\nif(this._selectedOption&&(this._selectedOption._value==b)){this.setText(AjxStringUtil.htmlEncode(c))\n}this.setMenu(this._menuCallback,true)\n};\nDwtSelect.prototype.enableOption=function(d,a){var b=this.getOptionWithValue(d);\nif(!b){return\n}if(b.enabled!=a){b.enabled=a;\nvar c=b.getItem();\nif(c){c.setEnabled(a)\n}}};\nDwtSelect.prototype.clearOptions=function(){var b=this._options.getArray();\nfor(var a=0;\na<b.length;\n++a){b[a]=null\n}this._options.removeAll();\nthis._optionValuesToIndices=null;\nthis._optionValuesToIndices=[];\nthis._selectedValue=null;\nthis._selectedOption=null;\nthis._currentSelectedOption=null;\nif(this._pseudoItemsEl){try{this._pseudoItemsEl.innerHTML=\"\"\n}catch(c){}}};\nDwtSelect.prototype.setName=function(a){this._name=a\n};\nDwtSelect.prototype.getName=function(){return this._name\n};\nDwtSelect.prototype.setSelectedValue=function(b){var a=this._optionValuesToIndices[b];\nif(a!=null){this.setSelected(a)\n}};\nDwtSelect.prototype.setSelected=function(a){var b=this.getOptionWithHandle(a);\nthis.setSelectedOption(b)\n};\nDwtSelect.prototype.getOptionCount=function(){return this._options.size()\n};\nDwtSelect.prototype.getOptions=function(){return this._options\n};\nDwtSelect.prototype.getOptionWithHandle=function(a){return this._options.get(a)\n};\nDwtSelect.prototype.getOptionAtIndex=DwtSelect.prototype.getOptionWithHandle;\nDwtSelect.prototype.getIndexForValue=function(a){return this._optionValuesToIndices[a]\n};\nDwtSelect.prototype.getOptionWithValue=function(c){var a=this._optionValuesToIndices[c];\nvar b=null;\nif(a!=null){b=this.getOptionWithHandle(a)\n}return b\n};\nDwtSelect.prototype.setSelectedOption=function(a){if(a){this._setSelectedOption(a)\n}};\nDwtSelect.prototype.getValue=function(){return this._selectedValue\n};\nDwtSelect.prototype.getSelectedOption=function(){return this._selectedOption\n};\nDwtSelect.prototype.getSelectedIndex=function(){return this.getIndexForValue(this.getValue())\n};\nDwtSelect.prototype.addChangeListener=function(a){this.addListener(DwtEvent.ONCHANGE,a)\n};\nDwtSelect.prototype.size=function(){return this._options.size()\n};\nDwtSelect.prototype.disable=function(){this.setEnabled(false)\n};\nDwtSelect.prototype.enable=function(){this.setEnabled(true)\n};\nDwtSelect.prototype.setImage=function(a){DwtLabel.prototype.setImage.call(this,a)\n};\nDwtSelect.prototype.setText=function(a){DwtLabel.prototype.setText.call(this,a)\n};\nDwtSelect.prototype.dispose=function(){this._selectEl=null;\nif(this._pseudoItemsEl){this._pseudoItemsEl.outerHTML=\"\";\nthis._pseudoItemsEl=null\n}this._containerEl=null;\nDwtButton.prototype.dispose.call(this);\nif(this._internalObjectId){DwtSelect._unassignId(this._internalObjectId)\n}};\nDwtSelect._assignId=function(a){var b=DwtSelect._objectIds.length;\nDwtSelect._objectIds[b]=a;\nreturn b\n};\nDwtSelect._getObjectWithId=function(a){return DwtSelect._objectIds[a]\n};\nDwtSelect._unassignId=function(a){DwtSelect._objectIds[a]=null\n};\nDwtSelect.prototype.dynamicButtonWidth=function(){this._isDynamicButtonWidth=true;\nthis._selectEl.style.width=\"auto\";\nthis._pseudoItemsEl.style.display=\"none\"\n};\nDwtSelect.prototype.fixedButtonWidth=function(){if(this._isDynamicButtonWidth){return\n}this._pseudoItemsEl.style.display=\"block\";\nvar b=this._selectEl;\nvar a=b.offsetWidth;\nif(a){b.style.width=a+\"px\"\n}this._pseudoItemsEl.style.display=\"none\"\n};\nDwtSelect.prototype._createHtmlFromTemplate=function(c,e){var b=DwtSelect._CONTAINER_TEMPLATE;\nvar a={id:e.id,selectTemplateId:c||this.TEMPLATE,selectData:e};\nDwtButton.prototype._createHtmlFromTemplate.call(this,b,a);\nthis._selectEl=document.getElementById(e.id+\"_select_container\");\nthis._pseudoItemsEl=document.getElementById(e.id+\"_pseudoitems_container\");\nthis._pseudoItemsEl.style.display=\"block\";\nvar d=this._containerEl=this.getHtmlElement();\nthis._selectEl.className=d.className;\nDwt.addClass(d,\"ZSelectAutoSizingContainer\");\nthis.removeAttribute(\"style\");\nif(this._legendId){this.setAttribute(\"aria-labelledby\",[this._legendId,this._textEl.id].join(\" \"))\n}};\nDwtSelect.prototype._createMenu=function(){var h=new DwtSelectMenu(this);\nvar c;\nfor(var d=0,b=this._options.size();\nd<b;\n++d){var e=this._options.get(d);\nif(e._hr){c=new DwtMenuItem({parent:h,style:DwtMenuItem.SEPARATOR_STYLE});\nc.setEnabled(false)\n}else{var c=new DwtSelectMenuItem(h,e.id||Dwt.getNextId(h._htmlElId+\"_option_\"));\nvar f=e.getImage();\nif(f){c.setImage(f)\n}var g=e.getDisplayValue();\nif(g){c.setText(AjxStringUtil.htmlEncode(g))\n}c.setEnabled(e.enabled);\nc.addSelectionListener(new AjxListener(this,this._handleOptionSelection));\nc._optionIndex=d\n}c._optionIndex=d;\ne.setItem(c)\n}var a=this;\nh.addPopupListener(function(){a.setAttribute(\"aria-expanded\",true)\n});\nh.addPopdownListener(function(){a.setAttribute(\"aria-expanded\",false);\na.removeAttribute(\"aria-activedescendant\")\n});\nreturn h\n};\nDwtSelect.prototype._handleOptionSelection=function(g){var d=g.item;\nvar f=d._optionIndex;\nvar c=this._options.get(f);\nvar b=this.getValue();\nthis._setSelectedOption(c);\nvar a=new Object();\na.selectObj=this;\na.newValue=c.getValue();\na.oldValue=b;\nvar e=DwtUiEvent.getEvent(g);\ne._args=a;\nthis.notifyListeners(DwtEvent.ONCHANGE,e)\n};\nDwtSelect.prototype._setSelectedOption=function(b){var a=b.getSelectedValue()||b.getDisplayValue();\nvar c=b.getImage();\nif(this._selectedOption!=b){if(a){this.setText(AjxStringUtil.htmlEncode(a))\n}this.setImage(c);\nthis._selectedValue=b._value;\nthis._selectedOption=b\n}this._updateSelection(b);\nthis.autoResize()\n};\nDwtSelect.prototype.autoResize=function(){var a=this.getHtmlElement();\nAjxTimedAction.scheduleAction(new AjxTimedAction(this,function(){var b=document.getElementById(a.id);\nif(b){b.style.width=b.childNodes[0].offsetWidth||\"auto\"\n}},200))\n};\nDwtSelect.prototype._updateSelection=function(a){var c=this._currentSelectedOption;\nif(c){c.deSelect()\n}this._currentSelectedOption=a;\nif(!a){return\n}a.select();\nvar b=this.getMenu(true);\nif(!b){return\n}b.setSelectedItem(a.getItem())\n};\nDwtSelect.prototype.updateRendering=function(){var a=this.getScrollStyle();\nthis.setScrollStyle(a==Dwt.VISIBLE?Dwt.CLIP:Dwt.VISIBLE);\nvar b=function(){try{this.setScrollStyle(a)\n}catch(d){}};\nvar c=new AjxTimedAction(this,b);\nAjxTimedAction.scheduleAction(c,4)\n};\nDwtSelect.prototype._menuAdded=function(a){this.setAttribute(\"aria-owns\",a._htmlElId)\n};\nDwtSelect.prototype._menuItemSelected=function(a){this.setAttribute(\"aria-activedescendant\",a._htmlElId)\n};\nDwtSelectOptionData=function(e,c,a,b,f,g,d){if(e==null||c==null){return null\n}this.value=e;\nthis.displayValue=c;\nthis.isSelected=a;\nthis.selectedValue=b;\nthis.image=f;\nthis.extraData=d;\nthis.id=g||Dwt.getNextId()\n};\nDwtSelectOption=function(j,e,h,b,g,d,f,k,c,a){this._value=j;\nthis._selected=e;\nthis._displayValue=h;\nthis._image=d;\nthis._selectedValue=f;\nthis._hr=k;\nthis._extraData=c;\nthis.id=a;\nthis._internalObjectId=DwtSelect._assignId(this);\nthis.enabled=true\n};\nDwtSelectOption.prototype.toString=function(){return\"DwtSelectOption\"\n};\nDwtSelectOption.prototype.setItem=function(a){this._menuItem=a\n};\nDwtSelectOption.prototype.getItem=function(a){return this._menuItem\n};\nDwtSelectOption.prototype.getDisplayValue=function(){return this._displayValue\n};\nDwtSelectOption.prototype.getImage=function(){return this._image\n};\nDwtSelectOption.prototype.getSelectedValue=function(){return this._selectedValue\n};\nDwtSelectOption.prototype.getValue=function(){return this._value\n};\nDwtSelectOption.prototype.setValue=function(a){this._value=a\n};\nDwtSelectOption.prototype.select=function(){this._selected=true\n};\nDwtSelectOption.prototype.deSelect=function(){this._selected=false\n};\nDwtSelectOption.prototype.isSelected=function(){return this._selected\n};\nDwtSelectOption.prototype.getIdentifier=function(){return this._internalObjectId\n};\nDwtSelectOption.prototype.getExtraData=function(a){return this._extraData&&this._extraData[a]\n};\nDwtSelectMenu=function(a){DwtMenu.call(this,{parent:a,style:DwtMenu.DROPDOWN_STYLE,className:\"DwtMenu\",layout:a._layout,maxRows:a._maxRows,congruent:a._congruent,id:Dwt.getNextId(a.getHTMLElId()+\"_Menu_\")})\n};\nDwtSelectMenu.prototype=new DwtMenu;\nDwtSelectMenu.prototype.constructor=DwtSelectMenu;\nDwtSelectMenu.prototype.TEMPLATE=\"dwt.Widgets#ZSelectMenu\";\nDwtSelectMenu.prototype.toString=function(){return\"DwtSelectMenu\"\n};\nDwtSelectMenuItem=function(a,b){DwtMenuItem.call(this,{parent:a,style:DwtMenuItem.SELECT_STYLE,className:\"ZSelectMenuItem\",id:b})\n};\nDwtSelectMenuItem.prototype=new DwtMenuItem;\nDwtSelectMenuItem.prototype.constructor=DwtSelectMenuItem;\nDwtSelectMenuItem.prototype.TEMPLATE=\"dwt.Widgets#ZSelectMenuItem\";\nDwtSelectMenuItem.prototype.isDwtSelectMenuItem=true;\nDwtSelectMenuItem.prototype.toString=function(){return\"DwtSelectMenuItem\"\n};\nDwtSelectMenuItem.prototype.role=\"option\";\nDwtLabel.prototype._textSet=function(a){}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtAlert\")){DwtAlert=function(c,b,a){if(arguments.length==0){return\n}b=b||\"DwtAlert\";\na=a||DwtControl.STATIC_STYLE;\nDwtControl.call(this,{parent:c,className:b,posStyle:a});\nthis._alertStyle=DwtAlert.INFORMATION;\nthis._createHtml()\n};\nDwtAlert.prototype=new DwtControl;\nDwtAlert.prototype.constructor=DwtAlert;\nDwtAlert.INFORMATION=0;\nDwtAlert.WARNING=1;\nDwtAlert.CRITICAL=2;\nDwtAlert.SUCCESS=3;\nDwtAlert._ICONS=[AjxImg.getClassForImage(\"Information_32\"),AjxImg.getClassForImage(\"Warning_32\"),AjxImg.getClassForImage(\"Critical_32\"),AjxImg.getClassForImage(\"Success\")];\nDwtAlert._CLASSES=[\"DwtAlertInfo\",\"DwtAlertWarn\",\"DwtAlertCrit\",\"DwtAlertWarn\"];\nDwtAlert._RE_ICONS=new RegExp(DwtAlert._ICONS.join(\"|\"));\nDwtAlert._RE_CLASSES=new RegExp(DwtAlert._CLASSES.join(\"|\"));\nDwtAlert.prototype.TEMPLATE=\"dwt.Widgets#DwtAlert\";\nDwtAlert.prototype.setStyle=function(a){this._alertStyle=a||DwtAlert.INFORMATION;\nif(this._iconDiv){Dwt.delClass(this._iconDiv,DwtAlert._RE_ICONS,DwtAlert._ICONS[this._alertStyle])\n}Dwt.delClass(this.getHtmlElement(),DwtAlert._RE_CLASSES,DwtAlert._CLASSES[this._alertStyle])\n};\nDwtAlert.prototype.getStyle=function(){return this._alertStyle\n};\nDwtAlert.prototype.setIconVisible=function(a){if(this._iconDiv){Dwt.setVisible(this._iconDiv,a)\n}};\nDwtAlert.prototype.getIconVisible=function(){return this._iconDiv?Dwt.getVisible(this._iconDiv):false\n};\nDwtAlert.prototype.setTitle=function(a){this._alertTitle=a;\nif(this._titleDiv){this._titleDiv.innerHTML=a||\"\"\n}};\nDwtAlert.prototype.getTitle=function(){return this._alertTitle\n};\nDwtAlert.prototype.setContent=function(a){this._alertContent=a;\nif(this._contentDiv){this._contentDiv.innerHTML=a||\"\"\n}};\nDwtAlert.prototype.getContent=function(){return this._alertContent\n};\nDwtAlert.prototype.setDismissContent=function(a){if(this._dismissDiv){a.reparentHtmlElement(this._dismissDiv.id)\n}};\nDwtAlert.prototype.getTabGroupMember=function(){return null\n};\nDwtAlert.prototype._createHtml=function(a){var b={id:this._htmlElId};\nthis._createHtmlFromTemplate(a||this.TEMPLATE,b)\n};\nDwtAlert.prototype._createHtmlFromTemplate=function(a,b){DwtControl.prototype._createHtmlFromTemplate.apply(this,arguments);\nthis._iconDiv=document.getElementById(b.id+\"_icon\");\nthis._titleDiv=document.getElementById(b.id+\"_title\");\nthis._contentDiv=document.getElementById(b.id+\"_content\");\nthis._dismissDiv=document.getElementById(b.id+\"_dismiss\")\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtPropertySheet\")){DwtPropertySheet=function(e,d,c,a){if(arguments.length==0){return\n}d=d||\"DwtPropertySheet\";\nDwtComposite.call(this,{parent:e,className:d,posStyle:c});\nthis._labelSide=a||DwtPropertySheet.DEFAULT;\nthis._propertyIdCount=0;\nthis._propertyList=[];\nthis._propertyMap={};\nthis._tabGroup=new DwtTabGroup(this.toString());\nthis._tableEl=document.createElement(\"TABLE\");\nthis._tableEl.cellSpacing=6;\nvar b=this.getHtmlElement();\nb.appendChild(this._tableEl);\nthis._setAllowSelection()\n};\nDwtPropertySheet.prototype=new DwtComposite;\nDwtPropertySheet.prototype.constructor=DwtPropertySheet;\nDwtPropertySheet.prototype.toString=function(){return\"DwtPropertySheet\"\n};\nDwtPropertySheet.RIGHT=\"right\";\nDwtPropertySheet.LEFT=\"left\";\nDwtPropertySheet.DEFAULT=DwtPropertySheet.LEFT;\nDwtPropertySheet.prototype._labelCssClass=\"Label\";\nDwtPropertySheet.prototype._valueCssClass=\"Field\";\nDwtPropertySheet.prototype.addProperty=function(g,h,f){var e=this._tableEl.rows.length;\nvar k=this._tableEl.insertRow(-1);\nk.vAlign=this._vAlign?this._vAlign:\"top\";\nvar a=Dwt.getNextId(),c=Dwt.getNextId(),d;\nif(this._labelSide==DwtPropertySheet.LEFT){this._insertLabel(k,g,f,a,c);\nd=this._insertValue(k,h,f,a,c)\n}else{this._insertValue(k,h,f,a,c);\nd=this._insertLabel(k,g,f,a,c)\n}var b=this._propertyIdCount++;\nvar j={id:b,index:e,row:k,visible:true,labelId:a,valueId:c,tabValue:d};\nthis._propertyList.push(j);\nthis._propertyMap[b]=j;\nreturn b\n};\nDwtPropertySheet.prototype._insertLabel=function(g,b,f,e,a){var d=g.insertCell(-1);\nd.className=this._labelCssClass;\nd.id=e;\nd.setAttribute(\"for\",a);\nif(this._labelSide!=DwtPropertySheet.LEFT){d.width=\"100%\";\nd.style.textAlign=\"left\"\n}d.innerHTML=b;\nif(f){var c=this._tableEl.ownerDocument.createElement(\"SUP\");\nc.innerHTML=\"*\";\nd.insertBefore(c,d.firstChild)\n}};\nDwtPropertySheet.prototype._insertValue=function(g,d,f,e,a){var c=g.insertCell(-1);\nc.className=this._valueCssClass;\nc.id=a;\nif(!d){c.innerHTML=\"&nbsp;\"\n}else{if(d.isDwtControl){c.appendChild(d.getHtmlElement());\nthis._tabGroup.addMember(d);\nvar b=d.getInputElement&&d.getInputElement();\nif(b){b.setAttribute(\"aria-labelledby\",e)\n}}else{if(d.nodeType==AjxUtil.ELEMENT_NODE){c.appendChild(d);\nthis._addTabGroupMemberEl(c);\nd.setAttribute(\"aria-labelledby\",e)\n}else{c.innerHTML=String(d);\nthis._addTabGroupMemberEl(c);\nc.setAttribute(\"aria-labelledby\",e);\nd=c\n}}}return d\n};\nDwtPropertySheet.prototype._addTabGroupMemberEl=function(c,b){var d=this;\nfunction a(e){if(e.children.length>0){AjxUtil.foreach(e.children,function(f){a(f)\n})\n}else{if(AjxUtil.isBoolean(b)){d.noTab=!b\n}else{d._makeFocusable(e);\nd._tabGroup.addMember(e)\n}}}a(c,b)\n};\nDwtPropertySheet.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nDwtPropertySheet.prototype.getProperty=function(a){return this._propertyMap[a]\n};\nDwtPropertySheet.prototype.removeProperty=function(f){var e=this._propertyMap[f];\nif(e){var b=e.index;\nif(e.visible){var d=this.__getTableIndex(b);\nvar c=this._tableEl.rows[d];\nc.parentNode.removeChild(c)\n}e.row=null;\nfor(var a=b+1;\na<this._propertyList.length;\na++){this._propertyList[a].index--\n}this._propertyList.splice(b,1);\ndelete this._propertyMap[f]\n}};\nDwtPropertySheet.prototype.setPropertyVisible=function(d,b){var c=this._propertyMap[d];\nif(c&&c.visible!==b){c.visible=b;\nDwt.setVisible(this._tableEl.rows[c.index],b);\nvar a=c.tabValue;\nif(a.isDwtControl){a.noTab=!b\n}else{this._addTabGroupMemberEl(a,!b)\n}}}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtGrouper\")){DwtGrouper=function(d,c,b){if(arguments.length==0){return\n}c=c||\"DwtGrouper\";\nb=b||DwtControl.STATIC_STYLE;\nDwtComposite.call(this,{parent:d,posStyle:b});\nthis._labelEl=document.createElement(\"LEGEND\");\nthis._labelEl.id=Dwt.getNextId();\nthis._insetEl=document.createElement(\"DIV\");\nthis._borderEl=document.createElement(\"FIELDSET\");\nthis._borderEl.appendChild(this._labelEl);\nthis._borderEl.appendChild(this._insetEl);\nthis._tabGroup=new DwtTabGroup(this.toString());\nvar a=this.getHtmlElement();\na.appendChild(this._borderEl)\n};\nDwtGrouper.prototype=new DwtComposite;\nDwtGrouper.prototype.constructor=DwtGrouper;\nDwtGrouper.prototype.setLabel=function(a){Dwt.setVisible(this._labelEl,Boolean(a));\nthis._labelEl.style.display=\"\";\nthis._labelEl.innerHTML=a?a:\"\"\n};\nDwtGrouper.prototype.setContent=function(d){var b=this._insetEl;\nb.innerHTML=d;\nvar c=b.getElementsByTagName(\"input\");\nfor(var a=0;\na<c.length;\na++){this._tabGroup.addMember(c[a])\n}};\nDwtGrouper.prototype.setElement=function(b){var a=this._insetEl;\nDwt.removeChildren(a);\na.appendChild(b)\n};\nDwtGrouper.prototype.setView=function(a){this.setElement(a.getHtmlElement())\n};\nDwtGrouper.prototype.getInsetHtmlElement=function(){return this._insetEl\n};\nDwtGrouper.prototype.getTabGroupMember=function(){return this._tabGroup\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtProgressBar\")){DwtProgressBar=function(c,b,a){if(arguments.length==0){return\n}a=a||DwtControl.STATIC_STYLE;\nDwtComposite.call(this,{parent:c,posStyle:a});\nthis._maxValue=100;\nthis._value=0;\nthis._quotabarDiv=null;\nthis._quotausedDiv=null;\nthis._progressBgColor=null;\nthis._progressCssClass=\"quotaused\";\nthis._wholeBgColor=null;\nthis._wholeCssClass=\"quotabar\";\nthis._createHTML()\n};\nDwtProgressBar.prototype=new DwtComposite;\nDwtProgressBar.prototype.constructor=DwtProgressBar;\nDwtProgressBar.prototype.setProgressBgColor=function(a){this._progressBgColor=a\n};\nDwtProgressBar.prototype.setWholeBgColor=function(a){this._wholeBgColor=a\n};\nDwtProgressBar.prototype.setProgressCssClass=function(a){this._progressCssClass=a\n};\nDwtProgressBar.prototype.setWholeCssClass=function(a){this._wholeCssClass=a\n};\nDwtProgressBar.prototype.setProgressCssStyle=function(a){this._progressCssStyle=a\n};\nDwtProgressBar.prototype.setWholeCssStyle=function(a){this._wholeCssStyle=a\n};\nDwtProgressBar.prototype.setValue=function(b){this._value=parseInt(b);\nvar a;\nif(this._value==this._maxValue){a=100\n}else{a=Math.min(Math.round((this._value/this._maxValue)*100),100)\n}if(isNaN(a)){a=\"0\"\n}if(!this._quotabarDiv){this._quotabarDiv=document.createElement(\"div\");\nif(this._wholeCssClass){this._quotabarDiv.className=this._wholeCssClass\n}if(this._wholeBgColor){this._quotabarDiv.backgroundColor=this._wholeBgColor\n}this._cell.appendChild(this._quotabarDiv)\n}if(!this._quotausedDiv){this._quotausedDiv=document.createElement(\"div\");\nif(this._progressCssClass){this._quotausedDiv.className=this._progressCssClass\n}if(this._progressBgColor){this._quotausedDiv.style.backgroundColor=this._progressBgColor\n}this._quotabarDiv.appendChild(this._quotausedDiv)\n}this._quotausedDiv.style.width=a+\"%\"\n};\nDwtProgressBar.prototype.setValueByPercent=function(a){this.setMaxValue(100);\nthis.setValue(a.replace(/\\%/gi,\"\"))\n};\nDwtProgressBar.prototype.getValue=function(){return this._value\n};\nDwtProgressBar.prototype.getMaxValue=function(){return this._maxValue\n};\nDwtProgressBar.prototype.setMaxValue=function(a){this._maxValue=parseInt(a)\n};\nDwtProgressBar.prototype.setLabel=function(e,b){var c=document.createTextNode(e);\nvar a=b?-1:0;\nvar d=this._row.insertCell(a);\nd.appendChild(c)\n};\nDwtProgressBar.prototype._createHTML=function(){this._table=document.createElement(\"table\");\nthis._table.border=this._table.cellpadding=this._table.cellspacing=0;\nthis._row=this._table.insertRow(-1);\nthis._cell=this._row.insertCell(-1);\nthis.getHtmlElement().appendChild(this._table)\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtPropertyEditor\")){DwtPropertyEditor=function(e,b,d,c,a){if(arguments.length>0){if(!d){d=\"DwtPropertyEditor\"\n}DwtComposite.call(this,{parent:e,className:d,posStyle:c,deferred:a});\nthis._useDwtInputField=b!=null?b:true;\nthis._schema=null;\nthis._init()\n}};\nDwtPropertyEditor.MSG_TIMEOUT=4000;\nDwtPropertyEditor.MSG={mustMatch:\"This field does not match validators: REGEXP\",mustNotMatch:\"This field matches anti-validators: REGEXP\"};\nDwtPropertyEditor.prototype=new DwtComposite;\nDwtPropertyEditor.prototype.constructor=DwtPropertyEditor;\nDwtPropertyEditor.prototype.toString=function(){return\"DwtPropertyEditor\"\n};\nDwtPropertyEditor.prototype._init=function(){var b=document.createElement(\"div\");\nb.id=this._relDivId=Dwt.getNextId();\nb.style.position=\"relative\";\nvar a=document.createElement(\"table\");\na.id=this._tableId=Dwt.getNextId();\na.cellSpacing=a.cellPadding=0;\na.appendChild(document.createElement(\"tbody\"));\nb.appendChild(a);\nthis.getHtmlElement().appendChild(b);\nthis.maxLabelWidth=0;\nthis.maxFieldWidth=0;\nthis._setMouseEventHdlrs();\nthis._onMouseDown=new AjxListener(this,this._onMouseDown);\nthis.addListener(DwtEvent.ONMOUSEDOWN,this._onMouseDown)\n};\nDwtPropertyEditor.prototype.getRelDiv=function(){return document.getElementById(this._relDivId)\n};\nDwtPropertyEditor.prototype.getTable=function(){return document.getElementById(this._tableId)\n};\nDwtPropertyEditor.prototype._onMouseDown=function(c){var d=c.target;\nvar a=d.tagName.toLowerCase();\nif(a==\"input\"){c._stopPropagation=false;\nc._returnValue=true;\nreturn true\n}if(this._currentInputField&&!this._currentInputField.onblur()){c._stopPropagation=true;\nc._returnValue=false;\nreturn false\n}try{while(d&&a!=\"tr\"){d=d.parentNode;\na=d.tagName.toLowerCase()\n}if(d&&d.__msh_doMouseDown){d.__msh_doMouseDown(c)\n}}catch(b){}};\nDwtPropertyEditor.prototype.getProperties=function(){if(this._currentInputField){this._currentInputField.onblur()\n}function a(d){var f={},c,e=d.length;\nfor(var b=0;\nb<e;\n++b){c=d[b];\nif(c.type==\"struct\"){f[c.name]=a(c.children)\n}else{f[c.name]=c.value\n}}return f\n}return a(this._schema)\n};\nDwtPropertyEditor.prototype.validateData=function(){var a=true;\nfunction b(e){var d,f=e.length;\nfor(var c=0;\nc<f;\n++c){d=e[c];\nif(d.type==\"struct\"){b(d.children)\n}else{if(!d._validate()){a=false\n}}}}b(this._schema);\nreturn a\n};\nDwtPropertyEditor.prototype.initProperties=function(c,b){if(b==null){this._schema=c;\nb=null\n}for(var a=0;\na<c.length;\n++a){this._createProperty(c[a],b)\n}};\nDwtPropertyEditor.prototype._createProperty=function(a,j){var b=j?j._level+1:0;\nvar h=this.getTable().firstChild.appendChild(document.createElement(\"tr\"));\na._parent=j;\na._level=b;\na._rowElId=h.id=Dwt.getNextId();\na._propertyEditor=this;\nfor(var f in DwtPropertyEditor._prop_functions){a[f]=DwtPropertyEditor._prop_functions[f]\n}a._init();\nh.className=\"level-\"+b;\nif(a.visible==\"false\"){h.className+=\" invisible\"\n}if(a.readonly){h.className+=\" readonly\"\n}if(a.type!=\"struct\"){h.className+=\" \"+a.type;\nvar c=document.createElement(\"td\");\nc.className=\"label\";\nif(a.type==\"checkboxgroup\"){c.className+=\" grouplabel\"\n}h.appendChild(c);\nvar g=AjxStringUtil.htmlEncode(a.label||a.name);\nif(a.required){g+=\"<span class='DwtPropertyEditor-required'>*</span>\"\n}c.innerHTML=g;\nvar d=document.createElement(\"td\");\nd.className=\"field\";\nh.appendChild(d);\nswitch(a.type){case\"boolean\":this._createCheckbox(a,d);\nbreak;\ncase\"enum\":this._createDropDown(a,d);\nbreak;\ncase\"date\":this._createCalendar(a,d);\nbreak;\ncase\"checkboxgroup\":this._createCheckBoxGroup(a,d);\nbreak;\ndefault:if(this._useDwtInputField){this._createInputField(a,d)\n}else{d.innerHTML=a._makeDisplayValue();\nh.__msh_doMouseDown=DwtPropertyEditor.simpleClosure(a._edit,a)\n}break\n}a._fieldCellId=d.id=Dwt.getNextId();\nif(c.offsetWidth>this.maxLabelWidth){this.maxLabelWidth=c.offsetWidth\n}if(d.offsetWidth>this.maxFieldWidth){this.maxFieldWidth=d.offsetWidth\n}}else{var e=document.createElement(\"td\");\ne.colSpan=2;\nh.appendChild(e);\ne.className=\"label\";\nh.className+=\" expander-collapsed\";\ne.innerHTML=[\"<div>\",AjxStringUtil.htmlEncode(a.label),\"</div>\"].join(\"\");\nthis.initProperties(a.children,a);\nh.__msh_doMouseDown=DwtPropertyEditor.simpleClosure(a._toggle,a)\n}if(b>0){h.style.display=\"none\";\nj._hidden=true\n}};\nDwtPropertyEditor.prototype.setFixedLabelWidth=function(a){try{this.getTable().rows[0].cells[0].style.width=(a||this.maxLabelWidth)+\"px\"\n}catch(b){}};\nDwtPropertyEditor.prototype.setFixedFieldWidth=function(a){try{this.getTable().rows[0].cells[1].style.width=(a||this.maxFieldWidth)+\"px\"\n}catch(b){}};\nDwtPropertyEditor.prototype._setCurrentMsgDiv=function(a){this._currentMsgDiv=a;\nthis._currentMsgDivTimer=setTimeout(DwtPropertyEditor.simpleClosure(this._clearMsgDiv,this),DwtPropertyEditor.MSG_TIMEOUT)\n};\nDwtPropertyEditor.prototype._clearMsgDiv=function(){try{this._stopMsgDivTimer()\n}catch(a){}var b=this._currentMsgDiv;\nif(b){b.parentNode.removeChild(b);\nthis._currentMsgDiv=b=null;\nthis._currentMsgDivTimer=null\n}};\nDwtPropertyEditor.prototype._stopMsgDivTimer=function(){if(this._currentMsgDivTimer){clearTimeout(this._currentMsgDivTimer);\nthis._currentMsgDivTimer=null\n}};\nDwtPropertyEditor.prototype.addChild=function(a){if(!this._currentFieldCell){DwtComposite.prototype.addChild.call(this,a)\n}else{this._children.add(a);\nthis._currentFieldCell.appendChild(a.getHtmlElement())\n}};\nDwtPropertyEditor.prototype._createCheckbox=function(c,b){var a=document.createElement(\"input\");\na._prop=c;\na.id=c.name;\na.type=\"checkbox\";\nif(a.attachEvent){a.attachEvent(\"onclick\",c._onCheckboxChange)\n}else{if(a.addEventListener){a.addEventListener(\"click\",c._onCheckboxChange,false)\n}}this._children.add(a);\nb.appendChild(a);\nif(c.value==\"true\"){a.checked=c.value\n}};\nDwtPropertyEditor.prototype._createCheckBoxGroup=function(a,e){var b=document.createElement(\"div\");\nb._prop=a;\nb.id=a.name;\na._checkBox=[];\nb.appendChild(document.createTextNode(a.value));\nvar h=document.createElement(\"table\");\nh.id=Dwt.getNextId();\nh.border=0;\nh.cellSpacing=h.cellPadding=0;\nh.appendChild(document.createElement(\"tbody\"));\nfor(var c=0;\nc<a.checkBox.length;\nc++){var f=document.createElement(\"tr\");\nvar j=document.createElement(\"td\");\nj.className=\"field\";\nvar d=this._createCheckboxForGroup(a,a.checkBox[c],j);\nf.appendChild(j);\nd._label=a.checkBox[c].label;\nvar g=document.createElement(\"td\");\ng.className=\"field\";\ng.appendChild(document.createTextNode(a.checkBox[c].label));\nf.appendChild(g);\nh.firstChild.appendChild(f);\na._checkBox[c]=d\n}b.appendChild(h);\nthis._children.add(b);\ne.appendChild(b);\nreturn b\n};\nDwtPropertyEditor.prototype._createCheckboxForGroup=function(a,d,c){var b=document.createElement(\"input\");\nb._prop=a;\nb.id=d.name;\nb.type=\"checkbox\";\nif(d.value==\"true\"){b.checked=d.value\n}if(b.attachEvent){b.attachEvent(\"onclick\",a._onCheckboxGroupChange)\n}else{if(b.addEventListener){b.addEventListener(\"click\",a._onCheckboxGroupChange,false)\n}}this._children.add(b);\nc.appendChild(b);\nreturn b\n};\nDwtPropertyEditor.prototype._createDropDown=function(g,f){this._currentFieldCell=f;\nvar d,e,c=0,b=[],a=g.item;\nwhile(d=a[c]){b[c++]=new DwtSelectOption(d.value,d.value==g.value,d.label)\n}g._select=e=new DwtSelect({parent:this,options:b});\ne.addChangeListener(new AjxListener(g,g._onSelectChange));\ne.addListener(DwtEvent.ONMOUSEDOWN,this._onMouseDown);\nthis._currentFieldCell=null\n};\nDwtPropertyEditor.prototype._createCalendar=function(f,d){this._currentFieldCell=d;\nvar b=new DwtButton({parent:this});\nthis._currentFieldCell=null;\nb.setText(f._makeDisplayValue());\nvar e=new DwtMenu({parent:b,style:DwtMenu.CALENDAR_PICKER_STYLE});\ne.setAssociatedObj(b);\nvar c=new DwtCalendar({parent:e});\nvar a=new Date();\na.setTime(f.value);\nc.setDate(a);\nc.setSize(150,\"auto\");\nc.addSelectionListener(new AjxListener(f,f._onCalendarSelect));\nb.setMenu(e);\nf._dateButton=b;\nf._dateCalendar=c\n};\nDwtPropertyEditor.DWT_INPUT_FIELD_TYPES={string:DwtInputField.STRING,password:DwtInputField.PASSWORD,integer:DwtInputField.INTEGER,number:DwtInputField.FLOAT};\nDwtPropertyEditor.prototype._createInputField=function(d,c){this._currentFieldCell=c;\nvar a=DwtPropertyEditor.DWT_INPUT_FIELD_TYPES[d.type]||DwtInputField.STRING;\nvar b=new DwtInputField({parent:this,type:a,initialValue:d.value,maxLen:d.maxLength,rows:d.rows});\nif(a==DwtInputField.INTEGER||a==DwtInputField.FLOAT){b.setValidNumberRange(d.minValue||null,d.maxValue||null);\nif(d.decimals!=null){b.setNumberPrecision(d.decimals)\n}}if(a==DwtInputField.STRING||a==DwtInputField.PASSWORD){b.setValidStringLengths(d.minLength,d.maxLength)\n}if(d.required){b.setRequired(true)\n}this._currentFieldCell=null;\nd._inputField=b;\nb.setValue(d.value);\nif(d.readonly){b.setReadOnly(true)\n}b.setValidationCallback(new AjxCallback(d,d._onDwtInputFieldValidated))\n};\nDwtPropertyEditor._prop_functions={_init:function(){this.type!=null||(this.type=\"string\");\nthis.value!=null||(this.value=\"\");\nthis._initialVal=this.value;\nif(this.type==\"date\"){if(!this.value){this.value=new Date().getTime()\n}if(!this.format){this.format=AjxDateUtil.getSimpleDateFormat().toPattern()\n}}},_modified:function(){return this._initialVal!=this.value\n},_getRowEl:function(){return document.getElementById(this._rowElId)\n},_makeDisplayValue:function(){var b=this._getValue();\nswitch(this.type){case\"password\":b=b.replace(/./g,\"*\");\nbreak;\ncase\"date\":var a=new Date();\na.setTime(b);\nb=AjxDateFormat.format(this.format,a);\nbreak\n}if(b==\"\"){b=\"<br />\"\n}else{b=AjxStringUtil.htmlEncode(String(b))\n}return b\n},_display:function(f){var g=this.children,e=f?\"\":\"none\";\nif(g){var a=g.length;\nwhile(--a>=0){g[a]._getRowEl().style.display=e;\nif(!f){g[a]._display(false)\n}}this._hidden=!f;\nvar b=this._getRowEl();\nb.className=b.className.replace(/expander-[^\\s]+/,f?\"expander-expanded\":\"expander-collapsed\")\n}},_toggle:function(){this._display(this._hidden)\n},_edit:function(){if(this.readonly){return\n}switch(this.type){case\"string\":case\"number\":case\"integer\":case\"password\":setTimeout(DwtPropertyEditor.simpleClosure(this._createInputField,this),50);\nbreak\n}},_createInputField:function(){var a=this._propertyEditor;\nvar f=document.getElementById(this._fieldCellId);\nvar c=a.getRelDiv();\nvar b=document.createElement(\"input\");\nb.className=\"DwtPropertyEditor-input \"+this.type;\nb.setAttribute(\"autocomplete\",\"off\");\nb.type=this.type==\"password\"?\"password\":\"text\";\nvar e=f.offsetLeft,d=f.offsetTop;\nif(AjxEnv.isGeckoBased){--e;\n--d\n}b.style.left=e+\"px\";\nb.style.top=d+\"px\";\nb.style.width=f.offsetWidth+1+\"px\";\nb.style.height=f.offsetHeight+1+\"px\";\nb.value=this._getValue();\nc.appendChild(b);\nb.focus();\nb.onblur=DwtPropertyEditor.simpleClosure(this._saveInput,this);\nb.onkeydown=DwtPropertyEditor.simpleClosure(this._inputKeyPress,this);\nthis._propertyEditor._currentInputField=this._inputField=b;\nif(!AjxEnv.isGeckoBased){b.select()\n}else{b.setSelectionRange(0,b.value.length)\n}},_getValue:function(){return this.value||\"\"\n},_checkValue:function(c){var a=c==\"\";\nif(a){if(!this.required){return c\n}this._displayMsg(AjxMsg.valueIsRequired);\nreturn null\n}if(this.maxLength!=null&&c.length>this.maxLength){this._displayMsg(AjxMessageFormat.format(AjxMsg.stringTooLong,this.maxLength));\nreturn null\n}if(this.minLength!=null&&c.length<this.minLength){this._displayMsg(AjxMessageFormat.format(AjxMsg.stringTooShort,this.minLength));\nreturn null\n}if(this.mustMatch&&!this.mustMatch.test(c)){this._displayMsg(this.msg_mustMatch||DwtPropertyEditor.MSG.mustMatch.replace(/REGEXP/,this.mustMatch.toString()));\nreturn null\n}if(this.mustNotMatch&&this.mustNotMatch.test(c)){this._displayMsg(this.msg_mustNotMatch||DwtPropertyEditor.MSG.mustNotMatch.replace(/REGEXP/,this.mustNotMatch.toString()));\nreturn null\n}switch(this.type){case\"integer\":case\"number\":var e=new Number(c);\nif(isNaN(e)){this._displayMsg(AjxMsg.notANumber);\nreturn null\n}if(this.type==\"integer\"&&Math.round(e)!=e){this._displayMsg(AjxMsg.notAnInteger);\nreturn null\n}if(this.minValue!=null&&e<this.minValue){this._displayMsg(AjxMessageFormat.format(AjxMsg.numberLessThanMin,this.minValue));\nreturn null\n}if(this.maxValue!=null&&e>this.maxValue){this._displayMsg(AjxMessageFormat.format(AjxMsg.numberMoreThanMax,this.maxValue));\nreturn null\n}c=e;\nif(this.type==\"number\"&&this.decimals!=null){var b=c.toString();\nvar d=b.indexOf(\".\");\nif(d==-1){d=b.length\n}c=c.toPrecision(d+this.decimals)\n}break\n}return c\n},_displayMsg:function(b){var g,f,j,d;\nvar e=this._propertyEditor;\nvar a=e._currentMsgDiv;\nif(!a){a=document.createElement(\"div\");\na.className=\"DwtPropertyEditor-ErrorMsg\";\ne.getRelDiv().appendChild(a)\n}else{e._stopMsgDivTimer()\n}a.style.visibility=\"hidden\";\na.innerHTML=AjxStringUtil.htmlEncode(b);\nvar k=e.getTable();\nj=k.offsetWidth;\nif(!AjxEnv.isIE){j-=12\n}g=k.offsetLeft;\na.style.left=g+\"px\";\na.style.width=j+\"px\";\nd=a.offsetHeight;\nvar c=document.getElementById(this._fieldCellId);\nf=c.offsetTop+c.offsetHeight;\nif(f+d>k.offsetTop+k.offsetHeight){f=c.offsetTop-d\n}a.style.top=f+\"px\";\na.style.visibility=\"\";\ne._setCurrentMsgDiv(a)\n},_saveInput:function(){var a=this._inputField;\nvar b=this._checkValue(a.value);\nif(b!=null){this._setValue(b);\na.onblur=a.onkeyup=a.onkeydown=a.onkeypress=null;\nvar c=document.getElementById(this._fieldCellId);\nc.innerHTML=this._makeDisplayValue();\nthis._inputField=null;\nthis._propertyEditor._currentInputField=null;\nthis._propertyEditor._clearMsgDiv();\na.parentNode.removeChild(a);\nreturn true\n}else{if(a.className.indexOf(\" DwtPropertyEditor-input-error\")==-1){a.className+=\" DwtPropertyEditor-input-error\"\n}a.focus();\nreturn false\n}},_inputKeyPress:function(b){b||(b=window.event);\nvar a=this._inputField;\nif(b.keyCode==13){this._saveInput()\n}else{if(b.keyCode==27){a.value=this._getValue();\nthis._saveInput()\n}else{this._propertyEditor._clearMsgDiv();\na.className=a.className.replace(/ DwtPropertyEditor-input-error/,\"\")\n}}},_onCheckboxChange:function(b){b||(b=window.event);\nvar a=AjxEnv.isIE?b.srcElement:b.target;\na._prop._setValue(a.checked?\"true\":\"false\")\n},_onSelectChange:function(){this._setValue(this._select.getValue())\n},_onCheckboxGroupChange:function(d){d||(d=window.event);\nvar c=AjxEnv.isIE?d.srcElement:d.target;\nvar a=c._prop._checkBox;\nvar e=[];\nfor(var b=0;\nb<a.length;\nb++){if(a[b].checked){e.push(a[b]._label)\n}}c._prop._setValue(e)\n},_onCalendarSelect:function(){this._setValue(this._dateCalendar.getDate().getTime());\nthis._dateButton.setText(this._makeDisplayValue())\n},_onDwtInputFieldValidated:function(a,c,b){if(c){this._setValue(b)\n}},_setValue:function(b){this.value=b;\nvar a=this._getRowEl();\na.className=a.className.replace(/ dirty/,\"\");\nif(this._modified()){a.className+=\" dirty\"\n}},_validate:function(){if(this._inputField){if(this._inputField instanceof DwtInputField){return this._inputField.validate()\n}else{return this._inputField.onblur()\n}}else{return true\n}}};\nDwtPropertyEditor.simpleClosure=function(a,b){return function(){return a.call(b,arguments[0])\n}\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtConfirmDialog\")){DwtConfirmDialog=function(b,a,e,d,c){if(arguments.length==0){return\n}if(!d){d=[DwtDialog.YES_BUTTON,DwtDialog.NO_BUTTON,DwtDialog.CANCEL_BUTTON]\n}DwtDialog.call(this,{parent:b,className:a||\"DwtConfirmDialog\",title:AjxMsg.confirmTitle,standardButtons:d,id:e,extraButtons:c});\nthis._questionDiv=document.createElement(\"DIV\");\nthis._questionDiv.className=\"DwtConfirmDialogQuestion\";\nthis._getContentDiv().appendChild(this._questionDiv);\nthis.registerCallback(DwtDialog.YES_BUTTON,this._handleYesButton,this);\nthis.registerCallback(DwtDialog.NO_BUTTON,this._handleNoButton,this);\nthis.registerCallback(DwtDialog.CANCEL_BUTTON,this._handleCancelButton,this)\n};\nDwtConfirmDialog.prototype=new DwtDialog;\nDwtConfirmDialog.prototype.constructor=DwtConfirmDialog;\nDwtConfirmDialog.prototype.toString=function(){return\"DwtConfirmDialog\"\n};\nDwtConfirmDialog.prototype.popup=function(c,a,d,b,e){this._questionDiv.innerHTML=c||\"\";\nthis._yesCallback=a;\nthis._noCallback=d;\nthis._cancelCallback=b;\nthis.setButtonVisible(DwtDialog.CANCEL_BUTTON,Boolean(d));\nDwtDialog.prototype.popup.call(this,e)\n};\nDwtConfirmDialog.prototype.popdown=function(){this._yesCallback=this._noCallback=this._cancelCallback=null;\nDwtDialog.prototype.popdown.call(this)\n};\nDwtConfirmDialog.prototype._handleYesButton=function(a){if(this._yesCallback){this._yesCallback.run(a)\n}this.popdown()\n};\nDwtConfirmDialog.prototype._handleNoButton=function(a){if(this._noCallback){this._noCallback.run(a)\n}this.popdown()\n};\nDwtConfirmDialog.prototype._handleCancelButton=function(a){if(this._cancelCallback){this._cancelCallback.run(a)\n}this.popdown()\n};\nDwtConfirmDialog.prototype._getSeparatorTemplate=function(){return\"\"\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtSpinner\")){DwtSpinner=function(a){if(arguments.length==0){return\n}DwtControl.call(this,{parent:a.parent,className:a.className,posStyle:a.posStyle,parentElement:a.parentElement});\nthis._maxValue=a.max!=null?a.max:null;\nthis._minValue=a.min!=null?a.min:null;\nthis._fieldSize=a.size!=null?a.size:3;\nthis._origValue=a.value||0;\nthis._maxLen=a.maxLen||null;\nthis._step=a.step||1;\nthis._decimals=\"decimals\" in a?a.decimals:0;\nthis._align=a.align||null;\nthis._timerFunc=AjxCallback.simpleClosure(this._timerFunc,this);\nthis._btnPressCapture=new DwtMouseEventCapture({targetObj:this,id:\"DwtSpinner\",mouseUpHdlr:AjxCallback.simpleClosure(this._stopCapture,this)});\nthis._createElements()\n};\nDwtSpinner.prototype=new DwtControl;\nDwtSpinner.prototype.constructor=DwtSpinner;\nDwtSpinner.INIT_TIMER=250;\nDwtSpinner.SLOW_TIMER=125;\nDwtSpinner.FAST_TIMER=33;\nDwtSpinner.prototype._createElements=function(){var f=this.getHtmlElement();\nvar e=Dwt.getNextId();\nthis._idField=e;\nthis._idUpButton=e+\"-up\";\nthis._idDownButton=e+\"-down\";\nvar d=[\"<table class='DwtSpinner' cellspacing='0' cellpadding='0'>\",\"<tr><td rowspan='2' class='DwtSpinner-inputCell'>\",\"<input id='\",e,\"' autocomplete='off' />\",\"</td>\",\"<td unselectable id='\",this._idUpButton,\"' class='DwtSpinner-upBtn'><div class='ImgUpArrowSmall'>&nbsp;</div></td>\",\"</tr><tr>\",\"<td unselectable id='\",this._idDownButton,\"' class='DwtSpinner-downBtn'><div class='ImgDownArrowSmall'>&nbsp;</div></td>\",\"</tr></table>\"];\nf.innerHTML=d.join(\"\");\nvar c=this._getUpButton();\nc.onmousedown=AjxCallback.simpleClosure(this._btnPressed,this,\"Up\");\nvar b=this._getDownButton();\nb.onmousedown=AjxCallback.simpleClosure(this._btnPressed,this,\"Down\");\nvar a=this.getInputElement();\nif(this._maxLen){a.maxLength=this._maxLen\n}if(this._fieldSize){a.size=this._fieldSize\n}if(this._align){a.style.textAlign=this._align\n}if(this._origValue!=null){this.setValue(this._origValue)\n}a.onblur=AjxCallback.simpleClosure(this.setValue,this,null);\na[(AjxEnv.isIE||AjxEnv.isOpera)?\"onkeydown\":\"onkeypress\"]=AjxCallback.simpleClosure(this.__onKeyPress,this)\n};\nDwtSpinner.prototype._getValidValue=function(a){var b=parseFloat(a);\nif(isNaN(b)||b==null){b=this._lastValidValue\n}if(b==null){b=this._minValue||0\n}if(this._minValue!=null&&b<this._minValue){b=this._minValue\n}if(this._maxValue!=null&&b>this._maxValue){b=this._maxValue\n}b=parseFloat(b);\nif(this._decimals!=null){b=b.toFixed(this._decimals)\n}this._lastValidValue=b;\nreturn b\n};\nDwtSpinner.prototype.getInputElement=function(){return document.getElementById(this._idField)\n};\nDwtSpinner.prototype._getUpButton=function(){return document.getElementById(this._idUpButton)\n};\nDwtSpinner.prototype._getDownButton=function(){return document.getElementById(this._idDownButton)\n};\nDwtSpinner.prototype._getButton=function(a){switch(a){case\"Up\":return this._getUpButton();\ncase\"Down\":return this._getDownButton()\n}};\nDwtSpinner.prototype._setBtnState=function(a,c){var b=this._getButton(a);\nif(c){Dwt.addClass(b,\"DwtSpinner-\"+a+\"-disabled\");\nb.firstChild.className=\"Img\"+a+\"ArrowSmallDis\"\n}else{Dwt.delClass(b,\"DwtSpinner-\"+a+\"-disabled\");\nb.firstChild.className=\"Img\"+a+\"ArrowSmall\"\n}};\nDwtSpinner.prototype.getValue=function(){return parseFloat(this._getValidValue(this.getInputElement().value))\n};\nDwtSpinner.prototype.setValue=function(a){if(a==null){a=this.getInputElement().value\n}a=this._getValidValue(a);\nthis.getInputElement().value=a;\na=parseFloat(a);\nthis._setBtnState(\"Down\",this._minValue!=null&&this._minValue==a);\nthis._setBtnState(\"Up\",this._maxValue!=null&&this._maxValue==a)\n};\nDwtSpinner.prototype.setEnabled=function(a){DwtControl.prototype.setEnabled.call(this,a);\nthis.getInputElement().disabled=!a;\nvar b=this.getHtmlElement().firstChild;\nif(!a){Dwt.addClass(b,\"DwtSpinner-disabled\")\n}else{Dwt.delClass(b,\"DwtSpinner-disabled\")\n}};\nDwtSpinner.prototype._rotateVal=function(a){var b=this.getValue();\nswitch(a){case\"Up\":b+=this._step;\nbreak;\ncase\"Down\":b-=this._step;\nbreak\n}this.setValue(b)\n};\nDwtSpinner.prototype._btnPressed=function(a){if(!this.getEnabled()){return\n}Dwt.addClass(this._getButton(a),\"DwtSpinner-\"+a+\"-pressed\");\nthis._direction=a;\nthis._rotateVal(a);\nthis._btnPressCapture.capture();\nthis._timerSteps=0;\nthis._timer=setTimeout(this._timerFunc,DwtSpinner.INIT_TIMER)\n};\nDwtSpinner.prototype._timerFunc=function(){var c=this.getValue();\nthis._rotateVal(this._direction);\nvar b=this.getValue();\nthis._timerSteps++;\nvar a=this._timerSteps>4?DwtSpinner.FAST_TIMER:DwtSpinner.SLOW_TIMER;\nif(c!=b){this._timer=setTimeout(this._timerFunc,a)\n}else{this._stopCapture()\n}};\nDwtSpinner.prototype._stopCapture=function(){if(this._timer){clearTimeout(this._timer)\n}this._timer=null;\nthis._timerSteps=null;\nvar b=this._direction;\nDwt.delClass(this._getButton(b),\"DwtSpinner-\"+b+\"-pressed\");\nthis._direction=null;\nthis._btnPressCapture.release();\nvar a=this.getInputElement();\na.focus();\nDwt.setSelectionRange(a,0,a.value.length)\n};\nDwtSpinner.prototype.__onKeyPress=function(c){if(AjxEnv.isIE){c=window.event\n}var b=null;\nswitch(c.keyCode){case 38:b=\"Up\";\nbreak;\ncase 40:b=\"Down\";\nbreak\n}if(b){this._rotateVal(b);\nvar a=this.getInputElement();\nDwt.setSelectionRange(a,0,a.value.length)\n}};\nDwtSpinner.prototype.focus=function(){this.getInputElement().focus()\n};\nDwtSpinner.prototype.select=function(){var a=this.getInputElement();\na.focus();\nDwt.setSelectionRange(a,0,a.value.length)\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtButtonColorPicker\")){DwtButtonColorPicker=function(c){if(arguments.length==0){return\n}c=Dwt.getParams(arguments,DwtButtonColorPicker.PARAMS);\nc.actionTiming=DwtButton.ACTION_MOUSEUP;\nDwtButton.call(this,c);\nvar a=new DwtMenu({parent:this,style:DwtMenu.COLOR_PICKER_STYLE});\nthis.setMenu(a);\nvar b=new DwtColorPicker(a,null,null,c.noFillLabel,c.allowColorInput);\nb.addSelectionListener(new AjxListener(this,this._colorPicked));\nthis.__colorPicker=b;\nthis.__color=\"\"\n};\nDwtButtonColorPicker.PARAMS=[\"parent\",\"style\",\"className\",\"posStyle\",\"id\",\"index\",\"noFillLabel\",\"allowColorInput\"];\nDwtButtonColorPicker.prototype=new DwtButton;\nDwtButtonColorPicker.prototype.constructor=DwtButtonColorPicker;\nDwtButtonColorPicker._RGB_RE=/rgb\\(([0-9]{1,3}),\\s*([0-9]{1,3}),\\s*([0-9]{1,3})\\)/;\nDwtButtonColorPicker._hexdigits=[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"A\",\"B\",\"C\",\"D\",\"E\",\"F\"];\nDwtButtonColorPicker.toHex=function(e,b){var a=[];\nwhile(e){var c=DwtButtonColorPicker._hexdigits[e&15];\na.push(c);\ne=e>>4\n}if(b!=null){b-=a.length;\nwhile(b-->0){a.push(\"0\")\n}}a.reverse();\nreturn a.join(\"\")\n};\nDwtButtonColorPicker.prototype.showColorDisplay=function(a){if(!this._colorEl){return\n}if(!a){this._colorEl.onmouseover=DwtButtonColorPicker.__colorDisplay_onMouseOver;\nthis._colorEl.onmouseout=DwtButtonColorPicker.__colorDisplay_onMouseOut;\nthis._colorEl.onmousedown=DwtButtonColorPicker.__colorDisplay_onMouseDown\n}};\nDwtButtonColorPicker.prototype.getColor=function(){return this.__color\n};\nDwtButtonColorPicker.prototype.setColor=function(a){var b=a.match(DwtButtonColorPicker._RGB_RE);\nif(b){a=\"#\"+DwtButtonColorPicker.toHex(parseInt(b[1]),2)+DwtButtonColorPicker.toHex(parseInt(b[2]),2)+DwtButtonColorPicker.toHex(parseInt(b[3]),2)\n}this.__color=a;\nvar c=this._colorEl;\nif(c){c.style.backgroundColor=a\n}};\nDwtButtonColorPicker.prototype._createHtmlFromTemplate=function(b,c){DwtButton.prototype._createHtmlFromTemplate.call(this,b,c);\nvar a=AjxTemplate.expand(\"dwt.Widgets#ZButtonColorDisplay\",c);\nthis.setText(a);\nthis._colorEl=document.getElementById(c.id+\"_color\")\n};\nDwtButtonColorPicker.prototype._setMinWidth=function(){};\nDwtButtonColorPicker.prototype._colorPicked=function(c){var a=c.detail||\"#000000\";\nthis.__color=this.__detail=a;\nvar b=this._colorEl;\nif(b){b.style.backgroundColor=a\n}if(this.isListenerRegistered(DwtEvent.SELECTION)){var d=DwtShell.selectionEvent;\nd.item=this;\nd.detail=a;\nthis.notifyListeners(DwtEvent.SELECTION,d)\n}};\nDwtButtonColorPicker.prototype.__colorDisplay_onMouseOver=function(a,b){if(!this.getEnabled()){return\n}Dwt.addClass(b,\"ImgDisable\")\n};\nDwtButtonColorPicker.prototype.__colorDisplay_onMouseOut=function(a,b){if(!this.getEnabled()){return\n}Dwt.delClass(b,\"ImgDisable\")\n};\nDwtButtonColorPicker.prototype.__colorDisplay_onMouseDown=function(b,d){if(!this.getEnabled()){return\n}var a=DwtShell.mouseEvent;\na.setFromDhtmlEvent(b);\nthis.__color=this.__detail=d.style.backgroundColor=\"\";\nif(this.isListenerRegistered(DwtEvent.SELECTION)){var c=DwtShell.selectionEvent;\nc.item=this;\nc.detail=\"\";\nthis.notifyListeners(DwtEvent.SELECTION,c)\n}a._stopPropagation=true;\na._returnValue=false;\na.setToDhtmlEvent(b);\nreturn false\n};\nDwtButtonColorPicker.__colorDisplay_onMouseOver=function(a){var b=DwtControl.getTargetControl(a);\nb.__colorDisplay_onMouseOver(a,this)\n};\nDwtButtonColorPicker.__colorDisplay_onMouseOut=function(a){var b=DwtControl.getTargetControl(a);\nb.__colorDisplay_onMouseOut(a,this)\n};\nDwtButtonColorPicker.__colorDisplay_onMouseDown=function(a){var b=DwtControl.getTargetControl(a);\nb.__colorDisplay_onMouseDown(a,this)\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtMessageComposite\")){DwtMessageComposite=function(a){if(arguments.length==0){return\n}a=Dwt.getParams(arguments,DwtMessageComposite.PARAMS);\nif(!a.className){a.className=\"DwtMessageComposite\"\n}DwtComposite.call(this,a);\nthis._tabGroup=new DwtTabGroup(\"DwtMessageComposite\");\nif(a.format){this.setFormat(a.format,a.controlCallback,a.hintsCallback)\n}};\nDwtMessageComposite.PARAMS=[\"parent\",\"className\",\"posStyle\"];\nDwtMessageComposite.prototype=new DwtComposite;\nDwtMessageComposite.prototype.constructor=DwtMessageComposite;\nDwtMessageComposite.prototype.isDwtMessageComposite=true;\nDwtMessageComposite.prototype.toString=function(){return\"DwtMessageComposite\"\n};\nDwtMessageComposite.prototype.setFormat=function(o,l,c){this._formatter=new AjxMessageFormat(o);\nthis._controls={};\nvar b=this._htmlElId;\nthis.getHtmlElement().innerHTML=\"<table class='DwtCompositeTable' border='0' cellspacing='0' cellpadding='0'><tr valign='center'></tr></table>\";\nvar n=this.getHtmlElement().firstChild.rows[0];\nvar f=this._formatter.getSegments();\nfor(var e=0;\ne<f.length;\ne++){var g=f[e];\nvar m=g instanceof AjxMessageFormat.MessageSegment;\nvar h=[b,e].join(\"_\");\nvar k=document.createElement(\"TD\");\nk.id=h;\nk.className=\"DwtCompositeCell\";\nn.appendChild(k);\nif(m){k.className+=\" MessageControl\"+g.getIndex();\nvar d=l?l.run(this,g,e):null;\nif(!d){d=new DwtInputField({parent:this,parentElement:k})\n}else{d.reparentHtmlElement(k)\n}this._tabGroup.addMember(d.getTabGroupMember());\nif(c){var a=c.run(this,g,e);\nAjxUtil.hashUpdate(d.getHtmlElement(),a,true)\n}var j=g.getIndex();\nthis._controls[j]=this._controls[j]||d\n}else{d=new DwtText({parent:this,parentElement:k});\nd.setText(g.toSubPattern());\nthis._tabGroup.addMember(d)\n}}};\nDwtMessageComposite.prototype.format=function(){var b=[];\nfor(var a in this._controls){b[a]=this._controls[a].getValue()\n}return this._formatter.format(b)\n};\nDwtMessageComposite.prototype.getTabGroupMember=function(){return this._tabGroup\n}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtRadioButtonGroup\")){DwtRadioButtonGroup=function(c,a){this._radios={};\nthis._radioButtons={};\nthis._values={};\nthis._value2id={};\nthis._eventMgr=new AjxEventMgr();\nfor(var b in c){this.addRadio(b,c[b],(b==a))\n}};\nDwtRadioButtonGroup.prototype.toString=function(){return\"DwtRadioButtonGroup\"\n};\nDwtRadioButtonGroup.prototype._enabled=true;\nDwtRadioButtonGroup.prototype._visible=true;\nDwtRadioButtonGroup.prototype.addSelectionListener=function(a){return this._eventMgr.addListener(DwtEvent.SELECTION,a)\n};\nDwtRadioButtonGroup.prototype.removeSelectionListener=function(a){return this._eventMgr.removeListener(DwtEvent.SELECTION,a)\n};\nDwtRadioButtonGroup.prototype.setEnabled=function(a){this._enabled=a;\nfor(var b in this._radios){this._radios[b].disabled=!a\n}};\nDwtRadioButtonGroup.prototype.isEnabled=function(){return this._enabled\n};\nDwtRadioButtonGroup.prototype.setVisible=function(a){this._visible=a;\nfor(var b in this._radioButtons){this._radioButtons[b].setVisible(a)\n}for(var b in this._radios){Dwt.setVisible(this._radios[b],a)\n}};\nDwtRadioButtonGroup.prototype.isVisible=function(){return this._visible\n};\nDwtRadioButtonGroup.prototype.addRadio=function(h,g,d){var a=g instanceof DwtRadioButton;\nvar e=a?g:null;\nvar f=e?e.getValue():g;\nthis._values[h]=f;\nthis._value2id[f]=h;\nvar b=document.getElementById(h);\nthis._radios[h]=b;\nthis._radioButtons[h]=e;\nvar c=AjxCallback.simpleClosure(this._handleClick,this);\nDwt.setHandler(b,DwtEvent.ONCLICK,c);\nb.checked=d;\nif(d){this._selectedId=h\n}};\nDwtRadioButtonGroup.prototype.getRadioByValue=function(a){var b=this._value2id[a];\nreturn this._radios[b]\n};\nDwtRadioButtonGroup.prototype.getRadioButtonByValue=function(a){var b=this._value2id[a];\nreturn this._radioButtons[b]\n};\nDwtRadioButtonGroup.prototype.setSelectedId=function(d,a){if(d!=this._selectedId){var b=document.getElementById(d);\nif(!b){return\n}b.checked=true;\nthis._selectedId=d;\nif(!a){var c=DwtShell.selectionEvent;\nc.reset();\nthis._notifySelection(c)\n}}};\nDwtRadioButtonGroup.prototype.setSelectedValue=function(b,a){var c=this._valueToId(b);\nthis.setSelectedId(c,a)\n};\nDwtRadioButtonGroup.prototype.getSelectedId=function(){return this._selectedId\n};\nDwtRadioButtonGroup.prototype.getSelectedValue=function(){return this._values[this._selectedId]\n};\nDwtRadioButtonGroup.prototype.getValue=function(){return this.getSelectedValue()\n};\nDwtRadioButtonGroup.prototype.getData=function(b){var a=!AjxUtil.isUndefined(this._selectedId)&&this._radioButtons[this._selectedId];\nif(a){return a.getData(b)\n}};\nDwtRadioButtonGroup.prototype._valueToId=function(a){for(var b in this._values){if(this._values[b]==a){return b\n}if(a===true&&this._values[b]==\"true\"){return b\n}if(a===false&&(this._values[b]==\"false\"||this._values[b]==\"\")){return b\n}}return null\n};\nDwtRadioButtonGroup.prototype._notifySelection=function(a){a.item=this;\na.detail={id:this._selectedId,value:this._values[this._selectedId]};\nthis._eventMgr.notifyListeners(DwtEvent.SELECTION,a)\n};\nDwtRadioButtonGroup.prototype._handleClick=function(a){a=DwtUiEvent.getEvent(a);\nvar c=DwtUiEvent.getTarget(a);\nif(c&&c.nodeName.match(/label/i)){c=document.getElementById(c.getAttribute(AjxEnv.isIE?\"htmlFor\":\"for\"))\n}var d=c.id;\nif(!c.checked){for(d in this._radios){if(this._radios[d].checked){break\n}}}if(d!=this._selectedId){this._selectedId=d;\nvar b=DwtShell.selectionEvent;\nDwtUiEvent.copy(b,a);\nthis._notifySelection(b)\n}}\n}if(AjxPackage.define(\"ajax.dwt.widgets.DwtComboBox\")){DwtComboBox=function(a){if(arguments.length==0){return\n}a=Dwt.getParams(arguments,DwtComboBox.PARAMS);\na.className=a.className||\"DwtComboBox\";\nDwtComposite.call(this,a);\nthis.input=null;\nthis._menu=null;\nthis._button=null;\nthis._textToValue={};\nthis._valueToText={};\nthis._valueToItem={};\nthis._size=0;\nthis._hasMenuCallback=true;\nthis._menuItemListenerObj=new AjxListener(this,this._menuItemListener);\nthis._inputParams=a.inputParams;\nthis._useLabel=Boolean(a.useLabel);\nthis._maxRows=a.maxRows;\nthis._layout=a.layout;\nthis._autoScroll=a.autoScroll||false;\nthis._createHtml()\n};\nDwtComboBox.PARAMS=[\"parent\",\"inputParams\",\"className\",\"posStyle\",\"dialog\"];\nDwtComboBox.prototype=new DwtComposite;\nDwtComboBox.prototype.constructor=DwtComboBox;\nDwtComboBox.prototype.isDwtComboBox=true;\nDwtComboBox.prototype.toString=function(){return\"DwtComboBox\"\n};\nDwtComboBox.prototype.TEMPLATE=\"dwt.Widgets#DwtComboBox\";\nDwtComboBox.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nDwtComboBox.prototype.addChangeListener=function(a){this.addListener(DwtEvent.ONCHANGE,a)\n};\nDwtComboBox.prototype.removeChangeListener=function(a){this.removeListener(DwtEvent.ONCHANGE,a)\n};\nDwtComboBox.prototype.add=function(d,b,a){this._textToValue[d]=b;\nthis._valueToText[b]=d;\nif(!this._hasMenuCallback){var c=this._button.getMenu();\nthis._createMenuItem(c,d)\n}if(a){this.setText(d)\n}this._size++;\nthis._updateButton()\n};\nDwtComboBox.prototype.remove=function(b){var a=this._valueToItem[b];\nif(a){this._button.getMenu().removeChild(a);\nvar c=this._valueToText[b];\ndelete this._textToValue[c];\ndelete this._valueToText[b];\ndelete this._valueToItem[b];\nif(this.getText()==c){this.setText(\"\")\n}this._size--;\nthis._updateButton()\n}};\nDwtComboBox.prototype.removeAll=function(){this._button.setMenu(new AjxCallback(this,this._createMenu),true);\nthis._hasMenuCallback=true;\nthis._textToValue={};\nthis._valueToText={};\nthis._valueToItem={};\nthis._size=0;\nthis._updateButton()\n};\nDwtComboBox.prototype.getValue=function(){var a=this.getText();\nreturn this._textToValue[a]\n};\nDwtComboBox.prototype.setValue=function(a){var b=this._valueToText[a];\nthis.setText(b||a)\n};\nDwtComboBox.prototype.getText=function(){return this._useLabel?this.input.getText():this.input.getValue()\n};\nDwtComboBox.prototype.setText=function(a){if(this._useLabel){this.input.setText(a)\n}else{this.input.setValue(a)\n}};\nDwtComboBox.prototype.setEnabled=function(a){if(a!=this._enabled){DwtComposite.prototype.setEnabled.call(this,a);\nthis.input.setEnabled(a);\nthis._button.setEnabled(a)\n}};\nDwtComboBox.prototype.focus=function(){return this.input.focus()\n};\nDwtComboBox.prototype.popdown=function(){if(this._menu){this._menu.popdown()\n}};\nDwtComboBox.prototype._createMenu=function(){var e={parent:this};\nif(this._maxRows){e.maxRows=this._maxRows\n}if(this._layout){e.layout=this._layout\n}var d=this._menu=new DwtMenu(e);\nfor(var a in this._textToValue){var b=this._createMenuItem(d,a);\nvar c=this._textToValue[a];\nthis._valueToItem[c]=b\n}this._hasMenuCallback=false;\nreturn d\n};\nDwtComboBox.prototype._createMenuItem=function(c,b){var a=new DwtMenuItem({parent:c});\na.setText(b);\na.addSelectionListener(this._menuItemListenerObj);\nif(!this._menuWidth){this._menuWidth=this.getW()-10\n}a.getHtmlElement().style.minWidth=this._menuWidth;\nreturn a\n};\nDwtComboBox.prototype._menuItemListener=function(d){var b=d.dwtObj;\nvar e=this.getText();\nvar f=b.getText();\nthis.setText(f);\nthis._menu.popdown();\nvar c=DwtUiEvent.getEvent(d);\nc._args={selectObj:this,newValue:f,oldValue:e};\nthis.notifyListeners(DwtEvent.ONCHANGE,c);\nif(!this._useLabel){var a=this.input.getInputElement();\na.focus();\na.select()\n}};\nDwtComboBox.prototype._handleKeyDown=function(b){var a=DwtKeyEvent.getCharCode(b);\nthis.__ovalue=this.getText();\nreturn true\n};\nDwtComboBox.prototype._handleKeyUp=function(c){DwtInputField._keyUpHdlr(c);\nvar b=DwtUiEvent.getEvent(c);\nvar d=this.getText();\nb._args={selectObj:this,newValue:d,oldValue:this.__ovalue};\nthis.notifyListeners(DwtEvent.ONCHANGE,b);\nif(this._menu&&this._autoScroll&&d!=this.__ovalue){var a=0;\nfor(var e in this._textToValue){if(e.indexOf(d)==0){this._menu.scrollToIndex(a);\nbreak\n}a++\n}}return true\n};\nDwtComboBox.prototype._updateButton=function(){this._button.setVisible(this._size>0)\n};\nDwtComboBox.prototype._createHtml=function(a){var b={id:this._htmlElId};\nthis._createHtmlFromTemplate(a||this.TEMPLATE,b)\n};\nDwtComboBox.prototype._createHtmlFromTemplate=function(b,c){DwtComposite.prototype._createHtmlFromTemplate.call(this,b,c);\nvar a=this._inputParams||{};\na.parent=this;\na.size=a.size||40;\ndelete this._inputParams;\nthis.input=(this._useLabel?new DwtLabel(a):new DwtInputField(a));\nthis.input.replaceElement(c.id+\"_input\");\nthis.input.setHandler(DwtEvent.ONKEYDOWN,AjxCallback.simpleClosure(this._handleKeyDown,this));\nthis.input.setHandler(DwtEvent.ONKEYUP,AjxCallback.simpleClosure(this._handleKeyUp,this));\nthis._button=new DwtComboBoxButton({parent:this});\nthis._button.setMenu(new AjxListener(this,this._createMenu),true);\nthis._button.replaceElement(c.id+\"_button\");\nthis._updateButton();\nthis._tabGroup=new DwtTabGroup(this._htmlElId);\nthis._tabGroup.addMember(this.input);\nthis._tabGroup.addMember(this._button)\n};\nDwtComboBox.prototype._replaceElementHook=function(b,d,a,e){DwtComposite.prototype._replaceElementHook.apply(this,arguments);\nif(b.size){var c=(this._useLabel?this.input.getHtmlElement():this.input.getInputElement());\nc.size=b.size\n}if(b.title){this.input.setHint(b.title)\n}};\nDwtComboBoxButton=function(a){a=Dwt.getParams(arguments,DwtComboBoxButton.PARAMS);\na.posStyle=Dwt.RELATIVE_STYLE;\nDwtButton.call(this,a)\n};\nDwtComboBoxButton.prototype=new DwtButton;\nDwtComboBoxButton.prototype.constructor=DwtComboBoxButton;\nDwtComboBoxButton.prototype.toString=function(){return\"DwtComboBoxButton\"\n};\nDwtComboBoxButton.PARAMS=[\"parent\",\"className\"];\nDwtComboBoxButton.prototype.TEMPLATE=\"dwt.Widgets#DwtComboBoxButton\"\n}if(AjxPackage.define(\"zimbra.common.ZLoginFactory\")){ZLoginFactory=function(){};\nZLoginFactory.USER_ID=\"ZLoginUserName\";\nZLoginFactory.PASSWORD_ID=\"ZLoginPassword\";\nZLoginFactory.REMEMBER_ME_ID=\"rememberMe\";\nZLoginFactory.REMEMBER_ME_CONTAINER_ID=\"ZLoginRememberMeContainer\";\nZLoginFactory.NEW_PASSWORD_ID=\"newpass1\";\nZLoginFactory.NEW_PASSWORD_TR_ID=\"ZLoginNewPassword1Tr\";\nZLoginFactory.PASSWORD_CONFIRM_TR_ID=\"ZLoginNewPassword2Tr\";\nZLoginFactory.PASSWORD_CONFIRM_ID=\"newpass2\";\nZLoginFactory.LOGIN_BUTTON_ID=\"ZLoginButton\";\nZLoginFactory.MORE_ID=\"ZLoginMore\";\nZLoginFactory.TEXT_TYPE=0;\nZLoginFactory.CHECKBOX_TYPE=1;\nZLoginFactory.BUTTON_TYPE=2;\nZLoginFactory.TAB_ORDER=[ZLoginFactory.USER_ID,ZLoginFactory.PASSWORD_ID,ZLoginFactory.NEW_PASSWORD_ID,ZLoginFactory.PASSWORD_CONFIRM_ID,ZLoginFactory.REMEMBER_ME_ID,ZLoginFactory.LOGIN_BUTTON_ID];\nZLoginFactory.VISIBILITY=[ZLoginFactory.USER_ID,ZLoginFactory.PASSWORD_ID,ZLoginFactory.NEW_PASSWORD_TR_ID,ZLoginFactory.PASSWORD_CONFIRM_TR_ID,ZLoginFactory.REMEMBER_ME_CONTAINER_ID,ZLoginFactory.LOGIN_BUTTON_ID];\nZLoginFactory.TAB_TYPE=[ZLoginFactory.TEXT_TYPE,ZLoginFactory.TEXT_TYPE,ZLoginFactory.TEXT_TYPE,ZLoginFactory.TEXT_TYPE,ZLoginFactory.CHECKBOX_TYPE,ZLoginFactory.BUTTON_TYPE];\nZLoginFactory.copyDefaultParams=function(a){return{showPanelBorder:true,companyURL:a.splashScreenCompanyURL||\"\",shortVersion:\"\",longVersion:\"\",appName:a.splashScreenAppName||\"\",productName:\"\",showError:false,errorMsg:\"\",showLongVersion:false,showAbout:false,aboutMsg:\"\",showLoading:false,loadingMsg:a.splashScreenLoading||\"\",showForm:false,showUserField:false,userNameMsg:a.username?a.username+\":\":\"\",showMoreField:false,moreMsg:a.more||\"\",showPasswordField:false,passwordMsg:a.password?a.password+\":\":\"\",showNewPasswordFields:false,newPassword1Msg:a.newPassword+\":\"||\"\",newPassword2Msg:a.confirm+\":\"||\"\",showLicenseMsg:false,licenseMsg:\"\",showRememberMeCheckbox:false,rememberMeMsg:a.rememberMe||\"\",showLogOff:false,logOffMsg:a.loginAsDiff||\"\",logOffAction:\"\",showButton:true,buttonName:a.login||\"\",copyrightText:a.splashScreenCopyright||\"\"}\n};\nZLoginFactory.getLoginPanel=function(){var a=document.getElementsByName(\"loginForm\");\nreturn a\n};\nZLoginFactory.showErrorMsg=function(a){this.setHTML(\"ZLoginErrorMsg\",a);\nthis.show(\"ZLoginErrorPanel\");\nthis._flickerErrorMessagePanel()\n};\nZLoginFactory.hideErrorMsg=function(){this.hide(\"ZLoginErrorPanel\")\n};\nZLoginFactory.getErrorMsgPanel=function(){return this.get(\"ZLoginErrorPanel\")\n};\nZLoginFactory.showAboutMsg=function(a){this.setHTML(\"ZLoginAboutPanel\",a);\nthis.show(\"ZLoginAboutPanel\")\n};\nZLoginFactory.hideAboutMsg=function(){this.hide(\"ZLoginAboutPanel\")\n};\nZLoginFactory.getAboutMsg=function(){return this.get(\"ZLoginAboutPanel\")\n};\nZLoginFactory.showLoadingMsg=function(a){this.setHTML(\"ZLoginLoadingMsg\",a);\nthis.show(\"ZLoginAboutPanel\")\n};\nZLoginFactory.hideLoadingMsg=function(){this.hide(\"ZLoginAboutPanel\")\n};\nZLoginFactory.getLoadingMsg=function(){return this.get(\"ZLoginAboutPanel\")\n};\nZLoginFactory.showForm=function(){this.show(\"ZLoginFormPanel\")\n};\nZLoginFactory.hideForm=function(){this.hide(\"ZLoginFormPanel\")\n};\nZLoginFactory.getForm=function(){return this.get(\"ZLoginFormPanel\")\n};\nZLoginFactory.showMoreField=function(a){this.setValue(ZLoginFactory.MORE_ID,a);\nthis.show(ZLoginFactory.MORE_ID)\n};\nZLoginFactory.hideMoreField=function(){this.hide(ZLoginFactory.MORE_ID)\n};\nZLoginFactory.getMoreField=function(){return this.get(ZLoginFactory.MORE_ID)\n};\nZLoginFactory.showUserField=function(a){this.setValue(ZLoginFactory.USER_ID,a);\nthis.show(ZLoginFactory.USER_ID)\n};\nZLoginFactory.hideUserField=function(){this.hide(ZLoginFactory.USER_ID)\n};\nZLoginFactory.getUserField=function(){return this.get(ZLoginFactory.USER_ID)\n};\nZLoginFactory.showPasswordField=function(a){this.show(ZLoginFactory.PASSWORD_ID)\n};\nZLoginFactory.hidePasswordField=function(){this.hide(ZLoginFactory.PASSWORD_ID)\n};\nZLoginFactory.getPasswordField=function(){return this.get(ZLoginFactory.PASSWORD_ID)\n};\nZLoginFactory.showNewPasswordFields=function(){this.show(ZLoginFactory.NEW_PASSWORD_TR_ID);\nthis.show(ZLoginFactory.PASSWORD_CONFIRM_TR_ID)\n};\nZLoginFactory.hideNewPasswordFields=function(){this.hide(ZLoginFactory.NEW_PASSWORD_TR_ID);\nthis.hide(ZLoginFactory.PASSWORD_CONFIRM_TR_ID)\n};\nZLoginFactory.areNewPasswordFieldsShown=function(){return this.isShown(ZLoginFactory.NEW_PASSWORD_TR_ID)\n};\nZLoginFactory.getNewPasswordField=function(){return this.get(ZLoginFactory.NEW_PASSWORD_ID)\n};\nZLoginFactory.getPasswordConfirmField=function(){return this.get(ZLoginFactory.PASSWORD_CONFIRM_ID)\n};\nZLoginFactory.showRememberMeCheckbox=function(){this.show(ZLoginFactory.REMEMBER_ME_CONTAINER_ID)\n};\nZLoginFactory.hideRememberMeCheckbox=function(){this.hide(ZLoginFactory.REMEMBER_ME_CONTAINER_ID)\n};\nZLoginFactory.showLogOff=function(){this.show(\"ZLoginLogOffContainer\")\n};\nZLoginFactory.hideLogOff=function(){this.hide(\"ZLoginLogOffContainer\")\n};\nZLoginFactory.setLoginButtonName=function(a){this.setHTML(\"ZLoginButtonText\",a)\n};\nZLoginFactory.setLoginButtonAction=function(b){var a=document.getElementById(ZLoginFactory.LOGIN_BUTTON_ID);\nif(a){a.onclick=b\n}};\nZLoginFactory.getLoginButton=function(){return this.get(ZLoginFactory.LOGIN_BUTTON_ID)\n};\nZLoginFactory.getLoginDialogHTML=function(b){var a=[\"<div \",(b.showAbout?\" \":\"class='center'\"),\">\",\"<div class='contentBox'>\",\"<h1><a href='\"+b.companyURL+\"' id='bannerLink' target='_new'>\",\"<span class='ImgLoginBanner'></span>\",\"</a></h1>\",\"<div id='ZLoginErrorPanel' \",(b.showError?\" \":\"style='display:none'\"),\">\",\"<table><tr><td width='40'><div class='ImgCritical_32'></div></td><td width='*'><span class='errorText' id='ZLoginErrorMsg'></span></td></tr></table>\",\"</div>\",\"<form name='loginForm' method='POST'>\",\"<table class='form' \",(b.showForm?\" \":\"style='display:none'\"),\">\",\"<tr \",(b.showMoreField?\" \":\"style='display:none'\"),\">\",\"<td></td>\",\"<td><span class='Img ImgInformation_xtra_small'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><label for='\",ZLoginFactory.MORE_ID,\"'>\",b.moreMsg,\"</label></td>\",\"</tr>\",\"<tr \",(b.showLoading?\" \":\"style='display:none'\"),\">\",\"<td colspan=2 class='ZLoadingMessage'>\",b.loadingMsg,\"</td>\",\"</tr>\",\"<tr id='ZLoginLicenseMsgContainer' \",(b.showLicenseMsg?\" \":\"style='display:none'\"),\">\",\"<td colspan=3 id='ZLoginLicenseMsg'>\",b.licenseMsg,\"</td>\",\"</tr>\",\"<tr \",(b.showUserField?\" \":\"style='display:none'\"),\">\",\"<td><label for='\",ZLoginFactory.USER_ID,\"'>\",b.userNameMsg,\"</label></td>\",\"<td><input id='\",ZLoginFactory.USER_ID,\"' name='\",ZLoginFactory.USER_ID,\"' class='zLoginField' type='text' size='40' autocomplete=OFF/></td>\",\"</tr>\",\"<tr \",(b.showPasswordField?\" \":\"style='display:none'\"),\">\",\"<td><label for=\",ZLoginFactory.PASSWORD_ID,\">\",b.passwordMsg,\"</label></td>\",\"<td><input id=\",ZLoginFactory.PASSWORD_ID,\" class='zLoginField' name=\",ZLoginFactory.PASSWORD_ID,\" type='password' autocomplete=OFF size='40'/></td>\",\"</tr>\",\"<tr id=\",ZLoginFactory.NEW_PASSWORD_TR_ID,(b.showNewPasswordFields?\" \":\" style='display:none'\"),\">\",\"<td><label for='\",ZLoginFactory.NEW_PASSWORD_ID,\"'>\",b.newPassword1Msg,\"</label></td>\",\"<td><input id='\",ZLoginFactory.NEW_PASSWORD_ID,\"' class='zLoginField' name='\",ZLoginFactory.NEW_PASSWORD_ID,\"' type='password' autocomplete=OFF size='40'/></td>\",\"</tr>\",\"<tr id=\",ZLoginFactory.PASSWORD_CONFIRM_TR_ID,(b.showNewPasswordFields?\" \":\" style='display:none'\"),\">\",\"<td><label for='\",ZLoginFactory.PASSWORD_CONFIRM_ID,\"'>\",b.newPassword2Msg,\"</label></td>\",\"<td><input id='\",ZLoginFactory.PASSWORD_CONFIRM_ID,\"' class='zLoginField' name='\",ZLoginFactory.PASSWORD_CONFIRM_ID,\"' type='password' autocomplete=OFF size='40'/></td>\",\"</tr>\",\"<tr>\",\"<td>&nbsp;</td>\",\"<td class='submitTD'>\",\"<input id='\",ZLoginFactory.LOGIN_BUTTON_ID,\"' class='ZLoginButton DwtButton' type='button' onclick='\",b.loginAction,\";return false' value='\",b.buttonName,(b.showButton?\"'/>\":\"' style='display:none'/>\"),\"<input id='\",ZLoginFactory.REMEMBER_ME_ID,\"' value='1' type='checkbox' name='\",ZLoginFactory.REMEMBER_ME_ID,\"'  \",(b.showRememberMeCheckbox?\"\":\"style='display:none'\"),\"/>\",\"<label \",(b.showRememberMeCheckbox?\"\":\"style='display:none'\"),\" for='\",ZLoginFactory.REMEMBER_ME_ID,\"'>\",b.rememberMeMsg,\"</label>\",\"</td>\",\"</tr>\",\"</table>\",\"</form>\",\"<div id='ZLoginAboutPanel' \",(b.showAbout?\"\":\"style='display:none'\"),\">\",b.aboutMsg,\"</div>\",\"<div id='ZLoginLongVersion' class='version' \",(b.showLongVersion?\"\":\"style='display:none'\"),\">\",b.longVersion,\"</div>\",\"</div>\",\"<div class='decor1'></div>\",\"</div>\",\"<div class='Footer'>\",\"<div id='ZLoginNotice'>\",b.clientLevelNotice,\"</div>\",\"<div class='copyright'>\",b.copyrightText,\"</div>\",\"</div>\",\"<div class='decor2'></div>\"].join(\"\");\nreturn a\n};\nZLoginFactory.setHTML=function(c,a){var b=document.getElementById(c);\nif(b&&a!=null){b.innerHTML=a\n}};\nZLoginFactory.setValue=function(c,a){var b=document.getElementById(c);\nif(b&&a!=null){b.value=a\n}};\nZLoginFactory.show=function(c,a){var b=document.getElementById(c);\nif(b){b.style.display=\"\"\n}};\nZLoginFactory.isShown=function(b){var a=document.getElementById(b);\nreturn a?(a.style.display!=\"none\"):false\n};\nZLoginFactory.hide=function(b){var a=document.getElementById(b);\nif(a){a.style.display=\"none\"\n}};\nZLoginFactory.get=function(a){return document.getElementById(a)\n};\nZLoginFactory.handleKeyPress=function(g){g=g||window.event;\nif(g==null){return true\n}var e=g.target?g.target:g.srcElement;\nif(!e){return true\n}var j=g.keyCode;\nvar a=false;\nif(j==13){if(e.id==ZLoginFactory.USER_ID||e.id==ZLoginFactory.NEW_PASSWORD_ID){a=true\n}else{var b=ZLoginFactory.get(ZLoginFactory.LOGIN_BUTTON_ID).onclick;\nif(b){b.call(e)\n}ZLoginFactory._cancelEvent(g);\nreturn false\n}}if(a||(j==9)){var h=ZLoginFactory.TAB_ORDER.length-1;\nfor(var c=0;\nc<ZLoginFactory.TAB_ORDER.length;\nc++){if(ZLoginFactory.TAB_ORDER[c]==e.id){h=c;\nbreak\n}}var d=!g.shiftKey;\nvar l=ZLoginFactory._getTabToIndex(h,d);\nvar f=ZLoginFactory.TAB_ORDER[l];\nvar k=ZLoginFactory.TAB_TYPE[l];\nZLoginFactory._onFocusChange(k,f,e);\nZLoginFactory._cancelEvent(g)\n}};\nZLoginFactory._cancelEvent=function(a){if(a.stopPropagation){a.stopPropagation()\n}if(a.preventDefault){a.preventDefault()\n}a.cancelBubble=true;\na.returnValue=false\n};\nZLoginFactory._onFocusChange=function(b,f,e){if(b==ZLoginFactory.TEXT_TYPE){var c=ZLoginFactory.get(f);\nc.focus();\nc.select()\n}else{if(b==ZLoginFactory.CHECKBOX_TYPE){var d=ZLoginFactory.get(f);\nd.focus()\n}else{var a=ZLoginFactory.get(f);\na.focus()\n}}};\nZLoginFactory._getTabToIndex=function(f,a){var b=f;\ndo{var e;\nif(a){b=(b==(ZLoginFactory.TAB_ORDER.length-1))?0:b+1\n}else{b=(b==0)?(ZLoginFactory.TAB_ORDER.length-1):b-1\n}var g=ZLoginFactory.TAB_ORDER[b];\nvar c=ZLoginFactory.VISIBILITY[b];\nvar d=ZLoginFactory.get(g);\nif(ZLoginFactory.isShown(c)&&!ZLoginFactory.get(g).disabled){return b\n}}while(b!=f);\nreturn 0\n};\nZLoginFactory._loginButtonFocus=function(a){a.className=\"DwtButton-focused\"\n};\nZLoginFactory._flickerErrorMessagePanel=function(){ZLoginFactory.getErrorMsgPanel().style.visibility=\"hidden\";\nwindow.setTimeout(ZLoginFactory._showErrorMessagePanel,8)\n};\nZLoginFactory._showErrorMessagePanel=function(){ZLoginFactory.getErrorMsgPanel().style.visibility=\"visible\"\n}\n}if(AjxPackage.define(\"zimbra.common.ZmBaseSplashScreen\")){ZmBaseSplashScreen=function(b,a,c){if(arguments.length==0){return\n}if(!(b instanceof DwtShell)){throw new AjxException(\"Parent must be a DwtShell\",AjxException.INVALIDPARENT,\"ZSplashScreen\")\n}c=c||\"ZSplashScreen\";\nDwtControl.call(this,{parent:b,className:c,posStyle:Dwt.ABSOLUTE_STYLE});\nthis.__createContents()\n};\nZmBaseSplashScreen.prototype=new DwtControl;\nZmBaseSplashScreen.prototype.constructor=ZmBaseSplashScreen;\nZmBaseSplashScreen.prototype.getHtml=function(){};\nZmBaseSplashScreen.prototype.setVisible=function(a){if(a==this.getVisible()){return\n}if(a){this.__createContents()\n}DwtControl.prototype.setVisible.call(this,a);\nif(!a){this.getHtmlElement().innerHTML=\"\"\n}};\nZmBaseSplashScreen.prototype.__createContents=function(){var c=this.getHtmlElement();\nc.style.zIndex=Dwt.Z_SPLASH;\nvar b=document.createElement(\"table\");\nb.border=b.cellSpacing=b.cellPadding=0;\nDwt.setSize(b,\"100%\",\"100%\");\nvar d=b.insertRow(0);\nvar a=d.insertCell(0);\na.vAlign=\"middle\";\na.align=\"center\";\na.innerHTML=this.getHtml();\nc.appendChild(b);\nc.style.cursor=\"wait\"\n}\n}if(AjxPackage.define(\"zimbra.common.ZmErrorDialog\")){ZmErrorDialog=function(b,c){this._strNav=this._getNavigatorInfo();\nthis._subjPfx=this._getSubjectPrefix();\nvar d=new DwtDialog_ButtonDescriptor(ZmErrorDialog.REPORT_BUTTON,c.report,DwtDialog.ALIGN_LEFT);\nvar a=new DwtDialog_ButtonDescriptor(ZmErrorDialog.DETAIL_BUTTON,c.showDetails,DwtDialog.ALIGN_LEFT);\nDwtMessageDialog.call(this,{parent:b,extraButtons:[d,a],id:\"ErrorDialog\"});\nthis.registerCallback(ZmErrorDialog.REPORT_BUTTON,this._reportCallback,this);\nthis.registerCallback(ZmErrorDialog.DETAIL_BUTTON,this.showDetail,this);\nthis._showDetailsMsg=c.showDetails;\nthis._hideDetailsMsg=c.hideDetails;\nthis._setAllowSelection()\n};\nZmErrorDialog.prototype=new DwtMessageDialog;\nZmErrorDialog.prototype.constructor=ZmErrorDialog;\nZmErrorDialog.prototype.toString=function(){return\"ZmErrorDialog\"\n};\nZmErrorDialog.REPORT_BUTTON=\"Report\";\nZmErrorDialog.DETAIL_BUTTON=\"Detail\";\nZmErrorDialog.DEFAULT_REPORT_URL=\"//www.zimbra.com/e/\";\nZmErrorDialog.prototype._detailsVisible=false;\nZmErrorDialog.prototype.CONTROLS_TEMPLATE=\"zimbra.Widgets#ZmErrorDialogControls\";\nZmErrorDialog.prototype.reset=function(){this.setDetailString();\nDwtMessageDialog.prototype.reset.call(this)\n};\nZmErrorDialog.prototype.setDetailString=function(a){if(!(this._button[ZmErrorDialog.DETAIL_BUTTON])){return\n}this._button[ZmErrorDialog.DETAIL_BUTTON].setVisible(a!=null);\nthis._detailStr=a\n};\nZmErrorDialog.prototype.setMessage=function(a,d,b,c){this._msgStr=a;\nthis.setDetailString(d);\nthis._msgStyle=b;\nthis._msgTitle=c;\nthis._detailsVisible=false;\nthis._button[ZmErrorDialog.DETAIL_BUTTON].setText(this._showDetailsMsg);\nthis._updateContent()\n};\nZmErrorDialog.prototype._updateContent=function(){var b={message:this._msgStr,detail:this._detailStr,showDetails:this._detailsVisible};\nvar a=AjxTemplate.expand(\"zimbra.Widgets#ZmErrorDialogContent\",b);\nthis.setSize(Dwt.CLEAR,this._detailsVisible?\"300\":Dwt.CLEAR);\nDwtMessageDialog.prototype.setMessage.call(this,a,this._msgStyle,this._msgTitle)\n};\nZmErrorDialog.prototype.popup=function(a,b){if(b){this.setButtonVisible(ZmErrorDialog.REPORT_BUTTON,false)\n}DwtMessageDialog.prototype.popup.call(this,a)\n};\nZmErrorDialog.prototype.popdown=function(){DwtMessageDialog.prototype.popdown.call(this);\nthis.setSize(Dwt.CLEAR,Dwt.CLEAR);\nthis.setButtonVisible(ZmErrorDialog.REPORT_BUTTON,true)\n};\nZmErrorDialog.prototype._getNavigatorInfo=function(){var c=[];\nvar a=0;\nc[a++]=\"\\n\\n\";\nc[a++]=\"href: \";\nc[a++]=location.href;\nc[a++]=\"\\n\";\nfor(var b in navigator){if(typeof navigator[b]==\"function\"){continue\n}if(typeof navigator[b]==\"unknown\"){continue\n}if(AjxEnv.isIE&&b===\"mimeTypes\"){continue\n}c[a++]=b+\": \"+navigator[b]+\"\\n\"\n}return c.join(\"\")\n};\nZmErrorDialog.prototype._getSubjectPrefix=function(){var b=[];\nvar a=0;\nb[a++]=\"ER: \";\nif(AjxEnv.isIE){b[a++]=\"IE \"\n}else{if(AjxEnv.isFirefox){b[a++]=\"FF \"\n}else{if(AjxEnv.isMozilla){b[a++]=\"MOZ \"\n}else{if(AjxEnv.isSafari){b[a++]=\"SAF \"\n}else{if(AjxEnv.isOpera){b[a++]=\"OPE \"\n}else{b[a++]=\"UKN \"\n}}}}}if(AjxEnv.isWindows){b[a++]=\"WIN \"\n}else{if(AjxEnv.isLinux){b[a++]=\"LNX \"\n}else{if(AjxEnv.isMac){b[a++]=\"MAC \"\n}else{b[a++]=\"UNK \"\n}}}b[a++]=appCtxt.get(ZmSetting.CLIENT_VERSION)+\" \";\nreturn b.join(\"\")\n};\nZmErrorDialog.prototype._getUserPrefs=function(){var d=appCtxt.getCurrentSearch();\nvar c=[];\nvar a=0;\nc[a++]=\"\\n\\n\";\nc[a++]=\"username: \";\nc[a++]=appCtxt.get(ZmSetting.USERNAME);\nc[a++]=\"\\n\";\nif(d){c[a++]=\"currentSearch: \";\nc[a++]=d.query;\nc[a++]=\"\\n\"\n}for(var b in ZmSetting.INIT){if(ZmSetting.INIT[b][0]){c[a++]=ZmSetting.INIT[b][0];\nc[a++]=\": \";\nc[a++]=(\"\"+ZmSetting.INIT[b][3]);\nc[a++]=\"\\n\"\n}}return c.join(\"\")\n};\nZmErrorDialog.prototype._reportCallback=function(){this._iframe=document.createElement(\"iframe\");\nthis._iframe.style.width=this._iframe.style.height=0;\nthis._iframe.style.visibility=\"hidden\";\nvar c=this._getContentDiv();\nc.appendChild(this._iframe);\nvar j=this._getUserPrefs();\nvar h=Dwt.getNextId();\nvar e=[];\nvar g=0;\nvar f=this._subjPfx+this._detailStr.substring(0,40);\nvar b=(location.protocol==\"https:\")?\"https:\":\"http:\";\ne[g++]=\"<html><head></head><body><form id='\";\ne[g++]=h;\ne[g++]=\"' method='POST' action='\";\ne[g++]=b;\ne[g++]=appCtxt.get(ZmSetting.ERROR_REPORT_URL)||ZmErrorDialog.DEFAULT_REPORT_URL;\ne[g++]=\"'>\";\ne[g++]=\"<textarea name='details'>\";\ne[g++]=this._detailStr;\ne[g++]=\"version - \";\ne[g++]=appCtxt.get(ZmSetting.CLIENT_VERSION);\ne[g++]=\"\\n\";\ne[g++]=\"release - \";\ne[g++]=appCtxt.get(ZmSetting.CLIENT_RELEASE);\ne[g++]=\"\\n\";\ne[g++]=\"date - \";\ne[g++]=appCtxt.get(ZmSetting.CLIENT_DATETIME);\ne[g++]=\"</textarea><textarea name='navigator'>\";\ne[g++]=this._strNav;\ne[g++]=\"</textarea><textarea name='prefs'>\";\ne[g++]=j;\ne[g++]=\"</textarea><textarea name='subject'>\";\ne[g++]=f;\ne[g++]=\"</textarea></form></body></html>\";\nvar d=Dwt.getIframeDoc(this._iframe);\nd.open();\nd.write(e.join(\"\"));\nd.close();\nvar a=d.getElementById(h);\nif(a){a.submit();\nappCtxt.setStatusMsg(ZmMsg.errorReportSent)\n}this.popdown()\n};\nZmErrorDialog.prototype.showDetail=function(){this._detailsVisible=!this._detailsVisible;\nthis._updateContent();\nthis._button[ZmErrorDialog.DETAIL_BUTTON].setText(this._detailsVisible?this._hideDetailsMsg:this._showDetailsMsg)\n}\n}if(AjxPackage.define(\"zimbraMail.share.model.ZmAuthenticate\")){ZmAuthenticate=function(){};\nZmAuthenticate.prototype.isZmAuthenticate=true;\nZmAuthenticate.prototype.toString=function(){return\"ZmAuthenticate\"\n};\nZmAuthenticate._isAdmin=false;\nZmAuthenticate.setAdmin=function(a){ZmAuthenticate._isAdmin=a\n};\nZmAuthenticate.prototype.execute=function(a,e,g){var d=new ZmCsfeCommand();\nvar c;\nif(!ZmAuthenticate._isAdmin){c=AjxSoapDoc.create(\"AuthRequest\",\"urn:zimbraAccount\");\nvar b=c.set(\"account\",a);\nb.setAttribute(\"by\",\"name\")\n}else{c=AjxSoapDoc.create(\"AuthRequest\",\"urn:zimbraAdmin\",null);\nc.set(\"name\",a)\n}c.set(\"virtualHost\",location.hostname);\nc.set(\"password\",e);\nvar f=new AjxCallback(this,this._handleResponseExecute,g);\nd.invoke({soapDoc:c,noAuthToken:true,noSession:true,asyncMode:true,callback:f})\n};\nZmAuthenticate.prototype._handleResponseExecute=function(b,a){if(!a.isException()){ZmCsfeCommand.noAuth=false\n}if(b){b.run(a)\n}}\n}if(AjxPackage.define(\"zimbraMail.share.model.ZmAutocomplete\")){ZmAutocomplete=function(d){if(arguments.length==0){return\n}if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)){var c=this._settingChangeListener.bind(this);\nvar b=[ZmSetting.GAL_AUTOCOMPLETE,ZmSetting.AUTOCOMPLETE_SHARE,ZmSetting.AUTOCOMPLETE_SHARED_ADDR_BOOKS];\nfor(var a=0;\na<b.length;\na++){appCtxt.getSettings().getSetting(b[a]).addChangeListener(c)\n}}};\nZmAutocomplete.AC_VALUE_FULL=\"fullAddress\";\nZmAutocomplete.AC_VALUE_EMAIL=\"email\";\nZmAutocomplete.AC_VALUE_NAME=\"name\";\nZmAutocomplete.AC_TIMEOUT=20;\nZmAutocomplete.AC_TYPE_CONTACT=\"contact\";\nZmAutocomplete.AC_TYPE_GAL=\"gal\";\nZmAutocomplete.AC_TYPE_TABLE=\"rankingTable\";\nZmAutocomplete.AC_TYPE_UNKNOWN=\"unknown\";\nZmAutocomplete.AC_TYPE_LOCATION=\"Location\";\nZmAutocomplete.AC_TYPE_EQUIPMENT=\"Equipment\";\nZmAutocomplete.AC_ICON={};\nZmAutocomplete.AC_ICON[ZmAutocomplete.AC_TYPE_CONTACT]=\"Contact\";\nZmAutocomplete.AC_ICON[ZmAutocomplete.AC_TYPE_GAL]=\"GALContact\";\nZmAutocomplete.AC_ICON[ZmAutocomplete.AC_TYPE_LOCATION]=\"Location\";\nZmAutocomplete.AC_ICON[ZmAutocomplete.AC_TYPE_EQUIPMENT]=\"Resource\";\nZmAutocomplete.GAL_RESULTS_TTL=900000;\nZmAutocomplete.prototype.toString=function(){return\"ZmAutocomplete\"\n};\nZmAutocomplete.prototype.autocompleteMatch=function(g,h,b,a,f,e){g=g.toLowerCase().replace(/\"/g,\"\");\nthis._curAcStr=g;\nvar c=(a&&(a.acType||a.type))||ZmAutocomplete.AC_TYPE_CONTACT;\nvar d=this._checkCache(g,c,f);\nif(!g||(d!==null)){h(d)\n}else{b.setWaiting(true,g);\nreturn this._doSearch(g,b,a,c,h,f,e)\n}};\nZmAutocomplete.prototype._doSearch=function(g,d,l,a,j,e,b){var c={query:g,isAutocompleteSearch:true};\nif(a!=ZmAutocomplete.AC_TYPE_CONTACT){c.isGalAutocompleteSearch=true;\nc.isAutocompleteSearch=false;\nc.limit=c.limit*2;\nvar f=((a===ZmAutocomplete.AC_TYPE_LOCATION)||(a===ZmAutocomplete.AC_TYPE_EQUIPMENT))?ZmItem.RESOURCE:ZmItem.CONTACT;\nc.types=AjxVector.fromArray([f]);\nc.galType=c.galType||ZmSearch.GAL_RESOURCE\n}else{}c.accountName=e&&e.name;\nvar k=new ZmSearch(c);\nvar h={callback:this._handleResponseDoAutocomplete.bind(this,g,d,l,a,j,e),errorCallback:this._handleErrorDoAutocomplete.bind(this,g,d),timeout:ZmAutocomplete.AC_TIMEOUT,noBusyOverlay:true};\nif(b){h.autocompleteType=b\n}h.offlineCallback=this._handleOfflineDoAutocomplete.bind(this,g,k,h.callback);\nreturn k.execute(h)\n};\nZmAutocomplete.prototype._handleResponseDoAutocomplete=function(m,j,p,b,o,k,q){j.setWaiting(false);\nvar c,h=false,g=false;\nvar d=q.getResponse();\nif(d&&d.search&&d.search.isGalAutocompleteSearch){var n=d.getResults(d.type);\nc=(n&&n.getArray())||[];\nh=g=true\n}else{c=d._respEl.match||[]\n}var l=[];\nfor(var e=0;\ne<c.length;\ne++){var f=new ZmAutocompleteMatch(c[e],p,h,m);\nif(f.acType==b){if(p.excludeGroups&&f.isGroup){continue\n}if(f.type==ZmAutocomplete.AC_TYPE_GAL){g=true\n}l.push(f)\n}}var a=!(d&&d.getAttribute(\"more\"));\no(l);\nthis._cacheResults(m,b,l,g,a&&d._respEl.canBeCached,null,k)\n};\nZmAutocomplete.prototype._handleErrorDoAutocomplete=function(c,b,a){b.setWaiting(false);\nappCtxt.setStatusMsg({msg:ZmMsg.autocompleteFailed,level:ZmStatusView.LEVEL_WARNING});\nreturn true\n};\nZmAutocomplete.prototype._handleOfflineDoAutocomplete=function(c,b,d){if(c){var a=this._handleOfflineResponseDoAutocomplete.bind(this,b,d);\nZmOfflineDB.searchContactsForAutoComplete(c,a)\n}};\nZmAutocomplete.prototype._handleOfflineResponseDoAutocomplete=function(e,g,a){var c=[];\na.forEach(function(h){var j=h._attrs;\nif(j){var k={id:h.id,l:h.l};\nif(j.fullName){var l=j.fullName\n}else{var l=[];\nif(j.firstName){l.push(j.firstName)\n}if(j.middleName){l.push(j.middleName)\n}if(j.lastName){l.push(j.lastName)\n}l=l.join(\" \")\n}if(j.email){k.email='\"'+l+'\" <'+j.email+\">\"\n}else{if(j.type===\"group\"){k.display=l;\nk.type=ZmAutocomplete.AC_TYPE_CONTACT;\nk.exp=true;\nk.isGroup=true\n}}c.push(k)\n}});\nif(g){var d=new ZmSearchResult(e);\nvar b={match:c};\nd.set(b);\nvar f=new ZmCsfeResult(d);\ng(f)\n}};\nZmAutocomplete.acSortCompare=function(d,c){var f=(d&&d.score)||0;\nvar e=(c&&c.score)||0;\nreturn(f>e)?1:(f<e)?-1:0\n};\nZmAutocomplete.prototype.isComplete=function(a){return AjxEmailAddress.isValid(a)\n};\nZmAutocomplete.prototype.forget=function(e,d){var c={RankingActionRequest:{_jsns:\"urn:zimbraMail\"}};\nc.RankingActionRequest.action={op:\"delete\",email:e};\nvar b=this._handleResponseForget.bind(this,d);\nvar a=appCtxt.isChildWindow?parentAppCtxt:appCtxt;\na.getRequestMgr().sendRequest({jsonObj:c,asyncMode:true,callback:b})\n};\nZmAutocomplete.prototype._handleResponseForget=function(a){appCtxt.clearAutocompleteCache(ZmAutocomplete.AC_TYPE_CONTACT);\nif(appCtxt.isChildWindow){parentAppCtxt.clearAutocompleteCache(ZmAutocomplete.AC_TYPE_CONTACT)\n}if(a){a()\n}};\nZmAutocomplete.prototype.expandDL=function(a,b,d){var c=this._handleResponseExpandDL.bind(this,a,d);\na.getDLMembers(b,null,c)\n};\nZmAutocomplete.prototype._handleResponseExpandDL=function(d,h,j){var f=j.list;\nvar c=[];\nif(f&&f.length){for(var a=0,e=f.length;\na<e;\na++){var g=f[a];\nvar b={};\nb.type=ZmAutocomplete.AC_TYPE_GAL;\nb.email=g;\nb.isGroup=j.isDL[g];\nc.push(new ZmAutocompleteMatch(b,null,false,d&&d.str))\n}}if(h){h(c)\n}};\nZmAutocomplete.prototype._getCache=function(c,e,d,b){var a=AjxEnv.isIE?window.appCtxt:window.parentAppCtxt||window.appCtxt;\nreturn a.getAutocompleteCache(c,e,d,b)\n};\nZmAutocomplete.prototype._cacheResults=function(g,d,f,c,a,h,e){var b=this._getCache(d,g,e,true);\nb.list=f;\nb.cacheable=(h&&h.cacheable)||a;\nif(c){b.ts=(h&&h.ts)||(new Date()).getTime()\n}};\nZmAutocomplete.prototype._checkCache=function(e,b,d){var a=this._getCachedResults(e,b,null,d);\nvar c=a&&a.list;\nif(c!==null){return c\n}return null\n};\nZmAutocomplete.prototype._getCachedResults=function(f,d,a,e){var b=this._getCache(d,f,e);\nif(b){if(a&&(b.cacheable===false)){return null\n}if(b.ts){var c=(new Date()).getTime();\nif(c>(b.ts+ZmAutocomplete.GAL_RESULTS_TTL)){return null\n}}return b\n}else{return null\n}};\nZmAutocomplete.prototype._settingChangeListener=function(b){if(b.type!=ZmEvent.S_SETTING){return\n}var a=AjxEnv.isIE?window.appCtxt:window.parentAppCtxt||window.appCtxt;\na.clearAutocompleteCache(ZmAutocomplete.AC_TYPE_CONTACT)\n};\nZmAutocompleteMatch=function(d,k,a,g){AjxDispatcher.require([\"MailCore\",\"CalendarCore\"]);\nif(!d){return\n}this.type=d.type;\nthis.str=g;\nvar j=window.parentAppCtxt||window.appCtxt;\nif(a){this.text=this.name=d.getFullName();\nthis.email=d.getEmail();\nthis.item=d;\nthis.type=ZmContact.getAttr(d,ZmResource&&ZmResource.F_type||\"zimbraCalResType\")||ZmAutocomplete.AC_TYPE_GAL;\nthis.fullAddress=(new AjxEmailAddress(this.email,null,this.text)).toString()\n}else{this.isGroup=Boolean(d.isGroup);\nthis.isDL=(this.isGroup&&this.type==ZmAutocomplete.AC_TYPE_GAL);\nif(this.isGroup&&!this.isDL){var c=j.cacheGet(d.id);\nif(c&&c.isLoaded){this.setContactGroupMembers(d.id)\n}else{this.needDerefGroup=true;\nthis.groupId=d.id\n}this.name=d.display;\nthis.text=d.display||this.email;\nthis.icon=\"Group\"\n}else{var f=AjxEmailAddress.parse(d.email);\nif(f){this.email=f.getAddress();\nif(this.type==ZmAutocomplete.AC_TYPE_CONTACT){var b=AjxDispatcher.run(\"GetContacts\");\nvar e=b&&b.getById(d.id);\nif(e){var h=e&&e.getFullNameForDisplay(false);\nthis.fullAddress='\"'+h+'\" <'+f.getAddress()+\">\";\nthis.name=h;\nthis.text=this.fullAddress\n}else{this.fullAddress=f.toString();\nthis.name=f.getName();\nthis.email=f.getAddress();\nthis.text=this.fullAddress\n}}else{this.fullAddress=f.toString();\nthis.name=f.getName();\nthis.text=d.email\n}}else{this.email=d.email;\nthis.text=d.email\n}if(k&&k.needItem&&window.ZmContact){this.item=new ZmContact(null);\nthis.item.initFromEmail(f||d.email)\n}this.icon=this.isDL?\"Group\":ZmAutocomplete.AC_ICON[d.type];\nthis.canExpand=this.isDL&&d.exp;\nj.setIsExpandableDL(this.email,this.canExpand)\n}}this.score=(d.ranking&&parseInt(d.ranking))||0;\nthis.icon=this.icon||ZmAutocomplete.AC_ICON[ZmAutocomplete.AC_TYPE_CONTACT];\nthis.acType=(this.type==ZmAutocomplete.AC_TYPE_LOCATION||this.type==ZmAutocomplete.AC_TYPE_EQUIPMENT)?this.type:ZmAutocomplete.AC_TYPE_CONTACT;\nif(this.type==ZmAutocomplete.AC_TYPE_LOCATION||this.type==ZmAutocomplete.AC_TYPE_EQUIPMENT){this.icon=ZmAutocomplete.AC_ICON[this.type]\n}};\nZmAutocompleteMatch.prototype.setContactGroupMembers=function(c,j){var k=window.parentAppCtxt||window.appCtxt;\nvar f=k.cacheGet(c);\nif(f){var a=f.getGroupMembers();\nvar b=(a&&a.good&&a.good.getArray())||[];\nvar e=[],g=[];\nfor(var d=0;\nd<b.length;\nd++){var h=b[d];\ne.push(h.getAddress());\ng.push(h.toString())\n}this.email=e.join(AjxEmailAddress.SEPARATOR);\nthis.fullAddress=g.join(AjxEmailAddress.SEPARATOR)\n}if(j){j.run()\n}};\nZmAutocompleteMatch.prototype.toString=function(){return\"ZmAutocompleteMatch\"\n};\nZmAutocompleteMatch.prototype.matches=function(g){if(this.name&&!this._nameParsed){var e=this.name.split(/\\s+/,3);\nvar c=e[0];\nthis._lastName=e[e.length-1];\nthis._firstLast=[c,this._lastName].join(\" \");\nthis._nameParsed=true\n}var a=[this.email,this.name,this._lastName,this._firstLast];\nfor(var b=0;\nb<a.length;\nb++){var d=a[b]&&a[b].toLowerCase();\nif(d&&(d.indexOf(g)==0)){return true\n}}return false\n};\nZmSearchAutocomplete=function(){this._op={};\nthis._list={};\nthis._loadFunc={};\nvar c={loader:this._loadTags,text:function(d){return d.getName(false,null,true,true)\n},icon:function(d){return d.getIconWithColor()\n},matchText:function(d){return d.createQuery()\n}};\nthis._registerHandler(\"tag\",c);\nc={listType:ZmId.ORG_FOLDER,text:function(d){return d.getPath(false,false,null,true,false)\n},icon:function(d){return d.getIconWithColor()\n},matchText:function(d){return d.createQuery()\n}};\nthis._loadFunc[ZmId.ORG_FOLDER]=this._loadFolders;\nthis._registerHandler(\"in\",c);\nc.matchText=function(d){return'under:\"'+d.getPath()+'\"'\n};\nthis._registerHandler(\"under\",c);\nc={loader:this._loadFlags};\nthis._registerHandler(\"is\",c);\nc={loader:this._loadObjects,icon:function(d){return ZmSearchAutocomplete.ICON[d]\n}};\nthis._registerHandler(\"has\",c);\nthis._loadFunc[ZmId.ITEM_ATT]=this._loadTypes;\nc={listType:ZmId.ITEM_ATT,text:function(d){return d.desc\n},icon:function(d){return d.image\n},matchText:function(d){return\"type:\"+(d.query||d.type)\n},quoteMatch:true};\nthis._registerHandler(\"type\",c);\nc={listType:ZmId.ITEM_ATT,text:function(d){return d.desc\n},icon:function(d){return d.image\n},matchText:function(d){return\"attachment:\"+(d.query||d.type)\n},quoteMatch:true};\nthis._registerHandler(\"attachment\",c);\nc={loader:this._loadCommands};\nthis._registerHandler(\"set\",c);\nvar b=appCtxt.getFolderTree();\nif(b){b.addChangeListener(this._folderTreeChangeListener.bind(this))\n}var a=appCtxt.getTagTree();\nif(a){a.addChangeListener(this._tagTreeChangeListener.bind(this))\n}};\nZmSearchAutocomplete.prototype.isZmSearchAutocomplete=true;\nZmSearchAutocomplete.prototype.toString=function(){return\"ZmSearchAutocomplete\"\n};\nZmSearchAutocomplete.ICON={};\nZmSearchAutocomplete.ICON.attachment=\"Attachment\";\nZmSearchAutocomplete.ICON.phone=\"Telephone\";\nZmSearchAutocomplete.ICON.url=\"URL\";\nZmSearchAutocomplete.prototype._registerHandler=function(c,a){var b=a.loader||this._loadFunc[a.listType];\nthis._op[c]={loader:b.bind(this),text:a.text,icon:a.icon,listType:a.listType||c,matchText:a.matchText||a.text,quoteMatch:a.quoteMatch}\n};\nZmSearchAutocomplete.prototype.autocompleteMatch=function(f,h,d,k){if(ZmSearchAutocomplete._ignoreNextKey){ZmSearchAutocomplete._ignoreNextKey=false;\nreturn\n}f=f.toLowerCase().replace(/\"/g,\"\");\nvar g=f.lastIndexOf(\" \");\nif(g!=-1&&g<=f.length){f=f.substr(g+1)\n}var b=f.match(/\\b-?\\$?([a-z]+):/);\nif(!(b&&b.length)){h();\nreturn\n}var c=b[1];\nvar a=this._op[c];\nif(!a){h();\nreturn\n}var e=this._list[a.listType];\nif(e){h(this._getMatches(c,f))\n}else{var j=this._handleResponseLoad.bind(this,c,f,h);\nthis._list[a.listType]=[];\na.loader(a.listType,j)\n}};\nZmSearchAutocomplete.prototype.isComplete=function(d,b){var a=new ZmParsedQuery(d);\nvar c=a.getTokens();\nif(!a.parseFailed&&c&&(c.length==1)){return b?c[0].toString():true\n}else{return false\n}};\nZmSearchAutocomplete.prototype.getAddedBubbleClass=function(c){var a=new ZmParsedQuery(c);\nvar b=a.getTokens();\nreturn(!a.parseFailed&&b&&(b.length==1)&&b[0].type)\n};\nZmSearchAutocomplete.prototype._getMatches=function(h,m){var a=this._op[h];\nvar f=[],d;\nvar k=this._list[a.listType];\nvar c=m.substr(m.indexOf(\":\")+1);\nif(a.listType==ZmId.ORG_FOLDER){c=c.replace(/^\\//,\"\");\nd=appCtxt.getCurrentAppName();\nif(!ZmApp.ORGANIZER[d]){d=null\n}}for(var g=0,j=k.length;\ng<j;\ng++){var b=k[g];\nvar n=a.text?a.text(b):b;\nvar l=n.toLowerCase();\nif(d&&ZmOrganizer.APP[b.type]!=d){continue\n}if(!c||(l.indexOf(c)==0)){var e=a.matchText?a.matchText(b):a.quoteMatch?[h,\":\",'\"',n,'\"'].join(\"\"):[h,\":\",n].join(\"\");\ne=m.replace(h+\":\"+c,e);\nf.push({text:n,icon:a.icon?a.icon(b):null,matchText:e,exactMatch:(l.length==c.length)})\n}}if(f.length==1&&f[0].exactMatch){f=[]\n}return f\n};\nZmSearchAutocomplete.prototype._handleResponseLoad=function(c,a,b){b(this._getMatches(c,a))\n};\nZmSearchAutocomplete.prototype._loadTags=function(e,g){var f=this._list[e];\nvar c=appCtxt.getTagTree().asList();\nfor(var d=0,b=c.length;\nd<b;\nd++){var a=c[d];\nif(a.id!=ZmOrganizer.ID_ROOT){f.push(a)\n}}f.sort(ZmTag.sortCompare);\nif(g){g()\n}};\nZmSearchAutocomplete.prototype._loadFolders=function(d,h){var g=this._list[d];\nvar f=appCtxt.getFolderTree();\nvar c=f?f.asList({includeRemote:true}):[];\nfor(var b=0,a=c.length;\nb<a;\nb++){var e=c[b];\nif(e.id!==ZmOrganizer.ID_ROOT&&!ZmFolder.HIDE_ID[e.id]&&e.id!==ZmFolder.ID_DLS){g.push(e)\n}}g.sort(ZmFolder.sortComparePath);\nif(h){h()\n}};\nZmSearchAutocomplete.prototype._loadFlags=function(b,c){var a=AjxUtil.filter(ZmParsedQuery.IS_VALUES,function(d){return appCtxt.checkPrecondition(ZmParsedQuery.IS_VALUE_PRECONDITION[d])\n});\nthis._list[b]=a.sort();\nif(c){c()\n}};\nZmSearchAutocomplete.prototype._loadObjects=function(c,e){var d=this._list[c];\nd.push(\"attachment\");\nvar a=appCtxt.getZimletMgr().getIndexedZimlets();\nif(a.length){for(var b=0;\nb<a.length;\nb++){d.push(a[b].keyword)\n}}d.sort();\nif(e){e()\n}};\nZmSearchAutocomplete.prototype._loadTypes=function(b,d){AjxDispatcher.require(\"Extras\");\nvar a=new ZmAttachmentTypeList();\nvar c=this._handleResponseLoadTypes.bind(this,a,b,d);\na.load(c)\n};\nZmSearchAutocomplete.prototype._handleResponseLoadTypes=function(a,b,c){this._list[b]=a.getAttachments();\nif(c){c()\n}};\nZmSearchAutocomplete.prototype._loadCommands=function(a,d){var b=this._list[a];\nfor(var c in ZmClientCmdHandler.prototype){if(c.indexOf(\"execute_\")==0){b.push(c.substr(8))\n}}b.sort();\nif(d){d()\n}};\nZmSearchAutocomplete.prototype._folderTreeChangeListener=function(c){var a=c.getDetail(\"fields\");\nif(c.event==ZmEvent.E_DELETE||c.event==ZmEvent.E_CREATE||c.event==ZmEvent.E_MOVE||((c.event==ZmEvent.E_MODIFY)&&a&&a[ZmOrganizer.F_NAME])){var b=ZmId.ORG_FOLDER;\nif(this._list[b]){this._list[b]=[];\nthis._loadFolders(b)\n}}};\nZmSearchAutocomplete.prototype._tagTreeChangeListener=function(c){var a=c.getDetail(\"fields\");\nif(c.event==ZmEvent.E_DELETE||c.event==ZmEvent.E_CREATE||c.event==ZmEvent.E_MOVE||((c.event==ZmEvent.E_MODIFY)&&a&&a[ZmOrganizer.F_NAME])){var b=\"tag\";\nif(this._list[b]){this._list[b]=[];\nthis._loadTags(b)\n}}};\nZmPeopleSearchAutocomplete=function(){};\nZmPeopleSearchAutocomplete.prototype=new ZmAutocomplete;\nZmPeopleSearchAutocomplete.prototype.constructor=ZmPeopleSearchAutocomplete;\nZmPeopleSearchAutocomplete.prototype.toString=function(){return\"ZmPeopleSearchAutocomplete\"\n};\nZmPeopleSearchAutocomplete.prototype._doSearch=function(e,c,j,a,g,d){var b={query:e,types:AjxVector.fromArray([ZmItem.CONTACT]),sortBy:ZmSearch.NAME_ASC,contactSource:ZmId.SEARCH_GAL,accountName:d&&d.name};\nvar h=new ZmSearch(b);\nvar f={callback:this._handleResponseDoAutocomplete.bind(this,e,c,j,a,g,d),errorCallback:this._handleErrorDoAutocomplete.bind(this,e,c),timeout:ZmAutocomplete.AC_TIMEOUT,noBusyOverlay:true};\nreturn h.execute(f)\n};\nZmPeopleSearchAutocomplete.prototype._handleResponseDoAutocomplete=function(k,g,n,b,m,h,o){if(k!=this._curAcStr){return\n}var d=o.getResponse();\nvar l=d.getResults(ZmItem.CONTACT);\nvar c=(l&&l.getArray())||[];\nvar j=[];\nfor(var e=0;\ne<c.length;\ne++){var f=new ZmAutocompleteMatch(c[e],n,true);\nj.push(f)\n}var a=!(d&&d.getAttribute(\"more\"));\nm(j);\nthis._cacheResults(k,b,j,true,a&&d._respEl.canBeCached,null,h)\n}\n}if(AjxPackage.define(\"zimbraMail.share.model.ZmInvite\")){ZmInvite=function(){ZmModel.call(this)\n};\nZmInvite.prototype=new ZmModel;\nZmInvite.prototype.constructor=ZmInvite;\nZmInvite.CHANGES_LOCATION=\"location\";\nZmInvite.CHANGES_SUBJECT=\"subject\";\nZmInvite.CHANGES_RECURRENCE=\"recurrence\";\nZmInvite.CHANGES_TIME=\"time\";\nZmInvite.TASK=\"task\";\nZmInvite.prototype.toString=function(){return\"ZmInvite: name=\"+this.name+\" id=\"+this.id\n};\nZmInvite._sendFun=null;\nZmInvite.createFromDom=function(e){var b=new ZmInvite();\nb.components=e[0].comp;\nb.replies=e[0].replies;\nb.id=e[0].id;\nif(b.components==null){b.components=[{}];\nb.components.empty=true\n}var a=e[0];\nif(a.tz){for(var d=0;\nd<a.tz.length;\nd++){var h=a.tz[d];\nvar f=AjxTimezone.getRule(h.id);\nif(!f){var g={standard:h.standard?AjxUtil.createProxy(h.standard[0]):{},daylight:h.daylight?AjxUtil.createProxy(h.daylight[0]):null};\ng.standard.offset=h.stdoff;\ndelete g.standard._object_;\nif(h.daylight){g.daylight.offset=h.dayoff;\ndelete g.daylight._object_\n}f=AjxTimezone.getRule(h.id,g);\nif(f){var c=AjxUtil.createProxy(f);\nc.aliasId=f.clientId;\nc.clientId=h.id;\nc.serverId=h.id;\nAjxTimezone.addRule(c)\n}}if(!f){f={clientId:h.id,serverId:h.id,autoDetected:true};\nif(h.daylight){f.standard=AjxUtil.createProxy(h.standard[0]);\nf.standard.offset=h.stdoff;\nf.standard.trans=AjxTimezone.createTransitionDate(f.standard);\nf.daylight=AjxUtil.createProxy(h.daylight[0]);\nf.daylight.offset=h.dayoff;\nf.daylight.trans=AjxTimezone.createTransitionDate(f.daylight)\n}else{f.standard={offset:h.stdoff}\n}AjxTimezone.addRule(f)\n}}}b.type=a&&a.type?a.type:\"appt\";\nreturn b\n};\nZmInvite.prototype.setMessageId=function(a){this.msgId=a\n};\nZmInvite.prototype.getMessageId=function(){return this.msgId\n};\nZmInvite.prototype.getComponent=function(a){return this.components[a]\n};\nZmInvite.prototype.getComponents=function(){return this.components\n};\nZmInvite.prototype.hasMultipleComponents=function(){return(this.components.length>1)\n};\nZmInvite.prototype.hasOtherAttendees=function(a){var b=a||0;\nreturn this.components[b].at&&this.components[b].at.length>0\n};\nZmInvite.prototype.hasOtherIndividualAttendees=function(d){var e=d||0;\nvar a=this.components[e].at;\nvar c=false;\nif(a&&a.length){for(var b=0;\nb<a.length;\nb++){if(!a[b].cutype||(a[b].cutype==ZmCalendarApp.CUTYPE_INDIVIDUAL)){c=true;\nbreak\n}}}return c\n};\nZmInvite.prototype.getEventName=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].name:null\n};\nZmInvite.prototype.getAlarm=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].alarm:null\n};\nZmInvite.prototype.getInviteMethod=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].method:null\n};\nZmInvite.prototype.getSequenceNo=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].seq:null\n};\nZmInvite.prototype.getOrganizerEmail=function(a){var b=a||0;\nreturn(this.components[b]&&this.components[b].or&&this.components[b].or.url)?(this.components[b].or.url.replace(\"MAILTO:\",\"\")):null\n};\nZmInvite.prototype.getOrganizerName=function(a){var b=a||0;\nreturn(this.components[b]&&this.components[b].or)?(this.components[b].or.d||this.components[b].or.url):null\n};\nZmInvite.prototype.getSentBy=function(a){var b=a||0;\nreturn(this.components[b]&&this.components[b].or)?this.components[b].or.sentBy:null\n};\nZmInvite.prototype.isOrganizer=function(a){var b=a||0;\nreturn this.components[b]?(!!this.components[b].isOrg):false\n};\nZmInvite.prototype.shouldRsvp=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].rsvp:null\n};\nZmInvite.prototype.getRecurrenceRules=function(a){var b=a||0;\nreturn this.components[b].recur\n};\nZmInvite.prototype.getAttendees=function(c){var e=c||0;\nvar a=this.components[e].at;\nvar d=[];\nif(!(a&&a.length)){return d\n}for(var b=0;\nb<a.length;\nb++){if(!a[b].cutype||(a[b].cutype==ZmCalendarApp.CUTYPE_INDIVIDUAL)){d.push(a[b])\n}}return d\n};\nZmInvite.prototype.getReplies=function(a){var b=a||0;\nreturn(this.replies&&this.replies[b])?this.replies[b].reply:null\n};\nZmInvite.prototype.getResources=function(c){var e=c||0;\nvar a=this.components[e].at;\nvar d=[];\nif(!(a&&a.length)){return d\n}for(var b=0;\nb<a.length;\nb++){if(a[b].cutype==ZmCalendarApp.CUTYPE_RESOURCE||a[b].cutype==ZmCalendarApp.CUTYPE_ROOM){d.push(a[b])\n}}return d\n};\nZmInvite.prototype.getExceptId=function(a){var b=a||0;\nreturn(this.components[b]&&this.components[b].exceptId)?this.components[b].exceptId[0]:null\n};\nZmInvite.prototype.getAppointmentId=function(a){var b=a||0;\nreturn this.components[b].apptId\n};\nZmInvite.prototype.getStatus=function(a){var b=a||0;\nreturn this.components[b].status\n};\nZmInvite.prototype.getTransparency=function(a){var b=a||0;\nreturn this.components[b].transp\n};\nZmInvite.prototype.isEmpty=function(){return Boolean(this.components.empty)\n};\nZmInvite.prototype.isException=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].ex:false\n};\nZmInvite.prototype.isRecurring=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].recur:false\n};\nZmInvite.prototype.isAllDayEvent=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].allDay==\"1\":false\n};\nZmInvite.prototype.isMultiDay=function(b){var d=b||0;\nvar c=this.getServerStartDate(d);\nvar a=this.getServerEndDate(d);\nif(!c){return false\n}return(c.getDate()!=a.getDate())||(c.getMonth()!=a.getMonth())||(c.getFullYear()!=a.getFullYear())\n};\nZmInvite.prototype.getComponentDescriptionHtml=function(b){var h=b||0;\nvar a=this.components[h];\nif(a==null){return\n}var f=a.descHtml;\nvar d=f&&f[0]._content||null;\nif(!d){var c=a.desc;\nc=(c&&c[0]._content)||null;\nd=c?AjxStringUtil.convertToHtml(c):null;\nif(!d){var e=appCtxt.getById(this.getMessageId());\nif(e&&e.hasContentType){d=e.hasContentType(ZmMimeTable.TEXT_HTML)?e.getBodyContent(ZmMimeTable.TEXT_HTML):null;\nif(!d){c=e.getTextBodyPart();\nd=c?AjxStringUtil.convertToHtml(c):null\n}}}if(!d){d=this.getApptSummary(true)\n}}if(!d){var g=this.getComponentComment();\nd=g&&AjxStringUtil.convertToHtml(g)\n}return d\n};\nZmInvite.prototype.getComponentDescription=function(b){var f=b||0;\nvar a=this.components[f];\nif(a==null){return\n}var d=a.desc;\nvar c=d&&d[0]._content||null;\nif(!c){c=this.getComponentComment()\n}if(!c){var e=a.descHtml;\ne=(e&&e[0]._content)||null;\nif(!e&&this.type!=ZmInvite.TASK){c=this.getApptSummary()\n}}return c\n};\nZmInvite.prototype.getComponentComment=function(b){var d=b||0;\nvar a=this.components[d];\nif(a==null){return\n}var c=a.comment;\nreturn c&&c[0]._content||null\n};\nZmInvite.prototype.getServerEndTime=function(j){var l=j||0;\nif(this.components[l]==null){return\n}if(this._serverEndTime==null){if(this.components[l].e!=null){this._serverEndTime=this.components[l].e[0].d\n}else{if(this.components[l].s){var b=this.components[l].dur;\nvar n=b&&b[0].d||0;\nvar a=b&&b[0].w||0;\nvar e=b&&b[0].h||0;\nvar f=b&&b[0].m||0;\nvar p=b&&b[0].s||0;\nvar o=parseInt(p)+(parseInt(f)*60)+(parseInt(e)*3600)+(parseInt(n)*24*3600)+(parseInt(a)*7*24*3600);\nvar c=this.components[l].s[0].d;\nvar g=parseInt(c.substr(0,4),10);\nvar m=parseInt(c.substr(4,2),10);\nvar n=parseInt(c.substr(6,2),10);\nvar k=new Date(g,m-1,n);\nif(c.charAt(8)==\"T\"){e=parseInt(c.substr(9,2),10);\nf=parseInt(c.substr(11,2),10);\np=parseInt(c.substr(13,2),10);\nk.setHours(e,f,p,0)\n}var h=new Date(k.getTime()+(o*1000));\nm=AjxDateUtil._pad(k.getMonth()+1);\nn=AjxDateUtil._pad(k.getDate());\ne=AjxDateUtil._pad(k.getHours());\nf=AjxDateUtil._pad(k.getMinutes());\np=AjxDateUtil._pad(k.getSeconds());\ng=k.getFullYear();\nthis._serverEndTime=[g,m,n,\"T\",e,f,p].join(\"\")\n}}}return this._serverEndTime\n};\nZmInvite.prototype.getServerEndDate=function(b,a){var c=b||0;\nreturn AjxDateUtil.parseServerDateTime(this.getServerEndTime(c),a)\n};\nZmInvite.prototype.getServerStartTime=function(a){var b=a||0;\nreturn this.components[b]&&this.components[b].s?this.components[b].s[0].d:null\n};\nZmInvite.prototype.getServerStartDate=function(b,a){var c=b||0;\nreturn AjxDateUtil.parseServerDateTime(this.getServerStartTime(c),a)\n};\nZmInvite.prototype.getStartDateFromExceptId=function(a){var b=a||0;\nreturn AjxDateUtil.parseServerDateTime(this.components[b]&&this.components[b].exceptId?this.components[b].exceptId[0].d:null)\n};\nZmInvite.prototype.getServerStartTimeTz=function(a){var c=a||0;\nif(this.components[c]==null){return\n}if(this._serverStartTimeZone==null){var b=this.getServerStartTime();\nthis._serverStartTimeZone=b&&b.charAt(b.length-1)==\"Z\"?AjxTimezone.GMT_NO_DST:(this.components[c].s?this.components[c].s[0].tz:null)\n}return this._serverStartTimeZone\n};\nZmInvite.prototype.getServerEndTimeTz=function(b){var d=b||0;\nvar c=this.components[d]&&this.components[d].e;\nif(!c){return null\n}if(!this._serverEndTimeZone){var a=this.getServerEndTime();\nthis._serverEndTimeZone=(a&&a.charAt(a.length-1)==\"Z\")?AjxTimezone.GMT_NO_DST:c[0].tz\n}return this._serverEndTimeZone\n};\nZmInvite.prototype.getDurationText=function(n,r,b,h,d,k){var p=this.components[n];\nvar o=d||this.getServerStartDate(n);\nvar j=k||this.getServerEndDate(n);\nif(!o&&!j){return\"\"\n}if(this.isAllDayEvent(n)){if(r){return\"\"\n}if(this.isMultiDay(n)){var g=AjxDateFormat.getDateInstance();\nvar m=g.format(o);\nvar c=g.format(j);\nif(!ZmInvite._daysFormatter){ZmInvite._daysFormatter=new AjxMessageFormat(ZmMsg.durationDays)\n}return ZmInvite._daysFormatter.format([m,c])\n}return o?AjxDateFormat.getDateInstance(AjxDateFormat.FULL).format(o):\"\"\n}var g=AjxDateFormat.getDateInstance(AjxDateFormat.FULL);\nvar f=AjxDateFormat.getTimeInstance(AjxDateFormat.SHORT);\nvar q=o?[g.format(o),h?\" \":\"<br>\"]:[];\nif(b){q.push(o?f.format(o):\"\")\n}else{var e=o?f.format(o):\"\";\nvar l=f.format(j);\nif(!ZmInvite._hoursFormatter){ZmInvite._hoursFormatter=new AjxMessageFormat(ZmMsg.durationHours)\n}q.push(ZmInvite._hoursFormatter.format([e,l]))\n}return q.join(\"\")\n};\nZmInvite.prototype.getName=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].name:null\n};\nZmInvite.prototype.getFreeBusy=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].fb:null\n};\nZmInvite.prototype.getPrivacy=function(a){var b=a||0;\nreturn this.components[b]?this.components[b][\"class\"]:null\n};\nZmInvite.prototype.getXProp=function(a){var b=a||0;\nreturn this.components[b]?this.components[b][\"xprop\"]:null\n};\nZmInvite.prototype.getLocation=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].loc:null\n};\nZmInvite.prototype.getRecurrenceId=function(a){var b=a||0;\nreturn this.components[b]?this.components[b].ridZ:null\n};\nZmInvite.prototype.getToolTip=function(){if(this._toolTip){return this._toolTip\n}var d=0;\nvar c=[];\nvar b=0;\nc[b++]=\"<table cellpadding=0 cellspacing=0 border=0 >\";\nc[b++]=\"<tr valign='center'><td colspan=2 align='left'>\";\nc[b++]=\"<div style='border-bottom: 1px solid black;'>\";\nc[b++]=\"<table cellpadding=0 cellspacing=0 border=0 width=100%>\";\nc[b++]=\"<tr valign='center'><td><b>\";\nc[b++]=\"<div style='white-space:nowrap'><table border=0 cellpadding=0 cellspacing=0 style='display:inline'><tr>\";\nif(this.hasOtherAttendees(d)){c[b++]=\"<td>\";\nc[b++]=AjxImg.getImageHtml(\"ApptMeeting\");\nc[b++]=\"</td>\"\n}if(this.isException(d)){c[b++]=\"<td>\";\nc[b++]=AjxImg.getImageHtml(\"ApptException\");\nc[b++]=\"</td>\"\n}else{if(this.isRecurring(d)){c[b++]=\"<td>\";\nc[b++]=AjxImg.getImageHtml(\"ApptRecur\");\nc[b++]=\"</td>\"\n}}c[b++]=\"</tr></table>&nbsp;\";\nc[b++]=AjxStringUtil.htmlEncode(this.getName(d));\nc[b++]=\"&nbsp;</div></b></td><td align='right'>\";\nc[b++]=AjxImg.getImageHtml(\"Appointment\");\nc[b++]=\"</td></table></div></td></tr>\";\nvar a=this.getDurationText(d,false,false);\nb=this._addEntryRow(ZmMsg.when,a,c,b,false,null,true);\nif(this.isRecurring(d)){if(!this._recurBlurb){AjxDispatcher.require([\"MailCore\",\"CalendarCore\"]);\nvar e=new ZmRecurrence();\ne.parse(this.getRecurrenceRules(d));\nthis._recurBlurb=e.getBlurb()\n}b=this._addEntryRow(ZmMsg.repeats,this._recurBlurb,c,b,true,null,true)\n}b=this._addEntryRow(ZmMsg.location,this.getLocation(d),c,b,false);\nc[b++]=\"</table>\";\nthis._toolTip=c.join(\"\");\nreturn this._toolTip\n};\nZmInvite.prototype.getApptSummary=function(a){var c=appCtxt.getById(this.getMessageId());\nvar b;\nif(c){AjxDispatcher.require([\"MailCore\",\"CalendarCore\"]);\nb=new ZmAppt();\nb.setFromMessage(c)\n}return b?b.getSummary(a):this.getSummary(a)\n};\nZmInvite.prototype.getSummary=function(a){if(this.isRecurring()){if(!this._recurBlurb){AjxDispatcher.require([\"MailCore\",\"CalendarCore\"]);\nvar e=new ZmRecurrence();\ne.setRecurrenceRules(this.getRecurrenceRules(),this.getServerStartDate());\nthis._recurBlurb=e.getBlurb()\n}}var b=[];\nvar d=0;\nif(!this._summaryHtmlLineFormatter){this._summaryHtmlLineFormatter=new AjxMessageFormat(\"<tr><th align='left'>{0}</th><td>{1} {2}</td></tr>\");\nthis._summaryTextLineFormatter=new AjxMessageFormat(\"{0} {1} {2}\")\n}var j=a?this._summaryHtmlLineFormatter:this._summaryTextLineFormatter;\nvar c=[];\nif(a){b[d++]=\"<p>\\n<table border='0'>\\n\"\n}var g=AjxStringUtil.htmlEncode(this.getOrganizerName());\nif(g){c=[ZmMsg.organizerLabel,g,\"\"];\nb[d++]=j.format(c);\nb[d++]=\"\\n\"\n}var h=this.getDurationText(0,false,false,true);\nif(h){c=[ZmMsg.whenLabel,h,\"\"];\nb[d++]=j.format(c);\nb[d++]=\"\\n\"\n}var f=AjxStringUtil.htmlEncode(this.getLocation());\nif(f){c=[ZmMsg.locationLabel,f,\"\"];\nb[d++]=j.format(c);\nb[d++]=\"\\n\"\n}if(this._recurBlurb){c=[ZmMsg.repeatLabel,this._recurBlurb,\"\"];\nb[d++]=j.format(c);\nb[d++]=\"\\n\"\n}if(a){b[d++]=\"</table>\\n\"\n}b[d++]=a?\"<div>\":\"\\n\\n\";\nb[d++]=ZmItem.NOTES_SEPARATOR;\nb[d++]=a?\"</div><br>\":\"\\n\\n\";\nreturn b.join(\"\")\n};\nZmInvite.prototype._addEntryRow=function(g,f,b,a,e,d,c){if(f!=null&&f!=\"\"){b[a++]=\"<tr valign='top'><td align='right' style='padding-right: 5px;'><b><div style='white-space:nowrap'>\";\nb[a++]=AjxMessageFormat.format(ZmMsg.makeLabel,AjxStringUtil.htmlEncode(g));\nb[a++]=\"</div></b></td><td align='left'><div style='white-space:\";\nb[a++]=e?\"wrap;\":\"nowrap;\";\nif(d){b[a++]=\"width:\";\nb[a++]=d;\nb[a++]=\"px;\"\n}b[a++]=\"'>\";\nb[a++]=c?f:AjxStringUtil.htmlEncode(f);\nb[a++]=\"</div></td></tr>\"\n}return a\n};\nZmInvite.prototype.hasAcceptableComponents=function(){for(var a in this.components){if(this.getStatus(a)!=ZmCalendarApp.STATUS_CANC){return true\n}}return false\n};\nZmInvite.prototype.hasInviteReplyMethod=function(b){var a=this.getInviteMethod(b);\nvar c=(a==ZmCalendarApp.METHOD_REQUEST||a==ZmCalendarApp.METHOD_PUBLISH);\nreturn((a==null)||c)\n};\nZmInvite.prototype.hasCounterMethod=function(a){return(this.getInviteMethod(a)==ZmCalendarApp.METHOD_COUNTER)\n};\nZmInvite.prototype.getProposedTimeStr=function(b){var a=this.getInviteMethod(b);\nif(a==ZmCalendarApp.METHOD_COUNTER){return this.getDurationText(b,false,false,true)\n}return\"\"\n};\nZmInvite.prototype.getChanges=function(c){var f=c||0;\nvar e=this.components[f]&&this.components[f].changes;\nvar a=e&&e.split(\",\");\nif(a&&a.length>0){var d={};\nfor(var b=0;\nb<a.length;\nb++){d[a[b]]=true\n}return d\n}return null\n};\nZmInvite.prototype.hasAttendeeResponse=function(){var a=this.getAttendees();\nreturn(a.length>0&&a[0].ptst!=ZmCalBaseItem.PSTATUS_NEEDS_ACTION)\n};\nZmInvite.prototype.isHtmlInvite=function(){var a=this.getComponent(0);\nvar b=a&&a.descHtml;\nreturn(b&&b[0]&&b[0]._content)?true:false\n}\n}if(AjxPackage.define(\"zimbraMail.share.model.ZmSystemRetentionPolicy\")){ZmSystemRetentionPolicy=function(){};\nZmSystemRetentionPolicy.prototype.constructor=ZmSystemRetentionPolicy;\nZmSystemRetentionPolicy.prototype.toString=function(){return\"ZmSystemRetentionPolicy\"\n};\nZmSystemRetentionPolicy.prototype.getKeepPolicies=function(){return this._keepPolicies\n};\nZmSystemRetentionPolicy.prototype.getPurgePolicies=function(){return this._purgePolicies\n};\nZmSystemRetentionPolicy.prototype.getPolicies=function(e,a){this._keepPolicies=new Array();\nthis._purgePolicies=new Array();\nvar d={GetSystemRetentionPolicyRequest:{_jsns:\"urn:zimbraMail\"}};\nvar b=d.GetSystemRetentionPolicyRequest;\nvar c=this._handleResponseGetPolicies.bind(this,e);\nif(a){a.addRequestParams(d,c)\n}else{appCtxt.getRequestMgr().sendRequest({jsonObj:d,asyncMode:true,callback:c})\n}};\nZmSystemRetentionPolicy.prototype._handleResponseGetPolicies=function(c,a){var b=a.getResponse().GetSystemRetentionPolicyResponse;\nif(b.retentionPolicy){if(b.retentionPolicy[0].keep&&b.retentionPolicy[0].keep[0]&&b.retentionPolicy[0].keep[0].policy){this._keepPolicies=b.retentionPolicy[0].keep[0].policy\n}if(b.retentionPolicy[0].purge&&b.retentionPolicy[0].purge[0]&&b.retentionPolicy[0].purge[0].policy){this._purgePolicies=b.retentionPolicy[0].purge[0].policy\n}}if(c){c.run(this._keepPolicies,this._purgePolicies)\n}}\n}if(AjxPackage.define(\"zimbraMail.share.view.ZmAutocompleteListView\")){ZmAutocompleteListView=function(d){if(arguments.length==0){return\n}d.parent=d.parent||appCtxt.getShell();\nd.className=d.className||\"ZmAutocompleteListView\";\nd.posStyle=DwtControl.ABSOLUTE_STYLE;\nd.id=d.contextId?DwtId.makeId(ZmId.WIDGET_AUTOCOMPLETE,d.contextId):this._htmlElId||Dwt.getNextId(\"ZmAutocompleteListView_\");\nDwtComposite.call(this,d);\nthis._dataClass=this._dataAPI=d.dataClass;\nthis._dataLoader=d.dataLoader;\nthis._dataLoaded=false;\nthis._matchValue=d.matchValue;\nthis._selectionCallback=d.selectionCallback;\nthis._separator=(d.separator!=null)?d.separator:AjxEmailAddress.SEPARATOR;\nthis._options=d.options||{};\nthis._locationCallback=d.locationCallback;\nthis._autocompleteType=d.autocompleteType;\nthis._callbacks={};\nfor(var a=0;\na<ZmAutocompleteListView.CALLBACKS.length;\na++){this._setCallbacks(ZmAutocompleteListView.CALLBACKS[a],d)\n}this._isDelim=AjxUtil.arrayAsHash(d.delims||ZmAutocompleteListView.DELIMS);\nthis._isDelimCode=AjxUtil.arrayAsHash(d.delimCodes||ZmAutocompleteListView.DELIM_CODES);\nif(!d.delims&&!d.delimCodes){this._isDelim[\",\"]=this._isDelimCode[188]=appCtxt.get(ZmSetting.AUTOCOMPLETE_ON_COMMA);\nvar b=new AjxListener(this,this._settingChangeListener);\nvar c=appCtxt.getSettings().getSetting(ZmSetting.AUTOCOMPLETE_ON_COMMA);\nif(c){c.addChangeListener(b)\n}}this._setMouseEventHdlrs();\nthis.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._mouseDownListener));\nthis.addListener(DwtEvent.ONMOUSEOVER,new AjxListener(this,this._mouseOverListener));\nthis._addSelectionListener(new AjxListener(this,this._listSelectionListener));\nthis._outsideListener=new AjxListener(null,ZmAutocompleteListView._outsideMouseDownListener);\nthis._acInterval=appCtxt.get(ZmSetting.AC_TIMER_INTERVAL);\nthis._acActionId={};\nif(AjxEnv.isGeckoBased){this._focusAction=new AjxTimedAction(null,this._autocompleteFocus)\n}this._origClass=\"acRow\";\nthis._selClass=\"acRow-selected\";\nthis._showLinkTextClass=\"LinkText\";\nthis._hideLinkTextClass=\"LinkText-hide\";\nthis._hideSelLinkTextClass=\"LinkText-hide-selected\";\nthis._contexts={};\nthis._inputValue={};\nthis.setVisible(false);\nthis.setScrollStyle(Dwt.SCROLL);\nthis.reset()\n};\nZmAutocompleteListView.prototype=new DwtComposite;\nZmAutocompleteListView.prototype.constructor=ZmAutocompleteListView;\nZmAutocompleteListView.prototype.toString=function(){return\"ZmAutocompleteListView\"\n};\nZmAutocompleteListView.CB_ADDR_FOUND=\"addrFound\";\nZmAutocompleteListView.CB_COMPLETION=\"comp\";\nZmAutocompleteListView.CB_KEYDOWN=\"keyDown\";\nZmAutocompleteListView.CB_KEYPRESS=\"keyPress\";\nZmAutocompleteListView.CB_KEYUP=\"keyUp\";\nZmAutocompleteListView.CALLBACKS=[ZmAutocompleteListView.CB_ADDR_FOUND,ZmAutocompleteListView.CB_COMPLETION,ZmAutocompleteListView.CB_KEYDOWN,ZmAutocompleteListView.CB_KEYPRESS,ZmAutocompleteListView.CB_KEYUP];\nZmAutocompleteListView.DELIMS=[\",\",\";\",\"\\n\",\"\\r\"];\nZmAutocompleteListView.DELIM_CODES=[DwtKeyEvent.KEY_COMMA,DwtKeyEvent.KEY_SEMICOLON,DwtKeyEvent.KEY_SEMICOLON_1,DwtKeyEvent.KEY_END_OF_TEXT,DwtKeyEvent.KEY_RETURN];\nZmAutocompleteListView.WAIT_ID=\"wait\";\nZmAutocompleteListView.NEXT=-1;\nZmAutocompleteListView.PREV=-2;\nZmAutocompleteListView.STATE_NEW=\"NEW\";\nZmAutocompleteListView.STATE_REQUEST=\"REQUEST\";\nZmAutocompleteListView.STATE_RESPONSE=\"RESPONSE\";\nZmAutocompleteListView.STATE_DONE=\"DONE\";\nZmAutocompleteListView.onKeyDown=function(g){g=DwtUiEvent.getEvent(g);\nvar e=DwtKeyEvent.getCharCode(g);\nvar b=true;\nvar d=DwtUiEvent.getTargetWithProp(g,\"_aclvId\");\nvar c=d&&DwtControl.ALL_BY_ID[d._aclvId];\nif(c){var a=(!g.shiftKey&&(c._isDelimCode[e]||(e===DwtKeyEvent.KEY_TAB&&c.getVisible())));\nvar h=c.getVisible();\nc._actionHandled=false;\nif(h&&c.handleAction(e,a,d)){c._actionHandled=true;\nb=false\n}c._inputValue[d.id]=d.value;\nvar f=c._runCallbacks(ZmAutocompleteListView.CB_KEYDOWN,d&&d.id,[g,c,b,d]);\nb=(f===true||f===false)?f:b\n}if(AjxEnv.isFirefox){ZmAutocompleteListView.clearTimer();\nZmAutocompleteListView.timer=new AjxTimedAction(this,ZmAutocompleteListView.onKeyUp,[g]);\nAjxTimedAction.scheduleAction(ZmAutocompleteListView.timer,300)\n}return ZmAutocompleteListView._echoKey(b,g)\n};\nZmAutocompleteListView.onKeyPress=function(f){f=DwtUiEvent.getEvent(f);\nDwtKeyEvent.geckoCheck(f);\nvar a=true;\nvar d=DwtKeyEvent.getCharCode(f);\nvar c=DwtUiEvent.getTargetWithProp(f,\"_aclvId\");\nvar b=c&&DwtControl.ALL_BY_ID[c._aclvId];\nif(b){if(b._actionHandled){a=false\n}var e=b._runCallbacks(ZmAutocompleteListView.CB_KEYPRESS,c&&c.id,[f,b,a,c]);\na=(e===true||e===false)?e:true\n}return ZmAutocompleteListView._echoKey(a,f)\n};\nZmAutocompleteListView.onKeyUp=function(f){f=DwtUiEvent.getEvent(f);\nvar a=true;\nvar d=DwtKeyEvent.getCharCode(f);\nvar c=DwtUiEvent.getTargetWithProp(f,\"_aclvId\");\nvar b=c&&DwtControl.ALL_BY_ID[c._aclvId];\nif(b){if(b._actionHandled){a=false\n}var a=ZmAutocompleteListView._onKeyUp(f);\nvar e=b._runCallbacks(ZmAutocompleteListView.CB_KEYUP,c&&c.id,[f,b,a,c]);\na=(e===true||e===false)?e:a\n}return ZmAutocompleteListView._echoKey(a,f)\n};\nZmAutocompleteListView._onKeyUp=function(f){var c=DwtUiEvent.getTargetWithProp(f,\"_aclvId\");\nif(!c){return ZmAutocompleteListView._echoKey(true,f)\n}var d=DwtControl.ALL_BY_ID[c._aclvId];\nvar j=DwtKeyEvent.getCharCode(f);\nvar h=c.value;\nvar b=c.id;\nf.inputChanged=(h!=d._inputValue[b]);\nif(d._acActionId[b]!==-1&&!DwtKeyMap.IS_MODIFIER[j]&&j!==DwtKeyEvent.KEY_TAB){AjxTimedAction.cancelAction(d._acActionId[b]);\nd._acActionId[b]=-1\n}if(DwtKeyMap.IS_MODIFIER[j]||DwtKeyMapMgr.hasModifier(f)){return true\n}if(!h&&d._currentContext&&c==d._currentContext.element){d.reset(c);\nreturn true\n}if(DwtKeyEvent.IS_RETURN[j]&&d._complete(c)){return false\n}if(!f.inputChanged){return true\n}ZmAutocompleteListView.clearTimer();\nvar g=new DwtKeyEvent();\nDwtKeyEvent.copy(g,f);\ng.aclv=d;\ng.element=c;\nvar a=DwtControl.ALL_BY_ID[c._aifId];\nif(a&&a._editMode){return false\n}var e=new AjxTimedAction(d,d._autocompleteAction,[g]);\nd._acActionId[b]=AjxTimedAction.scheduleAction(e,d._acInterval);\nreturn true\n};\nZmAutocompleteListView.clearTimer=function(a){if(ZmAutocompleteListView.timer){AjxTimedAction.cancelAction(ZmAutocompleteListView.timer)\n}};\nZmAutocompleteListView._echoKey=function(a,b){DwtUiEvent.setBehaviour(b,!a,a);\nreturn a\n};\nZmAutocompleteListView._outsideMouseDownListener=function(c,a){var b=a&&a.obj;\nif(b){b.show(false);\nb.setWaiting(false)\n}};\nZmAutocompleteListView.prototype.setActiveAccount=function(a){this._activeAccount=a\n};\nZmAutocompleteListView.prototype.handle=function(b,c){var a=b.id=b.id||Dwt.getNextId();\nb._aclvId=this._htmlElId;\nif(c){b._aifId=c\n}this._contexts[a]={};\nthis._acActionId[a]=-1;\nDwt.setHandler(b,DwtEvent.ONKEYDOWN,ZmAutocompleteListView.onKeyDown);\nDwt.setHandler(b,DwtEvent.ONKEYPRESS,ZmAutocompleteListView.onKeyPress);\nDwt.setHandler(b,DwtEvent.ONKEYUP,ZmAutocompleteListView.onKeyUp);\nif(AjxEnv.isFirefox){var d=DwtControl.findControl(b);\nif(d&&d.getInputElement&&d.getInputElement()===b){d.addListener(DwtEvent.ONBLUR,ZmAutocompleteListView.clearTimer)\n}else{Dwt.setHandler(b,DwtEvent.ONBLUR,ZmAutocompleteListView.clearTimer)\n}}this.isActive=true\n};\nZmAutocompleteListView.prototype.unhandle=function(a){Dwt.clearHandler(a,DwtEvent.ONKEYDOWN);\nDwt.clearHandler(a,DwtEvent.ONKEYPRESS);\nDwt.clearHandler(a,DwtEvent.ONKEYUP);\nthis.isActive=false\n};\nZmAutocompleteListView.prototype.autocomplete=function(b){if(this._dataLoader&&!this._dataLoaded){this._data=this._dataLoader.call(this._dataClass);\nthis._dataAPI=this._data;\nthis._dataLoaded=true\n}var a=this._parseInput(b);\nthis._process(a,b)\n};\nZmAutocompleteListView.prototype._complete=function(c){var d=c.value;\nif(this._dataAPI.isComplete&&this._dataAPI.isComplete(d)){var a=this._parseInput(c)[0];\nvar b={element:c,str:a.str,isAddress:true,isComplete:a.isComplete,key:this._getKey(a)};\nthis._update(b);\nthis.reset(c);\nreturn true\n}return false\n};\nZmAutocompleteListView.prototype._parseInput=function(e){var d=[];\nvar h=e&&e.value;\nif(!h){return d\n}var g=\"\";\nfor(var b=0;\nb<h.length;\nb++){var j=h.charAt(b);\nif(j==\" \"&&!g){continue\n}var a=this._isDelim[j];\nif(a||j==\" \"){var f=(this._dataAPI.isComplete&&this._dataAPI.isComplete(g,true));\nif(f){f=(f===true)?g:f;\nd.push({element:e,str:f,isComplete:true,isAddress:true});\ng=\"\"\n}else{if(j==\";\"){d.push({element:e,str:g,isComplete:true});\ng=\"\"\n}else{g+=j\n}}}else{g+=j\n}}if(g){d.push({str:g,isComplete:false})\n}return d\n};\nZmAutocompleteListView.prototype._process=function(c,d){var b={};\nfor(var e=0;\ne<c.length;\ne++){var k=this._getKey(c[e]);\nb[k]=true\n}var l={};\nvar j=this._contexts[d.id];\nif(j&&j.length){for(var e=0;\ne<j.length;\ne++){var a=j[e];\nvar k=a.key;\nif(k&&a.reqId&&a.state==ZmAutocompleteListView.STATE_REQUEST&&!b[k]){appCtxt.getAppController().cancelRequest(a.reqId);\na.state=ZmAutocompleteListView.STATE_DONE;\nif(a.str==this._waitingStr){this.setWaiting(false)\n}}else{if(a.state==ZmAutocompleteListView.STATE_REQUEST){l[a.key]=a\n}}}}var f=[];\nfor(var e=0;\ne<c.length;\ne++){var m=c[e];\nvar h=m.str;\nvar k=this._getKey(m);\nvar g=l[k];\nif(g){f.push(g)\n}else{var a={element:d,str:h,isComplete:m.isComplete,key:k,isAddress:m.isAddress,state:ZmAutocompleteListView.STATE_NEW};\nf.push(a);\nif(m.isAddress){this._update(a)\n}else{this._autocomplete(a)\n}}}this._contexts[d.id]=f\n};\nZmAutocompleteListView.prototype._getKey=function(a){return a.str+(a.isComplete?this._separator:\"\")\n};\nZmAutocompleteListView.prototype.reset=function(a){this._matches=null;\nthis._selected=null;\nthis._matchHash={};\nthis._forgetLink={};\nthis._expandLink={};\nthis.show(false);\nif(this._memberListView){this._memberListView.show(false)\n}this.setWaiting(false);\nif(a){this._removeDoneRequests(a)\n}};\nZmAutocompleteListView.prototype.handleAction=function(d,a,c){if(a){this._update()\n}else{if(d===DwtKeyEvent.KEY_ARROW_RIGHT){var b=this._expandText&&this._expandText[this._selected];\nif(!b||Dwt.getSelectionStart(c)!==c.value.length){return false\n}b.notifyListeners(DwtEvent.ONMOUSEDOWN)\n}else{if(d===DwtKeyEvent.KEY_ARROW_UP||d===DwtKeyEvent.KEY_ARROW_DOWN){if(this.size()<1){return\n}if(d===DwtKeyEvent.KEY_ARROW_DOWN){this._setSelected(ZmAutocompleteListView.NEXT)\n}else{if(d===DwtKeyEvent.KEY_ARROW_UP){this._setSelected(ZmAutocompleteListView.PREV)\n}}}else{if(d===DwtKeyEvent.KEY_ESCAPE){if(this.getVisible()){this.reset(c)\n}else{if(!this._cancelPendingRequests(c)){return false\n}}}else{if(d===DwtKeyEvent.KEY_TAB){this._popdown();\nreturn false\n}else{return false\n}}}}}return true\n};\nZmAutocompleteListView.prototype._cancelPendingRequests=function(d){var c=false;\nvar e=this._contexts[d.id];\nif(e&&e.length){for(var b=0;\nb<e.length;\nb++){var a=e[b];\nif(a.state==ZmAutocompleteListView.STATE_REQUEST){appCtxt.getAppController().cancelRequest(a.reqId);\na.state=ZmAutocompleteListView.STATE_DONE;\nc=true\n}}}this.setWaiting(false);\nreturn c\n};\nZmAutocompleteListView.prototype._removeDoneRequests=function(c){var e=this._contexts[c.id];\nvar d=[];\nif(e&&e.length){for(var b=0;\nb<e.length;\nb++){var a=e[b];\nif(a.state==ZmAutocompleteListView.STATE_DONE){d.push(a)\n}}}this._contexts[c.id]=d\n};\nZmAutocompleteListView.prototype.setWaiting=function(b,e){if(!b&&!this._waitingDiv){return\n}var f=this._waitingDiv;\nif(!f){f=this._waitingDiv=document.createElement(\"div\");\nf.className=\"acWaiting\";\nvar c=[],a=0;\nc[a++]=\"<table role='presentation' cellpadding=0 cellspacing=0 border=0>\";\nc[a++]=\"<tr>\";\nc[a++]=\"<td><div class='ImgSpinner'></div></td>\";\nc[a++]=\"<td>\"+ZmMsg.autocompleteWaiting+\"</td>\";\nc[a++]=\"</tr>\";\nc[a++]=\"</table>\";\nf.innerHTML=c.join(\"\");\nDwt.setPosition(f,Dwt.ABSOLUTE_STYLE);\nappCtxt.getShell().getHtmlElement().appendChild(f)\n}if(b){this._popdown();\nvar d=this._getDefaultLoc();\nDwt.setLocation(f,d.x,d.y);\nthis._setLiveRegionText(ZmMsg.autocompleteWaiting)\n}this._waitingStr=b?e:\"\";\nDwt.setZIndex(f,b?Dwt.Z_DIALOG_MENU:Dwt.Z_HIDDEN);\nDwt.setVisible(f,b)\n};\nZmAutocompleteListView.prototype._autocompleteAction=function(b){var a=b.aclv;\na._acActionId[b.element.id]=-1;\na.autocomplete(b.element)\n};\nZmAutocompleteListView.prototype.show=function(a,b){if(a){this.setWaiting(false);\nthis._popup(b)\n}else{this._popdown()\n}};\nZmAutocompleteListView.prototype._autocomplete=function(a){var b=AjxStringUtil.trim(a.str);\nif(!b||!(this._dataAPI&&this._dataAPI.autocompleteMatch)){return\n}this._currentContext=a;\nvar c=this._handleResponseAutocomplete.bind(this,a);\na.state=ZmAutocompleteListView.STATE_REQUEST;\na.reqId=this._dataAPI.autocompleteMatch(b,c,this,this._options,this._activeAccount,this._autocompleteType)\n};\nZmAutocompleteListView.prototype._handleResponseAutocomplete=function(a,b){a.state=ZmAutocompleteListView.STATE_RESPONSE;\nif(b&&b.length){a.list=b;\nif(a.isComplete){this._update(a,b[0])\n}else{this._set(b,a);\nthis._currentContext=a;\nthis.show(true)\n}}else{if(!a.isComplete){this._popdown();\nthis._showNoResults();\nvar c=AjxMessageFormat.format(ZmMsg.autocompleteMatches,0);\nthis._setLiveRegionText(c)\n}}};\nZmAutocompleteListView.prototype._getCompletionValue=function(b){var d=\"\";\nif(this._matchValue instanceof Array){for(var c=0,a=this._matchValue.length;\nc<a;\nc++){if(b[this._matchValue[c]]){d=b[this._matchValue[c]];\nbreak\n}}}else{d=b[this._matchValue]||\"\"\n}return d\n};\nZmAutocompleteListView.prototype._update=function(c,b){c=c||this._currentContext;\nif(!c){return\n}b=b||this._matchHash[this._selected];\nif(b&&b.needDerefGroup){var a=new ZmContact(b.groupId,{});\nvar e=new AjxCallback(this,this._updateContinuation,[c,b]);\nvar d=new AjxCallback(b,b.setContactGroupMembers,[b.groupId,e]);\na.load(d,null,null,true)\n}else{this._updateContinuation(c,b)\n}};\nZmAutocompleteListView.prototype._updateContinuation=function(b,h){var g=\"\";\nvar j=b.address=b.address||(b.isAddress&&b.str)||(h&&this._getCompletionValue(h));\nvar d=this._addBubble(b,h,b.isComplete);\nif(!d){g=j+this._separator\n}var c=b.element;\nif(c){if(!b.add){var f=this._parseInput(c);\nvar a=\"\";\nfor(var e=0;\ne<f.length;\ne++){var l=f[e];\nvar k=this._getKey(l);\nif(b.key===k||c.value===k){a+=g\n}else{a+=k\n}}if(d){a=AjxStringUtil.trim(a)\n}if(c.value!==a){c.value=a\n}}if(!b.isComplete){c.focus();\nthis.reset(c)\n}}b.state=ZmAutocompleteListView.STATE_DONE;\nthis._runCallbacks(ZmAutocompleteListView.CB_COMPLETION,c&&c.id,[j,c,h])\n};\nZmAutocompleteListView.prototype._addBubble=function(a,f,e){var c=a.element;\nvar h=c&&c._aifId&&DwtControl.ALL_BY_ID[c._aifId];\nif(h){var b=h.getBubbleCount();\nif(f&&f.multipleAddresses){h.addValue(a.address)\n}else{var g=this._dataAPI&&this._dataAPI.getAddedBubbleClass&&this._dataAPI.getAddedBubbleClass(a.str);\nvar j={address:a.address,match:f,noFocus:e,addClass:g,noParse:this._options.noBubbleParse};\nh.addBubble(j)\n}var d=AjxMessageFormat.format(ZmMsg.autocompleteAddressesAdded,h.getBubbleCount()-b);\nthis._setLiveRegionText(d);\nc=h._input;\nif(AjxEnv.isIE){AjxTimedAction.scheduleAction(new AjxTimedAction(h,h.focus),0)\n}return true\n}else{return false\n}};\nZmAutocompleteListView.prototype._mouseDownListener=function(a){a=DwtUiEvent.getEvent(a);\nvar c=DwtUiEvent.getTargetWithProp(a,\"id\");\nif(!c||!c.id||c.id.indexOf(\"Row\")===-1){return\n}if(a.button==DwtMouseEvent.LEFT){this._setSelected(c.id);\nif(this.isListenerRegistered(DwtEvent.SELECTION)){var b=DwtShell.selectionEvent;\nDwtUiEvent.copy(b,a);\nb.detail=0;\nthis.notifyListeners(DwtEvent.SELECTION,b);\nreturn true\n}}};\nZmAutocompleteListView.prototype._mouseOverListener=function(a){a=DwtUiEvent.getEvent(a);\nvar b=Dwt.findAncestor(DwtUiEvent.getTarget(a),\"id\");\nif(b){this._setSelected(b.id)\n}return true\n};\nZmAutocompleteListView.prototype._addSelectionListener=function(a){this._eventMgr.addListener(DwtEvent.SELECTION,a)\n};\nZmAutocompleteListView.prototype._listSelectionListener=function(a){this._update()\n};\nZmAutocompleteListView.prototype._getTable=function(){var c=this._tableId&&document.getElementById(this._tableId);\nif(!c){var b=[],a=0;\nthis._tableId=this.getHTMLElId()+\"_table\";\nb[a++]=\"<table role='presentation' id='\"+this._tableId+\"' cellpadding=0 cellspacing=0 border=0>\";\nb[a++]=\"</table>\";\nthis.getHtmlElement().innerHTML=b.join(\"\");\nc=document.getElementById(this._tableId)\n}return c\n};\nZmAutocompleteListView.prototype._setLiveRegionText=function(b){var d=this.getHTMLElId()+\"_liveRegion\";\nvar a=Dwt.byId(d);\nif(!a){a=document.createElement(\"div\");\na.id=d;\na.className=\"ScreenReaderOnly\";\na.setAttribute(\"role\",\"alert\");\na.setAttribute(\"aria-label\",ZmMsg.autocomplete);\na.setAttribute(\"aria-live\",\"assertive\");\na.setAttribute(\"aria-relevant\",\"additions\");\na.setAttribute(\"aria-atomic\",true);\nappCtxt.getShell().getHtmlElement().appendChild(a)\n}Dwt.removeChildren(a);\nif(b){var c=document.createElement(\"p\");\nc.appendChild(document.createTextNode(b));\na.appendChild(c)\n}};\nZmAutocompleteListView.prototype._set=function(k,b){this._removeAll();\nvar n=this._getTable();\nthis._matches=k;\nvar a=(this._options.supportForget!==false);\nvar e=(this._options.supportExpand!==false);\nvar j=this._matches.length;\nfor(var f=0;\nf<j;\nf++){var h=this._matches[f];\nif(h&&(h.text||h.icon)){var d=h.id=this._getId(\"Row\",f);\nthis._matchHash[d]=h;\nvar o=n.insertRow(-1);\no.className=this._origClass;\no.id=d;\no.index=f;\nvar g=[],l=0;\nvar m=o.insertCell(-1);\nm.className=\"AutocompleteMatchIcon\";\nif(h.icon){m.innerHTML=(h.icon.indexOf(\"Dwt\")!==-1)?[\"<div class='\",h.icon,\"'></div>\"].join(\"\"):AjxImg.getImageHtml(h.icon)\n}else{m.innerHTML=\"&nbsp;\"\n}m=o.insertCell(-1);\nm.innerHTML=AjxStringUtil.htmlEncode(h.text)||\"&nbsp;\";\nif(a){this._insertLinkCell(this._forgetLink,o,d,this._getId(\"Forget\",f),(h.score>0))\n}if(e){this._insertLinkCell(this._expandLink,o,d,this._getId(\"Expand\",f),h.canExpand)\n}}}if(a){this._forgetText={};\nthis._addLinks(this._forgetText,\"Forget\",ZmMsg.forget,ZmMsg.forgetTooltip,this._handleForgetLink,b)\n}if(e){this._expandText={};\nthis._addLinks(this._expandText,\"Expand\",ZmMsg.expand,ZmMsg.expandTooltip,this.expandDL,b)\n}var c=AjxMessageFormat.format(ZmMsg.autocompleteMatches,j);\nthis._setLiveRegionText(c);\nAjxTimedAction.scheduleAction(new AjxTimedAction(this,function(){this._setSelected(this._getId(\"Row\",0))\n}),100)\n};\nZmAutocompleteListView.prototype._showNoResults=function(){};\nZmAutocompleteListView.prototype._insertLinkCell=function(c,f,b,e,d){c[b]=d?e:null;\nvar a=f.insertCell(-1);\na.className=\"Link\";\na.innerHTML=d?\"<a id='\"+e+\"'></a>\":\"\"\n};\nZmAutocompleteListView.prototype._getId=function(b,a){return[this._htmlElId,\"ac\"+b,a].join(\"_\")\n};\nZmAutocompleteListView.prototype._addLinks=function(g,a,k,p,o,b){var h=this._matches.length;\nfor(var e=0;\ne<h;\ne++){var f=this._matches[e];\nvar d=f.id=this._getId(\"Row\",e);\nvar l=this._getId(a,e);\nvar j=document.getElementById(l);\nif(j){var n=this._getId(a+\"Text\",e);\nvar m=new DwtText({parent:this,className:this._hideLinkTextClass,id:n});\ng[d]=m;\nm.isLinkText=true;\nm.setText(k);\nm.setToolTipContent(p);\nvar c=o.bind(this,{email:f.email,textId:n,rowId:d,element:b.element});\nm.addListener(DwtEvent.ONMOUSEDOWN,c);\nm.reparentHtmlElement(j)\n}}};\nZmAutocompleteListView.prototype._showLink=function(d,a,c,b){var e=a&&a[c];\nif(e){e.setClassName(!b?this._hideLinkTextClass:d[c]?this._showLinkTextClass:this._hideSelLinkTextClass)\n}};\nZmAutocompleteListView.prototype._popup=function(e){if(this.getVisible()){return\n}e=e||this._getDefaultLoc();\nvar j=e.x;\nvar f=e.y;\nvar g=this.shell.getSize();\nvar l=g.y-f;\nvar h=this.size()*this._getRowHeight();\nthis.setLocation(Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);\nthis.setVisible(true);\nvar b=this.getSize();\nif(l<h){this._showMoreResultsText(l);\nthis.setSize(Dwt.DEFAULT,l-(AjxEnv.isIE?30:10));\nvar c=this.getHtmlElement();\nif(c.clientWidth!=c.scrollWidth){this.setSize(b.x+Dwt.SCROLLBAR_WIDTH,Dwt.DEFAULT)\n}}else{if(b.y<h){this.setSize(Dwt.CLEAR,h)\n}else{this.setSize(Dwt.CLEAR,Dwt.CLEAR)\n}}var a=(j+b.x>=g.x)?g.x-b.x:j;\nthis.setLocation(a,f);\nthis.setVisible(true);\nthis.setZIndex(Dwt.Z_DIALOG_MENU);\nvar k=appCtxt.getOutsideMouseEventMgr();\nvar d={id:\"ZmAutocompleteListView\",obj:this,outsideListener:this._outsideListener,noWindowBlur:appCtxt.get(ZmSetting.IS_DEV_SERVER)};\nk.startListening(d)\n};\nZmAutocompleteListView.prototype._getDefaultLoc=function(){if(this._locationCallback){return this._locationCallback()\n}var d=this._currentContext&&this._currentContext.element;\nif(!d){return{}\n}var c=Dwt.getLocation(d);\nvar b=Dwt.getSize(d);\nvar a=c.x;\nvar e=c.y+b.y+3;\nDwtPoint.tmp.set(a,e);\nreturn DwtPoint.tmp\n};\nZmAutocompleteListView.prototype._popdown=function(){if(!this.getVisible()){return\n}if(this._memberListView){this._memberListView._popdown()\n}this.setZIndex(Dwt.Z_HIDDEN);\nthis.setVisible(false);\nthis._removeAll();\nthis._selected=null;\nvar a=appCtxt.getOutsideMouseEventMgr();\na.stopListening({id:\"ZmAutocompleteListView\",obj:this})\n};\nZmAutocompleteListView.prototype._showMoreResultsText=function(a){};\nZmAutocompleteListView.prototype._setSelected=function(a){var g=document.getElementById(this._tableId);\nvar j=g&&g.rows;\nif(!(j&&j.length)){return\n}var e=j.length;\nif(a==ZmAutocompleteListView.NEXT||a==ZmAutocompleteListView.PREV){a=this._getRowId(j,a,e);\nif(!a){return\n}}var k=false;\nfor(var c=0;\nc<e;\nc++){if(j[c].id==a){k=true;\nbreak\n}}if(!k){return\n}for(var c=0;\nc<e;\nc++){var h=j[c];\nvar f=h.className;\nif(h.id==a){h.className=this._selClass\n}else{if(f!=this._origClass){h.className=this._origClass\n}}}this._showLink(this._forgetLink,this._forgetText,this._selected,false);\nthis._showLink(this._forgetLink,this._forgetText,a,true);\nthis._showLink(this._expandLink,this._expandText,this._selected,false);\nthis._showLink(this._expandLink,this._expandText,a,true);\nthis._selected=a;\nvar d=this._matchHash[a];\nvar b;\nif(!d){b=AjxStringUtil.convertHtml2Text(Dwt.byId(this._selected))\n}else{var b=AjxMessageFormat.format(ZmMsg.autocompleteMatchText,[d.name,d.email]);\nif(d.isGroup){b=AjxMessageFormat.format(ZmMsg.autocompleteGroup,b)\n}else{if(d.isDL){b=AjxMessageFormat.format(ZmMsg.autocompleteDL,b)\n}}}this._setLiveRegionText(b)\n};\nZmAutocompleteListView.prototype._getRowId=function(e,f,b){if(b<1){return\n}var a=-1;\nfor(var c=0;\nc<b;\nc++){if(e[c].id==this._selected){a=c;\nbreak\n}}var d=(f==ZmAutocompleteListView.PREV)?a-1:a+1;\nif(d==-1){d=b-1\n}if(d==b){d=0\n}if(d>=0&&d<b){Dwt.scrollIntoView(e[d],this.getHtmlElement());\nreturn e[d].id\n}return null\n};\nZmAutocompleteListView.prototype._getRowHeight=function(){if(!this._rowHeight){if(!this.getVisible()){this.setLocation(Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE);\nthis.setVisible(true)\n}var a=this._getTable().rows[0];\nthis._rowHeight=a&&Dwt.getSize(a).y\n}return this._rowHeight||18\n};\nZmAutocompleteListView.prototype._removeAll=function(){this._matches=null;\nvar b=this._getTable();\nfor(var a=b.rows.length-1;\na>=0;\na--){var c=b.rows[a];\nif(c!=this._waitingRow){b.deleteRow(a)\n}}this._removeLinks(this._forgetText);\nthis._removeLinks(this._expandText)\n};\nZmAutocompleteListView.prototype._removeLinks=function(a){if(!a){return\n}for(var c in a){var b=a[c];\nif(b){b.dispose()\n}}};\nZmAutocompleteListView.prototype.size=function(){return this._getTable().rows.length\n};\nZmAutocompleteListView.prototype._autocompleteFocus=function(a){a.focus()\n};\nZmAutocompleteListView.prototype._getAcListLoc=function(c){var b=c.element;\nvar d=Dwt.getLocation(b);\nvar a=Dwt.getSize(b).y;\nreturn(new DwtPoint(d.x,d.y+a))\n};\nZmAutocompleteListView.prototype._settingChangeListener=function(a){if(a.type!=ZmEvent.S_SETTING){return\n}if(a.source.id==ZmSetting.AUTOCOMPLETE_ON_COMMA){this._isDelim[\",\"]=this._isDelimCode[188]=appCtxt.get(ZmSetting.AUTOCOMPLETE_ON_COMMA)\n}};\nZmAutocompleteListView.prototype._handleForgetLink=function(a){if(this._dataAPI.forget){this._dataAPI.forget(a.email,this._handleResponseForget.bind(this,a.email,a.rowId))\n}};\nZmAutocompleteListView.prototype._handleResponseForget=function(a,b){var d=document.getElementById(b);\nif(d){d.parentNode.removeChild(d);\nvar c=AjxMessageFormat.format(ZmMsg.forgetSummary,[a]);\nappCtxt.setStatusMsg(c)\n}appCtxt.clearAutocompleteCache(ZmAutocomplete.AC_TYPE_CONTACT)\n};\nZmAutocompleteListView.prototype.expandDL=function(c){if(!this._dataAPI.expandDL){return\n}var b=this._memberListView;\nif(b&&b.getVisible()&&c.textId&&this._curExpanded==c.textId){b.show(false);\nthis._curExpanded=null;\nthis._setExpandText(c.textId,false)\n}else{if(b&&b.getVisible()){this._setExpandText(this._curExpanded,false);\nb.show(false)\n}var d=appCtxt.getApp(ZmApp.CONTACTS);\nvar a=d.getContactByEmail(c.email);\nif(!a){a=new ZmContact(null);\na.initFromEmail(c.email)\n}a.isDL=true;\nif(c.textId&&c.rowId){this._curExpanded=c.textId;\nthis._setExpandText(c.textId,true)\n}this._dataAPI.expandDL(a,0,this._handleResponseExpandDL.bind(this,a,c))\n}};\nZmAutocompleteListView.prototype._handleResponseExpandDL=function(a,f,d){var b=this._memberListView;\nif(!b){b=this._memberListView=new ZmDLAutocompleteListView({parent:appCtxt.getShell(),parentAclv:this,selectionCallback:this._selectionCallback,expandTextId:f.textId})\n}b._dlContact=a;\nb._dlBubbleId=f.textId;\nb._set(d,a);\nvar e=f.loc;\nif(this.getVisible()){e=this.getLocation();\ne.x+=this.getSize().x\n}b.show(true,e);\nif(!b._rowHeight){var c=document.getElementById(b._tableId);\nif(c){b._rowHeight=Dwt.getSize(c.rows[0]).y\n}}};\nZmAutocompleteListView.prototype._setExpandText=function(c,a){var b=DwtControl.fromElementId(c);\nif(b&&b.setText){b.setText(a?ZmMsg.collapse:ZmMsg.expand)\n}};\nZmAutocompleteListView.prototype._setCallbacks=function(b,d){var a=b+\"Callback\";\nvar c=this._callbacks[b]=[];\nif(d[a]){c.push({callback:d[a]})\n}};\nZmAutocompleteListView.prototype.addCallback=function(b,c,a){this._callbacks[b].push({callback:c,inputId:a})\n};\nZmAutocompleteListView.prototype._runCallbacks=function(f,g,e){var j=null;\nvar d=this._callbacks[f];\nif(d&&d.length){for(var c=0;\nc<d.length;\nc++){var b=d[c];\nif(g&&b.inputId&&(g!=b.inputId)){continue\n}var h=b.callback;\nvar a;\nif(typeof(h)==\"function\"){a=h.apply(h,e)\n}else{if(h&&h.isAjxCallback){a=AjxCallback.prototype.run.apply(b.callback,e)\n}}if(a===true||a===false){j=(j==null)?a:j&&a\n}}}return j\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.ZmPeopleAutocompleteListView\")){ZmPeopleAutocompleteListView=function(a){ZmAutocompleteListView.call(this,a);\nthis.addClassName(\"ZmPeopleAutocompleteListView\");\nthis.setScrollStyle(DwtControl.CLIP)\n};\nZmPeopleAutocompleteListView.prototype=new ZmAutocompleteListView;\nZmPeopleAutocompleteListView.prototype.constructor=ZmPeopleAutocompleteListView;\nZmPeopleAutocompleteListView.ACTION_MESSAGE=\"message\";\nZmPeopleAutocompleteListView.ACTION_IM=\"IM\";\nZmPeopleAutocompleteListView.ACTION_CALL=\"call\";\nZmPeopleAutocompleteListView.ACTION_APPT=\"appt\";\nZmPeopleAutocompleteListView.NO_RESULTS=\"no-results\";\nZmPeopleAutocompleteListView.prototype.toString=function(){return\"ZmPeopleAutocompleteListView\"\n};\nZmPeopleAutocompleteListView.prototype._set=function(j){var l=this._getTable();\nthis._matches=j;\nfor(var f=0;\nf<j.length;\nf++){var g=j[f];\nif(g&&(g.text||g.icon)){var a=g.id=this._getId(\"Row\",f);\nthis._matchHash[a]=g\n}var a=this._getId(\"Row\",f);\nvar h=g.item;\nvar e={id:this._htmlElId,rowId:a,fullName:h.getFullName(),title:h.getAttr(ZmContact.F_jobTitle),email:h.getEmail(),phone:h.getAttr(ZmContact.F_workPhone),photoFileName:h.getAttr(\"photoFileName\")};\nappCtxt.notifyZimlets(\"onPeopleSearchData\",[e]);\nvar c=AjxTemplate.expand(\"share.Widgets#ZmPeopleAutocompleteListView\",e);\nvar n=Dwt.parseHtmlFragment(c,true);\nvar d=document.createElement(\"tbody\");\nd.appendChild(n);\nvar b=l.appendChild(d);\nif(e.email){var k=new DwtText({parent:this,parentElement:a+\"-email\",index:0,id:\"NewMsg\",className:\"FakeAnchor\"});\nk.isLinkText=true;\nk.setText(e.email);\nk.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._peopleItemListener));\nk.addListener(DwtEvent.ONMOUSEOVER,new AjxListener(this,this.peopleItemMouseOverListener));\nk.addListener(DwtEvent.ONMOUSEOUT,new AjxListener(this,this.peopleItemMouseOutListener))\n}if(e.fullName){var m=new DwtText({parent:this,parentElement:a+\"-fullName\",index:0,id:\"NewContact\",className:\"ZmPeopleSearch-fullname\"});\nm.isLinkText=true;\nm.setText(e.fullName);\nm.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._peopleItemListener));\nm.addListener(DwtEvent.ONMOUSEOVER,new AjxListener(this,this.peopleItemMouseOverListener));\nm.addListener(DwtEvent.ONMOUSEOUT,new AjxListener(this,this.peopleNameMouseOutListener))\n}Dwt.associateElementWithObject(n,h,\"contact\");\nappCtxt.notifyZimlets(\"onPeopleSearchShow\",[this,h,a]);\nif(f==0){this._setSelected(a)\n}}};\nZmPeopleAutocompleteListView.prototype._clearText=function(a){if(document.getElementById(a)!=null){document.getElementById(a).innerHTML=\"\"\n}};\nZmPeopleAutocompleteListView.prototype._showNoResults=function(){var c=this._getTable();\nvar d={id:this._htmlElId,rowId:ZmPeopleAutocompleteListView.NO_RESULTS};\nvar b=AjxTemplate.expand(\"share.Widgets#ZmPeopleAutocompleteListView-NoResults\",d);\nvar a=document.createElement(\"tbody\");\na.appendChild(Dwt.parseHtmlFragment(b,true));\nc.appendChild(a);\nthis.show(true)\n};\nZmPeopleAutocompleteListView.prototype._setSelected=function(d){if(d&&typeof d==\"string\"){d=d.split(\"-\")[0]\n}if(d==ZmPeopleAutocompleteListView.NO_RESULTS||d==this.getHtmlElement().id){return\n}if(d==ZmAutocompleteListView.NEXT||d==ZmAutocompleteListView.PREV){var b=document.getElementById(this._tableId);\nvar c=b&&b.rows;\nd=this._getRowId(c,d,c.length);\nif(!d){return\n}}var a=document.getElementById(d);\nif(a){this._activeContact=Dwt.getObjectFromElement(a,\"contact\")\n}ZmAutocompleteListView.prototype._setSelected.apply(this,arguments)\n};\nZmPeopleAutocompleteListView.prototype._getFreeBusyInfo=function(e){var f=[];\nvar g={};\nfor(var c=0;\nc<e.length;\nc++){var b=e[c];\nf.push(b.email);\ng[b.email]=b.id\n}var a=new Date();\nvar h={GetFreeBusyRequest:{_jsns:\"urn:zimbraMail\"}};\nvar d=h.GetFreeBusyRequest;\nd.s=a.getTime();\nd.e=a.getTime()+(5*60*1000);\nd.name=f.join(\",\");\nreturn appCtxt.getAppController().sendRequest({jsonObj:h,asyncMode:true,callback:(new AjxCallback(this,this._handleFreeBusyResponse,[g])),noBusyOverlay:true})\n};\nZmPeopleAutocompleteListView.prototype._handleFreeBusyResponse=function(f,a){if(!this.getVisible()){return\n}var d=a.getResponse().GetFreeBusyResponse.usr;\nfor(var b=0;\nb<d.length;\nb++){var h=d[b].id;\nvar c=h&&(document.getElementById(f[h]+\"-freebusy\"));\nvar g=document.createElement(\"td\");\ng.innerHTML=\"- \";\ng.className=\"ZmPeopleSearch-busy\";\nc.parentNode.insertBefore(g,c);\nvar e=new DwtText({parent:this,parentElement:c,index:1,id:\"NewAppt\",className:\"FakeAnchor\"});\ne.isLinkText=true;\ne.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._peopleItemListener));\ne.addListener(DwtEvent.ONMOUSEOVER,new AjxListener(this,this.peopleItemMouseOverListener));\ne.addListener(DwtEvent.ONMOUSEOUT,new AjxListener(this,this.peopleItemMouseOutListener));\nif(c&&d[b].b){e.setText(\"Busy\")\n}else{if(c){e.setText(\"Available\")\n}}}};\nZmPeopleAutocompleteListView.prototype._removeAll=function(){var c=this._getTable();\nfor(var b=c.rows.length-1;\nb>=0;\nb--){var d=c.rows[b];\nvar a=Dwt.getObjectFromElement(d,\"contact\");\nif(a){Dwt.disassociateElementFromObject(d,a,\"contact\")\n}}this._activeContact=null;\nZmAutocompleteListView.prototype._removeAll.apply(this,arguments)\n};\nZmPeopleAutocompleteListView.prototype._listSelectionListener=function(a){};\nZmPeopleAutocompleteListView.prototype._peopleItemListener=function(b){if(!this._activeContact){return\n}var e=DwtUiEvent.getTargetWithProp(b,\"id\");\nvar d=\"\";\nif(e&&e.id){d=e.id.split(\"_\")[0]\n}switch(d){case\"NewMsg\":var f={action:ZmOperation.NEW_MESSAGE,toOverride:new AjxEmailAddress(this._activeContact.getEmail(),AjxEmailAddress.TO,this._activeContact.getFullName())};\nAjxDispatcher.run(\"Compose\",f);\nbreak;\ncase\"NewAppt\":AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\",\"CalendarAppt\"]);\nvar g=AjxDispatcher.run(\"GetCalController\");\nvar a=g.newApptObject((new Date()));\na.setAttendees([this._activeContact.getEmail()],ZmCalBaseItem.PERSON);\ng.newAppointment(a);\nbreak;\ncase\"NewContact\":AjxDispatcher.require([\"ContactsCore\",\"Contacts\"]);\nvar g=AjxDispatcher.run(\"GetContactListController\");\nvar c=new ZmContactList((new ZmSearch()),true);\nc.add(this._activeContact);\ng.show(c,true);\nbreak\n}this.show(false)\n};\nZmPeopleAutocompleteListView.prototype.peopleItemMouseOverListener=function(a){var b=DwtUiEvent.getTargetWithProp(a,\"id\");\nb.className=\"ZmPeopleSearchText-hover\"\n};\nZmPeopleAutocompleteListView.prototype.peopleItemMouseOutListener=function(a){var b=DwtUiEvent.getTargetWithProp(a,\"id\");\nb.className=\"FakeAnchor\"\n};\nZmPeopleAutocompleteListView.prototype.peopleNameMouseOutListener=function(a){var b=DwtUiEvent.getTargetWithProp(a,\"id\");\nb.className=\"ZmPeopleSearch-fullname\"\n};\nZmPeopleAutocompleteListView._outsideMouseDownListener=function(b){var a=ZmAutocompleteListView._activeAcList;\nif(a){var c=DwtControl.getTargetControl(b);\nif(c&&c.parent&&c.parent==a._toolbar){return\n}}ZmAutocompleteListView._outsideMouseDownListener(b);\nZmPeopleAutocompleteListView.prototype._listSelectionListener(b)\n};\nZmPeopleAutocompleteListView.prototype._addMouseDownListener=function(){DwtEventManager.addListener(DwtEvent.ONMOUSEDOWN,ZmPeopleAutocompleteListView._outsideMouseDownListener);\nthis.shell._setEventHdlrs([DwtEvent.ONMOUSEDOWN]);\nthis.shell.addListener(DwtEvent.ONMOUSEDOWN,this._outsideListener)\n};\nZmPeopleAutocompleteListView.prototype._removeMouseDownListener=function(){DwtEventManager.removeListener(DwtEvent.ONMOUSEDOWN,ZmPeopleAutocompleteListView._outsideMouseDownListener);\nthis.shell._setEventHdlrs([DwtEvent.ONMOUSEDOWN],true);\nthis.shell.removeListener(DwtEvent.ONMOUSEDOWN,this._outsideListener)\n};\nZmPeopleAutocompleteListView.prototype._showMoreResultsText=function(b){var e=this._getNumberofAllowedRows(b);\nvar c=e>1?e-1:0;\nvar d=this._getTable().rows[c];\nvar a=Dwt.parseHtmlFragment(AjxTemplate.expand(\"share.Widgets#ZmPeopleAutocompleteListView-MoreResults\"),true);\nd.parentNode.insertBefore(a,d);\nthis._removeRows(e)\n};\nZmPeopleAutocompleteListView.prototype._removeRows=function(a){this._matches=null;\nvar c=this._getTable();\nfor(var b=c.rows.length-1;\nb>=0&&b>=a;\nb--){var d=c.rows[b];\nif(d!=this._waitingRow){c.deleteRow(b)\n}}};\nZmPeopleAutocompleteListView.prototype._getNumberofAllowedRows=function(a){var b=0;\nvar d=0;\nfor(var c=0;\nc<this._getTable().rows.length;\nc++){var e=this._getTable().rows[c];\nd+=Dwt.getSize(e).y;\nif(d<a){b++\n}else{break\n}}return b\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.ZmDLAutocompleteListView\")){ZmDLAutocompleteListView=function(a){a.isFocusable=true;\nZmAutocompleteListView.call(this,a);\nthis._parentAclv=a.parentAclv;\nthis._dlScrollDiv=this.getHtmlElement();\nthis._selectionCallback=a.selectionCallback;\nthis._expandTextId=a.expandTextId;\nDwt.setHandler(this._dlScrollDiv,DwtEvent.ONSCROLL,ZmDLAutocompleteListView.handleDLScroll)\n};\nZmDLAutocompleteListView.prototype=new ZmAutocompleteListView;\nZmDLAutocompleteListView.prototype.constructor=ZmDLAutocompleteListView;\nZmDLAutocompleteListView.prototype.toString=function(){return\"ZmDLAutocompleteListView\"\n};\nZmDLAutocompleteListView.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_DL_ADDRESS_LIST\n};\nZmDLAutocompleteListView.prototype.handleKeyAction=function(a,b){switch(a){case DwtKeyMap.SELECT_NEXT:this._setSelected(ZmAutocompleteListView.NEXT);\nbreak;\ncase DwtKeyMap.SELECT_PREV:this._setSelected(ZmAutocompleteListView.PREV);\nbreak;\ncase DwtKeyMap.ENTER:this._update();\nbreak;\ncase DwtKeyMap.CANCEL:if(this._parentAclv&&this._expandTextId){this._parentAclv._setExpandText(this._expandTextId,false)\n}this._popdown();\nbreak;\ndefault:return false\n}return true\n};\nZmDLAutocompleteListView.prototype._set=function(e,d){this._removeAll();\nthis._matches=[];\nthis._addMembers(e);\nvar c=appCtxt.getApp(ZmApp.CONTACTS).getDL(d.getEmail());\nvar b=c?c.total:e.length;\nvar a=this._getId(\"Row\",1);\nif(b!=1){var h=this._getTable();\nvar j=h.insertRow(0);\nj.className=this._origClass;\na=j.id=this._selectAllRowId=this._getId(\"Row\",\"selectAll\");\nvar f=j.insertCell(-1);\nf.className=\"AutocompleteMatchIcon\";\nf.innerHTML=AjxImg.getImageHtml(\"Blank16\");\nf=j.insertCell(-1);\nvar g=b?ZmMsg.selectAllMembers:ZmMsg.noMembers;\nf.innerHTML=AjxMessageFormat.format(g,[b])\n}AjxTimedAction.scheduleAction(new AjxTimedAction(this,function(){this._setSelected(a)\n}),100)\n};\nZmDLAutocompleteListView.prototype._addMembers=function(e){var d=this._getTable();\nvar a=e.length;\nfor(var c=0;\nc<a;\nc++){var b=e[c];\nthis._matches.push(b);\nvar f=b.id=this._getId(\"Row\",this._matches.length);\nthis._addRow(d,b,f)\n}};\nZmDLAutocompleteListView.prototype._addRow=function(c,b,d){if(b&&(b.text||b.icon)){this._matchHash[d]=b;\nvar e=c.insertRow(-1);\ne.className=this._origClass;\ne.id=d;\nvar a=e.insertCell(-1);\na.className=\"AutocompleteMatchIcon\";\nif(b.icon){a.innerHTML=(b.icon.indexOf(\"Dwt\")!=-1)?[\"<div class='\",b.icon,\"'></div>\"].join(\"\"):AjxImg.getImageHtml(b.icon)\n}else{a.innerHTML=\"&nbsp;\"\n}a=e.insertCell(-1);\na.innerHTML=b.text||\"&nbsp;\"\n}};\nZmDLAutocompleteListView.prototype._update=function(b,a,c){if(this._selected==this._selectAllRowId){if(!this._matchHash[this._selectAllRowId]){var d=this._handleResponseGetAllDLMembers.bind(this,c);\nthis._dlContact.getAllDLMembers(d)\n}}else{this._doUpdate();\nthis.reset(true)\n}};\nZmDLAutocompleteListView.prototype._handleResponseGetAllDLMembers=function(f,c){var b=this._parentAclv._matchValue;\nvar g=(b instanceof Array)?b[0]:b;\nif(c.list&&c.list.length){if(this._parentAclv._options.massDLComplete){var d=this._matchHash[this._selectAllRowId]=new ZmAutocompleteMatch();\nd[g]=c.list.join(this._parentAclv._separator);\nd.multipleAddresses=true;\nthis._doUpdate()\n}else{var d=new ZmAutocompleteMatch();\nfor(var e=0,a=c.list.length;\ne<a;\ne++){d[g]=c.list[e];\nthis._doUpdate(d)\n}}}this.reset(true)\n};\nZmDLAutocompleteListView.prototype._doUpdate=function(c){var d=null;\nif(this._parentAclv&&this._parentAclv._currentContext){d=this._parentAclv._currentContext;\nd.address=null\n}c=c||this._matchHash[this._selected];\nif(!c){return\n}if(this._selectionCallback){this._selectionCallback(c.fullAddress);\nreturn\n}var a=document.getElementById(this._dlBubbleId);\nif(a&&a._aifId&&(!d||d.element._aifId!=a._aifId)){var e=DwtControl.ALL_BY_ID[a._aifId];\nif(e){var b={address:c.fullAddress,match:c,noFocus:false,addClass:null,noParse:false};\ne.addBubble(b);\nreturn\n}}this._parentAclv._update(null,c)\n};\nZmDLAutocompleteListView.handleDLScroll=function(f){var e=DwtUiEvent.getTarget(f);\nvar g=DwtControl.findControl(e);\nvar a=g._dlScrollDiv;\nif(a.clientHeight==a.scrollHeight){return\n}var c=appCtxt.getApp(ZmApp.CONTACTS).getDL(g._dlContact.getEmail());\nvar b=g.getDLSize();\nif(c&&(c.more||(b<c.list.length))){var d={scrollDiv:a,rowHeight:g._rowHeight,threshold:10,limit:ZmContact.DL_PAGE_SIZE,listSize:b};\nvar h=ZmListView.getRowsNeeded(d);\nif(h){var j=ZmDLAutocompleteListView._handleResponseDLScroll.bind(null,g);\ng._parentAclv._dataAPI.expandDL(g._dlContact,b,j)\n}}};\nZmDLAutocompleteListView._handleResponseDLScroll=function(a,b){a._addMembers(b)\n};\nZmDLAutocompleteListView.prototype.getDLSize=function(){return this.size()-1\n};\nZmDLAutocompleteListView.prototype.reset=function(b){if(b){var a=document.getElementById(this._dlBubbleId);\nif(a){var c=DwtControl.ALL_BY_ID[a._aifId];\nif(c&&c.removeBubble){c.removeBubble(this._dlBubbleId);\nthis._dlBubbleId=null\n}}}ZmAutocompleteListView.prototype.reset.call(this)\n};\nZmDLAutocompleteListView.prototype._popup=function(f){if(this.getVisible()){return\n}f=f||this._getDefaultLoc();\nvar a=f.x;\nvar c=this.shell.getSize();\nthis.setVisible(true);\nvar b=this.getSize();\nthis.setVisible(false);\nvar e=(a+b.x>=c.x)?c.x-b.x:a;\nif(e!=a){var d=this._parentAclv.getSize();\nthis._parentAclv.setLocation(c.x-(b.x+d.x+2),Dwt.DEFAULT);\nf.x=e\n}ZmAutocompleteListView.prototype._popup.call(this,f);\nthis.focus()\n};\nZmDLAutocompleteListView.prototype._popdown=function(){if(this._parentAclv){this._parentAclv._curExpanded=null\n}ZmAutocompleteListView.prototype._popdown.call(this)\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.ZmAddressInputField\")){ZmAddressInputField=function(c){c.parent=c.parent||appCtxt.getShell();\nc.className=c.className||\"addrBubbleContainer\";\nDwtComposite.call(this,c);\nthis._initialize(c);\nif(c.autocompleteListView){this.setAutocompleteListView(c.autocompleteListView)\n}this.type=c.type;\nthis._strictMode=(c.strictMode!==false);\nthis._noOutsideListening=c.noOutsideListening;\nthis._singleBubble=c.singleBubble;\nthis._bubbleAddedCallback=c.bubbleAddedCallback;\nthis._bubbleRemovedCallback=c.bubbleRemovedCallback;\nthis._bubbleMenuCreatedCallback=c.bubbleMenuCreatedCallback;\nthis._bubbleResetOperationsCallback=c.bubbleMenuResetOperationsCallback;\nthis._bubbleClassName=\"addrBubble\";\nthis._bubbleList=new ZmAddressBubbleList({parent:this,separator:this._separator});\nthis._bubbleList.addSelectionListener(this._selectionListener.bind(this));\nthis._bubbleList.addActionListener(this._actionListener.bind(this));\nthis._listeners={};\nthis._listeners[ZmOperation.DELETE]=this._deleteListener.bind(this);\nthis._listeners[ZmOperation.EDIT]=this._editListener.bind(this);\nthis._listeners[ZmOperation.EXPAND]=this._expandListener.bind(this);\nthis._listeners[ZmOperation.CONTACT]=this._contactListener.bind(this);\nvar a=new DwtDropTarget(\"ZmAddressBubble\");\na.markAsMultiple();\na.addDropListener(this._dropListener.bind(this));\nthis.setDropTarget(a);\nthis._setEventHdlrs([DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEMOVE,DwtEvent.ONMOUSEUP]);\nvar b=new DwtDragBox();\nb.addDragListener(this._dragBoxListener.bind(this));\nthis.setDragBox(b);\nthis.tabGroupMember=this;\nthis.addListener(DwtEvent.ONMOUSEDOWN,this._mouseDownListener);\nthis._reset()\n};\nZmAddressInputField.prototype=new DwtComposite;\nZmAddressInputField.prototype.constructor=ZmAddressInputField;\nZmAddressInputField.prototype.isZmAddressInputField=true;\nZmAddressInputField.prototype.isInputControl=true;\nZmAddressInputField.prototype.toString=function(){return\"ZmAddressInputField\"\n};\nZmAddressInputField.prototype.TEMPLATE=\"share.Widgets#ZmAddressInputField\";\nZmAddressInputField.INPUT_EXTRA=30;\nZmAddressInputField.INPUT_EXTRA_SMALL=10;\nZmAddressInputField.BUBBLE_OBJ_ID={};\nZmAddressInputField.menuContext={};\nZmAddressInputField.prototype.setAutocompleteListView=function(a){this._aclv=a;\nthis._separator=(a._separator)||AjxEmailAddress.SEPARATOR;\na.addCallback(ZmAutocompleteListView.CB_KEYDOWN,this._keyDownCallback.bind(this),this._inputId);\na.addCallback(ZmAutocompleteListView.CB_KEYUP,this._keyUpCallback.bind(this),this._inputId)\n};\nZmAddressInputField.prototype.addChild=function(e,a){DwtComposite.prototype.addChild.apply(this,arguments);\nvar b=e.getHtmlElement();\nif(this._input.parentNode==this._holder){var d;\nif(a!=null){var c=this._getBubbleList().getBubble(a);\nd=c&&c.getHtmlElement()\n}this._holder.insertBefore(b,d||this._input)\n}else{this._holder.appendChild(b)\n}};\nZmAddressInputField.prototype.addBubble=function(a){a=a||{};\nif(!a.address&&!a.bubble){return\n}if(a.bubble){a.address=a.bubble.address;\na.match=a.bubble.match;\na.canExpand=a.bubble.canExpand\n}a.parent=this;\na.addrInput=this;\na.parentId=this._htmlElId;\na.className=this._bubbleClassName;\na.canRemove=true;\na.separator=this._separator;\na.type=this.type;\nif(a.index==null&&this._editModeIndex!=null){a.index=this._getInsertionIndex(this._holder.childNodes[this._editModeIndex])\n}var g,b=false;\nvar d=a.match;\nif(d&&d.isGroup&&d.type==ZmAutocomplete.AC_TYPE_CONTACT){var e=AjxEmailAddress.split(a.address);\nfor(var c=0,f=e.length;\nc<f;\nc++){a.id=a.addrObj=a.match=a.email=a.canExpand=null;\na.address=e[c];\na.index=(a.index!=null)?a.index+c:null;\nif(this._hasValidAddress(a)){this._addBubble(new ZmAddressBubble(a),a.index);\nb=true\n}}}else{if(this._hasValidAddress(a)){g=new ZmAddressBubble(a);\nthis._addBubble(g,a.index,a.noFocus);\nb=true\n}else{var h=this._input.value;\nvar j=h?this._separator:\"\";\nthis._setInputValue([h,j,a.address].join(\"\"))\n}}if(b){this._holder.className=\"addrBubbleHolder\";\nif(this._bubbleAddedCallback&&!a.skipNotify){this._bubbleAddedCallback.run(g,true)\n}this._leaveEditMode();\nreturn g\n}};\nZmAddressInputField.prototype._addBubble=function(a,b,d){if(!a||(this._singleBubble&&this._numBubbles>0)){return\n}a.setDropTarget(this.getDropTarget());\nthis._bubbleList.add(a,b);\nthis._numBubbles++;\nvar c=a._htmlElId;\nthis._bubble[c]=a;\nthis._addressHash[a.hashKey]=c;\nif(!d){this.focus()\n}if(this._singleBubble){this._setInputEnabled(false)\n}};\nZmAddressInputField.prototype.getAddressBubble=function(a){return this._addressHash[a]\n};\nZmAddressInputField.prototype._hasValidAddress=function(a){if(!this._strictMode){return true\n}var b=(a.addrObj&&a.addrObj.getAddress())||a.address||(a.match&&a.match.email);\nreturn(Boolean(AjxEmailAddress.parse(b)))\n};\nZmAddressInputField.prototype.removeBubble=function(c,b){var a=DwtControl.fromElementId(c);\nif(!a){return\n}this._bubbleList.remove(a);\na.dispose();\nthis._bubble[c]=null;\ndelete this._bubble[c];\ndelete this._addressHash[a.hashKey];\nthis._numBubbles--;\nif(this._numBubbles==0){this._holder.className=\"addrBubbleHolder-empty\"\n}this._resizeInput();\nif(this._bubbleRemovedCallback&&!b){this._bubbleRemovedCallback.run(a,false)\n}if(this._singleBubble&&this._numBubbles===0){this._setInputEnabled(true)\n}};\nZmAddressInputField.prototype.clear=function(a){for(var b in this._bubble){this.removeBubble(b,a)\n}this._reset()\n};\nZmAddressInputField.prototype.getValue=function(){var a=this.getAddresses();\nif(this._input.value){a.push(this._input.value)\n}return a.join(this._separator)\n};\nZmAddressInputField.prototype.setValue=function(j,k,g,c){if(!k){this.clear()\n}if(!j){return\n}var f=null;\nif(this._editModeIndex!=null){f=this._getInsertionIndex(this._holder.childNodes[this._editModeIndex])\n}var e=AjxEmailAddress.parseEmailString(j);\nvar b,a;\nif(this.type===ZmId.SEARCH){b=e.all.getArray();\na=[];\ng=true\n}else{b=e.good.getArray();\na=e.bad.getArray()\n}for(var d=0;\nd<b.length;\nd++){var h=b[d];\nif((h&&!this._addressHash[h.address])){this.addBubble({address:h.toString(),addrObj:h,index:(f!=null)?f+d:null,skipNotify:g})\n}}this._setInputValue(a.length?a.join(this._separator):\"\");\nif(c&&a.length){this._aclv.autocomplete(this.getInputElement())\n}};\nZmAddressInputField.prototype.setInputValue=function(a){this._input.value=a;\nthis._resizeInput()\n};\nZmAddressInputField.prototype.addValue=function(b,a){this.setValue(b,true,a)\n};\nZmAddressInputField.prototype.handleDelete=function(b){if(b&&this._input.value.length>0){return false\n}var d=this.getSelection();\nif(d.length){for(var c=0,a=d.length;\nc<a;\nc++){if(d[c]){this.removeBubble(d[c].id)\n}}this.focus();\nreturn true\n}else{return this._selectBubbleBeforeInput()\n}};\nZmAddressInputField.prototype._selectBubbleBeforeInput=function(){if(!this._input.value){var b=this._getInputIndex();\nvar c=(b>0)&&this._holder.childNodes[b-1];\nvar a=DwtControl.fromElement(c);\nif(a){this.setSelected(a,true);\nthis.blur();\nappCtxt.getKeyboardMgr().grabFocus(a);\nreturn true\n}}return false\n};\nZmAddressInputField.prototype.setSelected=function(a,b){this._bubbleList.setSelected(a,b)\n};\nZmAddressInputField.prototype.getSelection=function(a){return this._bubbleList.getSelection(a)\n};\nZmAddressInputField.prototype.getSelectionCount=function(a){return this._bubbleList.getSelectionCount(a)\n};\nZmAddressInputField.prototype.deselectAll=function(){this._bubbleList.deselectAll()\n};\nZmAddressInputField.prototype.preventSelection=function(a){return !(this._bubble[a.id]||this.__isInputEl(a))\n};\nZmAddressInputField.onPaste=function(b){var c=ZmAddressInputField._getAddrInputFromEvent(b);\nif(c){var a=true;\nAjxTimedAction.scheduleAction(new AjxTimedAction(c,c._checkInput,[null,a]),100)\n}};\nZmAddressInputField.onCut=function(a){var b=ZmAddressInputField._getAddrInputFromEvent(a);\nif(b){b._resizeInput()\n}};\nZmAddressInputField.onHolderKeyClick=function(b){b=DwtUiEvent.getEvent(b);\nvar a=DwtKeyEvent.getCharCode(b);\nif(a===DwtKeyEvent.KEY_ARROW_UP){if(this.clientHeight>=this.scrollHeight){return\n}this.scrollTop=Math.max(this.scrollTop-this.clientHeight,0)\n}else{if(a===DwtKeyEvent.KEY_ARROW_DOWN){if(this.clientHeight>=this.scrollHeight){return\n}this.scrollTop=Math.min(this.scrollTop+this.clientHeight,this.scrollHeight-this.clientHeight)\n}}};\nZmAddressInputField.prototype._checkInput=function(b,a){b=b||this._input.value;\nif(b){this.setValue(b,true,false,a)\n}};\nZmAddressInputField.onHolderClick=function(b){var c=ZmAddressInputField._getAddrInputFromEvent(b);\nif(c){c.focus();\nvar a=c.getInputElement();\nDwt.setSelectionRange(a,Dwt.getSelectionStart(a),Dwt.getSelectionEnd(a))\n}};\nZmAddressInputField.removeBubble=function(c,b){var a=document.getElementById(c);\nvar e=a._aifId||ZmAddressInputField.BUBBLE_OBJ_ID[c];\nvar d=a&&DwtControl.ALL_BY_ID[e];\nif(d&&d.getEnabled()){d.removeBubble(c,b);\nd.focus()\n}};\nZmAddressInputField.prototype.getInputElement=function(){return this._input\n};\nZmAddressInputField.prototype._focus=function(){this.setDisplayState(DwtControl.FOCUSED)\n};\nZmAddressInputField.prototype._blur=function(){this.setDisplayState(DwtControl.NORMAL)\n};\nZmAddressInputField.prototype.setEnabled=function(a){DwtControl.prototype.setEnabled.call(this,a);\nthis._input.disabled=!a\n};\nZmAddressInputField.prototype._setInputEnabled=function(a){this._input.disabled=!a\n};\nZmAddressInputField.prototype._initialize=function(c){this._holderId=Dwt.getNextId();\nthis._inputId=c.inputId||Dwt.getNextId();\nthis._label=c.label;\nthis._dragInsertionBarId=Dwt.getNextId();\nvar b={inputTagName:AjxEnv.isIE||AjxEnv.isModernIE?\"textarea\":'input type=\"text\" ',holderId:this._holderId,inputId:this._inputId,label:this._label,dragInsertionBarId:this._dragInsertionBarId};\nthis._createHtmlFromTemplate(c.templateId||this.TEMPLATE,b);\nthis._holder=document.getElementById(this._holderId);\nthis._holder._aifId=this._htmlElId;\nthis._input=document.getElementById(this._inputId);\nthis._input.supportsAutoComplete=true;\nthis._dragInsertionBar=document.getElementById(this._dragInsertionBarId);\nDwt.setHandler(this._holder,DwtEvent.ONCLICK,ZmAddressInputField.onHolderClick);\nDwt.setHandler(this._input,DwtEvent.ONCUT,ZmAddressInputField.onCut);\nDwt.setHandler(this._input,DwtEvent.ONPASTE,ZmAddressInputField.onPaste);\nDwt.setHandler(this._holder,DwtEvent.ONKEYDOWN,ZmAddressInputField.onHolderKeyClick);\nthis.setFocusElement();\nvar a={container:this._holder,threshold:10,amount:15,interval:5,id:this._holderId};\nthis._dndScrollCallback=DwtControl._dndScrollCallback.bind(null,[a]);\nthis._dndScrollId=this._holderId\n};\nZmAddressInputField.prototype._reset=function(){this._bubble={};\nthis._addressHash={};\nthis._numBubbles=0;\nthis._bubbleList.reset();\nthis._editMode=false;\nthis._editModeIndex=this._editModeBubble=null;\nthis._dragInsertionBarIndex=null;\nthis._holder.className=\"addrBubbleHolder-empty\";\nthis._setInputValue(\"\")\n};\nZmAddressInputField.prototype.moveCursorToEnd=function(){Dwt.moveCursorToEnd(this._input)\n};\nZmAddressInputField.prototype._setInputValue=function(a){this._input.value=a&&a.replace(/\\s+/g,\" \");\nthis._resizeInput()\n};\nZmAddressInputField.prototype._keyDownCallback=function(e,d){e=DwtUiEvent.getEvent(e);\nvar c=DwtKeyEvent.getCharCode(e);\nvar a;\nvar f=false;\nif(DwtKeyMapMgr.hasModifier(e)||e.shiftKey){return a\n}if(c===DwtKeyEvent.KEY_ESCAPE&&this._editMode){this._leaveEditMode(true);\na=false;\nf=true\n}else{if(c===DwtKeyEvent.KEY_BACKSPACE){if(this.handleDelete(true)){a=false\n}}else{if(c===DwtKeyEvent.KEY_ARROW_LEFT){if(this._selectBubbleBeforeInput()){a=false\n}}else{if(!this._strictMode&&DwtKeyEvent.IS_RETURN[c]){var b=this._editMode&&this._editModeBubble;\nif(b&&!b.addrObj){this._leaveEditMode();\na=false;\nf=true\n}}}}}if(f&&AjxEnv.isGeckoBased){AjxTimedAction.scheduleAction(new AjxTimedAction(this,this._setInputValue,[\"\"]),20)\n}return a\n};\nZmAddressInputField.prototype._keyUpCallback=function(b,a){if(!this._input.value&&this._editMode){if(this._bubbleRemovedCallback){this._bubbleRemovedCallback.run(this._editModeBubble,false)\n}this._leaveEditMode()\n}this._resizeInput()\n};\nZmAddressInputField.prototype._selectionListener=function(b){var a=b.item;\nif(b.detail==DwtEvent.ONDBLCLICK){this.setSelected(a,false);\nthis._checkInput();\nthis._enterEditMode(a)\n}else{this._resetOperations()\n}};\nZmAddressInputField.prototype._actionListener=function(h){var e=h.item;\nvar a=this.getActionMenu();\nZmAddressInputField.menuContext.addrInput=this;\nZmAddressInputField.menuContext.event=h;\nZmAddressInputField.menuContext.bubble=e;\nthis._resetOperations();\nvar d=e.email;\nvar f=appCtxt.get(ZmSetting.CONTACTS_ENABLED);\nif(d&&f){var j=appCtxt.getApp(ZmApp.CONTACTS);\nvar c=j.getContactByEmail(d);\nif(c){this._handleResponseGetContact(h,c)\n}else{a.getOp(ZmOperation.CONTACT).setText(ZmMsg.loading);\nvar l=this._handleResponseGetContact.bind(this,h);\nj.getContactByEmail(d,l)\n}}else{var g=this.getActionMenu();\nif(g.getOp(ZmOperation.CONTACT)){g.getOp(ZmOperation.CONTACT).setVisible(false);\nthis._setContactText(null)\n}if(g.getOp(ZmOperation.EXPAND)){g.getOp(ZmOperation.EXPAND).setVisible(false)\n}a.popup(0,h.docX||e.getXW(),h.docY||e.getYH())\n}if(!this._noOutsideListening&&(this.getSelectionCount()>0)){var k=appCtxt.getOutsideMouseEventMgr();\nvar b={id:\"ZmAddressBubbleList\",obj:a,outsideListener:this.getOutsideListener()};\nk.startListening(b)\n}};\nZmAddressInputField.prototype.getOutsideListener=function(){return this._bubbleList?this._bubbleList._outsideMouseListener.bind(this._bubbleList):null\n};\nZmAddressInputField.prototype.getActionMenu=function(){var a=this._actionMenu||this.parent._bubbleActionMenu;\nif(!a){a=this._actionMenu=this.parent._bubbleActionMenu=this._createActionMenu()\n}return a\n};\nZmAddressInputField.prototype._createActionMenu=function(){var c=this._getActionMenuOps();\nvar e=new ZmActionMenu({parent:this.shell,menuItems:c});\nfor(var b=0;\nb<c.length;\nb++){var d=c[b];\nif(this._listeners[d]){e.addSelectionListener(d,this._listeners[d])\n}}var a=e.getOp(ZmOperation.COPY);\nif(a){appCtxt.getClipboard().init(a,{onMouseDown:this._clipCopy.bind(this),onComplete:this._clipCopyComplete.bind(this)})\n}e.addPopdownListener(this._menuPopdownListener.bind(this));\nif(this._bubbleMenuCreatedCallback){this._bubbleMenuCreatedCallback.run(this,e)\n}return e\n};\nZmAddressInputField.prototype._resetOperations=function(){var b=this.getActionMenu();\nif(b){var c=this.getSelection();\nvar h=(c.length==1)?c[0]:null;\nb.enable(ZmOperation.DELETE,c.length>0);\nb.enable(ZmOperation.COPY,c.length>0);\nb.enable(ZmOperation.EDIT,Boolean(h));\nvar g=h&&h.email;\nvar k=window.parentAppCtxt||window.appCtxt;\nvar d=k.isExpandableDL(g);\nb.enable(ZmOperation.EXPAND,d);\nvar j=appCtxt.getApp(ZmApp.CONTACTS);\nvar e=j&&j.getContactByEmail(g);\nvar f=e&&e.isDistributionList();\nvar a=!(f||d)||(e&&e.dlInfo&&e.dlInfo.isOwner);\nb.enable(ZmOperation.CONTACT,a)\n}if(this._bubbleResetOperationsCallback){this._bubbleResetOperationsCallback.run(this,b)\n}};\nZmAddressInputField.prototype._getActionMenuOps=function(){var a=[ZmOperation.DELETE];\nif(AjxClipboard.isSupported()){a.push(ZmOperation.COPY)\n}a.push(ZmOperation.EDIT);\nif(appCtxt.get(ZmSetting.CONTACTS_ENABLED)){a.push(ZmOperation.EXPAND);\na.push(ZmOperation.CONTACT)\n}return a\n};\nZmAddressInputField.prototype._handleResponseGetContact=function(c,b){ZmAddressInputField.menuContext.contact=b;\nthis._setContactText(b);\nvar a=c.docX>0?c.docX:c.item.getXW(),d=c.docY>0?c.docY:c.item.getYH();\nthis.getActionMenu().popup(0,a,d)\n};\nZmAddressInputField.prototype._setContactText=function(a){ZmBaseController.setContactTextOnMenu(a,this.getActionMenu())\n};\nZmAddressInputField.prototype._deleteListener=function(){var c=ZmAddressInputField.menuContext.addrInput;\nvar b=c&&c.getSelection();\nif(b&&b.length){for(var a=0;\na<b.length;\na++){c.removeBubble(b[a].id)\n}}};\nZmAddressInputField.prototype._editListener=function(){var b=ZmAddressInputField.menuContext.addrInput;\nvar a=ZmAddressInputField.menuContext.bubble;\nif(b&&a){b._enterEditMode(a)\n}};\nZmAddressInputField.prototype._expandListener=function(){var b=ZmAddressInputField.menuContext.addrInput;\nvar a=ZmAddressInputField.menuContext.bubble;\nif(b&&a){ZmAddressBubble.expandBubble(a.id,a.email)\n}};\nZmAddressInputField.prototype._contactListener=function(b){var c=ZmAddressInputField.menuContext.addrInput;\nif(c){var a=c._handleLoadContactListener.bind(c);\nAjxDispatcher.require([\"ContactsCore\",\"Contacts\"],false,a,null,true)\n}};\nZmAddressInputField.prototype._handleLoadContactListener=function(){var b=window.parentAppCtxt?window.parentAppCtxt.getApp(ZmApp.CONTACTS).getContactController():AjxDispatcher.run(\"GetContactController\");\nvar a=ZmAddressInputField.menuContext.contact;\nif(a){if(a.isLoaded){b.show(a)\n}else{var e=this._loadContactCallback.bind(this);\na.load(e)\n}}else{var a=new ZmContact(null);\nvar c=ZmAddressInputField.menuContext.bubble;\nvar d=c&&c.email;\nif(d){a.initFromEmail(d);\nb.show(a,true)\n}}};\nZmAddressInputField.prototype._loadContactCallback=function(c,b){var a=window.parentAppCtxt?window.parentAppCtxt.getApp(ZmApp.CONTACTS).getContactController():AjxDispatcher.run(\"GetContactController\");\na.show(b)\n};\nZmAddressInputField.prototype._clipCopy=function(a){a.setText(ZmAddressInputField.menuContext.bubble.address+this._separator)\n};\nZmAddressInputField.prototype._clipCopyComplete=function(a){this._actionMenu.popdown()\n};\nZmAddressInputField.prototype._menuPopdownListener=function(){var a=ZmAddressInputField.menuContext.bubble;\nif(a){a.setClassName(this._bubbleClassName)\n}if(!this._noOutsideListening&&(this.getSelectionCount()>0)){var b=appCtxt.getOutsideMouseEventMgr();\nb.stopListening({id:\"ZmAddressInputField\",obj:this.getActionMenu()})\n}AjxTimedAction.scheduleAction(new AjxTimedAction(this,function(){ZmAddressInputField.menuContext={};\nthis._bubbleList.clearRightSelection()\n}),10)\n};\nZmAddressInputField.prototype._enterEditMode=function(a){if(this._editMode){this._leaveEditMode()\n}this._editMode=true;\nthis._editModeIndex=this._getBubbleIndex(a);\nthis._holder.insertBefore(this._input,a.getHtmlElement());\nthis.removeBubble(a.id,true);\nthis._editModeBubble=a;\nthis._setInputValue(a.address);\nAjxTimedAction.scheduleAction(new AjxTimedAction(this,function(){this.focus();\nthis._input.select()\n}),20);\nif(this._singleBubble){this._setInputEnabled(true)\n}};\nZmAddressInputField.prototype._leaveEditMode=function(b){if(!this._editMode){return\n}if(this._holder.lastChild!=this._input){this._holder.appendChild(this._input)\n}var a=b&&this._editModeBubble;\nthis._checkInput(a&&a.address);\nthis.focus();\nthis._editMode=false;\nthis._editModeIndex=this._editModeBubble=null\n};\nZmAddressInputField.prototype._resizeInput=function(){var h=AjxStringUtil.htmlEncode(this._input.value);\nvar b=Dwt.getMargins(this._holder);\nvar f=Dwt.getMargins(this._input);\nvar d=Dwt.getSize(this._holder).x-(this._input.offsetLeft+((AjxEnv.isTrident)?(f.left+b.left):0)+b.right+f.right+1);\nd=Math.max(d,3);\nvar g=\"100%\";\nif(this._input.supportsAutoComplete){var c=DwtCssStyle.getProperty(this._input,\"font-size\");\nvar a=AjxStringUtil.getWidth(h,false,c);\nif(AjxEnv.isWindows&&(AjxEnv.isFirefox||AjxEnv.isSafari||AjxEnv.isChrome)){a=a*1.2\n}var e=this._editMode?ZmAddressInputField.INPUT_EXTRA_SMALL:ZmAddressInputField.INPUT_EXTRA;\ng=Math.min(a+e,d);\nif(this._editMode){g=Math.max(g,ZmAddressInputField.INPUT_EXTRA)\n}}Dwt.setSize(this._input,g,Dwt.DEFAULT)\n};\nZmAddressInputField.prototype.hasFocus=function(a){return true\n};\nZmAddressInputField.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_ADDRESS\n};\nZmAddressInputField.prototype.handleKeyAction=function(a,c){var b=this.getSelectionCount();\nif(!b||this._editMode){c.forcePropagate=true;\nreturn true\n}switch(a){case DwtKeyMap.DELETE:this.handleDelete();\nbreak;\ncase DwtKeyMap.SELECT_NEXT:if(b==1){this._selectAdjacentBubble(true)\n}break;\ncase DwtKeyMap.SELECT_PREV:if(b==1){this._selectAdjacentBubble(false)\n}break;\ndefault:return false\n}return true\n};\nZmAddressInputField.prototype._getBubbleList=function(){var d=[];\nvar c=this._holder.childNodes;\nfor(var b=0;\nb<c.length;\nb++){var e=c[b].id;\nif(e&&this._bubble[e]){var a=DwtControl.fromElementId(e);\nif(a){d.push(a)\n}}}this._bubbleList.set(d);\nreturn this._bubbleList\n};\nZmAddressInputField.prototype.getBubbleCount=function(){return this._getBubbleList().getArray().length\n};\nZmAddressInputField.prototype._getBubbleIndex=function(a){return AjxUtil.indexOf(this._holder.childNodes,a.getHtmlElement())\n};\nZmAddressInputField.prototype._getInputIndex=function(){return AjxUtil.indexOf(this._holder.childNodes,this._input)\n};\nZmAddressInputField.prototype._selectAdjacentBubble=function(f){var g=this.getSelection();\nvar a=g&&g.length&&g[0];\nif(!a){return\n}var c=this._getBubbleIndex(a);\nc=f?c+1:c-1;\nvar d=this._holder.childNodes;\nvar e=(c>=0&&c<d.length)&&d[c];\nif(e==this._dragInsertionBar){c=f?c+1:c-1;\ne=(c>=0&&c<d.length)&&d[c]\n}if(e){if(e==this._input){this.setSelected(a,false);\nthis.focus()\n}else{var b=DwtControl.fromElement(e);\nif(b){this.setSelected(a,false);\nthis.setSelected(b,true)\n}}}};\nZmAddressInputField.prototype.getAddresses=function(d){var e=[];\nvar b=this._getBubbleList().getArray();\nvar f=window.parentAppCtxt||window.appCtxt;\nfor(var c=0;\nc<b.length;\nc++){var a=b[c];\nvar h=a.address;\nif(d){var g=AjxEmailAddress.parse(h)||new AjxEmailAddress(\"\",null,h);\nif(f.isExpandableDL(a.email)||(a.match&&a.match.isDL)){g.isGroup=true;\ng.canExpand=true\n}e.push(g)\n}else{e.push(h)\n}}return e\n};\nZmAddressInputField._getAddrInputFromEvent=function(a){var b=DwtUiEvent.getTarget(a);\nreturn b&&DwtControl.ALL_BY_ID[b._aifId]\n};\nZmAddressInputField.prototype._dropListener=function(h){var b=h.srcData&&h.srcData.selection;\nif(!(b&&b.length)){return\n}if(h.action==DwtDropEvent.DRAG_ENTER){var f=h.uiEvent.dwtObj;\nvar c=f.isAddressBubble?f.addrInput:f;\nvar k=b[0];\nif(k.type!=this.type){h.doIt=true\n}else{if(c._numBubbles<=1){h.doIt=false\n}}if(h.doIt&&c._numBubbles>=1){var m=c._getIndexFromEvent(h.uiEvent);\nvar l=c._getBubbleIndex(k);\nif((k.type==this.type)&&(m==l||m==l+1)){h.doIt=false\n}else{this._setInsertionBar(m)\n}}if(!h.doIt){this._setInsertionBar(null)\n}}else{if(h.action==DwtDropEvent.DRAG_LEAVE){this._setInsertionBar(null)\n}else{if(h.action==DwtDropEvent.DRAG_DROP){var j=h.srcData.addrInput;\nvar e=this._getInsertionIndex(this._dragInsertionBar);\nfor(var d=0;\nd<b.length;\nd++){var g=b[d];\nvar a=g.id;\nthis.addBubble({bubble:g,index:e+d});\nj.removeBubble(a)\n}this._setInsertionBar(null)\n}}}};\nZmAddressInputField.prototype._dragBoxListener=function(h){if(h&&h.srcControl&&this._holder){var f=this._holder.scrollWidth;\nvar c=f+Dwt.getLocation(this._holder).x;\nvar d=h.srcControl.getDragBox();\nif(d){if(d.getStartX()>c){return false\n}}}if(h.action==DwtDragEvent.DRAG_INIT){return(this._numBubbles>0&&(h.target!=this._input||this._input.value==\"\"))\n}else{if(h.action==DwtDragEvent.DRAG_START){this.deselectAll();\nthis.blur()\n}else{if(h.action==DwtDragEvent.DRAG_MOVE){var e=this._dragSelectionBox;\nfor(var a in this._bubble){var g=this._bubble[a];\nvar j=g.getHtmlElement();\nvar b=Dwt.doOverlap(e,j);\nif(b!=this._bubbleList.isSelected(g)){this.setSelected(g,b);\nappCtxt.getKeyboardMgr().grabFocus(g)\n}}}else{if(h.action==DwtDragEvent.DRAG_END){this._bubbleList._checkSelection();\nif(AjxEnv.isWindows&&(this.getSelectionCount()==0)){this.blur();\nthis.focus()\n}}}}}};\nZmAddressInputField.prototype._mouseDownListener=function(a){a._stopPropagation=false;\na._returnValue=true\n};\nZmAddressInputField.prototype._getIndexFromEvent=function(f){var c,b,g,a;\nvar c=(f.dwtObj&&f.dwtObj.isAddressBubble)?f.dwtObj:null;\nif(c){b=c.getSize().x;\ng=f.docX-c.getLocation().x;\na=this._getBubbleIndex(c);\nreturn(g>(b/2))?a+1:a\n}else{a=0;\nvar e=this._holder.childNodes;\nfor(var d=0;\nd<e.length;\nd++){var h=e[d].id;\nc=h&&this._bubble[h];\nif(c){b=c.getSize().x;\ng=f.docX-c.getLocation().x;\nif(g<(b/2)){return a\n}else{a++\n}}else{if(d<(e.length-1)){a++\n}}}return a\n}};\nZmAddressInputField.prototype._setInsertionBar=function(a){if(a==this._dragInsertionBarIndex){return\n}var b=this._dragInsertionBar;\nif(a!=null){b.style.display=\"inline\";\nvar c=this._holder.childNodes[a];\nif(c){this._holder.insertBefore(b,c);\nthis._dragInsertionBarIndex=a\n}}else{b.style.display=\"none\";\nthis._dragInsertionBarIndex=null\n}};\nZmAddressInputField.prototype._getInsertionIndex=function(c){var e=0;\nvar b=this._holder.childNodes;\nfor(var a=0;\na<b.length;\na++){var d=b[a];\nif(d==c){break\n}else{if(d&&this._bubble[d.id]){e++\n}}}return e\n};\nZmAddressBubble=function(g){g=g||{};\ng.id=this.id=g.id||Dwt.getNextId();\ng.className=g.className||\"addrBubble\";\nif(g.addClass){g.className=[g.className,g.addClass].join(\" \")\n}DwtControl.call(this,g);\nthis.type=g.type;\nthis.isAddressBubble=true;\nvar f=this.addrInput=g.addrInput;\nvar b=this.match=g.match;\nvar a=!g.noParse&&(g.address||(b&&b.email));\nvar e=this.addrObj=g.addrObj||(a&&AjxEmailAddress.parse(a));\nthis.address=g.address||(e&&e.toString());\nthis.email=g.email=g.email||(e&&e.getAddress())||\"\";\nthis.hashKey=this.type===ZmId.SEARCH?this.address:this.email;\nvar c=window.parentAppCtxt||window.appCtxt;\nthis.canExpand=g.canExpand=g.canExpand||c.isExpandableDL(this.email);\nthis._createHtml(g);\nthis._setEventHdlrs([DwtEvent.ONCLICK,DwtEvent.ONDBLCLICK,DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEOUT,DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEMOVE,DwtEvent.ONMOUSEUP]);\nthis.addListener(DwtEvent.ONCLICK,this._clickListener.bind(this));\nthis.addListener(DwtEvent.ONDBLCLICK,this._dblClickListener.bind(this));\nthis.addListener(DwtEvent.ONMOUSEUP,this._mouseUpListener.bind(this));\nif(f){var d=new DwtDragSource(Dwt.DND_DROP_MOVE);\nd.addDragListener(this._dragListener.bind(this));\nthis.setDragSource(d)\n}this._evtMgr=new AjxEventMgr();\nthis._selEv=new DwtSelectionEvent(true)\n};\nZmAddressBubble.prototype=new DwtControl;\nZmAddressBubble.prototype.constructor=ZmAddressBubble;\nZmAddressBubble.prototype.isZmAddressBubble=true;\nZmAddressBubble.prototype.toString=function(){return\"ZmAddressBubble\"\n};\nZmAddressBubble.prototype.isFocusable=true;\nZmAddressBubble.prototype._createElement=function(){return document.createElement(\"SPAN\")\n};\nZmAddressBubble.prototype._createHtml=function(b){var a=this.getHtmlElement();\na.innerHTML=ZmAddressBubble.getContent(b);\nif(b.parentId){a._aifId=b.parentId\n}};\nZmAddressBubble.getContent=function(r){var n=r.id;\nvar g=r.addrObj||(!r.noParse&&AjxEmailAddress.parse(r.address))||r.address||ZmMsg.unknown;\nvar d=AjxStringUtil.htmlEncode(g?g.toString():r.address);\nvar l=AjxStringUtil.htmlEncode(g?g.toString(appCtxt.get(ZmSetting.SHORT_ADDRESS)):r.address);\nvar j=\"\",s=\"\",b=\"\";\nvar o=\"cursor:pointer;position:absolute;top:2px;\";\nif(r.canExpand){var e=r.email||r.address;\nvar k=n+\"_expand\";\nvar u='ZmAddressBubble.expandBubble(\"'+n+'\",\"'+e+'\");';\nvar t=o+\"left:2px;\";\nvar j=AjxImg.getImageHtml(\"BubbleExpand\",t,\"id='\"+k+\"' onclick='\"+u+\"'\");\nb+=\"padding-left:12px;\"\n}if(r.canRemove){var a=n+\"_remove\";\nvar f='ZmAddressInputField.removeBubble(\"'+n+'\");';\nvar q=o+\"right:2px;\";\nvar s=AjxImg.getImageHtml(\"BubbleDelete\",q,\"id='\"+a+\"' onclick='\"+f+\"'\");\nb+=\"padding-right:12px;\"\n}var h=[],m=0;\nvar c=(r.canExpand||r.canRemove)?\" style='\"+b+\"'\":\"\";\nh[m++]=\"<span\"+c+\">\"+l+\" </span>\";\nvar p=h.join(\"\");\nreturn j+p+s\n};\nZmAddressBubble.prototype.getKeyMapName=function(){return DwtKeyMap.MAP_BUTTON\n};\nZmAddressBubble.prototype.handleKeyAction=function(a,b){if(!this.list||(this.addrInput&&this.addrInput._editMode)){return true\n}switch(a){case DwtKeyMap.SELECT:case DwtKeyMap.SUBMENU:this.list._itemActioned(b,this);\nbreak\n}return true\n};\nZmAddressBubble.prototype.addSelectionListener=function(a){this._evtMgr.addListener(DwtEvent.SELECTION,a)\n};\nZmAddressBubble.prototype.removeSelectionListener=function(a){this._evtMgr.removeListener(DwtEvent.SELECTION,a)\n};\nZmAddressBubble.prototype._clickListener=function(a){if(this.list&&this._dragging==DwtControl._NO_DRAG){this.list._itemClicked(a,this)\n}else{if(this._evtMgr.isListenerRegistered(DwtEvent.SELECTION)){DwtUiEvent.copy(this._selEv,a);\nthis._selEv.item=this;\nthis._selEv.detail=DwtEvent.ONCLICK;\nthis._evtMgr.notifyListeners(DwtEvent.SELECTION,this._selEv)\n}}};\nZmAddressBubble.prototype._dblClickListener=function(a){if(!this.list){return\n}this.list._itemDoubleClicked(a,this)\n};\nZmAddressBubble.prototype._mouseUpListener=function(a){if(!this.list){return\n}if(a.button==DwtMouseEvent.RIGHT){this.list._itemActioned(a,this)\n}};\nZmAddressBubble.prototype._getDragProxy=function(b){var a=document.createElement(\"div\");\na.className=this._className;\nDwt.setPosition(a,Dwt.ABSOLUTE_STYLE);\nvar d=this.addrInput.getSelectionCount(this);\nvar c;\nif(d==1){var e=AjxEmailAddress.parse(this.address)||this.address||ZmMsg.unknown;\nc=AjxStringUtil.htmlEncode(e?e.toString(appCtxt.get(ZmSetting.SHORT_ADDRESS)):this.address)\n}else{c=AjxMessageFormat.format(ZmMsg.numAddresses,d)\n}a.innerHTML=c;\nthis.shell.getHtmlElement().appendChild(a);\nDwt.setZIndex(a,Dwt.Z_DND);\nreturn a\n};\nZmAddressBubble.prototype._dragListener=function(a){if(a.action==DwtDragEvent.SET_DATA){a.srcData={selection:this.addrInput.getSelection(this),addrInput:this.addrInput}\n}};\nZmAddressBubble.prototype._dragOver=function(a){this.addrInput._dragOver(a)\n};\nZmAddressBubble.prototype.getToolTipContent=function(c){var b={address:this.addrObj,ev:c};\nvar a=new AjxCallback(this,function(d){appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,b,d)\n});\nreturn{callback:a}\n};\nZmAddressBubble.prototype.hasFocus=function(){return true\n};\nZmAddressBubble.expandBubble=function(d,c){var b=document.getElementById(d);\nif(b){var g=b._aifId||ZmAddressInputField.BUBBLE_OBJ_ID[d];\nvar e=b&&DwtControl.ALL_BY_ID[g];\nif(e&&e.getEnabled()&&e._aclv){var a=DwtControl.fromElementId(d);\nif(a){var f=a.getLocation();\nf.y+=a.getSize().y+2;\ne._aclv.expandDL({email:c,textId:a._htmlElId,loc:f,element:e._input})\n}}}};\nZmAddressBubbleList=function(a){a=a||{};\nthis.parent=a.parent;\nthis._separator=a.separator||AjxEmailAddress.SEPARATOR;\nthis._normalClass=a.normalClass||\"addrBubble\";\nthis._selClass=a.selClass||this._normalClass+\"-\"+DwtCssStyle.SELECTED;\nthis._actionClass=a.rightSelClass||this._normalClass+\"-\"+DwtCssStyle.ACTIONED;\nthis._evtMgr=new AjxEventMgr();\nthis._selEv=new DwtSelectionEvent(true);\nthis._actionEv=new DwtListViewActionEvent(true);\nthis.reset()\n};\nZmAddressBubbleList.prototype.isZmAddressBubbleList=true;\nZmAddressBubbleList.prototype.toString=function(){return\"ZmAddressBubbleList\"\n};\nZmAddressBubbleList.prototype.set=function(d){this._bubbleList=[];\nvar c={};\nthis._numSelected=0;\nfor(var b=0;\nb<d.length;\nb++){var a=d[b];\nthis._bubbleList.push(a);\nif(this._selected[a.id]){c[a.id]=true;\nthis._numSelected++\n}}this._selected=c\n};\nZmAddressBubbleList.prototype.getArray=function(a){return this._bubbleList\n};\nZmAddressBubbleList.prototype.add=function(a,b){AjxUtil.arrayAdd(this._bubbleList,a,b);\na.list=this\n};\nZmAddressBubbleList.prototype.remove=function(a){AjxUtil.arrayRemove(this._bubbleList,a);\na.list=null;\nif(this._selected[a.id]){this._numSelected--;\nthis._selected[a.id]=false;\nthis._checkSelection()\n}if(a==this._rightSelBubble){this._rightSelBubble=null\n}a.dispose()\n};\nZmAddressBubbleList.prototype.clear=function(){while(this._bubbleList.length>0){this.remove(this._bubbleList[this._bubbleList.length-1])\n}};\nZmAddressBubbleList.prototype.getBubble=function(a){a=a||0;\nreturn this._bubbleList[a]\n};\nZmAddressBubbleList.prototype.addSelectionListener=function(a){this._evtMgr.addListener(DwtEvent.SELECTION,a)\n};\nZmAddressBubbleList.prototype.removeSelectionListener=function(a){this._evtMgr.removeListener(DwtEvent.SELECTION,a)\n};\nZmAddressBubbleList.prototype.addActionListener=function(a){this._evtMgr.addListener(DwtEvent.ACTION,a)\n};\nZmAddressBubbleList.prototype.removeActionListener=function(a){this._evtMgr.removeListener(DwtEvent.ACTION,a)\n};\nZmAddressBubbleList.prototype._itemClicked=function(h,f){if(h.shiftKey){if(this._lastSelectedId){var d=false;\nfor(var g=0,c=this._bubbleList.length;\ng<c;\ng++){var a=this._bubbleList[g];\nif(a==f||a.id==this._lastSelectedId){if(d){this.setSelected(a,true);\nd=false;\ncontinue\n}d=!d\n}this.setSelected(a,d)\n}}}else{if(h.ctrlKey||h.metaKey){this.setSelected(f,!this._selected[f.id]);\nif(this._selected[f.id]){this._lastSelectedId=f.id\n}}else{var e=((this.getSelectionCount()==1)&&this._selected[f.id]);\nthis.deselectAll();\nthis.setSelected(f,!e);\nthis._lastSelectedId=e?null:f.id\n}}if(this._evtMgr.isListenerRegistered(DwtEvent.SELECTION)){DwtUiEvent.copy(this._selEv,h);\nthis._selEv.item=f;\nthis._selEv.detail=DwtEvent.ONCLICK;\nthis._evtMgr.notifyListeners(DwtEvent.SELECTION,this._selEv)\n}};\nZmAddressBubbleList.prototype._itemDoubleClicked=function(b,a){if(this._evtMgr.isListenerRegistered(DwtEvent.SELECTION)){DwtUiEvent.copy(this._selEv,b);\nthis._selEv.item=a;\nthis._selEv.detail=DwtEvent.ONDBLCLICK;\nthis._evtMgr.notifyListeners(DwtEvent.SELECTION,this._selEv)\n}};\nZmAddressBubbleList.prototype._itemActioned=function(b,a){this._rightSelBubble=a;\na.setClassName(this._actionClass);\nif(this._evtMgr.isListenerRegistered(DwtEvent.ACTION)){DwtUiEvent.copy(this._actionEv,b);\nthis._actionEv.item=a;\nthis._evtMgr.notifyListeners(DwtEvent.ACTION,this._actionEv)\n}};\nZmAddressBubbleList.prototype.setSelected=function(a,b){if(!a){return\n}if(b==Boolean(this._selected[a.id])){return\n}this._selected[a.id]=b;\na.setClassName(b?this._selClass:this._normalClass);\nthis._numSelected=b?this._numSelected+1:this._numSelected-1;\nthis._checkSelection()\n};\nZmAddressBubbleList.prototype.isSelected=function(a){return Boolean(a&&this._selected[a.id])\n};\nZmAddressBubbleList.prototype.getSelection=function(a){var d=a||this._rightSelBubble;\nvar c=false;\nvar e=[];\nfor(var b=0;\nb<this._bubbleList.length;\nb++){var a=this._bubbleList[b];\nif(this._selected[a.id]){e.push(a);\nif(a==d){c=true\n}}}e=(d&&!c)?[d]:e;\nreturn e\n};\nZmAddressBubbleList.prototype.getSelectionCount=function(a){return a?this.getSelection(a).length:this._numSelected\n};\nZmAddressBubbleList.prototype.deselectAll=function(){var c=this.getSelection();\nfor(var b=0,a=c.length;\nb<a;\nb++){this.setSelected(c[b],false)\n}this._selected={};\nthis._numSelected=0\n};\nZmAddressBubbleList.prototype.clearRightSelection=function(){this._rightSelBubble=null\n};\nZmAddressBubbleList.prototype.reset=function(a){this._bubbleList=[];\nthis._selected={};\nthis._numSelected=0\n};\nZmAddressBubbleList.prototype.size=function(){return this._bubbleList.length\n};\nZmAddressBubbleList.prototype.selectAddressText=function(){var d=this.getSelection();\nvar c=[];\nfor(var b=0;\nb<d.length;\nb++){c.push(d[b].address)\n}var a=this._getTextarea();\na.value=c.join(this._separator)+this._separator;\na.focus();\na.select()\n};\nZmAddressBubbleList.prototype._getTextarea=function(){if(!ZmAddressBubbleList._textarea){var a=ZmAddressBubbleList._textarea=document.createElement(\"textarea\");\na.id=\"abcb\";\na[\"data-hidden\"]=\"1\";\nappCtxt.getShell().getHtmlElement().appendChild(a);\nDwt.setPosition(a,Dwt.ABSOLUTE_STYLE);\nDwt.setLocation(a,Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE)\n}return ZmAddressBubbleList._textarea\n};\nZmAddressBubbleList.prototype._checkSelection=function(){if(this.parent&&(this.parent._noOutsideListening||this.parent._dragging==DwtControl._DRAGGING)){return\n}if(!this._listening&&this._numSelected==1){var a=appCtxt.getOutsideMouseEventMgr();\nvar b={id:\"ZmAddressBubbleList\",elementId:null,outsideListener:this._outsideMouseListener.bind(this),noWindowBlur:appCtxt.get(ZmSetting.IS_DEV_SERVER)};\na.startListening(b);\nthis._listening=true\n}else{if(this._listening&&this._numSelected==0){var a=appCtxt.getOutsideMouseEventMgr();\nvar b={id:\"ZmAddressBubbleList\",elementId:null};\na.stopListening(b);\nthis._listening=false\n}}this.selectAddressText()\n};\nZmAddressBubbleList.prototype._outsideMouseListener=function(b,a){if(!b.shiftKey&&!b.ctrlKey&&!b.metaKey){this.deselectAll()\n}}\n}if(AjxPackage.define(\"zimbraMail.share.view.ZmColorMenu\")){ZmColorMenu=function(a){if(arguments.length==0){return\n}a.className=a.className||\"ZmColorMenu DwtMenu\";\nDwtMenu.call(this,a);\nthis._hideNone=a.hideNone;\nthis._hideNoFill=a.hideNoFill;\nthis.setImage(a.image);\nthis._populateMenu()\n};\nZmColorMenu.prototype=new DwtMenu;\nZmColorMenu.prototype.constructor=ZmColorMenu;\nZmColorMenu.prototype.toString=function(){return\"ZmColorMenu\"\n};\nZmColorMenu.__KEY_COLOR=\"color\";\nZmColorMenu.prototype.setImage=function(e){if(this._image!=e){this._image=e;\nvar c=this.getChildren();\nfor(var b=0;\nb<c.length;\nb++){var g=c[b];\nvar a=g.getData(ZmColorMenu.__KEY_COLOR);\nvar f=a||ZmOrganizer.COLOR_VALUES[ZmOrganizer.ORG_DEFAULT_COLOR];\nvar d=[e,f].join(\",color=\");\ng.setImage(d)\n}}};\nZmColorMenu.prototype.getImage=function(){return this._image\n};\nZmColorMenu.prototype.getTextForColor=function(b){b=String(b).toLowerCase();\nif(!b.match(/^#/)){b=ZmOrganizer.COLOR_VALUES[b]\n}var d=this.getChildren();\nfor(var c=0;\nc<d.length;\nc++){var a=d[c];\nif(a.getData(ZmColorMenu.__KEY_COLOR)==b){return a.getText()\n}}return ZmMsg.custom\n};\nZmColorMenu.prototype.showMoreColors=function(){if(this.parent&&this.parent.getMenu()==this){var c=this.parent.getMenu();\nvar a=this._getMoreColorMenu();\nthis.parent.setMenu(a);\nif(c.isPoppedUp()){var b=c.getLocation();\nc.popdown();\na.popup(0,b.x,b.y)\n}else{this.parent.popup()\n}}};\nZmColorMenu.prototype.showLessColors=function(){if(this.parent&&this.parent.getMenu()!=this){var b=this.parent.getMenu();\nthis.parent.setMenu(this);\nif(b.isPoppedUp()){var a=b.getLocation();\nb.popdown();\nthis.popup(0,a.x,a.y)\n}else{this.parent.popup()\n}}};\nZmColorMenu.prototype.addSelectionListener=function(a){DwtMenu.prototype.addSelectionListener.apply(this,arguments);\nthis._getMoreColorMenu().addSelectionListener(a)\n};\nZmColorMenu.prototype.removeSelectionListener=function(a){DwtMenu.prototype.removeSelectionListener.apply(this,arguments);\nthis._getMoreColorMenu().removeSelectionListener(a)\n};\nZmColorMenu.prototype._populateMenu=function(){var h=ZmOrganizer.COLOR_VALUES;\nfor(var c=0;\nc<h.length;\nc++){var f=ZmOrganizer.COLOR_VALUES[c];\nif(!f&&this._hideNone){continue\n}var d=f||ZmOrganizer.COLOR_VALUES[ZmOrganizer.ORG_DEFAULT_COLOR];\nvar e=this._image?[this._image,d].join(\",color=\"):null;\nvar k=ZmOrganizer.COLOR_TEXT[c];\nvar a=\"COLOR_\"+c;\nvar b=new DwtMenuItem({parent:this,id:a});\nb.setImage(e);\nb.setText(k);\nb.setData(ZmOperation.MENUITEM_ID,c);\nb.setData(ZmColorMenu.__KEY_COLOR,f)\n}var j=new AjxCallback(this,this.showMoreColors);\nvar g=new ZmColorMenuItem({parent:this,callback:j,id:\"SHOW_MORE_ITEMS\"});\ng.setText(ZmMsg.colorsShowMore)\n};\nZmColorMenu.prototype._getMoreColorMenu=function(){if(!this._moreMenu){var a=new AjxCallback(this,this.showLessColors);\nthis._moreMenu=new ZmMoreColorMenu({parent:this.parent,callback:a,hideNoFill:this._hideNoFill})\n}return this._moreMenu\n};\nZmMoreColorMenu=function(b){b.style=DwtMenu.COLOR_PICKER_STYLE;\nDwtMenu.call(this,b);\nthis._colorPicker=new DwtColorPicker({parent:this,hideNoFill:b.hideNoFill});\nthis._colorPicker.getData=this.__DwtColorPicker_getData;\nvar a=new ZmColorMenuItem({parent:this,callback:b.callback});\na.setText(ZmMsg.colorsShowLess)\n};\nZmMoreColorMenu.prototype=new DwtMenu;\nZmMoreColorMenu.prototype.constructor=ZmMoreColorMenu;\nZmMoreColorMenu.prototype.toString=function(){return\"ZmMoreColorMenu\"\n};\nZmMoreColorMenu.prototype.__DwtColorPicker_getData=function(a){if(a==ZmOperation.MENUITEM_ID){return this.getInputColor()\n}return DwtColorPicker.prototype.getData.apply(this,arguments)\n};\nZmMoreColorMenu.prototype.setDefaultColor=function(a){this._colorPicker.setDefaultColor(a)\n};\nZmColorMenuItem=function(a){DwtMenuItem.call(this,a);\nthis.callback=a.callback;\nDwtMenuItem.prototype.addSelectionListener.call(this,new AjxListener(this,this.__handleItemSelect))\n};\nZmColorMenuItem.prototype=new DwtMenuItem;\nZmColorMenuItem.prototype.constructor=ZmColorMenuItem;\nZmColorMenuItem.prototype.toString=function(){return\"ZmColorMenuItem\"\n};\nZmColorMenuItem.prototype.TEMPLATE=\"zimbra.Widgets#ZmColorMenuItem\";\nZmColorMenuItem.prototype.addSelectionListener=function(){};\nZmColorMenuItem.prototype.removeSelectionListener=function(){};\nZmColorMenuItem.prototype.__handleItemSelect=function(){if(this.callback){this.callback.run()\n}}\n}if(AjxPackage.define(\"zimbraMail.share.view.ZmColorButton\")){ZmColorButton=function(b){if(arguments.length==0){return\n}DwtButton.call(this,b);\nvar a=new ZmColorMenu({parent:this,hideNone:b.hideNone});\na.addSelectionListener(new AjxListener(this,this._handleSelection));\nthis.setMenu(a);\nthis._colorMenu=a;\nthis._labelId=b.labelId\n};\nZmColorButton.prototype=new DwtButton;\nZmColorButton.prototype.constructor=ZmColorButton;\nZmColorButton.prototype.isZmColorButton=true;\nZmColorButton.prototype.toString=function(){return\"ZmColorButton\"\n};\nZmColorButton.prototype.setImage=function(b,a){DwtButton.prototype.setImage.apply(this,arguments);\nif(!a){this._colorMenu.setImage(b)\n}};\nZmColorButton.prototype.setValue=function(a){var c=ZmOrganizer.getStandardColorNumber(a),b;\nif(c!==-1){this._color=c;\nb=\"COLOR_\"+c\n}else{this._color=a\n}var d=this.getImage();\nif(d){d=d.replace(/,.*$/,\"\");\nvar e=this._color||ZmOrganizer.COLOR_VALUES[ZmOrganizer.ORG_DEFAULT_COLOR];\nthis.setImage([d,this._color].join(\",color=\"),true)\n}this.setText(this._colorMenu.getTextForColor(this._color));\nif(b){this.removeAttribute(\"aria-label\");\nthis.setAttribute(\"aria-labelledby\",[this._labelId,b].join(\" \"))\n}};\nZmColorButton.prototype.getValue=function(){return this._color\n};\nZmColorButton.prototype._handleSelection=function(a){this.setValue(a.item.getData(ZmOperation.MENUITEM_ID))\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.ZmFolderChooser\")){ZmFolderChooser=function(f){if(arguments.length==0){return\n}f.className=f.className||\"ZmFolderChooser\";\nDwtComposite.call(this,f);\nthis._overview={};\nthis._opc=appCtxt.getOverviewController();\nthis._treeView={};\nthis._folderTreeDivId=this._htmlElId+\"_folderTreeDivId\";\nthis._uuid=Dwt.getNextId();\nAjxDispatcher.require(\"Extras\");\nthis._changeListener=ZmChooseFolderDialog.prototype._folderTreeChangeListener.bind(this);\nthis._treeViewListener=this._treeViewSelectionListener.bind(this);\nvar e=f.parent;\ne._addItem(this,f.index);\nthis._moveOnFolderCreate=true;\nif(!f.hideNewButton){new DwtMenuItem({parent:e,style:DwtMenuItem.SEPARATOR_STYLE});\nvar h=this._newButton=new DwtMenuItem({parent:e,id:e.getHTMLElId()+\"|NEWFOLDER\"});\nvar a=appCtxt.getCurrentAppName();\nvar g=ZmApp.MAIL;\nvar b=ZmFolderChooser.NEW_ORG_KEY[a]||ZmFolderChooser.NEW_ORG_KEY[g];\nvar d=ZmFolderChooser.NEW_ORG_ICON[a]||ZmFolderChooser.NEW_ORG_ICON[g];\nvar c=ZmFolderChooser.NEW_ORG_SHORTCUT[a];\nh.setText(ZmMsg[b]);\nh.setImage(d);\nif(c){h.setShortcut(appCtxt.getShortcutHint(this._keyMap,c))\n}h.addSelectionListener(this._showNewDialog.bind(this))\n}this._init()\n};\nZmFolderChooser.prototype=new DwtComposite;\nZmFolderChooser.prototype.constructor=ZmFolderChooser;\nZmFolderChooser.prototype.isZmFolderChooser=true;\nZmFolderChooser.prototype.toString=function(){return\"ZmFolderChooser\"\n};\nZmFolderChooser.NEW_ORG_KEY={};\nZmFolderChooser.NEW_ORG_KEY[ZmApp.MAIL]=\"newFolder\";\nZmFolderChooser.NEW_ORG_KEY[ZmApp.CONTACTS]=\"newAddrBook\";\nZmFolderChooser.NEW_ORG_KEY[ZmApp.CALENDAR]=\"newCalendar\";\nZmFolderChooser.NEW_ORG_KEY[ZmApp.TASKS]=\"newTaskFolder\";\nZmFolderChooser.NEW_ORG_ICON={};\nZmFolderChooser.NEW_ORG_ICON[ZmApp.MAIL]=\"NewFolder\";\nZmFolderChooser.NEW_ORG_ICON[ZmApp.CONTACTS]=\"NewContactsFolder\";\nZmFolderChooser.NEW_ORG_ICON[ZmApp.CALENDAR]=\"NewAppointment\";\nZmFolderChooser.NEW_ORG_ICON[ZmApp.TASKS]=\"NewTaskList\";\nZmFolderChooser.NEW_ORG_SHORTCUT={};\nZmFolderChooser.NEW_ORG_SHORTCUT[ZmApp.MAIL]=ZmKeyMap.NEW_FOLDER;\nZmFolderChooser.NEW_ORG_SHORTCUT[ZmApp.CALENDAR]=ZmKeyMap.NEW_CALENDAR;\nZmFolderChooser.prototype.setupFolderChooser=function(a,b){this._selectionCallback=b;\nthis._overviewId=a.overviewId;\nZmChooseFolderDialog.prototype.popup.call(this,a,true)\n};\nZmFolderChooser.prototype._getNewButton=function(){return this._newButton\n};\nZmFolderChooser.prototype.updateData=function(a){this._data=a\n};\nZmFolderChooser.prototype._focus=function(){var a=this._overview[this._overviewId];\nif(a){a.focus()\n}};\nZmFolderChooser.prototype._doPopup=function(a){ZmChooseFolderDialog.prototype._doPopup.call(this,a,true)\n};\nZmFolderChooser.prototype._setOverview=function(c,a){c.overviewClass=\"menuOverview\";\nc.dynamicWidth=true;\nvar b=ZmDialog.prototype._setOverview.call(this,c,a);\nif(!appCtxt.multiAccounts||a){this._overview[c.overviewId]=b\n}return b\n};\nZmFolderChooser.prototype._renderOverview=function(){ZmDialog.prototype._renderOverview.apply(this,arguments)\n};\nZmFolderChooser.prototype._setRootSelection=function(){ZmDialog.prototype._setRootSelection.apply(this,arguments)\n};\nZmFolderChooser.prototype._makeOverviewVisible=function(){ZmDialog.prototype._makeOverviewVisible.apply(this,arguments)\n};\nZmFolderChooser.prototype._resetTree=function(a,b){ZmChooseFolderDialog.prototype._resetTree.call(this,a,b)\n};\nZmFolderChooser.prototype._getOverview=function(){return ZmChooseFolderDialog.prototype._getOverview.call(this)\n};\nZmFolderChooser.prototype._treeViewSelectionListener=function(c){if(c.detail!=DwtTree.ITEM_SELECTED){return\n}if(!c.clicked&&!c.enter){return\n}if(this._getOverview() instanceof ZmAccountOverviewContainer){if(c.item instanceof DwtHeaderTreeItem){return\n}var b=this._opc.getOverviewContainer(this._curOverviewId);\nvar e=b.getOverview(c.item.getData(ZmTreeView.KEY_ID));\nb.deselectAll(e)\n}var a=c.item&&c.item.getData(Dwt.KEY_OBJECT);\nif(a.id==ZmFolder.ID_LOAD_FOLDERS){return\n}var d=a?a.getName(null,null,true):c.item.getText();\nthis._lastVal=d.toLowerCase();\nthis._doSelection()\n};\nZmFolderChooser.prototype._doSelection=function(d){d=d||this._getOverview().getSelected();\nif(!d){d=appCtxt.getById(this._selected)\n}var b=(d&&(!(d instanceof Array)))?[d]:d;\nvar g=(!b||(b&&b.length==0))?ZmMsg.noTargetFolder:null;\nif(!g&&this._data){for(var c=0;\nc<b.length;\nc++){var f=b[c];\nif(f.mayContain&&!f.mayContain(this._data,null,this._acceptFolderMatch)){if(this._data instanceof ZmFolder){g=ZmMsg.badTargetFolder\n}else{var a=AjxUtil.toArray(this._data);\nfor(var c=0;\nc<a.length;\nc++){var e=a[c];\nif(!e){continue\n}if(e.isDraft&&(f.nId!=ZmFolder.ID_TRASH&&f.nId!=ZmFolder.ID_DRAFTS&&f.rid!=ZmFolder.ID_DRAFTS)){g=ZmMsg.badTargetFolderForDraftItem;\nbreak\n}else{if((f.nId==ZmFolder.ID_DRAFTS||f.rid==ZmFolder.ID_DRAFTS)&&!e.isDraft){g=ZmMsg.badItemForDraftsFolder;\nbreak\n}}}if(!g){g=ZmMsg.badTargetFolderItems\n}}break\n}}}if(g){ZmDialog.prototype._showError.call(this,g);\nreturn\n}if(this._selectionCallback){this._selectionCallback(d)\n}};\nZmFolderChooser.prototype._resetTreeView=function(a){ZmChooseFolderDialog.prototype._resetTreeView.call(this,a)\n};\nZmFolderChooser.prototype.getOverviewId=function(a){return appCtxt.getOverviewId([this.toString(),a],null)\n};\nZmFolderChooser.prototype._loadFolders=function(){ZmChooseFolderDialog.prototype._loadFolders.call(this)\n};\nZmFolderChooser.prototype._init=function(){var b=[],a=0;\nb[a++]=\"<table cellspacing='0' cellpadding='0' style='border-collapse:collapse;'>\";\nb[a++]=\"<tr><td><div id='\"+this._folderTreeDivId+\"'>\";\nb[a++]=\"</div></td></tr>\";\nb[a++]=\"</table>\";\nthis.getHtmlElement().innerHTML=b.join(\"\")\n};\nZmFolderChooser.prototype._showNewDialog=function(){var c=this._getOverview().getSelected(true);\nvar a=(c&&c.type)||this._treeIds[0];\nvar d=this._opc.getTreeController(a);\nvar b=d._getNewDialog();\nb.reset();\nb.registerCallback(DwtDialog.OK_BUTTON,ZmChooseFolderDialog.prototype._newCallback,this,[d,b]);\nthis.parent.popdown();\nb.popup()\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.htmlEditor.ZmHtmlEditor\")){ZmHtmlEditor=function(){if(arguments.length==0){return\n}var c=Dwt.getParams(arguments,ZmHtmlEditor.PARAMS);\nif(!c.className){c.className=\"ZmHtmlEditor\"\n}if(!c.id){c.id=Dwt.getNextId(\"ZmHtmlEditor\")\n}DwtControl.call(this,c);\nthis.isTinyMCE=window.isTinyMCE;\nthis._mode=c.mode;\nthis._hasFocus={};\nthis._bodyTextAreaId=c.textAreaId||this.getHTMLElId()+\"_body\";\nthis._iFrameId=this._bodyTextAreaId+\"_ifr\";\nthis._initCallbacks=[];\nthis._attachmentCallback=c.attachmentCallback;\nthis._pasteCallback=c.pasteCallback;\nthis._onContentInitializeCallbacks=[];\nthis.initTinyMCEEditor(c);\nthis._ignoreWords={};\nthis._classCount=0;\nif(c.initCallback){this._initCallbacks.push(c.initCallback)\n}var a=appCtxt.getSettings();\nvar b=new AjxListener(this,this._settingChangeListener);\na.getSetting(ZmSetting.COMPOSE_INIT_FONT_COLOR).addChangeListener(b);\na.getSetting(ZmSetting.COMPOSE_INIT_FONT_FAMILY).addChangeListener(b);\na.getSetting(ZmSetting.COMPOSE_INIT_FONT_SIZE).addChangeListener(b);\na.getSetting(ZmSetting.COMPOSE_INIT_DIRECTION).addChangeListener(b);\na.getSetting(ZmSetting.SHOW_COMPOSE_DIRECTION_BUTTONS).addChangeListener(b);\nthis.addControlListener(this._resetSize.bind(this));\nthis.addListener(DwtEvent.ONFOCUS,this._onFocus.bind(this));\nthis.addListener(DwtEvent.ONBLUR,this._onBlur.bind(this))\n};\nZmHtmlEditor.PARAMS=[\"parent\",\"posStyle\",\"content\",\"mode\",\"withAce\",\"parentElement\",\"textAreaId\",\"attachmentCallback\",\"initCallback\"];\nZmHtmlEditor.prototype=new DwtControl();\nZmHtmlEditor.prototype.constructor=ZmHtmlEditor;\nZmHtmlEditor.prototype.isZmHtmlEditor=true;\nZmHtmlEditor.prototype.isInputControl=true;\nZmHtmlEditor.prototype.toString=function(){return\"ZmHtmlEditor\"\n};\nZmHtmlEditor.TINY_MCE_PATH=\"/js/ajax/3rdparty/tinymce\";\nZmHtmlEditor.VALUE=\"value\";\nZmHtmlEditor._INITDELAY=50;\nZmHtmlEditor._containerDivId=\"zimbraEditorContainer\";\nZmHtmlEditor.prototype.getEditor=function(){return(window.tinyMCE)?tinyMCE.get(this._bodyTextAreaId):null\n};\nZmHtmlEditor.prototype.getBodyFieldId=function(){if(this._mode==Dwt.HTML){var a=this.getEditor();\nreturn a?this._iFrameId:this._bodyTextAreaId\n}return this._bodyTextAreaId\n};\nZmHtmlEditor.prototype.getBodyField=function(){return document.getElementById(this.getBodyFieldId())\n};\nZmHtmlEditor.prototype._resetSize=function(){var f=this.getContentField();\nif(this._resetSizeAction){clearTimeout(this._resetSizeAction);\nthis._resetSizeAction=null\n}if(f){var e=this.boundsForChild(f);\nDwt.setSize(f,e.width,e.height)\n}var d=this.getEditor();\nif(!d||!d.getContentAreaContainer()||!d.getBody()){if(this.getVisible()){this._resetSizeAction=setTimeout(ZmHtmlEditor.prototype._resetSize.bind(this),100)\n}return\n}var c=Dwt.byId(this._iFrameId);\nvar e=this.boundsForChild(c);\nvar b=e.width,h=e.height;\nAjxUtil.foreach(Dwt.byClassName(\"mce-toolbar-grp\",d.getContainer()),function(j){h-=Dwt.getSize(j).y\n});\nif(e.height-h>200){this._resetSizeAction=setTimeout(ZmHtmlEditor.prototype._resetSize.bind(this),100);\nreturn\n}var g=this._spellCheckModeDivId&&document.getElementById(this._spellCheckModeDivId);\nif(g&&g.style.display!==\"none\"){h=h-Dwt.getSize(g).y\n}if(isNaN(b)||b<0||isNaN(h)||h<0){if(this.getVisible()){this._resetSizeAction=setTimeout(ZmHtmlEditor.prototype._resetSize.bind(this),100)\n}return\n}Dwt.setSize(c,Math.max(0,b),Math.max(0,h));\nvar a=d.getBody();\nvar e=Dwt.insetBounds(Dwt.insetBounds({x:0,y:0,width:b,height:h},Dwt.getMargins(a)),Dwt.getInsets(a));\nDwt.setSize(a,Math.max(0,e.width),Math.max(0,e.height))\n};\nZmHtmlEditor.prototype.focus=function(c){var a=this,b;\nif(a._mode===Dwt.HTML){c=c||a.getEditor();\nif(a._editorInitialized&&c){c.focus();\na.setFocusStatus(true);\nc.getWin().scrollTo(0,0)\n}}else{b=a.getContentField();\nif(b){b.focus();\na.setFocusStatus(true,true)\n}}};\nZmHtmlEditor.prototype.getTextVersion=function(b,a){this.discardMisspelledWords(a);\nreturn this._mode===Dwt.HTML?this._convertHtml2Text(b):this.getContentField().value\n};\nZmHtmlEditor.prototype._focus=function(){if(this._mode===Dwt.HTML&&this.getEditor()){this.getEditor().focus()\n}};\nZmHtmlEditor.prototype.getContent=function(b,a){this.discardMisspelledWords();\nvar f=this.getContentField();\nvar e=\"\";\nif(this._mode==Dwt.HTML){var c=this.getEditor(),d=\"\";\nif(c){d=c.save({format:\"raw\",set_dirty:false})\n}else{d=f.value||\"\"\n}if(d&&(/\\S+/.test(AjxStringUtil.convertHtml2Text(d))||d.match(/<img/i))){e=this._embedHtmlContent(d,b,a,this._classCount)\n}}else{if(/\\S+/.test(f.value)){e=f.value\n}}return e\n};\nZmHtmlEditor.prototype._embedHtmlContent=function(d,c,b,g){d=d||\"\";\nif(c){if(g){var e=this.getEditor();\nvar a=e.getDoc();\nvar f=a.getElementById(ZmHtmlEditor._containerDivId);\nif(f){f.setAttribute(\"class\",g.toString());\ng=0\n}}d=ZmHtmlEditor._addDivContainer(d,g)\n}return b?d:[\"<html><body>\",d,\"</body></html>\"].join(\"\")\n};\nZmHtmlEditor._embedHtmlContent=ZmHtmlEditor.prototype._embedHtmlContent;\nZmHtmlEditor._addDivContainer=function(a,b){return ZmHtmlEditor._getDivContainerPrefix(b)+a+ZmHtmlEditor._getDivContainerSuffix()\n};\nZmHtmlEditor._getDivContainerPrefix=function(e){var d=!!e;\nvar b=[],c=0;\nb[c++]=\"<div \";\nif(d){b[c++]='id=\"'+ZmHtmlEditor._containerDivId+'\" '\n}b[c++]='style=\"font-family: ';\nb[c++]=appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_FAMILY);\nb[c++]=\"; font-size: \";\nb[c++]=appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_SIZE);\nb[c++]=\"; color: \";\nb[c++]=appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_COLOR);\nb[c++]='\"';\nif(appCtxt.get(ZmSetting.COMPOSE_INIT_DIRECTION)===ZmSetting.RTL){b[c++]=' dir=\"'+ZmSetting.RTL+'\"'\n}if(d){b[c++]=\" class=\"+e.toString()+\" \"\n}b[c++]=\">\";\nreturn b.join(\"\")\n};\nZmHtmlEditor._getDivContainerSuffix=function(){return\"</div>\"\n};\nZmHtmlEditor.prototype.setContent=function(b){if(this._mode===Dwt.HTML&&this._editorInitialized){var a=this.getEditor();\na.setContent(b,{format:\"raw\"});\nthis._setContentStyles(a)\n}else{this.getContentField().value=b\n}this._ignoreWords={}\n};\nZmHtmlEditor.prototype._setContentStyles=function(f){var h=f.getDoc();\nvar k=h.getElementById(ZmHtmlEditor._containerDivId);\nif(k&&k.hasAttribute(\"class\")){this._classCount=parseInt(k.getAttribute(\"class\"));\nif(isNaN(this._classCount)){this._classCount=0\n}}var b=f.dom;\nvar g=h.body;\nvar l=b.select(\"style\",g);\nvar e;\nfor(var d=0;\nd<l.length;\nd++){e=l[d].parentNode;\nif(e.tagName.toLowerCase()!=\"body\"){e.removeChild(l[d]);\nfor(var a=0;\na<g.childElementCount;\na++){if(g.children[a].hasAttribute(\"data-marker\")){const c=g.children[a].getAttribute(\"data-marker\");\nif(c===\"__\"+ZmComposeView.BC_QUOTED_TEXT+\"__\"){g.insertBefore(l[d],g.childNodes[a]);\nreturn\n}}}}}};\nZmHtmlEditor.prototype.reEnableDesignMode=function(){};\nZmHtmlEditor.prototype.getMode=function(){return this._mode\n};\nZmHtmlEditor.prototype.isHtmlModeInited=function(){return Boolean(this.getEditor())\n};\nZmHtmlEditor.prototype._convertHtml2Text=function(b){var c=this.getEditor(),a;\nif(c){a=c.getBody();\nif(a){return(AjxStringUtil.convertHtml2Text(a,b,true))\n}}return\"\"\n};\nZmHtmlEditor.prototype.moveCaretToTop=function(c){if(this._mode==Dwt.TEXT){var b=this.getContentField();\nb.scrollTop=0;\nif(b.createTextRange){var a=b.createTextRange();\nif(c){a.move(\"character\",c)\n}else{a.collapse(true)\n}a.select()\n}else{if(b.setSelectionRange){c=c||0;\nif(b.offsetHeight){b.setSelectionRange(c,c)\n}}}}else{this._moveCaretToTopHtml(true,c)\n}};\nZmHtmlEditor.prototype._moveCaretToTopHtml=function(h,c){var f=this.getEditor();\nvar e=f&&f.getDoc().body;\nvar k=false;\nif(AjxEnv.isIE){if(e){var d=e.createTextRange();\nif(c){d.move(\"character\",c)\n}else{d.collapse(true)\n}k=true\n}}else{var j=f&&f.selection?f.selection.getSel():\"\";\nif(j){if(c){var g=e.firstChild;\nwhile(g){if(c===0){j.collapse(g,c);\nbreak\n}if(g.nodeName===\"#text\"){var l=g.length;\nif(c>l){c=c-l\n}else{j.collapse(g,c);\nbreak\n}}else{if(g.nodeName===\"BR\"){c=c-1\n}}g=g.nextSibling\n}}else{j.collapse(e,0)\n}k=true\n}}if(k){f.focus()\n}else{if(h){if(f){var b=new AjxTimedAction(this,this._moveCaretToTopHtml);\nAjxTimedAction.scheduleAction(b,ZmHtmlEditor._INITDELAY+1)\n}else{var a=ZmHtmlEditor.prototype._moveCaretToTopHtml;\nthis._initCallbacks.push(a.bind(this,h,c))\n}}}};\nZmHtmlEditor.prototype.hasFocus=function(){return Boolean(this._hasFocus[this._mode])\n};\nZmHtmlEditor.prototype._getIframeDoc=ZmHtmlEditor.prototype.getIframeDoc=function(){var a=this.getEditor();\nreturn a?a.getDoc():null\n};\nZmHtmlEditor.prototype._getIframeWin=function(){var a=this.getEditor();\nreturn a?a.getWin():null\n};\nZmHtmlEditor.prototype.clear=function(){var c=this.getEditor();\nif(c&&this._editorInitialized){c.undoManager&&c.undoManager.clear();\nthis.clearDirty()\n}var a=this.getContentField();\nif(!a){return\n}if(!this.isHtmlModeInited()&&this.getMode()===Dwt.HTML){return\n}var b=a.cloneNode(false);\na.parentNode.replaceChild(b,a);\nDwt.setHandler(b,DwtEvent.ONFOCUS,this._onTextareaFocus.bind(this,true,true));\nDwt.setHandler(b,DwtEvent.ONBLUR,this.setFocusStatus.bind(this,false,true));\nDwt.setHandler(b,DwtEvent.ONKEYDOWN,this._handleTextareaKeyEvent.bind(this));\nif(c){c.targetElm=null\n}};\nZmHtmlEditor.prototype.initTinyMCEEditor=function(c){var b=this.getHtmlElement();\nvar e=this._bodyTextAreaId;\nvar a=document.createElement(\"textarea\");\na.setAttribute(\"id\",e);\na.setAttribute(\"name\",e);\na.setAttribute(\"aria-label\",ZmMsg.composeBody);\nif(appCtxt.get(ZmSetting.COMPOSE_INIT_DIRECTION)===ZmSetting.RTL){a.setAttribute(\"dir\",ZmSetting.RTL)\n}a.className=\"ZmHtmlEditorTextArea\";\nif(c.content!==null){a.value=c.content\n}if(this._mode===Dwt.HTML){Dwt.setVisible(a,false)\n}b.appendChild(a);\nthis._textAreaId=e;\nDwt.setHandler(a,DwtEvent.ONFOCUS,this._onTextareaFocus.bind(this,true,true));\nDwt.setHandler(a,DwtEvent.ONBLUR,this.setFocusStatus.bind(this,false,true));\nDwt.setHandler(a,DwtEvent.ONKEYDOWN,this._handleTextareaKeyEvent.bind(this));\nif(!window.tinyMCE){window.tinyMCEPreInit={};\nwindow.tinyMCEPreInit.suffix=\"\";\nwindow.tinyMCEPreInit.base=appContextPath+ZmHtmlEditor.TINY_MCE_PATH;\nwindow.tinyMCE_GZ={};\nwindow.tinyMCE_GZ.loaded=true;\nvar d=this.initEditorManager.bind(this,e,c.autoFocus);\nAjxDispatcher.require([\"TinyMCE\"],true,d)\n}else{this.initEditorManager(e,c.autoFocus)\n}};\nZmHtmlEditor.prototype.addOnContentInitializedListener=function(a){this._onContentInitializeCallbacks.push(a)\n};\nZmHtmlEditor.prototype.clearOnContentInitializedListeners=function(){this._onContentInitializeCallback=null\n};\nZmHtmlEditor.prototype._handleEditorKeyEvent=function(m){var g=this.getEditor(),a=true;\nif(DwtKeyboardMgr.isPossibleInputShortcut(m)||(m.keyCode===DwtKeyEvent.KEY_TAB&&(m.shiftKey||!appCtxt.get(ZmSetting.TAB_IN_EDITOR)))){a=DwtKeyboardMgr.__keyDownHdlr(m)\n}else{if(DwtKeyEvent.IS_RETURN[m.keyCode]){var n,o,b,f,l,k,d,c,h;\nif(m.shiftKey){return\n}o=g.selection;\nn=b=o.getRng(true).startContainer;\nif(!b){return\n}f=g.dom;\nk=f.getParents(b,\"blockquote\",g.getBody());\nif(!k){return\n}k=k.pop();\nif(!k||!k.style.borderLeft){return\n}l=f.uniqueId();\ng.undoManager.add();\ntry{o.setContent(\"<div id='\"+l+\"'><br></div>\")\n}catch(j){return\n}c=g.getDoc().getElementById(l);\nif(c){c.removeAttribute(\"id\")\n}else{return\n}d=c.nextSibling;\nif(d&&d.nodeName===\"BR\"){d.parentNode.removeChild(d)\n}try{h=f.split(k,c);\nif(h){o.select(h);\no.collapse(true);\nm.preventDefault()\n}}catch(j){}}else{if(ZmHtmlEditor.isEditorTab(m)){g.execCommand(\"mceInsertContent\",false,\"&emsp;\");\nDwtUiEvent.setBehaviour(m,true,false);\nreturn false\n}}}if(window.DwtIdleTimer){DwtIdleTimer.resetIdle()\n}if(window.onkeydown){window.onkeydown.call(this)\n}return a\n};\nZmHtmlEditor.prototype._handleTextareaKeyEvent=function(a){if(ZmHtmlEditor.isEditorTab(a)){Dwt.insertText(this.getContentField(),\"\\t\");\nDwtUiEvent.setBehaviour(a,true,false);\nreturn false\n}return true\n};\nZmHtmlEditor.prototype._handleEditorMouseDownEvent=function(a){DwtOutsideMouseEventMgr.forwardEvent(a)\n};\nZmHtmlEditor.prototype.onLoadContent=function(a){if(this._onContentInitializeCallbacks){AjxDebug.println(AjxDebug.REPLY,\"ZmHtmlEditor::onLoadContent - run callbacks\");\nAjxUtil.foreach(this._onContentInitializeCallbacks,function(b){b.run()\n})\n}};\nZmHtmlEditor.prototype.setFocusStatus=function(c,a){var b=a?Dwt.TEXT:Dwt.HTML;\nthis._hasFocus[b]=c;\nDwt.condClass(this.getHtmlElement(),c,DwtControl.FOCUSED);\nif(!a){Dwt.condClass(this.getEditor().getBody(),c,\"mce-active-editor\",\"mce-inactive-editor\")\n}};\nZmHtmlEditor.prototype._onTextareaFocus=function(){this.setFocusStatus(true,true);\nappCtxt.getKeyboardMgr().updateFocus(this.getContentField())\n};\nZmHtmlEditor.prototype.initEditorManager=function(c,l){var k=this;\nif(!window.tinyMCE){return\n}var d=AjxStringUtil.parseURL(location.href);\ntinymce.baseURL=appContextPath+ZmHtmlEditor.TINY_MCE_PATH;\nif(tinymce.EditorManager){tinymce.EditorManager.baseURI=new tinymce.util.URI(d.protocol+\"://\"+d.authority+tinymce.baseURL)\n}if(tinymce.dom){tinymce.DOM=new tinymce.dom.DOMUtils(document,{process_html:0})\n}if(tinymce.dom&&tinymce.dom.Event){tinymce.dom.Event.domLoaded=true\n}var a=[\"fontselect fontsizeselect formatselect |\",\"bold italic underline strikethrough removeformat |\",\"forecolor backcolor |\",\"outdent indent bullist numlist blockquote |\",\"alignleft aligncenter alignright alignjustify |\",this._attachmentCallback?\"zimage\":\"image\",\"link zemoticons charmap hr table |\",appCtxt.get(ZmSetting.SHOW_COMPOSE_DIRECTION_BUTTONS)?\"ltr rtl |\":\"\",\"undo redo |\",\"pastetext code\"];\nvar e=[\"zemoticons\",\"table\",\"directionality\",\"textcolor\",\"lists\",\"advlist\",\"link\",\"hr\",\"charmap\",\"code\",\"image\",\"autolink\"];\nif(this._attachmentCallback){tinymce.PluginManager.add(\"zimage\",function(j){j.addButton(\"zimage\",{icon:\"image\",tooltip:ZmMsg.insertImage,onclick:k._attachmentCallback,stateSelector:\"img:not([data-mce-object])\"})\n});\ne.push(\"zimage\")\n}var m=[];\nvar p=[\"fontFamilyIntl\",\"fontFamilyBase\"];\nvar h,g,o,n,b;\nfor(g=0;\ng<p.length;\ng++){for(h=1;\nn=AjxMsg[p[g]+h+\".css\"];\nh++){if(n.match(/^#+$/)){break\n}n=n.replace(/,\\s/g,\",\");\nb=AjxMsg[p[g]+h+\".display\"];\nm.push(b+\"=\"+n)\n}}if(!l){l=false\n}var f={mode:(this._mode==Dwt.HTML)?\"exact\":\"none\",theme:\"modern\",auto_focus:l,elements:c,plugins:e.join(\" \"),toolbar:a.join(\" \"),toolbar_items_size:\"small\",statusbar:false,menubar:false,ie7_compat:false,object_resizing:true,font_formats:m.join(\";\"),fontsize_formats:AjxMsg.fontSizes||\"\",convert_urls:false,verify_html:false,browser_spellcheck:true,content_css:appContextPath+\"/css/tinymce-content.css?v=\"+cacheKillerVersion,dialog_type:\"modal\",forced_root_block:\"div\",width:\"100%\",height:\"auto\",visual:false,language:tinyMCE.getlanguage(appCtxt.get(ZmSetting.LOCALE_NAME)),directionality:appCtxt.get(ZmSetting.COMPOSE_INIT_DIRECTION),paste_retain_style_properties:\"all\",paste_data_images:false,paste_remove_styles_if_webkit:false,table_default_attributes:{cellpadding:\"3px\",border:\"1px\"},table_default_styles:{width:\"90%\",tableLayout:\"fixed\"},setup:function(j){j.on(\"LoadContent\",k.onLoadContent.bind(k));\nj.on(\"PostRender\",k.onPostRender.bind(k));\nj.on(\"init\",k.onInit.bind(k));\nj.on(\"keydown\",k._handleEditorKeyEvent.bind(k));\nj.on(\"MouseDown\",k._handleEditorMouseDownEvent.bind(k));\nj.on(\"paste\",k.onPaste.bind(k));\nj.on(\"PastePostProcess\",k.pastePostProcess.bind(k));\nj.on(\"BeforeExecCommand\",k.onBeforeExecCommand.bind(k));\nj.on(\"contextmenu\",k._handleEditorEvent.bind(k));\nj.on(\"mouseup\",k._handleEditorEvent.bind(k))\n}};\ntinyMCE.init(f);\nthis._editor=this.getEditor()\n};\nZmHtmlEditor.prototype.onPaste=function(k){if(!this._pasteCallback){return\n}var f=((k.clipboardData&&(k.clipboardData.items||k.clipboardData.files))||(window.clipboardData&&clipboardData.files)),m=f&&f[0],d,b,h,l;\nif(m&&m.getAsFile){d=m.getAsFile();\nb=d&&d.name;\nh=d&&d.type\n}else{if(m&&m.type){d=m;\nb=d.name;\nh=d.type\n}}if(d){k.stopPropagation();\nk.preventDefault();\nvar c={\"Cache-Control\":\"no-cache\",\"X-Requested-With\":\"XMLHttpRequest\",\"Content-Type\":h,\"Content-Disposition\":'attachment; filename=\"'+(b?AjxUtil.convertToEntities(b):k.timeStamp||new Date().getTime())+'\"'};\nvar a=(appCtxt.get(ZmSetting.CSFE_ATTACHMENT_UPLOAD_URI)+\"?fmt=extended,raw\");\nvar j=AjxRpc.invoke.bind(AjxRpc,d,a,c,this._handlePasteUpload.bind(this),AjxRpcRequest.HTTP_POST);\nif(AjxEnv.isTrident){setTimeout(j,0)\n}else{j()\n}}else{var g=this.getClipboardContent(k);\nif(this.hasContentType(g,\"text/html\")){var e=g[\"text/html\"];\nif(e){this.pasteHtml(e);\nk.stopPropagation();\nk.preventDefault()\n}}}};\nZmHtmlEditor.prototype.getDataTransferItems=function(c){var b={};\nif(c){if(c.getData){var e=c.getData(\"Text\");\nif(e&&e.length>0){b[\"text/plain\"]=e\n}}if(c.types){for(var a=0;\na<c.types.length;\na++){var d=c.types[a];\nb[d]=c.getData(d)\n}}}return b\n};\nZmHtmlEditor.prototype.hasContentType=function(a,b){return b in a&&a[b].length>0\n};\nZmHtmlEditor.prototype.getClipboardContent=function(a){return this.getDataTransferItems(a.clipboardData||this.getEditor().getDoc().dataTransfer)\n};\nZmHtmlEditor.prototype.pasteHtml=function(g){var b=this.getEditor();\nvar a,p=b.dom;\nvar l=b.getDoc();\nvar d=l.styleSheets?l.styleSheets.length:0;\nvar c=l.styleSheets;\nvar j=p.add(b.getBody(),\"div\",{style:\"display:none\"},g);\na=b.fire(\"PastePostProcess\",{node:j});\ng=a.node.innerHTML;\nvar h=[];\nif(!a.isDefaultPrevented()){var m;\nfor(var o=d;\no<c.length;\no++){var q=c[o];\nvar f=this._getPastedClassUpdates(q);\nvar n=q.ownerNode.innerHTML;\nfor(var k in f){var t=f[k];\nm=new RegExp(k.substring(1),\"g\");\ng=g.replace(m,t.substring(1));\nn=n.replace(k,t)\n}m=new RegExp(\":.5pt\",\"g\");\nn=n.replace(m,\":1pt\");\nm=new RegExp(\"windowtext\",\"g\");\nn=n.replace(m,\"black\");\nvar r=l.createElement(\"style\");\nr.type=\"text/css\";\nvar s=l.createAttribute(\"scoped\");\nr.setAttributeNode(s);\nr.innerHTML=n;\nh.push(r)\n}}p.remove(j);\nif(!a.isDefaultPrevented()){var e=l.body;\nfor(var o=0;\no<h.length;\no++){e.insertBefore(h[o],e.childNodes[0])\n}b.insertContent(g,{merge:b.settings.paste_merge_formats!==false})\n}};\nZmHtmlEditor.prototype._getPastedClassUpdates=function(f){var b=f.cssRules;\nvar e={};\nif(b){for(var c=0;\nc<b.length;\nc++){var d=b[c].selectorText;\nif(d&&d.indexOf(\".\")==0){var a=\".zimbra\"+(++this._classCount).toString();\ne[d]=a\n}}}return e\n};\nZmHtmlEditor.prototype._handlePasteUpload=function(r){if(r&&r.success){var resp=eval(\"[\"+r.text+\"]\");\nif(resp.length===3){resp[2].clipboardPaste=true\n}this._pasteCallback(resp)\n}};\nZmHtmlEditor.prototype.onPostRender=function(b){var a=this.getEditor();\na.dom.setStyles(a.getBody(),{\"font-family\":appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_FAMILY),\"font-size\":appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_SIZE),color:appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_COLOR)});\na.show();\nthis._resetSize()\n};\nZmHtmlEditor.prototype.onInit=function(k){var e=this.getEditor();\nvar c=this,h=tinymce.dom.Event,m=e.getDoc(),f=e.getWin(),l=c.parent;\nc.setFocusStatus(false);\ne.on(\"focus\",function(n){appCtxt.getKeyboardMgr().updateFocus(c._getIframeDoc().body);\nc.setFocusStatus(true)\n});\ne.on(\"blur\",function(n){c.setFocusStatus(false)\n});\nif(AjxEnv.isIE){h.bind(m,\"beforedeactivate\",function(n){if(e.windowManager){e.windowManager.bookmark=e.selection.getBookmark(1)\n}})\n}e.on(\"open\",ZmHtmlEditor.onPopupOpen);\nif(l&&l.toString()===\"ZmComposeView\"&&ZmDragAndDrop.isSupported()){var a=l._dnd;\nh.bind(m,\"dragenter\",this._onDragEnter.bind(this));\nh.bind(m,\"dragleave\",this._onDragLeave.bind(this));\nh.bind(m,\"dragover\",this._onDragOver.bind(this,a));\nh.bind(m,\"drop\",this._onDrop.bind(this,a))\n}c._editorInitialized=true;\nvar j=this.getContentField();\nvar g=j.value;\nj.value=\"\";\nthis.setContent(g);\nthis._resetSize();\nthis._setupTabGroup();\nvar b=Dwt.getElement(this._iFrameId);\nif(b){Dwt.addClass(b,\"ZmHtmlEditorIFrame\");\nb.setAttribute(\"title\",ZmMsg.htmlEditorTitle);\nvar d=this._getIframeDoc().body;\nif(d){d.setAttribute(\"aria-label\",ZmMsg.composeBody)\n}}AjxUtil.foreach(this._initCallbacks,function(n){n.run()\n})\n};\nZmHtmlEditor.prototype._onFocus=function(){var a=this.getEditor();\nif(this._mode===Dwt.HTML&&a){a.fire(\"focus\",{focusedEditor:a})\n}};\nZmHtmlEditor.prototype._onBlur=function(){var a=this.getEditor();\nif(this._mode===Dwt.HTML&&a){a.fire(\"blur\",{focusedEditor:null})\n}};\nZmHtmlEditor.prototype.__getEditorControl=function(b,c){var a=this.getEditor();\nfunction d(h){if(h.type===b&&h.settings.tooltip===c){return h\n}if(typeof h.items===\"function\"){var e=h.items();\nfor(var f=0;\nf<e.length;\nf++){var g=d(e[f]);\nif(g){return g\n}}}if(typeof h.menu===\"object\"){return d(h.menu)\n}}return a?d(a.theme.panel):null\n};\nZmHtmlEditor.prototype.onBeforeExecCommand=function(a){if(a.command===\"mceImage\"){this.onBeforeInsertImage(a)\n}else{if(a.command===\"mceRepaint\"){this.onBeforeRepaint(a)\n}}};\nZmHtmlEditor.prototype.onBeforeInsertImage=function(b){var a=b.target.selection.getNode();\nif(a&&a.nodeName===\"IMG\"){a.setAttribute(\"data-mce-src\",a.src);\na.setAttribute(\"data-mce-zsrc\",a.src)\n}};\nZmHtmlEditor.prototype.onBeforeRepaint=function(b){var a=b.target.selection.getNode();\nif(a&&a.nodeName===\"IMG\"){if(a.src!==a.getAttribute(\"data-mce-zsrc\")){a.removeAttribute(\"dfsrc\")\n}a.removeAttribute(\"data-mce-zsrc\")\n}};\nZmHtmlEditor.prototype._onDragEnter=function(){Dwt.addClass(Dwt.getElement(this._iFrameId),\"DropTarget\")\n};\nZmHtmlEditor.prototype._onDragLeave=function(){Dwt.delClass(Dwt.getElement(this._iFrameId),\"DropTarget\")\n};\nZmHtmlEditor.prototype._onDragOver=function(a,b){a._onDragOver(b)\n};\nZmHtmlEditor.prototype._onDrop=function(a,b){a._onDrop(b,true);\nDwt.delClass(Dwt.getElement(this._iFrameId),\"DropTarget\")\n};\nZmHtmlEditor.prototype.setMode=function(e,d,b){this.discardMisspelledWords();\nif(e===this._mode||(e!==Dwt.HTML&&e!==Dwt.TEXT)){return\n}this._mode=e;\nvar a=this.getContentField();\nif(e===Dwt.HTML){if(d){a.value=AjxStringUtil.convertToHtml(a.value,true)\n}if(this._editorInitialized){tinyMCE.execCommand(\"mceToggleEditor\",false,this._bodyTextAreaId)\n}else{this.initEditorManager(this._bodyTextAreaId)\n}}else{if(d){var c;\nif(this._editorInitialized){c=this._convertHtml2Text(b)\n}else{c=AjxStringUtil.convertHtml2Text(a.value)\n}}if(this._editorInitialized){tinyMCE.execCommand(\"mceToggleEditor\",false,this._bodyTextAreaId)\n}if(d){this.setContent(c)\n}Dwt.setVisible(a,true)\n}a=this.getContentField();\na.setAttribute(\"aria-hidden\",!Dwt.getVisible(a));\nif(this._editorInitialized){this._setupTabGroup();\nthis._resetSize()\n}};\nZmHtmlEditor.prototype.getContentField=function(){return document.getElementById(this._bodyTextAreaId)\n};\nZmHtmlEditor.prototype.insertImage=function(a,d,b,j,g){var c;\nvar f=this.getEditor();\nwhile((c=f.dom.get(\"mcepastebin\"))){f.dom.remove(c);\nf.dom.unbind(c)\n}var e=[];\nvar h=0;\ne[h++]=\"<img\";\ne[h++]=\" src='\";\ne[h++]=a;\ne[h++]=\"'\";\nif(g!=null){e[h++]=\" dfsrc='\";\ne[h++]=g;\ne[h++]=\"'\"\n}if(b!=null){e[h++]=\" width='\"+b+\"'\"\n}if(j!=null){e[h++]=\" height='\"+j+\"'\"\n}e[h++]=\">\";\nf.focus();\nf.execCommand(\"mceInsertRawHTML\",false,e.join(\"\"),{skip_undo:1})\n};\nZmHtmlEditor.prototype.replaceImage=function(d,c){var b=this.getEditor().getDoc();\nif(b){var a=b.getElementById(d);\nif(a&&a.getAttribute(\"data-zim-uri\")===d){a.src=c;\na.removeAttribute(\"id\");\na.removeAttribute(\"data-mce-src\");\na.removeAttribute(\"data-zim-uri\")\n}}};\nZmHtmlEditor.prototype.replaceImageSrc=function(d,b){var c=this.getEditor().getDoc();\nif(c){var a=c.getElementsByTagName(\"img\");\nif(a&&a.length>0){AjxUtil.foreach(a,function(e){if(e.src&&e.src==d){e.src=b;\ne.removeAttribute(\"id\");\ne.removeAttribute(\"data-mce-src\");\ne.removeAttribute(\"data-zim-uri\")\n}})\n}}};\nZmHtmlEditor.prototype.addCSSForDefaultFontSize=function(b){var c=\"body,td,pre\";\nvar a=[\"font-family:\",appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_FAMILY),\";\",\"font-size:\",appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_SIZE),\";\",\"color:\",appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_COLOR),\";\"].join(\"\");\nvar d=b?b.getDoc():null;\nif(d){this.insertDefaultCSS(d,c,a)\n}};\nZmHtmlEditor.prototype.insertDefaultCSS=function(e,d,b){var c,a;\nif(e.createStyleSheet){c=e.createStyleSheet()\n}else{a=e.createElement(\"style\");\ne.getElementsByTagName(\"head\")[0].appendChild(a);\nc=a.styleSheet?a.styleSheet:a.sheet\n}if(!c&&a){b=b.replace(/^\\{?([^\\}])/,\"$1\");\na.innerHTML=d+b\n}else{if(c.addRule){b=b.replace(/^\\{?([^\\}])/,\"$1\");\nc.addRule(d,b)\n}else{if(c.insertRule){if(!/^\\{[^\\}]*\\}$/.test(b)){b=\"{\"+b+\"}\"\n}c.insertRule(d+\" \"+b,c.cssRules.length)\n}}}};\nZmHtmlEditor.prototype.resetSpellCheck=function(){this.discardMisspelledWords();\nthis._spellCheckHideModeDiv()\n};\nZmHtmlEditor.prototype.checkMisspelledWords=function(e,b,a){var d=this.getTextVersion();\nif(/\\S/.test(d)){AjxDispatcher.require(\"Extras\");\nthis._spellChecker=new ZmSpellChecker(this);\nthis._spellCheck=null;\nthis._spellCheckSuggestionListenerObj=new AjxListener(this,this._spellCheckSuggestionListener);\nif(!this.onExitSpellChecker){this.onExitSpellChecker=b\n}var c={text:d,ignore:AjxUtil.keys(this._ignoreWords).join()};\nthis._spellChecker.check(c,e,a);\nreturn true\n}return false\n};\nZmHtmlEditor.prototype.spellCheck=function(d,a){var c=this.getTextVersion(null,a);\nif(/\\S/.test(c)){AjxDispatcher.require(\"Extras\");\nthis._spellChecker=new ZmSpellChecker(this);\nthis._spellCheck=null;\nthis._spellCheckSuggestionListenerObj=new AjxListener(this,this._spellCheckSuggestionListener);\nif(!this.onExitSpellChecker){this.onExitSpellChecker=d\n}var b={text:c,ignore:AjxUtil.keys(this._ignoreWords).join()};\nthis._spellChecker.check(b,new AjxCallback(this,this._spellCheckCallback));\nreturn true\n}return false\n};\nZmHtmlEditor.prototype._spellCheckCallback=function(d){var a=false;\nif(d&&d.available){var c=d.misspelled;\nif(c==null||c.length==0){appCtxt.setStatusMsg(ZmMsg.noMisspellingsFound,ZmStatusView.LEVEL_INFO);\nthis._spellCheckHideModeDiv()\n}else{var b=AjxMessageFormat.format(ZmMsg.misspellingsResult,c.length);\nappCtxt.setStatusMsg(b,ZmStatusView.LEVEL_WARNING);\nthis.highlightMisspelledWords(c);\na=true\n}}else{appCtxt.setStatusMsg(ZmMsg.spellCheckUnavailable,ZmStatusView.LEVEL_CRITICAL)\n}if(AjxEnv.isGeckoBased&&this._mode==Dwt.HTML){setTimeout(AjxCallback.simpleClosure(this.focus,this),10)\n}if(this.onExitSpellChecker){this.onExitSpellChecker.run(a)\n}};\nZmHtmlEditor.prototype._spellCheckSuggestionListener=function(h){var o=this;\nvar n=h.item;\nvar l=n.getData(\"orig\");\nif(!l){return\n}var b=n.getData(ZmHtmlEditor.VALUE);\nvar e=this._mode==Dwt.TEXT;\nvar g=n.getData(\"fixall\");\nvar m=e?document:this._getIframeDoc();\nvar k=m.getElementById(n.getData(\"spanId\"));\nvar d=n.getData(ZmOperation.MENUITEM_ID);\nswitch(d){case\"ignore\":b=l;\nthis._ignoreWords[b]=true;\nbreak;\ncase\"add\":b=l;\nvar j=AjxSoapDoc.create(\"ModifyPrefsRequest\",\"urn:zimbraAccount\");\nvar f=j.set(\"pref\",b);\nf.setAttribute(\"name\",\"+zimbraPrefSpellIgnoreWord\");\nvar c={soapDoc:j,asyncMode:true,callback:new AjxCallback(appCtxt,appCtxt.setStatusMsg,[ZmMsg.wordAddedToDictionary])};\nappCtxt.getAppController().sendRequest(c);\nthis._ignoreWords[b]=true;\nbreak;\ndefault:break\n}if(e&&b==null){this._editWord(g,k)\n}else{var a=g?this._spellCheck.wordIds[l]:k;\nthis._editWordFix(a,b)\n}this._handleSpellCheckerEvents(null)\n};\nZmHtmlEditor.prototype._getEditorDocument=function(){var a=this._mode==Dwt.TEXT;\nreturn a?document:this._getIframeDoc()\n};\nZmHtmlEditor.prototype._editWord=function(g,a){var e=this._getEditorDocument();\nvar b=e.createElement(\"input\");\nb.type=\"text\";\nb.value=AjxUtil.getInnerText(a);\nb.className=\"SpellCheckInputField\";\nb.style.left=a.offsetLeft-2+\"px\";\nb.style.top=a.offsetTop-2+\"px\";\nb.style.width=a.offsetWidth+4+\"px\";\nvar f=e.getElementById(this._spellCheckDivId);\nvar d=f.scrollTop;\nf.appendChild(b);\nf.scrollTop=d;\nb.setAttribute(\"autocomplete\",\"off\");\nb.focus();\nif(!AjxEnv.isGeckoBased){b.select()\n}else{b.setSelectionRange(0,b.value.length)\n}var c=AjxCallback.simpleClosure(this._editWordHandler,this,g,a);\nb.onblur=c;\nb.onkeydown=c\n};\nZmHtmlEditor.prototype._editWordHandler=function(c,a,b){setTimeout(AjxCallback.simpleClosure(this._editWordHandler2,this,c,a,b),20)\n};\nZmHtmlEditor.prototype._editWordHandler2=function(g,e,h){h=DwtUiEvent.getEvent(h);\nvar j=h.type;\nvar b=h.keyCode;\nvar d=h.ctrlKey;\nvar k=DwtUiEvent.getTarget(h);\nvar f=/key/.test(j);\nvar c=true;\nif(/blur/.test(j)||(f&&DwtKeyEvent.IS_RETURN[b])){if(d){g=!g\n}var l=AjxUtil.getInnerText(e);\nvar a=g?this._spellCheck.wordIds[l]:e;\nthis._editWordFix(a,k.value)\n}else{if(f&&b===DwtKeyEvent.KEY_ESCAPE){this._editWordFix(e,AjxUtil.getInnerText(e))\n}else{c=false\n}}if(c){k.onblur=null;\nk.onkeydown=null;\nif(k.parentNode){k.parentNode.removeChild(k)\n}}this._handleSpellCheckerEvents(null)\n};\nZmHtmlEditor.prototype._editWordFix=function(c,d){c=c instanceof Array?c:[c];\nvar e=this._getEditorDocument();\nfor(var b=c.length-1;\nb>=0;\nb--){var a=c[b];\nif(typeof a==\"string\"){a=e.getElementById(a)\n}if(a){a.innerHTML=d\n}}};\nZmHtmlEditor.prototype._getParentElement=function(){var a=this.getEditor();\nif(a.selection){return a.selection.getNode()\n}else{var b=this._getIframeDoc();\nreturn b?b.body:null\n}};\nZmHtmlEditor.prototype._handleSpellCheckerEvents=function(n){var g=this._mode==Dwt.TEXT;\nvar e=g?(n?DwtUiEvent.getTarget(n):null):this._getParentElement(),q,a,f,h,s=this,k=this._spellCheck,o=g?document:this._getIframeDoc(),r=false,d=\"\";\nif(n&&/^span$/i.test(e.tagName)&&/ZM-SPELLCHECK/.test(e.className)){d=e.getAttribute(\"word\");\nwindow.status=\"Suggestions: \"+k.suggestions[d].join(\", \");\nr=d!=AjxUtil.getInnerText(e)\n}a=k.spanIds;\nfor(f in a){q=o.getElementById(f);\nif(q){if(a[f]!=AjxUtil.getInnerText(q)||this._ignoreWords[a[f]]){q.className=\"ZM-SPELLCHECK-FIXED\"\n}else{if(a[f]==d){q.className=\"ZM-SPELLCHECK-MISSPELLED2\"\n}else{q.className=\"ZM-SPELLCHECK-MISSPELLED\"\n}}}}if(k.menu&&(!n||(/click|mousedown|mouseup|contextmenu/.test(n.type)||(/key/.test(n.type)&&(!d||r))))){k.menu.dispose();\nk.menu=null;\nwindow.status=\"\"\n}if(n&&d&&(h=k.suggestions[d])&&(/mouseup|contextmenu/i.test(n.type)||(g&&/(click|mousedown|contextmenu)/i.test(n.type)))&&(d==AjxUtil.getInnerText(e)&&!this._ignoreWords[d])){k.menu=this._spellCheckCreateMenu(this.parent,0,h,d,e.id,r);\nvar m,c=k.menu.getSize(),j=this.shell.getSize();\nif(!g){m=Dwt.toWindow(document.getElementById(this._iFrameId),0,0,null,true);\nvar l=Dwt.toWindow(e,0,0,null,true);\nm.x+=l.x-(o.documentElement.scrollLeft||o.body.scrollLeft);\nm.y+=l.y-(o.documentElement.scrollTop||o.body.scrollTop)\n}else{m=Dwt.toWindow(e,0,0,null,true);\nvar b=document.getElementById(this._spellCheckDivId);\nm.x-=b.scrollLeft;\nm.y-=b.scrollTop\n}m.y+=e.offsetHeight;\nif(m.y+c.y>j.y){m.y-=c.y+e.offsetHeight\n}k.menu.popup(0,m.x,m.y);\nn._stopPropagation=true;\nn._returnValue=false;\nreturn false\n}};\nZmHtmlEditor.prototype._spellCheckCreateMenu=function(k,j,h,b,d,l){var c=new ZmPopupMenu(k);\nif(l){var f=\"<b>\"+b+\"</b>\";\nthis._spellCheckCreateMenuItem(c,\"orig\",{text:f},j,b,b,d)\n}if(h.length>0){for(var e=0;\ne<h.length;\n++e){this._spellCheckCreateMenuItem(c,\"sug-\"+e,{text:h[e],className:\"\"},j,h[e],b,d)\n}if(!(k instanceof DwtMenuItem)&&this._spellCheck.wordIds[b].length>1){if(!this._replaceAllFormatter){this._replaceAllFormatter=new AjxMessageFormat(ZmMsg.replaceAllMenu)\n}var f=\"<i>\"+this._replaceAllFormatter.format(this._spellCheck.wordIds[b].length)+\"</i>\";\nvar m=c.createMenuItem(\"fixall\",{text:f});\nvar a=this._spellCheckCreateMenu(m,1,h,b,d,l);\nm.setMenu(a)\n}}else{var m=this._spellCheckCreateMenuItem(c,\"noop\",{text:ZmMsg.noSuggestions},j,\"\",b,d);\nm.setEnabled(false);\nthis._spellCheckCreateMenuItem(c,\"clear\",{text:\"<i>\"+ZmMsg.clearText+\"</i>\"},j,\"\",b,d)\n}var g=this._mode==Dwt.TEXT;\nif(!j||g){c.createSeparator()\n}if(g){var f=j?ZmMsg.editAll:ZmMsg.edit;\nthis._spellCheckCreateMenuItem(c,\"edit\",{text:f},j,null,b,d)\n}if(!j){this._spellCheckCreateMenuItem(c,\"ignore\",{text:ZmMsg.ignoreWord},0,null,b,d)\n}if(!j&&appCtxt.get(ZmSetting.SPELL_CHECK_ADD_WORD_ENABLED)){this._spellCheckCreateMenuItem(c,\"add\",{text:ZmMsg.addWord},j,null,b,d)\n}return c\n};\nZmHtmlEditor.prototype._spellCheckCreateMenuItem=function(c,b,e,g,h,a,f,d){if(e.className==null){e.className=\"ZMenuItem ZmSpellMenuItem\"\n}var j=c.createMenuItem(b,e);\nj.setData(\"fixall\",g);\nj.setData(\"value\",h);\nj.setData(\"orig\",a);\nj.setData(\"spanId\",f);\nj.addSelectionListener(d||this._spellCheckSuggestionListenerObj);\nreturn j\n};\nZmHtmlEditor.prototype.discardMisspelledWords=function(k){if(!this._spellCheck){return\n}var j=this.getSize();\nif(this._mode==Dwt.HTML){var f=this._getIframeDoc();\nf.body.style.display=\"none\";\nvar b=null;\nvar g=this._spellCheck.spanIds;\nfor(var e in g){var h=f.getElementById(e);\nif(!h){continue\n}b=h.parentNode;\nwhile(h.firstChild){b.insertBefore(h.firstChild,h)\n}b.removeChild(h)\n}if(!AjxEnv.isIE){f.body.normalize()\n}else{f.body.innerHTML=f.body.innerHTML\n}b=f.getElementById(\"ZM-SPELLCHECK-STYLE\");\nif(b){b.parentNode.removeChild(b)\n}f.body.style.display=\"\";\nthis._unregisterEditorEventHandler(f,\"contextmenu\");\nj.y=j.y-(k?0:2)\n}else{if(this._spellCheckDivId!=null){var a=document.getElementById(this._spellCheckDivId);\nvar d=a.scrollTop;\nvar c=document.getElementById(this._textAreaId);\nif(AjxEnv.isGeckoBased){a.innerHTML=AjxStringUtil.htmlDecode(a.innerHTML,true)\n}c.value=AjxUtil.getInnerText(a);\na.onclick=null;\na.oncontextmenu=null;\na.onmousedown=null;\na.parentNode.removeChild(a);\nc.style.display=\"\";\nc.scrollTop=d;\nj.y=j.y+(k?2:0)\n}}this._spellCheckDivId=this._spellCheck=null;\nwindow.status=\"\";\nif(!k){this._spellCheckHideModeDiv()\n}if(this.onExitSpellChecker){this.onExitSpellChecker.run()\n}this._resetSize()\n};\nZmHtmlEditor.prototype._spellCheckShowModeDiv=function(){var d=this.getSize();\nif(!this._spellCheckModeDivId){var f=document.createElement(\"div\");\nf.className=\"SpellCheckModeDiv\";\nf.id=this._spellCheckModeDivId=Dwt.getNextId();\nvar c=new Array();\nvar b=0;\nc[b++]=\"<table border=0 cellpadding=0 cellspacing=0><tr><td style='width:25'>\";\nc[b++]=AjxImg.getImageHtml(\"SpellCheck\");\nc[b++]=\"</td><td style='white-space:nowrap'><span class='SpellCheckLink'>\";\nc[b++]=ZmMsg.resumeEditing;\nc[b++]=\"</span> | <span class='SpellCheckLink'>\";\nc[b++]=ZmMsg.checkAgain;\nc[b++]=\"</span></td></tr></table>\";\nf.innerHTML=c.join(\"\");\nvar a=this.getHtmlElement();\na.insertBefore(f,a.firstChild);\nvar e=f.getElementsByTagName(\"span\");\nDwt.associateElementWithObject(e[0],this);\nDwt.setHandler(e[0],\"onclick\",ZmHtmlEditor._spellCheckResumeEditing);\nDwt.associateElementWithObject(e[1],this);\nDwt.setHandler(e[1],\"onclick\",ZmHtmlEditor._spellCheckAgain)\n}else{document.getElementById(this._spellCheckModeDivId).style.display=\"\"\n}this._resetSize()\n};\nZmHtmlEditor._spellCheckResumeEditing=function(){var a=Dwt.getObjectFromElement(this);\na.discardMisspelledWords();\na.focus()\n};\nZmHtmlEditor._spellCheckAgain=function(){Dwt.getObjectFromElement(this).spellCheck(null,true)\n};\nZmHtmlEditor.prototype._spellCheckHideModeDiv=function(){var a=this.getSize();\nif(this._spellCheckModeDivId){document.getElementById(this._spellCheckModeDivId).style.display=\"none\"\n}this._resetSize()\n};\nZmHtmlEditor.prototype.highlightMisspelledWords=function(l,c){this.discardMisspelledWords(c);\nvar q,o,s,d,k=this,e={},m={},t=[\"([^A-Za-z0-9']|^)(\"],h={};\nfor(var n=0;\nn<l.length;\n++n){q=l[n].word;\nif(!h[q]){n&&t.push(\"|\");\nt.push(q);\nvar r=l[n].suggestions.split(/\\s*,\\s*/);\nif(!r[r.length-1]){r.pop()\n}h[q]=r;\nif(h[q].length>5){h[q].length=5\n}}}t.push(\")([^A-Za-z0-9']|$)\");\nt=new RegExp(t.join(\"\"),\"gm\");\nfunction g(z,B){z=B?AjxStringUtil.convertToHtml(z):AjxStringUtil.htmlEncode(z);\nvar v;\nt.lastIndex=0;\nwhile(v=t.exec(z)){var y=v[0];\nvar w=v[1];\nvar a=v[2];\nvar A=v[3];\nvar u=Dwt.getNextId();\ne[u]=a;\nif(!m[a]){m[a]=[]\n}m[a].push(u);\nvar x=[w,'<span word=\"',a,'\" id=\"',u,'\" class=\"ZM-SPELLCHECK-MISSPELLED\">',a,\"</span>\",A].join(\"\");\nz=[z.substr(0,v.index),x,z.substr(v.index+y.length)].join(\"\");\nt.lastIndex=v.index+x.length-A.length\n}return z\n}var s;\nrec=function(y){switch(y.nodeType){case 1:for(var x=y.firstChild;\nx;\nx=rec(x)){}y=y.nextSibling;\nbreak;\ncase 3:if(!/[^\\s\\xA0]/.test(y.data)){y=y.nextSibling;\nbreak\n}var w=null,v=null;\nvar u=/^[\\s\\xA0]+/.exec(y.data);\nif(u){w=y;\ny=y.splitText(u[0].length)\n}u=/[\\s\\xA0]+$/.exec(y.data);\nif(u){v=y.splitText(y.data.length-u[0].length)\n}var A=g(y.data,false);\nA=A.replace(/^ +/,\"&nbsp;\").replace(/ +$/,\"&nbsp;\");\nvar B=s.createElement(\"div\");\nB.innerHTML=A;\nif(w){B.insertBefore(w,B.firstChild)\n}if(v){B.appendChild(v)\n}var z=y.parentNode;\nwhile(B.firstChild){z.insertBefore(B.firstChild,y)\n}B=y.nextSibling;\nz.removeChild(y);\ny=B;\nbreak;\ndefault:y=y.nextSibling\n}return y\n};\nif(this._mode==Dwt.HTML){s=this._getIframeDoc();\nd=s.body;\nthis._loadExternalStyle(\"/css/spellcheck.css\");\nd.style.display=\"none\";\nif(!AjxEnv.isIE){d.normalize()\n}else{d.innerHTML=d.innerHTML\n}rec(d);\nif(!AjxEnv.isIE){d.normalize()\n}else{d.innerHTML=d.innerHTML\n}d.style.display=\"\"\n}else{var p=document.getElementById(this._textAreaId);\nvar b=p.scrollTop;\nvar j=Dwt.getSize(p);\np.style.display=\"none\";\nvar f=document.createElement(\"div\");\nf.className=\"TextSpellChecker\";\nthis._spellCheckDivId=f.id=Dwt.getNextId();\nf.style.overflow=\"auto\";\nif(!AjxEnv.isIE){j.x-=4;\nj.y-=6\n}f.style.height=j.y+\"px\";\nf.innerHTML=AjxStringUtil.convertToHtml(this.getContent());\ns=document;\nrec(f);\np.parentNode.insertBefore(f,p);\nf.scrollTop=b;\nf.oncontextmenu=f.onclick=function(a){k._handleSpellCheckerEvents(a||window.event)\n}\n}this._spellCheckShowModeDiv();\nthis._spellCheck={suggestions:h,spanIds:e,wordIds:m}\n};\nZmHtmlEditor.prototype.isSpellCheckMode=function(){return Boolean(this._spellCheck)\n};\nZmHtmlEditor.prototype._loadExternalStyle=function(e){var d=this._getIframeDoc();\nvar b=d.getElementById(e);\nif(!b){b=d.createElement(\"link\");\nb.id=e;\nb.rel=\"stylesheet\";\nb.type=\"text/css\";\nvar c=appContextPath+e+\"?v=\"+cacheKillerVersion;\nif(AjxEnv.isGeckoBased||AjxEnv.isSafari){c=document.baseURI.replace(/^(https?:\\x2f\\x2f[^\\x2f]+).*$/,\"$1\")+c\n}b.href=c;\nvar a=d.getElementsByTagName(\"head\")[0];\nif(!a){a=d.createElement(\"head\");\nvar f=d.documentElement;\nif(f){f.insertBefore(a,f.firstChild)\n}}a.appendChild(b)\n}};\nZmHtmlEditor.prototype._registerEditorEventHandler=function(b,a){if(b.attachEvent){b.attachEvent(\"on\"+a,this.__eventClosure)\n}else{if(b.addEventListener){b.addEventListener(a,this.__eventClosure,true)\n}}};\nZmHtmlEditor.prototype._unregisterEditorEventHandler=function(b,a){if(b.detachEvent){b.detachEvent(\"on\"+a,this.__eventClosure)\n}else{if(b.removeEventListener){b.removeEventListener(a,this.__eventClosure,true)\n}}};\nZmHtmlEditor.prototype.__eventClosure=function(a){this._handleEditorEvent(AjxEnv.isIE?this._getIframeWin().event:a);\nreturn tinymce.dom.Event.cancel(a)\n};\nZmHtmlEditor.prototype._handleEditorEvent=function(d){var b=this.getEditor();\nvar f=true;\nvar a=this;\nvar e=d.srcElement||d.target;\nif(this._spellCheck&&e&&e.id in this._spellCheck.spanIds){var c;\nif(/mouse|context|click|select/i.test(d.type)){c=new DwtMouseEvent(true)\n}else{c=new DwtUiEvent(true)\n}c.setFromDhtmlEvent(d);\nthis._TIMER_spell=setTimeout(function(){a._handleSpellCheckerEvents(c);\nthis._TIMER_spell=null\n},100);\nd.stopImmediatePropagation();\nd.stopPropagation();\nd.preventDefault();\nreturn tinymce.dom.Event.cancel(d)\n}return f\n};\nZmHtmlEditor.prototype._getSelection=function(){if(AjxEnv.isIE){return this._getIframeDoc().selection\n}else{return this._getIframeWin().getSelection()\n}};\nZmHtmlEditor.prototype.getToolbar=function(d,b){var a,c;\nb=b||this.getEditor();\nif(b&&d){a=b.controlManager;\nif(a){c=a.get(\"toolbar\"+d);\nif(c&&c.id){return document.getElementById(c.id)\n}}}};\nZmHtmlEditor.prototype.getToolbarButton=function(b,d){var a,c;\nif(d&&b){a=d.controlManager;\nif(a){c=a.get(b);\nif(c&&c.id){return document.getElementById(c.id)\n}}}};\nZmHtmlEditor.prototype.insertImageDoc=function(b){var e=b.rest;\nif(!e){return\n}var d=appCtxt.get(ZmSetting.REST_URL)+ZmFolder.SEP;\nvar c=b.docpath;\nif(c&&c.indexOf(\"doc:\")==0){var a=[d,c.substring(4)].join(\"\");\ne=AjxStringUtil.fixCrossDomainReference(a,false,true)\n}this.insertImage(e,null,null,null,c)\n};\nZmHtmlEditor.prototype._imageUploaded=function(f,a,e){for(var d=0;\nd<e.length;\nd++){var c=e[d];\nvar g=appCtxt.get(ZmSetting.REST_URL)+ZmFolder.SEP;\nvar b=f.getRestUrl()+ZmFolder.SEP+c.name;\nc.docpath=[\"doc:\",b.substr(b.indexOf(g)+g.length)].join(\"\");\nc.rest=f.getRestUrl()+ZmFolder.SEP+AjxStringUtil.urlComponentEncode(c.name);\nthis.insertImageDoc(c)\n}appCtxt.setStatusMsg(ZmMsg.imageUploadedToBriefcase)\n};\nZmHtmlEditor.onPopupOpen=function(a,c){if(!c){return\n}if(c.resizable){c.resizable=0\n}var b=c.frameElement,d;\nif(b&&b.src&&b.src.match(\"/table.htm\")){d=function(f,e){var h,j,g;\nif(f.action===\"insert\"){h=f.document;\nif(h){j=h.getElementById(\"align\");\ng=h.getElementById(\"width\");\nj&&(j.value=\"center\");\ng&&(g.value=\"90%\")\n}}if(this._popupIframeLoad){e.detachEvent(\"onload\",this._popupIframeLoad);\ndelete this._popupIframeLoad\n}else{e.onload=null\n}};\nif(b.attachEvent){this._popupIframeLoad=d.bind(this,c,b);\nb.attachEvent(\"onload\",this._popupIframeLoad)\n}else{b.onload=d.bind(this,c,b)\n}}};\nZmHtmlEditor.prototype.isDirty=function(){if(this._mode===Dwt.HTML){var a=this.getEditor();\nif(a){return a.isDirty()\n}}return false\n};\nZmHtmlEditor.prototype.clearDirty=function(){var a=this.getEditor();\nif(a){this.getEditor().isNotDirty=true\n}};\nZmHtmlEditor.prototype._settingChangeListener=function(d){if(d.type!=ZmEvent.S_SETTING){return\n}var h=d.source.id,c,a,g,e,b,f;\nif(h===ZmSetting.COMPOSE_INIT_DIRECTION){g=this.getContentField();\ne=appCtxt.get(ZmSetting.COMPOSE_INIT_DIRECTION);\nif(e===ZmSetting.RTL){g.setAttribute(\"dir\",ZmSetting.RTL)\n}else{g.removeAttribute(\"dir\")\n}}c=this.getEditor();\na=c?c.getBody():null;\nif(!a){return\n}if(h===ZmSetting.COMPOSE_INIT_FONT_FAMILY){a.style.fontFamily=appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_FAMILY)\n}else{if(h===ZmSetting.COMPOSE_INIT_FONT_SIZE){a.style.fontSize=appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_SIZE)\n}else{if(h===ZmSetting.COMPOSE_INIT_FONT_COLOR){a.style.color=appCtxt.get(ZmSetting.COMPOSE_INIT_FONT_COLOR)\n}else{if(h===ZmSetting.SHOW_COMPOSE_DIRECTION_BUTTONS){b=appCtxt.get(ZmSetting.SHOW_COMPOSE_DIRECTION_BUTTONS);\nf=this.getToolbarButton(\"ltr\",c).parentNode;\nif(f){Dwt.setVisible(f,b);\nDwt.setVisible(f.previousSibling,b)\n}Dwt.setVisible(this.getToolbarButton(\"rtl\",c).parentNode,b)\n}else{if(h===ZmSetting.COMPOSE_INIT_DIRECTION){if(e===ZmSetting.RTL){a.dir=ZmSetting.RTL\n}else{a.removeAttribute(\"dir\")\n}}}}}}c.nodeChanged&&c.nodeChanged()\n};\nZmHtmlEditor.prototype.pastePostProcess=function(g){if(!g||!g.node||!g.target||g.node.children.length===0){return\n}var d=g.target,c=d.dom.select(\"TABLE\",g.node);\nfor(var b=0;\nb<c.length;\nb++){var f=c[b];\nif(f&&(f.border===\"0\"||f.border===\"\")){f.border=1\n}}var a=d.dom.select(\"*\",g.node).some(function(j){return j.style[\"float\"]\n});\nif(a||c.length>0){var h=d.getDoc().createElement(\"DIV\");\nh.style.clear=\"both\";\ng.node.appendChild(h)\n}var e=d.dom.select(\"p\",g.node);\nfor(var b=0;\nb<e.length;\nb++){d.dom.setStyle(e[b],\"margin\",\"0\")\n}};\nZmHtmlEditor.prototype._getTabGroup=function(){if(!this.__tabGroup){this.__tabGroup=new DwtTabGroup(this.toString())\n}return this.__tabGroup\n};\nZmHtmlEditor.prototype.getTabGroupMember=function(){var a=this._getTabGroup();\nthis._setupTabGroup(a);\nreturn a\n};\nZmHtmlEditor.prototype._setupTabGroup=function(c){var e=this.getMode();\nc=c||this._getTabGroup();\nc.removeAllMembers();\nvar a=new DwtTabGroup(this.toString()+\"-\"+e);\nif(e===Dwt.HTML){var d=this.__getEditorControl(\"listbox\",\"Font Family\");\nif(d){a.addMember(d.getEl())\n}var b=this._getIframeDoc();\nif(b){a.addMember(b.body)\n}}else{a.addMember(this.getContentField())\n}c.addMember(a)\n};\nZmHtmlEditor.isEditorTab=function(a){return appCtxt.get(ZmSetting.TAB_IN_EDITOR)&&a&&a.keyCode===DwtKeyEvent.KEY_TAB&&!a.shiftKey&&!DwtKeyMapMgr.hasModifier(a)\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.ZmDragAndDrop\")){ZmDragAndDrop=function(a){this._view=a;\nthis._controller=a._controller;\nthis._element=a.getHtmlElement();\nthis._initialize()\n};\nZmDragAndDrop.prototype.constructor=ZmDragAndDrop;\nZmDragAndDrop.isSupported=function(){var c=document.createElement(\"div\"),a=((\"draggable\" in c)||(\"ondragstart\" in c&&\"ondrop\" in c)),b=a&&!!window.FileReader;\nif(AjxEnv.isSafari4up&&a){b=true\n}ZmDragAndDrop.isSupported=function(){return b\n};\nif(b){ZmDragAndDrop.MESSAGE_SIZE_LIMIT=appCtxt.get(ZmSetting.MESSAGE_SIZE_LIMIT);\nZmDragAndDrop.ATTACHMENT_URL=appCtxt.get(ZmSetting.CSFE_ATTACHMENT_UPLOAD_URI)+\"?fmt=extended,raw\"\n}return ZmDragAndDrop.isSupported()\n};\nZmDragAndDrop.isAttachmentSizeExceeded=function(h,a){var b,f,e,d;\nif(!h){return false\n}for(b=0,e=0,f=h.length;\nb<f;\nb++){d=h[b];\nif(d){e+=d.size||d.fileSize||0;\nif((-1!=ZmDragAndDrop.MESSAGE_SIZE_LIMIT)&&(e>ZmDragAndDrop.MESSAGE_SIZE_LIMIT)){if(a){var c=appCtxt.getMsgDialog();\nvar g=AjxMessageFormat.format(ZmMsg.attachmentSizeError,AjxUtil.formatSize(ZmDragAndDrop.MESSAGE_SIZE_LIMIT));\nc.setMessage(g,DwtMessageDialog.WARNING_STYLE);\nc.popup()\n}return true\n}}}return false\n};\nZmDragAndDrop.prototype._initialize=function(){if(!ZmDragAndDrop.isSupported()&&this._element&&this._element.id){var a=document.getElementById(this._element.id+ZmId.CMP_DND_TOOLTIP);\nif(a){a.style.display=\"none\";\na.innerHTML=\"\"\n}}if(!this._view||!this._controller||!this._element||!ZmDragAndDrop.isSupported()){return\n}this._addHandlers(this._element);\nthis._dndTooltipEl=document.getElementById(this._element.id+ZmId.CMP_DND_TOOLTIP);\nthis._setToolTip()\n};\nZmDragAndDrop.prototype._addHandlers=function(a){Dwt.setHandler(a,\"ondragover\",this._onDragOver.bind(this));\nDwt.setHandler(a,\"ondrop\",this._onDrop.bind(this))\n};\nZmDragAndDrop.prototype._setToolTip=function(){if(!this._dndTooltipEl){return\n}if(this._view._attachCount>0||this._dndFilesLength>0){this._dndTooltipEl.style.display=\"none\";\nthis._dndTooltipEl.innerHTML=\"\"\n}else{this._dndTooltipEl.innerHTML=ZmMsg.dndTooltip;\nthis._dndTooltipEl.style.display=\"block\"\n}};\nZmDragAndDrop.prototype._onDragOver=function(a){ZmDragAndDrop._stopEvent(a)\n};\nZmDragAndDrop.prototype._onDrop=function(f,g){var e,d,c,a,b;\nif(!f||(this._view&&this._view._disableAttachments===true)){return\n}e=f.dataTransfer;\nif(!e){return\n}d=e.files;\nif(!d||!d.length){return\n}ZmDragAndDrop._stopEvent(f);\nthis._view._submitMyComputerAttachments(d,null,g,f)\n};\nZmDragAndDrop._stopEvent=function(a){if(!ZmDragAndDrop.containFiles(a)){return\n}if(a.preventDefault){a.preventDefault()\n}if(a.stopPropagation){a.stopPropagation()\n}};\nZmDragAndDrop.containFiles=function(d,c){var b=d&&d.dataTransfer&&d.dataTransfer.types;\nif(!b){return false\n}c=c||\"Files\";\nfor(var a=0;\na<b.length;\na++){if(b[a]===c){return true\n}}return false\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmDialog\")){ZmDialog=function(a){if(arguments.length==0){return\n}DwtDialog.call(this,a);\nif(!a.view){this.setContent(this._contentHtml())\n}if(this._button[DwtDialog.OK_BUTTON]){this.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._okButtonListener))\n}this._overview={};\nthis._opc=appCtxt.getOverviewController();\nthis._baseTabGroupSize=this._tabGroup.size()\n};\nZmDialog.prototype=new DwtDialog;\nZmDialog.prototype.constructor=ZmDialog;\nZmDialog.prototype.isZmDialog=true;\nZmDialog.prototype.toString=function(){return\"ZmDialog\"\n};\nZmDialog.prototype._contentHtml=function(){return\"\"\n};\nZmDialog.prototype.setView=function(d,a){this.reset();\nif(d){var c=this._getContentDiv();\nvar b=d.getHtmlElement();\nc.parentNode.replaceChild(b,c);\nthis._contentDiv=b\n}};\nZmDialog.prototype.popup=function(){this._tabGroup.__members._array.splice(this._baseTabGroupSize);\nthis._tabGroup.addMember(this._getTabGroupMembers());\nDwtDialog.prototype.popup.call(this);\nif(this._focusElement){appCtxt.getKeyboardMgr().grabFocus(this._focusElement)\n}};\nZmDialog.prototype.reset=function(){if(this._nameField){this._nameField.value=\"\"\n}DwtDialog.prototype.reset.call(this)\n};\nZmDialog.prototype._okButtonListener=function(){this.popdown()\n};\nZmDialog.prototype._setNameField=function(a){this._nameField=this._focusElement=document.getElementById(a);\nif(this._enterListener){this.addEnterListener(new AjxListener(this,this._enterListener))\n}};\nZmDialog.prototype._setOverview=function(d,a){if(appCtxt.multiAccounts){var b=this._opc.getOverviewContainer(this._curOverviewId)||this._opc.getOverview(this._curOverviewId);\nif(b){b.setVisible(false)\n}}if(appCtxt.multiAccounts&&!a){var g=this._curOverviewId=d.overviewId;\nvar j=this._opc.getOverviewContainer(g);\nif(!j){var h={overviewClass:\"dialogOverviewContainer\",headerClass:\"DwtTreeItem\",noTooltips:true,treeStyle:d.treeStyle,treeIds:d.treeIds,overviewTrees:d.overviewTrees,omit:d.omit,omitPerAcct:d.omitPerAcct,selectable:d.selectable};\nvar e={appName:d.appName,containerId:g};\nj=this._opc.createOverviewContainer(e,h);\nj.setSize(Dwt.DEFAULT,\"200\");\ndocument.getElementById(d.fieldId).appendChild(j.getHtmlElement())\n}j.setVisible(true);\nreturn j\n}var c=this._curOverviewId=d.overviewId;\nvar k=this._opc.getOverview(c);\nif(!k){var f={overviewId:c,overviewClass:d.overviewClass||\"dialogOverview\",headerClass:\"DwtTreeItem\",noTooltips:true,treeStyle:d.treeStyle,dynamicWidth:d.dynamicWidth,treeIds:d.treeIds,account:((appCtxt.multiAccounts&&d.forceSingle)?appCtxt.getActiveAccount():(d.account||appCtxt.getActiveAccount())),skipImplicit:true,appName:d.appName};\nk=this._overview[c]=this._opc.createOverview(f);\nthis._renderOverview(k,d.treeIds,d.omit,d.noRootSelect);\ndocument.getElementById(d.fieldId).appendChild(k.getHtmlElement())\n}else{this._setRootSelection(k,d.treeIds,d.noRootSelect)\n}this._makeOverviewVisible(c);\nreturn k\n};\nZmDialog.prototype._makeOverviewVisible=function(a){for(var b in this._overview){this._overview[b].setVisible(b==a)\n}};\nZmDialog.prototype._renderOverview=function(d,a,b,c){d.set(a,b);\nthis._setRootSelection(d,a,c)\n};\nZmDialog.prototype._setRootSelection=function(f,c,e){for(var d=0;\nd<c.length;\nd++){var a=f.getTreeView(c[d]);\nvar b=a&&a.getHeaderItem();\nif(b){b.enableSelection(!e)\n}}};\nZmDialog.prototype._getOverview=function(){return this._overview[this._curOverviewId]\n};\nZmDialog.prototype._getInputFields=function(){return(this._nameField)?[this._nameField]:null\n};\nZmDialog.prototype._showError=function(d,c){var b=c||(new DwtPoint(this.getLocation().x+50,this.getLocation().y+100));\nvar a=appCtxt.getMsgDialog();\na.reset();\na.setMessage(AjxStringUtil.htmlEncode(d),DwtMessageDialog.CRITICAL_STYLE);\na.popup(b)\n};\nZmDialog.prototype._getTabGroupMembers=function(){return this._nameField?[this._nameField]:[]\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmAttachDialog\")){ZmAttachDialog=function(a,b){b=b||\"ZmAttachDialog\";\nDwtDialog.call(this,{parent:a,className:b,title:ZmMsg.attachFile});\nthis._createBaseHtml();\nthis._defaultCancelCallback=new AjxCallback(this,this._defaultCancelListener);\nthis._cancelListener=null;\nthis._defaultOkCallback=new AjxCallback(this,this._defaultOkListener);\nthis._okListener=null;\nthis.setButtonListener(DwtDialog.CANCEL_BUTTON,new AjxListener(this,function(){this._cancelButtonListener()\n}));\nthis.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,function(){this._okButtonListener()\n}));\nvar c=this.getButton(DwtDialog.OK_BUTTON);\nc.setText(ZmMsg.attach)\n};\nZmAttachDialog.prototype=new DwtDialog;\nZmAttachDialog.prototype.constructor=ZmAttachDialog;\nZmAttachDialog.TABKEY_BRIEFCASE=\"BRIEFCASE\";\nZmAttachDialog.prototype.setCancelListener=function(a){if(a&&(a instanceof AjxListener||a instanceof AjxCallback)){this._cancelListener=a\n}};\nZmAttachDialog.prototype._defaultCancelListener=function(){this.popdown()\n};\nZmAttachDialog.prototype._cancelButtonListener=function(){if(this._cancelListener){this._cancelListener.run()\n}else{this._defaultCancelCallback.run()\n}};\nZmAttachDialog.prototype.setOkListener=function(a){if(a&&(a instanceof AjxListener||a instanceof AjxCallback)){this._okListener=a\n}};\nZmAttachDialog.prototype._defaultOkListener=function(){this.popdown()\n};\nZmAttachDialog.prototype._okButtonListener=function(){var a=this.getButton(DwtDialog.OK_BUTTON);\na.setEnabled(false);\nif(this._okListener){this._okListener.run(this)\n}else{this._defaultOkCallback.run()\n}a.setEnabled(true)\n};\nZmAttachDialog.prototype._createBaseHtml=function(){this._baseContainerView=new DwtComposite({parent:this,className:\"ZmAttachDialog-container\"});\nthis._initializeTabView(this._baseContainerView);\nthis.setView(this._baseContainerView)\n};\nZmAttachDialog.prototype._initializeTabView=function(a){this._setAttachmentSizeSection(a);\nthis._setInlineOptionSection(a);\nthis._setMsgSection(a);\nthis._setFooterSection(a)\n};\nZmAttachDialog.prototype.stateChangeListener=function(a){this._resetInlineOption()\n};\nZmAttachDialog.prototype._setAttachmentSizeSection=function(a){var c=document.createElement(\"div\");\nc.className=\"ZmAttachDialog-note\";\nvar b=AjxUtil.formatSize(appCtxt.get(ZmSetting.MESSAGE_SIZE_LIMIT)||0,true);\nc.innerHTML=AjxMessageFormat.format(ZmMsg.attachmentLimitMsg,b);\na.getHtmlElement().appendChild(c)\n};\nZmAttachDialog.prototype._setMsgSection=function(a){var b=document.createElement(\"div\");\nb.className=\"ZmAttachDialog-footer\";\nb.id=Dwt.getNextId();\na.getHtmlElement().appendChild(b);\nthis._msgDiv=document.getElementById(b.id)\n};\nZmAttachDialog.prototype._setFooterSection=function(a){var b=document.createElement(\"div\");\nb.className=\"ZmAttachDialog-footer\";\nb.id=Dwt.getNextId();\na.getHtmlElement().appendChild(b);\nthis._footer=document.getElementById(b.id)\n};\nZmAttachDialog.prototype.setFooter=function(a){if(typeof a==\"string\"){this._footer.innerHTML=a\n}else{this._footer.appendChild(a)\n}};\nZmAttachDialog.prototype.submitAttachmentFile=function(a){this.upload(this._uploadCallback,a.uploadForm)\n};\nZmAttachDialog.prototype.cancelUploadFiles=function(){this._cancelUpload=true;\nthis._defaultCancelListener()\n};\nZmAttachDialog.prototype.setUploadCallback=function(a){this._uploadCallback=a\n};\nZmAttachDialog.prototype.getUploadCallback=function(){return this._uploadCallback\n};\nZmAttachDialog.prototype.upload=function(b,a){if(!b){b=false\n}this.setButtonEnabled(DwtDialog.OK_BUTTON,false);\nthis.setButtonEnabled(DwtDialog.CANCEL_BUTTON,true);\nthis.setFooter(ZmMsg.attachingFiles);\nthis._cancelUpload=false;\nthis._processUpload(b,a)\n};\nZmAttachDialog.prototype._processUpload=function(e,c){var d=new AjxCallback(this,this._uploadDoneCallback,[e]);\nvar a=appCtxt.getUploadManager();\nwindow._uploadManager=a;\ntry{a.execute(d,c)\n}catch(b){d.run()\n}};\nZmAttachDialog.prototype._uploadDoneCallback=function(d,a,b){if(this._cancelUpload){return\n}this.setButtonEnabled(DwtDialog.CANCEL_BUTTON,true);\nif(a==AjxPost.SC_OK){this.setFooter(ZmMsg.attachingFilesDone);\nif(d){d.run(a,b)\n}}else{if(a==AjxPost.SC_UNAUTHORIZED){var c=new AjxException(\"401 response during attachment upload\",ZmCsfeException.SVC_AUTH_EXPIRED);\nappCtxt.getAppController()._handleException(c,{continueCallback:d})\n}else{appCtxt.getAppController().popupUploadErrorDialog(ZmItem.MSG,a);\nthis.setFooter(ZmMsg.attachingFilesError)\n}}this.setButtonEnabled(DwtDialog.OK_BUTTON,true)\n};\nZmAttachDialog.prototype.removePrevAttDialogContent=function(b){var a=b&&b.firstChild;\nif(a&&a.className==\"DwtComposite\"){b.removeChild(a)\n}};\nZmAttachDialog.prototype.getBriefcaseView=function(){this.removePrevAttDialogContent(this._getContentDiv().firstChild);\nthis.setTitle(ZmMsg.attachFile);\nif(!this._briefcaseView){AjxDispatcher.require([\"BriefcaseCore\",\"Briefcase\"]);\nthis._briefcaseView=new ZmBriefcaseTabView(this)\n}this._briefcaseView.reparentHtmlElement(this._getContentDiv().childNodes[0],0);\nvar a=new AjxCallback(this._briefcaseView,this._briefcaseView.uploadFiles);\nthis.setOkListener(a);\nthis.setCancelListener((new AjxCallback(this,this.cancelUploadFiles)));\nreturn this._briefcaseView\n};\nZmAttachDialog.prototype._setInlineOptionSection=function(a){var b=document.createElement(\"div\");\nb.className=\"ZmAttachDialog-inline\";\nb.id=Dwt.getNextId();\na.getHtmlElement().appendChild(b);\nthis._inlineOption=document.getElementById(b.id)\n};\nZmAttachDialog.prototype.enableInlineOption=function(a){if(a){var b=this._htmlElId+\"_inlineCheckbox\";\nthis._inlineOption.setAttribute(\"option\",\"inline\");\nthis._inlineOption.innerHTML=[\"<input type='checkbox' name='inlineimages' id='\",b,\"'> <label for='\",b,\"'>\",ZmMsg.inlineAttachmentOption,\"</label>\"].join(\"\");\nthis._tabGroup.addMember(this._inlineOption.getElementsByTagName(\"input\")[0],0)\n}else{this._inlineOption.innerHTML=\"\"\n}};\nZmAttachDialog.prototype._resetInlineOption=function(){var a=document.getElementById(this._htmlElId+\"_inlineCheckbox\");\nif(a){a.checked=false\n}};\nZmAttachDialog.prototype.isInline=function(){var a=document.getElementById(this._htmlElId+\"_inlineCheckbox\");\nreturn(a&&a.checked)\n};\nZmAttachDialog.prototype.setInline=function(a){var b=document.getElementById(this._htmlElId+\"_inlineCheckbox\");\nif(b){b.checked=a\n}};\nZmAttachDialog.prototype.getMyComputerView=function(){var a=false;\nthis.removePrevAttDialogContent(this._getContentDiv().firstChild);\nthis.setTitle(ZmMsg.attachFile);\nif(!this._myComputerView){this._myComputerView=new ZmMyComputerTabViewPage(this);\na=true\n}this._myComputerView.reparentHtmlElement(this._getContentDiv().childNodes[0],0);\nif(!a){this._myComputerView.resetAttachments()\n}var b=new AjxCallback(this,this.submitAttachmentFile,[this._myComputerView]);\nthis.setOkListener(b);\nthis.setCancelListener((new AjxCallback(this,this.cancelUploadFiles)));\nreturn this._myComputerView\n};\nZmMyComputerTabViewPage=function(c,b,a){if(arguments.length==0){return\n}DwtComposite.call(this,c,b,Dwt.STATIC_STYLE);\nthis._createHtml();\nthis.showMe();\nthis.setScrollStyle(Dwt.SCROLL)\n};\nZmMyComputerTabViewPage.prototype=new DwtComposite;\nZmMyComputerTabViewPage.prototype.constructor=ZmMyComputerTabViewPage;\nZmMyComputerTabViewPage.SHOW_NO_ATTACHMENTS=5;\nZmMyComputerTabViewPage.MAX_NO_ATTACHMENTS=10;\nZmMyComputerTabViewPage.UPLOAD_FIELD_NAME=\"_attFile_\";\nZmMyComputerTabViewPage.prototype.showMe=function(){this.resetAttachments();\nthis.setSize(Dwt.DEFAULT,\"240\");\nthis._focusAttEl()\n};\nZmMyComputerTabViewPage.prototype.hideMe=function(){DwtTabViewPage.prototype.hideMe.call(this)\n};\nZmMyComputerTabViewPage.prototype._createHtml=function(){var a={id:this._htmlElId,uri:(appCtxt.get(ZmSetting.CSFE_ATTACHMENT_UPLOAD_URI)+\"?fmt=extended\")};\nthis.setContent(AjxTemplate.expand(\"share.Dialogs#ZmAttachDialog-MyComputerTab\",a));\nthis.attachmentTable=document.getElementById(this._htmlElId+\"_attachmentTable\");\nthis.uploadForm=document.getElementById(this._htmlElId+\"_uploadForm\");\nthis.attachmentButtonTable=document.getElementById(this._htmlElId+\"_attachmentButtonTable\");\nthis._addAttachmentFieldButton();\nthis._attachCount=0\n};\nZmMyComputerTabViewPage.prototype._addAttachmentField=function(){if(this._attachCount>=ZmMyComputerTabViewPage.MAX_NO_ATTACHMENTS){return\n}this._attachCount++;\nvar h=this.attachmentTable.insertRow(-1);\nvar a=h.insertCell(-1);\nvar c=Dwt.getNextId();\nvar d={id:c,uploadName:ZmMyComputerTabViewPage.UPLOAD_FIELD_NAME};\na.innerHTML=AjxTemplate.expand(\"share.Dialogs#ZmAttachDialog-MyComputerTab-AddAttachment\",d);\nvar e=document.getElementById(c+\"_remove\");\ne.onclick=AjxCallback.simpleClosure(this._removeAttachmentField,this,h);\nvar b=c+\"_input\";\nif(this._focusElId==-1){this._focusElId=b\n}var g=document.getElementById(b);\nvar f=document.getElementById(c+\"_size\");\nif(AjxEnv.supportsHTML5File){Dwt.setHandler(g,\"onchange\",AjxCallback.simpleClosure(this._handleFileSize,this,g,f))\n}if(AjxEnv.isIE){g.onkeydown=AjxCallback.simpleClosure(this._handleKeys,this)\n}};\nZmMyComputerTabViewPage.prototype._handleFileSize=function(h,e){var a=h.files;\nif(!a){return\n}var b=[],f,g=0;\nfor(var d=0;\nd<a.length;\nd++){var c=a[d];\nvar j=c.size||c.fileSize||0;\nif((-1!=appCtxt.get(ZmSetting.MESSAGE_SIZE_LIMIT))&&(j>appCtxt.get(ZmSetting.MESSAGE_SIZE_LIMIT))){f=\"RedC\"\n}g+=j\n}if(e){e.innerHTML=\"  (\"+AjxUtil.formatSize(g,true)+\")\";\nif(f){Dwt.addClass(e,\"RedC\")\n}else{Dwt.delClass(e,\"RedC\")\n}}};\nZmMyComputerTabViewPage.prototype._removeAttachmentField=function(a){this.attachmentTable.deleteRow(a.rowIndex);\nthis._attachCount--;\nif(this._attachCount==0){this._addAttachmentField()\n}};\nZmMyComputerTabViewPage.prototype._addAttachmentFieldButton=function(){var c=this.attachmentButtonTable.insertRow(-1);\nvar a=c.insertCell(-1);\nvar b=new DwtButton({parent:this,parentElement:a});\nb.setText(ZmMsg.addMoreAttachments);\nb.addSelectionListener(new AjxListener(this,this._addAttachmentField))\n};\nZmMyComputerTabViewPage.prototype.gotAttachments=function(){var b=document.getElementsByName(ZmMyComputerTabViewPage.UPLOAD_FIELD_NAME);\nfor(var a=0;\na<b.length;\na++){if(b[a].value.length){return true\n}}return false\n};\nZmMyComputerTabViewPage.prototype.resetAttachments=function(){this._cleanTable(this.attachmentTable);\nthis._attachCount=0;\nif(ZmMyComputerTabViewPage.SHOW_NO_ATTACHMENTS>ZmMyComputerTabViewPage.MAX_NO_ATTACHMENTS){ZmMyComputerTabViewPage.SHOW_NO_ATTACHMENTS=ZmMyComputerTabViewPage.MAX_NO_ATTACHMENTS\n}this._focusElId=-1;\nvar c=this.attachmentTable.insertRow(-1);\nvar a=c.insertCell(-1);\na.appendChild(document.createElement(\"br\"));\na.appendChild(document.createElement(\"br\"));\nfor(var b=0;\nb<ZmMyComputerTabViewPage.SHOW_NO_ATTACHMENTS;\nb++){this._addAttachmentField()\n}delete b\n};\nZmMyComputerTabViewPage.prototype._focusAttEl=function(){var a=document.getElementById(this._focusElId);\nif(a){a.focus()\n}};\nZmMyComputerTabViewPage.prototype._cleanTable=function(a){if(!a||!a.rows){return\n}while(a.rows.length>0){a.deleteRow(0)\n}};\nZmMyComputerTabViewPage.prototype._handleKeys=function(b){var a=DwtKeyEvent.getCharCode(b);\nreturn !DwtKeyEvent.IS_RETURN[a]\n};\nZmMyComputerTabViewPage.prototype._validateFileSize=function(){var g=document.getElementsByName(ZmMyComputerTabViewPage.UPLOAD_FIELD_NAME);\nvar d,c;\nfor(var b=0;\nb<g.length;\nb++){d=g[b].files;\nif(!d||d.length==0){continue\n}for(var a=0;\na<d.length;\na++){var e=d[a];\nc=e.size||e.fileSize;\nif((-1!=appCtxt.get(ZmSetting.MESSAGE_SIZE_LIMIT))&&(c>appCtxt.get(ZmSetting.MESSAGE_SIZE_LIMIT))){return false\n}}}return true\n};\nZmMyComputerTabViewPage.prototype.validate=function(){var a,b;\nif(AjxEnv.supportsHTML5File){a=this._validateFileSize();\nb=AjxMessageFormat.format(ZmMsg.attachmentSizeError,AjxUtil.formatSize(appCtxt.get(ZmSetting.MESSAGE_SIZE_LIMIT)))\n}else{a=true\n}return{status:a,error:b}\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmNewOrganizerDialog\")){ZmNewOrganizerDialog=function(c,b,e,a,d){if(arguments.length==0){return\n}this._organizerType=a;\nZmDialog.call(this,{parent:c,className:b,title:e,id:\"CreateNewFolderDialog\",extraButtons:d});\nthis._setupControls()\n};\nZmNewOrganizerDialog.prototype=new ZmDialog;\nZmNewOrganizerDialog.prototype.constructor=ZmNewOrganizerDialog;\nZmNewOrganizerDialog.prototype.isZmNewOrganizerDialog=true;\nZmNewOrganizerDialog.prototype.toString=function(){return\"ZmNewOrganizerDialog\"\n};\nZmNewOrganizerDialog.prototype._folderLocationLabel=ZmMsg.newFolderParent;\nZmNewOrganizerDialog.prototype._folderNameAlreadyExistsMsg=ZmMsg.errorAlreadyExists;\nZmNewOrganizerDialog.prototype.popup=function(t,b){t=t||{};\nvar e=t instanceof ZmOrganizer?t:(t&&t.organizer);\nvar r=document.getElementById(this._htmlElId+\"_parentLabel\");\nvar m=document.getElementById(this._htmlElId+\"_parentValue\");\nthis._parentFolder=null;\nif(e&&e.id!=ZmOrganizer.ID_ROOT){this._parentFolder=e;\nthis._makeOverviewVisible();\nif(r){r.colSpan=1;\nr.innerHTML=ZmMsg.parentFolderLabel;\nm.innerHTML=e.getName()\n}}else{if(this._folderTreeCellId){if(r){r.innerHTML=this._folderLocationLabel;\nr.colSpan=2;\nm.innerHTML=\"\"\n}var l={appName:t.appName,overviewId:this.toString()+(t.appName||\"\"),treeIds:this._treeIds,omit:this._omit,fieldId:this._folderTreeCellId,overviewTrees:[this._organizerType],treeStyle:this._treeStyle};\nvar v=this._setOverview(l);\nv.removeAttribute(\"aria-label\");\nv.setAttribute(\"aria-labelledby\",this._htmlElId+\"_parentLabel\");\nif(this._folderTreeView){this._folderTreeView.getHeaderItem().setVisible(true,true);\nif(!e||this._omit[e.nId]||e.nId==ZmOrganizer.ID_ROOT){e=appCtxt.getFolderTree().root\n}var d=this._folderTreeView.getTreeItemById(e.id);\nif(d){this._folderTreeView.setSelection(d,true,null,true)\n}if(e.nId==ZmOrganizer.ID_ROOT){var c=ZmOrganizer.getSystemId(e.id);\nvar d=this._folderTreeView.getTreeItemById(c);\nif(d){d.setExpanded(true)\n}}}}}if(this._colorSelect){var j=ZmOrganizer.DEFAULT_COLOR[this._organizerType],n=ZmOrganizer.COLOR_VALUES[j],s=this._colorSelect.getMenu(),u;\nif(s){u=(s.toString()==\"ZmMoreColorMenu\")?s:s._getMoreColorMenu();\nif(u){u.setDefaultColor(n)\n}}var q=null;\nvar p=this._organizerType;\nvar g=ZmOrganizer.ORG_CLASS[p];\nif(g){var o=new window[g]({id:Dwt.getNextId()});\nq=o.getIcon()\n}this._colorSelect.setImage(q);\nthis._colorSelect.setValue(ZmOrganizer.DEFAULT_COLOR[p])\n}var a=appCtxt.multiAccounts&&this._opc.getOverviewContainer(this.toString());\nif(a){if(!e||(e&&e.nId==ZmOrganizer.ID_ROOT)){var f=b||appCtxt.getActiveAccount();\na.setSelection(a.getHeaderItem(f))\n}else{var k=appCtxt.getOverviewId(this.toString(),b);\nvar v=a.getOverview(k);\nvar h=v&&v.getTreeView(this._organizerType);\nif(h){a.deselectAll();\nvar d=h.getTreeItemById(e.id);\nh.setSelection(d)\n}}a.expandAccountOnly(b)\n}ZmDialog.prototype.popup.call(this)\n};\nZmNewOrganizerDialog.prototype.reset=function(a){ZmDialog.prototype.reset.apply(this,arguments);\nif(this._remoteCheckboxField){this._remoteCheckboxField.checked=false;\nvar b=document.getElementById(this._remoteCheckboxFieldId+\"URLrow\");\nif(b){b.style.display=\"none\"\n}}if(this._urlField){this._urlField.value=\"\";\nthis._urlField.noTab=true\n}if(appCtxt.multiAccounts){this._account=a\n}else{this._account=null\n}};\nZmNewOrganizerDialog.prototype._getRemoteLabel=function(){return ZmMsg.subscribeToFeed\n};\nZmNewOrganizerDialog.prototype._contentHtml=function(){var b=[];\nvar a=0;\nb[a++]=\"<table class='ChooserDialog ZPropertySheet' cellspacing='6' >\";\na=this._createStandardContentHtml(b,a);\na=this._createExtraContentHtml(b,a);\nb[a++]=\"</table>\";\nreturn b.join(\"\")\n};\nZmNewOrganizerDialog.prototype._createStandardContentHtml=function(b,a){a=this._createNameContentHtml(b,a);\nif(this._organizerType!=ZmOrganizer.FOLDER||(this._organizerType==ZmOrganizer.FOLDER&&appCtxt.get(ZmSetting.MAIL_FOLDER_COLORS_ENABLED))){a=this._createColorContentHtml(b,a)\n}return a\n};\nZmNewOrganizerDialog.prototype._createNameContentHtml=function(b,a){this._nameFieldId=this._htmlElId+\"_name\";\nb[a++]=AjxTemplate.expand(\"share.Dialogs#ZmNewOrgDialogName\",{id:this._htmlElId});\nreturn a\n};\nZmNewOrganizerDialog.prototype._createColorContentHtml=function(b,a){this._colorSelectId=this._htmlElId+\"_colorSelect\";\nb[a++]=AjxTemplate.expand(\"share.Dialogs#ZmNewOrgDialogColor\",{id:this._htmlElId});\nreturn a\n};\nZmNewOrganizerDialog.prototype._createExtraContentHtml=function(b,a){a=this._createRemoteContentHtml(b,a);\na=this._createFolderContentHtml(b,a);\nreturn a\n};\nZmNewOrganizerDialog.prototype._createRemoteContentHtml=function(c,a){this._remoteCheckboxFieldId=this._htmlElId+\"_remote\";\nvar b={id:this._htmlElId,remoteLabel:this._getRemoteLabel()};\nc[a++]=AjxTemplate.expand(\"share.Dialogs#ZmNewOrgDialogRemote\",b);\nreturn a\n};\nZmNewOrganizerDialog.prototype._createFolderContentHtml=function(b,a){this._folderTreeCellId=this._htmlElId+\"_folderTree\";\nb[a++]=AjxTemplate.expand(\"share.Dialogs#ZmNewOrgDialogFolder\",{id:this._htmlElId});\nreturn a\n};\nZmNewOrganizerDialog.prototype._setupControls=function(){this._setupStandardControls();\nthis._setupExtraControls()\n};\nZmNewOrganizerDialog.prototype._setupStandardControls=function(){this._setupNameControl();\nthis._setupColorControl()\n};\nZmNewOrganizerDialog.prototype._setupNameControl=function(){this._setNameField(this._nameFieldId)\n};\nZmNewOrganizerDialog.prototype._setupColorControl=function(){var a=document.getElementById(this._colorSelectId);\nthis._colorSelect=new ZmColorButton({parent:this,parentElement:a,labelId:this._htmlElId+\"_lblColor\"})\n};\nZmNewOrganizerDialog.prototype._setupExtraControls=function(){this._setupRemoteControl();\nthis._setupFolderControl()\n};\nZmNewOrganizerDialog.prototype._setupRemoteControl=function(){this._remoteCheckboxField=document.getElementById(this._remoteCheckboxFieldId);\nif(this._remoteCheckboxField){this._urlField=document.getElementById(this._remoteCheckboxFieldId+\"URLfield\");\nDwt.setHandler(this._remoteCheckboxField,DwtEvent.ONCLICK,this._handleCheckbox.bind(this))\n}};\nZmNewOrganizerDialog.prototype._setupFolderControl=function(){if(!this._folderTreeCellId){return\n}this._treeIds=[this._organizerType];\nthis._omit={};\nthis._omit[ZmFolder.ID_SPAM]=true;\nthis._omit[ZmFolder.ID_DRAFTS]=true;\nthis._omit[ZmFolder.ID_SYNC_FAILURES]=true;\nthis._omit[ZmFolder.ID_OUTBOX]=true;\nthis._omit[ZmOrganizer.ID_ZIMLET]=true\n};\nZmNewOrganizerDialog.prototype._renderOverview=function(d,a,b,c){this._setupFolderControl();\nZmDialog.prototype._renderOverview.apply(this,arguments);\nthis._folderTreeView=d.getTreeView(this._organizerType)\n};\nZmNewOrganizerDialog.prototype._getOverviewOrOverviewContainer=function(){if(appCtxt.multiAccounts){return this._opc.getOverviewContainer(this.toString())\n}return this._opc.getOverview(this._curOverviewId)\n};\nZmNewOrganizerDialog.prototype._getFolderData=function(){var d=this._getOverviewOrOverviewContainer();\nvar h=this._parentFolder||(d&&d.getSelected())||appCtxt.getFolderTree(this._account).root;\nif(this._isGlobalSearch){h=appCtxt.getById(ZmOrganizer.ID_ROOT)\n}var a=AjxStringUtil.trim(this._nameField.value);\nvar c=ZmFolder.checkName(a,h);\nif(!c&&h.hasChild(a)){var j=appCtxt.getFolderTree(appCtxt.getActiveAccount()).getFolderTypeByName(a);\nc=AjxMessageFormat.format(this._folderNameAlreadyExistsMsg,[a,ZmMsg[j.toLowerCase()]])\n}var f=null;\nif(!c&&this._colorSelectId){f=this._colorSelect.getValue()\n}var b=null;\nif(!c&&this._remoteCheckboxField){b=this._remoteCheckboxField.checked?this._urlField.value:null;\nif(b||b!=null){c=ZmOrganizer.checkUrl(b)\n}}if(!c&&h.disallowSubFolder){c=AjxMessageFormat.format(ZmMsg.errorSubFolderNotAllowed,h.name)\n}if(c){return this._showError(c)\n}var g=appCtxt.multiAccounts?h.getAccount():null;\nvar e={l:h.id,name:a,color:f,url:b,account:g};\nif(String(f).match(/^#/)){e.rgb=f;\ndelete e.color\n}return e\n};\nZmNewOrganizerDialog.prototype._getTabGroupMembers=function(){var a=[this._nameField];\nif(this._colorSelect){a.push(this._colorSelect)\n}if(this._remoteCheckboxField){a.push(this._remoteCheckboxField);\nif(this._urlField){a.push(this._urlField)\n}}if(this._overview[this._curOverviewId]){a.push(this._overview[this._curOverviewId])\n}return a\n};\nZmNewOrganizerDialog.prototype._okButtonListener=function(b){var a=this._getFolderData();\nif(a){DwtDialog.prototype._buttonListener.call(this,b,a)\n}};\nZmNewOrganizerDialog.prototype._enterListener=function(b){var a=this._getFolderData();\nif(a){this._runEnterCallback(a)\n}};\nZmNewOrganizerDialog.prototype._handleCheckbox=function(a){a=a||window.event;\nvar c=DwtUiEvent.getTarget(a);\nvar b=document.getElementById(c.id+\"URLrow\");\nb.style.display=c.checked?(AjxEnv.isIE?\"block\":\"table-row\"):\"none\";\nif(this._urlField){if(c.checked){this._urlField.focus()\n}this._urlField.noTab=!c.checked\n}};\nZmNewOrganizerDialog.prototype.setRemoteURL=function(a){this._remoteCheckboxField.checked=true;\nthis._urlField.value=a;\nvar b=document.getElementById(this._remoteCheckboxFieldId+\"URLrow\");\nvar c=document.getElementById(this._remoteCheckboxFieldId+\"URLfield\");\nb.style.display=AjxEnv.isIE?\"block\":\"table-row\"\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmNewSearchDialog\")){ZmNewSearchDialog=function(b,a){ZmNewOrganizerDialog.call(this,b,a,ZmMsg.saveSearch,ZmOrganizer.SEARCH)\n};\nZmNewSearchDialog.prototype=new ZmNewOrganizerDialog;\nZmNewSearchDialog.prototype.constructor=ZmNewSearchDialog;\nZmNewSearchDialog.prototype.toString=function(){return\"ZmNewSearchDialog\"\n};\nZmNewSearchDialog.prototype._folderLocationLabel=ZmMsg.newSearchParent;\nZmNewSearchDialog.prototype.popup=function(d){ZmNewOrganizerDialog.prototype.popup.call(this,d);\nvar c=appCtxt.multiAccounts?appCtxt.getActiveAccount():null;\nvar b=this._getOverviewOrOverviewContainer();\nthis._searchTreeView=b.getTreeView(ZmOrganizer.SEARCH);\nthis._search=d.search;\nthis._searchTreeView.setSelected(appCtxt.getFolderTree(c).root,true);\nthis._isGlobalSearch=appCtxt.multiAccounts&&appCtxt.getSearchController().searchAllAccounts;\nif(appCtxt.multiAccounts){this._searchTreeView.setVisible(true);\nthis._makeOverviewVisible(this._curOverviewId)\n}var a=document.getElementById(this._folderTreeCellId);\nif(a){Dwt.setVisible(a,!this._isGlobalSearch)\n}};\nZmNewSearchDialog.prototype._getFolderData=function(){var a=ZmNewOrganizerDialog.prototype._getFolderData.call(this);\nif(!a){return\n}a.isGlobal=this._isGlobalSearch;\na.search=this._search;\nreturn a\n};\nZmNewSearchDialog.prototype._setupFolderControl=function(){ZmNewOrganizerDialog.prototype._setupFolderControl.call(this);\nthis._treeIds=[ZmOrganizer.SEARCH]\n};\nZmNewSearchDialog.prototype._createRemoteContentHtml=function(b,a){return a\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmNewTagDialog\")){ZmNewTagDialog=function(b,a){ZmDialog.call(this,{parent:b,className:a,title:ZmMsg.createNewTag,id:\"CreateTagDialog\"});\nthis._setNameField(this._htmlElId+\"_name\");\nthis._setTagColorMenu();\nthis._setAccountMenu()\n};\nZmNewTagDialog.prototype=new ZmDialog;\nZmNewTagDialog.prototype.constructor=ZmNewTagDialog;\nZmNewTagDialog.prototype.toString=function(){return\"ZmNewTagDialog\"\n};\nZmNewTagDialog.prototype.popup=function(c,a){if(this._accountSelect){var b=a||appCtxt.getActiveAccount();\nthis._accountSelect.setSelectedValue(b.id)\n}ZmDialog.prototype.popup.call(this)\n};\nZmNewTagDialog.prototype.cleanup=function(a){DwtDialog.prototype.cleanup.call(this,a);\nvar b=this._getNextColor();\nthis._setColorButton(b,ZmOrganizer.COLOR_TEXT[b],ZmTag.getIcon(b))\n};\nZmNewTagDialog.prototype._colorListener=function(b){var a=b.item.getData(ZmOperation.MENUITEM_ID);\nthis._setColorButton(a,ZmOrganizer.COLOR_TEXT[a],ZmTag.getIcon(a))\n};\nZmNewTagDialog.prototype._setTagColorMenu=function(){var b=this._htmlElId+\"_tagColor\";\nthis._colorButton=new DwtButton({parent:this,parentElement:b,id:\"ZmTagColorMenu\"});\nthis._colorButton.noMenuBar=true;\nvar c=ZmOperation.addColorMenu(this._colorButton,true);\nvar a=ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.TAG];\nthis._setColorButton(a,ZmOrganizer.COLOR_TEXT[a],ZmTag.getIcon(a));\nthis._tagColorListener=new AjxListener(this,this._colorListener);\nc.addSelectionListener(this._tagColorListener)\n};\nZmNewTagDialog.prototype._setAccountMenu=function(){if(!appCtxt.multiAccounts){return\n}var a=this._htmlElId+\"_account\";\nthis._accountSelect=new DwtSelect({parent:this,parentElement:a});\nvar c=appCtxt.accountList.visibleAccounts;\nfor(var b=0;\nb<c.length;\nb++){var e=c[b];\nif(appCtxt.get(ZmSetting.TAGGING_ENABLED,null,e)){var d=new DwtSelectOption(e.id,null,e.getDisplayName(),null,null,e.getIcon());\nthis._accountSelect.addOption(d)\n}}};\nZmNewTagDialog.prototype._setColorButton=function(a,c,b){this._colorButton.setData(ZmOperation.MENUITEM_ID,a);\nthis._colorButton.setText(c||ZmMsg.custom);\nthis._colorButton.setImage(b)\n};\nZmNewTagDialog.prototype._contentHtml=function(){return AjxTemplate.expand(\"share.Dialogs#ZmNewTagDialog\",{id:this._htmlElId})\n};\nZmNewTagDialog.prototype._okButtonListener=function(b){var a=this._getTagData();\nif(a){DwtDialog.prototype._buttonListener.call(this,b,a)\n}};\nZmNewTagDialog.prototype._getTagData=function(){var d=this._accountSelect&&this._accountSelect.getValue();\nvar f=d&&appCtxt.accountList.getAccount(d);\nvar c=AjxStringUtil.trim(this._nameField.value);\nvar g=ZmTag.checkName(c);\nvar a=appCtxt.getTagTree(f);\nif(!g&&a&&a.getByName(c)){g=ZmMsg.tagNameExists\n}if(g){return this._showError(g)\n}var b=this._colorButton.getData(ZmOperation.MENUITEM_ID);\nvar e={name:c,color:b,accountName:(f&&f.name)};\nif(String(b).match(/^#/)){e.rgb=b;\ndelete e.color\n}return e\n};\nZmNewTagDialog.prototype._enterListener=function(b){var a=this._getTagData();\nif(a){this._runEnterCallback(a)\n}};\nZmNewTagDialog.prototype._getNextColor=function(){var c={};\nvar a=appCtxt.getTagTree();\nif(!a){return ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.TAG]\n}var d=a.root.children.getArray();\nif(!(d&&d.length)){return ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.TAG]\n}for(var e=0;\ne<d.length;\ne++){c[d[e].color]=true\n}for(var e=0;\ne<ZmTagTree.COLOR_LIST.length;\ne++){var b=ZmTagTree.COLOR_LIST[e];\nif(!c[b]){return b\n}}return ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.TAG]\n};\nZmNewTagDialog.prototype._getTabGroupMembers=function(){return[this._nameField,this._colorButton]\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmOfflineSettingsDialog\")){ZmOfflineSettingsDialog=function(){var a={parent:appCtxt.getShell(),className:\"ZmOfflineSettingDialog\",id:\"ZmOfflineSettingDialog\",title:ZmMsg.offlineSettings};\nDwtDialog.call(this,a);\nthis.setContent(this._contentHtml());\nthis.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._okButtonListener))\n};\nZmOfflineSettingsDialog.prototype=new DwtDialog;\nZmOfflineSettingsDialog.prototype.constructor=ZmOfflineSettingsDialog;\nZmOfflineSettingsDialog.prototype.toString=function(){return\"ZmOfflineSettingDialog\"\n};\nZmOfflineSettingsDialog.prototype._contentHtml=function(){var a=this._htmlElId;\nthis._enableRadioBtnId=a+\"_ENABLE_OFFLINE_RADIO\";\nthis._disableRadioBtnId=a+\"_DISABLE_OFFLINE_RADIO\";\nreturn AjxTemplate.expand(\"prefs.Pages#OfflineSettings\",{id:a,isWebClientOfflineSupported:appCtxt.isWebClientOfflineSupported})\n};\nZmOfflineSettingsDialog.prototype._okButtonListener=function(b){var c=document.getElementById(this._enableRadioBtnId),a=document.getElementById(this._disableRadioBtnId);\nif(c&&c.checked){ZmOfflineSettingsDialog.modifySetting(true)\n}else{if(a&&a.checked){ZmOfflineSettingsDialog.modifySetting(false)\n}}DwtDialog.prototype._buttonListener.call(this,b)\n};\nZmOfflineSettingsDialog.prototype.popdown=function(){var b=appCtxt.get(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY);\nvar c=localStorage.getItem(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY);\nif(b&&b.indexOf(c)!==-1){var d=document.getElementById(this._enableRadioBtnId);\nd&&(d.checked=true)\n}else{var a=document.getElementById(this._disableRadioBtnId);\na&&(a.checked=true)\n}DwtDialog.prototype.popdown.call(this)\n};\nZmOfflineSettingsDialog.showConfirmSignOutDialog=function(){var a=appCtxt.getYesNoMsgDialog();\na.reset();\na.registerCallback(DwtDialog.YES_BUTTON,ZmOfflineSettingsDialog.modifySetting.bind(null,false,true,a));\na.setMessage(ZmMsg.offlineSignOutWarning,DwtMessageDialog.WARNING_STYLE);\na.popup()\n};\nZmOfflineSettingsDialog.modifySetting=function(f,b,c){if(b){c.popdown();\nvar d=appCtxt.getSettings().getSetting(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY);\nif(d){d.addChangeListener(ZmOfflineSettingsDialog._handleLogOff.bind(window))\n}else{ZmOfflineSettingsDialog._handleLogOff()\n}}var a=appCtxt.get(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY);\nif(a){a=a.split(\",\")\n}if(f){var e=new Date().getTime().toString();\nlocalStorage.setItem(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY,e);\nif(a){AjxUtil.arrayAdd(a,e)\n}else{a=[].concat(e)\n}}else{if(a){AjxUtil.arrayRemove(a,localStorage.getItem(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY))\n}localStorage.removeItem(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY);\nAjxCookie.deleteCookie(document,\"ZM_OFFLINE_KEY\",\"/\")\n}if(a){appCtxt.set(ZmSetting.WEBCLIENT_OFFLINE_BROWSER_KEY,a.join())\n}};\nZmOfflineSettingsDialog._handleLogOff=function(){ZmOffline.deleteOfflineData();\nsetTimeout(ZmZimbraMail.logOff,2500)\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmFolderDialogTabView\")){ZmFolderDialogTabView=function(b,a){if(arguments.length==0){return\n}DwtTabViewPage.call(this,b,a,Dwt.RELATIVE_STYLE);\nthis._createView()\n};\nZmFolderDialogTabView.prototype=new DwtTabViewPage;\nZmFolderDialogTabView.prototype.constructor=ZmFolderDialogTabView;\nZmFolderDialogTabView.prototype.toString=function(){return\"ZmDialogTabView\"\n};\nZmFolderDialogTabView.prototype.setOrganizer=function(a){this._organizer=a\n};\nZmFolderDialogTabView.prototype.doSave=function(b,a){};\nZmFolderDialogTabView.prototype._handleFolderChange=function(a){};\nZmFolderDialogTabView.prototype._handleError=function(a){return false\n};\nZmFolderDialogTabView.prototype._createCheckboxItem=function(c,b){var a=\"_\"+c+\"Checkbox\";\nvar e=\"_\"+c+\"El\";\nthis[a]=document.createElement(\"INPUT\");\nthis[a].type=\"checkbox\";\nthis[a]._dialog=this;\nthis[a].id=a;\nthis[e]=document.createElement(\"DIV\");\nthis[e].style.display=\"none\";\nthis[e].appendChild(this[a]);\nvar d=document.createElement(\"label\");\nd.innerHTML=b;\nd.htmlFor=a;\nthis[e].appendChild(d);\nreturn this[e]\n};\nZmFolderDialogTabView.prototype._createBusyOverlay=function(a){this._busyOverlay=document.createElement(\"div\");\nthis._busyOverlay.className=\"ZmDialogTabViewBusy\";\nthis._busyOverlay.style.position=\"absolute\";\nthis._busyOverlay.innerHTML=\"<table cellspacing=0 cellpadding=0 style='width:100%; height:100%'><tr><td>&nbsp;</td></tr></table>\";\na.appendChild(this._busyOverlay);\nDwt.setBounds(this._busyOverlay,0,0,\"100%\",\"100%\");\nDwt.setZIndex(this._busyOverlay,Dwt.Z_VEIL);\nDwt.setVisible(this._busyOverlay,false);\nthis._setBusyFlag=false\n};\nZmFolderDialogTabView.prototype._setBusy=function(a){if(!this._setBusyFlag){Dwt.setCursor(this._busyOverlay,\"wait\");\nDwt.setVisible(this._busyOverlay,true);\nthis._setBusyFlag=this._blockInput=true\n}else{if(this._setBusy){Dwt.setCursor(this._busyOverlay,\"default\");\nDwt.setVisible(this._busyOverlay,false);\nthis._setBusyFlag=this._blockInput=false\n}}}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmFolderPropertyView\")){ZmFolderPropertyView=function(a,b){if(arguments.length==0){return\n}ZmFolderDialogTabView.call(this,b,\"ZmFolderPropertyView\");\nthis._dialog=a\n};\nZmFolderPropertyView.prototype=new ZmFolderDialogTabView;\nZmFolderPropertyView.prototype.constructor=ZmFolderPropertyView;\nZmFolderPropertyView.prototype.toString=function(){return\"ZmFolderPropertyView\"\n};\nZmFolderPropertyView.prototype.getTitle=function(){return ZmMsg.folderTabProperties\n};\nZmFolderPropertyView.prototype.showMe=function(){DwtTabViewPage.prototype.showMe.call(this);\nif(appCtxt.get(ZmSetting.SHARING_ENABLED)){this._dialog.setButtonVisible(ZmFolderPropsDialog.ADD_SHARE_BUTTON,true)\n}this.setSize(Dwt.DEFAULT,\"100\");\nif(Dwt.getVisible(this._nameInputEl)){this._nameInputEl.focus()\n}};\nZmFolderPropertyView.prototype.doSave=function(c,d){if(!this._handleErrorCallback){this._handleErrorCallback=this._handleError.bind(this);\nthis._handleRenameErrorCallback=this._handleRenameError.bind(this)\n}var k=this._organizer;\nif(!k.isSystem()&&!k.isDataSource()){var a=this._nameInputEl.value;\nif(k.name!=a){var j=ZmOrganizer.checkName(a);\nif(j){d.errorMessage.push(j);\nreturn\n}c.add(new AjxCallback(k,k.rename,[a,null,this._handleRenameErrorCallback]));\nd.commandCount++\n}}if(!k.isDataSource()&&appCtxt.isWebClientOfflineSupported){var b=$(\"#folderOfflineLblId\").val()||0;\nif(k.webOfflineSyncDays!=b){var j=ZmOrganizer.checkWebOfflineSyncDays(b);\nif(j){d.errorMessage.push(j);\nreturn\n}c.add(new AjxCallback(k,k.setOfflineSyncInterval,[b,null,this._handleErrorCallback]));\nd.commandCount++\n}}var f=this._color.getValue()||ZmOrganizer.DEFAULT_COLOR[k.type];\nif(k.isColorChanged(f,k.color,k.rgb)){if(ZmOrganizer.getStandardColorNumber(f)===-1){c.add(new AjxCallback(k,k.setRGB,[f,null,this._handleErrorCallback]))\n}else{c.add(new AjxCallback(k,k.setColor,[f,null,this._handleErrorCallback]))\n}d.commandCount++\n}if(Dwt.getVisible(this._excludeFbEl)&&k.setFreeBusy){var g=this._excludeFbCheckbox.checked;\nif(k.excludeFreeBusy!=g){c.add(new AjxCallback(k,k.setFreeBusy,[g,null,this._handleErrorCallback]));\nd.commandCount++\n}}if(Dwt.getVisible(this._globalMarkReadEl)&&k.globalMarkRead){var e=this._globalMarkReadCheckbox.checked;\nif(k.globalMarkRead!=e){c.add(new AjxCallback(k,k.setGlobalMarkRead,[e,null,this._handleErrorCallback]));\nd.commandCount++\n}}if(Dwt.getVisible(this._queryInputEl)&&k.type===ZmOrganizer.SEARCH){var h=this._queryInputEl.value;\nif(k.search.query!==h){c.add(new AjxCallback(k,k.setQuery,[h,null,this._handleErrorCallback]));\nd.commandCount++\n}}};\nZmFolderPropertyView.prototype._handleFolderChange=function(m){var s=this._organizer;\nvar o=0;\nif(this._color){var p=s.getIcon();\nthis._color.setImage(p);\nvar o=s.isColorCustom?s.rgb:s.color;\nvar f=ZmOrganizer.DEFAULT_COLOR[s.type],l=ZmOrganizer.COLOR_VALUES[f],q=this._color.getMenu(),t;\nif(q){t=(q.toString()==\"ZmMoreColorMenu\")?q:q._getMoreColorMenu();\nif(t){t.setDefaultColor(l)\n}}this._color.setValue(o);\nvar a=s.getSystemEquivalentFolderId()||s.id;\nthis._color.setEnabled(a!=ZmFolder.ID_DRAFTS);\nvar k=(s.type!=ZmOrganizer.FOLDER||(s.type==ZmOrganizer.FOLDER&&appCtxt.get(ZmSetting.MAIL_FOLDER_COLORS_ENABLED)));\nthis._props.setPropertyVisible(this._colorId,k)\n}if(s.isSystem()||s.isDataSource()){this._nameOutputEl.innerHTML=AjxStringUtil.htmlEncode(s.name);\nDwt.setVisible(this._nameOutputEl,true);\nDwt.setVisible(this._nameInputEl,false)\n}else{this._nameInputEl.value=s.name;\nDwt.setVisible(this._nameOutputEl,false);\nDwt.setVisible(this._nameInputEl,true)\n}var u=!!s.getToolTip();\nif(u){var h=this._props.getProperty(this._unreadId),d=h&&document.getElementById(h.labelId);\nif(d){d.innerHTML=AjxMessageFormat.format(ZmMsg.makeLabel,s._getUnreadLabel())\n}this._unreadEl.innerHTML=s.numUnread;\nvar b=this._props.getProperty(this._totalId),r=b&&document.getElementById(b.labelId);\nif(r){r.innerHTML=AjxMessageFormat.format(ZmMsg.makeLabel,s._getItemsText())\n}this._totalEl.innerHTML=s.numTotal;\nthis._sizeEl.innerHTML=AjxUtil.formatSize(s.sizeTotal)\n}this._props.setPropertyVisible(this._unreadId,u&&s.numUnread);\nthis._props.setPropertyVisible(this._totalId,u);\nthis._props.setPropertyVisible(this._sizeId,u&&s.sizeTotal);\nif(s.type===ZmOrganizer.SEARCH){this._queryInputEl.value=s.search.query;\nthis._props.setPropertyVisible(this._queryId,true)\n}else{this._props.setPropertyVisible(this._queryId,false)\n}this._ownerEl.innerHTML=AjxStringUtil.htmlEncode(s.owner);\nthis._typeEl.innerHTML=ZmMsg[ZmOrganizer.FOLDER_KEY[s.type]]||ZmMsg.folder;\nthis._excludeFbCheckbox.checked=s.excludeFreeBusy;\nvar g=s.isMountpoint;\nif(g){AjxDispatcher.require(\"Share\");\nvar n=ZmShare.getShareFromLink(s);\nvar v=n&&n.link&&n.link.role;\nthis._permEl.innerHTML=ZmShare.getRoleActions(v)\n}var c=s.url?AjxStringUtil.htmlEncode(s.url).replace(/&amp;/g,\"%26\"):null;\nvar j=c;\nif(j){j=['<a target=_new href=\"',c,'\">',AjxStringUtil.clipByLength(j,50),\"</a>\"].join(\"\")\n}this._urlEl.innerHTML=j||\"\";\nthis._props.setPropertyVisible(this._ownerId,s.owner!=null);\nthis._props.setPropertyVisible(this._urlId,s.url);\nthis._props.setPropertyVisible(this._permId,g);\n$(\"#folderOfflineLblId\").val(s.webOfflineSyncDays||0);\nDwt.setVisible(this._excludeFbEl,!s.link&&(s.type==ZmOrganizer.CALENDAR));\nDwt.setVisible(this._globalMarkReadEl,false);\nif(this._offlineId){var e=false;\nif(!s.isMountpoint){e=(this._organizer.type==ZmOrganizer.FOLDER)\n}this._props.setPropertyVisible(this._offlineId,e)\n}};\nZmFolderPropertyView.prototype._handleRenameError=function(a){var d=this._nameInputEl.value;\nvar b=appCtxt.getFolderTree(appCtxt.getActiveAccount()).getFolderTypeByName(d);\nvar e;\nvar c=false;\nif(a.code==ZmCsfeException.MAIL_ALREADY_EXISTS){e=AjxMessageFormat.format(ZmMsg.errorAlreadyExists,[d,ZmMsg[b.toLowerCase()]])\n}else{if(a.code==ZmCsfeException.MAIL_IMMUTABLE){e=AjxMessageFormat.format(ZmMsg.errorCannotRename,[d])\n}else{if(a.code==ZmCsfeException.SVC_INVALID_REQUEST){e=a.msg\n}else{if(a.code==ZmCsfeException.MAIL_INVALID_NAME){e=AjxMessageFormat.format(ZmMsg.invalidName,[AjxStringUtil.htmlEncode(d)]);\nc=true\n}}}}appCtxt.getAppController().popupErrorDialog(e,c?null:a.msg,null,true);\nreturn true\n};\nZmFolderPropertyView.prototype._createView=function(){this._nameOutputEl=document.createElement(\"SPAN\");\nthis._nameInputEl=document.createElement(\"INPUT\");\nthis._nameInputEl.style.width=\"20em\";\nthis._nameInputEl._dialog=this;\nvar e=this._nameInputEl;\nthis._queryInputEl=document.createElement(\"INPUT\");\nthis._queryInputEl.style.width=\"20em\";\nthis._queryInputEl._dialog=this;\nvar a=this._queryInputEl;\nthis._ownerEl=document.createElement(\"DIV\");\nthis._typeEl=document.createElement(\"DIV\");\nthis._urlEl=document.createElement(\"DIV\");\nthis._permEl=document.createElement(\"DIV\");\nthis._unreadEl=document.createElement(\"SPAN\");\nthis._totalEl=document.createElement(\"SPAN\");\nthis._sizeEl=document.createElement(\"SPAN\");\nvar d=document.createElement(\"DIV\");\nd.appendChild(this._nameOutputEl);\nd.appendChild(e);\nvar c=document.createElement(\"DIV\");\nc.appendChild(a);\nvar g=this._createCheckboxItem(\"excludeFb\",ZmMsg.excludeFromFreeBusy);\nvar h=this._createCheckboxItem(\"globalMarkRead\",ZmMsg.globalMarkRead);\nthis._props=new DwtPropertySheet(this);\nthis._color=new ZmColorButton({parent:this});\nvar f=this._props.addProperty(ZmMsg.nameLabel,d);\nthis._props.addProperty(ZmMsg.typeLabel,this._typeEl);\nthis._queryId=this._props.addProperty(ZmMsg.queryLabel,c);\nthis._ownerId=this._props.addProperty(ZmMsg.ownerLabel,this._ownerEl);\nthis._urlId=this._props.addProperty(ZmMsg.urlLabel,this._urlEl);\nthis._permId=this._props.addProperty(ZmMsg.permissions,this._permEl);\nthis._colorId=this._props.addProperty(ZmMsg.colorLabel,this._color);\nthis._totalId=this._props.addProperty(AjxMessageFormat.format(ZmMsg.makeLabel,ZmMsg.messages),this._totalEl);\nthis._unreadId=this._props.addProperty(AjxMessageFormat.format(ZmMsg.makeLabel,ZmMsg.unread),this._unreadEl);\nthis._sizeId=this._props.addProperty(ZmMsg.sizeLabel,this._sizeEl);\nif(appCtxt.isWebClientOfflineSupported){this._offlineEl=document.createElement(\"DIV\");\nthis._offlineEl.style.whiteSpace=\"nowrap\";\nthis._offlineEl.innerHTML=ZmMsg.offlineFolderSyncInterval;\nthis._offlineId=this._props.addProperty(ZmMsg.offlineLabel,this._offlineEl)\n}var b=this.getHtmlElement();\nb.appendChild(this._props.getHtmlElement());\nb.appendChild(g);\nb.appendChild(h);\nthis._contentEl=b;\nthis._tabGroup.addMember(this._props.getTabGroupMember())\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmFolderRetentionView\")){ZmFolderRetentionView=function(a,b){if(arguments.length==0){return\n}ZmFolderDialogTabView.call(this,b);\nthis._dialog=a;\nthis._initialized=false;\nthis._propagateEvent[DwtEvent.ONMOUSEDOWN]=true\n};\nZmFolderRetentionView.prototype=new ZmFolderDialogTabView;\nZmFolderRetentionView.prototype.constructor=ZmFolderRetentionView;\nZmFolderRetentionView._CustomUnitsToDays={year:366,month:31,week:7,day:1};\nZmFolderRetentionView._CustomUnits=[{id:\"day\",label:ZmMsg.days.toLowerCase(),days:ZmFolderRetentionView._CustomUnitsToDays.day},{id:\"week\",label:ZmMsg.weeks.toLowerCase(),days:ZmFolderRetentionView._CustomUnitsToDays.week},{id:\"month\",label:ZmMsg.months.toLowerCase(),days:ZmFolderRetentionView._CustomUnitsToDays.month},{id:\"year\",label:ZmMsg.years.toLowerCase(),days:ZmFolderRetentionView._CustomUnitsToDays.year}];\nZmFolderRetentionView.prototype.toString=function(){return\"ZmFolderRetentionView\"\n};\nZmFolderRetentionView.prototype.getTitle=function(){return ZmMsg.folderTabRetention\n};\nZmFolderRetentionView.prototype.showMe=function(){DwtTabViewPage.prototype.showMe.call(this);\nthis._dialog.setButtonVisible(ZmFolderPropsDialog.ADD_SHARE_BUTTON,false);\nthis.setSize(Dwt.DEFAULT,\"200\")\n};\nZmFolderRetentionView.prototype._handleFolderChange=function(){if(this._initialized){this._dataBindComponents(this._organizer,ZmOrganizer.RETENTION_KEEP);\nthis._dataBindComponents(this._organizer,ZmOrganizer.RETENTION_PURGE)\n}else{var a=new ZmSystemRetentionPolicy();\na.getPolicies(this._processSystemPolicies.bind(this));\nthis._setBusy(true)\n}};\nZmFolderRetentionView.prototype._processSystemPolicies=function(b,a){this._populatePolicySelect(ZmOrganizer.RETENTION_KEEP,b);\nthis._populatePolicySelect(ZmOrganizer.RETENTION_PURGE,a);\nthis._dataBindComponents(this._organizer,ZmOrganizer.RETENTION_KEEP);\nthis._dataBindComponents(this._organizer,ZmOrganizer.RETENTION_PURGE);\nthis._initialized=true;\nthis._setBusy(false)\n};\nZmFolderRetentionView.prototype._dataBindComponents=function(g,h){var d=this._components[h];\nd.policyEnable.checked=false;\nvar e=g.getRetentionPolicy(h);\nif(e){d.policyEnable.checked=true;\nif(e.type==\"user\"){d.policySelect.selectedIndex=d.policySelect.options.length-1;\nvar b=parseInt(e.lifetime);\nvar f=1;\nvar a=e.lifetime.slice(e.lifetime.length-1);\nswitch(a){case\"d\":f=1;\nbreak;\ncase\"h\":f=24;\nbreak;\ncase\"m\":f=AjxDateUtil.MINUTES_PER_DAY;\nbreak;\ncase\"s\":f=AjxDateUtil.SECONDS_PER_DAY;\nbreak;\ncase\"ms\":f=AjxDateUtil.MSEC_PER_DAY;\nbreak;\ndefault:f=AjxDateUtil.SECONDS_PER_DAY;\nbreak\n}var j=Math.floor((b-1)/f)+1;\nfor(var c=ZmFolderRetentionView._CustomUnits.length-1;\nc>=0;\nc--){if((j>=ZmFolderRetentionView._CustomUnits[c].days)&&((j%ZmFolderRetentionView._CustomUnits[c].days)==0)){d.customUnit.selectedIndex=c;\nd.customValue.value=j/ZmFolderRetentionView._CustomUnits[c].days;\nbreak\n}}}else{for(var c=0;\nc<d.policySelect.options.length;\nc++){if(d.policySelect.options[c].value==e.id){d.policySelect.selectedIndex=c;\nbreak\n}}d.customUnit.selectedIndex=0;\nd.customValue.value=\"\"\n}}if(!d.policyEnable.checked){d.policySelect.selectedIndex=0;\nd.customUnit.selectedIndex=d.customUnit.options.length-1;\nd.customValue.value=\"\"\n}this._handleSelectionChange(h);\nthis._handleEnableClick(h)\n};\nZmFolderRetentionView.prototype.doSave=function(d,b){if(!this._handleErrorCallback){this._handleErrorCallback=new AjxCallback(this,this._handleError)\n}var a=this._organizer;\nvar c=b.errorMessage.length;\nvar g={};\nthis._createPolicy(g,ZmOrganizer.RETENTION_KEEP,b);\nthis._createPolicy(g,ZmOrganizer.RETENTION_PURGE,b);\nif(c==b.errorMessage.length){var f=a.getRetentionPolicy(ZmOrganizer.RETENTION_KEEP);\nvar e=a.getRetentionPolicy(ZmOrganizer.RETENTION_PURGE);\nif(a.policiesDiffer(f,g.keep)||a.policiesDiffer(e,g.purge)){d.add(new AjxCallback(a,a.setRetentionPolicy,[g,null,this._handleErrorCallback]));\nb.commandCount++\n}}};\nZmFolderRetentionView.prototype._createPolicy=function(d,p,e){var k=this._components[p];\nvar n;\nif(k.policyEnable.checked){var m=k.policySelect.options[k.policySelect.selectedIndex].value;\nvar g;\nif(m==\"custom\"){g=\"user\";\nvar o=k.customUnit.options[k.customUnit.selectedIndex].value;\nvar b=false;\nvar j=AjxStringUtil.trim(k.customValue.value);\nif(!j){b=true\n}else{var h=0;\nvar c=j.search(/\\D/);\nif(c==-1){h=parseInt(j)\n}if(h<=0){b=true\n}else{var a=ZmFolderRetentionView._CustomUnitsToDays[o];\nvar f=(h*a).toString()+\"d\";\nn={type:\"user\",lifetime:f}\n}}if(b){var l=(p==ZmOrganizer.RETENTION_KEEP)?ZmMsg.retentionKeepLifetimeAmount:ZmMsg.retentionPurgeLifetimeAmount;\ne.errorMessage.push(l)\n}}else{n={type:\"system\",id:m}\n}}d[p]=n\n};\nZmFolderRetentionView.prototype._populatePolicySelect=function(e,a){var f=this._components[e];\nf.policies=a?a:[];\nvar b={};\nfor(var d=0;\nd<f.policies.length;\nd++){b[f.policies[d].name]=f.policies[d].id\n}var c=AjxUtil.getHashKeys(b);\nc.push(ZmMsg.custom);\nb[ZmMsg.custom]=\"custom\";\nf.policySelect.options.length=0;\nfor(var d=0;\nd<c.length;\nd++){f.policySelect.options[d]=new Option(c[d],b[c[d]])\n}};\nZmFolderRetentionView.prototype._handleEnableClick=function(a){var c=this._components[a];\nvar b=!c.policyEnable.checked;\nc.policySelect.disabled=b;\nc.customValue.disabled=b;\nc.customUnit.disabled=b\n};\nZmFolderRetentionView.prototype._handleSelectionChange=function(b){var d=this._components[b],e=d.policySelect,c=e.options[e.selectedIndex],a=c.value,f=(a==\"custom\");\nd.customValue.style.visibility=f?\"visible\":\"hidden\";\nd.customUnit.style.visibility=f?\"visible\":\"hidden\";\ne.setAttribute(\"aria-label\",AjxMessageFormat.format(ZmMsg.policyTypeLabel,c.innerHTML))\n};\nZmFolderRetentionView.prototype._createView=function(){this._id=Dwt.getNextId();\nvar b={id:this._id};\nvar a=this.getHtmlElement();\na.innerHTML=AjxTemplate.expand(\"share.Dialogs#ZmFolderRetentionView\",b);\nthis._components={};\nthis._setupComponents(ZmOrganizer.RETENTION_KEEP,this._components);\nthis._setupComponents(ZmOrganizer.RETENTION_PURGE,this._components);\nthis._createBusyOverlay(a);\nthis._contentEl=a\n};\nZmFolderRetentionView.prototype._setupComponents=function(b,e){var d={};\ne[b]=d;\nd.policyEnable=document.getElementById(this._id+\"_\"+b+\"Checkbox\");\nd.policySelect=document.getElementById(this._id+\"_\"+b);\nd.customValue=document.getElementById(this._id+\"_\"+b+\"Value\");\nd.customUnit=document.getElementById(this._id+\"_\"+b+\"Unit\");\nfor(var a=0;\na<ZmFolderRetentionView._CustomUnits.length;\na++){var c=ZmFolderRetentionView._CustomUnits[a];\nd.customUnit.options[a]=new Option(c.label,c.id)\n}this._tabGroup.addMember(d.policyEnable);\nthis._tabGroup.addMember(d.policySelect);\nthis._tabGroup.addMember(d.customValue);\nthis._tabGroup.addMember(d.customUnit);\nDwt.setHandler(d.policyEnable,\"onclick\",this._handleEnableClick.bind(this,b));\nDwt.setHandler(d.policySelect,\"onclick\",this._handleSelectionChange.bind(this,b))\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmFolderPropsDialog\")){ZmFolderPropsDialog=function(b,a){a=a||\"ZmFolderPropsDialog\";\nvar c;\nif(appCtxt.get(ZmSetting.SHARING_ENABLED)){c=[new DwtDialog_ButtonDescriptor(ZmFolderPropsDialog.ADD_SHARE_BUTTON,ZmMsg.addShare,DwtDialog.ALIGN_LEFT)]\n}DwtDialog.call(this,{parent:b,className:a,title:ZmMsg.folderProperties,extraButtons:c,id:\"FolderProperties\"});\nthis._tabViews=[];\nthis._tabKeys=[];\nthis._tabInUse=[];\nthis._tabKeyMap={};\nif(appCtxt.get(ZmSetting.SHARING_ENABLED)){this.registerCallback(ZmFolderPropsDialog.ADD_SHARE_BUTTON,this._handleAddShareButton,this)\n}this.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._handleOkButton));\nthis.setButtonListener(DwtDialog.CANCEL_BUTTON,new AjxListener(this,this._handleCancelButton));\nthis._folderChangeListener=new AjxListener(this,this._handleFolderChange);\nthis._createView();\nthis._initializeTabGroup()\n};\nZmFolderPropsDialog.prototype=new DwtDialog;\nZmFolderPropsDialog.prototype.constructor=ZmFolderPropsDialog;\nZmFolderPropsDialog.ADD_SHARE_BUTTON=++DwtDialog.LAST_BUTTON;\nZmFolderPropsDialog.SHARES_HEIGHT=\"9em\";\nZmFolderPropsDialog.TABKEY_PROPERTIES=\"PROPERTIES_TAB\";\nZmFolderPropsDialog.TABKEY_RETENTION=\"RETENTION_TAB\";\nZmFolderPropsDialog.prototype.toString=function(){return\"ZmFolderPropsDialog\"\n};\nZmFolderPropsDialog.prototype.getTabKey=function(b){var a=this._tabKeyMap[b];\nreturn this._tabKeys[a]\n};\nZmFolderPropsDialog.prototype.popup=function(b){this._organizer=b;\nfor(var c=0;\nc<this._tabViews.length;\nc++){this._tabViews[c].setOrganizer(b)\n}var e=this.getTabKey(ZmFolderPropsDialog.TABKEY_PROPERTIES);\nthis._tabContainer.switchToTab(e,true);\nb.addChangeListener(this._folderChangeListener);\nthis._handleFolderChange();\nif(appCtxt.get(ZmSetting.SHARING_ENABLED)){var d=ZmOrganizer.SHAREABLE[b.type];\nvar a=(!b.link||b.isAdmin());\nthis.setButtonVisible(ZmFolderPropsDialog.ADD_SHARE_BUTTON,a&&d)\n}DwtDialog.prototype.popup.call(this)\n};\nZmFolderPropsDialog.prototype.popdown=function(){if(this._organizer){this._organizer.removeChangeListener(this._folderChangeListener);\nthis._organizer=null\n}DwtDialog.prototype.popdown.call(this)\n};\nZmFolderPropsDialog.prototype._getSeparatorTemplate=function(){return\"\"\n};\nZmFolderPropsDialog.prototype._handleEditShare=function(d,c){c=c||Dwt.getObjectFromElement(DwtUiEvent.getTarget(d));\nvar b=appCtxt.getSharePropsDialog();\nif(c.object.id===\"1\"){var a=new AjxException(\"Root folder sharing is not allowed, ignoring action.\",AjxException.INVALID_PARAM);\nappCtxt.getAppController()._handleException(a);\nreturn\n}b.popup(ZmSharePropsDialog.EDIT,c.object,c);\nreturn false\n};\nZmFolderPropsDialog.prototype._handleRevokeShare=function(c,b){b=b||Dwt.getObjectFromElement(DwtUiEvent.getTarget(c));\nvar a=appCtxt.getRevokeShareDialog();\na.popup(b);\nreturn false\n};\nZmFolderPropsDialog.prototype._handleResendShare=function(c,b){AjxDispatcher.require(\"Share\");\nb=b||Dwt.getObjectFromElement(DwtUiEvent.getTarget(c));\nvar a=new ZmShare({object:b.object});\na.grantee.id=b.grantee.id;\na.grantee.email=(b.grantee.type==\"guest\")?b.grantee.id:b.grantee.name;\na.grantee.name=b.grantee.name;\nif(a.object.isRemote()){a.grantor.id=a.object.zid;\na.grantor.email=a.object.owner;\na.grantor.name=a.grantor.email;\na.link.id=a.object.rid\n}else{a.grantor.id=appCtxt.get(ZmSetting.USERID);\na.grantor.email=appCtxt.get(ZmSetting.USERNAME);\na.grantor.name=appCtxt.get(ZmSetting.DISPLAY_NAME)||a.grantor.email;\na.link.id=a.object.id\n}a.link.name=b.object.name;\na.link.view=ZmOrganizer.getViewName(b.object.type);\na.link.perm=b.link.perm;\nif(b.grantee.type==\"guest\"){a._sendShareNotification(a.grantee.email,a.link.id,\"\",ZmShare.NEW)\n}else{a.sendMessage(ZmShare.NEW)\n}appCtxt.setStatusMsg(ZmMsg.resentShareMessage);\nreturn false\n};\nZmFolderPropsDialog.prototype._handleAddShareButton=function(c){var b=appCtxt.getSharePropsDialog();\nif(this._organizer.id===\"1\"){var a=new AjxException(\"Root folder sharing is not allowed, ignoring action.\",AjxException.INVALID_PARAM);\nappCtxt.getAppController()._handleException(a);\nreturn\n}b.popup(ZmSharePropsDialog.NEW,this._organizer,null)\n};\nZmFolderPropsDialog.prototype._handleOkButton=function(e){var d=new ZmBatchCommand(null,null,true);\nvar a={commandCount:0,errorMessage:[]};\nfor(var c=0;\nc<this._tabViews.length;\nc++){if(this._tabInUse[c]){this._tabViews[c].doSave(d,a)\n}}if(a.errorMessage.length>0){var f=a.errorMessage.join(\"<br>\");\nvar b=appCtxt.getMsgDialog();\nb.reset();\nb.setMessage(f,DwtMessageDialog.WARNING_STYLE);\nb.popup()\n}else{if(a.commandCount>0){var g=new AjxCallback(this,this.popdown);\nd.run(g)\n}else{this.popdown()\n}}};\nZmFolderPropsDialog.prototype._handleError=function(a){return false\n};\nZmFolderPropsDialog.prototype._handleCancelButton=function(a){this.popdown()\n};\nZmFolderPropsDialog.prototype._handleFolderChange=function(d){var b=this._organizer;\nvar a=this._tabContainer.getTabBar();\nvar g=this.getTabKey(ZmFolderPropsDialog.TABKEY_RETENTION);\nvar f=this._tabContainer.getTabButton(g);\nvar e=this._tabKeyMap[ZmFolderPropsDialog.TABKEY_RETENTION];\nif((b.type!=ZmOrganizer.FOLDER)||b.link){this._tabInUse[e]=false;\nif(this._tabViews.length>2){a.setVisible(true);\nf.setVisible(false)\n}else{a.setVisible(false)\n}}else{this._tabInUse[e]=true;\nf.setVisible(true);\na.setVisible(true)\n}for(var c=0;\nc<this._tabViews.length;\nc++){if(this._tabInUse[c]){this._tabViews[c]._handleFolderChange(d)\n}}if(appCtxt.get(ZmSetting.SHARING_ENABLED)){this._populateShares(b)\n}};\nZmFolderPropsDialog.prototype._populateShares=function(a){this._sharesGroup.setContent(\"\");\nvar f=this._getDisplayShares(a);\nvar c=false;\nif(f.length){for(var b=0;\nb<f.length;\nb++){var d=f[b];\nif(!(d.grantee&&d.grantee.name)){c=true\n}}}if(c){var e=new AjxCallback(this,this._handleResponseGetFolder,[f]);\na.getFolder(e)\n}else{this._handleResponseGetFolder(f)\n}this._sharesGroup.setVisible(f.length>0)\n};\nZmFolderPropsDialog.prototype._getDisplayShares=function(a){var c=a.shares;\nvar g=[];\nif((!a.link||a.isAdmin())&&c&&c.length>0){AjxDispatcher.require(\"Share\");\nvar f=appCtxt.accountList.mainAccount.id;\nfor(var b=0;\nb<c.length;\nb++){var d=c[b];\nif(d.grantee){var e=d.grantee.id;\nif((d.grantee.type!=ZmShare.TYPE_USER)||(d.grantee.id!=f)){g.push(d)\n}}}}return g\n};\nZmFolderPropsDialog.prototype._handleResponseGetFolder=function(j,g){if(g){j=this._getDisplayShares(g)\n}if(j.length){var l=document.createElement(\"TABLE\");\nl.className=\"ZPropertySheet\";\nl.cellSpacing=\"6\";\nfor(var e=0;\ne<j.length;\ne++){var k=j[e];\nvar m=l.insertRow(-1);\nvar b=m.insertCell(-1);\nb.style.paddingRight=\"15px\";\nvar f=k.grantee&&k.grantee.name;\nif(k.isAll()){f=ZmMsg.shareWithAll\n}else{if(k.isPublic()){f=ZmMsg.shareWithPublic\n}else{if(k.isGuest()){f=f||(k.grantee&&k.grantee.id)\n}}}b.innerHTML=AjxStringUtil.htmlEncode(f);\nvar d=m.insertCell(-1);\nd.style.paddingRight=\"15px\";\nd.innerHTML=ZmShare.getRoleName(k.link.role);\nthis.__createCmdCells(m,k)\n}this._sharesGroup.setElement(l);\nvar a=Dwt.DEFAULT;\nvar h=j.length>5?ZmFolderPropsDialog.SHARES_HEIGHT:Dwt.CLEAR;\nvar c=this._sharesGroup.getInsetHtmlElement();\nDwt.setScrollStyle(c,Dwt.SCROLL);\nDwt.setSize(c,a,h)\n}this._sharesGroup.setVisible(j.length>0)\n};\nZmFolderPropsDialog.prototype.__createCmdCells=function(k,j){var f=j.grantee.type;\nif(f==ZmShare.TYPE_DOMAIN||!j.link.role){var h=k.insertCell(-1);\nh.colSpan=3;\nh.innerHTML=ZmMsg.configureWithAdmin;\nreturn\n}var c=[ZmShare.EDIT,ZmShare.REVOKE,ZmShare.RESEND];\nvar a=[this._handleEditShare,this._handleRevokeShare,this._handleResendShare];\nfor(var d=0;\nd<c.length;\nd++){var b=c[d];\nvar h=k.insertCell(-1);\nvar e=j.grantee&&(j.grantee.type==ZmShare.TYPE_ALL);\nif(((e||j.isPublic())&&(b==ZmShare.EDIT))||((e||j.isPublic())&&b==ZmShare.RESEND)){continue\n}var g=document.createElement(\"A\");\ng.href=\"#\";\ng.innerHTML=ZmShare.ACTION_LABEL[b];\nDwt.setHandler(g,DwtEvent.ONCLICK,a[d]);\nDwt.associateElementWithObject(g,j);\nthis._sharesGroup.getTabGroupMember().addMember(g);\nh.appendChild(g)\n}};\nZmFolderPropsDialog.prototype.addTab=function(a,c,b){if(!this._tabContainer||!b){return null\n}this._tabViews[a]=b;\nthis._tabKeys[a]=this._tabContainer.addTab(b.getTitle(),b);\nthis._tabInUse[a]=true;\nthis._tabKeyMap[c]=a;\nreturn this._tabKeys[a]\n};\nZmFolderPropsDialog.prototype._initializeTabView=function(a){this._tabContainer=new DwtTabView(a,null,Dwt.STATIC_STYLE);\nthis.addTab(0,ZmFolderPropsDialog.TABKEY_PROPERTIES,new ZmFolderPropertyView(this,this._tabContainer));\nthis.addTab(1,ZmFolderPropsDialog.TABKEY_RETENTION,new ZmFolderRetentionView(this,this._tabContainer));\nif(appCtxt.get(ZmSetting.SHARING_ENABLED)){this._sharesGroup=new DwtGrouper(a,\"DwtGrouper ZmFolderPropSharing\");\nthis._sharesGroup.setLabel(ZmMsg.folderSharing);\nthis._sharesGroup.setVisible(false);\nthis._sharesGroup.setScrollStyle(Dwt.SCROLL);\na.getHtmlElement().appendChild(this._sharesGroup.getHtmlElement())\n}};\nZmFolderPropsDialog.prototype._createView=function(){this._baseContainerView=new DwtComposite({parent:this,className:\"ZmFolderPropertiesDialog-container \"});\nthis._initializeTabView(this._baseContainerView);\nthis.setView(this._baseContainerView)\n};\nZmFolderPropsDialog.prototype._initializeTabGroup=function(){if(this._sharesGroup){this._tabGroup.addMember(this._sharesGroup.getTabGroupMember(),0)\n}this._tabGroup.addMember(this._tabContainer.getTabGroupMember(),0)\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmQuickAddDialog\")){ZmQuickAddDialog=function(b,e,a,c,d){if(arguments.length==0){return\n}DwtDialog.call(this,{parent:b,title:e,standardButtons:a,extraButtons:c,loc:d})\n};\nZmQuickAddDialog.prototype=new DwtDialog;\nZmQuickAddDialog.prototype.constructor=ZmQuickAddDialog;\nZmQuickAddDialog.prototype.toString=function(){return\"ZmQuickAddDialog\"\n};\nZmQuickAddDialog.prototype.TEMPLATE=\"dwt.Widgets#DwtSemiModalDialog\";\nZmQuickAddDialog.prototype.addSelectionListener=function(a,b){this._button[a].addSelectionListener(b)\n}\n}if(AjxPackage.define(\"zimbraMail.share.view.dialog.ZmTimeDialog\")){ZmTimeDialog=function(b){b.id=Dwt.getNextId(\"ZmTimeDialog_\");\nZmDialog.call(this,b);\nvar a=AjxTemplate.expand(\"share.Dialogs#ZmTimeDialog\",{id:this._htmlElId,description:ZmMsg.sendLaterDescription,label:ZmMsg.time});\nthis.setContent(a);\nthis.setTitle(ZmMsg.sendLaterTitle);\nthis._createDwtObjects()\n};\nZmTimeDialog.prototype=new ZmDialog;\nZmTimeDialog.prototype.constructor=ZmTimeDialog;\nZmTimeDialog.prototype.toString=function(){return\"ZmTimeDialog\"\n};\nZmTimeDialog.prototype.initialize=function(){var c=new Date();\nthis._dateField.value=AjxDateUtil.simpleComputeDateStr(c);\nthis.showTimeFields(true);\nthis._timeSelect.set(c);\nvar b=AjxTimezone.getAbbreviatedZoneChoices();\nvar e={};\nvar a;\nif(b.length!=this._tzCount){this._tzCount=b.length;\nthis._tzoneSelect.clearOptions();\nfor(var d=0;\nd<b.length;\nd++){if(!b[d].autoDetected){a=b[d].value;\ne[a]=true;\nthis._tzoneSelect.addOption(b[d])\n}}}this.autoSelectTimezone()\n};\nZmTimeDialog.prototype.isValid=function(){return true\n};\nZmTimeDialog.prototype.isDirty=function(){return true\n};\nZmTimeDialog.prototype.getValue=function(){var a=this._timeSelect.getValue(AjxDateUtil.simpleParseDateStr(this._dateField.value));\nvar b=this._tzoneSelect.getValue();\nreturn{date:a,timezone:b}\n};\nZmTimeDialog.prototype.isValidDateStr=function(){return AjxDateUtil.isValidSimpleDateStr(this._dateField.value)\n};\nZmTimeDialog.prototype.popup=function(){this.initialize();\nZmDialog.prototype.popup.call(this);\nif(!this._tabGroupComplete){var a=[this._dateField,this._dateButton,this._timeSelect.getInputField(),this._tzoneSelect];\nfor(var b=0;\nb<a.length;\nb++){this._tabGroup.addMember(a[b],b)\n}this._tabGroupComplete=true\n}this._tabGroup.setFocusMember(this._dateField)\n};\nZmTimeDialog.prototype._createDwtObjects=function(){var b=new AjxListener(this,this._dateButtonListener);\nvar c=new AjxListener(this,this._dateCalSelectionListener);\nthis._dateButton=this.createMiniCalButton(this._htmlElId+\"_miniCal\",b,c);\nvar a=new AjxListener(this,this._timeChangeListener);\nthis._timeSelect=new DwtTimeInput(this,DwtTimeInput.START);\nthis._timeSelect.addChangeListener(a);\nthis._timeSelect.reparentHtmlElement(this._htmlElId+\"_time\");\nthis._dateField=Dwt.byId(this._htmlElId+\"_date\");\nthis._tzoneSelect=new DwtSelect({parent:this,parentElement:(this._htmlElId+\"_tzSelect\"),layout:DwtMenu.LAYOUT_SCROLL,maxRows:7,id:Dwt.getNextId(\"TimeZoneSelect_\")})\n};\nZmTimeDialog.prototype.showTimeFields=function(a){Dwt.setVisibility(this._timeSelect.getHtmlElement(),a)\n};\nZmTimeDialog.prototype._dateButtonListener=function(a){var d=AjxDateUtil.simpleParseDateStr(this._dateField.value);\nif(d===null||isNaN(d)){d=new Date();\nvar c=this._dateField;\nc.value=AjxDateUtil.simpleComputeDateStr(d)\n}var e=a.item.getMenu();\nvar b=e.getItem(0);\nb.setDate(d,true);\na.item.popup()\n};\nZmTimeDialog.prototype._dateCalSelectionListener=function(b){var d=b.item.parent.parent;\nvar c=AjxDateUtil.simpleParseDateStr(this._dateField.value);\nvar a=AjxDateUtil.simpleComputeDateStr(b.detail);\nif(d==this._dateButton){this._dateField.value=a\n}};\nZmTimeDialog.prototype.createMiniCalButton=function(f,e,b){var h=new DwtButton({parent:this});\nh.addDropDownSelectionListener(e);\nh.setData(Dwt.KEY_ID,f);\nif(AjxEnv.isIE){h.setSize(\"20\")\n}var g=new DwtMenu({parent:h,style:DwtMenu.CALENDAR_PICKER_STYLE});\ng.setSize(\"150\");\ng._table.width=\"100%\";\nh.setMenu(g,true);\nvar a=new DwtCalendar({parent:g});\na.setData(Dwt.KEY_ID,f);\na.setSkipNotifyOnPage(true);\nvar d=appCtxt.get(ZmSetting.CAL_FIRST_DAY_OF_WEEK)||0;\na.setFirstDayOfWeek(d);\na.addSelectionListener(b);\nvar j=appCtxt.getSettings().getSetting(ZmSetting.CAL_FIRST_DAY_OF_WEEK);\nif(j){var c=new AjxListener(null,ZmCalendarApp._settingChangeListener,a);\nj.addChangeListener(c)\n}h.reparentHtmlElement(f);\ndelete f;\nreturn h\n};\nZmTimeDialog.prototype.autoSelectTimezone=function(){if(AjxTimezone.DEFAULT_RULE.autoDetected){var g=AjxTimezone.DEFAULT_RULE;\nvar e,j,l;\nfor(var f in AjxTimezone.MATCHING_RULES){var k=AjxTimezone.MATCHING_RULES[f];\nif(k.autoDetected){continue\n}if(k.standard.offset==g.standard.offset){if(!e){e=k.serverId\n}var b=(g.daylight&&k.daylight&&(k.daylight.offset==g.daylight.offset));\nif(b){if(!j){j=k.serverId\n}var a=(k.daylight.trans[0]==g.daylight.trans[0]);\nvar c=(k.daylight.trans[1]==g.daylight.trans[1]);\nif(a&&c&&!l){l=k.serverId\n}}}}var h=l?l:(j||e);\nif(h){this._tzoneSelect.setSelectedValue(h)\n}}else{var d=AjxTimezone.getServerId(AjxTimezone.DEFAULT);\nthis._tzoneSelect.setSelectedValue(d)\n}}\n}if(AjxPackage.define(\"zimbraMail.core.ZmNewWindow\")){ZmNewWindow=function(){ZmController.call(this,null);\nappCtxt.setAppController(this);\ndocument.body.className=\"user_font_\"+appCtxt.get(ZmSetting.FONT_NAME);\nDwt.addClass(document.documentElement,\"user_font_size_\"+appCtxt.get(ZmSetting.FONT_SIZE));\nthis._settings=appCtxt.getSettings();\nthis._settings.setReportScriptErrorsSettings(AjxException,ZmController.handleScriptError);\nthis._shell=appCtxt.getShell();\nthis._kbMgr=appCtxt.getKeyboardMgr();\nif(appCtxt.get(ZmSetting.USE_KEYBOARD_SHORTCUTS)){this._kbMgr.enable(true);\nthis._kbMgr.registerKeyMap(new ZmKeyMap());\nthis._kbMgr.pushDefaultHandler(this)\n}this._apps={}\n};\nZmNewWindow.prototype=new ZmController;\nZmNewWindow.prototype.constructor=ZmNewWindow;\nZmNewWindow.prototype.isZmNewWindow=true;\nZmNewWindow.prototype.toString=function(){return\"ZmNewWindow\"\n};\nZmNewWindow.run=function(){AjxDispatcher.setLoaded(\"MailCore\",true);\nAjxDispatcher.setLoaded(\"Mail\",true);\nvar c=window.opener||window;\nif(!window.parentController){window.parentController=c._zimbraMail\n}window.appCtxt=new ZmAppCtxt();\nwindow.appCtxt.isChildWindow=true;\nwindow.parentAppCtxt=c.appCtxt;\nappCtxt.setSettings(parentAppCtxt.getSettings());\nappCtxt.isOffline=parentAppCtxt.isOffline;\nappCtxt.multiAccounts=parentAppCtxt.multiAccounts;\nappCtxt.sendAsEmails=parentAppCtxt.sendAsEmails;\nappCtxt.sendOboEmails=parentAppCtxt.sendOboEmails;\nwindow.ZmSetting=c.ZmSetting;\nZmOperation.initialize();\nZmApp.initialize();\nvar a=new DwtShell({className:\"MainShell\"});\nwindow.onbeforeunload=ZmNewWindow._confirmExitMethod;\nappCtxt.setShell(a);\nvar b=new ZmNewWindow();\nb.startup();\nif(c.onkeydown){window.onkeydown=c.onkeydown\n}};\nZmNewWindow.unload=function(a){if(!window||!window.opener||!window.parentController){return\n}var c=window.newWindowCommand;\nif(c==\"compose\"||c==\"composeDetach\"||(c==\"msgViewDetach\"&&appCtxt.composeCtlrSessionId)){var d=AjxDispatcher.run(\"GetComposeController\",appCtxt.composeCtlrSessionId);\nif(d){d.dispose()\n}}if(c==\"msgViewDetach\"){var b=AjxDispatcher.run(\"GetMsgController\",appCtxt.msgCtlrSessionId);\nif(b){b.dispose()\n}}if(window.parentController){window.parentController.removeChildWindow(window)\n}};\nZmNewWindow.prototype.startup=function(){if(window.parentController){var h=window.parentController.getChildWindow(window);\nif(h){window.newWindowCommand=h.command;\nwindow.newWindowParams=h.params\n}}if(!this._appViewMgr){this._appViewMgr=new ZmAppViewMgr(this._shell,this,true,false);\nthis._statusView=new ZmStatusView(this._shell,\"ZmStatus\",Dwt.ABSOLUTE_STYLE,ZmId.STATUS_VIEW)\n}var e=window.newWindowCommand;\nvar g=window.newWindowParams;\nif(e==\"shortcuts\"){var a={};\na[ZmApp.PREFERENCES]=true;\nthis._createEnabledApps(a);\nthis._createView();\nreturn\n}var n=appCtxt.getRootTabGroup();\nvar a={};\na[ZmApp.SEARCH]=true;\na[ZmApp.MAIL]=true;\na[ZmApp.CONTACTS]=true;\nvar d=(e==\"msgViewDetach\")?g.msg:null;\nif(d&&(d.isInvite()||this._checkShareType(d.share,\"appointment\"))){a[ZmApp.CALENDAR]=true\n}else{if(d&&this._checkShareType(d.share,\"task\")){a[ZmApp.TASKS]=true\n}}a[ZmApp.PREFERENCES]=true;\na[ZmApp.BRIEFCASE]=true;\nthis._createEnabledApps(a);\nvar k=parentAppCtxt.getApp(ZmApp.MAIL);\nif(k){appCtxt.getApp(ZmApp.MAIL)._identityCollection=k.getIdentityCollection()\n}var l;\nif(e==\"compose\"||e==\"composeDetach\"){l=\"compose-window\"\n}else{if(e==\"msgViewDetach\"){l=\"view-window\"\n}}ZmZimbraMail.prototype._registerOrganizers.call(this);\nZmZimbraMail.registerViewsToTypeMap();\nif(l){var j=parentAppCtxt.get(ZmSetting.ZIMLETS);\nj=j||[];\nvar m=this._settings._getCheckedZimlets(j);\nif(this._hasZimletsForTarget(m,l)){var c=appCtxt.getZimletMgr();\nvar f=this._getUserProps();\nvar b=new AjxCallback(this,this._createView);\nappCtxt.setZimletsPresent(true);\nc.loadZimlets(m,f,l,b,true);\nreturn\n}}this._createView()\n};\nZmNewWindow.prototype._checkShareType=function(b,a){return b&&b.link&&(a===b.link.view)\n};\nZmNewWindow.prototype._createView=function(){var e=window.newWindowCommand;\nvar f=window.newWindowParams;\nvar j=appCtxt.getRootTabGroup();\nvar b;\nappCtxt.composeCtlrSessionId=null;\nif(e==\"compose\"||e==\"composeDetach\"){var d=AjxDispatcher.run(\"GetComposeController\");\nappCtxt.composeCtlrSessionId=d.getSessionId();\nif(f.action==ZmOperation.REPLY_ALL){f.msg=this._deepCopyMsg(f.msg)\n}if(e==\"compose\"){d._setView(f)\n}else{AjxDispatcher.require([\"MailCore\",\"ContactsCore\",\"CalendarCore\"]);\nvar h=f.action||ZmOperation.NEW_MESSAGE;\nif(f.msg&&f.msg._mode){switch(f.msg._mode){case ZmAppt.MODE_DELETE:case ZmAppt.MODE_DELETE_INSTANCE:case ZmAppt.MODE_DELETE_SERIES:h=ZmOperation.REPLY_CANCEL;\nbreak\n}}f.action=h;\nd._setView(f);\nd._composeView.setDetach(f);\nvar k=window.parentController.getApp(ZmApp.MAIL).getComposeController(f.sessionId);\nif(k&&k._composeView){k._composeView.reset(true);\nk._app.popView(true)\n}}d._setComposeTabGroup();\nj.addMember(d.getTabGroup());\nb=d._getDefaultFocusItem();\ntarget=\"compose-window\"\n}else{if(e==\"msgViewDetach\"){var c=this._deepCopyMsg(f.msg);\nc.isRfc822=f.isRfc822;\nf.msg.addChangeListener(c.detachedChangeListener.bind(c));\nvar g=AjxDispatcher.run(\"GetMsgController\");\nappCtxt.msgCtlrSessionId=g.getSessionId();\ng.show(c,f.parentController);\nj.addMember(g.getTabGroup());\nb=g.getCurrentView();\ntarget=\"view-window\"\n}else{if(e==\"documentEdit\"){AjxDispatcher.require([\"Docs\"]);\nZmDocsEditApp.setFile(f.id,f.name,f.folderId);\nZmDocsEditApp.restUrl=f.restUrl;\nnew ZmDocsEditApp();\nif(f.name){Dwt.setTitle(f.name)\n}}else{if(e==\"shortcuts\"){var a=appCtxt.getShortcutsPanel();\na.popup(f.cols)\n}}}}if(this._appViewMgr.loadingView){this._appViewMgr.loadingView.setVisible(false)\n}this._kbMgr.setTabGroup(j);\nthis._kbMgr.grabFocus(b)\n};\nZmNewWindow.prototype._hasZimletsForTarget=function(b,d){var f=new RegExp(\"\\\\b\"+d+\"\\\\b\");\nfor(var c=0;\nc<b.length;\nc++){var a=b[c];\nvar e=a.zimlet[0];\nif(f.test(e.target||\"main\")){return true\n}}return false\n};\nZmNewWindow.prototype._getUserProps=function(){var f=parentAppCtxt.get(ZmSetting.USER_PROPS);\nf=f?[].concat(f):[];\nvar a=parentAppCtxt.getZimletMgr().getZimletsHash();\nvar g=parentAppCtxt.get(ZmSetting.ZIMLETS);\nfor(var d=0;\nd<g.length;\nd++){var e=g[d].zimlet[0].name;\nvar b=a[e];\nif(!b||!b.userProperties){continue\n}for(var c=0;\nc<b.userProperties.length;\nc++){var k=b.userProperties[c];\nvar h={zimlet:e,name:k.name,_content:k.value};\nf.push(h)\n}}return f\n};\nZmNewWindow.prototype.cancelRequest=function(c,a,b){return window.parentController?window.parentController.cancelRequest(c,a,b):null\n};\nZmNewWindow.prototype.sendRequest=function(a){window.onbeforeunload=null;\na.errorCallback=new AjxCallback(this,this._handleException,[(a.errorCallback||null)]);\na.fromChildWindow=true;\nreturn window.parentController?window.parentController.sendRequest(a):null\n};\nZmNewWindow.prototype._handleException=function(a,b){var c=false;\nif(a){c=a.run(b)\n}if(!c){ZmController.prototype._handleException.apply(this,[b])\n}return true\n};\nZmNewWindow.prototype.popupErrorDialog=function(e,c,b,g){var d;\nif(c instanceof Object||typeof c==\"object\"){var a=[];\nc.msg=c.msg||e;\nfor(var f in c){if(typeof c[f]==\"function\"||(typeof c[f]==\"object\"&&c[f].apply&&c[f].call)){continue\n}a.push([f,\": \",c[f],\"<br/>\\n\"].join(\"\"))\n}d=a.join(\"\")\n}ZmController.prototype.popupErrorDialog.call(this,e,(d||c),b,g)\n};\nZmNewWindow.prototype.setStatusMsg=function(a){a=Dwt.getParams(arguments,ZmStatusView.MSG_PARAMS);\nthis._statusView.setStatusMsg(a)\n};\nZmNewWindow.prototype.getApp=function(a){if(!this._apps[a]){this._createApp(a)\n}return this._apps[a]\n};\nZmNewWindow.prototype.getAppViewMgr=function(){return this._appViewMgr\n};\nZmNewWindow.prototype.setActiveApp=function(){};\nZmNewWindow.prototype.getKeyMapMgr=function(){return this._kbMgr.__keyMapMgr\n};\nZmNewWindow.prototype.getKeyMapName=function(){var a=appCtxt.getCurrentController();\nif(a&&a.getKeyMapName){return a.getKeyMapName()\n}return ZmKeyMap.MAP_GLOBAL\n};\nZmNewWindow.prototype.handleKeyAction=function(b,c){if(ZmApp.GOTO_ACTION_CODE_R[b]){return false\n}switch(b){case ZmKeyMap.QUICK_REMINDER:case ZmKeyMap.FOCUS_SEARCH_BOX:case ZmKeyMap.FOCUS_CONTENT_PANE:case ZmKeyMap.FOCUS_TOOLBAR:case ZmKeyMap.SHORTCUTS:return false\n}var a=appCtxt.getCurrentController();\nif(a&&a.handleKeyAction){return a.handleKeyAction(b,c)\n}return false\n};\nZmNewWindow.prototype._createEnabledApps=function(c){for(var d in ZmApp.CLASS){if(!c||c[d]){ZmApp.APPS.push(d)\n}}ZmApp.APPS.sort(function(f,e){return ZmZimbraMail.hashSortCompare(ZmApp.LOAD_SORT,f,e)\n});\nfor(var a=0;\na<ZmApp.APPS.length;\na++){var d=ZmApp.APPS[a];\nif(d!=ZmApp.IM){var b=ZmApp.SETTING[d];\nif(!b||appCtxt.get(b)){this._createApp(d)\n}}}};\nZmNewWindow.prototype._createApp=function(appName){if(this._apps[appName]){return\n}var appClass=eval(ZmApp.CLASS[appName]);\nthis._apps[appName]=appClass&&new appClass(this._shell,window.parentController)\n};\nZmNewWindow.prototype._deepCopyMsg=function(d){var a=null;\nvar m=d.list.search;\nif(m){a=new ZmSearch();\nfor(var f in m){if((typeof m[f]==\"object\")||(typeof m[f]==\"function\")){continue\n}a[f]=m[f]\n}a.types=new AjxVector();\nvar k=m.types.getArray();\nfor(var f=0;\nf<k.length;\nf++){a.types.add(k[f])\n}}var l=new ZmMailList(d.list.type,a);\nfor(var f in d.list){if((typeof d.list[f]==\"object\")||(typeof d.list[f]==\"function\")){continue\n}l[f]=d.list[f]\n}var c=new ZmMailMsg(d.id,l);\nfor(var f in d){if((typeof d[f]==\"object\")||(typeof d[f]==\"function\")){continue\n}c[f]=d[f]\n}for(var f in d._addrs){var h=d._addrs[f].getArray();\nfor(var e=0;\ne<h.length;\ne++){c._addrs[f].add(h[e])\n}}if(d.attachments&&d.attachments.length>0){for(var f=0;\nf<d.attachments.length;\nf++){c.attachments.push(d.attachments[f])\n}}for(var f=0;\nf<d._bodyParts.length;\nf++){c._bodyParts.push(d._bodyParts[f])\n}for(var g in d._contentType){c._contentType[g]=true\n}if(d._topPart){c._topPart=new ZmMimePart();\nfor(var f in d._topPart){if((typeof d._topPart[f]==\"object\")||(typeof d._topPart[f]==\"function\")){continue\n}c._topPart[f]=d._topPart[f]\n}var b=d._topPart.children.getArray();\nfor(var f=0;\nf<b.length;\nf++){c._topPart.children.add(b[f])\n}}if(d.invite){c.invite=d.invite\n}if(d.share){c.share=d.share\n}c.subscribeReq=d.subscribeReq;\nc.cloneOf=d;\nif(d.certificate){c.certificate=d.certificate\n}return c\n};\nZmNewWindow._confirmExitMethod=function(d){if(!appCtxt.get(ZmSetting.WARN_ON_EXIT)||!window.parentController){return\n}var f=window.newWindowCommand;\nif(f===\"compose\"||f===\"composeDetach\"){var h=AjxDispatcher.run(\"GetComposeController\",appCtxt.composeCtlrSessionId),c=h&&h._composeView,a=h.getCurrentViewId(),b=appCtxt.getAppViewMgr();\nif(c&&b.isVisible(a)&&c.isDirty()){return ZmMsg.newWinComposeExit\n}}else{if(f==\"documentEdit\"){var e=ZmDocsEditApp._controller;\nvar g=e.checkForChanges();\nreturn g||e.exit()\n}}}\n}if(AjxPackage.define(\"zimbraMail.core.ZmToolTipMgr\")){ZmToolTipMgr=function(){this._registry={};\nthis.registerToolTipHandler(ZmToolTipMgr.PERSON,this.getPersonToolTip)\n};\nZmToolTipMgr.PERSON=\"PERSON\";\nZmToolTipMgr.prototype.registerToolTipHandler=function(b,a){this._registry[b]=a\n};\nZmToolTipMgr.prototype.getToolTip=function(b,c,d){var a=this._registry[b];\nif(a&&AjxUtil.isFunction(a)){return a.apply(this,[c,d])\n}};\nZmToolTipMgr.prototype.getPersonToolTip=function(c,g){if(!(c&&(c.address||c.contact))){return\"\"\n}var a=c.contact;\nvar b=c.address||a.getEmail();\nif(!b.isAjxEmailAddress){b=new AjxEmailAddress(b)\n}if(appCtxt.notifyZimlets(\"onHoverOverEmailInList\",[b,c.ev,c.noRightClick])){return\"\"\n}var f=appCtxt.get(ZmSetting.CONTACTS_ENABLED)&&appCtxt.getApp(ZmApp.CONTACTS);\nif(!a&&!f){return\"\"\n}var e=b.getAddress();\nif(g){if(a){this._handleResponseGetContact(b,g,a)\n}else{var d=new AjxCallback(this,this._handleResponseGetContact,[b,g]);\nf.getContactByEmail(e,d)\n}}else{a=a||f.getContactByEmail(e);\nreturn this._handleResponseGetContact(b,null,a)\n}};\nZmToolTipMgr.prototype._handleResponseGetContact=function(b,d,a){if(!b&&!a){return\"\"\n}var c;\nif(a){c=a.getToolTip(b.getAddress())\n}else{c=AjxTemplate.expand(\"abook.Contacts#TooltipNotInAddrBook\",{addrstr:b.toString()})\n}if(d){d.run(c)\n}else{return c\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmCalMgr\")){ZmCalMgr=function(a){this._container=a;\nthis.clearCache();\nthis._listeners={};\nthis._folderNames={};\nthis._listeners[ZmOperation.NEW_APPT]=new AjxListener(this,this._newApptAction);\nthis._listeners[ZmOperation.NEW_ALLDAY_APPT]=new AjxListener(this,this._newAllDayApptAction);\nthis._listeners[ZmOperation.SEARCH_MAIL]=new AjxListener(this,this._searchMailAction)\n};\nZmCalMgr.prototype.toString=function(){return\"ZmCalMgr\"\n};\nZmCalMgr.prototype.clearCache=function(){this._miniCalData={}\n};\nZmCalMgr.prototype._createMiniCalendar=function(e){e=e?e:new Date();\nvar a=appCtxt.get(ZmSetting.CAL_FIRST_DAY_OF_WEEK)||0;\nvar h=AjxTimezone.getServerId(AjxTimezone.DEFAULT);\nvar b=(h&&h.indexOf(\"Europe\")==0&&h!=\"Europe/London\");\nthis._miniCalendar=new DwtCalendar({parent:this._container,posStyle:DwtControl.ABSOLUTE_STYLE,firstDayOfWeek:a,showWeekNumber:appCtxt.get(ZmSetting.CAL_SHOW_CALENDAR_WEEK),useISO8601WeekNo:b});\nthis._miniCalendar.setDate(e);\nthis._miniCalendar.setScrollStyle(Dwt.CLIP);\nthis._miniCalendar.addSelectionListener(new AjxListener(this,this._miniCalSelectionListener));\nthis._miniCalendar.addActionListener(new AjxListener(this,this._miniCalActionListener));\nthis._miniCalendar.addDateRangeListener(new AjxListener(this,this._miniCalDateRangeListener));\nthis._miniCalendar.setMouseOverDayCallback(new AjxCallback(this,this._miniCalMouseOverDayCallback));\nthis._miniCalendar.setMouseOutDayCallback(new AjxCallback(this,this._miniCalMouseOutDayCallback));\nvar j=[];\nif(appCtxt.get(ZmSetting.MAIL_ENABLED)){j.push(\"ZmMailMsg\");\nj.push(\"ZmConv\")\n}if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)){j.push(\"ZmContact\")\n}this._miniCalDropTarget=new DwtDropTarget(j);\nthis._miniCalDropTarget.addDropListener(new AjxListener(this,this._miniCalDropTargetListener));\nthis._miniCalendar.setDropTarget(this._miniCalDropTarget);\nvar m=[];\nfor(var f=0;\nf<7;\nf++){var k=(f+a)%7;\nm[f]=(k>0&&k<6)\n}this._miniCalendar.setWorkingWeek(m);\nvar g={};\ng[ZmAppViewMgr.C_TREE_FOOTER]=this._miniCalendar;\nappCtxt.getAppViewMgr().setViewComponents(ZmAppViewMgr.GLOBAL,g,true);\nvar c=appCtxt.getApp(ZmApp.CALENDAR);\nvar l=c._active||appCtxt.get(ZmSetting.CAL_ALWAYS_SHOW_MINI_CAL);\nthis._miniCalendar.setSkipNotifyOnPage(l&&!c._active);\nif(!c._active){this._miniCalendar.setSelectionMode(DwtCalendar.DAY)\n}this._dayRollTimer=null\n};\nZmCalMgr.prototype.startDayRollTimer=function(){if(!this._dayRollTimer){var c=new Date();\nvar b=new Date();\nb.setHours(23,59,59,999);\nvar a=b.getTime()-c.getTime();\nvar d=new AjxTimedAction(this,this._rollDay);\nAjxTimedAction.scheduleAction(d,a)\n}};\nZmCalMgr.prototype._rollDay=function(){this._dayRollTimer=null;\nthis._miniCalendar.setDate(new Date(),true);\nthis.startDayRollTimer()\n};\nZmCalMgr.prototype._miniCalDropTargetListener=function(b){var a=this.getCalViewController();\na._miniCalDropTargetListener(b)\n};\nZmCalMgr.prototype.getMiniCalendar=function(){if(!this._miniCalendar){this._createMiniCalendar()\n}return this._miniCalendar\n};\nZmCalMgr.prototype._refreshCallback=function(a){this.getReminderController()._refreshCallback(a)\n};\nZmCalMgr.prototype.getReminderController=function(){if(!this._reminderController){this._reminderController=new ZmReminderController(this,\"appt\")\n}return this._reminderController\n};\nZmCalMgr.prototype._miniCalSelectionListener=function(b){if(b.item instanceof DwtCalendar){var a=this.getCalViewController();\na._handleLoadMiniCalSelection(b)\n}};\nZmCalMgr.prototype._miniCalActionListener=function(a){if(appCtxt.isExternalAccount()){return\n}var b=this._getMiniCalActionMenu();\nb.__detail=a.detail;\nb.popup(0,a.docX,a.docY)\n};\nZmCalMgr.prototype._getMiniCalActionMenu=function(){if(this._minicalMenu==null){this.postInitListeners();\nvar d=[ZmOperation.NEW_APPT,ZmOperation.NEW_ALLDAY_APPT,ZmOperation.SEP,ZmOperation.SEARCH_MAIL];\nvar f=ZmZimlet.actionMenus?ZmZimlet.actionMenus.ZmCalViewController:null;\nif(f&&f.length){for(var c=0;\nc<f.length;\nc++){var g=f[c];\nZmOperation.defineOperation(null,g);\nd.push(g.id)\n}}var e={parent:appCtxt.getShell(),menuItems:d};\nthis._minicalMenu=new ZmActionMenu(e);\nd=this._minicalMenu.opList;\nvar b=d.length;\nfor(var a=0;\na<b;\na++){if(this._listeners[d[a]]){this._minicalMenu.addSelectionListener(d[a],this._listeners[d[a]])\n}}}return this._minicalMenu\n};\nZmCalMgr.prototype.postInitListeners=function(){if(ZmZimlet.listeners&&ZmZimlet.listeners.ZmCalViewController){for(var a in ZmZimlet.listeners.ZmCalViewController){if(ZmZimlet.listeners.ZmCalViewController[a] instanceof AjxListener){this._listeners[a]=ZmZimlet.listeners.ZmCalViewController[a]\n}else{this._listeners[a]=new AjxListener(this,this._proxyListeners,[ZmZimlet.listeners.ZmCalViewController[a]])\n}}}};\nZmCalMgr.prototype._proxyListeners=function(b,c){var a=this.getCalViewController();\nreturn(new AjxListener(a,b)).handleEvent(c)\n};\nZmCalMgr.prototype.isMiniCalCreated=function(){return(this._miniCalendar!=null)\n};\nZmCalMgr.prototype._miniCalDateRangeListener=function(c){var a=appCtxt.getCurrentViewId();\nif(a==ZmId.VIEW_CAL){var b=this.getCalViewController();\nb._scheduleMaintenance(ZmCalViewController.MAINT_MINICAL)\n}else{this.highlightMiniCal()\n}};\nZmCalMgr.prototype._miniCalMouseOverDayCallback=function(c,a){this._currentMouseOverDay=a;\nvar b=new AjxTimedAction(this,this._getDayToolTipOnDelay,[c,a]);\nAjxTimedAction.scheduleAction(b,1000)\n};\nZmCalMgr.prototype.getCalViewController=function(){var a=AjxDispatcher.run(\"GetCalController\");\na._miniCalendar=this._miniCalendar;\na._minicalMenu=this._minicalMenu;\na._miniCalDropTarget=this._miniCalDropTarget;\nreturn a\n};\nZmCalMgr.prototype._miniCalMouseOutDayCallback=function(a){this._currentMouseOverDay=null\n};\nZmCalMgr.prototype._getDayToolTipOnDelay=function(c,a){if(!this._currentMouseOverDay){return\n}if((this._currentMouseOverDay.getDate()==a.getDate())&&(this._currentMouseOverDay.getMonth()==a.getMonth())){this._currentMouseOverDay=null;\nvar b=DwtShell.mouseEvent;\nif(b&&b.docX>0&&b.docY>0){var d=new AjxCallback(this,this.showTooltip,[c,b.docX,b.docY]);\nthis.getCalViewController().getDayToolTipText(a,false,d,true)\n}}};\nZmCalMgr.prototype.showTooltip=function(e,a,f,d){e.setToolTipContent(d);\nif(a>0&&f>0){var b=DwtShell.getShell(window);\nvar c=b.getToolTip();\nc.setContent(d);\nc.popup(a,f);\ne.__tooltipClosed=false\n}};\nZmCalMgr.prototype.getApptSummaries=function(b){var a=this.setSearchParams(b);\nif(a!=null&&(a instanceof AjxVector)){return a\n}this._rawAppts=[];\nif(b.callback){this._search(b)\n}else{return this._search(b)\n}};\nZmCalMgr.prototype.setSearchParams=function(d){if(!(d.folderIds instanceof Array)){d.folderIds=[d.folderIds]\n}else{if(d.folderIds.length==0){var b=new AjxVector();\nif(d.callback){d.callback.run(b)\n}return b\n}}var e={};\nvar h=\"\";\nfor(var g=0;\ng<d.folderIds.length;\ng++){var c=d.folderIds[g];\nvar f=appCtxt.getActiveAccount().isMain?c:ZmOrganizer.getSystemId(c);\nvar a=appCtxt.getById(f);\nvar k=a?a.getRemoteId():f;\ne[k]=f;\nif(h.length){h+=\" OR \"\n}var j=AjxUtil.isNumeric(c)?c:['\"',c,'\"'].join(\"\");\nh+=\"inid:\"+j\n}d.queryHint=h;\nd.needToFetch=d.folderIds;\nd.folderIdMapper=e;\nd.offset=0\n};\nZmCalMgr.prototype._search=function(g){var h={SearchRequest:{_jsns:\"urn:zimbraMail\"}};\nvar f=h.SearchRequest;\nthis._setSoapParams(f,g);\nvar d=this.getCalViewController();\nvar e=d.getApptCache();\nvar c=appCtxt.multiAccounts?appCtxt.accountList.mainAccount.name:null;\nif(g.callback){appCtxt.getAppController().sendRequest({jsonObj:h,asyncMode:true,callback:(new AjxCallback(this,this._getApptSummariesResponse,[g])),offlineCallback:e.offlineSearchAppts(null,null,g),noBusyOverlay:g.noBusyOverlay,accountName:c})\n}else{var b=appCtxt.getAppController().sendRequest({jsonObj:h,accountName:c});\nvar a=new ZmCsfeResult(b,false);\nreturn this._getApptSummariesResponse(g,a)\n}};\nZmCalMgr.prototype._setSoapParams=function(a,c){a.sortBy=\"none\";\na.limit=\"500\";\na.calExpandInstStart=c.start;\na.calExpandInstEnd=c.end;\na.types=ZmSearch.TYPE[ZmItem.APPT];\na.offset=c.offset;\nvar b=c.query;\nif(c.queryHint){b=(b!=null)?(b+\" (\"+c.queryHint+\")\"):c.queryHint\n}a.query={_content:b}\n};\nZmCalMgr.prototype._getApptSummariesResponse=function(f,a){if(!a){return\n}var g=f.callback;\nvar e;\ntry{e=a.getResponse()\n}catch(b){if(g){g.run(new AjxVector())\n}return\n}var d=e.SearchResponse;\nvar c=this.processSearchResponse(d,f);\nif(c==null){return\n}if(g){g.run(c,f.query)\n}else{return c\n}};\nZmCalMgr.prototype.processSearchResponse=function(f,e){if(!f){return\n}if(f&&f.appt&&f.appt.length){this._rawAppts=this._rawAppts!=null?this._rawAppts.concat(f.appt):f.appt;\nif(f.more){var l=f.appt[f.appt.length-1];\nif(l){e.offset+=500;\nthis._search(e);\nreturn\n}}}var c=new AjxVector();\nif(this._rawAppts&&this._rawAppts.length){this._list=new ZmList(ZmItem.APPT);\nfor(var h=0;\nh<this._rawAppts.length;\nh++){var d=this._rawAppts[h];\nvar b=d?d.inst:null;\nif(b){var k={list:this._list};\nfor(var g=0;\ng<b.length;\ng++){var a=ZmCalBaseItem.createFromDom(d,k,b[g]);\nif(a){c.add(a)\n}}}}}return c\n};\nZmCalMgr.prototype.getCalendarName=function(a){var b=appCtxt.getApp(ZmApp.CALENDAR);\nreturn b.getCalendarName(a)\n};\nZmCalMgr.prototype._newApptAction=function(b){var a=this.getCalViewController();\na._newApptAction(b)\n};\nZmCalMgr.prototype._newAllDayApptAction=function(b){var a=this.getCalViewController();\na._newAllDayApptAction(b)\n};\nZmCalMgr.prototype._searchMailAction=function(b){var a=this.getCalViewController();\na._searchMailAction(b)\n};\nZmCalMgr.prototype.getCheckedCalendarFolderIds=function(a){var b=appCtxt.getApp(ZmApp.CALENDAR);\nreturn b.getCheckedCalendarFolderIds(a)\n};\nZmCalMgr.prototype.getReminderCalendarFolderIds=function(){var a=appCtxt.getApp(ZmApp.CALENDAR);\nreturn a.getReminderCalendarFolderIds()\n};\nZmCalMgr.prototype._handleError=function(b){if(b.code==\"mail.INVITE_OUT_OF_DATE\"||b.code==\"mail.NO_SUCH_APPT\"){var a=appCtxt.getMsgDialog();\na.setMessage(ZmMsg.apptOutOfDate,DwtMessageDialog.INFO_STYLE);\na.popup();\nreturn true\n}return false\n};\nZmCalMgr.prototype.highlightMiniCal=function(){this.getMiniCalCache()._getMiniCalData(this.getMiniCalendarParams())\n};\nZmCalMgr.prototype.getMiniCalendarParams=function(){var a=this.getMiniCalendar().getDateRange();\nreturn{start:a.start.getTime(),end:a.end.getTime(),fanoutAllDay:true,noBusyOverlay:true,folderIds:this.getCheckedCalendarFolderIds(),tz:AjxTimezone.DEFAULT}\n};\nZmCalMgr.prototype.getMiniCalCache=function(){if(!this._miniCalCache){this._miniCalCache=new ZmMiniCalCache(this)\n}return this._miniCalCache\n};\nZmCalMgr.prototype.getQuickReminderSearchTimeRange=function(){var c=new Date();\nc.setHours(23,59,59,999);\nvar a=new Date(c.getTime());\nvar b=c;\nb.setHours(0,0,0,0);\nreturn{start:b.getTime(),end:a.getTime()}\n};\nZmCalMgr.prototype.showQuickReminder=function(){var a=this.getQuickReminderParams();\nthis.getApptSummaries(a)\n};\nZmCalMgr.prototype.getQuickReminderParams=function(){var a=this.getQuickReminderSearchTimeRange();\nreturn{start:a.start,end:a.end,fanoutAllDay:false,folderIds:this.getCheckedCalendarFolderIds(true),callback:(new AjxCallback(this,this._quickReminderCallback)),includeReminders:true}\n};\nZmCalMgr.prototype._quickReminderCallback=function(h){var d=new AjxVector();\nthis._cacheMap={};\nvar k=h.size();\nvar c=(new Date()).getTime();\nfor(var g=0;\ng<k;\ng++){var a=h.get(g);\nvar b=a.id;\nif(!this._cacheMap[b]){this._cacheMap[b]=a;\nif(a.isAllDayEvent()){continue\n}var j=a.getStartTime()-c;\nvar f=(j>=0&&j<=AjxDateUtil.MSEC_PER_HOUR);\nif((c>=a.getStartTime()&&c<=a.getEndTime())||f){a.isUpcomingEvent=f;\nd.add(a)\n}}}var e=this.getQuickReminderDialog();\ne.initialize(d);\ne.popup()\n};\nZmCalMgr.prototype.getQuickReminderDialog=function(){if(this._reminderDialog==null){this._reminderDialog=new ZmQuickReminderDialog(appCtxt.getShell(),this,this._calController)\n}return this._reminderDialog\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmRecurrence\")){ZmRecurrence=function(a){this._startDate=(a&&a.startDate)?a.startDate:(new Date());\nthis.repeatCustom=\"0\";\nthis.repeatCustomCount=1;\nthis.repeatCustomDayOfWeek=\"SU\";\nthis.repeatBySetPos=\"1\";\nthis.repeatCustomMonthDay=this._startDate.getDate();\nthis.repeatCustomType=\"S\";\nthis.repeatEnd=null;\nthis.repeatEndCount=1;\nthis.repeatEndDate=null;\nthis.repeatEndType=\"N\";\nthis.repeatMonthlyDayList=null;\nthis.repeatType=ZmRecurrence.NONE;\nthis.repeatWeekday=false;\nthis.repeatWeeklyDays=[];\nthis.repeatYearlyMonthsList=1;\nthis._cancelRecurIds={}\n};\nZmRecurrence.prototype.toString=function(){return\"ZmRecurrence\"\n};\nZmRecurrence.NONE=\"NON\";\nZmRecurrence.DAILY=\"DAI\";\nZmRecurrence.WEEKLY=\"WEE\";\nZmRecurrence.MONTHLY=\"MON\";\nZmRecurrence.YEARLY=\"YEA\";\nZmRecurrence.RECURRENCE_DAY=-1;\nZmRecurrence.RECURRENCE_WEEKEND=-2;\nZmRecurrence.RECURRENCE_WEEKDAY=-3;\nZmRecurrence.prototype.setJson=function(h){if(this.repeatType==ZmRecurrence.NONE){return\n}var l=h.recur={},p=l.add={},o=p.rule={},f=o.interval={},d,k,a,m,g,n,j,b,e;\no.freq=this.repeatType;\nf.ival=this.repeatCustomCount;\nif(this.repeatEndDate!=null&&this.repeatEndType==\"D\"){d=o.until={};\nd.d=AjxDateUtil.getServerDate(this.repeatEndDate)\n}else{if(this.repeatEndType==\"A\"){m=o.count={};\nm.num=this.repeatEndCount\n}}if(this.repeatCustom!=\"1\"){this.setExcludes(l);\nreturn\n}if(this.repeatType==ZmRecurrence.DAILY){if(this.repeatWeekday){k=o.byday={};\nj=k.wkday=[];\nfor(g=0;\ng<ZmCalItem.SERVER_WEEK_DAYS.length;\ng++){n=ZmCalItem.SERVER_WEEK_DAYS[g];\nif(n==\"SA\"||n==\"SU\"){continue\n}j.push({day:n})\n}}}else{if(this.repeatType==ZmRecurrence.WEEKLY){k=o.byday={};\nj=k.wkday=[];\nfor(g=0;\ng<this.repeatWeeklyDays.length;\n++g){j.push({day:this.repeatWeeklyDays[g]})\n}}else{if(this.repeatType==ZmRecurrence.MONTHLY){if(this.repeatCustomType==\"S\"){a=o.bymonthday={};\na.modaylist=this.repeatMonthlyDayList.join(\",\")\n}else{k=o.byday={};\nk.wkday=[];\nif(this.repeatCustomDays){for(g=0;\ng<this.repeatCustomDays.length;\ng++){j={};\nj.day=this.repeatCustomDays[g];\nif(this.repeatCustomOrdinal){j.ordwk=this.repeatCustomOrdinal\n}k.wkday.push(j)\n}}if(this.repeatCustomOrdinal==null){b=o.bysetpos={};\nb.poslist=this.repeatBySetPos\n}}}else{if(this.repeatType==ZmRecurrence.YEARLY){e=o.bymonth={};\ne.molist=this.repeatYearlyMonthsList;\nif(this.repeatCustomType==\"O\"){k=o.byday={};\nk.wkday=[];\nif(this.repeatCustomDays){for(g=0;\ng<this.repeatCustomDays.length;\ng++){j={};\nj.day=this.repeatCustomDays[g];\nif(this.repeatCustomOrdinal){j.ordwk=this.repeatCustomOrdinal\n}k.wkday.push(j)\n}}if(this.repeatCustomOrdinal==null){b=o.bysetpos={};\nb.poslist=this.repeatBySetPos\n}}else{a=o.bymonthday={};\na.modaylist=this.repeatCustomMonthDay\n}}}}}this.setExcludes(l)\n};\nZmRecurrence.prototype.setExcludes=function(d){if(!this._cancelRecurIds){return\n}var a,g,b,e,f,c;\nfor(b in this._cancelRecurIds){if(!this._cancelRecurIds[b]){continue\n}if(!a&&!g){a=d.exclude={};\ng=a.dates={};\ng.dtval=[]\n}e=b;\nf={};\nc=f.s={};\nc.d=e;\ng.dtval.push(f)\n}};\nZmRecurrence.prototype.getBlurb=function(){if(this.repeatType==ZmRecurrence.NONE){return\"\"\n}var g=[];\nswitch(this.repeatType){case ZmRecurrence.DAILY:if(this.repeatCustom==\"1\"&&this.repeatWeekday){g.push(ZmMsg.recurDailyEveryWeekday)\n}else{if(this.repeatCustomCount==1){g.push(ZmMsg.recurDailyEveryDay)\n}else{var o=new AjxMessageFormat(ZmMsg.recurDailyEveryNumDays);\ng.push(o.format(this.repeatCustomCount))\n}}break;\ncase ZmRecurrence.WEEKLY:if(this.repeatCustomCount==1&&this.repeatWeeklyDays.length==1){var q=AjxUtil.indexOf(ZmCalItem.SERVER_WEEK_DAYS,this.repeatWeeklyDays[0]);\nvar c=new Date();\nc.setDate(c.getDate()-c.getDay()+q);\nvar o=new AjxMessageFormat(ZmMsg.recurWeeklyEveryWeekday);\ng.push(o.format(c))\n}else{var r=[];\nfor(var e=0;\ne<this.repeatWeeklyDays.length;\ne++){var q=AjxUtil.indexOf(ZmCalItem.SERVER_WEEK_DAYS,this.repeatWeeklyDays[e]);\nvar c=new Date();\nc.setDate(c.getDate()-c.getDay()+q);\nr.push(c)\n}var o=new AjxMessageFormat(ZmMsg.recurWeeklyEveryNumWeeksDate);\ng.push(o.format([this.repeatCustomCount,r,\"\"]))\n}break;\ncase ZmRecurrence.MONTHLY:if(this.repeatCustomType==\"S\"){var j=Number(this.repeatCustomCount);\nvar c=Number(this.repeatMonthlyDayList[0]);\nvar o=new AjxMessageFormat(ZmMsg.recurMonthlyEveryNumMonthsDate);\ng.push(o.format([c,j]))\n}else{var l=Number(this.repeatCustomOrdinal);\nvar b=Number(this.repeatBySetPos);\nvar q=AjxUtil.indexOf(ZmCalItem.SERVER_WEEK_DAYS,this.repeatCustomDayOfWeek);\nvar n=new Date();\nn.setDate(n.getDate()-n.getDay()+q);\nvar j=Number(this.repeatCustomCount);\nvar p=this.repeatCustomDays.join(\",\");\nvar h=ZmCalItem.SERVER_WEEK_DAYS.slice(1,6).join(\",\");\nvar m=[ZmCalItem.SERVER_WEEK_DAYS[AjxDateUtil.SUNDAY],ZmCalItem.SERVER_WEEK_DAYS[AjxDateUtil.SATURDAY]].join(\",\");\nif(this.repeatCustomOrdinal!=null&&this.repeatBySetPos!=null&&this.repeatCustomOrdinal!=this.repeatBySetPos){this.repeatCustomOrdinal=this.repeatBySetPos\n}if((ZmCalItem.SERVER_WEEK_DAYS.join(\",\")==p)||(h==p)||(m==p)){var o=new AjxMessageFormat(ZmMsg.recurMonthlyEveryNumMonthsWeekDays);\nvar f=-1;\nif(h==p){f=1\n}else{if(m==p){f=0\n}}g.push(o.format([b||l,f,j]))\n}else{var n=new Date();\nn.setDate(n.getDate()-n.getDay()+q);\nvar o=new AjxMessageFormat(ZmMsg.recurMonthlyEveryNumMonthsNumDay);\ng.push(o.format([b||l,n,j]))\n}}break;\ncase ZmRecurrence.YEARLY:if(this.repeatCustomType==\"S\"){var k=new Date();\nk.setMonth(Number(this.repeatYearlyMonthsList)-1);\nvar n=Number(this.repeatCustomMonthDay);\nvar o=new AjxMessageFormat(ZmMsg.recurYearlyEveryDate);\ng.push(o.format([k,n]))\n}else{var l=Number(this.repeatCustomOrdinal);\nvar b=Number(this.repeatBySetPos);\nvar q=AjxUtil.indexOf(ZmCalItem.SERVER_WEEK_DAYS,this.repeatCustomDayOfWeek);\nvar k=new Date();\nk.setMonth(Number(this.repeatYearlyMonthsList)-1);\nvar p=this.repeatCustomDays.join(\",\");\nvar h=ZmCalItem.SERVER_WEEK_DAYS.slice(1,6).join(\",\");\nvar m=[ZmCalItem.SERVER_WEEK_DAYS[AjxDateUtil.SUNDAY],ZmCalItem.SERVER_WEEK_DAYS[AjxDateUtil.SATURDAY]].join(\",\");\nif((ZmCalItem.SERVER_WEEK_DAYS.join(\",\")==p)||(h==p)||(m==p)){var o=new AjxMessageFormat(ZmMsg.recurYearlyEveryMonthWeekDays);\nvar f=-1;\nif(h==p){f=1\n}else{if(m==p){f=0\n}}g.push(o.format([b||l,f,k]))\n}else{var n=new Date();\nn.setDate(n.getDate()-n.getDay()+q);\nvar o=new AjxMessageFormat(ZmMsg.recurYearlyEveryMonthNumDay);\ng.push(o.format([b||l,n,k]))\n}}break\n}var a=[];\nvar o=new AjxMessageFormat(ZmMsg.recurStart);\na.push(o.format(this._startDate));\nvar d=[];\nswitch(this.repeatEndType){case\"N\":d.push(ZmMsg.recurEndNone);\nbreak;\ncase\"A\":o=new AjxMessageFormat(ZmMsg.recurEndNumber);\nd.push(o.format(this.repeatEndCount));\nbreak;\ncase\"D\":o=new AjxMessageFormat(ZmMsg.recurEndByDate);\nd.push(o.format(this.repeatEndDate));\nbreak\n}if(g.length>0){g.push(\".  \")\n}if(d.length>0){d.push(\".  \")\n}o=new AjxMessageFormat(ZmMsg.recurBlurb);\nreturn o.format([g.join(\"\"),d.join(\"\"),a.join(\"\")])\n};\nZmRecurrence.prototype.parse=function(h){this.repeatWeeklyDays=[];\nfor(var a=0;\na<h.length;\n++a){var e=h[a].add;\nif(!e){continue\n}this.repeatYearlyMonthsList=this._startDate.getMonth()+1;\nfor(var c=0;\nc<e.length;\n++c){var m=e[c].rule;\nif(!m){continue\n}for(var b=0;\nb<m.length;\n++b){var f=m[b];\nif(f.freq){this.repeatType=f.freq.substring(0,3);\nif(f.interval&&f.interval[0].ival){this.repeatCustomCount=parseInt(f.interval[0].ival);\nthis.repeatCustom=\"1\"\n}}if(f.bymonth){this.repeatYearlyMonthsList=f.bymonth[0].molist;\nthis.repeatCustom=\"1\"\n}if(f.bymonthday){if(this.repeatType==ZmRecurrence.YEARLY){this.repeatCustomMonthDay=f.bymonthday[0].modaylist;\nthis.repeatCustomType=\"S\"\n}else{if(this.repeatType==ZmRecurrence.MONTHLY){this.repeatMonthlyDayList=f.bymonthday[0].modaylist.split(\",\")\n}}this.repeatCustom=\"1\"\n}if(f.byday&&f.byday[0]&&f.byday[0].wkday){this.repeatCustom=\"1\";\nvar d=f.byday[0].wkday;\nif(this.repeatType==ZmRecurrence.WEEKLY||(this.repeatType==ZmRecurrence.DAILY&&d.length==5)){this.repeatWeekday=this.repeatType==ZmRecurrence.DAILY;\nfor(var g=0;\ng<d.length;\n++g){this.repeatWeeklyDays.push(d[g].day)\n}}else{this.repeatCustomDayOfWeek=d[0].day;\nvar l=[];\nfor(var c=0;\nc<d.length;\nc++){l.push(d[c].day)\n}this.repeatCustomDays=l;\nthis.repeatCustomOrdinal=d[0].ordwk;\nthis.repeatBySetPos=(f.bysetpos&&(f.bysetpos.length>0))?f.bysetpos[0].poslist:null;\nif(this.repeatBySetPos==null&&this.repeatCustomOrdinal){this.repeatBySetPos=this.repeatCustomOrdinal\n}this.repeatCustomType=\"O\"\n}}if(f.until){this.repeatEndType=\"D\";\nthis.repeatEndDate=AjxDateUtil.parseServerDateTime(f.until[0].d)\n}else{if(f.count){this.repeatEndType=\"A\";\nthis.repeatEndCount=f.count[0].num\n}}}}}};\nZmRecurrence.prototype.setRecurrenceStartTime=function(a){this._startDate.setTime(a);\nthis.repeatCustomMonthDay=this._startDate.getDate();\nif(this.repeatType==ZmRecurrence.NONE){return\n}if(this.repeatType==ZmRecurrence.WEEKLY){this.repeatWeeklyDays=[ZmCalItem.SERVER_WEEK_DAYS[this._startDate.getDay()]]\n}else{if(this.repeatType==ZmRecurrence.MONTHLY){this.repeatMonthlyDayList=[this._startDate.getDate()]\n}else{if(this.repeatType==ZmRecurrence.YEARLY){this.repeatYearlyMonthsList=this._startDate.getMonth()+1\n}}}};\nZmRecurrence.prototype.setRecurrenceRules=function(b,a){if(b){this.parse(b)\n}if(!a){return\n}if(this.repeatWeeklyDays==null){this.repeatWeeklyDays=[ZmCalItem.SERVER_WEEK_DAYS[a.getDay()]]\n}if(this.repeatMonthlyDayList==null){this.repeatMonthlyDayList=[a.getDate()]\n}};\nZmRecurrence.prototype.addCancelRecurId=function(a){this._cancelRecurIds[a]=true\n};\nZmRecurrence.prototype.resetCancelRecurIds=function(){this._cancelRecurIds={}\n};\nZmRecurrence.prototype.isInstanceCanceled=function(a){return this._cancelRecurIds[a]\n};\nZmRecurrence.prototype.removeCancelRecurId=function(a){this._cancelRecurIds[a]=null\n};\nZmRecurrence.prototype.parseExcludeInfo=function(a){if(!a){return\n}for(var e=0;\ne<a.length;\ne++){var c=(a[e]&&a[e].exclude)?a[e].exclude:null;\nif(!c){continue\n}for(var b=0;\nb<c.length;\nb++){var d=c[b].dates;\nif(d){this._parseExcludeDates(d)\n}}}};\nZmRecurrence.prototype._parseExcludeDates=function(d){for(var c=0;\nc<d.length;\nc++){var e=d[c].dtval;\nif(!e){continue\n}for(var a=0;\na<e.length;\na++){var b=e[a];\nvar f=(b&&b.s)?b.s[0].d:null;\nif(f){this.addCancelRecurId(f)\n}}}}\n}if(AjxPackage.define(\"zimbraMail.tasks.model.ZmTaskMgr\")){ZmTaskMgr=function(a){this._container=a;\nthis._listeners={};\nthis._folderNames={}\n};\nZmTaskMgr.prototype=new ZmCalMgr;\nZmTaskMgr.prototype.constructor=ZmTaskMgr;\nZmTaskMgr.prototype.toString=function(){return\"ZmTaskMgr\"\n};\nZmTaskMgr.prototype._refreshCallback=function(a){this.getReminderController()._refreshCallback(a)\n};\nZmTaskMgr.prototype.getReminderController=function(){if(!this._reminderController){this._reminderController=new ZmReminderController(this,\"task\")\n}return this._reminderController\n};\nZmTaskMgr.prototype.getCalViewController=function(){var a=AjxDispatcher.run(\"GetTaskController\");\nreturn a\n};\nZmTaskMgr.prototype._miniCalMouseOutDayCallback=function(a){this._currentMouseOverDay=null\n};\nZmTaskMgr.prototype.getApptSummaries=function(b){var a=this.setSearchParams(b);\nif(a!=null&&(a instanceof AjxVector)){return a\n}this._rawTasks=[];\nif(b.callback){this._search(b)\n}else{return this._search(b)\n}};\nZmTaskMgr.prototype.setSearchParams=function(d){if(!(d.folderIds instanceof Array)){d.folderIds=[d.folderIds]\n}else{if(d.folderIds.length==0){var b=new AjxVector();\nif(d.callback){d.callback.run(b)\n}return b\n}}var e={};\nvar h=\"\";\nfor(var g=0;\ng<d.folderIds.length;\ng++){var c=d.folderIds[g];\nvar f=appCtxt.getActiveAccount().isMain?c:ZmOrganizer.getSystemId(c);\nvar a=appCtxt.getById(f);\nvar k=a?a.getRemoteId():f;\ne[k]=f;\nif(h.length){h+=\" OR \"\n}var j=AjxUtil.isNumeric(c)?c:['\"',c,'\"'].join(\"\");\nh+=\"inid:\"+j\n}d.queryHint=h;\nd.folderIdMapper=e;\nd.offset=0\n};\nZmTaskMgr.prototype._search=function(e){var f={SearchRequest:{_jsns:\"urn:zimbraMail\"}};\nvar d=f.SearchRequest;\nthis._setSoapParams(d,e);\nvar c=appCtxt.multiAccounts?appCtxt.accountList.mainAccount.name:null;\nif(e.callback){appCtxt.getAppController().sendRequest({jsonObj:f,asyncMode:true,callback:(new AjxCallback(this,this._getApptSummariesResponse,[e])),noBusyOverlay:e.noBusyOverlay,accountName:c})\n}else{var b=appCtxt.getAppController().sendRequest({jsonObj:f,accountName:c});\nvar a=new ZmCsfeResult(b,false);\nreturn this._getApptSummariesResponse(e,a)\n}};\nZmTaskMgr.prototype._setSoapParams=function(a,c){a.sortBy=\"none\";\na.limit=\"500\";\na.types=ZmSearch.TYPE[ZmItem.TASK];\na.offset=c.offset;\nvar b=c.query;\nif(c.queryHint){b=(b!=null)?(b+\" (\"+c.queryHint+\")\"):c.queryHint\n}a.query={_content:b}\n};\nZmTaskMgr.prototype._getApptSummariesResponse=function(f,a){if(!a){return\n}var g=f.callback;\nvar e;\ntry{e=a.getResponse()\n}catch(b){if(g){g.run(new AjxVector())\n}return\n}var d=e.SearchResponse;\nvar c=this.processSearchResponse(d,f);\nif(c==null){return\n}if(g){g.run(c,f.query)\n}else{return c\n}};\nZmTaskMgr.prototype.processSearchResponse=function(g,h){if(!g){return\n}if(g&&g.task&&g.task.length){this._rawTasks=this._rawTasks!=null?this._rawTasks.concat(g.task):g.task;\nif(g.more){var f=g.task[g.task.length-1];\nif(f){h.offset+=500;\nthis._search(h);\nreturn\n}}}var e=new AjxVector();\nif(this._rawTasks&&this._rawTasks.length){for(var d=0;\nd<this._rawTasks.length;\nd++){var c=this._rawTasks[d];\nvar b={list:null};\nvar a=ZmTask.createFromDom(c,b,null);\nif(a){e.add(a)\n}e.add(a)\n}}return e\n};\nZmTaskMgr.prototype.getCalendarName=function(a){var b=appCtxt.getApp(ZmApp.TASKS);\nreturn b.getTaskFolderName(a)\n};\nZmTaskMgr.prototype.getCheckedCalendarFolderIds=function(a){var b=appCtxt.getApp(ZmApp.TASKS);\nreturn b.getTaskFolderIds(a)\n};\nZmTaskMgr.prototype._handleError=function(b){if(b.code==\"mail.INVITE_OUT_OF_DATE\"||b.code==\"mail.NO_SUCH_APPT\"){var a=appCtxt.getMsgDialog();\na.setMessage(ZmMsg.apptOutOfDate,DwtMessageDialog.INFO_STYLE);\na.popup();\nreturn true\n}return false\n};\nZmTaskMgr.prototype.getQuickReminderSearchTimeRange=function(){var c=new Date();\nc.setHours(23,59,59,999);\nvar a=new Date(c.getTime());\nvar b=c;\nb.setHours(0,0,0,0);\nreturn{start:b.getTime(),end:a.getTime()}\n};\nZmTaskMgr.prototype.showQuickReminder=function(){var a=this.getQuickReminderParams();\nthis.getApptSummaries(a)\n};\nZmTaskMgr.prototype.getQuickReminderParams=function(){var a=this.getQuickReminderSearchTimeRange();\nreturn{start:a.start,end:a.end,fanoutAllDay:false,folderIds:this.getCheckedCalendarFolderIds(true),callback:(new AjxCallback(this,this._quickReminderCallback)),includeReminders:true}\n};\nZmTaskMgr.prototype._quickReminderCallback=function(h){var d=new AjxVector();\nthis._cacheMap={};\nvar k=h.size();\nvar c=(new Date()).getTime();\nfor(var g=0;\ng<k;\ng++){var a=h.get(g);\nvar b=a.id;\nif(!this._cacheMap[b]){this._cacheMap[b]=a;\nif(a.isAllDayEvent()){continue\n}var j=a.getStartTime()-c;\nvar f=(j>=0&&j<=AjxDateUtil.MSEC_PER_HOUR);\nif((c>=a.getStartTime()&&c<=a.getEndTime())||f){a.isUpcomingEvent=f;\nd.add(a)\n}}}var e=this.getQuickReminderDialog();\ne.initialize(d);\ne.popup()\n};\nZmTaskMgr.prototype.getQuickReminderDialog=function(){if(this._reminderDialog==null){this._reminderDialog=new ZmQuickReminderDialog(appCtxt.getShell(),this,this._calController)\n}return this._reminderDialog\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmMiniCalCache\")){ZmMiniCalCache=function(a){this._calViewController=a;\nthis.clearCache()\n};\nZmMiniCalCache.prototype.toString=function(){return\"ZmMiniCalCache\"\n};\nZmMiniCalCache.prototype.clearCache=function(){this._miniCalData={}\n};\nZmMiniCalCache.prototype.updateCache=function(c,b){var a=this._getCacheKey(c);\nthis._miniCalData[a]=b\n};\nZmMiniCalCache.prototype._getCacheKey=function(b){var a=[];\na=a.concat(b.folderIds);\na.sort();\nreturn(b.start+\":\"+b.end+\":\"+a.join(\":\"))\n};\nZmMiniCalCache.prototype._getMiniCalData=function(d){var c=this._getCacheKey(d);\nvar b=this._miniCalData[c];\nif(b){this.highlightMiniCal(b);\nif(d.callback){d.callback.run(b);\nreturn\n}return b\n}var e={GetMiniCalRequest:{_jsns:\"urn:zimbraMail\"}};\nvar a=e.GetMiniCalRequest;\nthis._setSoapParams(a,d);\nappCtxt.getAppController().sendRequest({jsonObj:e,asyncMode:true,offlineCache:true,callback:(new AjxCallback(this,this._getMiniCalResponse,[d])),errorCallback:(new AjxCallback(this,this._handleMiniCalResponseError,[d])),offlineCallback:this._getMiniCalOfflineResponse.bind(this,d),noBusyOverlay:d.noBusyOverlay,accountName:(appCtxt.multiAccounts?appCtxt.accountList.mainAccount.name:null)})\n};\nZmMiniCalCache.prototype.getCacheData=function(c){var b=this._getCacheKey(c);\nvar a=this._miniCalData[b];\nif(a){return a\n}};\nZmMiniCalCache.prototype._handleMiniCalResponseError=function(e,a){var c=a?a.code:null;\nif(c==ZmCsfeException.ACCT_NO_SUCH_ACCOUNT||c==ZmCsfeException.MAIL_NO_SUCH_MOUNTPOINT){var d=(a&&a.data)?a.data:null;\nvar f=(d&&d.itemId&&(d.itemId.length>0))?d.itemId[0]:null;\nif(f&&appCtxt.getById(f)&&this._faultHandler){var b=appCtxt.getById(f);\nb.noSuchFolder=true;\nthis._faultHandler.run(b);\nreturn true\n}}if(e.callback){e.callback.run([])\n}return true\n};\nZmMiniCalCache.prototype._setSoapParams=function(d,e){d.s=e.start;\nd.e=e.end;\nd.tz=e.tz;\nvar a=null;\nif(e.folderIds&&e.folderIds.length){d.folder=[];\nfor(var b=0;\nb<e.folderIds.length;\nb++){d.folder.push({id:e.folderIds[b]})\n}}if(e.tz){d.tz=[];\nvar c=AjxTimezone.getRule(e.tz);\nd.tz.push({id:e.tz,stdoff:c?c.standard.offset:0})\n}};\nZmMiniCalCache.prototype.setFaultHandler=function(a){this._faultHandler=a\n};\nZmMiniCalCache.prototype._getMiniCalResponse=function(b,j){var d=[];\nif(!j){return d\n}var h=b.callback;\nvar c=j&&j._data&&j._data;\nvar f=c.GetMiniCalResponse;\nif(f&&f.date){var a=f.date;\nif(a){for(var e=0;\ne<a.length;\ne++){if(a[e]._content){d.push(a[e]._content)\n}}}this.highlightMiniCal(d)\n}else{this.highlightMiniCal([])\n}var g=(f&&f.error);\nthis.handleError(g);\nthis.updateCache(b,d);\nif(b.callback){b.callback.run(d);\nreturn\n}return d\n};\nZmMiniCalCache.prototype._getMiniCalOfflineResponse=function(f){var g=appCtxt.getCalManager();\nvar b=g&&g.getCalViewController();\nif(b){var c=b.getApptCache();\nif(c){var e=b.getMainAccountCheckedCalendarIds();\nvar d={folderIds:e,start:f.start,end:f.end};\nvar a=c.setSearchParams(d);\nif(a){c.processOfflineMiniCal(f,a)\n}else{c.offlineSearchAppts(d,f,null)\n}}}};\nZmMiniCalCache.prototype.processBatchResponse=function(d,c){if(!d){return\n}for(var b=0;\nb<d.length;\nb++){var e=(d[b]&&d[b].date);\nif(e){for(var a=0;\na<e.length;\na++){if(e[a]._content){c.push(e[a]._content)\n}}}var f=(d[b]&&d[b].error);\nthis.handleError(f)\n}};\nZmMiniCalCache.prototype.handleError=function(d){if(d&&d.length){for(var a=0;\na<d.length;\na++){if(d[a].code==ZmCsfeException.MAIL_NO_SUCH_FOLDER||d[a].code==ZmCsfeException.MAIL_NO_SUCH_MOUNTPOINT||d[a].code==ZmCsfeException.ACCT_NO_SUCH_ACCOUNT||d[a].code==ZmCsfeException.SVC_PERM_DENIED){var c=d[a].id;\nif(c&&appCtxt.getById(c)){var b=appCtxt.getById(c);\nb.noSuchFolder=true\n}}}}};\nZmMiniCalCache.prototype.highlightMiniCal=function(c){var a={};\nfor(var b=0;\nb<c.length;\nb++){if(c[b]){a[c[b]]=AjxDateFormat.parse(\"yyyyMMdd\",c[b])\n}}if(this._calViewController&&this._calViewController._miniCalendar){this._calViewController._miniCalendar.setHilite(a,true,true)\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.controller.ZmSnoozeBeforeProcessor\")){ZmSnoozeBeforeProcessor=function(a){this._apptType=a\n};\nZmSnoozeBeforeProcessor.prototype.constructor=ZmSnoozeBeforeProcessor;\nZmSnoozeBeforeProcessor.prototype.execute=function(m,f,k){var o=false;\nvar h;\nvar j=0;\nvar c=[];\nvar p;\nvar b=(new Date()).getTime();\nfor(var l=0;\nl<m.size();\nl++){var a=m.get(l);\nvar n=a.getAlarmInstStart();\nvar g=f;\nif(n<=b){c.push(a)\n}else{g=-g;\nh=n+g;\nfor(var e=0;\ne<ZmReminderDialog.SNOOZE_MSEC.length;\ne++){if((h>=b)||(g>=0)){break\n}g=ZmReminderDialog.SNOOZE_MSEC[e];\nh=n+g\n}if(g<0){var d={id:a.id,until:h};\nk.push(d);\no=true;\nif((j==0)||(j>h)){j=h\n}}}}if(o){for(var l=0;\nl<c.length;\nl++){var d={id:c[l].id,until:j};\nk.push(d)\n}}return o\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.controller.ZmReminderController\")){ZmReminderController=function(a,b){this._calController=a;\nthis._apptType=b;\nthis._apptState={};\nthis._cacheMap={};\nthis._cachedAppts=new AjxVector();\nthis._activeAppts=new AjxVector();\nthis._oldAppts=new AjxVector();\nthis._housekeepingTimedAction=new AjxTimedAction(this,this._housekeepingAction);\nthis._refreshTimedAction=new AjxTimedAction(this,this.refresh)\n};\nZmReminderController.prototype.constructor=ZmReminderController;\nZmReminderController._STATE_ACTIVE=1;\nZmReminderController._STATE_DISMISSED=2;\nZmReminderController._STATE_SNOOZED=3;\nZmReminderController._CACHE_RANGE=24;\nZmReminderController._CACHE_REFRESH=16;\nZmReminderController.prototype.toString=function(){return\"ZmReminderController\"\n};\nZmReminderController.prototype.refresh=function(c){this._searchTimeRange=this.getSearchTimeRange();\ntry{var b=this.getRefreshParams()\n}catch(a){if(c==null&&c!=0){c=3\n}if(c){setTimeout(this.refresh.bind(this,--c),1000);\nreturn\n}return\n}this._calController.getApptSummaries(b);\nif(this._refreshActionId){AjxTimedAction.cancelAction(this._refreshActionId)\n}this._refreshActionId=AjxTimedAction.scheduleAction(this._refreshTimedAction,(AjxDateUtil.MSEC_PER_HOUR*ZmReminderController._CACHE_REFRESH))\n};\nZmReminderController.prototype.getSearchTimeRange=function(){var c=new Date();\nc.setHours(23,59,59,999);\nvar a=new Date(c.getTime());\nc.setDate(c.getDate()-7);\nvar b=c;\nb.setHours(0,0,0,0);\nreturn{start:b.getTime(),end:a.getTime()}\n};\nZmReminderController.prototype.getRefreshParams=function(){var a=this.getSearchTimeRange();\nreturn{start:a.start,end:a.end,fanoutAllDay:false,folderIds:this._apptType==\"appt\"?this._calController.getReminderCalendarFolderIds():this._calController.getCheckedCalendarFolderIds(true),callback:(new AjxCallback(this,this._refreshCallback)),includeReminders:true}\n};\nZmReminderController.prototype._cancelRefreshAction=function(){if(this._refreshActionId){AjxTimedAction.cancelAction(this._refreshActionId);\ndelete this._refreshActionId\n}};\nZmReminderController.prototype._cancelHousekeepingAction=function(){if(this._houseKeepingActionId){AjxTimedAction.cancelAction(this._housekeepingActionId);\ndelete this._houseKeepingActionId\n}};\nZmReminderController.prototype._scheduleHouseKeepingAction=function(){this._cancelHousekeepingAction();\nthis._housekeepingActionId=AjxTimedAction.scheduleAction(this._housekeepingTimedAction,60*1000)\n};\nZmReminderController.prototype._refreshCallback=function(f){if(this._refreshDelay>0){AjxTimedAction.scheduleAction(new AjxTimedAction(this,this._refreshCallback,[f]),this._refreshDelay);\nthis._refreshDelay=0;\nreturn\n}if(f instanceof ZmCsfeException){this._calController._handleError(f,new AjxCallback(this,this._maintErrorHandler));\nreturn\n}var c=new AjxVector();\nthis._cacheMap={};\nvar b=f.size();\nfor(var a=0;\na<b;\na++){var d=f.get(a);\nvar h=d.id;\nvar e=d.recurring?d.isAlarmInstance():d.hasAlarmData();\nif(e){var g=d.getAlarmData();\ng=(g&&g.length>0)?g[0]:{};\nAjxDebug.println(AjxDebug.REMINDER,d.name+\" :: \"+d.startDate+\" :: \"+d.endDate+\" :: \"+d.recurring+\" :: \"+d.isException+\" :: \"+g.nextAlarm+\" :: \"+g.alarmInstStart);\nif(!this._cacheMap[h]){this._cacheMap[h]=true;\nc.add(d)\n}}}this._cachedAppts=c.clone();\nthis._cachedAppts.sort(ZmCalBaseItem.compareByTimeAndDuration);\nthis._activeAppts.removeAll();\nthis._cancelHousekeepingAction();\nthis._housekeepingAction()\n};\nZmReminderController.prototype.updateCache=function(e){if(!e){return\n}if(!this._cachedAppts){this._cachedAppts=new AjxVector()\n}AjxDebug.println(AjxDebug.REMINDER,\"updating reminder cache...\");\nvar g=this.getSearchTimeRange();\nvar d=0;\nvar b=e.size();\nfor(var a=0;\na<b;\na++){var c=e.get(a);\nvar f=c.id;\nif(c.hasAlarmData()&&!this._cacheMap[f]&&c.isStartInRange(g.start,g.end)){this._cacheMap[f]=true;\nthis._cachedAppts.add(c);\nd++\n}}AjxDebug.println(AjxDebug.REMINDER,\"new appts added to reminder cache :\"+d)\n};\nZmReminderController.prototype.isApptSnoozed=function(a){return(this._apptState[a]==ZmReminderController._STATE_SNOOZED)\n};\nZmReminderController.prototype._housekeepingAction=function(){AjxDebug.println(AjxDebug.REMINDER,\"reminder house keeping action...\");\nvar m=this.getReminderDialog();\nif(ZmCsfeCommand.noAuth){AjxDebug.println(AjxDebug.REMINDER,\"reminder check: no auth token, bailing\");\nif(m&&m.isPoppedUp()){m.popdown()\n}return\n}if(this._searchTimeRange){var j=this.getSearchTimeRange();\nvar l=j.end-this._searchTimeRange.end;\nif(l>AjxDateUtil.MSEC_PER_HOUR){AjxDebug.println(AjxDebug.REMINDER,\"time elapsed - refreshing reminder cache\");\nthis._searchTimeRange=null;\nthis.refresh();\nreturn\n}}var b=this._cachedAppts.size();\nvar g=this._activeAppts.size();\nif(b==0&&g==0){AjxDebug.println(AjxDebug.REMINDER,\"no appts - empty cached and active list\");\nthis._scheduleHouseKeepingAction();\nreturn\n}var k=0;\nvar d=[];\nfor(var f=0;\nf<b;\nf++){var a=this._cachedAppts.get(f);\nif(!a||a.ptst==ZmCalBaseItem.PSTATUS_DECLINED){d.push(a)\n}else{if(a.isAlarmInRange()){var h=a.getUniqueId(true);\nvar c=this._apptState[h];\nvar e=false;\nif(c==ZmReminderController._STATE_DISMISSED){}else{if(c==ZmReminderController._STATE_ACTIVE){e=true\n}else{k++;\ne=true;\nthis._apptState[h]=ZmReminderController._STATE_ACTIVE\n}}if(e){d.push(a);\nif(!appCtxt.get(ZmSetting.CAL_SHOW_PAST_DUE_REMINDERS)&&a.isAlarmOld()){k--;\nthis._oldAppts.add(a)\n}else{this._activeAppts.add(a)\n}}}}}for(var f=0;\nf<d.length;\nf++){this._cachedAppts.remove(d[f])\n}if(k||m.isPoppedUp()){if(this._activeAppts.size()==0&&m.isPoppedUp()){AjxDebug.println(AjxDebug.REMINDER,\"popping down reminder dialog\");\nm.popdown()\n}else{AjxDebug.println(AjxDebug.REMINDER,\"initializing reminder dialog\");\nm.initialize(this._activeAppts);\nif(!m.isPoppedUp()){m.popup()\n}}}AjxDebug.println(AjxDebug.REMINDER,\"no of appts active:\"+this._activeAppts.size()+\", no of appts cached:\"+b);\nif(this._oldAppts.size()>0){this.dismissAppt(this._oldAppts,new AjxCallback(this,this._silentDismissCallback))\n}this._scheduleHouseKeepingAction()\n};\nZmReminderController.prototype._silentDismissCallback=function(d){var b=d.size();\nfor(var a=0;\na<b;\na++){var c=d.get(a);\nif(c&&c.hasAlarmData()){if(c.isAlarmInRange()){this._activeAppts.add(c)\n}}}this._oldAppts.removeAll();\nthis._cancelHousekeepingAction();\nthis._housekeepingAction()\n};\nZmReminderController.prototype.dismissAppt=function(c,d){if(!(c instanceof AjxVector)){c=AjxVector.fromArray((c instanceof Array)?c:[c])\n}for(var a=0;\na<c.size();\na++){var b=c.get(a);\nthis._apptState[b.getUniqueId(true)]=ZmReminderController._STATE_DISMISSED;\nthis._activeAppts.remove(b)\n}this.dismissApptRequest(c,d)\n};\nZmReminderController.prototype.snoozeAppt=function(a){a=AjxUtil.toArray(a);\nvar d=[];\nvar e;\nvar c;\nfor(var b=0;\nb<a.length;\nb++){e=a[b];\nc=e.getUniqueId(true);\nthis._apptState[c]=ZmReminderController._STATE_SNOOZED;\nd.push(c);\nthis._activeAppts.remove(e);\nthis._cachedAppts.add(e)\n}return d\n};\nZmReminderController.prototype.dismissApptRequest=function(k,l){var n={DismissCalendarItemAlarmRequest:{_jsns:\"urn:zimbraMail\"}};\nvar g=n.DismissCalendarItemAlarmRequest;\nvar f=[];\nvar d=(new Date()).getTime();\nfor(var h=0;\nh<k.size();\nh++){var a=k.get(h);\nvar c={id:a.id,dismissedAt:d};\nf.push(c)\n}g[this._apptType]=f;\nvar m=this._handleDismissAppt.bind(this,k,l);\nvar b=this._handleOfflineReminderAction.bind(this,n,k,true);\nvar j=this._handleErrorDismissAppt.bind(this,k,l);\nvar e={jsonObj:n,asyncMode:true,callback:m,offlineCallback:b,errorCallback:j};\nappCtxt.getAppController().sendRequest(e);\nreturn true\n};\nZmReminderController.prototype.setAlarmData=function(a,b,d){var c=a.set(\"alarmData\",null,b);\nc.setAttribute(\"\")\n};\nZmReminderController.prototype._handleDismissAppt=function(e,f,a){if(a.isException()){return\n}var c=a.getResponse();\nvar d=c.DismissCalendarItemAlarmResponse;\nvar b=d?d.appt:null;\nif(!b){return\n}this._updateApptAlarmData(e,b);\nif(f){f.run(e)\n}};\nZmReminderController.prototype._handleErrorDismissAppt=function(b,c,a){};\nZmReminderController.prototype._updateApptAlarmData=function(a,b){var c={};\nfor(var e=0;\ne<b.length;\ne++){var f=b[e];\nif(f&&f.calItemId){c[f.calItemId]=f.alarmData?f.alarmData:{}\n}}var d=a.size();\nfor(var e=0;\ne<d;\ne++){var f=a.get(e);\nif(f){if(c[f.id]){f.alarmData=(c[f.id]!={})?c[f.id]:null\n}}}};\nZmReminderController.prototype.getReminderDialog=function(){if(this._reminderDialog==null){this._reminderDialog=new ZmReminderDialog(appCtxt.getShell(),this,this._calController,this._apptType)\n}return this._reminderDialog\n};\nZmReminderController.prototype._snoozeApptAction=function(n,k,l){var m=AjxVector.fromArray(n);\nvar d=k*60*1000;\nvar o=false;\nvar r={SnoozeCalendarItemAlarmRequest:{_jsns:\"urn:zimbraMail\"}};\nvar g=r.SnoozeCalendarItemAlarmRequest;\nvar f=[];\nif(l){if(!this._beforeProcessor){this._beforeProcessor=new ZmSnoozeBeforeProcessor(this._apptType)\n}o=this._beforeProcessor.execute(m,d,f)\n}else{o=m.size()>0;\nvar e=(new Date()).getTime()+d;\nfor(var h=0;\nh<m.size();\nh++){var a=m.get(h);\nif(d===0){e=a.getStartTime()\n}var c={id:a.id,until:e};\nf.push(c)\n}}g[this._apptType]=f;\nvar q=this._handleResponseSnoozeAction.bind(this,m,k);\nvar b=this._handleOfflineReminderAction.bind(this,r,m,false);\nvar j=this._handleErrorResponseSnoozeAction.bind(this);\nvar p=window.parentAppCtxt||window.appCtxt;\np.getRequestMgr().sendRequest({jsonObj:r,asyncMode:true,callback:q,offlineCallback:b,errorCallback:j})\n};\nZmReminderController.prototype._handleResponseSnoozeAction=function(b,e,a){if(a.isException()){return\n}var d=a.getResponse();\nvar f=d.SnoozeCalendarItemAlarmResponse;\nvar c=f?f[this._apptType]:null;\nif(!c){return\n}this._updateApptAlarmData(b,c);\nif(e==1){this._cancelHousekeepingAction();\nthis._scheduleHouseKeepingAction()\n}};\nZmReminderController.prototype._handleErrorResponseSnoozeAction=function(a){};\nZmReminderController.prototype._handleOfflineReminderAction=function(g,a,c){var f=$.extend(true,{},g);\nvar b=c?\"DismissCalendarItemAlarmRequest\":\"SnoozeCalendarItemAlarmRequest\";\nf.methodName=b;\nf.id=\"C\"+this._createSendRequestKey(a);\nvar d={update:true,methodName:b,id:f.id,value:f};\nvar e=this._handleOfflineReminderDBCallback.bind(this,f,a,c);\nZmOfflineDB.setItemInRequestQueue(d,e)\n};\nZmReminderController.prototype._createSendRequestKey=function(a){var c=[];\nvar d;\nfor(var b=0;\nb<a.size();\nb++){d=a.get(b);\nif(d){c.push(a.get(b).invId)\n}}return c.join(\":\")\n};\nZmReminderController.prototype._handleOfflineReminderDBCallback=function(l,h,j){var f=l[l.methodName];\nvar e=f[this._apptType];\nvar k;\nvar a;\nvar b=this._calController.getApptCache();\nfor(var g=0;\ng<h.size();\ng++){a=h.get(g);\nif(a){var c=e[g];\nk=this._updateOfflineAlarmCallback.bind(this,a,j,c.until);\nvar d=[];\nd.push({nextAlarm:c.until});\nb.updateOfflineAppt(a.invId,\"alarmData.0.nextAlarm\",c.until,d,k)\n}}};\nZmReminderController.prototype._updateOfflineAlarmCallback=function(c,b,a,e,d){if(b){c.alarmData=null\n}else{c.alarmData[0].nextAlarm=a\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmReminderDialog\")){ZmReminderDialog=function(b,c,a,d){this._apptType=d;\nthis.ALL_APPTS=\"ALL\"+d;\nDwtDialog.call(this,{id:\"ZmReminderDialog_\"+d,parent:b,standardButtons:DwtDialog.NO_BUTTONS});\nthis._reminderController=c;\nthis._calController=a;\nthis._listId=Dwt.getNextId(\"ZmReminderDialogContent\");\nthis.setContent(this._contentHtml());\nif(this._calController instanceof ZmTaskMgr){this.setTitle(ZmMsg.taskReminders)\n}else{this.setTitle(ZmMsg.apptReminders)\n}this.getTabGroupMember().addMember(this._compositeTabGroup)\n};\nZmReminderDialog.prototype=new DwtDialog;\nZmReminderDialog.prototype.constructor=ZmReminderDialog;\nZmReminderDialog.prototype.role=\"alertdialog\";\nZmReminderDialog.SOON=-AjxDateUtil.MSEC_PER_FIFTEEN_MINUTES;\nZmReminderDialog.prototype.toString=function(){return\"ZmReminderDialog\"\n};\nZmReminderDialog.prototype.popup=function(){DwtDialog.prototype.popup.call(this);\nthis._cancelSnooze();\nif(appCtxt.get(ZmSetting.CAL_REMINDER_NOTIFY_BROWSER)){AjxPackage.require(\"Alert\");\nZmBrowserAlert.getInstance().start(ZmMsg.reminders)\n}if(appCtxt.get(ZmSetting.CAL_REMINDER_NOTIFY_SOUNDS)){AjxPackage.require(\"Alert\");\nZmSoundAlert.getInstance().start()\n}if(appCtxt.get(ZmSetting.CAL_REMINDER_NOTIFY_TOASTER)){AjxPackage.require(\"Alert\");\nvar e=[];\nvar a=this._list.getArray();\nfor(var b=0;\nb<a.length&&b<5;\nb++){var d=a[b];\nvar c=this._computeDelta(d);\nvar g=c?ZmReminderDialog.formatDeltaString(c,d.isAllDayEvent()):\"\";\nvar f=[d.getName(),\", \",this._getDurationText(d),\"\\n(\",g,\")\"].join(\"\");\nif(AjxEnv.isMac){ZmDesktopAlert.getInstance().start(ZmMsg.reminders,f,true)\n}else{if(AjxEnv.isWindows){e.push(f)\n}}}if(AjxEnv.isWindows&&e.length>0){if(a.length>5){e.push(ZmMsg.andMore)\n}ZmDesktopAlert.getInstance().start(ZmMsg.reminders,e.join(\"\\n\"),true)\n}}this._snoozeSelectInputs[this.ALL_APPTS].focus()\n};\nZmReminderDialog.prototype.initialize=function(l){this._list=new AjxVector();\nthis._apptData={};\nvar j=[];\nvar n=0;\nvar q=l.size();\nAjxDebug.println(AjxDebug.REMINDER,\"---Reminders [\"+(new Date().getTime())+\"]---\");\nj[n++]=\"<table style='min-width:375px'>\";\nfor(var h=0;\nh<q;\nh++){var a=l.get(h);\nif(a.isShared()&&a.isReadOnly()){continue\n}this._list.add(a);\nvar k=a.getUniqueId(true);\nvar g=this._apptData[k]={appt:a};\nn=this._addAppt(j,n,a,g)\n}j[n++]=\"</table>\";\nthis._addAllSection(j,n);\nthis._cleanupButtons(this._dismissButtons);\nthis._cleanupButtons(this._openButtons);\nthis._cleanupButtons(this._snoozeButtons);\nthis._cleanupButtons(this._snoozeSelectButtons);\nthis._cleanupButtons(this._snoozeSelectInputs);\nthis._dismissButtons={};\nthis._openButtons={};\nthis._snoozeButtons={};\nthis._snoozeSelectButtons={};\nthis._snoozeSelectInputs={};\nvar d=new AjxListener(this,this._dismissButtonListener);\nvar p=new AjxListener(this,this._openButtonListener);\nvar m=this._snoozeButtonListener.bind(this);\nvar o=this._snoozeSelectButtonListener.bind(this);\nvar e=this._snoozeSelectMenuListener.bind(this);\nvar b=document.getElementById(this._listId);\nb.innerHTML=j.join(\"\");\nfor(var h=0;\nh<this._list.size();\nh++){var a=this._list.get(h);\nvar k=a.getUniqueId(true);\nvar c=a.id;\nvar g=this._apptData[k];\nvar f=a.getAlarmData();\nf=(f&&f.length>0)?f[0]:{};\nAjxDebug.println(AjxDebug.REMINDER,a.getReminderName()+\" : \"+(f.nextAlarm||\" NA \")+\" / \"+(f.alarmInstStart||\" NA \"));\nthis._createButtons(k,c,d,p,m,o,e);\nthis._updateDelta(g)\n}this._createButtons(this.ALL_APPTS,this.ALL_APPTS,d,p,m,o,e);\nthis._updateIndividualSnoozeActionsVisibility();\ndocument.getElementById(this._htmlElId+\"_buttonsSep\").style.display=\"none\"\n};\nZmReminderDialog.prototype._createButtons=function(l,c,d,r,n,q,e){var j=this._apptData[l];\nvar a=j.appt;\nif(l!==this.ALL_APPTS){var g=this._openButtons[l]=new DwtLinkButton({id:\"openBtn_\"+c,parent:this,parentElement:j.openLinkId,noDropDown:true});\ng.setText(AjxStringUtil.htmlEncode(a.getReminderName()));\ng.addSelectionListener(r);\ng.setAttribute(\"aria-labelledby\",[g._textEl.id,j.reminderDescContainerId,j.deltaId].join(\" \"));\ng.apptUid=l;\nthis.getTabGroupMember().addMember(g)\n}var m=l===this.ALL_APPTS?\"ZButton\":\"DwtToolbarButton\";\nvar f={parent:this,parentElement:j.snoozeSelectInputId,type:DwtInputField.STRING,errorIconStyle:DwtInputField.ERROR_ICON_NONE,validationStyle:DwtInputField.CONTINUAL_VALIDATION,className:\"DwtInputField ReminderInput\"};\nvar o=this._snoozeSelectInputs[l]=new DwtInputField(f);\nvar p=o.getInputElement();\nDwt.setSize(p,\"120px\",\"2rem\");\np.setAttribute(\"aria-labelledby\",j.snoozeAllLabelId||\"\");\nvar b=this._snoozeSelectButtons[l]=new DwtButton({id:\"snoozeSelectBtn_\"+c,parent:this,className:\"DwtToolbarButton\",parentElement:j.snoozeSelectBtnId});\nb.apptUid=l;\nb.addDropDownSelectionListener(q);\nvar h=this._snoozeButtons[l]=new DwtButton({id:\"snoozeBtn_\"+c,parent:this,className:m,parentElement:j.snoozeBtnId});\nh.setText(ZmMsg.snooze);\nh.addSelectionListener(n);\nh.apptUid=l;\nvar k=this._dismissButtons[l]=new DwtButton({id:\"dismissBtn_\"+c,parent:this,className:m,parentElement:j.dismissBtnId});\nk.setText(ZmMsg.dismiss);\nk.addSelectionListener(d);\nk.apptUid=l;\nthis._createSnoozeMenu(b,o,e,l===this.ALL_APPTS?this._list:a)\n};\nZmReminderDialog.prototype._cleanupButtons=function(a){if(!a){return\n}for(var b in a){a[b].dispose()\n}};\nZmReminderDialog.prototype._contentHtml=function(){return[\"<div class='ZmReminderDialog' id='\",this._listId,\"'>\"].join(\"\")\n};\nZmReminderDialog.DEFAULT_SNOOZE=-5;\nZmReminderDialog.SNOOZE_MINUTES=[-30,-15,-5,-1,0,\"seperator\",1,5,10,15,30,45,60,120,240,480,1440,2880,4320,5760,10080,20160];\nZmReminderDialog.SNOOZE_MSEC=[-30*60*1000,-15*60*1000,-5*60*1000,-1*60*1000,0,1*60*1000,5*60*1000,10*60*1000,15*60*1000,30*60*1000,45*60*1000,60*60*1000,120*60*1000,240*60*1000,480*60*1000,1440*60*1000,2880*60*1000,4320*60*1000,5760*60*1000,10080*60*1000,20160*60*1000];\nZmReminderDialog.SCALE_MINUTES=[1,60,1440,10080,1000000];\nZmReminderDialog.prototype._createSnoozeMenu=function(v,h,m,l){var t=new DwtMenu({parent:v,style:DwtMenu.DROPDOWN_STYLE});\nt.setSize(\"150\");\nv.setMenu(t,true);\nvar k=AjxUtil.toArray(l);\nvar o=-Infinity;\nif(this._apptType==\"task\"){o=0\n}else{for(var q=0;\nq<k.length;\nq++){var b=k[q];\nvar s=this._computeDelta(b);\no=Math.max(s,o)\n}o=Math.min(o,0)\n}var n=[];\nvar d=new AjxMessageFormat(ZmMsg.apptRemindNMinutesBefore);\nn[0]=new AjxMessageFormat(ZmMsg.reminderSnoozeMinutes);\nn[1]=new AjxMessageFormat(ZmMsg.reminderSnoozeHours);\nn[2]=new AjxMessageFormat(ZmMsg.reminderSnoozeDays);\nn[3]=new AjxMessageFormat(ZmMsg.reminderSnoozeWeeks);\nvar f=0;\nvar p=null;\nvar r=-1;\nvar w=1;\nvar e=false;\nvar a=null;\nvar c=false;\nvar g=false;\nfor(var q=0;\nq<ZmReminderDialog.SNOOZE_MINUTES.length;\nq++){if(ZmReminderDialog.SNOOZE_MSEC[q]>o){r=ZmReminderDialog.SNOOZE_MINUTES[q];\nif(r==\"seperator\"){c=g\n}else{if(c){new DwtMenuItem({parent:t,style:DwtMenuItem.SEPARATOR_STYLE});\nc=false\n}g=true;\nif(r<0){r=-r;\np=d;\nw=1\n}else{if(r==0){j=ZmMsg.apptRemindAtEventTime\n}else{if(r>=ZmReminderDialog.SCALE_MINUTES[f+1]){f++\n}w=ZmReminderDialog.SCALE_MINUTES[f];\np=n[f]\n}}if(r!=0){var j=p.format(r/w)\n}var u=new DwtMenuItem({parent:t,style:DwtMenuItem.NO_STYLE});\nu.setText(j);\nu.setData(\"value\",r);\nif(m){u.addSelectionListener(m)\n}if(!a){a=u;\nu.setChecked(true);\nh.setValue(j);\ne=true\n}}}}};\nZmReminderDialog.prototype._snoozeSelectButtonListener=function(a){a.item.popup()\n};\nZmReminderDialog.prototype._snoozeSelectMenuListener=function(b){if(!b.item||!(b.item instanceof DwtMenuItem)){return\n}var d=DwtControl.getTargetControl(b);\nd=d.parent.parent;\nvar a=d.apptUid;\nvar c=this._apptData[a];\nif(!c){return\n}this._snoozeSelectInputs[a].setValue(b.item.getText())\n};\nZmReminderDialog.prototype._updateDelta=function(b){var c=document.getElementById(b.deltaId);\nif(c){var a=this._computeDelta(b.appt);\nc.className=a>=0?\"ZmReminderOverdue\":a>ZmReminderDialog.SOON?\"ZmReminderSoon\":\"ZmReminderFuture\";\nc.innerHTML=a?ZmReminderDialog.formatDeltaString(a,b.appt.isAllDayEvent()):\"\"\n}};\nZmReminderDialog.prototype._updateIndividualSnoozeActionsVisibility=function(){var c=this._list.getArray();\nif(c.length===0){return\n}var l=c.length>1;\nfor(var f=0;\nf<c.length;\nf++){var a=c[f];\nvar h=a.getUniqueId(true);\nvar e=this._apptData[h];\nvar b=document.getElementById(e.actionsRowId);\nb.style.display=l?\"block\":\"none\"\n}var g=this._dismissButtons[this.ALL_APPTS];\ng.setText(l?ZmMsg.dismissAll:ZmMsg.dismiss);\nvar k=this._snoozeButtons[this.ALL_APPTS];\nk.setText(l?ZmMsg.snoozeAllLabel:ZmMsg.snooze);\nvar j=this._apptData[this.ALL_APPTS].snoozeAllLabelId;\nvar d=document.getElementById(j);\nd.innerHTML=l?ZmMsg.snoozeAll:ZmMsg.snoozeFor\n};\nZmReminderDialog.prototype._addAppt=function(c,a,d,e){var b=d.id;\nthis._addData(e,b);\nvar g=(d.folderId!=ZmOrganizer.ID_CALENDAR&&d.folderId!=ZmOrganizer.ID_TASKS&&this._calController)?this._calController.getCalendarName(d.folderId):null;\nvar f=appCtxt.getById(d.folderId);\nvar h={rowId:e.rowId,calName:AjxStringUtil.htmlEncode(g),accountName:(appCtxt.multiAccounts&&f&&f.getAccount().getDisplayName()),location:(AjxStringUtil.htmlEncode(d.getReminderLocation())),apptIconHtml:(AjxImg.getImageHtml(d.otherAttendees?\"ApptMeeting\":\"Appointment\")),organizer:d.otherAtt?d.organizer:null,reminderName:(AjxStringUtil.htmlEncode(d.getReminderName())),durationText:(AjxStringUtil.trim(this._getDurationText(d))),deltaId:e.deltaId,openLinkId:e.openLinkId,dismissBtnId:e.dismissBtnId,snoozeSelectInputId:e.snoozeSelectInputId,snoozeSelectBtnId:e.snoozeSelectBtnId,snoozeBtnId:e.snoozeBtnId,actionsRowId:e.actionsRowId,reminderNameContainerId:e.reminderNameContainerId,reminderDescContainerId:e.reminderDescContainerId,type:d.type?d.type:ZmItem.APPT};\nc[a++]=AjxTemplate.expand(\"calendar.Calendar#ReminderDialogRow\",h);\nreturn a\n};\nZmReminderDialog.prototype._addAllSection=function(c,a){var b=this.ALL_APPTS;\nvar d=this._apptData[b]={};\nthis._addData(d,b);\nd.snoozeAllLabelId=\"snoozeAllLabelContainerId_\"+b;\nvar e={rowId:d.rowId,dismissBtnId:d.dismissBtnId,snoozeSelectInputId:d.snoozeSelectInputId,snoozeSelectBtnId:d.snoozeSelectBtnId,snoozeBtnId:d.snoozeBtnId,snoozeAllLabelId:d.snoozeAllLabelId};\nc[a++]=AjxTemplate.expand(\"calendar.Calendar#ReminderDialogAllSection\",e);\nreturn a\n};\nZmReminderDialog.prototype._addData=function(b,a){b.dismissBtnId=\"dismissBtnContainer_\"+a;\nb.snoozeSelectInputId=\"snoozeSelectInputContainer_\"+a;\nb.snoozeSelectBtnId=\"snoozeSelectBtnContainer_\"+a;\nb.snoozeBtnId=\"snoozeBtnContainer_\"+a;\nb.openLinkId=\"openLinkContainer_\"+a;\nb.actionsRowId=\"actionsRowContainer_\"+a;\nb.deltaId=\"delta_\"+a;\nb.rowId=\"apptRow_\"+a;\nb.reminderNameContainerId=\"reminderNameContainerId_\"+a;\nb.reminderDescContainerId=\"reminderDescContainerId_\"+a\n};\nZmReminderDialog.prototype._openButtonListener=function(l){appCtxt.getAppController().setStatusMsg(ZmMsg.allRemindersAreSnoozed,ZmStatusView.LEVEL_INFO);\nvar d=DwtControl.getTargetControl(l);\nvar e=this._apptData[d.apptUid];\nthis._snoozeButtonListener(null,true);\nvar a=e?e.appt:null;\nvar j=a.type?a.type:ZmItem.APPT;\nif(a&&j==ZmItem.APPT){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nvar b=AjxDispatcher.run(\"GetCalController\");\nvar h=new ZmAppt();\nfor(var f in a){if(!AjxUtil.isFunction(a[f])){h[f]=a[f]\n}}var g=h.isRecurring()?ZmCalItem.MODE_EDIT_SINGLE_INSTANCE:null;\nvar m=new AjxCallback(b,b._showAppointmentDetails,h);\nh.getDetails(g,m,null,null,true)\n}else{if(a&&j==ZmItem.TASK){AjxDispatcher.require([\"TasksCore\",\"Tasks\"]);\nvar c=AjxDispatcher.run(\"GetTaskListController\");\nvar k=new ZmTask();\nfor(var f in a){if(!AjxUtil.isFunction(a[f])){k[f]=a[f]\n}}var m=new AjxCallback(c,c._editTask,k);\nk.getDetails(null,m,null,null,true)\n}}};\nZmReminderDialog.prototype._dismissButtonListener=function(c){var e=DwtControl.getTargetControl(c);\nvar b=e.apptUid;\nvar d=this._apptData[b];\nif(!d){return\n}var a;\nif(b===this.ALL_APPTS){a=this._getApptsClone()\n}else{a=d.appt\n}this._reminderController.dismissAppt(a);\nthis._removeAppts(a)\n};\nZmReminderDialog.prototype._cleanupButton=function(c,b){var a=c[b];\nif(!a){return\n}a.dispose();\ndelete c[b]\n};\nZmReminderDialog.prototype._removeAppts=function(a){a=AjxUtil.toArray(a);\nfor(i=0;\ni<a.length;\ni++){this._removeAppt(a[i])\n}this._updateIndividualSnoozeActionsVisibility()\n};\nZmReminderDialog.prototype._removeAppt=function(c){var a=c.getUniqueId(true);\nvar d=this._apptData[a];\nthis._cleanupButton(this._dismissButtons,a);\nthis._cleanupButton(this._openButtons,a);\nthis._cleanupButton(this._snoozeButtons,a);\nthis._cleanupButton(this._snoozeSelectButtons,a);\nthis._cleanupButton(this._snoozeSelectInputs,a);\nvar e=document.getElementById(d.rowId);\nif(e){var b=e.nextSibling;\nif(b&&b.getAttribute(\"name\")===\"rdsep\"){b.parentNode.removeChild(b)\n}e.parentNode.removeChild(e)\n}delete this._apptData[a];\nthis._list.remove(c);\nif(this._list.size()===0){this._cleanupButton(this._dismissButtons,this.ALL_APPTS);\nthis._cleanupButton(this._snoozeButtons,this.ALL_APPTS);\nthis._cleanupButton(this._snoozeSelectButtons,this.ALL_APPTS);\nthis._cleanupButton(this._snoozeSelectInputs,this.ALL_APPTS);\nthis.popdown()\n}};\nZmReminderDialog.prototype._getApptsClone=function(){return this._list.getArray().slice(0)\n};\nZmReminderDialog.prototype._snoozeButtonListener=function(n,o){var g;\nvar l;\nvar e;\nif(o){l=this.ALL_APPTS;\ne=this._getApptsClone()\n}else{var f=DwtControl.getTargetControl(n);\nl=f.apptUid;\nif(l===this.ALL_APPTS){e=this._getApptsClone()\n}else{g=this._apptData[l];\ne=AjxUtil.toArray(g.appt)\n}}var c=this._snoozeSelectInputs[l].getValue();\nvar k=[];\nvar d=null;\nvar j=false;\nif(!c){k.push(ZmMsg.reminderSnoozeClickNoDuration)\n}else{d=ZmCalendarApp.parseReminderString(c);\nif(d.reminderValue===\"\"){k.push(ZmMsg.reminderSnoozeClickNoNumber)\n}else{var a=this._testSnoozeString(c);\nif(!a){k.push(ZmMsg.reminderSnoozeClickUnknownUnit)\n}else{j=d.before\n}}}if(k.length>0){var b=k.join(\"<br>\");\nvar m=appCtxt.getMsgDialog();\nm.reset();\nm.setMessage(b,DwtMessageDialog.WARNING_STYLE);\nm.popup();\nreturn\n}var h=ZmCalendarApp.convertReminderUnits(d.reminderValue,d.reminderUnits);\nthis._reminderController.snoozeAppt(e);\nthis._reminderController._snoozeApptAction(e,h,j);\nthis._removeAppts(e,true)\n};\nZmReminderDialog.prototype._testSnoozeString=function(d){var b=[];\nb[0]=AjxMsg.minute;\nb[1]=AjxMsg.hour;\nb[2]=AjxMsg.day;\nb[3]=AjxMsg.week;\nb[4]=AjxMsg.minutes;\nb[5]=AjxMsg.hours;\nb[6]=AjxMsg.days;\nb[7]=AjxMsg.weeks;\nb[8]=AjxMsg.atEventTime;\nd=d.toLowerCase();\nvar c=false;\nfor(var a=0;\na<b.length;\na++){if(d.indexOf(b[a].toLowerCase())>=0){c=true;\nbreak\n}}return c\n};\nZmReminderDialog.prototype._cancelSnooze=function(){if(this._snoozeActionId){AjxTimedAction.cancelAction(this._snoozeActionId);\ndelete this._snoozeActionId\n}};\nZmReminderDialog.prototype._getDurationText=function(c){var e=c.isMultiDay();\nvar f=c._alarmInstStart?new Date(c._alarmInstStart):c.startDate?c.startDate:null;\nvar b=c._alarmInstStart?(f.getTime()+c.getDuration()):c.getEndTime();\nvar a=new Date(b);\nif(c.type==ZmItem.TASK&&!f&&!b){return null\n}if(c.isAllDayEvent()){a=c.type!=ZmItem.TASK?new Date(b-(e?2*AjxDateUtil.MSEC_PER_HOUR:0)):a;\nvar d=e?ZmMsg.apptTimeAllDayMulti:ZmMsg.apptTimeAllDay;\nreturn f?AjxMessageFormat.format(d,[f,a]):AjxMessageFormat.format(d,[a])\n}var d=e?ZmMsg.apptTimeInstanceMulti:ZmMsg.apptTimeInstance;\nreturn AjxMessageFormat.format(d,[f,a,\"\"])\n};\nZmReminderDialog.prototype._computeDelta=function(d){var b=null;\nvar c=(new Date()).getTime();\nif(d.type===ZmItem.TASK){if(d.getEndTime()){b=c-d.getEndTime()\n}}else{if(!d.alarmData||d.alarmData.length===0){b=c-d.getStartTime()\n}else{var a=d.alarmData[0].alarmInstStart;\nif(a){b=c-d.adjustMS(a,d.tzo)\n}else{if(d.getEndTime()){b=c-d.getEndTime()\n}}}}return b\n};\nZmReminderDialog.formatDeltaString=function(e,h){if(e>0&&e<60000){return ZmMsg.reminderNow\n}var f=e<0?\"In\":\"OverdueBy\";\ne=Math.abs(e);\nvar g=0;\nvar b=0;\nvar m=0;\nvar k=0;\nvar a=0;\nvar d=0;\ng=Math.floor(e/(AjxDateUtil.MSEC_PER_DAY*365));\nif(g!==0){e-=g*AjxDateUtil.MSEC_PER_DAY*365\n}b=Math.floor(e/(AjxDateUtil.MSEC_PER_DAY*30.42));\nif(b>0){e-=Math.floor(b*AjxDateUtil.MSEC_PER_DAY*30.42)\n}m=Math.floor(e/AjxDateUtil.MSEC_PER_DAY);\nif(m>0){e-=m*AjxDateUtil.MSEC_PER_DAY\n}k=Math.floor(e/AjxDateUtil.MSEC_PER_HOUR);\nif(k>0){e-=k*AjxDateUtil.MSEC_PER_HOUR\n}a=Math.floor(e/60000);\nif(a>0){e-=a*60000\n}d=Math.floor(e/1000);\nif(d>30&&a<59){a++\n}d=0;\nvar c;\nif(g>0){c=\"Years\";\nif(g<=3&&b>0){c=\"YearsMonths\"\n}}else{if(b>0){c=\"Months\";\nif(b<=3&&m>0){c=\"MonthsDays\"\n}}else{if(m>0){c=\"Days\";\nif(!h&&(m<=2&&k>0)){c=\"DaysHours\"\n}}else{if(h){c=\"Today\"\n}else{if(k>0){c=\"Hours\";\nif(k<5&&a>0){c=\"HoursMinutes\"\n}}else{c=\"Minutes\"\n}}}}}var l=[\"reminder\",f,c].join(\"\");\nvar j=[e,g,b,m,k,a,d];\nif(c==\"Minutes\"&&a==0){return ZmMsg.reminderNow\n}return AjxMessageFormat.format(ZmMsg[l],j)\n};\nZmReminderDialog.prototype.handleKeyAction=function(a,b){switch(a){case DwtKeyMap.ENTER:this.notifyListeners(DwtEvent.ENTER,b);\nbreak;\ncase DwtKeyMap.CANCEL:break;\ncase DwtKeyMap.YES:if(this._buttonDesc[DwtDialog.YES_BUTTON]){this._runCallbackForButtonId(DwtDialog.YES_BUTTON)\n}break;\ncase DwtKeyMap.NO:if(this._buttonDesc[DwtDialog.NO_BUTTON]){this._runCallbackForButtonId(DwtDialog.NO_BUTTON)\n}break;\ndefault:return false\n}return true\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmQuickReminderDialog\")){ZmQuickReminderDialog=function(c,d,a){var b=Dwt.getNextId();\nDwtDialog.call(this,{parent:c,standardButtons:[DwtDialog.OK_BUTTON]});\nthis._reminderController=d;\nthis._calController=a;\nthis.setContent(this._contentHtml(b));\nthis.setTitle(ZmMsg.currentMeetings)\n};\nZmQuickReminderDialog.prototype=new DwtDialog;\nZmQuickReminderDialog.prototype.constructor=ZmQuickReminderDialog;\nZmQuickReminderDialog.SOON=-AjxDateUtil.MSEC_PER_FIFTEEN_MINUTES;\nZmQuickReminderDialog.prototype.toString=function(){return\"ZmQuickReminderDialog\"\n};\nZmQuickReminderDialog.prototype.popup=function(){DwtDialog.prototype.popup.call(this)\n};\nZmQuickReminderDialog.prototype.initialize=function(j){this._list=j.clone();\nthis._apptData={};\nvar g=[];\nvar k=0;\nvar m=j.size();\ng[k++]=\"<table cellpadding=0 cellspacing=0 border=0 width=100%>\";\nfor(var f=0;\nf<m;\nf++){var a=j.get(f);\nvar h=a.getUniqueId(true);\nvar e=this._apptData[h]={appt:a};\nk=this._addAppt(g,k,a,e,(f===m-1))\n}if(m==0){g[k++]='<tr name=\"rdsep\">';\ng[k++]=\"<td colspan=3><div>\"+ZmMsg.noMeetingsFound+\"</div></td>\";\ng[k++]=\"</tr>\"\n}g[k++]=\"</table>\";\nif(this._openButtons){for(var c in this._openButtons){this._openButtons[c].dispose()\n}}this._openButtons={};\nvar l=new AjxListener(this,this._openButtonListener);\nvar b=document.getElementById(this._listId);\nb.innerHTML=g.join(\"\");\nfor(var f=0;\nf<m;\nf++){var a=j.get(f);\nvar h=a.getUniqueId(true);\nvar e=this._apptData[h];\nvar d=this._openButtons[e.openBtnId]=new DwtLinkButton({id:\"openBtn_\"+c,parent:this,parentElement:e.openLinkId,noDropDown:true});\nd.setText(a.getName());\nd.addSelectionListener(l);\nd.apptUid=h;\nthis._updateDelta(e)\n}};\nZmQuickReminderDialog.prototype._contentHtml=function(a){this._listId=Dwt.getNextId();\nreturn[\"<div class='ZmQuickReminderDialog' id='\",this._listId,\"'>\"].join(\"\")\n};\nZmQuickReminderDialog.prototype._updateDelta=function(b){var c=document.getElementById(b.deltaId);\nif(c){var a=this._computeDelta(b.appt);\nif(a>=0){c.className=\"ZmReminderOverdue\"\n}else{if(a>ZmQuickReminderDialog.SOON){c.className=\"ZmReminderSoon\"\n}else{c.className=\"ZmReminderFuture\"\n}}c.innerHTML=ZmReminderDialog.formatDeltaString(a)\n}};\nZmQuickReminderDialog.prototype._addAppt=function(e,h,a,d,f){d.openLinkId=Dwt.getNextId();\nd.deltaId=Dwt.getNextId();\nd.rowId=Dwt.getNextId();\nvar g=(a.folderId!=ZmOrganizer.ID_CALENDAR&&this._calController)?this._calController.getCalendarName(a.folderId):null;\nvar c=appCtxt.getById(a.folderId);\nvar j=a.isUpcomingEvent?\" (\"+ZmMsg.upcoming+\")\":\"\";\nvar b={noSep:f,rowId:d.rowId,calName:g,accountName:(appCtxt.multiAccounts&&c&&c.getAccount().getDisplayName()),location:a.getLocation(),apptIconHtml:(AjxImg.getImageHtml(a.otherAttendees?\"ApptMeeting\":\"Appointment\")),organizer:a.otherAtt?a.organizer:null,reminderName:(AjxStringUtil.htmlEncode(a.name+j)),durationText:(AjxStringUtil.trim(this._getDurationText(a))),deltaId:d.deltaId,openLinkId:d.openLinkId};\ne[h++]=AjxTemplate.expand(\"calendar.Calendar#ReminderDialogRow\",b);\nreturn h\n};\nZmQuickReminderDialog.prototype._openButtonListener=function(d){var f=DwtControl.getTargetControl(d);\nvar e=this._apptData[f.apptUid];\nvar c=e?e.appt:null;\nif(c){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nvar h=AjxDispatcher.run(\"GetCalController\");\nvar b=new ZmAppt();\nfor(var a in c){if(!AjxUtil.isFunction(c[a])){b[a]=c[a]\n}}var g=new AjxCallback(h,h._showAppointmentDetails,b);\nb.getDetails(null,g,null,null,true);\nthis.popdown()\n}};\nZmQuickReminderDialog.prototype._getDurationText=function(c){var e=c.isMultiDay();\nvar f=c.startDate;\nvar b=c.getEndTime();\nvar a=new Date(b);\nif(c.isAllDayEvent()){a=new Date(b-(e?2*AjxDateUtil.MSEC_PER_HOUR:0));\nvar d=e?ZmMsg.apptTimeAllDayMulti:ZmMsg.apptTimeAllDay;\nreturn AjxMessageFormat.format(d,[f,a])\n}var d=e?ZmMsg.apptTimeInstanceMulti:ZmMsg.apptTimeInstance;\nreturn AjxMessageFormat.format(d,[f,a,\"\"])\n};\nZmQuickReminderDialog.prototype._computeDelta=function(a){return((new Date()).getTime()-a.getStartTime())\n}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmRetentionWarningDialog\")){ZmRetentionWarningDialog=function(a){var b=new DwtDialog_ButtonDescriptor(ZmRetentionWarningDialog.DELETE_ALL_BUTTON,ZmMsg.retentionDeleteAll,DwtDialog.ALIGN_LEFT);\nvar c=new DwtDialog_ButtonDescriptor(ZmRetentionWarningDialog.DELETE_VALID_BUTTON,ZmMsg.retentionDeleteValid,DwtDialog.ALIGN_LEFT);\nDwtMessageDialog.call(this,{parent:a,buttons:[DwtDialog.CANCEL_BUTTON],extraButtons:[b,c],id:\"RetentionWarningDialog\"})\n};\nZmRetentionWarningDialog.prototype=new DwtMessageDialog;\nZmRetentionWarningDialog.prototype.constructor=ZmRetentionWarningDialog;\nZmRetentionWarningDialog.prototype.toString=function(){return\"ZmRetentionWarningDialog\"\n};\nZmRetentionWarningDialog.DELETE_ALL_BUTTON=\"RetentionDeleteAll\";\nZmRetentionWarningDialog.DELETE_VALID_BUTTON=\"RetentionDeleteValid\"\n}if(AjxPackage.define(\"zimbraMail.offline.ZmOffline\")){ZmOffline=function(){ZmOffline.SUPPORTED_APPS=[ZmApp.MAIL,ZmApp.CONTACTS,ZmApp.CALENDAR];\nZmOffline.SUPPORTED_MAIL_TREE_VIEWS=[ZmOrganizer.FOLDER,ZmOrganizer.SEARCH,ZmOrganizer.TAG];\nZmOfflineDB.init();\nthis._addListeners()\n};\nZmOffline.appCacheDone=false;\nZmOffline.messageNotShowed=true;\nZmOffline.cacheProgress=[];\nZmOffline.syncStarted=false;\nZmOffline.isServerReachable=true;\nZmOffline.folders={};\nZmOffline.calendars={};\nZmOffline.CALENDAR_LOOK_BEHIND_DAYS=7;\nZmOffline.CALENDAR_READ_AHEAD_DAYS=21;\nZmOffline.ATTACHMENT=\"Attachment\";\nZmOffline.REQUESTQUEUE=\"RequestQueue\";\nZmOffline.META_DATA=\"MetaData\";\nZmOffline.MAIL_PROGRESS=\"Mail\";\nZmOffline.CONTACTS_PROGRESS=\"Contacts\";\nZmOffline.CALENDAR_PROGRESS=\"Calendar Appointments\";\nZmOffline.MAX_REQUEST_IN_BATCH_REQUEST=50;\nZmOffline.SYNC_REQUEST_DELAY=10000;\nZmOffline._checkCacheDone=function(){if(appCtxt.isWebClientOfflineSupported&&ZmOffline.appCacheDone&&ZmOffline.cacheProgress.length===0&&ZmOffline.syncStarted&&ZmOffline.messageNotShowed){appCtxt.setStatusMsg(ZmMsg.offlineCachingDone,ZmStatusView.LEVEL_INFO);\nZmOffline.messageNotShowed=false\n}};\nZmOffline.prototype._addListeners=function(){$(window).on(\"online offline\",ZmOffline.checkServerStatus);\n$(document).on(\"ZWCOffline\",this._onZWCOffline.bind(this));\n$(document).on(\"ZWCOnline\",this._onZWCOnline.bind(this));\nZmZimbraMail.addListener(ZmAppEvent.POST_STARTUP,this._onPostStartup.bind(this));\nsetInterval(ZmOffline.checkServerStatus,10000)\n};\nZmOffline.prototype._onZWCOffline=function(){ZmOffline.refreshStatusIcon();\nthis._disableApps();\nvar a=appCtxt.getZimbraMail();\nif(a){a.setupHelpMenu()\n}this._setSearchOfflineState(true)\n};\nZmOffline.prototype._onZWCOnline=function(){ZmOffline.refreshStatusIcon();\nthis._enableApps();\nthis._replayOfflineRequest();\nvar a=appCtxt.getZimbraMail();\nif(a){a.setupHelpMenu()\n}this._setSearchOfflineState(false)\n};\nZmOffline.prototype._setSearchOfflineState=function(a){var b=appCtxt.getSearchController();\nif(b){var c=b.getSearchToolbar();\nif(c){c.setOfflineState(a)\n}}};\nZmOffline.prototype._onPostStartup=function(){this._initOfflineFolders();\nif(appCtxt.isWebClientOffline()){this._onZWCOffline()\n}else{this._replayOfflineRequest();\nthis._initStaticResources()\n}ZmOffline.updateFolderCount()\n};\nZmOffline.prototype._enableApps=function(){var c=appCtxt.getAppChooser();\nfor(var b in ZmApp.ENABLED_APPS){var a=c.getButton(b);\nif(a){a.setEnabled(true)\n}}var d=appCtxt.getCurrentApp();\nd.resetWebClientOfflineOperations()\n};\nZmOffline.prototype._disableApps=function(){var e=appCtxt.getAppChooser();\nvar b=AjxUtil.keys(ZmApp.ENABLED_APPS);\nvar a=AjxUtil.arraySubstract(b,ZmOffline.SUPPORTED_APPS);\nfor(var d=0;\nd<a.length;\nd++){var c=e.getButton(a[d]);\nif(c){c.setEnabled()\n}}var f=appCtxt.getCurrentApp();\nf.resetWebClientOfflineOperations()\n};\nZmOffline.prototype._initOfflineFolders=function(){var f=appCtxt.getFolderTree();\nif(f){var e=f.getByType(\"FOLDER\");\ne.forEach(function(j){if(j.webOfflineSyncDays!==0){ZmOffline.folders[j.id]=j\n}});\nvar d=f.getByType(\"ADDRBOOK\");\nd.forEach(function(j){if(j.id!=ZmFolder.ID_DLS){ZmOffline.folders[j.id]=j\n}});\nvar g=appCtxt.getApp(\"Contacts\");\nif(g){g._deferredFolders.forEach(function(j){if(j.obj.id!=ZmFolder.ID_DLS){ZmOffline.folders[j.obj.id]=j.obj\n}})\n}}var h=appCtxt.getCalManager();\nvar a=h&&h.getCalViewController();\nvar b=a.getOfflineSearchCalendarIds();\nfor(var c=0;\nc<b.length;\nc++){ZmOffline.calendars[b[c]]=b[c]\n}};\nZmOffline.prototype._initStaticResources=function(){ZmOffline.refreshStatusIcon(true);\nvar b=[];\nvar a=[\"/css/msgview.css?v=\",cacheKillerVersion,\"&locale=\",window.appRequestLocaleId,\"&skin=\",window.appCurrentSkin].join(\"\");\nb.push({url:a,storeInLocalStorage:true,appendCacheKillerVersion:false});\nb.push({url:\"/img/large.png\"});\nb.push({url:\"/img/large/ImgPerson_48.png\"});\nb.push({url:\"/img/arrows/ImgSashArrowsUp.png\"});\nb.push({url:\"/img/arrows.png\"});\nb.push({url:\"/img/calendar/ImgCalendarDayGrid.repeat.gif\"});\nb.push({url:\"/css/tinymce-content.css\"});\nb.push({url:\"/js/ajax/3rdparty/tinymce/skins/lightgray/fonts/tinymce-small.woff\",appendCacheKillerVersion:false});\nb.push({url:\"/js/ajax/3rdparty/tinymce/skins/lightgray/content.min.css\",appendCacheKillerVersion:false});\nb.push({url:\"/js/ajax/3rdparty/tinymce/skins/lightgray/skin.min.css\",appendCacheKillerVersion:false});\nthis._cacheStaticResources(b)\n};\nZmOffline.prototype._cacheStaticResources=function(d,c,a){if(a&&a.success&&c&&c.storeInLocalStorage){localStorage.setItem(c.url,a.text)\n}if(d&&d.length>0){var e=d.shift();\nvar b=appContextPath+e.url;\nif(e.appendCacheKillerVersion!==false){e.url=b=b+\"?v=\"+cacheKillerVersion\n}var f=this._cacheStaticResources.bind(this,d,e);\nAjxRpc.invoke(null,b,null,f,true)\n}else{var f=this._cacheStaticResourcesContinue.bind(this);\nAjxDispatcher.require([\"Contacts\",\"TinyMCE\",\"Extras\"],true,f)\n}};\nZmOffline.prototype._cacheStaticResourcesContinue=function(){var d=this.sendSyncRequest.bind(this,appCtxt.reloadAppCache.bind(appCtxt));\nvar b=this._cacheSignatureImages.bind(this,d);\nvar a=tinyMCE.getlanguage(appCtxt.get(ZmSetting.LOCALE_NAME));\nif(a===\"en\"){b()\n}else{var c=appContextPath+\"/js/ajax/3rdparty/tinymce/langs/\"+a+\".js\";\nAjxRpc.invoke(null,c,null,b,true)\n}};\nZmOffline.prototype._cacheSignatureImages=function(d){var c=appCtxt.getSignatureCollection().getSignatures();\nif(!c||c.length===0){return d&&d()\n}var a=document.createElement(\"template\");\nvar b=[];\nc.forEach(function(e){a.innerHTML=e.getValue(ZmMimeTable.TEXT_HTML);\nvar g=a.content.querySelectorAll(\"img[src]\");\nfor(var f=0;\nf<g.length;\nf++){b.push(g[f].getAttribute(\"src\"))\n}});\nthis._storeSignatureImages(b,d)\n};\nZmOffline.prototype._storeSignatureImages=function(c,d){if(!c||c.length===0){return d&&d()\n}var a=c.shift();\nvar b=$.ajax({url:a,dataType:\"text\",headers:{\"X-Zimbra-Encoding\":\"x-base64\"}});\nb.done(function(f,e){var g=f.substr(f.lastIndexOf(\".\")+1);\nlocalStorage.setItem(f,\"data:image/\"+g+\";base64,\"+e)\n}.bind(window,a));\nb.always(this._storeSignatureImages.bind(this,c,d))\n};\nZmOffline.modifySignature=function(e){var d=document.createElement(\"template\");\nd.innerHTML=e;\nvar f=d.content.querySelectorAll(\"img[src]\");\nfor(var c=0;\nc<f.length;\nc++){var b=f[c];\nvar a=localStorage.getItem(b.getAttribute(\"src\"));\nif(a){b.setAttribute(\"src\",a);\nb.removeAttribute(\"dfsrc\");\nb.removeAttribute(\"data-mce-src\")\n}}return d.innerHTML\n};\nZmOffline.prototype._downloadCalendar=function(c,h,l,o,m,g){var q={BatchRequest:{_jsns:\"urn:zimbra\",onerror:\"continue\"}};\nvar e=q.BatchRequest;\nvar j=appCtxt.getCalManager();\nvar d=j&&j.getCalViewController();\nvar a=d.getApptCache();\nif(!c){var f=new Date();\nf.setHours(23,59,59,999);\nvar b=new Date(f.getTime());\nb.setDate(b.getDate()-ZmOffline.CALENDAR_LOOK_BEHIND_DAYS);\nb.setHours(0,0,0,0);\nf.setDate(f.getDate()+ZmOffline.CALENDAR_READ_AHEAD_DAYS);\nc=b.getTime();\nh=f.getTime()\n}if(!l){l=[];\nfor(var n in ZmOffline.calendars){l.push(n)\n}}localStorage.setItem(\"calendarSyncTime\",h);\nvar k={start:c,end:h,accountFolderIds:l,folderIds:l,offset:0};\na.setFolderSearchParams(k.folderIds,k);\ne.SearchRequest={_jsns:\"urn:zimbraMail\"};\na._setSoapParams(e.SearchRequest,k);\nvar p=this._handleCalendarResponse.bind(this,c,h,o,m,g,null);\nappCtxt.getRequestMgr().sendRequest({jsonObj:q,asyncMode:true,callback:p})\n};\nZmOffline.prototype._downloadByApptId=function(a,b,c,e,g){var j={BatchRequest:{_jsns:\"urn:zimbra\",onerror:\"continue\"}};\nj.BatchRequest.SearchRequest={_jsns:\"urn:zimbraMail\"};\nvar d=j.BatchRequest.SearchRequest;\nd.sortBy=\"none\";\nd.limit=\"500\";\nd.offset=0;\nd.locale={_content:AjxEnv.DEFAULT_LOCALE};\nd.types=ZmSearch.TYPE[ZmItem.APPT];\nvar f=b.join(\" OR \");\nd.query={_content:f};\nd.calExpandInstStart=c;\nd.calExpandInstEnd=e;\nvar h=this._handleCalendarResponse.bind(this,c,e,g,g==null,null,a);\nappCtxt.getRequestMgr().sendRequest({jsonObj:j,asyncMode:true,callback:h})\n};\nZmOffline.prototype._handleCalendarResponse=function(n,e,g,y,h,A,b){var s=b&&b._data&&b._data.BatchResponse;\nvar z=s&&s.SearchResponse&&s.SearchResponse[0];\ntry{var t;\nvar c;\nvar o=new ZmApptList();\no.loadFromSummaryJs(z.appt,true);\nvar v=o.size();\nvar D=[];\nvar E;\nvar a;\nvar q;\nvar p=h?h:[];\nvar C={};\nfor(var u=0;\nu<v;\nu++){c=o.get(u);\na=c.startDate.getTime();\nq=c.endDate.getTime();\nif(((a>=n)&&(a<=e))||((q>=n)&&(q<=e))){this._cleanApptForStorage(c);\nE={appt:c,instanceId:this._createApptPrimaryKey(c),id:c.id,invId:c.invId,startDate:a,endDate:q};\nD.push(E);\nvar d=c.invId||c.id;\nC[d]=true\n}}for(var l in C){p.push(l)\n}if(A){var k;\nvar r=this._offlineUpdateAppts.bind(this,D);\nfor(var m in A){k=[m];\nZmOfflineDB.doIndexSearch(k,ZmApp.CALENDAR,null,r,this.calendarDeleteErrorCallback.bind(this),\"id\")\n}}else{ZmOfflineDB.setItem(D,ZmApp.CALENDAR,null,this.calendarDownloadErrorCallback.bind(this))\n}if(y){if(p.length>0){var j=this._updateCacheProgress.bind(this,ZmOffline.CALENDAR_PROGRESS);\nthis._loadMessages(p,j)\n}else{this._updateCacheProgress(ZmOffline.CALENDAR_PROGRESS)\n}}var f=appCtxt.getCalManager();\nvar x=f&&f.getCalViewController();\nvar B=x.getApptCache();\nB.clearCache()\n}catch(w){if(!g){this._updateCacheProgress(ZmOffline.CALENDAR_PROGRESS)\n}}if(g){g.run(p)\n}};\nZmOffline.prototype.calendarDownloadErrorCallback=function(a){};\nZmOffline.prototype.calendarDeleteErrorCallback=function(a){};\nZmOffline.prototype._createApptPrimaryKey=function(a){return a.id+\":\"+a.startDate.getTime()\n};\nZmOffline.prototype._cleanApptForStorage=function(a){delete a.list;\ndelete a._list;\ndelete a._evt;\ndelete a._evtMgr\n};\nZmOffline.prototype._updateCacheProgress=function(b){var a=$.inArray(b,ZmOffline.cacheProgress);\nif(a!=-1){ZmOffline.cacheProgress.splice(a,1)\n}if(ZmOffline.cacheProgress.length===0){ZmOffline._checkCacheDone()\n}};\nZmOffline.prototype.scheduleSyncRequest=function(b,a){if(a===\"SyncRequest\"){return\n}var c=Object.keys(b.created||{});\nc=c.concat(Object.keys(b.modified||{}));\nc=c.concat(Object.keys(b.deleted||{}));\nif(c.length===0){return\n}if(this._syncRequestActionId){AjxTimedAction.cancelAction(this._syncRequestActionId)\n}this._syncRequestActionId=AjxTimedAction.scheduleAction(new AjxTimedAction(this,this.sendSyncRequest),ZmOffline.SYNC_REQUEST_DELAY)\n};\nZmOffline.prototype.sendSyncRequest=function(b){ZmOffline.refreshStatusIcon(true);\nvar a=localStorage.getItem(\"SyncToken\");\nif(a){AjxDebug.println(AjxDebug.OFFLINE,\"syncToken :: \"+a);\nthis._sendDeltaSyncRequest(b,a)\n}else{this._sendInitialSyncRequest(b)\n}};\nZmOffline.prototype._sendInitialSyncRequest=function(h){var c=[];\nvar f=AjxUtil.keys(ZmOffline.folders);\nfor(var b=0,e=f.length;\nb<e;\nb++){var d=ZmOffline.folders[f[b]];\nif(d&&d.id!=ZmFolder.ID_OUTBOX){var g={l:d.id,_jsns:\"urn:zimbraMail\"};\nif(d.type===\"FOLDER\"){var a=AjxDateUtil.roll(new Date(),AjxDateUtil.DAY,-parseInt(d.webOfflineSyncDays));\ng.msgCutoff=Math.round(a.getTime()/1000)\n}c.push(g)\n}}if(c.length>0){var g={jsonObj:{BatchRequest:{_jsns:\"urn:zimbra\",onerror:\"continue\",SyncRequest:c}},asyncMode:true,callback:this._handleInitialSyncResponse.bind(this,true,h),errorCallback:this._handleInitialSyncError.bind(this)};\nappCtxt.getRequestMgr().sendRequest(g)\n}};\nZmOffline.prototype._handleInitialSyncResponse=function(k,j,l){var e=l&&l.getResponse();\nvar h=e&&e.BatchResponse;\nvar f=h&&h.SyncResponse;\nif(!f){return\n}var d=[];\nvar a=[];\nvar b;\nvar g;\nf.forEach(function(n){var p=n.folder&&n.folder[0];\nif(p){if(p.m){var m=p.m[0].ids;\nif(m){var o=p.id.split(\":\");\nvar r=(o.length>1)?o[0]+\":\":\"\";\nm.split(\",\").forEach(function(t){var s={m:{id:r+t,html:1,needExp:1},_jsns:\"urn:zimbraMail\"};\nd.push(s)\n})\n}}else{if(p.cn){var q=p.cn[0].ids;\nif(q){a=a.concat(q.split(\",\"))\n}}}}b=n.token;\ng=n.more\n});\nvar c={msgs:d,contactIds:a};\nif(g==1){c.callback=this.sendSyncRequest.bind(this,j)\n}else{c.callback=j\n}this._sendGetRequest(c);\nif(k){this._downloadCalendar(null,null,null,null,true,null)\n}this._storeSyncToken(b)\n};\nZmOffline.prototype._handleInitialSyncError=function(){ZmOffline.refreshStatusIcon()\n};\nZmOffline.prototype._sendGetRequest=function(c){var g=c.msgs||[];\nvar j=c.contactIds||[];\nvar h=g.length;\nvar a=j.length;\nif(h===0&&a===0){if(c.callback&&!c.isCallbackExecuted){c.isCallbackExecuted=true;\nc.callback()\n}ZmOffline.refreshStatusIcon()\n}else{var d=this._sendGetRequest.bind(this,c);\nvar f={jsonObj:{BatchRequest:{_jsns:\"urn:zimbra\",onerror:\"continue\"}},asyncMode:true,callback:this._handleGetResponse.bind(this,d),errorCallback:this._handleGetError.bind(this,d)};\nvar b=f.jsonObj.BatchRequest;\nvar e=g.splice(0,ZmOffline.MAX_REQUEST_IN_BATCH_REQUEST);\nif(e.length>0){b.GetMsgRequest=e\n}if(a>0&&e.length<ZmOffline.MAX_REQUEST_IN_BATCH_REQUEST){b.GetContactsRequest={_jsns:\"urn:zimbraMail\",derefGroupMember:1,returnCertInfo:1,cn:{id:j.join()}};\nj.splice(0,a)\n}appCtxt.getRequestMgr().sendRequest(f)\n}};\nZmOffline.prototype._sendDeltaSyncRequest=function(c,a){var b={jsonObj:{SyncRequest:{_jsns:\"urn:zimbraMail\",token:a,typed:1}},asyncMode:true,callback:this._handleDeltaSyncResponse.bind(this,c,a),errorCallback:this._handleDeltaSyncError.bind(this)};\nappCtxt.getRequestMgr().sendRequest(b)\n};\nZmOffline.prototype._handleDeltaSyncResponse=function(d,c,a){ZmOffline.refreshStatusIcon();\nvar b=a&&a.getResponse().SyncResponse;\nif(!b||b.token===c){if(d){d()\n}return\n}this._storeSyncToken(b.token);\nif(b.deleted){this._handleSyncDeletes(b.deleted)\n}if(b.m||b.cn){this._handleSyncUpdate(b)\n}if(b.appt){this._handleUpdateAppts(b.appt)\n}if(b.folder){this._handleUpdateFolders(b.folder)\n}if(b.folder||b.search){appCtxt.reloadAppCache()\n}if(d){d()\n}};\nZmOffline.prototype._handleDeltaSyncError=function(a){ZmOffline.refreshStatusIcon();\nif(a&&a.code===ZmCsfeException.MAIL_MUST_RESYNC){localStorage.removeItem(\"SyncToken\");\nthis.sendSyncRequest();\nreturn true\n}};\nZmOffline.prototype._handleSyncDeletes=function(e){var d=e[0];\nif(!d){return\n}if(d.m){var b=d.m[0]&&d.m[0].ids;\nif(b){var c=[].concat(b.split(\",\"))\n}}if(d.cn){var f=d.cn[0]&&d.cn[0].ids;\nif(f){var a=[].concat(f.split(\",\"))\n}}if(c&&c.length>0){ZmOfflineDB.deleteItem(c,ZmApp.MAIL)\n}if(a&&a.length>0){ZmOfflineDB.deleteItem(a,ZmApp.CONTACTS)\n}};\nZmOffline.prototype._handleSyncUpdate=function(b){var g=b.m;\nvar f=b.cn;\nvar e=[];\nvar d=[];\nif(g){var c=Object.keys(ZmOffline.folders);\nvar a=[];\ng.forEach(function(j){if(j.l&&c.indexOf(j.l)!==-1){var h={m:{id:j.id,html:1,needExp:1},_jsns:\"urn:zimbraMail\"};\ne.push(h)\n}else{a.push(j.id)\n}});\nif(a.length>0){ZmOfflineDB.deleteItem(a,ZmApp.MAIL)\n}}if(f){f.forEach(function(h){d.push(h.id)\n})\n}ZmOffline.refreshStatusIcon(true);\nthis._sendGetRequest({msgs:e,contactIds:d})\n};\nZmOffline.prototype._handleUpdateFolders=function(b){var a=[];\nb.forEach(function(g){var e=g.id;\nvar h={l:e,_jsns:\"urn:zimbraMail\"};\nif(g.view===\"message\"){var f=ZmOffline.folders.hasOwnProperty(e);\nif(f&&g.webOfflineSyncDays==0){var j=function(k){ZmOfflineDB.deleteItem(k,ZmApp.MAIL)\n};\nZmOfflineDB.doIndexSearch([e.toString()],ZmApp.MAIL,null,j,null,\"folder\",true);\ndelete ZmOffline.folders[e]\n}else{if((f&&g.webOfflineSyncDays!=ZmOffline.folders[e].webOfflineSyncDays)||(!f&&g.webOfflineSyncDays!=0)){var d=AjxDateUtil.roll(new Date(),AjxDateUtil.DAY,-parseInt(g.webOfflineSyncDays));\nh.msgCutoff=Math.round(d.getTime()/1000);\na.push(h);\nZmOffline.folders[e]=g\n}}}else{if(g.view===\"contact\"){a.push(h);\nZmOffline.folders[e]=g\n}}});\nif(a.length>0){var c={jsonObj:{BatchRequest:{_jsns:\"urn:zimbra\",onerror:\"continue\",SyncRequest:a}},asyncMode:true,callback:this._handleInitialSyncResponse.bind(this,false,false)};\nZmOffline.refreshStatusIcon(true);\nappCtxt.getRequestMgr().sendRequest(c)\n}};\nZmOffline.prototype._storeSyncToken=function(a){AjxDebug.println(AjxDebug.OFFLINE,\"New syncToken :: \"+a);\nlocalStorage.setItem(\"SyncToken\",a)\n};\nZmOffline.prototype._handleGetResponse=function(h,k){var a=k&&k.getResponse();\nvar d=a&&a.BatchResponse;\nif(!d){return\n}var c=d.GetMsgResponse;\nif(c){var e=[];\nfor(var b=0;\nb<c.length;\nb++){e.push(c[b].m[0])\n}var j=this._handleSetItemCallback.bind(this,e,ZmApp.MAIL,h);\nZmOfflineDB.setItem(e,ZmApp.MAIL,j)\n}var f=d.GetContactsResponse;\nif(f){var g=[];\nfor(var b=0;\nb<f.length;\nb++){g=g.concat(f[b].cn)\n}var j=this._handleSetItemCallback.bind(this,g,ZmApp.CONTACTS,h);\nZmOfflineDB.setItem(g,ZmApp.CONTACTS,j)\n}};\nZmOffline.prototype._handleSetItemCallback=function(b,a,c){if(c){c()\n}if(a===ZmApp.MAIL){this._fetchMsgAttachments(b)\n}};\nZmOffline.prototype._handleGetError=function(c,b,a){localStorage.removeItem(\"SyncToken\")\n};\nZmOffline.prototype._handleUpdateAppts=function(m,c){if(!m){m=[]\n}var s=null;\nvar o={};\nvar u=new Date();\nvar p=u.getTime();\nvar a=new Date(p);\nu.setHours(0,0,0,0);\nvar e=u.getTime()-(AjxDateUtil.MSEC_PER_DAY*ZmOffline.CALENDAR_LOOK_BEHIND_DAYS);\na.setHours(23,59,59,999);\nvar g=a.getTime()+(AjxDateUtil.MSEC_PER_DAY*ZmOffline.CALENDAR_READ_AHEAD_DAYS);\nvar l=g;\nvar q=localStorage.getItem(\"calendarSyncTime\");\nif(q){l=parseInt(q)+(AjxDateUtil.MSEC_PER_DAY*ZmOffline.CALENDAR_READ_AHEAD_DAYS)\n}localStorage.setItem(\"calendarSyncTime\",a.getTime());\nvar b=[];\nvar r={};\nvar j;\nfor(var n=0,d=m.length;\nn<d;\nn++){s=m[n];\nj=s.id.toString();\nr[j]=true;\nb.push('item:\"'+j+'\"')\n}var h=(g>l)?this._downloadCalendar.bind(this,l,g,null,null,true):null;\nif(b.length>0){this._downloadByApptId(r,b,e,g,h)\n}else{if(h){h.run()\n}}var k=[0,e];\nvar f=this._expiredErrorCallback.bind(this);\nvar t=this._offlineUpdateAppts.bind(this,null);\nZmOfflineDB.doIndexSearch(k,ZmApp.CALENDAR,null,t,f,\"endDate\")\n};\nZmOffline.prototype._offlineUpdateAppts=function(a,d){var c;\nif(d){for(var b=0;\nb<d.length;\nb++){c=d[b].appt;\nZmOfflineDB.deleteItem(this._createApptPrimaryKey(c),ZmApp.CALENDAR,this.calendarDeleteErrorCallback.bind(this))\n}}if(a){ZmOfflineDB.setItem(a,ZmApp.CALENDAR,null,this.calendarDownloadErrorCallback.bind(this))\n}};\nZmOffline.prototype._expiredErrorCallback=function(a){};\nZmOffline.prototype._loadMessages=function(a,h){if(!a||a.length===0){return\n}var d=AjxSoapDoc.create(\"BatchRequest\",\"urn:zimbra\");\nd.setMethodAttribute(\"onerror\",\"continue\");\nfor(var c=0,e=a.length;\nc<e;\nc++){var b=d.set(\"GetMsgRequest\",null,null,\"urn:zimbraMail\");\nvar f=d.set(\"m\",null,b);\nf.setAttribute(\"id\",a[c]);\nf.setAttribute(\"read\",0);\nf.setAttribute(\"html\",1);\nf.setAttribute(\"needExp\",1)\n}var g=this._handleGetResponse.bind(this,h);\nappCtxt.getRequestMgr().sendRequest({soapDoc:d,asyncMode:true,callback:g})\n};\nZmOffline.prototype._replayOfflineRequest=function(){var a=this._sendOfflineRequest.bind(this);\nZmOfflineDB.getItemInRequestQueue(false,a)\n};\nZmOffline.prototype._sendOfflineRequest=function(a,d){if(!a||a.length===0){return\n}if(d){var c=[];\nvar e=[];\nvar g={jsonObj:{BatchRequest:{_jsns:\"urn:zimbra\",onerror:\"continue\"}},asyncMode:true};\ng.errorCallback=g.callback=this._handleResponseSendOfflineRequest.bind(this,c,e);\nvar b=g.jsonObj.BatchRequest;\na.forEach(function(j){var h=j.methodName;\nif(h===\"BatchRequest\"){$.extend(true,b,j[h])\n}else{if(!b[h]){b[h]=[]\n}b[h].push(j[h])\n}c.push(j.id);\ne.push(j.oid)\n});\nappCtxt.getRequestMgr().sendRequest(g)\n}else{var f=[];\na.forEach(function(o){var m=o.methodName;\nif(m===\"SendMsgRequest\"||m===\"SaveDraftRequest\"){var p=o[m].m;\nvar l=p&&p.attach;\nif(l){for(var n in l){var k=l[n];\nif(k&&k.isOfflineUploaded){f.push(k)\n}}}var h=p&&p.f;\nif(h&&h.indexOf(ZmItem.FLAG_OFFLINE_CREATED)!==-1){p.f=h.replace(ZmItem.FLAG_OFFLINE_CREATED,\"\");\nif(!p.f){delete p.f\n}delete p.id;\ndelete p.did\n}}});\nthis._uploadOfflineAttachments(f,a)\n}};\nZmOffline.prototype._handleResponseSendOfflineRequest=function(a,b){if(a.length>0){var c=ZmOffline.updateFolderCountCallback.bind(window,ZmFolder.ID_OUTBOX,0);\nZmOfflineDB.deleteItem(a,ZmApp.MAIL,c)\n}if(b.length>0){ZmOfflineDB.deleteItemInRequestQueue(b)\n}};\nZmOffline.prototype._getFolder=function(a){for(var b=0,c=ZmOffline.folders.length;\nb<c;\nb++){if(ZmOffline.folders[b].id==a){return ZmOffline.folders[b].name\n}}if(ZmOffline.calendars[a]){return ZmOffline.calendars[a]\n}else{return null\n}};\nZmOffline.prototype.deleteItem=function(f,c,e){if(!f||f.length===0){return\n}var a=e+c;\nfor(var b=0,d=f.length;\nb<d;\nb++){ZmOfflineDB.deleteItem(f[b],a)\n}};\nZmOffline.deleteOfflineData=function(){ZmOfflineDB.deleteDB();\nlocalStorage.clear()\n};\nZmOffline.generateMsgResponse=function(n){var d=[],f,a,l,m,g,c;\nn=[].concat(n);\nfor(g=0,c=n.length;\ng<c;\ng++){f=n[g];\nif(f){a=f[f.methodName]&&f[f.methodName][\"m\"];\nif(a){l={id:a.id,f:a.f||\"\",mid:a.mid,cid:a.cid,idnt:a.idnt,e:a.e,l:\"\",fr:\"\",su:a.su._content,mp:[],d:a.d};\nif(f.methodName===\"SendMsgRequest\"){l.f=l.f.replace(ZmItem.FLAG_ISSENT,\"\").concat(ZmItem.FLAG_ISSENT)\n}else{if(f.methodName===\"SaveDraftRequest\"){l.f=l.f.replace(ZmItem.FLAG_ISDRAFT,\"\").concat(ZmItem.FLAG_ISDRAFT)\n}}if(a.attach){l.f=l.f.replace(ZmItem.FLAG_ATTACH,\"\").concat(ZmItem.FLAG_ATTACH)\n}if(f.methodName===\"SendMsgRequest\"){l.l=ZmFolder.ID_OUTBOX.toString()\n}else{if(f.methodName===\"SaveDraftRequest\"){l.l=ZmFolder.ID_DRAFTS.toString()\n}}m=a.mp[0];\nif(m){var k=a.attach;\nif(k&&k.aid){l.mp.push({ct:ZmMimeTable.MULTI_MIXED,part:ZmMimeTable.TEXT,mp:[]});\nif(m.ct===ZmMimeTable.TEXT_PLAIN){l.mp[0].mp.push({body:true,part:\"1\",ct:ZmMimeTable.TEXT_PLAIN,content:m.content._content});\nl.fr=l.mp[0].mp[0].content\n}else{if(m.ct===ZmMimeTable.MULTI_ALT){l.mp[0].mp.push({ct:ZmMimeTable.MULTI_ALT,part:\"1\",mp:[{ct:ZmMimeTable.TEXT_PLAIN,part:\"1.1\",content:(m.mp[0].content)?m.mp[0].content._content:\"\"},{ct:ZmMimeTable.TEXT_HTML,part:\"1.2\",body:true,content:(m.mp[1].content)?m.mp[1].content._content:\"\"}]});\nl.fr=l.mp[0].mp[0].mp[0].content\n}}var b=k.aid.split(\",\");\nfor(var e=0;\ne<b.length;\ne++){var h=k[b[e]];\nif(h){l.mp[0].mp.push({cd:\"attachment\",ct:h.ct,filename:h.filename,aid:h.aid,s:h.s,data:h.data,isOfflineUploaded:h.isOfflineUploaded,part:(e+2).toString()})\n}}}else{if(m.ct===ZmMimeTable.TEXT_PLAIN){l.mp.push({ct:ZmMimeTable.TEXT_PLAIN,body:true,part:\"1\",content:m.content._content});\nl.fr=l.mp[0].content\n}else{if(m.ct===ZmMimeTable.MULTI_ALT){l.mp.push({ct:ZmMimeTable.MULTI_ALT,part:ZmMimeTable.TEXT,mp:[{ct:ZmMimeTable.TEXT_PLAIN,part:\"1\",content:(m.mp[0].content)?m.mp[0].content._content:\"\"},{ct:ZmMimeTable.TEXT_HTML,part:\"2\",body:true,content:(m.mp[1].content)?m.mp[1].content._content:\"\"}]});\nl.fr=l.mp[0].mp[0].content\n}}}}}d.push(l)\n}}return d\n};\nZmOffline.addOutboxFolder=function(){if(!appCtxt.isWebClientOfflineSupported){return\n}var d=appCtxt.getFolderTree(),b=d.root,a={id:ZmFolder.ID_OUTBOX,absFolderPath:\"/Outbox\",activesyncdisabled:false,name:\"Outbox\"};\nvar c=ZmFolderTree.createFolder(ZmOrganizer.FOLDER,b,a,d,null,\"folder\");\nb.children.add(c)\n};\nZmOffline.updateFolderCount=function(){var b=[ZmFolder.ID_DRAFTS,ZmFolder.ID_OUTBOX];\nfor(var a=0,c=b.length;\na<c;\na++){var d=ZmOffline.updateFolderCountCallback.bind(window,b[a]);\nZmOfflineDB.doIndexSearch([b[a].toString()],ZmApp.MAIL,null,d,null,\"folder\",true)\n}};\nZmOffline.updateFolderCountCallback=function(a,c){if(AjxUtil.isArray(c)){c=c.length\n}var b=appCtxt.getById(a);\nif(b){b.notifyModify({n:c})\n}};\nZmOffline.prototype._uploadOfflineAttachments=function(b,a){var e=b.shift();\nif(e){var d=AjxUtil.dataURItoBlob(e.data);\nif(d){d.name=e.filename;\nvar f=this._uploadOfflineAttachmentsCallback.bind(this,b,a,e.aid);\nvar c=this._uploadOfflineAttachmentsErrorCallback.bind(this,b,a,e.aid);\nZmComposeController.prototype._uploadImage(d,f,c)\n}}else{this._sendOfflineRequest(a,true)\n}};\nZmOffline.prototype._uploadOfflineAttachmentsCallback=function(c,k,j,g){for(var e=0;\ne<k.length;\ne++){var d=k[e];\nif(!d){continue\n}var h=d.methodName;\nif(h===\"SendMsgRequest\"||h===\"SaveDraftRequest\"){var b=d[h].m;\nvar f=b&&b.attach;\nvar a=f&&f.aid;\nif(a&&a.indexOf(j)!==-1){f.aid=a.replace(j,g[0].aid);\ndelete f[j];\nbreak\n}}}this._uploadOfflineAttachments(c,k)\n};\nZmOffline.prototype._uploadOfflineAttachmentsErrorCallback=function(c,k,j){for(var e=0;\ne<k.length;\ne++){var d=k[e];\nif(!d){continue\n}var h=d.methodName;\nif(h===\"SendMsgRequest\"||h===\"SaveDraftRequest\"){var b=d[h].m;\nvar f=b&&b.attach;\nvar a=f&&f.aid;\nif(a&&a.indexOf(j)!==-1){var g=a.split(\",\");\nAjxUtil.arrayRemove(g,j);\nif(g.length>0){delete f.aid\n}else{f.aid=g.join()\n}delete f[j];\nbreak\n}}}this._uploadOfflineAttachments(c,k)\n};\nZmOffline.prototype._uploadOfflineInlineAttachments=function(e,f){var d=document.createElement(\"template\");\nd.innerHTML=f.mp[0].mp[1].content._content;\nvar b=d.content.querySelectorAll(\"img[src^='data:']\");\nfor(var c=0;\nc<b.length;\nc++){var a=AjxUtil.dataURItoBlob(b[c].src);\nif(a){var g=this._uploadOfflineInlineAttachmentsCallback.bind(this,b[c],e,f,d);\nZmComposeController.prototype._uploadImage(a,g)\n}}};\nZmOffline.prototype._uploadOfflineInlineAttachmentsCallback=function(b,d,f,c,e){var a=c.content.querySelectorAll(\"img[src^='data:']\");\nif(a.length===0){delete f.isInlineAttachment;\nthis._sendOfflineRequest([].concat(d))\n}};\nZmOffline.checkServerStatus=function(a,c,b){$.ajax({type:\"HEAD\",url:\"/public/blank.html\",cache:false,statusCode:{0:function(){if(ZmOffline.isServerReachable===true){if(a){ZmOffline.isServerReachable=false;\nif(!c){$.event.trigger({type:\"ZWCOffline\"})\n}}else{return ZmOffline.checkServerStatus(true)\n}}ZmOffline.isServerReachable=false\n},200:function(){if(ZmOffline.isServerReachable===false){if(a){ZmOffline.isServerReachable=true;\nif(!c){$.event.trigger({type:\"ZWCOnline\"})\n}}else{return ZmOffline.checkServerStatus(true)\n}}ZmOffline.isServerReachable=true\n}},complete:b})\n};\nZmOffline.checkServerStatus(true,true);\nZmOffline.isOnlineMode=function(){return appCtxt.isWebClientOfflineSupported&&!appCtxt.isWebClientOffline()\n};\nZmOffline.prototype._fetchMsgAttachments=function(b){var a=[];\nb=ZmOffline.recreateMsg(b);\nb.forEach(function(e){var d=ZmMailMsg.createFromDom(e,{},true);\nvar c=d.getAttachmentInfo();\nc.forEach(function(f){a.push(f)\n})\n});\nthis._saveAttachments(a)\n};\nZmOffline.prototype._saveAttachments=function(a){if(!a||a.length===0){ZmOffline.refreshStatusIcon();\nreturn\n}ZmOffline.refreshStatusIcon(true);\nvar b=a.shift();\nvar c=this._isAttachmentSavedinIndexedDBCallback.bind(this,b,a);\nZmOffline.isAttachmentSavedinIndexedDB(b,c)\n};\nZmOffline.isAttachmentSavedinIndexedDB=function(c,d,a){var b=ZmOffline.createAttachmentKey(c);\nZmOfflineDB.getItemCount(b,ZmOffline.ATTACHMENT,d,a)\n};\nZmOffline.createAttachmentKey=function(a){return\"id=\"+a.mid+\"&part=\"+a.part\n};\nZmOffline.prototype._isAttachmentSavedinIndexedDBCallback=function(d,a,c){var e=this._saveAttachments.bind(this,a);\nif(c===0){var b=$.ajax({url:d.url,dataType:\"text\",headers:{\"X-Zimbra-Encoding\":\"x-base64\"}});\nb.done(function(f){var g=ZmOffline.createAttachmentKey(d);\nvar h={id:g,mid:d.mid,url:d.url,type:d.ct,name:d.label,size:d.sizeInBytes,part:d.part,content:f};\nZmOfflineDB.setItem(h,ZmOffline.ATTACHMENT,e,e)\n}.bind(this));\nb.fail(e)\n}else{e()\n}};\nZmOffline.prototype._handleAttachmentsForOfflineMode=function(b,c,d){if(appCtxt.isWebClientOffline()){var a=[];\nif(b){b.forEach(function(g){var f=ZmOffline.createAttachmentKey(g);\na.push(f)\n});\nif(a.length>0){var e=this._handleAttachmentsForOfflineModeCallback.bind(this,b,c,d);\nZmOfflineDB.getItem(a,ZmOffline.ATTACHMENT,e)\n}}}};\nZmOffline.prototype._handleAttachmentsForOfflineModeCallback=function(a,b,d,e){if(!e||!d){return\n}var c=this;\ne.forEach(function(f){if(f.type&&f.content){var g=\"data:\"+f.type+\";base64,\"+f.content;\nfor(var h=0;\nh<d.length;\nh++){var k=b(f.part,d[h]);\nvar j=document.getElementById(k);\nif(j){j.href=g;\nj.onclick=null;\nj.download=f.name\n}}}})\n};\nZmOffline.modifyMsg=function(b){var a=[].concat(b).map(function(c){if(c.f){c.f=c.f.split(\"\")\n}if(c.su){c.su=c.su.split(\" \")\n}if(c.fr){c.fr=c.fr.split(\" \")\n}if(c.tn){c.tn=c.tn.split(\",\")\n}if(c.l){c.l=c.l.toString()\n}if(c.e){var f=[];\nvar e=[];\nvar d=[];\nc.e.forEach(function(g){if(g.t===\"f\"){if(g.a){f.push(g.a.toLowerCase())\n}if(g.p){f=f.concat(g.p.toLowerCase().split(\" \"))\n}}else{if(g.t===\"t\"){if(g.a){e.push(g.a.toLowerCase())\n}if(g.p){e=e.concat(g.p.toLowerCase().split(\" \"))\n}}else{if(g.t===\"c\"){if(g.a){d.push(g.a.toLowerCase())\n}if(g.p){d=d.concat(g.p.toLowerCase().split(\" \"))\n}}}}});\nif(f.length){c.e.from=f\n}if(e.length){c.e.to=e\n}if(d.length){c.e.cc=d\n}}return c\n});\nreturn a\n};\nZmOffline.recreateMsg=function(b){var a=[].concat(b).map(function(c){if(Array.isArray(c.f)){c.f=c.f.join()\n}if(Array.isArray(c.su)){c.su=c.su.join(\" \")\n}if(Array.isArray(c.fr)){c.fr=c.fr.join(\" \")\n}if(Array.isArray(c.tn)){c.tn=c.tn.join()\n}if(c.e){delete c.e.from;\ndelete c.e.to;\ndelete c.e.cc\n}return c\n});\nreturn a\n};\nZmOffline.modifyContact=function(b){var a=[].concat(b).map(function(c){if(c.tn){c.tn=c.tn.split(\",\")\n}if(c._attrs){if(c._attrs.jobTitle){c._attrs.jobTitle=c._attrs.jobTitle.split(\" \")\n}}return c\n});\nreturn a\n};\nZmOffline.recreateContact=function(b){var a=[].concat(b).map(function(c){if(Array.isArray(c.tn)){c.tn=c.tn.join()\n}if(c._attrs){if(Array.isArray(c._attrs.jobTitle)){c._attrs.jobTitle=c._attrs.jobTitle.join(\" \")\n}}ZmOffline._cacheContactMember(c);\nreturn c\n});\nreturn a\n};\nZmOffline._cacheContactMember=function(b){var c=b.m;\nif(!c||!Array.isArray(c)||appCtxt.cacheGet(b.id)){return\n}var d=ZmContact.createFromDom(b,{});\nvar a=new ZmCsfeResult({GetContactsResponse:{cn:[b]}});\nZmContact.prototype._handleLoadResponse.call(d,null,a)\n};\nZmOffline.refreshStatusIcon=function(a){if(appCtxt.isWebClientOffline()){$(\"#\"+ZmId.SKIN_OFFLINE_STATUS).addClass(\"ImgDisconnect\").removeClass(\"ImgOfflineSync\").attr(\"title\",ZmMsg.OfflineServerNotReachable)\n}else{if(a){$(\"#\"+ZmId.SKIN_OFFLINE_STATUS).addClass(\"ImgOfflineSync\").removeClass(\"ImgDisconnect\").attr(\"title\",ZmMsg.offlineCachingSync)\n}else{$(\"#\"+ZmId.SKIN_OFFLINE_STATUS).removeClass(\"ImgOfflineSync ImgDisconnect\").attr(\"title\",ZmMsg.offlineCachingDone)\n}}};\nZmOffline.handleLogOff=function(b,a){if(b){ZmOfflineSettingsDialog.showConfirmSignOutDialog()\n}else{if(a){appCtxt.reloadAppCache();\nsetTimeout(ZmZimbraMail.logOff,1000)\n}}}\n}};\n"
                    },
                    "redirectURL": "",
                    "headersSize": 364,
                    "bodySize": 483713
                },
                "cache": {},
                "timings": {
                    "send": 0,
                    "wait": 0,
                    "receive": 0
                }
            }
        ],
        "_webSocketEntries": {},
        "_settings": {
            "_proxy": {}
        }
    }
}
