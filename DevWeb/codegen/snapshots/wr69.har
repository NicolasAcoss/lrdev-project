{
    "log": {
        "version": "1.2",
        "creator": {
            "name": "DevWeb",
            "version": "1.2"
        },
        "pages": [
            {
                "startedDateTime": "2022-12-06T11:38:18.200283Z",
                "id": "page_1",
                "title": "https://mail.etu.univ-lorraine.fr/zimbra/js/Calendar_all.js.zgz",
                "pageTimings": {}
            }
        ],
        "entries": [
            {
                "pageref": "page_1",
                "startedDateTime": "2022-12-06T11:38:18.200283Z",
                "time": 0,
                "_isResource": false,
                "request": {
                    "method": "GET",
                    "url": "https://mail.etu.univ-lorraine.fr/zimbra/js/Calendar_all.js.zgz?v=220726112844",
                    "httpVersion": "HTTP/2.0",
                    "cookies": [
                        {
                            "name": "UL-AUTHTRACE",
                            "value": "TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA",
                            "httpOnly": false
                        },
                        {
                            "name": "JSESSIONID",
                            "value": "node01ewv5q86m64i21vkfxtflutla86873.node0",
                            "httpOnly": false
                        },
                        {
                            "name": "ZM_AUTH_TOKEN",
                            "value": "0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b",
                            "httpOnly": false
                        }
                    ],
                    "headers": [
                        {
                            "name": "accept",
                            "value": "*/*"
                        },
                        {
                            "name": "accept-encoding",
                            "value": "gzip, deflate, br"
                        },
                        {
                            "name": "accept-language",
                            "value": "fr,fr-FR;q=0.8,en-US;q=0.5,en;q=0.3"
                        },
                        {
                            "name": "cookie",
                            "value": "UL-AUTHTRACE=TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA; JSESSIONID=node01ewv5q86m64i21vkfxtflutla86873.node0; ZM_AUTH_TOKEN=0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b"
                        },
                        {
                            "name": "dnt",
                            "value": "1"
                        },
                        {
                            "name": "referer",
                            "value": "https://mail.etu.univ-lorraine.fr/"
                        },
                        {
                            "name": "sec-fetch-dest",
                            "value": "empty"
                        },
                        {
                            "name": "sec-fetch-mode",
                            "value": "cors"
                        },
                        {
                            "name": "sec-fetch-site",
                            "value": "same-origin"
                        },
                        {
                            "name": "te",
                            "value": "trailers"
                        },
                        {
                            "name": "user-agent",
                            "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101 Firefox/102.0"
                        }
                    ],
                    "queryString": [
                        {
                            "name": "v",
                            "value": "220726112844"
                        }
                    ],
                    "headersSize": -1,
                    "bodySize": -1
                },
                "response": {
                    "status": 200,
                    "statusText": "OK",
                    "httpVersion": "HTTP/2.0",
                    "cookies": null,
                    "headers": [
                        {
                            "name": "accept-ranges",
                            "value": "bytes"
                        },
                        {
                            "name": "cache-control",
                            "value": "public, max-age=2595600"
                        },
                        {
                            "name": "content-type",
                            "value": "text/javascript"
                        },
                        {
                            "name": "date",
                            "value": "Tue, 06 Dec 2022 10:38:18 GMT"
                        },
                        {
                            "name": "expires",
                            "value": "Thu, 5 Jan 2023 11:38:18 GMT"
                        },
                        {
                            "name": "last-modified",
                            "value": "Tue, 26 Jul 2022 15:29:26 GMT"
                        },
                        {
                            "name": "server",
                            "value": "nginx"
                        },
                        {
                            "name": "x-frame-options",
                            "value": "SAMEORIGIN"
                        },
                        {
                            "name": "x-recouv-allowed",
                            "value": "Recouv"
                        }
                    ],
                    "content": {
                        "size": 237503,
                        "mimeType": "",
                        "text": "\n/* \n* Zimbra Collaboration Suite Web Client\n* Copyright (C) 2004-2017 Synacor, Inc.\n* https://www.zimbra.com/license\n*/\nif(AjxPackage.define(\"Calendar\")){if(AjxPackage.define(\"zimbraMail.calendar.view.ZmApptListView\")){ZmApptListView=function(d,c,b,a){if(arguments.length==0){return\n}var e=Dwt.getParams(arguments,ZmApptListView.PARAMS);\ne.headerList=this._getHeaderList();\ne.view=e.view||ZmId.VIEW_CAL_TRASH;\nZmListView.call(this,e);\nthis._bSortAsc=true;\nthis._defaultSortField=ZmItem.F_DATE;\nthis.setDragSource(e.controller._dragSrc)\n};\nZmApptListView.prototype=new ZmListView;\nZmApptListView.prototype.constructor=ZmApptListView;\nZmApptListView.prototype.toString=function(){return\"ZmApptListView\"\n};\nZmApptListView.PARAMS=[\"parent\",\"posStyle\",\"controller\",\"dropTgt\"];\nZmApptListView.COL_WIDTH_DATE=ZmMsg.COLUMN_WIDTH_DATE_CAL;\nZmApptListView.COL_WIDTH_LOCATION=ZmMsg.COLUMN_WIDTH_LOCATION_CAL;\nZmApptListView.COL_WIDTH_STATUS=ZmMsg.COLUMN_WIDTH_STATUS_CAL;\nZmApptListView.COL_WIDTH_FOLDER=ZmMsg.COLUMN_WIDTH_FOLDER_CAL;\nZmApptListView.prototype.getApptList=function(){return this._apptList\n};\nZmApptListView.prototype.refresh=function(){if(this.needsRefresh()){var a=this.getSelection();\nthis.set(this.getApptList());\nif(a){this.setSelectedItems(a)\n}this.setNeedsRefresh(false)\n}};\nZmApptListView.prototype.needsRefresh=function(){var a=this._controller;\nreturn a.getCurrentView().needsRefresh()\n};\nZmApptListView.prototype.setNeedsRefresh=function(b){var a=this._controller;\nif(a.getCurrentView().setNeedsRefresh){return a.getCurrentView().setNeedsRefresh(b)\n}return null\n};\nZmApptListView.prototype.getAtttendees=function(){return null\n};\nZmApptListView.prototype.updateTimeIndicator=function(a){};\nZmApptListView.prototype.startIndicatorTimer=function(a){};\nZmApptListView.prototype.checkIndicatorNeed=function(b,a){};\nZmApptListView.prototype._getToolTip=function(d){var b,c=d.field,a=d.item;\nif(c&&(c==ZmItem.F_SELECTION||c==ZmItem.F_TAG)){b=ZmListView.prototype._getToolTip.apply(this,arguments)\n}else{if(a.getToolTip){b=a.getToolTip(this._controller)\n}}return b\n};\nZmApptListView.prototype._sortList=function(b,a){ZmApptListView.sortByAsc=this._bSortAsc;\nswitch(a){case ZmItem.F_SUBJECT:b.sort(ZmApptListView._sortSubject);\nbreak;\ncase ZmItem.F_STATUS:b.sort(ZmApptListView._sortStatus);\nbreak;\ncase ZmItem.F_FOLDER:b.sort(ZmApptListView._sortFolder);\nbreak;\ncase ZmItem.F_DATE:b.sort(ZmApptListView._sortDate);\nbreak\n}};\nZmApptListView.prototype._sortColumn=function(a,c){this._defaultSortField=a._field;\nvar b=this.getList();\nb=b&&b.clone();\nif(b){this._sortList(b,a._field);\nthis.set(b,null,true)\n}};\nZmApptListView.prototype._getHeaderToolTip=function(b,a){switch(b){case ZmItem.F_LOCATION:return ZmMsg.location;\ncase ZmItem.F_FOLDER:return ZmMsg.calendar;\ncase ZmItem.F_DATE:return ZmMsg.date;\ncase ZmItem.F_RECURRENCE:return ZmMsg.recurrence\n}return ZmListView.prototype._getHeaderToolTip.call(this,b,a)\n};\nZmApptListView.prototype._getHeaderList=function(){var a=[];\nif(appCtxt.get(ZmSetting.SHOW_SELECTION_CHECKBOX)){a.push(new DwtListHeaderItem({field:ZmItem.F_SELECTION,icon:\"CheckboxUnchecked\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.selection}))\n}if(appCtxt.get(ZmSetting.TAGGING_ENABLED)){a.push(new DwtListHeaderItem({field:ZmItem.F_TAG,icon:\"Tag\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.tag}))\n}a.push(new DwtListHeaderItem({field:ZmItem.F_ATTACHMENT,icon:\"Attachment\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.attachment}));\na.push(new DwtListHeaderItem({field:ZmItem.F_SUBJECT,text:ZmMsg.subject,noRemove:true,sortable:ZmItem.F_SUBJECT}));\na.push(new DwtListHeaderItem({field:ZmItem.F_LOCATION,text:ZmMsg.location,width:ZmApptListView.COL_WIDTH_LOCATION,resizeable:true}));\na.push(new DwtListHeaderItem({field:ZmItem.F_STATUS,text:ZmMsg.status,width:ZmApptListView.COL_WIDTH_STATUS,resizeable:true,sortable:ZmItem.F_STATUS}));\na.push(new DwtListHeaderItem({field:ZmItem.F_FOLDER,text:ZmMsg.calendar,width:ZmApptListView.COL_WIDTH_FOLDER,resizeable:true,sortable:ZmItem.F_FOLDER}));\na.push(new DwtListHeaderItem({field:ZmItem.F_RECURRENCE,icon:\"ApptRecur\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.recurrence}));\na.push(new DwtListHeaderItem({field:ZmItem.F_DATE,text:ZmMsg.startDate,width:ZmApptListView.COL_WIDTH_DATE,sortable:ZmItem.F_DATE}));\nreturn a\n};\nZmApptListView.prototype._itemClicked=function(){ZmListView.prototype._itemClicked.apply(this,arguments);\nthis._controller.setCurrentListView(this)\n};\nZmApptListView.prototype.set=function(a,d,b){this._apptList=a;\nif(!b){if((this._defaultSortField!=ZmItem.F_DATE)||(this._defaultSortField==ZmItem.F_DATE&&!this._bSortAsc)){this._sortList(a,this._defaultSortField)\n}}ZmListView.prototype.set.call(this,a,this._defaultSortField);\nthis._resetColWidth();\nvar c=this.getSize();\nthis._listDiv.style.height=(c.y-DwtListView.HEADERITEM_HEIGHT)+\"px\"\n};\nZmApptListView.prototype._getItemId=function(a){var b=(a&&a.id)?a.getUniqueId(true):Dwt.getNextId();\nreturn DwtId.getListViewItemId(DwtId.WIDGET_ITEM,this._view,b)\n};\nZmApptListView.prototype._getFieldId=function(a,b){var c=(a&&a.getUniqueId)?a.getUniqueId(true):a.id;\nreturn DwtId.getListViewItemId(DwtId.WIDGET_ITEM_FIELD,this._view,c,b)\n};\nZmApptListView.prototype._getCellId=function(a,b){if(b==ZmItem.F_SUBJECT||b==ZmItem.F_DATE||b==ZmItem.F_LOCATION||b==ZmItem.F_STATUS||b==ZmItem.F_FOLDER){return this._getFieldId(a,b)\n}};\nZmApptListView.prototype._getCellContents=function(k,j,b,i,e,d){if(i==ZmItem.F_RECURRENCE){var h;\nif(b.isException){h=\"ApptExceptionIndicator\"\n}else{if(b.isRecurring()){h=\"ApptRecur\"\n}}j=this._getImageHtml(k,j,h,this._getFieldId(b,i))\n}else{if(i==ZmItem.F_SUBJECT){k[j++]=AjxStringUtil.htmlEncode(b.getName(),true);\nif(appCtxt.get(ZmSetting.SHOW_FRAGMENTS)&&b.fragment){k[j++]=this._getFragmentSpan(b)\n}}else{if(i==ZmItem.F_LOCATION){k[j++]=AjxStringUtil.htmlEncode(b.getLocation(),true)\n}else{if(i==ZmItem.F_STATUS){if(b.otherAttendees){k[j++]=b.getParticipantStatusStr()\n}}else{if(i==ZmItem.F_FOLDER){var f=b.getFolder();\nvar g=f.rgb||ZmOrganizer.COLOR_VALUES[f.color||ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.CALENDAR]];\nvar a=ZmCalBaseView._getColors(g);\nvar c={folder:f,folderColor:a.standard.header.bgcolor,folderName:f.getName(),id:Dwt.getNextId()};\nk[j++]=AjxTemplate.expand(\"calendar.Calendar#ListViewFolder\",c)\n}else{if(i==ZmItem.F_DATE){k[j++]=(b.isAllDayEvent())?AjxMessageFormat.format(ZmMsg.apptDateTimeAllDay,[b.startDate]):AjxMessageFormat.format(ZmMsg.apptDateTime,[b.startDate,b.startDate])\n}else{j=ZmListView.prototype._getCellContents.apply(this,arguments)\n}}}}}}return j\n};\nZmApptListView.prototype._getLabelForField=function(b,c){switch(c){case ZmItem.F_RECURRENCE:if(b.isException){return ZmMsg.recurrenceException\n}else{if(b.isRecurring()){return ZmMsg.recurrence\n}else{return\"\"\n}}case ZmItem.F_SUBJECT:return b.getName()||ZmMsg.noSubject;\ncase ZmItem.F_LOCATION:return b.location||ZmMsg.noLocation;\ncase ZmItem.F_STATUS:return b.otherAttendees&&b.getParticipantStatusStr();\ncase ZmItem.F_FOLDER:return b.getFolder().getName();\ncase ZmItem.F_ATTACHMENT:return b.hasAttach&&ZmMsg.hasAttachment;\ncase ZmItem.F_TAG:if(b.tags.length>0){var a=b.tags.join(\" & \");\nreturn AjxMessageFormat.format(ZmMsg.taggedAs,[a])\n}break;\ncase ZmItem.F_DATE:if(b.isAllDayEvent()){return AjxMessageFormat.format(ZmMsg.apptDateTimeAllDay,[b.startDate])\n}else{return AjxMessageFormat.format(ZmMsg.apptDateTime,[b.startDate,b.startDate])\n}}return ZmListView.prototype._getLabelForField.apply(this,arguments)\n};\nZmApptListView._sortSubject=function(e,d){var c=e.getName().toLowerCase();\nvar f=d.getName().toLowerCase();\nif(c<f){return ZmApptListView.sortByAsc?-1:1\n}else{if(c>f){return ZmApptListView.sortByAsc?1:-1\n}else{return 0\n}}};\nZmApptListView._sortStatus=function(e,d){if(!e.otherAttendees){return ZmApptListView.sortByAsc?-1:1\n}if(!d.otherAttendees){return ZmApptListView.sortByAsc?1:-1\n}var c=e.getParticipantStatusStr();\nvar f=d.getParticipantStatusStr();\nif(c<f){return ZmApptListView.sortByAsc?-1:1\n}else{if(c>f){return ZmApptListView.sortByAsc?1:-1\n}else{return 0\n}}};\nZmApptListView._sortFolder=function(e,d){var c=e.getFolder().getName();\nvar f=d.getFolder().getName();\nif(c<f){return ZmApptListView.sortByAsc?-1:1\n}else{if(c>f){return ZmApptListView.sortByAsc?1:-1\n}else{return 0\n}}};\nZmApptListView._sortDate=function(e,d){var c=e.startDate.getTime();\nvar f=d.startDate.getTime();\nif(c<f){return ZmApptListView.sortByAsc?-1:1\n}else{if(c>f){return ZmApptListView.sortByAsc?1:-1\n}else{return 0\n}}}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalViewMgr\")){ZmCalViewMgr=function(c,b,a){DwtComposite.call(this,{parent:c,className:\"ZmCalViewMgr\",posStyle:Dwt.ABSOLUTE_STYLE});\nthis.addControlListener(new AjxListener(this,this._controlListener));\nthis._controller=b;\nthis._dropTgt=a;\nthis._showNewScheduleView=appCtxt.get(ZmSetting.FREE_BUSY_VIEW_ENABLED);\nthis._views={};\nthis._date=new Date();\nthis._viewFactory={};\nthis._viewFactory[ZmId.VIEW_CAL_DAY]=ZmCalDayTabView;\nthis._viewFactory[ZmId.VIEW_CAL_WORK_WEEK]=ZmCalWorkWeekView;\nthis._viewFactory[ZmId.VIEW_CAL_WEEK]=ZmCalWeekView;\nthis._viewFactory[ZmId.VIEW_CAL_MONTH]=ZmCalMonthView;\nthis._viewFactory[ZmId.VIEW_CAL_LIST]=ZmCalListView;\nthis._viewFactory[ZmId.VIEW_CAL_FB]=ZmCalNewScheduleView;\nthis._viewFactory[ZmId.VIEW_CAL_TRASH]=ZmApptListView\n};\nZmCalViewMgr.prototype=new DwtComposite;\nZmCalViewMgr.prototype.constructor=ZmCalViewMgr;\nZmCalViewMgr._SEP=5;\nZmCalViewMgr.MIN_CONTENT_SIZE=100;\nZmCalViewMgr.prototype.toString=function(){return\"ZmCalViewMgr\"\n};\nZmCalViewMgr.prototype.TEMPLATE=\"calendar.Calendar#ZmCalViewMgr\";\nZmCalViewMgr.prototype._subContentShown=false;\nZmCalViewMgr.prototype._subContentInitialized=false;\nZmCalViewMgr.prototype.getController=function(){return this._controller\n};\nZmCalViewMgr.prototype.setNeedsRefresh=function(){for(var a in this._views){this._views[a].setNeedsRefresh(true)\n}};\nZmCalViewMgr.prototype.layoutWorkingHours=function(){for(var a in this._views){if(a==ZmId.VIEW_CAL_DAY||a==ZmId.VIEW_CAL_WORK_WEEK||a==ZmId.VIEW_CAL_WEEK||a==ZmId.VIEW_CAL_FB){this._views[a].layoutWorkingHours()\n}}};\nZmCalViewMgr.prototype.needsRefresh=function(a){a=a||this._currentViewName;\nvar b=this._views[a];\nreturn b.needsRefresh?b.needsRefresh():false\n};\nZmCalViewMgr.prototype.getCurrentView=function(){return this._views[this._currentViewName]\n};\nZmCalViewMgr.prototype.getCurrentViewName=function(){return this._currentViewName\n};\nZmCalViewMgr.prototype.getView=function(a){return this._views[a]\n};\nZmCalViewMgr.prototype.getTitle=function(){return this.getCurrentView().getTitle()\n};\nZmCalViewMgr.prototype.getDate=function(){return this._date\n};\nZmCalViewMgr.prototype.setDate=function(c,d,b){this._date=new Date(c.getTime());\nthis._duration=d;\nif(this._currentViewName){var a=this._views[this._currentViewName];\na.setDate(c,d,b)\n}};\nZmCalViewMgr.prototype.createView=function(c){var b=new this._viewFactory[c](this,DwtControl.ABSOLUTE_STYLE,this._controller,this._dropTgt);\nif(c!=ZmId.VIEW_CAL_TRASH){b.addTimeSelectionListener(new AjxListener(this,this._viewTimeSelectionListener));\nb.addDateRangeListener(new AjxListener(this,this._viewDateRangeListener));\nb.addViewActionListener(new AjxListener(this,this._viewActionListener))\n}this._views[c]=b;\nif(c==ZmId.VIEW_CAL_TRASH){var a=this._controller;\nb.addSelectionListener(new AjxListener(a,a._listSelectionListener));\nb.addActionListener(new AjxListener(a,a._listActionListener))\n}return b\n};\nZmCalViewMgr.prototype.getSubContentView=function(){return this._list||this._createSubContent()\n};\nZmCalViewMgr.prototype.getSelTrashCount=function(){var b=this._controller.getCheckedCalendars(true);\nthis._multiAccTrashQuery=[];\nfor(var a=0;\na<b.length;\na++){if(b[a].nId==ZmOrganizer.ID_TRASH){this._multiAccTrashQuery.push([\"inid:\",'\"',b[a].getAccount().id,\":\",ZmOrganizer.ID_TRASH,'\"'].join(\"\"))\n}}return this._multiAccTrashQuery.length\n};\nZmCalViewMgr.prototype.setSubContentVisible=function(b){if(appCtxt.multiAccounts){var a=this.getSelTrashCount();\nif(a<1){this._subContentShown=false;\nthis._subContentInitialized=true;\nthis._controller.setCurrentListView(null)\n}else{this._subContentShown=true\n}}else{if(this._subContentShown!=b){this._subContentShown=b;\nif(!b){this._controller.setCurrentListView(null)\n}}}this._layout()\n};\nZmCalViewMgr.prototype._createSubContent=function(){if(!this._subContentShown){return null\n}if(this._subContentInitialized){return this._list\n}this._subContentInitialized=true;\nthis._sash=new DwtSash({parent:this,posStyle:Dwt.ABSOLUTE_STYLE,style:DwtSash.VERTICAL_STYLE});\nthis._sash.registerCallback(this._handleSashAdjustment,this);\nthis._list=this.createView(ZmId.VIEW_CAL_TRASH);\nthis._list.set(new AjxVector([]));\nthis._populateTrashListView(this._list);\nreturn this._list\n};\nZmCalViewMgr.prototype._handleSashAdjustment=function(d){var c=this._sash.getLocation();\nif(c.y+d<ZmCalViewMgr.MIN_CONTENT_SIZE){d=ZmCalViewMgr.MIN_CONTENT_SIZE-c.y\n}else{var b=this.getSize();\nif(c.y+d>b.y-ZmCalViewMgr.MIN_CONTENT_SIZE){d=b.y-ZmCalViewMgr.MIN_CONTENT_SIZE-c.y\n}}if(d!=0){var a=this._list.getSize();\nthis._list.setSize(a.x,a.y-d);\nthis._layoutControls(true)\n}return d\n};\nZmCalViewMgr.prototype._populateTrashListView=function(a){var c={searchFor:ZmItem.APPT,limit:20,types:AjxVector.fromArray([ZmId.ITEM_APPOINTMENT]),forceSearch:true,callback:new AjxCallback(this,this._populateTrashListViewResults,[a])};\nif(appCtxt.multiAccounts){c.query=this._multiAccTrashQuery.join(\" OR \");\nc.account=appCtxt.accountList.mainAccount.name\n}else{c.query=\"inid:\"+ZmOrganizer.ID_TRASH\n}var b=new ZmSearch(c);\nb.execute(c)\n};\nZmCalViewMgr.prototype._populateTrashListViewResults=function(b,c){var d=c&&c._data;\nvar a=d&&d._results&&d._results.APPT;\nb.set(a||new AjxVector([]))\n};\nZmCalViewMgr.prototype.addViewActionListener=function(a){this.addListener(ZmCalBaseView.VIEW_ACTION,a)\n};\nZmCalViewMgr.prototype.removeViewActionListener=function(a){this.removeListener(ZmCalBaseView.VIEW_ACTION,a)\n};\nZmCalViewMgr.prototype.addTimeSelectionListener=function(a){this.addListener(ZmCalBaseView.TIME_SELECTION,a)\n};\nZmCalViewMgr.prototype.removeTimeSelectionListener=function(a){this.removeListener(ZmCalBaseView.TIME_SELECTION,a)\n};\nZmCalViewMgr.prototype.addDateRangeListener=function(a){this.addListener(DwtEvent.DATE_RANGE,a)\n};\nZmCalViewMgr.prototype.removeDateRangeListener=function(a){this.removeListener(DwtEvent.DATE_RANGE,a)\n};\nZmCalViewMgr.prototype.setView=function(c){if(c!=this._currentViewName){if(this._currentViewName){this._views[this._currentViewName].setLocation(Dwt.LOC_NOWHERE,Dwt.LOC_NOWHERE)\n}var a=this._views[c];\nthis._currentViewName=c;\nvar b=a.getDate();\nif(b==null||(a.getDate().getTime()!=this._date.getTime())){a.setDate(this._date,this._duration,true)\n}this._layout()\n}};\nZmCalViewMgr.prototype._layout=function(){var a=this._subContentShown;\nif(a&&!this._subContentInitialized){this._createSubContent();\nvar b=this.getSize();\nthis._list.setSize(null,b.y/3)\n}if(appCtxt.multiAccounts&&this._subContentInitialized){this._populateTrashListView(this._list)\n}if(this._sash){this._sash.setVisible(a);\nthis._list.setVisible(a)\n}this._layoutControls()\n};\nZmCalViewMgr.prototype._layoutControls=function(g){var d=this.getSize();\nvar f=d.y;\nif(this._subContentShown){var c=this._list.getSize();\nvar e=this._sash.getSize();\nvar b=c.y+e.y;\nf-=b;\nif(!g){this._sash.setBounds(0,f,d.x,e.y)\n}this._list.setBounds(0,f+e.y,d.x,c.y)\n}var a=this._views[this._currentViewName];\na.setBounds(0,0,d.x,f);\nif(a instanceof ZmCalBaseView){a.layoutView()\n}};\nZmCalViewMgr.prototype._controlListener=function(a){if(a.oldHeight!=a.newHeight||a.oldWidth!=a.newWidth){this._layout()\n}};\nZmCalViewMgr.prototype._viewTimeSelectionListener=function(a){this.notifyListeners(ZmCalBaseView.TIME_SELECTION,a)\n};\nZmCalViewMgr.prototype._viewActionListener=function(a){this.notifyListeners(ZmCalBaseView.VIEW_ACTION,a)\n};\nZmCalViewMgr.prototype._viewSelectionListener=function(a){};\nZmCalViewMgr.prototype._viewDateRangeListener=function(a){if(this.isListenerRegistered(DwtEvent.DATE_RANGE)){this.notifyListeners(DwtEvent.DATE_RANGE,a)\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalBaseView\")){ZmCalBaseView=function(f,e,d,b,a,c){if(arguments.length==0){return\n}DwtComposite.call(this,{parent:f,className:e,posStyle:d,id:ZmId.getViewId(a)});\nthis._isReadOnly=c;\nthis._setMouseEventHdlrs();\nthis.setCursor(\"default\");\nthis.addListener(DwtEvent.ONMOUSEOUT,this._mouseOutListener.bind(this));\nthis.addListener(DwtEvent.ONDBLCLICK,this._doubleClickListener.bind(this));\nthis.addListener(DwtEvent.ONMOUSEDOWN,this._mouseDownListener.bind(this));\nthis.addListener(DwtEvent.ONMOUSEUP,this._mouseUpListener.bind(this));\nthis.addListener(DwtEvent.ONMOUSEMOVE,this._mouseMoveListener.bind(this));\nthis.addListener(DwtEvent.ONFOCUS,this._focusListener.bind(this));\nthis._controller=b;\nthis.view=a;\nthis._evtMgr=new AjxEventMgr();\nthis._selectedItems=new AjxVector();\nthis._selEv=new DwtSelectionEvent(true);\nthis._actionEv=new DwtListViewActionEvent(true);\nthis._focusFirstAppt=true;\nthis._normalClass=\"appt\";\nthis._selectedClass=[this._normalClass,DwtCssStyle.SELECTED].join(\"-\");\nthis._disabledSelectedClass=[this._selectedClass,DwtCssStyle.DISABLED].join(\"-\");\nthis._data={};\nthis._timeRangeStart=0;\nthis._timeRangeEnd=0;\nthis.addControlListener(this._controlListener.bind(this));\nthis._createHtml();\nthis._needsRefresh=true\n};\nZmCalBaseView.prototype=new DwtComposite;\nZmCalBaseView.prototype.constructor=ZmCalBaseView;\nZmCalBaseView.TIME_SELECTION=\"ZmCalTimeSelection\";\nZmCalBaseView.VIEW_ACTION=\"ZmCalViewAction\";\nZmCalBaseView.TYPE_APPTS_DAYGRID=1;\nZmCalBaseView.TYPE_APPT=2;\nZmCalBaseView.TYPE_HOURS_COL=3;\nZmCalBaseView.TYPE_APPT_BOTTOM_SASH=4;\nZmCalBaseView.TYPE_APPT_TOP_SASH=5;\nZmCalBaseView.TYPE_DAY_HEADER=6;\nZmCalBaseView.TYPE_MONTH_DAY=7;\nZmCalBaseView.TYPE_ALL_DAY=8;\nZmCalBaseView.TYPE_SCHED_FREEBUSY=9;\nZmCalBaseView.TYPE_DAY_SEP=10;\nZmCalBaseView.headerColorDelta=0;\nZmCalBaseView.bodyColorDelta=0.5;\nZmCalBaseView.deepenColorAdjustment=0.9;\nZmCalBaseView.darkThreshold=(256*3)/2;\nZmCalBaseView.deepenThreshold=0.3;\nZmCalBaseView.WORK_HOURS_TIME_FORMAT=\"HHmm\";\nZmCalBaseView._getColors=function(b){b=b||ZmOrganizer.COLOR_VALUES[ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.CALENDAR]];\nvar g={bgcolor:AjxColor.darken(b,ZmCalBaseView.headerColorDelta)};\nvar c={bgcolor:AjxColor.deepen(g.bgcolor,ZmCalBaseView.deepenColorAdjustment)};\nvar h={bgcolor:AjxColor.lighten(b,ZmCalBaseView.bodyColorDelta)};\nvar d={bgcolor:AjxColor.deepen(h.bgcolor,ZmCalBaseView.deepenColorAdjustment)};\nvar e=AjxColor.components(g.bgcolor);\nvar a=AjxColor.components(c.bgcolor);\nvar i=e[0]+e[1]+e[2];\nvar f=a[0]+a[1]+a[2];\nif(i/f>1-ZmCalBaseView.deepenThreshold){g.bgcolor=AjxColor.lighten(c.bgcolor,ZmCalBaseView.deepenThreshold);\nh.bgcolor=AjxColor.lighten(d.bgcolor,ZmCalBaseView.deepenThreshold)\n}g.color=ZmCalBaseView._isDark(g.bgcolor)&&\"#ffffff\";\nc.color=ZmCalBaseView._isDark(c.bgcolor)&&\"#ffffff\";\nh.color=ZmCalBaseView._isDark(h.bgcolor)&&\"#ffffff\";\nd.color=ZmCalBaseView._isDark(d.bgcolor)&&\"#ffffff\";\nreturn{standard:{header:g,body:h},deeper:{header:c,body:d}}\n};\nZmCalBaseView.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_CALENDAR\n};\nZmCalBaseView.prototype.handleKeyAction=function(a,c){switch(a){case ZmKeyMap.NEXT_APPT:case ZmKeyMap.PREV_APPT:this._iterateSelection(a===ZmKeyMap.NEXT_APPT);\nreturn true;\ncase ZmKeyMap.NEXT_DAY:case ZmKeyMap.PREV_DAY:this._iterateSelection(a===ZmKeyMap.NEXT_DAY,function(d){return d.startDate.toDateString()\n});\nreturn true;\ncase ZmKeyMap.PREV_PAGE:case ZmKeyMap.NEXT_PAGE:this._paginate(a===ZmKeyMap.NEXT_PAGE);\nreturn true;\ncase DwtKeyMap.CANCEL:this.deselectAll();\nreturn true;\ncase DwtKeyMap.SELECT:return this._doubleClickListener(c);\ncase DwtKeyMap.SUBMENU:var b=this.getTargetItemDiv(c).getBoundingClientRect();\nc.item=this.getTargetItem(c);\nc.docX=b.left+b.width/2;\nc.docY=b.top+b.height/2;\nthis._evtMgr.notifyListeners(DwtEvent.ACTION,c);\nreturn true\n}return DwtComposite.prototype.handleKeyAction.apply(this,arguments)\n};\nZmCalBaseView.prototype._paginate=function(a){this._focusFirstAppt=a;\nthis._controller._paginate(this.view,a)\n};\nZmCalBaseView.prototype._iterateSelection=function(b,g){var f=this.getList();\nif(!f.size()){this._paginate(b);\nreturn\n}if(this.getSelectionCount()==0){this.setSelection(b?f.get(0):f.getLast())\n}if(!g){g=function(i){return i\n}\n}var h=this.getSelection()[0];\nvar a=f.indexOf(h);\nvar d=g(h);\nfor(var c=a;\nc<f.size()&&c>=0;\nc+=(b?1:-1)){var e=f.get(c);\nif(g(e)!=d){this.setSelection(e);\nreturn\n}}this._paginate(b)\n};\nZmCalBaseView._toColorsCss=function(c){var b=[\"background-color:\",c.bgcolor,\";\"];\nif(c.color){b.push(\"color:\",c.color,\";\")\n}return b.join(\"\")\n};\nZmCalBaseView._isDark=function(a){var b=AjxColor.components(a);\nreturn b[0]+b[1]+b[2]<ZmCalBaseView.darkThreshold\n};\nZmCalBaseView.prototype.getController=function(){return this._controller\n};\nZmCalBaseView.prototype.firstDayOfWeek=function(){return appCtxt.get(ZmSetting.CAL_FIRST_DAY_OF_WEEK)||0\n};\nZmCalBaseView.getWorkingHours=function(){return appCtxt.get(ZmSetting.CAL_WORKING_HOURS)||0\n};\nZmCalBaseView.parseWorkingHours=function(s){if(s===0){return[]\n}var o=appCtxt.get(ZmSetting.DEFAULT_TIMEZONE),h=AjxTimezone.getServerId(AjxTimezone.DEFAULT),v=s.split(\",\"),q,x=[],r,g,p,n,b=0,k,c=new Date(),t=new Date(),j,z,y,m=t.getDay(),e=new AjxDateFormat(ZmCalBaseView.WORK_HOURS_TIME_FORMAT);\nfunction d(i){return x[i]&&x[i].isWorkingDay\n}function l(i,A,w){if(d(i)){a(i,A,w)\n}else{u(i,A,w)\n}}function f(i){x[i]={};\nx[i].isWorkingDay=false;\nx[i].startTime=[\"0000\"];\nx[i].endTime=[\"0000\"]\n}function u(i,A,w){x[i]={};\nx[i].isWorkingDay=true;\nx[i].startTime=[A];\nx[i].endTime=[w]\n}function a(i,A,w){x[i].startTime.push(A);\nx[i].endTime.push(w)\n}if(o!=h){p=AjxTimezone.getOffset(AjxTimezone.getClientId(h),c);\nn=AjxTimezone.getOffset(AjxTimezone.getClientId(o),c);\nb=n-p\n}for(q=0;\nq<v.length;\nq++){r=v[q].split(\":\");\ng={};\nk=r[0]-1;\nif(r[1]===\"N\"){if(!d(k)){f(k)\n}continue\n}if(b){t=new Date();\nc=new Date();\nt.setHours(r[3]/100,r[3]%100);\nj=t.getHours()*60+t.getMinutes()-b;\nt.setHours(j/60,j%60);\ny=t.getDay();\nc.setHours(r[2]/100,r[2]%100);\nj=c.getHours()*60+c.getMinutes()-b;\nc.setHours(j/60,j%60);\nz=c.getDay();\nif(z==m&&y==m){l(k,e.format(c),e.format(t))\n}else{if((y==0&&z==6)||(z<m&&y==m)){z=k-1;\nif(z<0){z=6\n}l(z,e.format(c),\"2400\");\nl(k,\"0000\",e.format(t))\n}else{if((z==6&&y==0)||(z==m&&y>m)){y=k+1;\nif(y>6){y=0\n}l(y,\"0000\",e.format(t));\nl(k,e.format(c),\"2400\")\n}else{if(z<m&&y<m&&z==y){z=k-1;\nl(z,e.format(c),e.format(t));\nif(!d(k)){f(k)\n}}else{if(z>m&&y>m&&z==y){y=k+1;\nl(y,e.format(c),e.format(t));\nif(!d(k)){f(k)\n}}}}}}}else{l(k,r[2],r[3])\n}}return x\n};\nZmCalBaseView.prototype.addViewActionListener=function(a){this._evtMgr.addListener(ZmCalBaseView.VIEW_ACTION,a)\n};\nZmCalBaseView.prototype.removeViewActionListener=function(a){this._evtMgr.removeListener(ZmCalBaseView.VIEW_ACTION,a)\n};\nZmCalBaseView.prototype.addSelectionListener=function(a){this._evtMgr.addListener(DwtEvent.SELECTION,a)\n};\nZmCalBaseView.prototype.removeSelectionListener=function(a){this._evtMgr.removeListener(DwtEvent.SELECTION,a)\n};\nZmCalBaseView.prototype.addActionListener=function(a){this._evtMgr.addListener(DwtEvent.ACTION,a)\n};\nZmCalBaseView.prototype.removeActionListener=function(a){this._evtMgr.removeListener(DwtEvent.ACTION,a)\n};\nZmCalBaseView.prototype.getList=function(){return this._list\n};\nZmCalBaseView.prototype.associateItemWithElement=function(c,a,b,d){DwtListView.prototype.associateItemWithElement.apply(this,arguments)\n};\nZmCalBaseView.prototype.getItemFromElement=function(a){return DwtListView.prototype.getItemFromElement.apply(this,arguments)\n};\nZmCalBaseView.prototype.getTargetItemDiv=function(a){return this.findItemDiv(DwtUiEvent.getTarget(a))\n};\nZmCalBaseView.prototype.getTargetItem=function(a){return this.findItem(DwtUiEvent.getTarget(a))\n};\nZmCalBaseView.prototype.findItem=function(a){return DwtListView.prototype.findItem.apply(this,arguments)\n};\nZmCalBaseView.prototype.findItemDiv=function(a){return DwtListView.prototype.findItemDiv.apply(this,arguments)\n};\nZmCalBaseView.prototype._getItemData=function(a,b,c){return DwtListView.prototype._getItemData.apply(this,arguments)\n};\nZmCalBaseView.prototype._setItemData=function(c,b,a){DwtListView.prototype._setItemData.apply(this,arguments)\n};\nZmCalBaseView.prototype.deselectAll=function(){this.deselectAppt(this._selectedItems)\n};\nZmCalBaseView.prototype._getStyle=function(c,b,a,d){return(!b)?this._normalClass:(a?this._disabledSelectedClass:this._selectedClass)\n};\nZmCalBaseView.prototype.getToolTipContent=function(b){var c=this.getTargetItemDiv(b);\nif(!c){return null\n}if(this._getItemData(c,\"type\")!=ZmCalBaseView.TYPE_APPT){return null\n}var a=this.getItemFromElement(c);\nreturn a.getToolTip(this._controller)\n};\nZmCalBaseView.prototype.getTooltipBase=function(a){return null\n};\nZmCalBaseView.prototype.getApptDetails=function(b,c,a){if(this._currentMouseOverApptId&&this._currentMouseOverApptId==a){this._currentMouseOverApptId=null;\nb.getDetails(null,c,null,null,true)\n}};\nZmCalBaseView.prototype._mouseOutListener=function(a){var b=this.getTargetItemDiv(a);\nif(!b){return\n}if(this._getItemData(b,\"type\")==ZmCalBaseView.TYPE_APPT){this.setToolTipContent(null)\n}this._mouseOutAction(a,b)\n};\nZmCalBaseView.prototype._mouseOutAction=function(a,b){return true\n};\nZmCalBaseView.prototype._mouseMoveListener=function(a){};\nZmCalBaseView.prototype._focusListener=function(b){var a=this.getTargetItem(b);\nif(a){this.setSelection(a)\n}};\nZmCalBaseView.prototype._findAncestor=function(b,a){while(b&&(b[a]==null)){b=b.parentNode\n}return b\n};\nZmCalBaseView.prototype._mouseDownListener=function(a){if(this._isReadOnly){return\n}var b=this.getTargetItemDiv(a);\nif(!b){return this._mouseDownAction(a,b)\n}this._clickDiv=b;\nif(this._getItemData(b,\"type\")==ZmCalBaseView.TYPE_APPT){if(a.button==DwtMouseEvent.LEFT||a.button==DwtMouseEvent.RIGHT){this._itemClicked(b,a);\nthis._controller.setCurrentListView(this)\n}}return this._mouseDownAction(a,b)\n};\nZmCalBaseView.prototype._mouseDownAction=function(a,b){return !Dwt.ffScrollbarCheck(a)\n};\nZmCalBaseView.prototype._mouseUpListener=function(a){delete this._clickDiv;\nreturn this._mouseUpAction(a,this.getTargetItemDiv(a))\n};\nZmCalBaseView.prototype._mouseUpAction=function(a,b){return !Dwt.ffScrollbarCheck(a)\n};\nZmCalBaseView.prototype._doubleClickAction=function(a,b){return true\n};\nZmCalBaseView.prototype._doubleClickListener=function(b){var e=this.getTargetItemDiv(b);\nif(!e){return\n}var c=false;\nif(this._getItemData(e,\"type\")==ZmCalBaseView.TYPE_APPT){if(this._evtMgr.isListenerRegistered(DwtEvent.SELECTION)){DwtUiEvent.copy(this._selEv,b);\nvar a=this.getItemFromElement(e);\nvar d=a.getOrig();\na=d&&d.isMultiDay()?d:a;\nthis._selEv.item=a;\nthis._selEv.detail=DwtListView.ITEM_DBL_CLICKED;\nthis._evtMgr.notifyListeners(DwtEvent.SELECTION,this._selEv);\nc=true\n}}return this._doubleClickAction(b,e)||c\n};\nZmCalBaseView.prototype._itemClicked=function(d,f){var a;\nvar c=this._selectedItems.contains(d);\nvar e=this.getItemFromElement(d);\nvar b=this._getItemData(d,\"type\");\nif(f.shiftKey&&c){this.deselectAppt([d])\n}else{if(!c){this.setSelection(e)\n}}if(f.button==DwtMouseEvent.RIGHT){DwtUiEvent.copy(this._actionEv,f);\nthis._actionEv.item=e;\nthis._evtMgr.notifyListeners(DwtEvent.ACTION,this._actionEv)\n}};\nZmCalBaseView.prototype.setSelectionCbox=function(b,a){};\nZmCalBaseView.prototype.setSelectionHdrCbox=function(a){};\nZmCalBaseView.prototype.setSelection=function(f,d){var e=this._getElFromItem(f);\nif(e){var c;\nvar b=this._selectedItems.getArray();\nvar h=this._selectedItems.size();\nfor(c=0;\nc<h;\nc++){b[c].className=this._getStyle(this._getItemData(b[c],\"type\"))\n}this._selectedItems.removeAll();\nthis._selectedItems.add(e);\ne.className=this._getStyle(this._getItemData(e,\"type\"),true,!this.getEnabled(),f);\nthis.setFocusElement(e);\nDwt.clearHandler(e,DwtEvent.ONCLICK);\nif(!d&&this._evtMgr.isListenerRegistered(DwtEvent.SELECTION)){var g=new DwtSelectionEvent(true);\ng.button=DwtMouseEvent.LEFT;\ng.target=e;\ng.item=f;\ng.detail=DwtListView.ITEM_SELECTED;\nthis._evtMgr.notifyListeners(DwtEvent.SELECTION,g)\n}}};\nZmCalBaseView.prototype._getItemCountType=function(){return ZmId.ITEM_APPOINTMENT\n};\nZmCalBaseView.prototype.getSelectionCount=function(){return this._selectedItems.size()\n};\nZmCalBaseView.prototype.getSelection=function(){var c=new Array();\nvar b=this._selectedItems.getArray();\nvar e=this._selectedItems.size();\nfor(var d=0;\nd<e;\nd++){c[d]=this.getItemFromElement(b[d])\n}return c\n};\nZmCalBaseView.prototype.getSelectedItems=function(){return this._selectedItems\n};\nZmCalBaseView.prototype.handleActionPopdown=function(b){ZmCalViewController._contextMenuOpened=false;\nif(b&&b._ev&&b._ev.type===\"mousedown\"){var c=DwtUiEvent.getTarget(b._ev),a=document.getElementById(this._bodyDivId)||document.getElementById(this._daysId);\nif(a){while(c!==null){if(c===a){ZmCalViewController._contextMenuOpened=true;\nbreak\n}c=c.parentNode\n}}}};\nZmCalBaseView.prototype.getTitle=function(){return[ZmMsg.zimbraTitle,this.getCalTitle()].join(\": \")\n};\nZmCalBaseView.prototype.needsRefresh=function(){return this._needsRefresh\n};\nZmCalBaseView.prototype.setNeedsRefresh=function(a){this._needsRefresh=a\n};\nZmCalBaseView.prototype._getItemId=function(a){return a?(DwtId.getListViewItemId(DwtId.WIDGET_ITEM,this.view,a.getUniqueId())):null\n};\nZmCalBaseView.prototype.addTimeSelectionListener=function(a){this.addListener(ZmCalBaseView.TIME_SELECTION,a)\n};\nZmCalBaseView.prototype.removeTimeSelectionListener=function(a){this.removeListener(ZmCalBaseView.TIME_SELECTION,a)\n};\nZmCalBaseView.prototype.addDateRangeListener=function(a){this.addListener(DwtEvent.DATE_RANGE,a)\n};\nZmCalBaseView.prototype.removeDateRangeListener=function(a){this.removeListener(DwtEvent.DATE_RANGE,a)\n};\nZmCalBaseView.prototype.getRollField=function(){return 0\n};\nZmCalBaseView.prototype.getDate=function(){return this._date\n};\nZmCalBaseView.prototype.getAtttendees=function(){return null\n};\nZmCalBaseView.prototype.getTimeRange=function(){return{start:this._timeRangeStart,end:this._timeRangeEnd}\n};\nZmCalBaseView.prototype.isInView=function(a){return a.isInRange(this._timeRangeStart,this._timeRangeEnd)\n};\nZmCalBaseView.prototype.isStartInView=function(a){return a.isStartInRange(this._timeRangeStart,this._timeRangeEnd)\n};\nZmCalBaseView.prototype.isEndInView=function(a){return a.isEndInRange(this._timeRangeStart,this._timeRangeEnd)\n};\nZmCalBaseView.prototype._dayKey=function(a){return(a.getFullYear()+\"/\"+a.getMonth()+\"/\"+a.getDate())\n};\nZmCalBaseView.prototype.setDate=function(b,e,a){this._duration=e;\nthis._date=new Date(b.getTime());\nvar f=new Date(b.getTime());\nf.setHours(0,0,0,0);\nvar c=f.getTime();\nif(a||c<this._timeRangeStart||c>=this._timeRangeEnd){this._resetList();\nthis._updateRange();\nthis._dateUpdate(true);\nthis._updateTitle();\nif(this.isListenerRegistered(DwtEvent.DATE_RANGE)){if(!this._dateRangeEvent){this._dateRangeEvent=new DwtDateRangeEvent(true)\n}this._dateRangeEvent.item=this;\nthis._dateRangeEvent.start=new Date(this._timeRangeStart);\nthis._dateRangeEvent.end=new Date(this._timeRangeEnd);\nthis.notifyListeners(DwtEvent.DATE_RANGE,this._dateRangeEvent)\n}}else{this._dateUpdate(false)\n}};\nZmCalBaseView.prototype._dateUpdate=function(a){};\nZmCalBaseView.prototype._apptSelected=function(){};\nZmCalBaseView.prototype._updateRange=function(){this._updateDays();\nthis._timeRangeStart=this._days[0].date.getTime();\nvar a=this._days[this.numDays-1].date;\na.setHours(23,59,59,999);\nthis._timeRangeEnd=a.getTime()\n};\nZmCalBaseView.prototype._updateTitle=function(){};\nZmCalBaseView.prototype.addAppt=function(a){var b=this._createItemHtml(a);\nif(!b){return\n}var c=this._getDivForAppt(a);\nif(c){c.appendChild(b)\n}this._postApptCreate(a,c)\n};\nZmCalBaseView.prototype._postApptCreate=function(a,b){};\nZmCalBaseView.prototype.set=function(e){this._preSet();\nthis.deselectAll();\ne=e.filter(this.isInView.bind(this));\nthis._resetList();\nthis._list=e;\nvar d=appCtxt.get(ZmSetting.CAL_SHOW_DECLINED_MEETINGS);\nif(e){var b=e.size();\nif(b!=0){for(var a=0;\na<b;\na++){var c=e.get(a);\nif(d||(c.ptst!=ZmCalBaseItem.PSTATUS_DECLINED)){this.addAppt(c)\n}}}}this._postSet(e);\nvar f=this._focusFirstAppt?this._list.get(0):this._list.getLast();\nthis._focusFirstAppt=true;\nif(f){this.setSelection(f)\n}};\nZmCalBaseView.prototype._fanoutAllDay=function(a){return true\n};\nZmCalBaseView.prototype._postSet=function(a){};\nZmCalBaseView.prototype._preSet=function(a){};\nZmCalBaseView.prototype._getDivForAppt=function(a){};\nZmCalBaseView.prototype._addApptIcons=function(c,b,a){b[a++]=\"<table border=0 cellpadding=0 cellspacing=0 style='display:inline'><tr>\";\nif(c.otherAttendees){b[a++]=\"<td>\";\nb[a++]=AjxImg.getImageHtml(\"ApptMeeting\");\nb[a++]=\"</td>\"\n}if(c.isException){b[a++]=\"<td>\";\nb[a++]=AjxImg.getImageHtml(\"ApptException\");\nb[a++]=\"</td>\"\n}else{if(c.isRecurring()){b[a++]=\"<td>\";\nb[a++]=AjxImg.getImageHtml(\"ApptRecur\");\nb[a++]=\"</td>\"\n}}if(c.alarm){b[a++]=\"<td>\";\nb[a++]=AjxImg.getImageHtml(\"ApptReminder\");\nb[a++]=\"</td>\"\n}b[a++]=\"</tr></table>\";\nreturn a\n};\nZmCalBaseView.prototype._getElFromItem=function(a){return document.getElementById(this._getItemId(a))\n};\nZmCalBaseView.prototype._resetList=function(){var e=this.getList();\nvar b=e?e.size():0;\nif(b==0){return\n}this.setFocusElement(this.getHtmlElement());\nfor(var a=0;\na<b;\na++){var c=e.get(a);\nvar f=this._getItemId(c);\nvar d=document.getElementById(f);\nif(d){d.parentNode.removeChild(d);\nthis._data[f]=null\n}}e.removeAll();\nthis.removeAll()\n};\nZmCalBaseView.prototype.removeAll=function(){this._selectedItems.removeAll()\n};\nZmCalBaseView.prototype.layoutView=function(){this._layout()\n};\nZmCalBaseView.prototype.getCalTitle=function(){return this._title\n};\nZmCalBaseView.prototype._getStartDate=function(){var a=this.getTimeRange();\nreturn new Date(a.start)\n};\nZmCalBaseView.prototype._createItemHtml=function(a){};\nZmCalBaseView.prototype._createHtml=function(){};\nZmCalBaseView.prototype.checkIndicatorNeed=function(b,a){};\nZmCalBaseView.prototype._controlListener=function(a){if((a.oldWidth!=a.newWidth)||(a.oldHeight!=a.newHeight)){this._layout()\n}};\nZmCalBaseView.prototype._layout=function(){};\nZmCalBaseView.prototype._timeSelectionEvent=function(b,f,g,d,a,c){if(!this._selectionEvent){this._selectionEvent=new DwtSelectionEvent(true)\n}var e=this._selectionEvent;\ne._isDblClick=g;\ne.item=this;\ne.detail=b;\ne.duration=f;\ne.isAllDay=d;\ne.folderId=a;\ne.force=false;\ne.shiftKey=c;\nthis.notifyListeners(ZmCalBaseView.TIME_SELECTION,this._selectionEvent);\ne._isDblClick=false\n};\nZmCalBaseView._setApptOpacity=function(b,c){var a=this.getApptOpacity(b);\nDwt.setOpacity(c,a)\n};\nZmCalBaseView.getApptOpacity=function(b){var a=100;\nswitch(b.ptst){case ZmCalBaseItem.PSTATUS_DECLINED:a=ZmCalColView._OPACITY_APPT_DECLINED;\nbreak;\ncase ZmCalBaseItem.PSTATUS_TENTATIVE:a=ZmCalColView._OPACITY_APPT_TENTATIVE;\nbreak;\ndefault:a=ZmCalColView._OPACITY_APPT_NORMAL;\nbreak\n}if(b.fba&&b.isOrganizer()){switch(b.fba){case\"F\":a=ZmCalColView._OPACITY_APPT_FREE;\nbreak;\ncase\"B\":a=ZmCalColView._OPACITY_APPT_BUSY;\nbreak;\ncase\"T\":a=ZmCalColView._OPACITY_APPT_TENTATIVE;\nbreak\n}}return a\n};\nZmCalBaseView._emptyHdlr=function(b){var a=DwtShell.mouseEvent;\na.setFromDhtmlEvent(b);\na._stopPropagation=true;\na._returnValue=false;\na.setToDhtmlEvent(b);\nreturn false\n};\nZmCalBaseView.prototype._apptMouseDownAction=function(e,c,d){if(e.button!=DwtMouseEvent.LEFT){return false\n}if(!d){d=this.getItemFromElement(c)\n}var g=appCtxt.getById(d.folderId);\nvar b=Boolean(g.url);\nif(d.isReadOnly()||b||appCtxt.isWebClientOffline()){return false\n}var h=Dwt.toWindow(e.target,e.elementX,e.elementY,c,false);\nvar f={dndStarted:false,appt:d,view:this,apptEl:c,apptOffset:h,docX:e.docX,docY:e.docY};\nvar a=new DwtMouseEventCapture({targetObj:f,mouseOverHdlr:ZmCalBaseView._emptyHdlr,mouseDownHdlr:ZmCalBaseView._emptyHdlr,mouseMoveHdlr:ZmCalBaseView._apptMouseMoveHdlr,mouseUpHdlr:ZmCalBaseView._apptMouseUpHdlr,mouseOutHdlr:ZmCalBaseView._emptyHdlr});\nthis._createContainerRect(f);\nthis._controller.setCurrentListView(this);\na.capture();\nreturn false\n};\nZmCalBaseView.prototype._getApptDragProxy=function(g){var e;\nif(this._apptDragProxyDivId==null){e=document.createElement(\"div\");\ne.id=this._apptDragProxyDivId=Dwt.getNextId();\nDwt.setPosition(e,Dwt.ABSOLUTE_STYLE);\nthis.shell.getHtmlElement().appendChild(e);\nDwt.setZIndex(e,Dwt.Z_DND)\n}else{e=document.getElementById(this._apptDragProxyDivId)\n}e.className=DwtCssStyle.NOT_DROPPABLE;\nvar f=g.appt;\nvar c=AjxDateFormat.getDateInstance(AjxDateFormat.SHORT);\nvar a=ZmCalendarApp.COLORS[this._controller.getCalendarColor(f.folderId)];\nif(f.ptst!=ZmCalBaseItem.PSTATUS_NEEDS_ACTION){a+=\"Bg\"\n}var b={shortDate:c.format(f.startDate),dur:f.getShortStartHour(),color:a,apptName:AjxStringUtil.htmlEncode(f.getName())};\ne.innerHTML=AjxTemplate.expand(\"calendar.Calendar#ApptDragProxy\",b);\nvar d=AjxImg.getImageHtml(\"RoundPlus\",\"position:absolute; top:30; left:-11; visibility:hidden\");\ne.appendChild(Dwt.parseHtmlFragment(d));\nreturn e\n};\nZmCalBaseView._apptMouseMoveHdlr=function(f){var d=DwtMouseEventCapture.getTargetObj();\nif(!d){return false\n}var h=DwtShell.mouseEvent;\nh.setFromDhtmlEvent(f,true);\nvar g=d.view;\nvar b=h.docX-d.docX;\nvar a=h.docY-d.docY;\nif(!d.dndStarted){var i=(Math.abs(b)<ZmCalColView.DRAG_THRESHOLD&&Math.abs(a)<ZmCalColView.DRAG_THRESHOLD);\nif(i||!g._apptDndBegin(d)){h._stopPropagation=true;\nh._returnValue=false;\nh.setToDhtmlEvent(f);\nreturn false\n}}if(g._apptDraggedOut(h.docX,h.docY)){g._dragOut(h,d)\n}else{if(d._lastDraggedOut){d._lastDraggedOut=false;\nif(d.icon){Dwt.setVisible(d.icon,false)\n}g._restoreHighlight(d)\n}var c=d.dndObj;\nc._lastDestDwtObj=null;\nif(!d.disableScroll){var e=g._handleApptScrollRegion(h.docX,h.docY,ZmCalColView._HOUR_HEIGHT,d);\nif(e!=0){a+=e\n}}g._doApptMove(d,b,a)\n}h._stopPropagation=true;\nh._returnValue=false;\nh.setToDhtmlEvent(f);\nreturn false\n};\nZmCalBaseView.prototype._dragOut=function(a,c){var d=c.dndObj;\nif(!c._lastDraggedOut){c._lastDraggedOut=true;\nthis._clearSnap(c.snap);\nc.startDate=new Date(c.appt.getStartTime());\nthis._restoreApptLoc(c);\nif(!c.icon){c.icon=this._getApptDragProxy(c)\n}Dwt.setVisible(c.icon,true)\n}Dwt.setLocation(c.icon,a.docX+5,a.docY+5);\nvar b=a.dwtObj;\nvar d=c.dndObj;\nif(b&&b._dropTarget){if(b!=d._lastDestDwtObj||b._dropTarget.hasMultipleTargets()){if(b._dropTarget._dragEnter(Dwt.DND_DROP_MOVE,b,{data:c.appt},a,c.icon)){c.icon.className=DwtCssStyle.DROPPABLE;\nd._dropAllowed=true;\nb._dragEnter(a)\n}else{c.icon.className=DwtCssStyle.NOT_DROPPABLE;\nd._dropAllowed=false\n}}else{if(d._dropAllowed){b._dragOver(a)\n}}}else{c.icon.className=DwtCssStyle.NOT_DROPPABLE\n}if(d._lastDestDwtObj&&d._lastDestDwtObj!=b&&d._lastDestDwtObj._dropTarget&&d._lastDestDwtObj!=d){d._lastDestDwtObj._dragLeave(a);\nd._lastDestDwtObj._dropTarget._dragLeave()\n}d._lastDestDwtObj=b\n};\nZmCalBaseView.prototype._apptDraggedOut=function(c,b){var a=this._containerRect?true:false;\nreturn a&&((b<this._containerRect.y)||(b>(this._containerRect.y+this._containerRect.height))||(c<this._containerRect.x)||(c>(this._containerRect.x+this._containerRect.width)))\n};\nZmCalBaseView._apptMouseUpHdlr=function(l){var f=DwtMouseEventCapture.getTargetObj();\nvar n=DwtShell.mouseEvent;\nif(l&&n){n.setFromDhtmlEvent(l,true)\n}DwtMouseEventCapture.getCaptureObj().release();\nvar p=f.view._apptDraggedOut(n.docX,n.docY);\nif(f.dndStarted&&f.appt){f.view._deselectDnDHighlight(f);\nappCtxt.notifyZimlets(\"onApptDrag\",[f]);\nif(f.startDate.getTime()!=f.appt._orig.getStartTime()&&!p){if(f.icon){Dwt.setVisible(f.icon,false)\n}var b=f.appt._orig.getDuration();\nf.view._autoScrollDisabled=true;\nvar d=appCtxt.getCurrentController();\nvar h=new Date(f.startDate.getTime()+b);\nvar g=new AjxCallback(null,ZmCalColView._handleDnDError,f);\nvar a=f.startDate?(f.startDate.getTime()-f.appt._orig.getStartTime()):null;\nvar k=h?(h.getTime()-f.appt._orig.getEndTime()):null;\nd.dndUpdateApptDate(f.appt._orig,a,k,null,g,n)\n}else{f.view._restoreAppt(f)\n}if(p){var e=f.dndObj;\ne._lastDestDwtObj=null;\nvar o=n.dwtObj;\nif(o!=null&&o._dropTarget!=null&&e._dropAllowed&&o!=e){o._drop(n);\nvar j={data:f.appt,controller:f.view._controller};\no._dropTarget._drop(j,n);\ne._dragging=DwtControl._NO_DRAG;\nif(f.icon){Dwt.setVisible(f.icon,false)\n}}else{var i=f.view._badDrop={dragEndX:n.docX,dragEndY:n.docY,dragStartX:f.docX,dragStartY:f.docY};\ni.icon=f.icon;\nif(f.view._badDropAction==null){f.view._badDropAction=new AjxTimedAction(f.view,f.view._apptBadDropEffect)\n}var c=(i.dragEndY-i.dragStartY)/(i.dragEndX-i.dragStartX);\nf.view._badDropAction.args=[c,i.dragStartY-(c*i.dragStartX),(i.dragStartX-i.dragEndX<0)?-1:1];\nAjxTimedAction.scheduleAction(f.view._badDropAction,0)\n}}}if(n){n._stopPropagation=true;\nn._returnValue=false;\nif(l){n.setToDhtmlEvent(l)\n}}return false\n};\nZmCalBaseView.prototype._deselectDnDHighlight=function(a){};\nZmCalBaseView.prototype._restoreAppt=function(a){};\nZmCalBaseView.prototype._apptBadDropEffect=function(a,h,f){var b=(Math.abs(a)<=1);\nvar e=this._badDrop;\nvar g=b?e.dragStartX-e.dragEndX:e.dragStartY-e.dragEndY;\nif(g*f>0){if(b){e.dragEndX+=(30*f);\ne.icon.style.top=a*e.dragEndX+h;\ne.icon.style.left=e.dragEndX\n}else{e.dragEndY+=(30*f);\ne.icon.style.top=e.dragEndY;\ne.icon.style.left=(e.dragEndY-h)/a\n}AjxTimedAction.scheduleAction(this._badDropAction,0)\n}else{Dwt.setVisible(e.icon,false);\ne.icon=null\n}};\nZmCalBaseView.prototype._createContainerRect=function(a){this._containerRect=new DwtRectangle(0,0,0,0)\n};\nZmCalBaseView.prototype._clearSnap=function(a){};\nZmCalBaseView.prototype._apptDndBegin=function(a){return false\n};\nZmCalBaseView.prototype._restoreHighlight=function(a){};\nZmCalBaseView.prototype._doApptMove=function(c,b,a){};\nZmCalBaseView.prototype._restoreApptLoc=function(a){};\nZmCalBaseView.prototype._cancelNewApptDrag=function(b){if(b&&b.newApptDivEl){b.gridEl.style.cursor=\"auto\";\nvar a=b.view._getColFromX(b.gridX);\nb.folderId=a?(a.cal?a.cal.id:null):null;\nDwt.setVisible(b.newApptDivEl,false)\n}};\nZmCalBaseView.prototype._handleApptScrollRegion=function(b,a,d,c){};\nZmCalBaseView.prototype.startIndicatorTimer=function(){};\nZmCalBaseView.prototype.setTimer=function(a){var b=a*60*1000;\nreturn AjxTimedAction.scheduleAction(new AjxTimedAction(this,this.updateTimeIndicator),b)\n};\nZmCalBaseView.prototype.updateTimeIndicator=function(){};\nZmCalBaseView.prototype.deselectAppt=function(b){b=AjxUtil.toArray(b);\nvar d=this._getItemData(b,\"type\");\nfor(var c=0;\nc<b.length;\nc++){var a=this._selectedItems.indexOf(b[c]);\nif(a<0){continue\n}this.setFocusElement(this.getHtmlElement());\nb[c].className=this._getStyle(d);\nthis._selectedItems.remove(b[c]);\nthis._selEv.detail=DwtListView.ITEM_DESELECTED;\nthis._selEv.item=b[c];\nthis._evtMgr.notifyListeners(DwtEvent.SELECTION,this._selEv)\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalColView\")){ZmCalColView=function(p,f,k,m,n,l,b,j,a,o){if(arguments.length==0){return\n}if(appCtxt.get(ZmSetting.CAL_SCALING)==\"15\"){ZmCalColView._MINIMUM_APPT_HEIGHT=15;\nZmCalColView._SNAP_MINUTES=15;\nZmCalColView._HOUR_HEIGHT=84;\nZmCalColView._MSEC_DURATION=AjxDateUtil.MSEC_PER_FIFTEEN_MINUTES\n}else{ZmCalColView._MINIMUM_APPT_HEIGHT=22;\nZmCalColView._SNAP_MINUTES=30;\nZmCalColView._HOUR_HEIGHT=42;\nZmCalColView._MSEC_DURATION=AjxDateUtil.MSEC_PER_HALF_HOUR\n}ZmCalColView._HALF_HOUR_HEIGHT=ZmCalColView._HOUR_HEIGHT/2;\nZmCalColView._15_MINUTE_HEIGHT=ZmCalColView._HOUR_HEIGHT/4;\nZmCalColView._DAY_HEIGHT=ZmCalColView._HOUR_HEIGHT*24;\nn=n||ZmId.VIEW_CAL_DAY;\nthis._scheduleMode=b;\nvar e=ZmCalBaseView.parseWorkingHours(ZmCalBaseView.getWorkingHours());\nif(!l&&n===ZmId.VIEW_CAL_WORK_WEEK){for(var h=0;\nh<e.length;\nh++){if(!e[h].isWorkingDay){e[h].isWorkingDay=true\n}}l=7;\nvar d=appCtxt.getMsgDialog();\nd.setMessage(ZmMsg.emptyWorkingHoursWarning,DwtMessageDialog.WARNING_STYLE);\nd.popup();\nvar c=d.popdown.bind(d);\nd.setButtonListener(DwtDialog.OK_BUTTON,c)\n}this.workingHours=e;\nthis.numDays=l||1;\nthis._daySepWidth=2;\nthis._columns=[];\nthis._layoutMap=[];\nthis._unionBusyDivIds=[];\nthis._fbBarEnabled=this.fbStatusBarEnabled();\nthis._isInviteMessage=a;\nthis._isRight=o;\nZmCalBaseView.call(this,p,\"calendar_view\",f,k,n,j);\nvar g=this.getHtmlElement();\nthis._setEventHdlrs([DwtEvent.ONCLICK],true,g);\nthis.setDropTarget(m);\nthis.setScrollStyle(DwtControl.CLIP);\nthis._needFirstLayout=true;\nthis._isValidIndicatorDuration=true\n};\nZmCalColView.prototype=new ZmCalBaseView;\nZmCalColView.prototype.constructor=ZmCalColView;\nZmCalColView.DRAG_THRESHOLD=4;\nZmCalColView.MIN_COLUMN_WIDTH=120;\nZmCalColView.MAX_ALLDAY_APPTS=4;\nZmCalColView._OPACITY_APPT_NORMAL=100;\nZmCalColView._OPACITY_APPT_DECLINED=20;\nZmCalColView._OPACITY_APPT_TENTATIVE=60;\nZmCalColView._OPACITY_APPT_DND=70;\nZmCalColView._OPACITY_APPT_FREE=40;\nZmCalColView._OPACITY_APPT_BUSY=100;\nZmCalColView._OPACITY_APPT_TENTATIVE=60;\nZmCalColView._HOURS_DIV_WIDTH=parseInt(ZmMsg.COLUMN_WIDTH_HOURS);\nZmCalColView._UNION_DIV_WIDTH=40;\nZmCalColView._FBBAR_DIV_WIDTH=10;\nZmCalColView._ALL_DAY_SEP_HEIGHT=5;\nZmCalColView._SCROLL_PRESSURE_FUDGE=10;\nZmCalColView._DAY_HEADING_HEIGHT=20;\nZmCalColView._ALL_DAY_APPT_HEIGHT=20;\nZmCalColView._ALL_DAY_APPT_HEIGHT_PAD=3;\nZmCalColView._APPT_X_FUDGE=0;\nZmCalColView._APPT_Y_FUDGE=-1;\nZmCalColView._APPT_WIDTH_FUDGE=(AjxEnv.isIE?0:0);\nZmCalColView._APPT_HEIGHT_FUDGE=(AjxEnv.isIE?0:0);\nZmCalColView._STATUS_FREE=\"F\";\nZmCalColView._STATUS_TENTATIVE=\"T\";\nZmCalColView._STATUS_BUSY=\"B\";\nZmCalColView._STATUS_OOO=\"O\";\nZmCalColView.prototype.toString=function(){return\"ZmCalColView\"\n};\nZmCalColView.prototype.fbStatusBarEnabled=function(){return false\n};\nZmCalColView.prototype.getRollField=function(){switch(this.view){case ZmId.VIEW_CAL_WORK_WEEK:case ZmId.VIEW_CAL_WEEK:return AjxDateUtil.WEEK;\nbreak;\ncase ZmId.VIEW_CAL_DAY:default:return AjxDateUtil.DAY;\nbreak\n}};\nZmCalColView.prototype.dragSelect=function(a){};\nZmCalColView.prototype.dragDeselect=function(a){};\nZmCalColView.prototype.setIsRight=function(a){this._isRight=a\n};\nZmCalColView.prototype._dateUpdate=function(a){this._selectDay(this._date);\nthis._clearSelectedTime();\nthis._updateSelectedTime()\n};\nZmCalColView.prototype._selectDay=function(c){if(this._numDays==1||this._scheduleMode){return\n}var a=this._getDayForDate(c);\nif(a!=null){var b=this._columns[a.index];\nif(this._selectedDay){var d=document.getElementById(this._selectedCol.titleId);\nd.className=this._selectedDay.isToday?\"calendar_heading_day_today\":\"calendar_heading_day\"\n}this._selectedDay=a;\nthis._selectedCol=b;\nvar d=document.getElementById(b.titleId);\nd.className=a.isToday?\"calendar_heading_day_today-selected\":\"calendar_heading_day-selected\"\n}};\nZmCalColView.prototype._clearSelectedTime=function(){var a=document.getElementById(this._timeSelectionDivId);\nif(a){Dwt.setVisible(a,false)\n}};\nZmCalColView.prototype._updateSelectedTime=function(){var b=this._date.getTime();\nif(b<this._timeRangeStart||b>=this._timeRangeEnd){return\n}var d=document.getElementById(this._timeSelectionDivId);\nif(!d){return\n}var c=this._getBoundsForDate(this._date,ZmCalColView._MSEC_DURATION);\nif(c==null){return\n}var a=this._snapXY(c.x,c.y,ZmCalColView._SNAP_MINUTES);\nif(a==null){return\n}Dwt.setLocation(d,a.x,a.y);\nDwt.setSize(d,c.width,c.height);\nDwt.setOpacity(d,40);\nDwt.setVisible(d,true)\n};\nZmCalColView.prototype._removeNode=function(b){var a=document.getElementById(b);\nif(a){a.parentNode.removeChild(a)\n}};\nZmCalColView.prototype._updateUnionDataHash=function(b,a){var c=this._unionBusyData[b];\nif(!c){c=this._unionBusyData[b]={}\n}c[a]=1\n};\nZmCalColView.prototype._updateUnionData=function(c){if(c.isAllDayEvent()){this._updateUnionDataHash(48,c.folderId)\n}else{var b=c.endDate.getMinutes();\nvar f=c.endDate.getHours();\nvar e=(c.startDate.getHours()*2)+(c.startDate.getMinutes()<30?0:1);\nvar d=((f?f:24)*2)+(b==0?0:(b<=30?1:2));\nif(e==d){d++\n}for(var a=e;\na<d;\na++){this._updateUnionDataHash(a,c.folderId)\n}}};\nZmCalColView.prototype.addAppt=function(a){ZmCalBaseView.prototype.addAppt.call(this,a);\nif(this._scheduleMode){this._updateUnionData(a)\n}};\nZmCalColView.prototype._resetCalendarData=function(){if(this._numCalendars>0){for(var f=0;\nf<this._numCalendars;\nf++){var c=this._columns[f];\nthis._removeNode(c.titleId);\nthis._removeNode(c.headingDaySepDivId);\nthis._removeNode(c.daySepDivId)\n}}this._calendars=this._controller.getCheckedCalendars();\nthis._calendars.sort(ZmFolder.sortCompareNonMail);\nthis._folderIdToColIndex={};\nthis._columns=[];\nthis._numCalendars=this._calendars.length;\nthis._layoutMap=[];\nthis._unionBusyData=[];\nthis._unionBusyDataToolTip=[];\nvar d=document.getElementById(this._allDayHeadingDivId);\nvar j=document.getElementById(this._allDayScrollDivId);\nvar e=document.getElementById(this._apptBodyDivId);\nfor(var f=0;\nf<this._numCalendars;\nf++){var c=this._columns[f]={index:f,dayIndex:0,cal:this._calendars[f],titleId:Dwt.getNextId(),headingDaySepDivId:Dwt.getNextId(),daySepDivId:Dwt.getNextId(),workingHrsFirstDivId:Dwt.getNextId(),workingHrsSecondDivId:Dwt.getNextId(),apptX:0,apptWidth:0,allDayX:0,allDayWidth:0};\nvar b=this._calendars[f];\nthis._folderIdToColIndex[b.id]=c;\nif(b.isRemote()&&b.rid&&b.zid){this._folderIdToColIndex[b.zid+\":\"+b.rid]=c\n}var a=document.createElement(\"div\");\na.style.position=\"absolute\";\na.className=\"calendar_heading_day\";\na.id=c.titleId;\nvar g=AjxStringUtil.htmlEncode(b.getName());\nif(appCtxt.multiAccounts){var h=b.getAccount();\na.innerHTML=[\"<center><table border=0><tr><td>\",g,\"</td><td>[\",\"<td>\",AjxImg.getImageSpanHtml(h.getIcon(),\"width:18px\"),\"</td><td>\",AjxStringUtil.htmlEncode(h.getDisplayName()),\"]</td></tr></table></center>\"].join(\"\")\n}else{a.innerHTML=g\n}if(d){d.appendChild(a)\n}a=document.createElement(\"div\");\na.className=\"calendar_day_separator\";\na.style.position=\"absolute\";\na.id=c.headingDaySepDivId;\nif(j){j.appendChild(a)\n}a=document.createElement(\"div\");\na.className=\"calendar_day_separator\";\na.style.position=\"absolute\";\na.id=c.daySepDivId;\nif(e){e.appendChild(a)\n}}};\nZmCalColView.prototype._preSet=function(){if(this._scheduleMode){this._resetCalendarData()\n}this._layoutMap=[];\nthis._resetAllDayData()\n};\nZmCalColView.prototype._postSet=function(){this._computeApptLayout();\nthis._computeAllDayApptLayout();\nif(!this._needFirstLayout){this._layoutAppts()\n}this._layout();\nthis._scrollToTime(8);\nif(this._list&&this._list.size()>0){AjxDebug.println(AjxDebug.CALENDAR,\" ---------------- ZmCalColView::set - calendar is blank\");\nAjxDebug.println(AjxDebug.CALENDAR,\" list size :\"+this._list.size())\n}if(this._fbBarEnabled){this._layoutFBBar()\n}this._checkForOffscreenAppt();\nDwt.setLoadedTime(\"ZmCalItemView\")\n};\nZmCalColView._inSyncScroll=false;\nZmCalColView.prototype._syncScroll=function(g){if(ZmCalColView._inSyncScroll){return\n}ZmCalColView._inSyncScroll=true;\ntry{var f=document.getElementById(this._bodyDivId),e=document.getElementById(this._hoursScrollDivId),h=document.getElementById(this._allDayScrollDivId),a=document.getElementById(this._unionGridScrollDivId),c=document.getElementById(this._allDayApptScrollDivId),b=document.getElementById(this._tabsContainerDivId);\ne.scrollTop=f.scrollTop;\ne.scrollLeft=f.scrollLeft;\nif(g){f.scrollLeft=0\n}f.scrollLeft=b.scrollLeft;\nh.scrollLeft=f.scrollLeft;\nc.scrollLeft=f.scrollLeft;\nif(a){a.scrollTop=f.scrollTop\n}this._checkForOffscreenAppt(f)\n}catch(d){ZmController.handleScriptError(d,true)\n}finally{ZmCalColView._inSyncScroll=false\n}};\nZmCalColView.prototype._horizontalScrollbar=function(a){var b=document.getElementById(this._bodyDivId);\nb.className=a?\"calendar_body_hscroll\":\"calendar_body\";\nif(a!=this._horzEnabled){this._horzEnabled=a;\nthis._syncScroll(true)\n}};\nZmCalColView.prototype._allDayVerticalScrollbar=function(a){var b=document.getElementById(this._allDayApptScrollDivId);\nb.className=a?\"calendar_allday_appt_vert\":\"calendar_allday_appt\";\nif(a!=this._vertEnabled){this._vertEnabled=a;\nthis._syncScroll(true)\n}};\nZmCalColView.prototype._allDayScrollToBottom=function(){var a=document.getElementById(this._allDayApptScrollDivId);\na.scrollTop=this._allDayFullDivHeight\n};\nZmCalColView.prototype._scrollToTime=function(a){a=a||8;\nif(!this._autoScrollDisabled){var b=document.getElementById(this._bodyDivId);\nif(!b){return\n}b.scrollTop=ZmCalColView._HOUR_HEIGHT*a-10;\nthis._syncScroll()\n}else{this._autoScrollDisabled=false\n}};\nZmCalColView.prototype._updateTitle=function(){var b=DwtCalendar.getDayFormatter();\nif(this.numDays==1){var a=DwtCalendar.getDateFormatter();\nvar c=this._date;\nthis._title=this._scheduleMode?a.format(c):b.format(c)\n}else{var e=this._days[0].date;\nvar d=this._days[this.numDays-1].date;\nthis._title=[b.format(e),\" - \",b.format(d)].join(\"\")\n}};\nZmCalColView.prototype._dayTitle=function(a){var b=this.numDays==1?DwtCalendar.getDateLongFormatter():DwtCalendar.getDateFormatter();\nreturn b.format(a)\n};\nZmCalColView.prototype._updateDays=function(){var l=new Date(this._date.getTime());\nl.setHours(0,0,0,0);\nvar b=false;\nif(l.getHours()!=0){AjxDateUtil.rollToNextDay(l);\nb=true\n}var q;\nswitch(this.view){case ZmId.VIEW_CAL_WORK_WEEK:case ZmId.VIEW_CAL_WEEK:var f=this.firstDayOfWeek();\nq=l.getDay();\nif(q!=f){l.setDate(l.getDate()-((q+(7-f))%7))\n}break;\ncase ZmId.VIEW_CAL_DAY:default:break\n}if(l.getHours()!=0&&!b){AjxDateUtil.rollToNextDay(l);\nb=true\n}this._dateToDayIndex=new Object();\nvar m=new Date();\nm.setHours(0,0,0,0);\nvar o=this.numDays-1;\nvar g=0;\nfor(var h=0;\nh<7;\nh++){var p=this.workingHours[l.getDay()];\nvar k=p&&p.isWorkingDay?p.isWorkingDay:false;\nif(this.view===ZmId.VIEW_CAL_WEEK||this.view===ZmId.VIEW_CAL_DAY||this._scheduleMode===true||k===true){var n=this._days[g]={};\nn.index=g;\nn.date=new Date(l);\nn.endDate=new Date(l);\nn.endDate.setHours(23,59,59,999);\nn.isToday=n.date.getTime()==m.getTime();\nn.isWorkingDay=k;\nthis._dateToDayIndex[this._dayKey(n.date)]=n;\nif(!this._scheduleMode&&this._columns[g]){var a=this._columns[g].titleId;\nthis._calendarTodayHeaderDivId=n.isToday?a:this._calendarTodayHeaderDivId;\nvar c=document.getElementById(a);\nif(c){c.innerHTML=this._dayTitle(l);\nthis.associateItemWithElement(null,c,ZmCalBaseView.TYPE_DAY_HEADER,a,{dayIndex:g});\nc.className=n.isToday?\"calendar_heading_day_today\":\"calendar_heading_day\"\n}}g++\n}var e=l.getDate();\nl.setDate(l.getDate()+1);\nif(e==l.getDate()){l.setHours(0,0,0,0);\nl.setTime(l.getTime()+AjxDateUtil.MSEC_PER_DAY)\n}if(b){l.setHours(0,0,0,0);\nb=false\n}}var c=document.getElementById(this._headerYearId);\nif(c){c.innerHTML=this._days[0].date.getFullYear()\n}};\nZmCalColView.prototype._resetAllDayData=function(){this._allDayAppts={};\nthis._allDayApptsList=[];\nthis._allDayApptsRowLayouts=[];\nthis._addAllDayApptRowLayout()\n};\nZmCalColView.prototype._fanoutAllDay=function(a){return false\n};\nZmCalColView.prototype._getDivForAppt=function(a){return document.getElementById(a.isAllDayEvent()?this._allDayDivId:this._apptBodyDivId)\n};\nZmCalColView.prototype._populateNewApptHtml=function(a,j,c){if(c==null){c=this._controller.getDefaultCalendarFolderId()\n}var e=ZmCalendarApp.COLORS[this._controller.getCalendarColor(c)];\nvar b=j?\"_newAllDayApptColor\":\"_newApptColor\";\nif(this[b]&&this[b]==e){return a\n}this[b]=e;\na.style.position=\"absolute\";\nDwt.setSize(a,10,10);\na.className=this._getStyle(null,true);\nDwt.setOpacity(a,ZmCalColView._OPACITY_APPT_DND);\nvar f=appCtxt.getById(c);\nvar i=f.rgb?AjxColor.deepen(AjxColor.lighten(f.rgb,ZmCalBaseView.bodyColorDelta)):\"\";\nvar d={id:a.id,newState:\"\",headerColor:f.rgb?\"\":(e+\"Light\"),bodyColor:f.rgb?\"\":(e+\"Bg\"),headerStyle:f.rgb?\"background-color: \"+i+\";\":\"\",name:AjxStringUtil.htmlEncode(ZmMsg.newAppt),starttime:\"\",endtime:\"\",location:\"\",status:\"\"};\nvar h;\nvar g=Dwt.createLinearGradientCss(\"#FFFFFF\",i,\"v\");\nif(j){h=\"calendar_appt_allday\";\nif(g){d.headerStyle=g\n}}else{h=\"calendar_appt\";\nif(g){d.bodyStyle=g;\nd.headerStyle=null\n}}a.innerHTML=AjxTemplate.expand(\"calendar.Calendar#\"+h,d);\nreturn a\n};\nZmCalColView.prototype._createItemHtml=function(d){if(this.view===ZmId.VIEW_CAL_WORK_WEEK){var k=this.getAvailableStartTime(d);\nif(!k){return\n}}var f=d.isAllDayEvent();\nif(f){var w=d.getUniqueId();\nvar q=k||Math.max(d.getStartTime(),this._timeRangeStart);\nthis._allDayAppts[w]={appt:d,startTime:q};\nthis._allDayApptsList.push(d)\n}var H=10,c=10,h=0,g=0,B=this._layoutMap[this._getItemId(d)];\nvar o=document.createElement(\"div\");\nDwt.setPosition(o,Dwt.ABSOLUTE_STYLE);\nDwt.setCursor(o,\"default\");\nDwt.setSize(o,H,c);\nif(B){o.style.left=h+\"px\";\no.style.top=g+\"px\"\n}o.className=this._getStyle();\nif(this.view===ZmId.VIEW_CAL_FB){Dwt.setScrollStyle(o,Dwt.CLIP)\n}this.associateItemWithElement(d,o,ZmCalBaseView.TYPE_APPT);\nvar D=(d.ptst===ZmCalBaseItem.PSTATUS_NEEDS_ACTION),t=this._getItemId(d),n=appCtxt.getById(d.folderId),A=Boolean(n.url),r=d._orig.getDuration()<=ZmCalColView._MSEC_DURATION,s=d._orig.getDuration()<=ZmCalColView._MSEC_DURATION*2,z=AjxStringUtil.htmlEncode(d.getName());\nvar b=d.getLocation();\nb=b&&b.length&&!s?\"<div class='appt_location'>\"+AjxStringUtil.htmlEncode(d.getLocation())+\"</div>\":null;\nif((r||f)&&this.view!==ZmId.VIEW_CAL_DAY){z=f?z:d.getDurationText(true,true)+\" - \"+z;\nvar y=this._getBoundsForAppt(d),H=y&&y.width;\nif(H>30){z=AjxStringUtil.fitString(z,H-15)\n}}var e=d.getVisibleTags(),G=d.getTagImageFromNames(e);\nif(G===\"Blank_16\"){G=\"\"\n}var m=ZmApptViewHelper.getApptColor(D,n,e,\"body\"),a=ZmCalBaseView._toColorsCss(m.appt),v=D?ZmCalBaseItem.PSTATUS_NEEDS_ACTION:d.fba;\nvar x={id:t,newState:D?\"_new\":\"\",headerStyle:a,name:z,starttime:d.getDurationText(true,true),endtime:!d._fanoutLast&&(d._fanoutFirst||d._fanoutNum>0)?\"\":ZmCalBaseItem._getTTHour(d.endDate),location:b,status:d.isOrganizer()?\"\":d.getParticipantStatusStr(),icon:d.isPrivate()?\"ReadOnly\":null,tagIcon:G,hideTime:s,showAsColor:ZmApptViewHelper._getShowAsColorFromId(v),boxBorder:ZmApptViewHelper.getBoxBorderFromId(v),isDraft:d.isDraft,otherAttendees:d.otherAttendees,isException:d.isException,isRecurring:d.isRecurring()};\nvar F,j,u,C;\nif(d.isAllDayEvent()){j=\"headerStyle\";\nF=\"calendar_appt_allday\";\nif(!this.isStartInView(d._orig)){C=\"border-left:none;\"\n}if(!this.isEndInView(d._orig)){C+=\"border-right:none;\"\n}if(C){x.bodyStyle=C\n}}else{if(this.view==ZmId.VIEW_CAL_FB){F=\"calendar_fb_appt\"\n}else{if(r){j=\"headerStyle\";\nF=\"calendar_appt_30\"\n}else{if(d._fanoutNum>0){j=\"bodyStyle\";\nF=\"calendar_appt_bottom_only\"\n}else{j=\"bodyStyle\";\nu=\"headerStyle\";\nF=\"calendar_appt\"\n}}}}ZmApptViewHelper.setupCalendarColor(true,m,e,x,j,u,1,1);\no.innerHTML=AjxTemplate.expand(\"calendar.Calendar#\"+F,x);\nvar E=Dwt.getDescendant(o,t+\"_tableBody\"),i=ZmCalBaseView.getApptOpacity(d);\nif(E){Dwt.setOpacity(E,i)\n}else{Dwt.setOpacity(o,i)\n}if(!d.isReadOnly()&&!d.isAllDayEvent()&&!A&&this.view!==ZmId.VIEW_CAL_FB){if(d._fanoutLast||(!d._fanoutFirst&&(!d._fanoutNum))){var l=document.createElement(\"div\");\nthis.associateItemWithElement(null,l,ZmCalBaseView.TYPE_APPT_BOTTOM_SASH,d.id+\"-bs\");\nl.className=\"appt_bottom_sash\";\no.appendChild(l)\n}if(d._fanoutFirst||(!d._fanoutLast&&(!d._fanoutNum))){var p=document.createElement(\"div\");\nthis.associateItemWithElement(null,p,ZmCalBaseView.TYPE_APPT_TOP_SASH,d.id+\"-ts\");\np.className=\"appt_top_sash\";\no.appendChild(p)\n}}return o\n};\nZmCalColView.prototype._createHoursHtml=function(e){e.append(\"<div style='position:absolute; top:-8; width:\",ZmCalColView._HOURS_DIV_WIDTH,\"px;' id='\",this._bodyHourDivId,\"'>\");\nvar d=DwtCalendar.getHourFormatter();\nvar b=new Date();\nvar c=new Date();\nc.setHours(0,0,0,0);\nvar a=ZmCalColView._HOURS_DIV_WIDTH-(this._fbBarEnabled?ZmCalColView._FBBAR_DIV_WIDTH:0);\ne.append(\"<table class=calendar_grid_day_table>\");\nfor(var f=0;\nf<25;\nf++){e.append(\"<tr><td class=calendar_grid_body_time_td style='height:\",ZmCalColView._HOUR_HEIGHT,\"px; width:\",a,\"px'><div id='\"+this._hourColDivId+\"_\"+f+\"' class=calendar_grid_body_time_text>\");\nc.setHours(f);\ne.append(f>0&&f<24?AjxStringUtil.htmlEncode(d.format([f,c])):\"&nbsp;\");\ne.append(\"</div>\");\ne.append(\"</td>\");\nif(this._fbBarEnabled){e.append(\"<td class=calendar_grid_body_fbbar_td style='height:\",ZmCalColView._HOUR_HEIGHT,\"px; width:\",ZmCalColView._FBBAR_DIV_WIDTH,\"px; border-left:1px solid #A7A194;'>&nbsp;</td>\")\n}e.append(\"</tr>\")\n}e.append(\"</table>\");\ne.append(\"<div id='\"+this._curTimeIndicatorHourDivId+\"' class='calendar_cur_time_indicator_arr'><div class='calendar_hour_arrow_indicator'>&rarr;</div></div>\");\ne.append(\"</div>\")\n};\nZmCalColView.prototype._createHtml=function(a){this._days={};\nthis._columns=[];\nthis._hours={};\nthis._layouts=[];\nthis._allDayAppts=[];\nvar e=new AjxBuffer();\nthis._headerYearId=Dwt.getNextId();\nthis._yearHeadingDivId=Dwt.getNextId();\nthis._yearAllDayDivId=Dwt.getNextId();\nthis._leftAllDaySepDivId=Dwt.getNextId();\nthis._leftApptSepDivId=Dwt.getNextId();\nthis._allDayScrollDivId=Dwt.getNextId();\nthis._allDayHeadingDivId=Dwt.getNextId();\nthis._allDayApptScrollDivId=Dwt.getNextId();\nthis._allDayDivId=Dwt.getNextId();\nthis._hoursScrollDivId=Dwt.getNextId();\nthis._bodyHourDivId=Dwt.getNextId();\nthis._allDaySepDivId=Dwt.getNextId();\nthis._allDaySepSashDivId=Dwt.getNextId();\nthis._bodyDivId=Dwt.getNextId();\nthis._apptBodyDivId=Dwt.getNextId();\nthis._newApptDivId=Dwt.getNextId();\nthis._newAllDayApptDivId=Dwt.getNextId();\nthis._timeSelectionDivId=Dwt.getNextId();\nthis._curTimeIndicatorHourDivId=Dwt.getNextId();\nthis._curTimeIndicatorGridDivId=Dwt.getNextId();\nthis._hourColDivId=Dwt.getNextId();\nthis._startLimitIndicatorDivId=Dwt.getNextId();\nthis._endLimitIndicatorDivId=Dwt.getNextId();\nthis._tabsContainerDivId=Dwt.getNextId();\nif(this._scheduleMode){this._unionHeadingDivId=Dwt.getNextId();\nthis._unionAllDayDivId=Dwt.getNextId();\nthis._unionHeadingSepDivId=Dwt.getNextId();\nthis._unionGridScrollDivId=Dwt.getNextId();\nthis._unionGridDivId=Dwt.getNextId();\nthis._unionGridSepDivId=Dwt.getNextId();\nthis._workingHrsFirstDivId=Dwt.getNextId();\nthis._workingHrsFirstChildDivId=Dwt.getNextId();\nthis._workingHrsSecondDivId=Dwt.getNextId();\nthis._workingHrsSecondChildDivId=Dwt.getNextId()\n}this._allDayRows=[];\nif(!this._scheduleMode){for(var d=0;\nd<this.numDays;\nd++){this._columns[d]={index:d,dayIndex:d,titleId:Dwt.getNextId(),headingDaySepDivId:Dwt.getNextId(),daySepDivId:Dwt.getNextId(),workingHrsFirstDivId:Dwt.getNextId(),workingHrsFirstChildDivId:Dwt.getNextId(),workingHrsSecondDivId:Dwt.getNextId(),workingHrsSecondChildDivId:Dwt.getNextId(),apptX:0,apptWidth:0,allDayX:0,allDayWidth:0}\n}}var g=(this._isInviteMessage&&!this._isRight?\"height:26px;\":\"\");\nvar b=\"position:absolute;\"+g;\ne.append(\"<div id='\",this._yearHeadingDivId,\"' class='calendar_heading' style='\",b,\"'>\");\ne.append(\"<div id='\",this._headerYearId,\"' class=calendar_heading_year_text style='position:absolute; width:\",ZmCalColView._HOURS_DIV_WIDTH,\"px;'></div>\");\ne.append(\"</div>\");\ne.append(\"<div id='\",this._yearAllDayDivId,\"' style='position:absolute'></div>\");\ne.append(\"<div id='\",this._leftAllDaySepDivId,\"' class='calendar_day_separator' style='position:absolute'></div>\");\nif(this._scheduleMode){e.append(\"<div id='\",this._unionHeadingDivId,\"' class=calendar_heading style='position:absolute'>\");\ne.append(\"<div class=calendar_heading_year_text style='position:absolute; width:\",ZmCalColView._UNION_DIV_WIDTH,\"px;'>\",ZmMsg.all,\"</div>\");\ne.append(\"</div>\");\ne.append(\"<div id='\",this._unionAllDayDivId,\"' style='position:absolute'></div>\");\ne.append(\"<div id='\",this._unionHeadingSepDivId,\"' class='calendar_day_separator' style='position:absolute'></div>\")\n}e.append(\"<div id='\",this._allDayScrollDivId,\"' style='position:absolute; overflow:hidden;'>\");\ne.append(\"<div id='\",this._tabsContainerDivId,\"' name='_tabsContainerDivId' style='position:absolute;height:25px;bottom:0px;top:0px'>\");\ne.append(\"<div id='\",this._allDayHeadingDivId,\"' class='calendar_heading' style='\",b,\"'>\");\nif(!this._scheduleMode){for(var d=0;\nd<this.numDays;\nd++){e.append(\"<div id='\",this._columns[d].titleId,\"' class='calendar_heading_day' style='position:absolute;'></div>\")\n}}e.append(\"</div>\");\ne.append(\"</div>\");\nif(!this._scheduleMode){for(var d=0;\nd<this.numDays;\nd++){e.append(\"<div id='\",this._columns[d].headingDaySepDivId,\"' class='calendar_day_separator' style='position:absolute'></div>\")\n}}e.append(\"</div>\");\ne.append(\"<div id='\",this._allDayApptScrollDivId,\"' class='calendar_allday_appt' style='position:absolute'>\");\ne.append(\"<div id='\",this._allDayDivId,\"' style='position:absolute'>\");\ne.append(\"<div id='\",this._newAllDayApptDivId,\"' class='appt-selected' style='position:absolute; display:none;'></div>\");\ne.append(\"</div>\");\ne.append(\"</div>\");\ne.append(\"<div id='\",this._allDaySepDivId,\"' class=calendar_header_allday_separator style='overflow:hidden;position:absolute;'><div id='\",this._allDaySepSashDivId,\"' class='calendar_header_allday_separator_sash open'></div></div>\");\ne.append(\"<div id='\",this._hoursScrollDivId,\"' class=calendar_hour_scroll style='position:absolute;'>\");\nthis._createHoursHtml(e);\ne.append(\"</div>\");\ne.append(\"<div id='\",this._leftApptSepDivId,\"' class='calendar_day_separator' style='position:absolute'></div>\");\nif(this._scheduleMode){e.append(\"<div id='\",this._unionGridScrollDivId,\"' class=calendar_union_scroll style='position:absolute'>\");\ne.append(\"<div id='\",this._unionGridDivId,\"' class='ImgCalendarDayGrid' style='width:100%; height:1008px; position:absolute;'>\");\ne.append(\"</div></div>\");\ne.append(\"<div id='\",this._unionGridSepDivId,\"' class='calendar_day_separator' style='position:absolute'></div>\")\n}e.append(\"<div id='\",this._bodyDivId,\"' class=calendar_body style='position:absolute'>\");\ne.append(\"<div id='\",this._apptBodyDivId,\"' class='ImgCalendarDayGrid' style='width:100%; height:1008px; position:absolute;background-color:#E3E3DC;'>\");\ne.append(\"<div id='\",this._timeSelectionDivId,\"' class='calendar_time_selection' style='position:absolute; display:none;z-index:10;'></div>\");\ne.append(\"<div id='\",this._newApptDivId,\"' class='appt-selected' style='position:absolute; display:none;'></div>\");\nif(!this._scheduleMode){for(var d=0;\nd<this.numDays;\nd++){e.append(\"<div id='\",this._columns[d].daySepDivId,\"' class='calendar_day_separator' style='position:absolute'></div>\");\ne.append(\"<div id='\",this._columns[d].workingHrsFirstDivId,\"' style='position:absolute;background-color:#FFFFFF;'><div id='\",this._columns[d].workingHrsFirstChildDivId,\"' class='ImgCalendarDayGrid' style='position:absolute;top:0px;left:0px;overflow:hidden;'></div></div>\");\ne.append(\"<div id='\",this._columns[d].workingHrsSecondDivId,\"' style='position:absolute;background-color:#FFFFFF;'><div id='\",this._columns[d].workingHrsSecondChildDivId,\"' class='ImgCalendarDayGrid' style='position:absolute;top:0px;left:0px;overflow:hidden;'></div></div>\")\n}}else{e.append(\"<div id='\",this._workingHrsFirstDivId,\"' style='position:absolute;background-color:#FFFFFF;'><div class='ImgCalendarDayGrid' id='\",this._workingHrsFirstChildDivId,\"' style='position:absolute;top:0px;left:0px;overflow:hidden;'></div></div>\");\ne.append(\"<div id='\",this._workingHrsSecondDivId,\"' style='position:absolute;background-color:#FFFFFF;'><div class='ImgCalendarDayGrid' id='\",this._workingHrsSecondChildDivId,\"' style='position:absolute;top:0px;left:0px;overflow:hidden;'></div></div>\")\n}e.append(\"</div>\");\ne.append(\"<div id='\"+this._curTimeIndicatorGridDivId+\"' class='calendar_cur_time_indicator_container'><div class='calendar_cur_time_indicator_strip'></div></div>\");\ne.append(\"<div id='\"+this._startLimitIndicatorDivId+\"' class='calendar_start_limit_indicator'><div class='ImgArrowMoreUp'></div></div>\");\ne.append(\"<div id='\"+this._endLimitIndicatorDivId+\"' class='calendar_end_limit_indicator'><div class='ImgArrowMoreDown'></div></div>\");\ne.append(\"</div>\");\nthis.getHtmlElement().innerHTML=e.toString();\nvar h=AjxCallback.simpleClosure(ZmCalColView.__onScroll,ZmCalColView,this);\ndocument.getElementById(this._bodyDivId).onscroll=h;\ndocument.getElementById(this._allDayApptScrollDivId).onscroll=h;\ndocument.getElementById(this._tabsContainerDivId).onscroll=h;\nvar f=[this._apptBodyDivId,this._bodyHourDivId,this._allDayDivId,this._allDaySepDivId];\nvar c=[ZmCalBaseView.TYPE_APPTS_DAYGRID,ZmCalBaseView.TYPE_HOURS_COL,ZmCalBaseView.TYPE_ALL_DAY,ZmCalBaseView.TYPE_DAY_SEP];\nfor(var d=0;\nd<f.length;\nd++){this.associateItemWithElement(null,document.getElementById(f[d]),c[d],f[d])\n}this._scrollToTime(8)\n};\nZmCalColView.prototype.updateTimeIndicator=function(a){this._updateTimeIndicator(a);\nreturn this.setTimer(1)\n};\nZmCalColView.prototype._updateTimeIndicator=function(a){var d=new Date();\nvar h=d.getHours();\nvar e=d.getMinutes();\nvar c=document.getElementById(this._hourColDivId+\"_\"+h);\nif(!c){return\n}var g=document.getElementById(this._curTimeIndicatorHourDivId);\nvar b=Math.round((ZmCalColView._HOUR_HEIGHT/60)*e)+parseInt(c.offsetParent.offsetTop);\nDwt.setLocation(g,c.offsetParent.offsetLeft,b-5);\nvar i=document.getElementById(this._curTimeIndicatorGridDivId);\nDwt.setVisibility(i,true);\nvar f=document.getElementById(this._calendarTodayHeaderDivId);\nif(f&&(a||this._isValidIndicatorDuration)){Dwt.setBounds(i,f.offsetLeft,b,f.offsetWidth,null)\n}else{Dwt.setVisibility(i,false)\n}};\nZmCalColView.prototype.startIndicatorTimer=function(a){if(a||!this._indicatorTimer){this._indicatorTimer=this.updateTimeIndicator(a)\n}};\nZmCalColView.prototype.checkIndicatorNeed=function(g,a){var h=(g==ZmId.VIEW_CAL_WORK_WEEK||g==ZmId.VIEW_CAL_WEEK||g==ZmId.VIEW_CAL_DAY);\nif(a!=null&&h){var f=new Date();\nvar b=f.getTime();\na.setHours(0,0,0,0);\nvar e=a.getTime();\nvar c=AjxDateUtil.roll(a,AjxDateUtil.DAY,1);\nc.setHours(23,59,59,999);\nvar d=c.getTime();\nif(!(b>=e&&b<=d)){this._isValidIndicatorDuration=false;\nvar i=document.getElementById(this._curTimeIndicatorGridDivId);\nDwt.setVisibility(i,false)\n}else{this._isValidIndicatorDuration=true;\nthis.updateTimeIndicator()\n}}else{this._isValidIndicatorDuration=true\n}};\nZmCalColView.prototype._checkForOffscreenAppt=function(d){var b=false;\nvar j=false;\nif(!d){d=document.getElementById(this._bodyDivId)\n}if(!d){return\n}var l=d.offsetHeight;\nvar h=d.scrollTop;\nvar a;\nif(this._list&&this._list.size()>0){var g=this._list.getArray();\nfor(var e=0;\ne<g.length;\ne++){a=g[e];\nif(!a){continue\n}var c=g[e].getLayoutInfo();\nif(!b){b=(c&&c.y<(h))\n}if(!j){j=(c&&c.y>(l+h))\n}if(b&&j){break\n}}}var f=document.getElementById(this._startLimitIndicatorDivId);\nDwt.setVisibility(f,b);\nvar k=document.getElementById(this._endLimitIndicatorDivId);\nDwt.setVisibility(k,j);\nif(b){f.style.top=d.scrollTop+\"px\"\n}if(j){k.style.top=((d.offsetHeight+d.scrollTop+8)-(k.offsetHeight))+\"px\"\n}};\nZmCalColView.__onScroll=function(a){if(this.__scrollActionId){AjxTimedAction.cancelAction(this.__scrollActionId);\ndelete this.__scrollActionId\n}this.__scrollActionId=AjxTimedAction.scheduleAction(new AjxTimedAction(a,a._syncScroll),30)\n};\nZmCalColView.prototype._computeMaxCols=function(c,a){if(c.maxDone){return c.maxcol\n}c.maxcol=Math.max(c.col,c.maxcol,a);\nif(c.right){for(var b=0;\nb<c.right.length;\nb++){c.maxcol=Math.max(c.col,this._computeMaxCols(c.right[b],c.maxcol))\n}}c.maxDone=true;\nreturn c.maxcol\n};\nZmCalColView.prototype._computeApptLayout=function(){var s=this._layouts=new Array();\nvar y=[];\nvar d=[];\nvar t=this.getList();\nif(!t){return\n}var g=t.size();\nif(g==0){return\n}var b=null;\nvar a=null;\nfor(var r=0;\nr<g;\nr++){var h=t.get(r);\nif(!h||h.isAllDayEvent()){continue\n}var z={appt:h,col:0,maxcol:-1};\nb=null;\na=null;\nvar m=h.startDate;\nvar w=h.endDate;\nvar o=m.getDate();\nvar x=w.getDate();\nvar e=(o!=x);\nvar f=[];\nif(e){f.push(s)\n}else{f.push(d);\nif(y[o]!=null){f.push(y[o])\n}}for(var p=0;\np<f.length;\np++){for(var q=0;\nq<f[p].length;\nq++){var u=f[p][q];\nif(h.isOverlapping(u.appt,this._scheduleMode)){if(b==null){b=[];\na=[]\n}b.push(u);\na[u.col]=true;\nwhile(a[z.col]){z.col++\n}}}}if(b!=null){for(var v=0;\nv<b.length;\nv++){var n=b[v];\nif(z.col<n.col){if(!z.right){z.right=[n]\n}else{z.right.push(n)\n}}else{if(!n.right){n.right=[z]\n}else{n.right.push(z)\n}}}}s.push(z);\nif(o==x){if(!y[o]){y[o]=[]\n}y[o].push(z)\n}else{d.push(z)\n}}for(var r=0;\nr<s.length;\nr++){this._computeMaxCols(s[r],-1);\nthis._layoutMap[this._getItemId(s[r].appt)]=s[r]\n}delete d;\ndelete y;\ndelete f\n};\nZmCalColView.prototype._addAllDayApptRowLayout=function(){var c=[];\nvar a=this._columns.length;\nfor(var b=0;\nb<a;\nb++){c[b]={free:true,data:null}\n}this._allDayApptsRowLayouts.push(c);\nreturn c\n};\nZmCalColView.prototype._fillAllDaySlot=function(e,c,d){for(var b=0;\nb<d.numDays;\nb++){var a=c+b;\nif(a==e.length){break\n}e[a].data=b==0?d:null;\ne[a].free=false\n}};\nZmCalColView.prototype._findAllDaySlot=function(h,e){if(e.appt){var a=e.appt;\nvar b=a.getStartTime();\nvar g=a.getEndTime();\ne.numDays=1;\nif(b!=g){e.numDays=this._calcNumDays(b,g)\n}if(b<e.startTime){e.numDays-=this._calcNumDays(b,e.startTime)\n}}var l=this._allDayApptsRowLayouts;\nvar k=null;\nfor(var f=0;\nf<l.length;\nf++){k=l[f];\nfor(var d=0;\nd<e.numDays;\nd++){var c=h+d;\nif(c==k.length){break\n}if(!k[c].free){k=null;\nbreak\n}}if(k!=null){break\n}}if(k==null){k=this._addAllDayApptRowLayout()\n}this._fillAllDaySlot(k,h,e)\n};\nZmCalColView.prototype._calcNumDays=function(b,a){return Math.round((a-b)/AjxDateUtil.MSEC_PER_DAY)\n};\nZmCalColView.prototype._calcOffsetFromZeroColumn=function(c){var b=this._columns[0].dayIndex;\nvar a=this._days[b];\nreturn Math.round((c-a.date.getTime())/AjxDateUtil.MSEC_PER_DAY)\n};\nZmCalColView.prototype._computeAllDayApptLayout=function(){var d=this._allDayApptsList;\nd.sort(ZmCalBaseItem.compareByTimeAndDuration);\nfor(var b=0;\nb<d.length;\nb++){var c=d[b];\nvar e=this._allDayAppts[c.getUniqueId()];\nif(e){var a=this._scheduleMode?this._getColForFolderId(e.appt.folderId):this._getDayForDate(new Date(e.startTime));\nif(a){this._findAllDaySlot(a.index,e)\n}}}};\nZmCalColView.prototype._layoutAllDayAppts=function(){var l=this._allDayApptsRowLayouts;\nif(!l){return\n}var d=ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD+2;\nfor(var f=0;\nf<l.length;\nf++){var k=l[f];\nvar g=this._scheduleMode?this._numCalendars:this.numDays;\nfor(var e=0;\ne<g;\ne++){var h=k[e];\nif(h.data){var a=h.data.appt;\nvar c=document.getElementById(this._getItemId(a));\nif(c){if(this._scheduleMode){var b=this._getColForFolderId(a.folderId);\nthis._positionAppt(c,b.allDayX+0,d);\nthis._sizeAppt(c,((b.allDayWidth+this._daySepWidth)*h.data.numDays)-this._daySepWidth-1,ZmCalColView._ALL_DAY_APPT_HEIGHT)\n}else{this._positionAppt(c,this._columns[e].allDayX+0,d);\nthis._sizeAppt(c,((this._columns[e].allDayWidth+this._daySepWidth)*h.data.numDays)-this._daySepWidth-1,ZmCalColView._ALL_DAY_APPT_HEIGHT)\n}}}}d+=ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD\n}};\nZmCalColView._getApptWidthPercent=function(a){switch(a){case 1:return 1;\ncase 2:return 0.8;\ncase 3:return 0.6;\ncase 4:return 0.4;\ndefault:return 0.4\n}};\nZmCalColView.prototype._positionAppt=function(c,a,b){if(!c){return\n}Dwt.setLocation(c,a+ZmCalColView._APPT_X_FUDGE,b+ZmCalColView._APPT_Y_FUDGE)\n};\nZmCalColView.prototype._sizeAppt=function(f,b,c){if(!f){return\n}var d=b+ZmCalColView._APPT_WIDTH_FUDGE;\nvar a=c;\nDwt.setSize(f,d>=0?d:0,a>=0?a:0);\nvar e=document.getElementById(f.id+\"_body\");\nif(e!=null){d=b+ZmCalColView._APPT_WIDTH_FUDGE;\na=c+ZmCalColView._APPT_HEIGHT_FUDGE;\nDwt.setSize(e,d>=0?d:0,a>=0?a:0)\n}};\nZmCalColView.prototype._layoutAppt=function(d,f,a,e,b,c){if(d){d._layout={x:a,y:e,w:b,h:c}\n}this._positionAppt(f,a,e);\nthis._sizeAppt(f,b,c)\n};\nZmCalColView.prototype._layoutAppts=function(){var f=this._hours[0];\nfor(var d=0;\nd<this._layouts.length;\nd++){var e=this._layouts[d];\nvar g=document.getElementById(this._getItemId(e.appt));\nif(g){e.bounds=this._getBoundsForAppt(e.appt);\nif(!e.bounds){continue\n}var c=Math.floor(e.bounds.width*ZmCalColView._getApptWidthPercent(e.maxcol+1));\nvar b=e.maxcol?((e.bounds.width-c)/e.maxcol):0;\nvar a=b*e.col+(e.bounds.x);\nthis._layoutAppt(e.appt,g,a,e.bounds.y,c,e.bounds.height)\n}}};\nZmCalColView.prototype._getDayForDate=function(a){return this._dateToDayIndex[this._dayKey(a)]\n};\nZmCalColView.prototype._getColForFolderId=function(a){return this._folderIdToColIndex[a]\n};\nZmCalColView.prototype._getColFromX=function(a){var c=this._columns.length;\nfor(var d=0;\nd<c;\nd++){var b=this._columns[d];\nif(a>=b.apptX&&a<=b.apptX+b.apptWidth){return b\n}}return null\n};\nZmCalColView.prototype._getLocationForDate=function(e){var c=e.getHours();\nvar a=e.getMinutes();\nvar b=this._getDayForDate(e);\nif(b==null){return null\n}return new DwtPoint(b.apptX,Math.floor(((c+a/60)*ZmCalColView._HOUR_HEIGHT))+1)\n};\nZmCalColView.prototype._getBoundsForAppt=function(c){var f=c.startDate;\nvar g=new Date(f);\ng.setHours(23,59,59,999);\nvar e=new Date(c.endDate);\ne.setHours(0,0,0,0);\nvar a=c.getEndTime();\nif(c.startDate.getTime()==e.getTime()){var b=c.checkDSTChangeOnEndDate();\na=a+(b*60*1000)\n}var d=Math.min(a,g.getTime());\nif(this._scheduleMode){return this._getBoundsForCalendar(f,d-f.getTime(),c.folderId)\n}else{return this._getBoundsForDate(f,d-f.getTime())\n}};\nZmCalColView.prototype._getBoundsForDate=function(i,g,c){var f=g/1000/60;\nf=Math.max(f,ZmCalColView._MINIMUM_APPT_HEIGHT);\nvar e=i.getHours();\nvar a=i.getMinutes();\nif(c==null&&!this._scheduleMode){var b=this._getDayForDate(i);\nc=b?this._columns[b.index]:null\n}if(c==null){return null\n}return new DwtRectangle(c.apptX,((e+a/60)*ZmCalColView._HOUR_HEIGHT),c.apptWidth,(ZmCalColView._HOUR_HEIGHT/60)*f)\n};\nZmCalColView.prototype._getBoundsForCalendar=function(i,g,b){var f=g/1000/60;\nf=Math.max(f,ZmCalColView._MINIMUM_APPT_HEIGHT);\nvar e=i.getHours();\nvar a=i.getMinutes();\nvar c=this._getColForFolderId(b);\nif(c==null){return null\n}return new DwtRectangle(c.apptX,((e+a/60)*ZmCalColView._HOUR_HEIGHT),c.apptWidth,(ZmCalColView._HOUR_HEIGHT/60)*f)\n};\nZmCalColView.prototype._getBoundsForAllDayDate=function(c,b,a){if(c==null||b==null){return null\n}var d=a?ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD+2:0;\nreturn new DwtRectangle(c.col.allDayX,d,(b.col.allDayX+b.col.allDayWidth)-c.col.allDayX-this._daySepWidth-1,ZmCalColView._ALL_DAY_APPT_HEIGHT)\n};\nZmCalColView.prototype._snapXY=function(c,f,e,b){var d=this._getColFromX(c);\nif(d==null){return null\n}c=d.apptX;\nvar a=(e/60)*ZmCalColView._HOUR_HEIGHT;\nf=Math.floor(f/a)*a;\nif(b){f+=a\n}return{x:c,y:f,col:d}\n};\nZmCalColView.prototype._snapAllDayXY=function(a,c){var b=this._getColFromX(a);\nif(b==null){return null\n}a=b.allDayX;\nreturn{x:a,y:0,col:b}\n};\nZmCalColView.prototype._snapAllDayOutsideGrid=function(a){var d=this._columns[0].allDayWidth+this._daySepWidth;\nvar c=Math.floor(a/d);\nvar b=(c*d)+2;\nreturn{x:b,y:0,col:{index:c}}\n};\nZmCalColView.prototype._createAllDayDateFromIndex=function(b){var c=this._columns[0].dayIndex;\nvar a=this._days[c];\nreturn new Date(a.date.getTime()+(AjxDateUtil.MSEC_PER_DAY*b))\n};\nZmCalColView.prototype._getDateFromXY=function(b,g,e,a){var d=this._getColFromX(b);\nif(d==null){return null\n}var f=Math.floor((g/ZmCalColView._HOUR_HEIGHT)*60);\nif(e!=null&&e>1){f=Math.floor(f/e)*e;\nif(a){f+=e\n}}var c=this._days[d.dayIndex];\nif(c==null){return null\n}return new Date(c.date.getTime()+(f*60*1000))\n};\nZmCalColView.prototype._getAllDayDateFromXY=function(a,d){var c=this._getColFromX(a);\nif(c==null){return null\n}var b=this._days[c.dayIndex];\nif(b==null){return null\n}return new Date(b.date.getTime())\n};\nZmCalColView.prototype._setBounds=function(f,a,e,b,d){var c=typeof f===\"string\"?document.getElementById(f):f;\nif(c==null){}else{Dwt.setBounds(c,a,e,b,d)\n}};\nZmCalColView.prototype._calcColWidth=function(a,d,b){var c=0;\nreturn dayWidth=Math.floor((a-c)/d)-(this._daySepWidth==1?0:1)\n};\nZmCalColView.prototype._calcMinBodyWidth=function(a,b){return minWidth=(ZmCalColView.MIN_COLUMN_WIDTH+(this._daySepWidth==1?0:1))*b\n};\nZmCalColView.prototype._layout=function(e){this._updateDays();\nvar d=this._columns.length;\nvar i=this.getSize(true);\nif(!i){return\n}var n=i.x+(this._isRight?-2:0);\nvar j=i.y;\nif(n==0||j==0){return\n}this._needFirstLayout=false;\nvar h=ZmCalColView._HOURS_DIV_WIDTH;\nvar m=h+this._daySepWidth;\nvar p=m;\nif(this._scheduleMode){m+=ZmCalColView._UNION_DIV_WIDTH+this._daySepWidth\n}this._bodyDivWidth=n-m;\nthis._apptBodyDivHeight=ZmCalColView._DAY_HEIGHT+1;\nthis._apptBodyDivWidth=Math.max(this._bodyDivWidth,this._calcMinBodyWidth(this._bodyDivWidth,d));\nvar c=this._apptBodyDivWidth>this._bodyDivWidth;\nthis._horizontalScrollbar(c);\nvar o=AjxEnv.isIE?1:0;\nvar t=this._calcColWidth(this._apptBodyDivWidth-Dwt.SCROLLBAR_WIDTH,d);\nif(c){this._apptBodyDivWidth-=18\n}var g=c?20:0;\nthis._setBounds(this._yearHeadingDivId,0,0,h,Dwt.DEFAULT);\nvar r=document.getElementById(this._allDayHeadingDivId);\nDwt.setBounds(r,0,0,this._apptBodyDivWidth+g,Dwt.DEFAULT);\nvar a=Dwt.getSize(r).y;\nvar b=this._allDayApptsRowLayouts?(this._allDayApptsRowLayouts.length):1;\nif(this._allDayApptsList&&this._allDayApptsList.length>0){b++\n}this._allDayFullDivHeight=(ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD)*b+ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD;\nvar s=(this._allDayFullDivHeight/j)*100;\nthis._allDayDivHeight=this._allDayFullDivHeight;\nif(s>50){var l=Math.floor((0.5*j-ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD)/(ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD));\nthis._allDayDivHeight=(ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD)*l+ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD\n}this._setBounds(this._allDayApptScrollDivId,m,a,this._bodyDivWidth,this._allDayDivHeight);\nthis._setBounds(this._allDayDivId,0,0,this._apptBodyDivWidth+g,this._allDayFullDivHeight);\nthis._allDayVerticalScrollbar(this._allDayDivHeight!=this._allDayFullDivHeight);\nthis._setBounds(this._yearAllDayDivId,0,a,h,this._allDayDivHeight);\nvar f=a+this._allDayDivHeight;\nthis._setBounds(this._allDayScrollDivId,m,0,this._bodyDivWidth,f);\nthis._setBounds(this._leftAllDaySepDivId,h,0,this._daySepWidth,f);\nthis._setBounds(this._allDaySepDivId,0,(this._hideAllDayAppt?ZmCalColView._DAY_HEADING_HEIGHT:f),n,ZmCalColView._ALL_DAY_SEP_HEIGHT);\nvar k=(this._hideAllDayAppt?ZmCalColView._DAY_HEADING_HEIGHT:f)+ZmCalColView._ALL_DAY_SEP_HEIGHT+(AjxEnv.isIE?0:2);\nthis._bodyDivHeight=j-k;\nthis._setBounds(this._hoursScrollDivId,0,k,h,this._bodyDivHeight);\nthis._setBounds(this._leftApptSepDivId,h,k,this._daySepWidth,ZmCalColView._DAY_HEIGHT);\nthis._setBounds(this._bodyDivId,m,k,this._bodyDivWidth,this._bodyDivHeight);\nthis._setBounds(this._apptBodyDivId,0,-1,this._apptBodyDivWidth,this._apptBodyDivHeight);\nif(this._scheduleMode){this._setBounds(this._unionHeadingDivId,p,0,ZmCalColView._UNION_DIV_WIDTH,Dwt.DEFAULT);\nthis._setBounds(this._unionAllDayDivId,p,a,ZmCalColView._UNION_DIV_WIDTH,this._allDayDivHeight);\nvar q=p+ZmCalColView._UNION_DIV_WIDTH;\nthis._setBounds(this._unionHeadingSepDivId,q,0,this._daySepWidth,f);\nthis._setBounds(this._unionGridScrollDivId,p,k,ZmCalColView._UNION_DIV_WIDTH,this._bodyDivHeight);\nthis._setBounds(this._unionGridDivId,0,-1,ZmCalColView._UNION_DIV_WIDTH,this._apptBodyDivHeight+ZmCalColView._HOUR_HEIGHT);\nthis._setBounds(this._unionGridSepDivId,q,k,this._daySepWidth,this._apptBodyDivHeight)\n}this.layoutWorkingHours(this.workingHours);\nthis._layoutAllDayAppts();\nthis._apptBodyDivOffset=Dwt.toWindow(document.getElementById(this._apptBodyDivId),0,0,null,true);\nthis._apptAllDayDivOffset=Dwt.toWindow(document.getElementById(this._allDayDivId),0,0,null,true);\nif(this._scheduleMode||e){this._layoutAppts();\nthis._checkForOffscreenAppt(document.getElementById(this._bodyDivId));\nif(this._scheduleMode){this._layoutUnionData()\n}}};\nZmCalColView.prototype.getPostionForWorkingHourDiv=function(a,m){a=a||0;\nm=m||0;\nvar d=this.workingHours[a],c=d.startTime[m],g=d.endTime[m],e=(c%100)/15,k=(g%100)/15,l=2*Math.floor(c/100),h=2*Math.floor(g/100),i=ZmCalColView._HALF_HOUR_HEIGHT/2,j=l*ZmCalColView._HALF_HOUR_HEIGHT,b=h*ZmCalColView._HALF_HOUR_HEIGHT,f=b-j;\nreturn{topPosition:j,workingDivHeight:f,startMinAdjust:e*i,endMinAdjust:k*i}\n};\nZmCalColView.prototype.layoutWorkingHoursDiv=function(a,d,b,c){this._setBounds(a,b,d.topPosition+d.startMinAdjust,c,d.workingDivHeight+d.endMinAdjust-d.startMinAdjust);\nthis._setBounds(document.getElementById(a).firstChild,0,-d.startMinAdjust,c,d.workingDivHeight+d.endMinAdjust)\n};\nZmCalColView.prototype.layoutWorkingHours=function(f){if(!f){f=ZmCalBaseView.parseWorkingHours(ZmCalBaseView.getWorkingHours());\nthis.workingHours=f\n}var e=this._columns.length;\nvar k=this._calcColWidth(this._apptBodyDivWidth-Dwt.SCROLLBAR_WIDTH,e);\nvar g=document.getElementById(this._allDayHeadingDivId);\nvar j=Dwt.getSize(g).y;\nvar d=0;\nfor(var h=0;\nh<e;\nh++){var c=this._columns[h];\nvar m=this._days[c.dayIndex];\nthis._setBounds(c.titleId,d+1,Dwt.DEFAULT,k,ZmCalColView._DAY_HEADING_HEIGHT);\nc.apptX=d+2;\nc.apptWidth=k-this._daySepWidth-3;\nc.allDayX=c.apptX;\nc.allDayWidth=k;\nvar a=m.date.getDay(),b=this.workingHours[a],l=this.getPostionForWorkingHourDiv(a,0);\nif(m.isWorkingDay){if(!this._scheduleMode){this.layoutWorkingHoursDiv(c.workingHrsFirstDivId,l,d,k);\nif(b.startTime.length>=2&&b.endTime.length>=2){l=this.getPostionForWorkingHourDiv(a,1);\nthis.layoutWorkingHoursDiv(c.workingHrsSecondDivId,l,d,k)\n}}if(this._scheduleMode){this.layoutWorkingHoursDiv(this._workingHrsFirstDivId,l,0,k);\nif(b.startTime.length>=2&&b.endTime.length>=2){l=this.getPostionForWorkingHourDiv(a,1);\nthis.layoutWorkingHoursDiv(this._workingHrsSecondDivId,l,0,k)\n}}}d+=k;\nthis._setBounds(c.headingDaySepDivId,d,0,this._daySepWidth,j+this._allDayDivHeight);\nthis._setBounds(c.daySepDivId,d,0,this._daySepWidth,this._apptBodyDivHeight);\nd+=this._daySepWidth\n}};\nZmCalColView.prototype._calculateColumnApptLeft=function(b,c,a){if(b<0){a=0\n}else{a-=1\n}return(c*b)+(this._daySepWidth*a)+2\n};\nZmCalColView.prototype._layoutFBBar=function(){var b=this._getDayForDate(this._date);\nvar a=b?b.date:this._date;\nvar c=b?b.endDate:null;\nthis.getFreeBusyInfo(a,c,new AjxCallback(this,this._handleFBResponse))\n};\nZmCalColView.prototype._handleFBResponse=function(c){var d=c.getResponse().GetFreeBusyResponse.usr;\nd=d[0];\nvar f=document.getElementById(this._hoursScrollDivId);\nif(!this._fbBarSlots){var g=document.createElement(\"DIV\");\nif(f){f.appendChild(g);\nDwt.setPosition(g,Dwt.ABSOLUTE_STYLE);\nthis._fbBarSlots=g;\nthis._fbBarSlotsId=g.id=Dwt.getNextId()\n}}if(f){var e=Dwt.getLocation(f);\nvar b=e.x;\nb=b+(ZmCalColView._HOURS_DIV_WIDTH-ZmCalColView._FBBAR_DIV_WIDTH+1);\nDwt.setLocation(this._fbBarSlots,b,0);\nvar a=document.getElementById(this._bodyDivId).scrollHeight;\nDwt.setSize(this._fbBarSlots,ZmCalColView._FBBAR_DIV_WIDTH-2,a);\nthis._fbBarSlots.innerHTML=\"\";\nif(d.t){this._drawSlots(ZmCalColView._STATUS_TENTATIVE,d.t)\n}if(d.b){this._drawSlots(ZmCalColView._STATUS_BUSY,d.b)\n}if(d.o){this._drawSlots(ZmCalColView._STATUS_OOO,d.o)\n}if(d.u){this._drawSlots(ZmCalColView._STATUS_OOO,d.u)\n}}};\nZmCalColView.prototype._drawSlots=function(f,k){var g=this._timeRangeStart;\nvar j=document.getElementById(this._bodyDivId).scrollHeight;\nfor(var h=0;\nh<k.length;\nh++){var l=k[h];\nvar c=l.s;\nvar e=l.e;\nif(e>g+AjxDateUtil.MSEC_PER_DAY){e=g+AjxDateUtil.MSEC_PER_DAY\n}if(c<g){c=g\n}c=new Date(c);\ne=new Date(e);\nc=c.getHours()*60+c.getMinutes();\ne=e.getHours()*60+e.getMinutes();\nvar b=Math.floor(c*(j/(24*60)));\nvar d=Math.floor(e*(j/(24*60)));\nvar a=document.createElement(\"DIV\");\na.className=this._getFBBarSlotColor(f);\nDwt.setPosition(a,Dwt.ABSOLUTE_STYLE);\nthis._fbBarSlots.appendChild(a);\na.style.top=(b-2)+\"px\";\na.style.height=(d-b)+\"px\";\na.style.width=ZmCalColView._FBBAR_DIV_WIDTH-2\n}};\nZmCalColView.prototype._getFBBarSlotColor=function(a){switch(a){case ZmCalColView._STATUS_FREE:return\"ZmFBBar-free\";\ncase ZmCalColView._STATUS_TENTATIVE:return\"ZmFBBar-tentative\";\ncase ZmCalColView._STATUS_BUSY:return\"ZmFBBar-busy\";\ncase ZmCalColView._STATUS_OOO:return\"ZmFBBar-ooo\"\n}return\"ZmFBBar-busy\"\n};\nZmCalColView.prototype.getFreeBusyInfo=function(e,b,f,a){if(e instanceof Date){e=e.getTime()\n}if(b instanceof Date){b=b.getTime()\n}b=b||(e+AjxDateUtil.MSEC_PER_DAY);\nvar c=appCtxt.getActiveAccount().getEmail();\nvar d=AjxSoapDoc.create(\"GetFreeBusyRequest\",\"urn:zimbraMail\");\nd.setMethodAttribute(\"s\",e);\nd.setMethodAttribute(\"e\",b);\nd.setMethodAttribute(\"uid\",c);\nreturn appCtxt.getAppController().sendRequest({soapDoc:d,asyncMode:true,callback:f,errorCallback:a,noBusyOverlay:true})\n};\nZmCalColView.prototype._isFBBarDiv=function(a){var b=DwtUiEvent.getTargetWithProp(a,\"id\");\nif(b.id==this._fbBarSlotsId){return true\n}return false\n};\nZmCalColView.prototype._getFBBarToolTipContent=function(b){var c=DwtUiEvent.getTarget(b);\nvar a=c.className;\nif(/-busy$/.test(a)){return ZmMsg.busy\n}if(/-tentative$/.test(a)){return ZmMsg.tentative\n}if(/-ooo$/.test(a)){return ZmMsg.outOfOffice\n}return ZmMsg.free\n};\nZmCalColView.prototype._getUnionToolTip=function(c){var f=this._unionBusyDataToolTip[c];\nif(f){return f\n}var e=this._unionBusyData[c];\nif(!e instanceof Object){return null\n}var b=new AjxBuffer();\nb.append(\"<table cellpadding=2 cellspacing=0 border=0>\");\nvar d=this._controller.getCheckedCalendarFolderIds();\nfor(var c=0;\nc<d.length;\nc++){var h=d[c];\nif(e[h]){var g=this._controller.getCalendar(h);\nif(g){var a=ZmCalendarApp.COLORS[g.color];\nb.append(\"<tr valign='center' class='\",a,\"Bg'><td>\",AjxImg.getImageHtml(g.getIcon()),\"</td>\");\nb.append(\"<td>\",AjxStringUtil.htmlEncode(g.getName()),\"</td></tr>\")\n}}}b.append(\"</table>\");\nf=this._unionBusyDataToolTip[c]=b.toString();\nreturn f\n};\nZmCalColView.prototype._layoutUnionDataDiv=function(c,h,e,d,b){var g=d instanceof Object;\nvar a=this._unionBusyDivIds[e];\nvar k=null;\nif(a==null){if(!g){return\n}a=this._unionBusyDivIds[e]=Dwt.getNextId();\nvar k=document.createElement(\"div\");\nk.style.position=\"absolute\";\nk.className=\"calendar_sched_union_div\";\nthis.associateItemWithElement(null,k,ZmCalBaseView.TYPE_SCHED_FREEBUSY,a,{index:e});\nDwt.setOpacity(k,40);\nif(e==48){h.appendChild(k)\n}else{c.appendChild(k);\nDwt.setBounds(k,2,ZmCalColView._HALF_HOUR_HEIGHT*e+1,ZmCalColView._UNION_DIV_WIDTH-4,ZmCalColView._HALF_HOUR_HEIGHT-2)\n}}else{k=document.getElementById(a)\n}if(e==48){Dwt.setBounds(k,1,1,ZmCalColView._UNION_DIV_WIDTH-2,this._allDayDivHeight-2)\n}var f=0;\nfor(var j in d){f++\n}Dwt.setOpacity(k,20+(60*(f/b)));\nDwt.setVisibility(k,g)\n};\nZmCalColView.prototype._layoutUnionData=function(){if(!this._unionBusyData){return\n}var c=document.getElementById(this._unionGridDivId);\nvar a=document.getElementById(this._unionAllDayDivId);\nvar d=this._columns.length;\nfor(var b=0;\nb<49;\nb++){this._layoutUnionDataDiv(c,a,b,this._unionBusyData[b],d)\n}};\nZmCalColView.prototype._handleApptScrollRegion=function(j,h,c,f){var d=0;\nvar k=h<this._apptBodyDivOffset.y;\nvar g=h>this._apptBodyDivOffset.y+this._bodyDivHeight-8;\nif(k||g){var b=document.getElementById(this._bodyDivId);\nvar i=b.scrollTop;\nif(k&&i>0){d=-(i>c?c:i)\n}else{if(g){var a=this._apptBodyDivHeight-this._bodyDivHeight;\nif(i<a){var e=a-i;\nd=e>c?c:e\n}}}if(d!=0){b.scrollTop+=d;\nthis._syncScroll()\n}if(f){f.docY-=d\n}}return d\n};\nZmCalColView.prototype._controlListener=function(b){if(b.newWidth==Dwt.DEFAULT&&b.newHeight==Dwt.DEFAULT){return\n}try{if((b.oldWidth!=b.newWidth)||(b.oldHeight!=b.newHeight)){this._layout(true);\nthis._updateTimeIndicator()\n}}catch(a){}};\nZmCalColView.prototype._apptSelected=function(){};\nZmCalColView._ondblclickHandler=function(a){a=DwtUiEvent.getEvent(a);\na._isDblClick=true;\nZmCalColView._onclickHandler(a)\n};\nZmCalColView.prototype._mouseOverAction=function(b,c){var a=this._getItemData(c,\"type\");\nif(a==ZmCalBaseView.TYPE_DAY_HEADER){c.style.textDecoration=\"underline\"\n}};\nZmCalColView.prototype.getToolTipContent=function(c){if(this._fbBarEnabled&&this._isFBBarDiv(c)){return this._getFBBarToolTipContent(c)\n}var d=this.getTargetItemDiv(c);\nvar b=this._getItemData(d,\"type\");\nif(b==ZmCalBaseView.TYPE_SCHED_FREEBUSY){var a=this._getItemData(d,\"index\");\nreturn this._getUnionToolTip(a)\n}return ZmCalBaseView.prototype.getToolTipContent.apply(this,arguments)\n};\nZmCalColView.prototype._mouseOutAction=function(b,c){ZmCalBaseView.prototype._mouseOutAction.call(this,b,c);\nvar a=this._getItemData(c,\"type\");\nif(a==ZmCalBaseView.TYPE_DAY_HEADER){c.style.textDecoration=\"none\"\n}else{if(a==ZmCalBaseView.TYPE_SCHED_FREEBUSY){this.setToolTipContent(null)\n}}};\nZmCalColView.prototype._mouseUpAction=function(d,f){if(Dwt.ffScrollbarCheck(d)){return false\n}var c=this._getItemData(f,\"type\");\nif(c==ZmCalBaseView.TYPE_DAY_HEADER&&!this._scheduleMode&&!this._isInviteMessage){var b=this._getItemData(f,\"dayIndex\");\nvar a=this._days[b].date;\nvar e=appCtxt.getCurrentController();\nif(this.numDays>1){e.setDate(a);\ne.show(ZmId.VIEW_CAL_DAY)\n}else{if(a.getDay()>0&&a.getDay()<6){e.show(ZmId.VIEW_CAL_WORK_WEEK)\n}else{e.show(ZmId.VIEW_CAL_WEEK)\n}}}else{if(c==ZmCalBaseView.TYPE_DAY_SEP){this.toggleAllDayAppt(!this._hideAllDayAppt)\n}}};\nZmCalColView.prototype._doubleClickAction=function(b,c){ZmCalBaseView.prototype._doubleClickAction.call(this,b,c);\nvar a=this._getItemData(c,\"type\");\nif(a==ZmCalBaseView.TYPE_APPTS_DAYGRID||a==ZmCalBaseView.TYPE_ALL_DAY){this._timeSelectionAction(b,c,true)\n}};\nZmCalColView.prototype._timeSelectionAction=function(i,a,f){var c;\nvar e=ZmCalColView._MSEC_DURATION;\nvar g=false;\nvar d;\nvar h=this._getItemData(a,\"type\");\nswitch(h){case ZmCalBaseView.TYPE_APPTS_DAYGRID:d=Dwt.toWindow(i.target,i.elementX,i.elementY,a,true);\nc=this._getDateFromXY(d.x,d.y,ZmCalColView._SNAP_MINUTES);\nbreak;\ncase ZmCalBaseView.TYPE_ALL_DAY:d=Dwt.toWindow(i.target,i.elementX,i.elementY,a,true);\nc=this._getAllDayDateFromXY(d.x,d.y);\ng=true;\nbreak;\ndefault:return\n}if(c==null){return false\n}var b=this._getColFromX(d.x);\nthis._timeSelectionEvent(c,e,f,g,null,i.shiftKey)\n};\nZmCalColView.prototype._mouseDownAction=function(b,f){var a=this._getItemData(f,\"type\");\nif(a!=ZmCalBaseView.TYPE_APPT&&Dwt.ffScrollbarCheck(b)){return false\n}switch(a){case ZmCalBaseView.TYPE_APPT_BOTTOM_SASH:case ZmCalBaseView.TYPE_APPT_TOP_SASH:this.setToolTipContent(null);\nreturn this._sashMouseDownAction(b,f);\nbreak;\ncase ZmCalBaseView.TYPE_APPT:this.setToolTipContent(null);\nreturn this._apptMouseDownAction(b,f);\nbreak;\ncase ZmCalBaseView.TYPE_HOURS_COL:if(b.button==DwtMouseEvent.LEFT){var d=AjxEnv.isIE?Dwt.toWindow(b.target,b.elementX,b.elementY,f,true):{x:b.elementX,y:b.elementY};\nvar c=this._getLocationForDate(this.getDate());\nif(c){d.x=c.x;\nvar e=document.getElementById(this._apptBodyDivId);\nreturn this._gridMouseDownAction(b,e,d)\n}}else{if(b.button==DwtMouseEvent.RIGHT){DwtUiEvent.copy(this._actionEv,b);\nthis._actionEv.item=this;\nthis._evtMgr.notifyListeners(ZmCalBaseView.VIEW_ACTION,this._actionEv)\n}}break;\ncase ZmCalBaseView.TYPE_APPTS_DAYGRID:if(!appCtxt.isWebClientOffline()){this._timeSelectionAction(b,f,false);\nif(b.button==DwtMouseEvent.LEFT){var d=Dwt.toWindow(b.target,b.elementX,b.elementY,f,true);\nreturn this._gridMouseDownAction(b,f,d)\n}else{if(b.button==DwtMouseEvent.RIGHT){DwtUiEvent.copy(this._actionEv,b);\nthis._actionEv.item=this;\nthis._evtMgr.notifyListeners(ZmCalBaseView.VIEW_ACTION,this._actionEv)\n}}}break;\ncase ZmCalBaseView.TYPE_ALL_DAY:this._timeSelectionAction(b,f,false);\nif(b.button==DwtMouseEvent.LEFT){var d=Dwt.toWindow(b.target,b.elementX,b.elementY,f,true);\nreturn this._gridMouseDownAction(b,f,d,true)\n}else{if(b.button==DwtMouseEvent.RIGHT){DwtUiEvent.copy(this._actionEv,b);\nthis._actionEv.item=this;\nthis._evtMgr.notifyListeners(ZmCalBaseView.VIEW_ACTION,this._actionEv)\n}}break\n}return false\n};\nZmCalColView.prototype._apptDndBegin=function(d){var h=Dwt.getLocation(d.apptEl);\nd.dndObj={};\nd.apptX=h.x;\nd.apptY=h.y;\nd.apptsDiv=document.getElementById(this._apptBodyDivId);\nd.bodyDivEl=document.getElementById(this._bodyDivId);\nd.apptBodyEl=document.getElementById(d.apptEl.id+\"_body\");\nd.startDate=new Date(d.appt.getStartTime());\nd.startTimeEl=document.getElementById(d.apptEl.id+\"_st\");\nd.endTimeEl=document.getElementById(d.apptEl.id+\"_et\");\nif(d.appt.isAllDayEvent()){d.saveHTML=d.apptEl.innerHTML;\nd.saveLoc=h;\nvar c=this._snapXY(d.apptX,d.apptY,15);\nvar b=this._snapXY(d.apptX+d.apptOffset.x,d.apptY,15);\nd.apptOffset.x=d.apptOffset.x-b.x+c.x;\nvar i=this._calcOffsetFromZeroColumn(d.appt.getStartTime());\nvar e=this._columns[0].allDayWidth+this._daySepWidth;\nvar g=d.appt.getEndTime();\nvar f=this._calcNumDays(d.startDate,g);\nd.apptX=this._calculateColumnApptLeft(i,e,f);\nd.snap=this._snapAllDayOutsideGrid(d.apptX+d.apptOffset.x);\nd.apptWidth=(e*f)-this._daySepWidth-1;\nd.apptY-=ZmCalColView._APPT_Y_FUDGE;\nvar a=new DwtRectangle(d.apptX,d.apptY,d.apptWidth,ZmCalColView._ALL_DAY_APPT_HEIGHT);\nthis._layoutAppt(d.appt,d.apptEl,a.x,a.y,a.width,a.height);\nd.disableScroll=true\n}else{d.snap=this._snapXY(d.apptX+d.apptOffset.x,d.apptY,15)\n}if(d.snap==null){return false\n}this.deselectAll();\nthis.setSelection(d.appt);\nDwt.addClass(d.apptBodyEl,DwtCssStyle.DROPPABLE);\nDwt.setOpacity(d.apptEl,ZmCalColView._OPACITY_APPT_DND);\nd.dndStarted=true;\nreturn true\n};\nZmCalColView.prototype._restoreApptLoc=function(c){if(c&&c.appt){var b=c.appt._layout;\nc.view._layoutAppt(null,c.apptEl,b.x,b.y,b.w,b.h);\nif(c.startTimeEl){c.startTimeEl.innerHTML=ZmCalBaseItem._getTTHour(c.appt.startDate)\n}if(c.endTimeEl){c.endTimeEl.innerHTML=ZmCalBaseItem._getTTHour(c.appt.endDate)\n}ZmCalBaseView._setApptOpacity(c.appt,c.apptEl)\n}else{if(c.newApptDivEl){c.gridEl.style.cursor=\"auto\";\nvar a=c.view._getColFromX(c.gridX);\nDwt.setVisible(c.newApptDivEl,false)\n}}};\nZmCalColView.prototype._restoreAppt=function(a){if(a.appt.isAllDayEvent()){Dwt.setLocation(a.apptEl,a.saveLoc.x,a.saveLoc.y);\na.apptEl.innerHTML=a.saveHTML\n}};\nZmCalColView.prototype._createContainerRect=function(a){this._containerRect=null;\nif(a.appt.isAllDayEvent()){this._containerRect=new DwtRectangle(this._apptAllDayDivOffset.x,this._apptAllDayDivOffset.y,this._bodyDivWidth,this._allDayDivHeight+this._bodyDivHeight+ZmCalColView._SCROLL_PRESSURE_FUDGE)\n}else{this._containerRect=new DwtRectangle(this._apptAllDayDivOffset.x,this._apptBodyDivOffset.y-ZmCalColView._SCROLL_PRESSURE_FUDGE,this._bodyDivWidth,this._bodyDivHeight+ZmCalColView._SCROLL_PRESSURE_FUDGE)\n}};\nZmCalColView.prototype._clearSnap=function(a){a.x=null;\na.y=null\n};\nZmCalColView.prototype._restoreHighlight=function(a){Dwt.setOpacity(a.apptEl,ZmCalColView._OPACITY_APPT_DND);\nDwt.addClass(a.apptBodyEl,DwtCssStyle.DROPPABLE)\n};\nZmCalColView.prototype._doApptMove=function(f,d,b){var c=null;\nvar a=f.view._snapXY(f.apptX+f.apptOffset.x+d,f.apptY+b,15);\nif(a==null){if(f.appt.isAllDayEvent()){a=f.view._snapAllDayOutsideGrid(f.apptX+f.apptOffset.x+d);\nc=f.view._createAllDayDateFromIndex(a.col.index)\n}}else{c=f.view._getDateFromXY(a.x,a.y,15)\n}if(a!=null&&((a.x!=f.snap.x||a.y!=f.snap.y))){if(c!=null&&(!(f.view._scheduleMode&&a.col!=f.snap.col))&&(c.getTime()!=f.startDate.getTime())){var e=null;\nif(f.appt.isAllDayEvent()){var e=new DwtRectangle(a.x,f.apptY,f.apptWidth,ZmCalColView._ALL_DAY_APPT_HEIGHT)\n}else{e=f.view._getBoundsForDate(c,f.appt._orig.getDuration(),a.col)\n}f.view._layoutAppt(null,f.apptEl,e.x,e.y,e.width,e.height);\nf.startDate=c;\nf.snap=a;\nif(f.startTimeEl){f.startTimeEl.innerHTML=ZmCalBaseItem._getTTHour(f.startDate)\n}if(f.endTimeEl){f.endTimeEl.innerHTML=ZmCalBaseItem._getTTHour(new Date(f.startDate.getTime()+f.appt.getDuration()))\n}}}};\nZmCalColView.prototype._deselectDnDHighlight=function(a){Dwt.delClass(a.apptBodyEl,DwtCssStyle.DROPPABLE);\nZmCalBaseView._setApptOpacity(a.appt,a.apptEl)\n};\nZmCalColView.prototype._sashMouseDownAction=function(h,e){if(h.button!=DwtMouseEvent.LEFT){return false\n}var c=e.parentNode;\nvar b=document.getElementById(c.id+\"_body\");\nvar a=this.getItemFromElement(c);\nvar k=Dwt.getSize(b).y;\nvar i=Dwt.getLocation(c);\nvar l=Dwt.getSize(c).y;\nvar g=this._getItemData(e,\"type\");\nvar f=(g==ZmCalBaseView.TYPE_APPT_TOP_SASH);\nvar d={sash:e,isTop:f,appt:a,view:this,apptEl:c,endTimeEl:document.getElementById(c.id+\"_et\"),startTimeEl:document.getElementById(c.id+\"_st\"),apptBodyEl:b,origHeight:k,apptX:i.x,apptY:i.y,parentOrigHeight:l,startY:h.docY};\nif(f){d.startDate=new Date(a.getStartTime())\n}else{d.endDate=new Date(a.getEndTime())\n}var j=new DwtMouseEventCapture({targetObj:d,mouseOverHdlr:ZmCalColView._emptyHdlr,mouseDownHdlr:ZmCalColView._emptyHdlr,mouseMoveHdlr:ZmCalColView._sashMouseMoveHdlr,mouseUpHdlr:ZmCalColView._sashMouseUpHdlr,mouseOutHdlr:ZmCalColView._emptyHdlr});\nj.capture();\nthis.deselectAll();\nthis.setSelection(d.appt);\nDwt.setOpacity(c,ZmCalColView._OPACITY_APPT_DND);\nreturn false\n};\nZmCalColView._sashMouseMoveHdlr=function(e){var f=DwtShell.mouseEvent;\nf.setFromDhtmlEvent(e);\nvar g=0;\nvar c=DwtMouseEventCapture.getTargetObj();\nif(f.docY>0&&f.docY!=c.startY){g=f.docY-c.startY\n}var j=c.view._apptDraggedOut(f.docX,f.docY);\nif(j){if(!c._lastDraggedOut){c._lastDraggedOut=true;\nc.view._restoreApptLoc(c)\n}}else{if(c._lastDraggedOut){c._lastDraggedOut=false;\nc.lastDelta=0;\nDwt.setOpacity(c.apptEl,ZmCalColView._OPACITY_APPT_DND)\n}var d=c.view._handleApptScrollRegion(f.docX,f.docY,ZmCalColView._HOUR_HEIGHT,null);\nif(d!=0){c.startY-=d\n}var b=Math.floor(g/ZmCalColView._15_MINUTE_HEIGHT);\ng=b*ZmCalColView._15_MINUTE_HEIGHT;\nif(g!=c.lastDelta){if(c.isTop){var i=c.apptY+g;\nvar a=c.origHeight-g;\nif(a>=ZmCalColView._15_MINUTE_HEIGHT){Dwt.setLocation(c.apptEl,Dwt.DEFAULT,i);\nDwt.setSize(c.apptEl,Dwt.DEFAULT,c.parentOrigHeight-g);\nDwt.setSize(c.apptBodyEl,Dwt.DEFAULT,Math.floor(a));\nc.lastDelta=g;\nc.startDate.setTime(c.appt.getStartTime()+(b*AjxDateUtil.MSEC_PER_FIFTEEN_MINUTES));\nif(c.startTimeEl){c.startTimeEl.innerHTML=ZmCalBaseItem._getTTHour(c.startDate)\n}}}else{var a=c.origHeight+g;\nif(a>=ZmCalColView._15_MINUTE_HEIGHT){var h=c.parentOrigHeight+g;\nDwt.setSize(c.apptEl,Dwt.DEFAULT,h);\nDwt.setSize(c.apptBodyEl,Dwt.DEFAULT,a+ZmCalColView._APPT_HEIGHT_FUDGE);\nc.lastDelta=g;\nc.endDate.setTime(c.appt.getEndTime()+(b*AjxDateUtil.MSEC_PER_FIFTEEN_MINUTES));\nif(c.endTimeEl){c.endTimeEl.innerHTML=ZmCalBaseItem._getTTHour(c.endDate)\n}}}}}f._stopPropagation=true;\nf._returnValue=false;\nf.setToDhtmlEvent(e);\nreturn false\n};\nZmCalColView._sashMouseUpHdlr=function(i){var d=DwtMouseEventCapture.getTargetObj();\nZmCalBaseView._setApptOpacity(d.appt,d.apptEl);\nvar j=DwtShell.mouseEvent;\nj.setFromDhtmlEvent(i);\nif(j.button!=DwtMouseEvent.LEFT){DwtUiEvent.setBehaviour(i,true,false);\nreturn false\n}DwtMouseEventCapture.getCaptureObj().release();\nj._stopPropagation=true;\nj._returnValue=false;\nj.setToDhtmlEvent(i);\nvar k=d.view._apptDraggedOut(j.docX,j.docY);\nif(k){d.view._restoreApptLoc(d);\nreturn false\n}var g=false;\nvar b=null,f=null;\nif(d.isTop&&d.startDate.getTime()!=d.appt.getStartTime()){g=true;\nb=d.startDate\n}else{if(!d.isTop&&d.endDate.getTime()!=d.appt.getEndTime()){g=true;\nf=d.endDate\n}}if(g){d.view._autoScrollDisabled=true;\nvar c=d.view.getController();\nvar e=new AjxCallback(null,ZmCalColView._handleDnDError,d);\nvar a=b?(b.getTime()-d.appt.getStartTime()):null;\nvar h=f?(f.getTime()-d.appt.getEndTime()):null;\nc.dndUpdateApptDate(d.appt._orig,a,h,null,e,j)\n}return false\n};\nZmCalColView.prototype._gridMouseDownAction=function(c,e,f,b){if(c.button!=DwtMouseEvent.LEFT){return false\n}if(ZmCalViewController._contextMenuOpened){ZmCalViewController._contextMenuOpened=false;\nreturn false\n}var d={dndStarted:false,view:this,gridEl:e,gridX:f.x,gridY:f.y,docX:c.docX,docY:c.docY,isAllDay:b};\nvar a=new DwtMouseEventCapture({targetObj:d,mouseOverHdlr:ZmCalColView._emptyHdlr,mouseDownHdlr:ZmCalColView._emptyHdlr,mouseMoveHdlr:b?ZmCalColView._gridAllDayMouseMoveHdlr:ZmCalColView._gridMouseMoveHdlr,mouseUpHdlr:ZmCalColView._gridMouseUpHdlr,mouseOutHdlr:ZmCalColView._emptyHdlr});\na.capture();\nreturn false\n};\nZmCalColView.prototype._gridDndBegin=function(b){if(appCtxt.isExternalAccount()){return false\n}var a=b.view._getColFromX(b.gridX);\nif(b.isAllDay){b.gridEl.style.cursor=\"e-resize\";\nb.newApptDivEl=document.getElementById(b.view._newAllDayApptDivId);\nb.view._populateNewApptHtml(b.newApptDivEl,true,null);\nb.apptBodyEl=document.getElementById(b.newApptDivEl.id+\"_body\");\nb.view._allDayScrollToBottom()\n}else{b.gridEl.style.cursor=\"s-resize\";\nb.newApptDivEl=document.getElementById(b.view._newApptDivId);\nb.view._populateNewApptHtml(b.newApptDivEl,false,null);\nb.apptBodyEl=document.getElementById(b.newApptDivEl.id+\"_body\");\nb.endTimeEl=document.getElementById(b.newApptDivEl.id+\"_et\");\nb.startTimeEl=document.getElementById(b.newApptDivEl.id+\"_st\")\n}this.deselectAll();\nreturn true\n};\nZmCalColView.prototype.initializeTimeScroll=function(){this._scrollToTime(8)\n};\nZmCalColView._gridMouseMoveHdlr=function(l){var m=DwtShell.mouseEvent;\nm.setFromDhtmlEvent(l);\nvar i=DwtMouseEventCapture.getTargetObj();\nvar g=m.docX-i.docX;\nvar f=m.docY-i.docY;\nif(!i.dndStarted){var n=(Math.abs(g)<ZmCalColView.DRAG_THRESHOLD&&Math.abs(f)<ZmCalColView.DRAG_THRESHOLD);\nif(n||!i.view._gridDndBegin(i)){m._stopPropagation=true;\nm._returnValue=false;\nm.setToDhtmlEvent(l);\nreturn false\n}}var j=i.view._handleApptScrollRegion(m.docX,m.docY,ZmCalColView._HOUR_HEIGHT,null);\nif(j!=0){i.docY-=j;\nf+=j\n}var c=i.view._snapXY(i.gridX+g,i.gridY+f,ZmCalColView._SNAP_MINUTES);\nif(c==null){return false\n}var h,b;\nif(f>=0){h=i.view._snapXY(i.gridX,i.gridY,ZmCalColView._SNAP_MINUTES);\nb=i.view._snapXY(i.gridX,i.gridY+f,ZmCalColView._SNAP_MINUTES,true)\n}else{b=i.view._snapXY(i.gridX,i.gridY,ZmCalColView._SNAP_MINUTES);\nh=i.view._snapXY(i.gridX,i.gridY+f,ZmCalColView._SNAP_MINUTES)\n}if(h==null||b==null){return false\n}if((i.start==null)||(i.start.y!=h.y)||(i.end.y!=b.y)){if(!i.dndStarted){i.dndStarted=true\n}i.start=h;\ni.end=b;\ni.startDate=i.view._getDateFromXY(i.start.x,i.start.y,ZmCalColView._SNAP_MINUTES,false);\ni.endDate=i.view._getDateFromXY(i.end.x,i.end.y,ZmCalColView._SNAP_MINUTES,false);\nvar k=i.newApptDivEl;\nif(!k){return\n}var d=(i.endDate.getTime()-i.startDate.getTime());\nif(d<ZmCalColView._MSEC_DURATION){d=ZmCalColView._MSEC_DURATION\n}var a=i.view._getBoundsForDate(i.startDate,d,h.col);\nif(a==null){return false\n}i.view._layoutAppt(null,k,h.x,h.y,a.width,a.height);\nDwt.setVisible(k,true);\nif(i.startTimeEl){i.startTimeEl.innerHTML=ZmCalBaseItem._getTTHour(i.startDate)\n}if(i.endTimeEl){i.endTimeEl.innerHTML=ZmCalBaseItem._getTTHour(i.endDate)\n}}m._stopPropagation=true;\nm._returnValue=false;\nm.setToDhtmlEvent(l);\nreturn false\n};\nZmCalColView._gridMouseUpHdlr=function(h){var f=DwtMouseEventCapture.getTargetObj();\nvar i=DwtShell.mouseEvent;\ni.setFromDhtmlEvent(h);\nDwtMouseEventCapture.getCaptureObj().release();\nif(!f.dndStarted&&appCtxt.get(ZmSetting.CAL_USE_QUICK_ADD)){var g,c;\nvar e=i.docY-f.docY;\nif(e>=0){g=f.view._snapXY(f.gridX,f.gridY,ZmCalColView._SNAP_MINUTES);\nc=f.view._snapXY(f.gridX,f.gridY+e,ZmCalColView._SNAP_MINUTES,true)\n}else{c=f.view._snapXY(f.gridX,f.gridY,ZmCalColView._SNAP_MINUTES);\ng=f.view._snapXY(f.gridX,f.gridY+e,ZmCalColView._SNAP_MINUTES)\n}if(g==null||c==null){return false\n}if((f.start==null)||(f.start.y!=g.y)||(f.end.y!=c.y)){if(!f.dndStarted){f.dndStarted=true\n}f.start=g;\nf.end=c;\nf.startDate=f.view._getDateFromXY(f.start.x,f.start.y,ZmCalColView._SNAP_MINUTES,false);\nf.endDate=f.view._getDateFromXY(f.end.x,f.end.y,ZmCalColView._SNAP_MINUTES,false)\n}if(f.isAllDay){f.newApptDivEl=document.getElementById(f.view._newAllDayApptDivId)\n}else{f.newApptDivEl=document.getElementById(f.view._newApptDivId)\n}}if(f.dndStarted){f.gridEl.style.cursor=\"auto\";\nvar b=f.view._getColFromX(f.gridX);\nvar a=b&&b.cal&&b.cal.id;\nDwt.setVisible(f.newApptDivEl,false);\nif(f.isAllDay){appCtxt.getCurrentController().newAllDayAppointmentHelper(f.startDate,f.endDate,a,i.shiftKey)\n}else{var d=(f.endDate.getTime()-f.startDate.getTime());\nif(d<ZmCalColView._MSEC_DURATION){d=ZmCalColView._MSEC_DURATION\n}appCtxt.getCurrentController().newAppointmentHelper(f.startDate,d,a,i.shiftKey)\n}}i._stopPropagation=true;\ni._returnValue=false;\ni.setToDhtmlEvent(h);\nreturn false\n};\nZmCalColView._gridAllDayMouseMoveHdlr=function(k){var l=DwtShell.mouseEvent;\nl.setFromDhtmlEvent(k);\nvar g=DwtMouseEventCapture.getTargetObj();\nvar f=l.docX-g.docX;\nvar d=l.docY-g.docY;\nif(!g.dndStarted){var m=(Math.abs(f)<ZmCalColView.DRAG_THRESHOLD&&Math.abs(d)<ZmCalColView.DRAG_THRESHOLD);\nif(m||!g.view._gridDndBegin(g)){l._stopPropagation=true;\nl._returnValue=false;\nl.setToDhtmlEvent(k);\nreturn false\n}}var c=g.view._snapXY(g.gridX+f,g.gridY+d,ZmCalColView._SNAP_MINUTES);\nif(c==null){return false\n}var h,b;\nif(f>=0){h=g.view._snapAllDayXY(g.gridX,g.gridY);\nb=g.view._snapAllDayXY(g.gridX+f,g.gridY)\n}else{b=g.view._snapAllDayXY(g.gridX,g.gridY);\nh=g.view._snapAllDayXY(g.gridX+f,g.gridY)\n}if(h==null||b==null){return false\n}if((g.start==null)||(!g.view._scheduleMode&&((g.start.x!=h.x)||(g.end.x!=b.x)))){if(!g.dndStarted){g.dndStarted=true\n}g.start=h;\ng.end=b;\ng.startDate=g.view._getAllDayDateFromXY(g.start.x,g.start.y);\ng.endDate=g.view._getAllDayDateFromXY(g.end.x,g.end.y);\nvar i=g.newApptDivEl;\nif(!i){return\n}var a=g.view._getBoundsForAllDayDate(g.start,g.end);\nif(a==null){return false\n}var j=g.view._allDayFullDivHeight-(ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD);\nDwt.setLocation(i,h.x,j);\nDwt.setSize(i,a.width,a.height);\nDwt.setSize(g.apptBodyEl,a.width,a.height);\nDwt.setVisible(i,true)\n}l._stopPropagation=true;\nl._returnValue=false;\nl.setToDhtmlEvent(k);\nreturn false\n};\nZmCalColView._emptyHdlr=function(b){var a=DwtShell.mouseEvent;\na.setFromDhtmlEvent(b);\na._stopPropagation=true;\na._returnValue=false;\na.setToDhtmlEvent(b);\nreturn false\n};\nZmCalColView._handleError=function(a){a.view.getController()._refreshAction(true);\nreturn false\n};\nZmCalColView._handleDnDError=function(a){a.view._layout(true);\nreturn false\n};\nZmCalColView.prototype.toggleAllDayAppt=function(b){var a=document.getElementById(this._allDayApptScrollDivId);\nDwt.setVisible(a,!b);\nvar d=document.getElementById(this._allDaySepSashDivId);\nif(b){Dwt.addClass(d,\"closed\")\n}else{Dwt.delClass(d,\"closed\")\n}if(this._scheduleMode){var c=document.getElementById(this._unionAllDayDivId);\nDwt.setVisible(c,!b)\n}this._hideAllDayAppt=!this._hideAllDayAppt;\nthis._layout()\n};\nZmCalColView.prototype._postApptCreate=function(a,c){var f=this._layoutMap[this._getItemId(a)];\nif(f){f.bounds=this._getBoundsForAppt(f.appt);\nif(!f.bounds){return\n}apptWidthPercent=ZmCalColView._getApptWidthPercent(f.maxcol+1);\nvar h=Math.floor(f.bounds.width*apptWidthPercent);\nvar i=f.maxcol?((f.bounds.width-h)/f.maxcol):0;\nvar g=i*f.col+(f.bounds.x);\nif(a){a._layout={x:g,y:f.bounds.y,w:h,h:f.bounds.height}\n}var d=f.bounds.height;\nvar e=f.bounds.y;\nvar b=document.getElementById(this._getItemId(f.appt));\nthis._layoutAppt(f.appt,b,g,e,h,d)\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalDayView\")){ZmCalDayView=function(j,c,e,g,h,f,d,a,i){var b=a?ZmId.getViewId(ZmId.VIEW_CAL_DAY,null,h):ZmId.VIEW_CAL_DAY;\nZmCalColView.call(this,j,c,e,g,b,1,false,d,a,i);\nthis._compactMode=false\n};\nZmCalDayView.prototype=new ZmCalColView;\nZmCalDayView.prototype.constructor=ZmCalDayView;\nZmCalDayView.prototype.toString=function(){return\"ZmCalDayView\"\n};\nZmCalDayView.prototype.setCompactMode=function(a){this._compactMode=a\n};\nZmCalDayView.prototype.isCompactMode=function(){return this._compactMode\n};\nZmCalDayView.prototype.fbStatusBarEnabled=function(){return true\n};\nZmCalDayView.prototype._layout=function(c){ZmCalColView.prototype._layout.call(this,c);\nif(this._compactMode&&!this._closeButton){var b=this._closeButton=new DwtButton({parent:this,style:DwtLabel.ALIGN_RIGHT|DwtButton.ALWAYS_FLAT,posStyle:DwtControl.ABSOLUTE_STYLE,className:\"DwtToolbarButton cal_day_expand\"});\nthis._closeButton.setImage(\"Close\");\nthis._closeButton.setToolTipContent(ZmMsg.close);\nthis._closeButton.setSize(16,16);\nvar a=this.getSize();\nthis._closeButton.setLocation(a.x-22,0);\nthis._closeButton.addSelectionListener(new AjxListener(this,this._closeDayViewListener))\n}};\nZmCalDayView.prototype._closeDayViewListener=function(){if(this._closeDayViewCallback){this._closeDayViewCallback.run()\n}};\nZmCalDayView.prototype.setCloseDayViewCallback=function(a){this._closeDayViewCallback=a\n};\nZmCalDayView.prototype.setSize=function(b,a){ZmCalColView.prototype.setSize.call(this,b,a);\nif(this._closeButton){this._closeButton.setLocation(b-22,0)\n}};\nZmCalDayView.prototype.layout=function(){this._layout(true)\n};\nZmCalDayView.prototype._controlListener=function(a){if(!this._compactMode){ZmCalColView.prototype._controlListener.call(this,a)\n}};\nZmCalDayView.prototype._apptMouseDownAction=function(b,a){appt=this.getItemFromElement(a);\nif(appt.isAllDayEvent()){return false\n}else{return ZmCalBaseView.prototype._apptMouseDownAction.call(this,b,a,appt)\n}};\nZmCalDayView.prototype._updateDays=function(){var a=this.view;\nthis.view=ZmId.VIEW_CAL_DAY;\nZmCalColView.prototype._updateDays.call(this);\nthis.view=a\n};\nZmCalDayTabView=function(i,b,d,f,g,e,c,a,h){ZmCalColView.call(this,i,b,d,f,ZmId.VIEW_CAL_DAY,1,true);\nthis._compactMode=false\n};\nZmCalDayTabView.prototype=new ZmCalColView;\nZmCalDayTabView.prototype.constructor=ZmCalDayTabView;\nZmCalDayTabView._ALL_DAY_APPT_HEIGHT_PAD=3;\nZmCalDayTabView._UNION_DIV_WIDTH=0;\nZmCalDayTabView._TAB_BORDER_WIDTH=1;\nZmCalDayTabView._TAB_BORDER_MARGIN=4;\nZmCalDayTabView._TAB_SEP_WIDTH=8;\nZmCalDayTabView._TAB_TITLE_MAX_LENGTH=15;\nZmCalDayTabView.ATTR_CAL_ID=\"_calid\";\nZmCalDayTabView.prototype.toString=function(){return\"ZmCalDayTabView\"\n};\nZmCalDayTabView.prototype.fbStatusBarEnabled=function(){return true\n};\nZmCalDayTabView.prototype._createHtml=function(a){this._days={};\nthis._columns=[];\nthis._hours={};\nthis._layouts=[];\nthis._allDayAppts=[];\nthis._allDayRows=[];\nthis._headerYearId=Dwt.getNextId();\nthis._yearHeadingDivId=Dwt.getNextId();\nthis._yearAllDayDivId=Dwt.getNextId();\nthis._yearAllDayTopBorderId=Dwt.getNextId();\nthis._yearAllDayBottomBorderId=Dwt.getNextId();\nthis._leftAllDaySepDivId=Dwt.getNextId();\nthis._leftApptSepDivId=Dwt.getNextId();\nthis._allDayScrollDivId=Dwt.getNextId();\nthis._allDayHeadingDivId=Dwt.getNextId();\nthis._allDayApptScrollDivId=Dwt.getNextId();\nthis._allDayDivId=Dwt.getNextId();\nthis._hoursScrollDivId=Dwt.getNextId();\nthis._bodyHourDivId=Dwt.getNextId();\nthis._allDaySepDivId=Dwt.getNextId();\nthis._bodyDivId=Dwt.getNextId();\nthis._apptBodyDivId=Dwt.getNextId();\nthis._newApptDivId=Dwt.getNextId();\nthis._newAllDayApptDivId=Dwt.getNextId();\nthis._timeSelectionDivId=Dwt.getNextId();\nthis._curTimeIndicatorHourDivId=Dwt.getNextId();\nthis._curTimeIndicatorGridDivId=Dwt.getNextId();\nthis._startLimitIndicatorDivId=Dwt.getNextId();\nthis._endLimitIndicatorDivId=Dwt.getNextId();\nthis._hourColDivId=Dwt.getNextId();\nthis._unionHeadingDivId=Dwt.getNextId();\nthis._unionAllDayDivId=Dwt.getNextId();\nthis._unionHeadingSepDivId=Dwt.getNextId();\nthis._unionGridScrollDivId=Dwt.getNextId();\nthis._unionGridDivId=Dwt.getNextId();\nthis._unionGridSepDivId=Dwt.getNextId();\nthis._workingHrsFirstDivId=Dwt.getNextId();\nthis._workingHrsSecondDivId=Dwt.getNextId();\nthis._tabsContainerDivId=Dwt.getNextId();\nthis._toggleBtnContainerId=Dwt.getNextId();\nthis._borderLeftDivId=Dwt.getNextId();\nthis._borderRightDivId=Dwt.getNextId();\nthis._borderTopDivId=Dwt.getNextId();\nthis._borderBottomDivId=Dwt.getNextId();\nthis._startLimitIndicatorDivId=Dwt.getNextId();\nthis._endLimitIndicatorDivId=Dwt.getNextId();\nvar e=new AjxBuffer(),g=(this._isInviteMessage&&!this._isRight?\"height:26px;\":\"\"),b=\"position:absolute;\"+g,h,f,d,c;\ne.append(\"<div id='\",this._yearAllDayDivId,\"' name='_yearAllDayDivId' style='position:absolute;'>\");\ne.append(\"<div id='\",this._yearHeadingDivId,\"' class='calendar_heading_day_tab' name='_yearHeadingDivId' style='width:100%;height:100%;'>\");\ne.append(\"<div id='\",this._headerYearId,\"' name='_headerYearId' class=calendar_heading_year_text style='position:absolute; width:\",ZmCalColView._HOURS_DIV_WIDTH,\"px;'></div>\");\ne.append(\"</div>\");\ne.append(\"</div>\");\ne.append(\"<div id='\",this._leftAllDaySepDivId,\"' name='_leftAllDaySepDivId' class='calendar_day_separator' style='position:absolute'></div>\");\nif(this._scheduleMode){e.append(\"<div id='\",this._unionAllDayDivId,\"' name='_unionAllDayDivId' style='position:absolute'>\");\ne.append(\"<div id='\",this._unionHeadingDivId,\"' name='_unionHeadingDivId' class=calendar_heading style='position:absolute'>\");\ne.append(\"<div class=calendar_heading_year_text style='position:absolute; width:\",ZmCalDayTabView._UNION_DIV_WIDTH,\"px;'>\",ZmMsg.allDay,\"</div>\");\ne.append(\"</div>\");\ne.append(\"</div>\");\ne.append(\"<div id='\",this._unionHeadingSepDivId,\"' name='_unionHeadingSepDivId' class='calendar_day_separator' style='position:absolute'></div>\")\n}e.append(\"<div id='\",this._allDayScrollDivId,\"' name='_allDayScrollDivId' style='position:absolute; overflow:hidden;'>\");\ne.append(\"</div>\");\ne.append(\"<div id='\",this._allDayApptScrollDivId,\"' name='_allDayApptScrollDivId' class='calendar_allday_appt' style='position:absolute'>\");\ne.append(\"<div id='\",this._allDayDivId,\"' name='_allDayDivId' style='position:absolute'>\");\ne.append(\"<div id='\",this._newAllDayApptDivId,\"' name='_newAllDayApptDivId' class='appt-selected' style='position:absolute; display:none;'></div>\");\ne.append(\"</div>\");\ne.append(\"</div>\");\ne.append(\"<div id='\",this._allDaySepDivId,\"' name='_allDaySepDivId' style='overflow:hidden;position:absolute;'></div>\");\ne.append(\"<div id='\",this._hoursScrollDivId,\"' name='_hoursScrollDivId' class=calendar_hour_scroll style='position:absolute;'>\");\nthis._createHoursHtml(e);\ne.append(\"</div>\");\ne.append(\"<div id='\",this._leftApptSepDivId,\"' name='_leftApptSepDivId' class='calendar_day_separator' style='position:absolute'></div>\");\nif(this._scheduleMode){e.append(\"<div id='\",this._unionGridScrollDivId,\"' name='_unionGridScrollDivId' class=calendar_union_scroll style='position:absolute;display:none;'>\");\ne.append(\"<div id='\",this._unionGridDivId,\"' name='_unionGridDivId' class='ImgCalendarDayGrid' style='width:100%; height:1008px; position:absolute;'>\");\ne.append(\"</div></div>\");\ne.append(\"<div id='\",this._unionGridSepDivId,\"' name='_unionGridSepDivId' class='calendar_day_separator' style='position:absolute;display:none;'></div>\")\n}e.append(\"<div id='\",this._bodyDivId,\"' name='_bodyDivId' class=calendar_body style='position:absolute; overflow-x:hidden;'>\");\ne.append(\"<div id='\",this._apptBodyDivId,\"' name='_apptBodyDivId' class='ImgCalendarDayGrid' style='width:100%; height:1008px; position:absolute;background-color:#E3E3DC;'>\");\ne.append(\"<div id='\",this._timeSelectionDivId,\"' name='_timeSelectionDivId' class='calendar_time_selection' style='position:absolute; display:none;z-index:10;'></div>\");\ne.append(\"<div id='\",this._newApptDivId,\"' name='_newApptDivId' class='appt-selected' style='position:absolute; display:none;'></div>\");\ne.append(\"<div id='\",this._workingHrsFirstDivId,\"' style='position:absolute;background-color:#FFFFFF;'><div class='ImgCalendarDayGrid' id='\",this._workingHrsFirstChildDivId,\"' style='position:absolute;top:0px;left:0px;overflow:hidden;'></div></div>\");\ne.append(\"<div id='\",this._workingHrsSecondDivId,\"' style='position:absolute;background-color:#FFFFFF;'><div class='ImgCalendarDayGrid' id='\",this._workingHrsSecondChildDivId,\"' style='position:absolute;top:0px;left:0px;overflow:hidden;'></div></div>\");\ne.append(\"<div id='\",this._borderLeftDivId,\"' name='_borderLeftDivId' class='ZmDayTabSeparator' style='background-color:#FFFFFF;position:absolute;'></div>\");\ne.append(\"<div id='\",this._borderRightDivId,\"' name='_borderRightDivId' class='ZmDayTabSeparator' style='background-color:#FFFFFF;position:absolute;'></div>\");\ne.append(\"<div id='\",this._borderTopDivId,\"' name='_borderTopDivId' class='ZmDayTabSeparator' style='background-color:#FFFFFF;position:absolute;'></div>\");\ne.append(\"<div id='\",this._borderBottomDivId,\"' name='_borderBottomDivId' class='ZmDayTabSeparator' style='background-color:#FFFFFF;position:absolute;'></div>\");\ne.append(\"</div>\");\ne.append(\"<div id='\"+this._curTimeIndicatorGridDivId+\"' name='_curTimeIndicatorGridDivId' class='calendar_cur_time_indicator_strip' style='position:absolute;background-color:#F16426; height: 1px;'></div>\");\ne.append(\"<div id='\"+this._startLimitIndicatorDivId+\"' class='calendar_start_limit_indicator'><div class='ImgArrowMoreUp'></div></div>\");\ne.append(\"<div id='\"+this._endLimitIndicatorDivId+\"' class='calendar_end_limit_indicator'><div class='ImgArrowMoreDown'></div></div>\");\ne.append(\"</div>\");\ne.append(\"<div id='\",this._toggleBtnContainerId,\"' name='_toggleBtnContainerId' style='position:absolute;bottom:0px;'></div>\");\ne.append(\"<div id='\",this._tabsContainerDivId,\"' name='_tabsContainerDivId' style='position:absolute;height:45px;bottom:0px;overflow-y:hidden;'>\");\ne.append(\"<div id='\",this._allDayHeadingDivId,\"' name='_allDayHeadingDivId' style='\",b,\"'></div>\");\ne.append(\"</div>\");\nthis.getHtmlElement().innerHTML=e.toString();\nh=AjxCallback.simpleClosure(ZmCalColView.__onScroll,ZmCalColView,this);\ndocument.getElementById(this._bodyDivId).onscroll=h;\ndocument.getElementById(this._allDayApptScrollDivId).onscroll=h;\ndocument.getElementById(this._tabsContainerDivId).onscroll=h;\nif(AjxEnv.isModernIE){h=AjxCallback.simpleClosure(ZmCalDayView.__onMouseWheel,this,this._bodyDivId);\ndocument.getElementById(this._bodyDivId).onmousewheel=h;\nh=AjxCallback.simpleClosure(ZmCalDayView.__onMouseWheel,this,this._allDayApptScrollDivId);\ndocument.getElementById(this._allDayApptScrollDivId).onmousewheel=h\n}f=[this._apptBodyDivId,this._bodyHourDivId,this._allDayDivId,this._allDaySepDivId];\nd=[ZmCalBaseView.TYPE_APPTS_DAYGRID,ZmCalBaseView.TYPE_HOURS_COL,ZmCalBaseView.TYPE_ALL_DAY,ZmCalBaseView.TYPE_DAY_SEP];\nfor(c=0;\nc<f.length;\nc++){this.associateItemWithElement(null,document.getElementById(f[c]),d[c],f[c])\n}this._scrollToTime(8)\n};\nZmCalDayView.__onMouseWheel=function(a,b){b.preventDefault();\nvar c=document.getElementById(a);\nc.scrollTop-=b.wheelDelta/2\n};\nZmCalDayTabView.prototype._layout=function(e){this._updateDays();\nvar d=this._columns.length,i=this.getSize(),n=i.x,j=i.y,h=ZmCalColView._HOURS_DIV_WIDTH-1,m=h+this._daySepWidth,k,o=ZmCalColView._HOURS_DIV_WIDTH,c,g,q=document.getElementById(this._allDayHeadingDivId),a=Dwt.getSize(q).y,b=this._allDayApptsRowLayouts?(this._allDayApptsRowLayouts.length):1,r,l,f,p;\nif(n==0||j==0){return\n}j-=25;\nthis._needFirstLayout=false;\nm+=this._daySepWidth+ZmCalDayTabView._TAB_SEP_WIDTH;\nthis._bodyDivWidth=n-m-ZmCalDayTabView._TAB_SEP_WIDTH;\nthis._apptBodyDivHeight=ZmCalColView._DAY_HEIGHT+1;\nthis._apptBodyDivWidth=Math.max(this._bodyDivWidth,this._calcMinBodyWidth(this._bodyDivWidth,d));\nc=this._apptBodyDivWidth>this._bodyDivWidth;\nthis._horizontalScrollbar(c);\nif(c){this._apptBodyDivWidth-=18\n}g=c?20:0;\nif(!this._toggleBtn){this._setBounds(this._toggleBtnContainerId,0,Dwt.DEFAULT,h+ZmCalDayTabView._UNION_DIV_WIDTH+this._daySepWidth,Dwt.DEFAULT);\nthis._toggleBtn=new DwtButton({parent:this,parentElement:this._toggleBtnContainerId,className:\"ZButton ZPicker ZCalToggleBtn\"});\nthis._toggleBtn.setText(ZmMsg.calTabsMerge);\nthis._toggleBtn.addListener(DwtEvent.ONCLICK,new AjxListener(this,this._toggleView))\n}Dwt.setBounds(q,0,2,this._apptBodyDivWidth,Dwt.DEFAULT);\nif(this._allDayApptsList&&this._allDayApptsList.length>0){b++\n}this._allDayFullDivHeight=(ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalDayTabView._ALL_DAY_APPT_HEIGHT_PAD)*b+ZmCalDayTabView._ALL_DAY_APPT_HEIGHT_PAD;\nr=(this._allDayFullDivHeight/j)*100;\nthis._allDayDivHeight=this._allDayFullDivHeight;\nif(r>50){l=Math.floor((0.5*j-ZmCalDayTabView._ALL_DAY_APPT_HEIGHT_PAD)/(ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalDayTabView._ALL_DAY_APPT_HEIGHT_PAD));\nthis._allDayDivHeight=(ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalDayTabView._ALL_DAY_APPT_HEIGHT_PAD)*l+ZmCalDayTabView._ALL_DAY_APPT_HEIGHT_PAD\n}this._setBounds(this._allDayApptScrollDivId,m,a+ZmCalDayTabView._TAB_BORDER_MARGIN,this._bodyDivWidth,this._allDayDivHeight+ZmCalDayTabView._TAB_BORDER_MARGIN);\nthis._setBounds(this._allDayDivId,0,0,this._apptBodyDivWidth+g,this._allDayFullDivHeight+ZmCalDayTabView._TAB_BORDER_MARGIN);\nthis._setBounds(this._tabsContainerDivId,m,Dwt.DEFAULT,this._bodyDivWidth,g!==0?45:25);\nthis._allDayVerticalScrollbar(this._allDayDivHeight!=this._allDayFullDivHeight);\nthis._setBounds(this._yearAllDayDivId,0,ZmCalDayTabView._TAB_BORDER_MARGIN,h+ZmCalDayTabView._UNION_DIV_WIDTH+this._daySepWidth-1,this._allDayDivHeight);\nf=this._allDayDivHeight;\nthis._setBounds(this._allDayScrollDivId,m,0,this._bodyDivWidth,f);\nthis._setBounds(this._allDaySepDivId,0,(this._hideAllDayAppt?ZmCalColView._DAY_HEADING_HEIGHT:f)+2,n,ZmCalColView._ALL_DAY_SEP_HEIGHT);\nk=(this._hideAllDayAppt?ZmCalColView._DAY_HEADING_HEIGHT:f)+ZmCalColView._ALL_DAY_SEP_HEIGHT+(AjxEnv.isIE?0:2);\nthis._bodyDivHeight=j-k-g;\nthis._setBounds(this._hoursScrollDivId,0,k,h,this._bodyDivHeight);\nthis._setBounds(this._leftApptSepDivId,h,k-ZmCalDayTabView._TAB_BORDER_WIDTH,this._daySepWidth,ZmCalColView._DAY_HEIGHT);\nthis._setBounds(this._bodyDivId,m,k,this._bodyDivWidth,this._bodyDivHeight);\nthis._setBounds(this._apptBodyDivId,0,-1,this._apptBodyDivWidth,this._apptBodyDivHeight);\np=o+ZmCalDayTabView._UNION_DIV_WIDTH;\nthis._setBounds(this._unionHeadingSepDivId,p,ZmCalDayTabView._TAB_BORDER_MARGIN,this._daySepWidth-1,f+1);\nthis._setBounds(this._unionGridScrollDivId,o,k,ZmCalDayTabView._UNION_DIV_WIDTH,this._bodyDivHeight);\nthis._setBounds(this._unionGridDivId,0,-1,ZmCalDayTabView._UNION_DIV_WIDTH,this._apptBodyDivHeight+ZmCalColView._HOUR_HEIGHT);\nthis._setBounds(this._unionGridSepDivId,p,k-ZmCalDayTabView._TAB_BORDER_MARGIN,this._daySepWidth,this._apptBodyDivHeight);\nthis._bodyX=m;\nthis.layoutWorkingHours(this.workingHours);\nthis._layoutAllDayAppts();\nthis._apptBodyDivOffset=Dwt.toWindow(document.getElementById(this._apptBodyDivId),0,0,null,true);\nthis._apptAllDayDivOffset=Dwt.toWindow(document.getElementById(this._allDayDivId),0,0,null,true);\nthis._layoutAppts();\nthis._layoutUnionData()\n};\nZmCalDayTabView.prototype.layoutWorkingHours=function(f){if(!f){f=ZmCalBaseView.parseWorkingHours(ZmCalBaseView.getWorkingHours());\nthis.workingHours=f\n}var e=this._columns.length;\nvar k=this._calcColWidth(this._apptBodyDivWidth-Dwt.SCROLLBAR_WIDTH,e);\nvar g=document.getElementById(this._allDayHeadingDivId);\nvar j=Dwt.getSize(g).y;\nvar d=0;\nvar n=AjxEnv.isIE?ZmCalDayTabView._TAB_BORDER_WIDTH:ZmCalColView._ALL_DAY_SEP_HEIGHT-ZmCalDayTabView._TAB_BORDER_WIDTH;\nfor(var h=0;\nh<e;\nh++){var c=this._columns[h];\nvar m=this._days[c.dayIndex];\nthis._setBounds(c.titleId,d,Dwt.DEFAULT,k-ZmCalDayTabView._TAB_BORDER_MARGIN,ZmCalColView._DAY_HEADING_HEIGHT);\nc.apptX=d+2;\nc.apptWidth=k-3*this._daySepWidth-ZmCalDayTabView._TAB_SEP_WIDTH;\nc.allDayX=c.apptX;\nc.allDayWidth=k-ZmCalDayTabView._TAB_SEP_WIDTH;\nvar a=m.date.getDay(),b=this.workingHours[a],l=this.getPostionForWorkingHourDiv(a,0);\nif(this._scheduleMode&&m.isWorkingDay){this.layoutWorkingHoursDiv(c.workingHrsFirstDivId,l,d,k-ZmCalDayTabView._TAB_BORDER_MARGIN);\nif(b.startTime.length>=2&&b.endTime.length>=2){l=this.getPostionForWorkingHourDiv(a,1);\nthis.layoutWorkingHoursDiv(c.workingHrsSecondDivId,l,d,k-ZmCalDayTabView._TAB_BORDER_MARGIN)\n}}this._setBounds(c.borderTopDivId,d+this._bodyX,n,k-ZmCalDayTabView._TAB_BORDER_MARGIN,Dwt.CLEAR);\nthis._setBounds(c.borderBottomDivId,d,0,k-ZmCalDayTabView._TAB_BORDER_MARGIN,Dwt.CLEAR);\nthis._setBounds(c.borderLeftDivId,d,0,ZmCalDayTabView._TAB_BORDER_WIDTH,this._apptBodyDivHeight);\nthis._setBounds(c.borderRightDivId,d+k-ZmCalDayTabView._TAB_BORDER_WIDTH-ZmCalDayTabView._TAB_BORDER_MARGIN,0,ZmCalDayTabView._TAB_BORDER_WIDTH,this._apptBodyDivHeight);\nthis._setBounds(c.borderLeftAllDayDivId,d,0,ZmCalDayTabView._TAB_BORDER_WIDTH,this._allDayDivHeight+ZmCalDayTabView._TAB_BORDER_WIDTH+1);\nthis._setBounds(c.borderTopAllDayDivId,d,0,k-ZmCalDayTabView._TAB_BORDER_MARGIN,Dwt.CLEAR);\nthis._setBounds(c.borderRightAllDayDivId,d+k-ZmCalDayTabView._TAB_BORDER_WIDTH-ZmCalDayTabView._TAB_BORDER_MARGIN,0,ZmCalDayTabView._TAB_BORDER_WIDTH,this._allDayDivHeight+ZmCalDayTabView._TAB_BORDER_WIDTH+1);\nd+=k;\nif(h==e-1){this._setBounds(c.daySepDivId,d-ZmCalDayTabView._TAB_BORDER_MARGIN,0,ZmCalDayTabView._TAB_SEP_WIDTH+6,this._apptBodyDivHeight)\n}else{this._setBounds(c.daySepDivId,d-ZmCalDayTabView._TAB_BORDER_MARGIN,0,ZmCalDayTabView._TAB_SEP_WIDTH-1,this._apptBodyDivHeight)\n}d+=this._daySepWidth\n}};\nZmCalDayTabView.prototype._toggleView=function(){if(!this._mergedView){this._mergedView=true;\nthis._toggleBtn.setText(ZmMsg.calTabsSplit)\n}else{this._mergedView=false;\nthis._toggleBtn.setText(ZmMsg.calTabsMerge)\n}this.set(this._list,null,true)\n};\nZmCalDayTabView.prototype._resetCalendarData=function(){var f=document.getElementById(this._allDayHeadingDivId),g=document.getElementById(this._apptBodyDivId),d=document.getElementById(this._allDaySepDivId),n=document.getElementById(this._allDayDivId),b,p,m,l,c,j,o,a,h,e;\nif(this._numCalendars>0){for(h=0;\nh<this._numCalendars;\nh++){c=this._columns[h];\nthis._removeNode(c.titleId);\nthis._removeNode(c.daySepDivId);\nthis._removeNode(c.borderBottomDivId);\nthis._removeNode(c.borderLeftDivId);\nthis._removeNode(c.borderRightDivId);\nthis._removeNode(c.borderTopDivId);\nthis._removeNode(c.borderLeftAllDayDivId);\nthis._removeNode(c.borderTopAllDayDivId);\nthis._removeNode(c.borderRightAllDayDivId);\nthis._removeNode(c.workingHrsFirstChildDivId);\nthis._removeNode(c.workingHrsSecondChildDivId);\nthis._removeNode(c.workingHrsFirstDivId);\nthis._removeNode(c.workingHrsSecondDivId)\n}}this._calendars=this._controller.getCheckedCalendars();\nthis._calendars.sort(ZmFolder.sortCompareNonMail);\nthis._folderIdToColIndex={};\nthis._columns=[];\nthis._numCalendars=this._mergedView?1:this._calendars.length;\nthis._layoutMap=[];\nthis._unionBusyData=[];\nthis._unionBusyDataToolTip=[];\nfor(h=0;\nh<this._numCalendars;\nh++){b=this._calendars[h];\no=b.id?b.id:\"\";\nc=this._columns[h]={index:h,dayIndex:0,cal:b,titleId:Dwt.getNextId(),headingDaySepDivId:Dwt.getNextId(),daySepDivId:Dwt.getNextId(),workingHrsFirstDivId:Dwt.getNextId(),workingHrsSecondDivId:Dwt.getNextId(),apptX:0,apptWidth:0,allDayX:0,allDayWidth:0,borderLeftDivId:Dwt.getNextId(),borderRightDivId:Dwt.getNextId(),borderTopDivId:Dwt.getNextId(),borderBottomDivId:Dwt.getNextId(),borderLeftAllDayDivId:Dwt.getNextId(),borderTopAllDayDivId:Dwt.getNextId(),borderRightAllDayDivId:Dwt.getNextId(),workingHrsFirstChildDivId:Dwt.getNextId(),workingHrsSecondChildDivId:Dwt.getNextId()};\np=this._mergedView?\"\":b.rgb;\nthis._folderIdToColIndex[b.id]=c;\nif(b.isRemote()&&b.rid&&b.zid){this._folderIdToColIndex[b.zid+\":\"+b.rid]=c\n}this._createDivForColumn(c.workingHrsFirstDivId,g,\"\",\"#FFFFFF\");\na=this._createDivForColumn(c.workingHrsFirstChildDivId,c.workingHrsFirstDivId,\"ImgCalendarDayGrid\");\na.setAttribute(ZmCalDayTabView.ATTR_CAL_ID,o);\nthis._createDivForColumn(c.workingHrsSecondDivId,g,\"\",\"#FFFFFF\");\na=this._createDivForColumn(c.workingHrsSecondChildDivId,c.workingHrsSecondDivId,\"ImgCalendarDayGrid\");\na.setAttribute(ZmCalDayTabView.ATTR_CAL_ID,o);\nthis._createDivForColumn(c.borderBottomDivId,f,\"ZmDayTabSeparator\",p,p);\na=this._createDivForColumn(c.titleId,f,this._mergedView?\"\":\"ZmCalDayTab ZmCalDayMerged\",p,p);\na.style.top=ZmCalDayTabView._TAB_BORDER_WIDTH+\"px\";\nif(!this._mergedView){a.style.top=ZmCalDayTabView._TAB_BORDER_WIDTH+\"px\";\na.style.color=AjxUtil.getForegroundColor(p);\na.innerHTML=b.getName()\n}this._createDivForColumn(c.borderLeftAllDayDivId,n,\"ZmDayTabSeparator\",p,p);\nthis._createDivForColumn(c.borderTopAllDayDivId,n,\"ZmDayTabSeparator\",p,p);\nthis._createDivForColumn(c.borderRightAllDayDivId,n,\"ZmDayTabSeparator\",p,p);\nthis._createDivForColumn(c.daySepDivId,g,\"ZmDayTabMarginDiv\");\nthis._createDivForColumn(c.borderLeftDivId,g,\"ZmDayTabSeparator\",p,p);\nthis._createDivForColumn(c.borderRightDivId,g,\"ZmDayTabSeparator\",p,p);\nthis._createDivForColumn(c.borderTopDivId,d,\"ZmDayTabSeparator\",p,p)\n}};\nZmCalDayTabView.prototype._createDivForColumn=function(b,f,g,h,c,e,d,i){var a=document.createElement(d?\"span\":\"div\");\na.className=g?g:\"\";\na.id=b;\na.style.position=e?e:\"absolute\";\nif(h){a.style.backgroundColor=h\n}if(c){a.style.borderColor=c\n}if(f){f=typeof f===\"string\"?document.getElementById(f):f;\nf.appendChild(a)\n}return a\n};\nZmCalDayTabView.prototype._layoutAllDayAppts=function(){var l=this._allDayApptsRowLayouts;\nif(!l){return\n}var d=ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD+2;\nfor(var f=0;\nf<l.length;\nf++){var k=l[f];\nvar g=this._mergedView?1:this._numCalendars;\nfor(var e=0;\ne<g;\ne++){var h=k[e];\nif(h.data){var a=h.data.appt;\nvar c=document.getElementById(this._getItemId(a));\nif(c){if(!this._mergedView){var b=this._getColForFolderId(a.folderId);\nthis._positionAppt(c,b.allDayX+0,d);\nthis._sizeAppt(c,(b.allDayWidth+this._daySepWidth)-this._daySepWidth-1-ZmCalDayTabView._TAB_SEP_WIDTH,ZmCalColView._ALL_DAY_APPT_HEIGHT)\n}else{this._positionAppt(c,this._columns[e].allDayX+0,d);\nthis._sizeAppt(c,((this._columns[e].allDayWidth+this._daySepWidth)*h.data.numDays)-this._daySepWidth-1-ZmCalDayTabView._TAB_SEP_WIDTH,ZmCalColView._ALL_DAY_APPT_HEIGHT)\n}}}}d+=ZmCalColView._ALL_DAY_APPT_HEIGHT+ZmCalColView._ALL_DAY_APPT_HEIGHT_PAD\n}};\nZmCalDayTabView.prototype._getBoundsForAppt=function(a){var c=a.startDate;\nvar d=new Date(c);\nd.setHours(23,59,59,999);\nvar b=Math.min(a.getEndTime(),d.getTime());\nif(!this._mergedView){return this._getBoundsForCalendar(c,b-c.getTime(),a.folderId)\n}else{return this._getBoundsForDate(c,b-c.getTime())\n}};\nZmCalDayTabView.prototype._getBoundsForDate=function(i,g,c){var f=g/1000/60;\nf=Math.max(f,ZmCalColView._MINIMUM_APPT_HEIGHT);\nvar e=i.getHours();\nvar a=i.getMinutes();\nif(c==null){var b=this._getDayForDate(i);\nc=b?this._columns[b.index]:null\n}if(c==null){return null\n}return new DwtRectangle(c.apptX,((e+a/60)*ZmCalColView._HOUR_HEIGHT),c.apptWidth,(ZmCalColView._HOUR_HEIGHT/60)*f)\n};\nZmCalDayTabView.prototype._resetList=function(){var e=this.getList();\nvar b=e?e.size():0;\nif(b==0){return\n}for(var a=0;\na<b;\na++){var c=e.get(a);\nvar f=this._getItemId(c);\nvar d=document.getElementById(f);\nif(d){d.parentNode.removeChild(d);\nthis._data[f]=null\n}}this.removeAll()\n};\nZmCalDayTabView.prototype._computeAllDayApptLayout=function(){var d=this._allDayApptsList;\nd.sort(ZmCalBaseItem.compareByTimeAndDuration);\nfor(var b=0;\nb<d.length;\nb++){var c=d[b];\nvar e=this._allDayAppts[c.getUniqueId()];\nif(e){var a=this._mergedView?this._columns[0]:this._getColForFolderId(e.appt.folderId);\nif(a){this._findAllDaySlot(a.index,e)\n}}}};\nZmCalDayTabView.prototype._layoutUnionDataDiv=function(c,h,e,d,b){var g=d instanceof Object;\nvar a=this._unionBusyDivIds[e];\nvar k=null;\nif(a==null){if(!g){return\n}a=this._unionBusyDivIds[e]=Dwt.getNextId();\nvar k=document.createElement(\"div\");\nk.style.position=\"absolute\";\nk.className=\"calendar_sched_union_div\";\nthis.associateItemWithElement(null,k,ZmCalBaseView.TYPE_SCHED_FREEBUSY,a,{index:e});\nDwt.setOpacity(k,40);\nif(e==48){h.appendChild(k)\n}else{c.appendChild(k);\nDwt.setBounds(k,1,ZmCalColView._HALF_HOUR_HEIGHT*e+1,ZmCalDayTabView._UNION_DIV_WIDTH-2,ZmCalColView._HALF_HOUR_HEIGHT-2)\n}}else{k=document.getElementById(a)\n}var f=0;\nfor(var j in d){f++\n}Dwt.setOpacity(k,20+(60*(f/b)));\nDwt.setVisibility(k,g)\n};\nZmCalDayTabView.prototype._computeApptLayout=function(){var s=this._layouts=new Array();\nvar y=[];\nvar d=[];\nvar t=this.getList();\nif(!t){return\n}var g=t.size();\nif(g==0){return\n}var b=null;\nvar a=null;\nfor(var r=0;\nr<g;\nr++){var h=t.get(r);\nif(h.isAllDayEvent()){continue\n}var z={appt:h,col:0,maxcol:-1};\nb=null;\na=null;\nvar m=h.startDate;\nvar w=h.endDate;\nvar o=m.getDate();\nvar x=w.getDate();\nvar e=(o!=x);\nvar f=[];\nif(e){f.push(s)\n}else{f.push(d);\nif(y[o]!=null){f.push(y[o])\n}}for(var p=0;\np<f.length;\np++){for(var q=0;\nq<f[p].length;\nq++){var u=f[p][q];\nif(h.isOverlapping(u.appt,!this._mergedView)){if(b==null){b=[];\na=[]\n}b.push(u);\na[u.col]=true;\nwhile(a[z.col]){z.col++\n}}}}if(b!=null){for(var v in b){var n=b[v];\nif(z.col<n.col){if(!z.right){z.right=[n]\n}else{z.right.push(n)\n}}else{if(!n.right){n.right=[z]\n}else{n.right.push(z)\n}}}}s.push(z);\nif(o==x){if(!y[o]){y[o]=[]\n}y[o].push(z)\n}else{d.push(z)\n}}for(var r=0;\nr<s.length;\nr++){this._computeMaxCols(s[r],-1);\nthis._layoutMap[this._getItemId(s[r].appt)]=s[r]\n}delete d;\ndelete y;\ndelete f\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalWorkWeekView\")){ZmCalWorkWeekView=function(e,d,b,a){var f=ZmCalBaseView.parseWorkingHours(ZmCalBaseView.getWorkingHours()),g=0,c;\nfor(c=0;\nc<f.length;\nc++){if(f[c].isWorkingDay){g++\n}}ZmCalColView.call(this,e,d,b,a,ZmId.VIEW_CAL_WORK_WEEK,g,false)\n};\nZmCalWorkWeekView.prototype=new ZmCalColView;\nZmCalWorkWeekView.prototype.constructor=ZmCalWorkWeekView;\nZmCalWorkWeekView.prototype.toString=function(){return\"ZmCalWorkWeekView\"\n};\nZmCalWorkWeekView.prototype.getAvailableStartTime=function(d){if(this._getDayForDate(d.startDate)){return d.getStartTime()\n}if(d.isMultiDay()){var c=Math.max(d.getStartTime(),this._timeRangeStart);\nvar b=Math.min(d.getEndTime(),this._timeRangeEnd);\nwhile(c<b){var a=new Date(c);\nif(this._getDayForDate(a)){return c\n}AjxDateUtil.rollToNextDay(a);\nc=a.getTime()\n}}return null\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalWeekView\")){ZmCalWeekView=function(d,c,b,a){ZmCalColView.call(this,d,c,b,a,ZmId.VIEW_CAL_WEEK,7,false)\n};\nZmCalWeekView.prototype=new ZmCalColView;\nZmCalWeekView.prototype.constructor=ZmCalWeekView;\nZmCalWeekView.prototype.toString=function(){return\"ZmCalWeekView\"\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalMonthView\")){ZmCalMonthView=function(e,d,b,a){ZmCalBaseView.call(this,e,\"calendar_view\",d,b,ZmId.VIEW_CAL_MONTH,false);\nvar c=this.getHtmlElement();\nthis._setEventHdlrs([DwtEvent.ONCLICK],true,c);\nthis.setScrollStyle(DwtControl.CLIP);\nthis._needFirstLayout=true;\nthis.numDays=42\n};\nZmCalMonthView.prototype=new ZmCalBaseView;\nZmCalMonthView.prototype.constructor=ZmCalMonthView;\nZmCalMonthView._DaySpacer=1;\nZmCalMonthView.FIRST_WORKWEEK_DAY=1;\nZmCalMonthView.NUM_DAYS_IN_WORKWEEK=5;\nZmCalMonthView.EXPANDED_HEIGHT_PERCENT=70;\nZmCalMonthView.EXPANDED_WIDTH_PERCENT=50;\nZmCalMonthView.ANIMATE_INTERVAL=1000/30;\nZmCalMonthView.ANIMATE_DURATION=250;\nZmCalMonthView.OUT_OF_BOUNDS_SNAP=-1000;\nZmCalMonthView.ALL_DAY_DIV_BODY=\"_body\";\nZmCalMonthView.prototype.toString=function(){return\"ZmCalMonthView\"\n};\nZmCalMonthView.prototype.getRollField=function(){return AjxDateUtil.MONTH\n};\nZmCalMonthView.prototype._dateUpdate=function(a){this._clearSelectedDay();\nthis._updateSelectedDay()\n};\nZmCalMonthView.prototype._updateTitle=function(){};\nZmCalMonthView.prototype._clearSelectedDay=function(){if(this._selectedData!=null){var a=document.getElementById(this._selectedData.tdId);\na.className=\"calendar_month_cells_td\";\nthis._selectedData=null\n}};\nZmCalMonthView.prototype._updateSelectedDay=function(){var a=this._dateToDayIndex[this._dayKey(this._date)];\nif(a){var b=document.getElementById(a.tdId);\nb.className=\"calendar_month_cells_td-selected\";\nthis._selectedData=a\n}};\nZmCalMonthView.prototype._apptSelected=function(){this._clearSelectedDay()\n};\nZmCalMonthView.prototype._getDayForAppt=function(a){return this._getDayForDate(a.startDate)\n};\nZmCalMonthView.prototype._getDayForDate=function(a){return this._dateToDayIndex[this._dayKey(a)]\n};\nZmCalMonthView.prototype._getDivForAppt=function(b){var a=this._getDayForAppt(b);\nreturn a?document.getElementById(a.dayId):null\n};\nZmCalMonthView.prototype._getStartDate=function(){return new Date(this.getDate())\n};\nZmCalMonthView.prototype._dayTitle=function(a){if(this._shortMonInDay!=a.getMonth()){this._shortMonInDay=a.getMonth();\nvar b=DwtCalendar.getDayFormatter();\nreturn b.format(a)\n}return a.getDate()\n};\nZmCalMonthView.prototype._getApptUniqueId=function(a){return(a._orig)?a._orig.getUniqueId():a.getUniqueId()\n};\nZmCalMonthView.prototype._reserveRow=function(c,h,d){var b=c.allDayAppts;\nvar f=-1;\nif(h.rows[c.week]===undefined){f=this._allocateRow(c,h)\n}else{f=h.rows[c.week]\n}var a=b[f];\nb[f]=d;\nif(a){var g=this._getApptUniqueId(a);\nvar e=this._apptSets[g];\nf=this._allocateRow(c,e);\nb[f]=a;\ne.rows[c.week]=f\n}};\nZmCalMonthView.prototype._allocateRow=function(b,d){var a=b.allDayAppts;\nd.rows[b.week]=a.length;\nfor(var c=0;\nc<a.length;\nc++){if(a[c]==null){d.rows[b.week]=c;\nbreak\n}}return d.rows[b.week]\n};\nZmCalMonthView.prototype.addAppt=function(b){var a=this._getDayForAppt(b);\nif(b._orig.isAllDayEvent()||b._orig.isMultiDay()){var d=this._getApptUniqueId(b);\nvar c=this._apptSets[d];\nif(c==null){c=this._createApptSet(b,d)\n}c.appts.push(b)\n}if(a){if(b._orig.isAllDayEvent(b)){if(!a.allDayAppts){a.allDayAppts=[]\n}else{}this._reserveRow(a,c,b)\n}else{if(!a.appts){a.appts=[]\n}a.appts.push(b)\n}}};\nZmCalMonthView.prototype._createApptSet=function(d,g,b){var f;\nvar e=null;\nif(b){f=b.dow\n}else{var c=this._createDayIndexFromDate(d.startDate);\nvar a=this._days[0];\nf=(a.dow+c+7)%7\n}e={appts:[],rows:{},dow:f,allDay:d.isAllDayEvent()};\nthis._apptSets[g]=e;\nreturn e\n};\nZmCalMonthView.prototype._postSet=function(){var a;\nif(this._expandedDayInfo){var e=this._expandedDayInfo.week;\nvar b=this._expandedDayInfo.dow;\nvar a=this._days[e*7+b];\nvar c=new Date(this._date.getTime());\nc.setHours(0,0,0);\nif(c.getTime()==a.date.getTime()){this.setDayView(a)\n}else{this.createApptItems()\n}}else{this.createApptItems()\n}};\nZmCalMonthView.prototype.createApptItems=function(){var o=document.getElementById(this._daysId);\nvar p;\nthis._apptAllDayDiv={};\nfor(var n in this._apptSets){var q=this._apptSets[n];\nif(!q.allDay){continue\n}var t=-1;\nvar m=true;\nvar r=false;\nvar s=this._createDayIndexFromDate(q.appts[0]._orig.startDate);\nfor(var f=0;\nf<q.appts.length;\nf++){var b=q.appts[f];\np=this._getDayForAppt(b);\nm=(f==0);\nr=(f==(q.appts.length-1));\nif(p){if(((s+f)==(this.numDays-1))){r=true\n}if(p.week!=t){m=true;\nt=p.week\n}}var d=this._createAllDayApptDiv(o,b,f,m,r);\nif(!p){Dwt.setVisible(d,false)\n}m=false;\nr=false;\nif(p){var e=DwtCalendar.getDateFormatter().format(p.date);\nd.setAttribute(\"aria-label\",e+\" \"+b.getName())\n}}}for(var l=0;\nl<6;\nl++){for(var h=0;\nh<7;\nh++){var a=l*7+h;\np=this._days[a];\nif(p.allDayAppts){for(var g=0;\ng<p.allDayAppts.length;\ng++){var b=p.allDayAppts[g];\nvar c=this._attachAllDayFillerHtml(b,a);\nthis._fillers.push(c)\n}}if(p.appts){for(var g=0;\ng<p.appts.length;\ng++){var c=this._createItemHtml(p.appts[g],null)\n}}}}if(!this._needFirstLayout){this._layout()\n}if(this._dayView){this._dayView.setVisible(false);\nthis.clearExpandedDay()\n}};\nZmCalMonthView.prototype._preSet=function(){if(this._fillers.length>0){for(var b=0;\nb<this._fillers.length;\nb++){var c=this._fillers[b];\nthis._fillers[b]=null;\nc.parentNode.removeChild(c)\n}this._fillers=[]\n}this._apptSets=new Object();\nfor(var b=0;\nb<6;\nb++){for(var a=0;\na<7;\na++){day=this._days[b*7+a];\nif(day.allDayAppts){delete day.allDayAppts\n}if(day.appts){delete day.appts\n}}}};\nZmCalMonthView.prototype._createAllDayApptDiv=function(g,e,d,f,c){var b=this._createAllDayItemHtml(e,f,c);\ng.appendChild(b);\nvar a=e.invId+\"_\"+d.toString();\nif(!this._apptAllDayDiv[a]){this._apptAllDayDiv[a]=b.id\n}return b\n};\nZmCalMonthView.prototype._createAllDayItemHtml=function(c,d,b){var g=document.createElement(\"div\");\ng.style.position=\"absolute\";\nDwt.setSize(g,10,10);\ng.className=this._getStyle();\ng.style.overflow=\"hidden\";\ng.style.paddingBottom=\"4px\";\ng.head=d;\ng.tail=b;\nthis.associateItemWithElement(c,g,ZmCalBaseView.TYPE_APPT);\nvar f=this._getItemId(c);\ng.innerHTML=ZmApptViewHelper._allDayItemHtml(c,f,this._controller,d,b);\nvar e=g.firstChild;\nif(!d){e.style.cssText+=\"border-left: 0px none black !important;\"\n}if(!b){e.style.cssText+=\"border-right: 0px none black !important;\"\n}var a=Dwt.getDescendant(e,f+\"_tableBody\");\nZmCalBaseView._setApptOpacity(c,a);\nreturn g\n};\nZmCalMonthView.prototype._attachAllDayFillerHtml=function(c,b){var a=this._days[b];\nvar d=document.getElementById(a.dayId);\nreturn this._createAllDayFillerHtml(c,b,d)\n};\nZmCalMonthView.prototype._createAllDayFillerHtml=function(f,d,g){var c=null;\nvar b=false;\nif(!g){if(!this._fillerGenTableBody){var e=document.createElement(\"table\");\nthis._fillerGenTableBody=document.createElement(\"tbody\");\ne.appendChild(this._fillerGenTableBody)\n}c=this._fillerGenTableBody;\nb=true\n}else{c=g\n}var a=c.insertRow(-1);\nif(f){a.id=f.invId+\":\"+d\n}a.className=\"allday\";\nthis._createAllDayFillerContent(a,true);\nif(b){a.parentNode.removeChild(a)\n}return a\n};\nZmCalMonthView.prototype._createAllDayFillerContent=function(c,b){var a;\nif(b){a=c.insertCell(-1)\n}else{a=c.firstChild\n}a.innerHTML=\"<table class=allday><tr><td><div class=allday_item_filler></div></td></tr></table>\";\na.className=\"calendar_month_day_item\"\n};\nZmCalMonthView.prototype._createItemHtml=function(b){var a=this._getDivForAppt(b).insertRow(-1);\na.className=this._getStyle(ZmCalBaseView.TYPE_APPT);\na.apptStartTimeOffset=this._getTimeOffset(b.getStartTime());\nthis.associateItemWithElement(b,a,ZmCalBaseView.TYPE_APPT);\nthis._createItemHtmlContents(b,a);\nreturn a\n};\nZmCalMonthView.prototype._createItemHtmlContents=function(a,h){var c=a.ptst==ZmCalBaseItem.PSTATUS_NEEDS_ACTION;\nvar e=appCtxt.getById(a.folderId);\nvar k=c?ZmCalBaseItem.PSTATUS_NEEDS_ACTION:a.fba;\nvar i=a.getVisibleTags();\nvar l=a.getTagImageFromNames(i);\nvar f=ZmApptViewHelper.getApptColor(c,e,i,\"header\");\nvar m=ZmCalBaseView._toColorsCss(f.appt);\nvar b=ZmApptViewHelper.getApptColor(c,e,i,\"body\");\nvar g=ZmCalBaseView._toColorsCss(b.appt);\nvar d={id:this._getItemId(a),appt:a,duration:a.getShortStartHour(),headerStyle:m,bodyStyle:g,multiday:a._fanoutFirst!=null,first:a._fanoutFirst,last:a._fanoutLast,showAsColor:ZmApptViewHelper._getShowAsColorFromId(k),tagIcon:l};\nZmApptViewHelper.setupCalendarColor(true,b,i,d,\"headerStyle\",null,0,0);\nvar j=h.insertCell(-1);\nj.className=\"calendar_month_day_item\";\nj.innerHTML=AjxTemplate.expand(\"calendar.Calendar#month_appt\",d);\nj.firstChild.className=\"\"\n};\nZmCalMonthView.prototype._createDay=function(b,f,a,h){var g=Dwt.getNextId();\nvar c=Dwt.getNextId();\nvar e=Dwt.getNextId();\nb.append(\"<td class='calendar_month_cells_td' id='\",g,\"'>\");\nb.append(\"<div style='width:100%;height:100%;'>\");\nb.append(\"<table class='calendar_month_day_table'>\");\nb.append(\"<tr><td colspan=2 id='\",e,\"'></td></tr></table>\");\nb.append(\"<table class='calendar_month_day_table'><tbody id='\",c,\"'>\");\nb.append(\"</tbody></table>\");\nb.append(\"</div>\");\nb.append(\"</td>\");\nvar d={dayId:c,titleId:e,tdId:g,week:a,dow:h,view:this};\nthis._days[f]=d\n};\nZmCalMonthView.prototype._createHtml=function(){this._showWeekNumber=appCtxt.get(ZmSetting.CAL_SHOW_CALENDAR_WEEK);\nthis._days=new Object();\nthis._rowIds=new Object();\nthis._apptSets=new Object();\nthis._dayInfo=new Object();\nthis._fillers=[];\nthis._headerId=Dwt.getNextId();\nthis._titleId=Dwt.getNextId();\nthis._daysId=Dwt.getNextId();\nthis._bodyId=Dwt.getNextId();\nthis._weekNumBodyId=Dwt.getNextId();\nthis._monthViewTable=Dwt.getNextId();\nthis._headerColId=[];\nthis._dayNameId=[];\nthis._bodyColId=[];\nthis._weekNumberIds={};\nvar f=new AjxBuffer();\nf.append(\"<table class=calendar_view_table cellpadding=0 cellspacing=0 id='\",this._monthViewTable,\"'>\");\nf.append(\"<tr>\");\nf.append(\"<td>\");\nf.append(\"<div id='\",this._headerId,\"' style='position:relative;'>\");\nf.append(\"<table id=calendar_month_header_table class=calendar_month_header_table>\");\nf.append(\"<colgroup>\");\nif(this._showWeekNumber){f.append(\"<col id='\",Dwt.getNextId(),\"'/>\")\n}for(var e=0;\ne<7;\ne++){this._headerColId[e]=Dwt.getNextId();\nf.append(\"<col id='\",this._headerColId[e],\"'/>\")\n}f.append(\"</colgroup>\");\nf.append(\"<tr>\");\nf.append(\"<td colspan=7 class=calendar_month_header_month id='\",this._titleId,\"'></td>\");\nf.append(\"</tr>\");\nf.append(\"<tr>\");\nif(this._showWeekNumber){f.append(\"<td width=10 valign='bottom' class='calendar_month_header_cells_text'>\");\nf.append(AjxMsg.calendarWeekTitle);\nf.append(\"</td>\")\n}for(var c=0;\nc<7;\nc++){this._dayNameId[c]=Dwt.getNextId();\nf.append(\"<td class=calendar_month_header_cells_text id='\",this._dayNameId[c],\"'></td>\")\n}f.append(\"</tr>\");\nf.append(\"</table>\");\nf.append(\"</div>\");\nf.append(\"</td></tr>\");\nf.append(\"<tr>\");\nf.append(\"<td class='calendar_month_body_container'>\");\nf.append(\"<div id='\",this._daysId,\"' class=calendar_month_body>\");\nf.append(\"<table id='\",this._bodyId,\"' class=calendar_month_table>\");\nf.append(\"<colgroup>\");\nif(this._showWeekNumber){f.append(\"<col id='\"+this._weekNumBodyId+\"'></col>\")\n}for(var e=0;\ne<7;\ne++){this._bodyColId[e]=Dwt.getNextId();\nf.append(\"<col id='\",this._bodyColId[e],\"'/>\")\n}f.append(\"</colgroup>\");\nfor(var e=0;\ne<6;\ne++){var a=Dwt.getNextId();\nf.append(\"<tr id='\"+a+\"'>\");\nif(this._showWeekNumber){var b=Dwt.getNextId();\nf.append(\"<td id='\"+b+\"' class='calendar_month_weekno_td'></td>\");\nthis._weekNumberIds[e]=b\n}for(var d=0;\nd<7;\nd++){this._createDay(f,e*7+d,e,d)\n}f.append(\"</tr>\");\nthis._rowIds[e]=a\n}f.append(\"</table>\");\nf.append(\"</div>\");\nf.append(\"</td></tr>\");\nf.append(\"</table>\");\nthis.getHtmlElement().innerHTML=f.toString()\n};\nZmCalMonthView.prototype._updateWeekNumber=function(e){if(!this._showWeekNumber){return\n}var b=this._days[e*7+0];\nif(b&&b.date){var d=AjxTimezone.getServerId(AjxTimezone.DEFAULT);\nvar g=(d&&d.indexOf(\"Europe\")==0&&d!=\"Europe/London\");\nvar c=new Date(b.date.getTime());\nvar a=AjxDateUtil.getWeekNumber(c,this.firstDayOfWeek(),null,g);\nvar h=this._weekNumberIds[e];\nvar f=h?document.getElementById(h):null;\nif(f){f.innerHTML=a\n}}};\nZmCalMonthView.prototype._updateDays=function(){var n=new Date(this._date.getTime());\nthis._month=n.getMonth();\nn.setHours(0,0,0,0);\nn.setDate(1);\nvar s=n.getDay();\nvar g=this.firstDayOfWeek();\nif(s!=g){n.setDate(n.getDate()-((s+(7-g))%7))\n}this._dateToDayIndex=new Object();\nvar o=new Date();\no.setHours(0,0,0,0);\nfor(var k=0;\nk<6;\nk++){for(var h=0;\nh<7;\nh++){var l=this._calcDayIndex(k,h);\nvar p=this._days[l];\np.date=new Date(n.getTime());\nthis._dateToDayIndex[this._dayKey(p.date)]=p;\nvar a=p.date.getMonth()==this._month;\nvar e=document.getElementById(p.titleId);\nvar m=n.getTime()==o.getTime();\ne.innerHTML=this._dayTitle(n);\ne.className=(a?\"calendar_month_day_label\":\"calendar_month_day_label_off_month\")+(m?\"_today\":\"\");\np.dayClassName=e.className;\nvar b=p.tdId;\nvar r=document.getElementById(b);\nr.className=\"calendar_month_cells_td\";\nthis.associateItemWithElement(null,r,ZmCalBaseView.TYPE_MONTH_DAY,b,{loc:l});\nvar f=n.getDate();\nn.setDate(n.getDate()+1);\nif(f==n.getDate()){n.setHours(0,0,0,0);\nn.setTime(n.getTime()+AjxDateUtil.MSEC_PER_DAY)\n}}this._updateWeekNumber(k)\n}var q=DwtCalendar.getMonthFormatter();\nthis._title=q.format(this._date);\nvar c=document.getElementById(this._titleId);\nc.innerHTML=this._title\n};\nZmCalMonthView.prototype._calcDayIndex=function(b,a){return(b*7)+a\n};\nZmCalMonthView.prototype.getShortCalTitle=function(){var a=DwtCalendar.getShortMonthFormatter();\nreturn a.format(this._date)\n};\nZmCalMonthView.prototype._setAllDayDivSize=function(a,b){Dwt.setSize(a,b,16+4);\nvar c=document.getElementById(a.id+ZmCalMonthView.ALL_DAY_DIV_BODY);\nDwt.setSize(c,b,16)\n};\nZmCalMonthView.prototype._layoutAllDay=function(){var b=[];\nvar j=0;\nfor(var f=0;\nf<6;\nf++){b[f]=j;\nvar l=Dwt.getSize(document.getElementById(this._days[7*f].tdId));\nif(f==0){this.dayWidth=l.x\n}j+=l.y\n}var d=this.dayWidth;\nfor(var k in this._apptSets){var n=this._apptSets[k];\nif(!n.allDay){continue\n}for(var e=0;\ne<n.appts.length;\ne++){var a=n.appts[e];\nvar o=document.getElementById(this._getItemId(a));\nif(o){var c=this._calculateAllDayWidth(d,o.head,o.tail);\nthis._setAllDayDivSize(o,c);\nvar m=this._getDayForAppt(a);\nif(m){var p=(n.dow+e)%7;\nvar h=this._calculateAllDayX(p,o.head)+(this._showWeekNumber?15:0);\nvar g=b[m.week]+(21*n.rows[m.week])+18+3;\nDwt.setLocation(o,h,g)\n}}}}};\nZmCalMonthView.prototype._calculateAllDayX=function(c,a){var b=0;\nif(a){b=(this.dayWidth*c)+3\n}else{b=this.dayWidth*c\n}return b\n};\nZmCalMonthView.prototype._calculateAllDayWidth=function(a,c,b){var d=a;\nif(c){d-=3\n}return d+(b?-3:1)\n};\nZmCalMonthView.prototype._layout=function(){var j=this.getSize();\nvar a=j.x;\nvar o=j.y;\nif(a==0||o==0){return\n}this._needFirstLayout=false;\nvar e=document.getElementById(this._headerId);\nvar n=Dwt.getSize(e).y;\nvar l=a-5;\nvar f=o-n-10;\nvar k=document.getElementById(this._daysId);\nDwt.setSize(k,l,f);\nvar g=document.getElementById(this._bodyId);\nif(f<Dwt.getSize(g).y){l=l-15\n}Dwt.setSize(g,l,f);\nif(this._showWeekNumber){var p=document.getElementById(this._weekNumBodyId);\nDwt.setSize(p,15,Dwt.DEFAULT)\n}colWidth=Math.floor(l/(this._showWeekNumber?8:7))-1;\nvar c=this.firstDayOfWeek();\nfor(var d=0;\nd<7;\nd++){var b=document.getElementById(this._headerColId[d]);\nDwt.setSize(b,colWidth,Dwt.DEFAULT);\nb=document.getElementById(this._bodyColId[d]);\nDwt.setSize(b,colWidth,Dwt.DEFAULT);\nvar m=document.getElementById(this._dayNameId[d]);\nm.innerHTML=AjxDateUtil.WEEKDAY_LONG[(d+c)%7]\n}for(var d=0;\nd<6;\nd++){var q=document.getElementById(this._rowIds[d]);\nDwt.setSize(q,Dwt.DEFAULT,Math.floor(100/6)+\"%\")\n}this._layoutAllDay(f);\nif(this._expandedDayInfo){this.resizeCalendarGrid()\n}this.resizeAllWeekNumberCell()\n};\nZmCalMonthView.getDayToolTipText=function(b,h,f,l){var e=[];\nvar j=0;\ne[j++]=\"<div><table cellpadding=0 cellspacing=0 border=0>\";\nif(!l){e[j++]=\"<tr><td><div class='calendar_tooltip_month_day_label'>\";\ne[j++]=DwtCalendar.getDateFullFormatter().format(b);\ne[j++]=\"</div></td></tr>\"\n}e[j++]=\"<tr><td><table cellpadding=1 cellspacing=0 border=0 width=100%>\";\nvar m=h?h.size():0;\nfor(var d=0;\nd<m;\nd++){var c=h.get(d);\nif(c.isAllDayEvent()){var k=\"\";\ne[j++]=\"<tr><td><div class='appt'>\";\ne[j++]=ZmApptViewHelper._allDayItemHtml(c,this._getItemId(c),f,true,true);\ne[j++]=\"</div></td></tr>\"\n}}for(var d=0;\nd<m;\nd++){var c=h.get(d);\nif(!c.isAllDayEvent()){var g=c.ptst==ZmCalBaseItem.PSTATUS_NEEDS_ACTION;\nvar a=c.getDurationText(false,false);\ne[j++]=\"<tr><td class='calendar_month_day_item'><div class='\";\ne[j++]=ZmCalendarApp.COLORS[f.getCalendarColor(c.folderId)];\ne[j++]=g?\"DarkC\":\"C\";\ne[j++]=\"'>\";\nif(g){e[j++]=\"<b>\"\n}e[j++]=a;\nif(a!=\"\"){e[j++]=\"&nbsp;\"\n}e[j++]=AjxStringUtil.htmlEncode(c.getName());\nif(g){e[j++]=\"</b>\"\n}e[j++]=\"</div></td></tr>\"\n}}if(m==0){e[j++]=\"<tr><td>\";\ne[j++]=ZmMsg.noAppts;\ne[j++]=\"</td></tr>\"\n}e[j++]=\"</table></tr></td></table></div>\";\nreturn e.join(\"\")\n};\nZmCalMonthView.prototype._mouseDownAction=function(b,c){var a=this._getItemData(c,\"type\");\nswitch(a){case ZmCalBaseView.TYPE_MONTH_DAY:if(!appCtxt.isWebClientOffline()){this._timeSelectionAction(b,c,false);\nif(b.button==DwtMouseEvent.RIGHT){DwtUiEvent.copy(this._actionEv,b);\nthis._actionEv.item=this;\nthis._evtMgr.notifyListeners(ZmCalBaseView.VIEW_ACTION,this._actionEv)\n}}break;\ncase ZmCalBaseView.TYPE_APPT:this.setToolTipContent(null);\nthis._apptMouseDownAction(b,c);\nbreak;\ncase ZmCalBaseView.TYPE_ALL_DAY:this.setToolTipContent(null);\nthis._apptMouseDownAction(b,c);\nbreak\n}return false\n};\nZmCalMonthView.prototype._doubleClickAction=function(b,c){ZmCalBaseView.prototype._doubleClickAction.call(this,b,c);\nvar a=this._getItemData(c,\"type\");\nif(a==ZmCalBaseView.TYPE_MONTH_DAY){this._timeSelectionAction(b,c,true)\n}};\nZmCalMonthView.prototype._timeSelectionAction=function(d,g,e){var b;\nvar c=this._getItemData(g,\"type\");\nswitch(c){case ZmCalBaseView.TYPE_MONTH_DAY:var f=this._getItemData(g,\"loc\");\nb=new Date(this._days[f].date.getTime());\nvar a=new Date();\nb.setHours(a.getHours(),a.getMinutes());\nif(d.button==DwtMouseEvent.LEFT){if(ZmCalViewController._contextMenuOpened){ZmCalViewController._contextMenuOpened=false;\nbreak\n}AjxTimedAction.scheduleAction(new AjxTimedAction(this,this.expandDay,[this._days[f]]),200)\n}break;\ndefault:return\n}this._timeSelectionEvent(b,AjxDateUtil.MSEC_PER_HOUR,e)\n};\nZmCalMonthView.prototype.setDayView=function(j){var a=document.getElementById(j.tdId);\nvar k=Dwt.getSize(a);\nvar f=this._dayView;\nvar h=!f||!f.getVisible()||!f.getDate()||f.getDate().getTime()!==j.date.getTime();\nif(!f){f=this._dayView=new ZmCalDayView(this,DwtControl.ABSOLUTE_STYLE,this._controller,this._dropTgt);\nf.setCompactMode(true);\nf.setCloseDayViewCallback(new AjxCallback(this,this._closeDayView));\nf.addViewActionListener(new AjxListener(this._controller,this._controller._viewActionListener));\nf.addTimeSelectionListener(new AjxListener(this._controller,this._controller._timeSelectionListener));\nf.addSelectionListener(new AjxListener(this,this._dayListSelectionListener));\nf.addActionListener(new AjxListener(this._controller,this._controller._listActionListener))\n}else{f.setVisible(true)\n}if(h){f.setDate(j.date,0,true);\nvar g=new AjxVector();\nvar c=j.appts;\nif(c){for(var d=0;\nd<c.length;\nd++){g.add(c[d])\n}}var b=j.allDayAppts;\nif(b){for(var d=0;\nd<b.length;\nd++){g.add(b[d])\n}}f._preSet();\nf.set(g,true)\n}f.setSize(k.x-10,k.y-12);\nf._syncScroll();\nvar e=Dwt.toWindow(a,0,0,this.getHtmlElement(),true);\nf.setLocation(e.x+5,e.y+5);\nf._layout(true)\n};\nZmCalMonthView.prototype.expandDay=function(a){this.clearCalendarGrid(true);\nthis.startExpand(a)\n};\nZmCalMonthView.prototype.clearCalendarGrid=function(p){for(var g=0;\ng<6;\ng++){for(var l in this._apptSets){var o=this._apptSets[l];\nif(!o.allDay){continue\n}for(var d=0;\nd<o.appts.length;\nd++){var a=o.appts[d];\nvar q=document.getElementById(this._getItemId(a));\nif(q){q.parentNode.removeChild(q)\n}}}for(var e=0;\ne<7;\ne++){var k=g*7+e;\nvar m=this._days[k];\nif(m&&m.dayId){var c=document.getElementById(m.dayId);\nwhile(c&&c.firstChild){c.firstChild.parentNode.removeChild(c.firstChild)\n}}if(m&&m.titleId){var b=document.getElementById(m.titleId);\nb.className=m.dayClassName?m.dayClassName:\"\";\nDwt.setOpacity(b,100);\nif(p){var n=(m.appts&&m.appts.length>0)||(m.allDayAppts&&m.allDayAppts.length>0);\nb.className=b.className+(n?\" calendar_month_day_label_bold\":\"\")\n}}}}if(this._fillers.length>0){for(var g=0;\ng<this._fillers.length;\ng++){var h=this._fillers[g];\nthis._fillers[g]=null;\nif(h.parentNode){h.parentNode.removeChild(h)\n}}this._fillers=[]\n}};\nZmCalMonthView.prototype.resizeWeekNumberCell=function(c,a){if(!this._showWeekNumber){return\n}var b=document.getElementById(this._weekNumberIds[c]);\nif(b){Dwt.setSize(b,15,Dwt.DEFAULT)\n}};\nZmCalMonthView.prototype.resizeCalendarGrid=function(){var a=document.getElementById(this._daysId);\nvar k=Dwt.getSize(a);\nvar e=k.y/6;\nvar h=k.x/7;\nfor(var d=0;\nd<6;\nd++){var g=document.getElementById(this._rowIds[d]);\nif(d==5){e=e-1\n}Dwt.setSize(g,Dwt.DEFAULT,e);\nif(AjxEnv.isSafari){Dwt.setSize(this.getCell(d,0),Dwt.DEFAULT,e)\n}}for(var c=0;\nc<7;\nc++){var f=document.getElementById(this._headerColId[c]);\nvar b=document.getElementById(this._bodyColId[c]);\nif(c==6){h=h-1\n}Dwt.setSize(f,h,Dwt.DEFAULT);\nDwt.setSize(b,h,Dwt.DEFAULT);\nif(AjxEnv.isSafari){Dwt.setSize(this.getCell(0,c),h,Dwt.DEFAULT)\n}}};\nZmCalMonthView.prototype.resizeAllWeekNumberCell=function(){var c=0;\nfor(var e=0;\ne<6;\ne++){var d=document.getElementById(this._rowIds[e]);\nvar b=Dwt.getLocation(d);\nif(e>0){var a=b.y-c;\nthis.resizeWeekNumberCell(e-1,a)\n}c=b.y\n}};\nZmCalMonthView.prototype._closeDayView=function(){if(this._dayView){this._dayView.setVisible(false);\nthis._needFirstLayout=false;\nthis.clearExpandedDay();\nthis.clearCalendarGrid();\nvar a=new AjxVector();\na.addList(this._list||[]);\nthis.set(a,true)\n}};\nZmCalMonthView.prototype.resizeCol=function(f,e){var b=e.dayInfo;\nvar a=document.getElementById(this._headerColId[f]);\nvar d=document.getElementById(this._bodyColId[f]);\nvar c=e.avgWidth;\nif(b.dow==f){c=e.expandedWidth\n}else{if(e.collapseColId==f){c=e.collapsedWidth\n}}if(d&&a){c=(f==6)?c-1:c;\nDwt.setSize(d,c,Dwt.DEFAULT);\nDwt.setSize(a,c,Dwt.DEFAULT);\nif(AjxEnv.isSafari||AjxEnv.isChrome||(AjxEnv.isFirefox2_0up&&!AjxEnv.isFirefox3up)){Dwt.setSize(this.getCell(0,f),c,Dwt.DEFAULT)\n}}};\nZmCalMonthView.prototype.resizeRow=function(e,g){if(e==null){return\n}var c=g.dayInfo;\nvar a=g.avgHeight;\nvar d=null;\nif(c.week==e){a=g.expandedHeight;\nd=c.dow\n}else{if(g.collapseRowId==e){a=g.collapsedHeight\n}}a=(e==5)?a-1:a;\nvar f=document.getElementById(this._rowIds[e]);\nDwt.setSize(f,Dwt.DEFAULT,a);\nif(AjxEnv.isSafari||AjxEnv.isChrome){Dwt.setSize(this.getCell(e,0),Dwt.DEFAULT,a)\n}if(AjxEnv.isIE&&d!=null&&e!=null){var b=this.getCell(e,d);\nDwt.setSize(b,Dwt.DEFAULT,a)\n}this.resizeWeekNumberCell(e,a)\n};\nZmCalMonthView.prototype.resizeCell=function(c,a){var b=this.getCell(c.week,c.dow);\nDwt.setSize(b,Dwt.DEFAULT,a);\nthis.resizeWeekNumberCell(c.week,a)\n};\nZmCalMonthView.prototype.clearCellHeight=function(b){if(!b){return\n}var a=this.getCell(b.week,b.dow);\nDwt.setSize(a,Dwt.DEFAULT,Dwt.CLEAR);\nthis.resizeWeekNumberCell(b.week,Dwt.CLEAR)\n};\nZmCalMonthView.prototype.getCell=function(d,a){var c=d*7+a;\nvar b=this._days[c].tdId;\nreturn document.getElementById(b)\n};\nZmCalMonthView.prototype.startExpand=function(h){var b=document.getElementById(this._daysId);\nvar i=Dwt.getSize(b);\nvar d=i.y*ZmCalMonthView.EXPANDED_HEIGHT_PERCENT/100;\nvar e=i.x*ZmCalMonthView.EXPANDED_WIDTH_PERCENT/100;\nvar f=(i.y-d)/5;\nvar g=(i.x-e)/6;\nvar c={dayInfo:h,avgWidth:g,avgHeight:f,maxWidth:e,maxHeight:d,changeCol:true,changeRow:true,startTime:new Date().getTime()};\nif(this._expandedDayInfo){var a=this._expandedDayInfo;\nc.collapseRowId=a.week;\nc.collapseColId=a.dow;\nif(a.week==h.week){c.changeRow=false\n}if(a.dow==h.dow){c.changeCol=false\n}}if(this._dayView){this._dayView.setVisible(false)\n}clearInterval(this._animationInterval);\nthis._animationFrames=0;\nthis._animationInterval=setInterval(this.animateExpansion.bind(this,c),ZmCalMonthView.ANIMATE_INTERVAL);\nthis.animateExpansion(c)\n};\nZmCalMonthView.prototype.animateExpansion=function(g){var c=g.maxWidth-g.avgWidth;\nvar e=g.maxHeight-g.avgHeight;\nvar h=new Date().getTime()-g.startTime;\nvar a=Math.min(h/ZmCalMonthView.ANIMATE_DURATION,1);\nvar b=100*a;\nif(g.changeCol){g.expandedWidth=g.avgWidth+c*a;\ng.collapsedWidth=g.maxWidth-c*a\n}else{g.expandedWidth=g.collapsedWidth=g.maxWidth\n}if(g.changeRow){g.expandedHeight=g.avgHeight+e*a;\ng.collapsedHeight=g.maxHeight-e*a\n}else{g.expandedHeight=g.collapsedHeight=g.maxHeight\n}this._expandDayGrid(g);\nthis.setDayView(g.dayInfo);\nthis._dayView.setOpacity(b);\nDwt.setOpacity(Dwt.byId(g.dayInfo.titleId),100-b);\nthis._animationFrames+=1;\nif(a===1){clearInterval(this._animationInterval);\nvar d=g.dayInfo;\nthis._expandedDayInfo={week:d.week,dow:d.dow,date:d.date};\nvar f=Math.round(this._animationFrames/h*1000)\n}};\nZmCalMonthView.prototype._expandDayGrid=function(d){var c=d.dayInfo;\nif(!this._expandedDayInfo){for(var b=0;\nb<6;\nb++){this.resizeRow(b,d)\n}for(var a=0;\na<7;\na++){this.resizeCol(a,d)\n}}else{if(d.changeRow){this.resizeRow(d.collapseRowId,d);\nthis.resizeRow(c.week,d)\n}if(d.changeCol){this.resizeCol(d.collapseColId,d);\nthis.resizeCol(c.dow,d)\n}if(AjxEnv.isIE){if(!d.changeRow){this.resizeCell(c,d.maxHeight)\n}this.clearCellHeight(this._expandedDayInfo)\n}}};\nZmCalMonthView.prototype.clearExpandedDay=function(){if(!this._expandedDayInfo){return\n}this.clearCellHeight(this._expandedDayInfo);\nthis.resizeCalendarGrid();\nthis.resizeAllWeekNumberCell();\nthis._expandedDayInfo=null\n};\nZmCalMonthView.prototype._controlListener=function(c){if(!this._expandedDayInfo){ZmCalBaseView.prototype._controlListener.call(this,c);\nvar b=document.getElementById(this._monthViewTable);\nvar a=Dwt.getSize(b);\nif(a.y!=c.newHeight||a.x!=c.newWidth){this._layout()\n}}else{this._closeDayView()\n}};\nZmCalMonthView.prototype._viewActionListener=function(a){this.notifyListeners(ZmCalBaseView.VIEW_ACTION,a)\n};\nZmCalMonthView.prototype._dayListSelectionListener=function(a){this._evtMgr.notifyListeners(DwtEvent.SELECTION,a)\n};\nZmCalMonthView.prototype.getSelection=function(){if(this._expandedDayInfo){return this._dayView.getSelection()\n}else{return ZmCalBaseView.prototype.getSelection.call(this)\n}};\nZmCalMonthView.prototype.resizeDayCell=function(d,c){var j=this.getSize();\nvar b=j.x;\nvar o=j.y;\nvar f=document.getElementById(this._headerId);\nvar n=Dwt.getSize(f).y;\nvar m=b-5;\nvar g=o-n-10;\nvar l=document.getElementById(this._daysId);\nDwt.setSize(l,m,g);\nvar i=document.getElementById(this._bodyId);\nDwt.setSize(i,m,g);\nvar a=document.getElementById(this._daysId);\nvar q=Dwt.getSize(a);\nvar o=q.y*ZmCalMonthView.EXPANDED_HEIGHT_PERCENT/100;\nvar b=q.x*ZmCalMonthView.EXPANDED_WIDTH_PERCENT/100;\nvar p=document.getElementById(this._rowIds[d]);\nvar e=document.getElementById(this._bodyColId[c]);\nvar k=document.getElementById(this._headerColId[c]);\nif(p){Dwt.setSize(p,Dwt.DEFAULT,o);\nDwt.setSize(p.firstChild,Dwt.DEFAULT,o);\nDwt.setSize(document.getElementById(this._days[d*7+c].tdId),Dwt.DEFAULT,o)\n}if(e&&k){Dwt.setSize(e,b,Dwt.DEFAULT);\nDwt.setSize(k,b,Dwt.DEFAULT)\n}};\nZmCalMonthView.prototype._createContainerRect=function(c){var b=document.getElementById(this._bodyId);\nvar a=Dwt.getLocation(b);\nvar d=Dwt.getSize(b);\nthis._containerRect=new DwtRectangle(a.x,a.y,d.x,d.y);\nc.originX=a.x;\nc.originY=a.y\n};\nZmCalMonthView.prototype._apptDndBegin=function(f){var h=Dwt.getLocation(f.apptEl);\nf.dndObj={};\nf.apptX=h.x;\nf.apptY=h.y;\nthis._colWidth=this.dayWidth;\nf.snap=this._snapXYToDate(f.docX-f.originX,f.docY-f.originY);\nif(f.snap==null){return false\n}var j=f.appt._orig;\nf.startDate=new Date(j.getStartTime());\nvar d=new Date(f.startDate);\nd.setHours(0,0,0,0);\nf.startDayIndex=this._createDayIndexFromDate(d);\nf.offsetDayIndex=f.snap.dayIndex-f.startDayIndex;\nf.startDateOffset=-(f.offsetDayIndex*AjxDateUtil.MSEC_PER_DAY);\nf.timeOffset=[];\nif(f.appt.isAllDayEvent()){f.timeOffset.push(0);\nf.numDays=this._createDayIndexFromDate(j.endDate)-f.startDayIndex;\nf.offsetY=[];\nvar b=null;\nvar q=null;\nfor(var g=0;\ng<f.numDays;\ng++){var e=f.startDayIndex+g;\nb=f.apptEl||this._getAllDayDiv(f.appt,g);\nif((e>=0)&&(e<this.numDays)){day=this._days[e];\nthis._calculateOffsetY(f,b,day.week);\nif(f.numDays>1){if(g==0){b.saveHtml=b.innerHTML;\nthis._clearIcon(b.id,\"tag\");\nthis._clearIcon(b.id,\"peel\")\n}else{if(b.head||(b.tail&&(g<(f.numDays-1)))){b.saveHtml=b.innerHTML;\nif(!q){var m=this._getItemId(f.appt);\nq=ZmApptViewHelper._allDayItemHtml(f.appt,m,this._controller,false,false)\n}b.innerHTML=q;\nb.firstChild.id=b.id+ZmCalMonthView.ALL_DAY_DIV_BODY;\nb.firstChild.style.cssText+=\"border-left: 0px none black !important;\";\nb.firstChild.style.cssText+=\"border-right: 0px none black !important;\";\nthis._setAllDayDnDSize(b,false,false)\n}}}}this._highlightAllDayDiv(b,f.appt,true)\n}}else{var k=this._getApptUniqueId(f.appt);\nvar p=this._apptSets[k];\nif(!p){var l=this._getDayForAppt(f.appt);\np=this._createApptSet(f.appt,k,l);\np.appts.push(f.appt)\n}f.trEl=[];\nf.tableEl=[];\nfor(var c=0;\nc<p.appts.length;\nc++){var a=p.appts[c];\nvar n=this._getItemId(a);\nvar o=document.getElementById(n);\nif(o==null){o=document.createElement(\"tr\");\no.className=\"appt-selected\";\nthis._createItemHtmlContents(a,o);\nthis.associateItemWithElement(a,o,ZmCalBaseView.TYPE_APPT)\n}f.tableEl[c]=Dwt.getDescendant(o,this._getItemId(a)+\"_tableBody\");\nf.trEl.push(o);\nf.timeOffset.push(this._getTimeOffset(a.getStartTime()))\n}this._calculateWeekY(f);\nf.apptDiv={}\n}f.dndStarted=true;\nreturn true\n};\nZmCalMonthView.prototype._clearIcon=function(a,c){var b=document.getElementById(a+\"_\"+c);\nif(b){b.innerHTML=\"\"\n}};\nZmCalMonthView.prototype._highlightAllDayDiv=function(c,d,b){var e=document.getElementById(c.id+ZmCalMonthView.ALL_DAY_DIV_BODY);\nvar a=document.getElementById(this._getItemId(d)+\"_tableBody\");\nif(b){Dwt.addClass(e,DwtCssStyle.DROPPABLE);\nDwt.setZIndex(c,\"1000000000\")\n}else{Dwt.delClass(e,DwtCssStyle.DROPPABLE);\nDwt.setZIndex(c,\"\")\n}};\nZmCalMonthView.prototype._setAllDayDnDSize=function(a,d,c){var b=this._calculateAllDayWidth(this.dayWidth,d,c);\nthis._setAllDayDivSize(a,b)\n};\nZmCalMonthView.prototype._getAllDayDiv=function(d,b){var c=d.invId+\"_\"+b.toString();\nvar a=this._apptAllDayDiv[c];\nreturn document.getElementById(a)\n};\nZmCalMonthView.prototype._createDayIndexFromDate=function(a){return Math.round((a.getTime()-this._days[0].date.getTime())/AjxDateUtil.MSEC_PER_DAY)\n};\nZmCalMonthView.prototype._calculateWeekY=function(c){c.weekY=[];\nvar d=0;\nfor(var b=0;\nb<6;\nb++){c.weekY[b]=d;\nvar a=Dwt.getSize(document.getElementById(this._days[7*b].tdId));\nd+=a.y\n}c.weekY[6]=d\n};\nZmCalMonthView.prototype._calculateOffsetY=function(c,b,a){if(!c.weekY){this._calculateWeekY(c)\n}if(c.offsetY[a]===undefined){var d=Dwt.getLocation(b);\nc.offsetY[a]=(d.y-c.weekY[a])\n}};\nZmCalMonthView.prototype._getTimeOffset=function(b){var a=new Date(b);\na.setHours(0,0,0,0);\nreturn b-a.getTime()\n};\nZmCalMonthView.prototype._snapXYToDate=function(h,f){var j=Math.floor(h/this._colWidth);\nvar g=5;\nvar k=0;\nfor(var c=0;\nc<6;\nc++){var m=document.getElementById(this._rowIds[c]);\nvar i=Dwt.getSize(m);\nk+=i.y;\nif(f<k){g=c;\nbreak\n}}var b=this._calcDayIndex(g,j);\nvar l=0;\nif(b<0){l=-b;\nb=0\n}else{if(b>=this.numDays){l=b-this.numDays+1;\nb=this.numDays-1\n}}var e=this._days[b];\nvar a=new Date(this._days[b].date.getTime());\na.setHours(0,0,0,0);\nvar d=null;\nif(e&&a){d=new Date(a.getTime()+(AjxDateUtil.MSEC_PER_DAY*l))\n}return{date:d,dayIndex:b}\n};\nZmCalMonthView.prototype._clearSnap=function(a){a.dayIndex=ZmCalMonthView.OUT_OF_BOUNDS_SNAP\n};\nZmCalMonthView.prototype._doApptMove=function(e,d,c){var b=e.docX-e.originX+d;\nvar f=e.docY-e.originY+c;\nvar a=this._snapXYToDate(b,f);\nif((a!=null)&&(a.dayIndex!=e.snap.dayIndex)){DBG.println(AjxDebug.DBG3,\"mouseMove new snap: \"+a.date+\" (\"+a.dayIndex+\")   data snap: \"+e.snap.date+\" (\"+e.snap.dayIndex+\")\");\nif(e.appt.isAllDayEvent()){this._moveAllDayAppt(e,a.dayIndex-e.offsetDayIndex)\n}else{this._moveApptRow(e,a.dayIndex)\n}e.startDate=new Date(a.date.getTime()+e.startDateOffset+e.timeOffset[0]);\ne.snap=a\n}};\nZmCalMonthView.prototype._moveAllDayAppt=function(e,b){var p=-1;\nvar c=this.firstDayOfWeek();\nfor(var f=0;\nf<e.numDays;\nf++){var d=b+f;\nvar a=e.apptEl||this._getAllDayDiv(e.appt,f);\nif((d<0)||(d>=this.numDays)){Dwt.setVisible(a,false)\n}else{var n=(b+f)%7;\nvar h=(f==0)||(c==n);\nvar m=((f==(e.numDays-1)||(d==(this.numDays-1))||(n==(c+6))));\nvar j=this._calculateAllDayX(n,h);\nvar l=this._days[d];\nvar g=0;\nDwt.setVisible(a,true);\nthis._setAllDayDnDSize(a,h,m);\nvar o=Dwt.getSize(a);\nvar k=o.y/2;\nif(e.offsetY[l.week]!==undefined){g=e.weekY[l.week]+e.offsetY[l.week]\n}else{g=(e.weekY[l.week]+e.weekY[l.week+1])/2-k\n}Dwt.setLocation(a,j,g)\n}}};\nZmCalMonthView.prototype._moveApptRow=function(d,b){b=b-d.offsetDayIndex;\nvar h=null;\nfor(var e=0;\ne<d.trEl.length;\ne++){var j=this._days[b+e];\nif(j){if(!d.apptDiv[e]){var c=d.trEl[e].firstChild;\nvar k=c.firstChild;\nc.saveHTML=c.innerHTML;\nc.removeChild(k);\nthis._createAllDayFillerContent(d.trEl[e],false);\nif(!h){h=document.getElementById(this._daysId)\n}d.apptDiv[e]=this._createDnDApptDiv(d,e,h,k)\n}Dwt.setVisible(d.apptDiv[e],true);\nvar a=d.apptDiv[e].firstChild;\nvar l=Dwt.getSize(a);\nvar g=(this.dayWidth*j.dow)+this.dayWidth/2-l.x/2+(this._showWeekNumber?15:0);\nvar f=(d.weekY[j.week]+d.weekY[j.week+1])/2-l.y/2;\nDwt.setLocation(d.apptDiv[e],g,f)\n}else{if(d.apptDiv[e]){Dwt.setVisible(d.apptDiv[e],false)\n}}}};\nZmCalMonthView.prototype._createDnDApptDiv=function(d,c,g,a){var f=document.createElement(\"div\");\nvar b={apptSlice:c};\nf.style.position=\"absolute\";\nf.appendChild(a);\nvar e=Dwt.getSize(d.trEl[c]);\nDwt.setSize(f,e.x,Dwt.CLEAR);\nDwt.setZIndex(f,\"100000000\");\ng.appendChild(f);\nDwt.setOpacity(d.tableEl[c],ZmCalColView._OPACITY_APPT_DND);\nDwt.addClass(f,DwtCssStyle.DROPPABLE);\nreturn f\n};\nZmCalMonthView.prototype._reattachApptDnDHtml=function(b,j,d){for(var c=0;\nc<b.trEl.length;\nc++){var f=this._days[j+c];\nif(b.apptDiv[c]){b.apptDiv[c].parentNode.removeChild(b.apptDiv[c])\n}if(f&&b.trEl[c]){var a=b.trEl[c].firstChild;\nif(a.saveHTML){if(j==b.startDayIndex){a.removeChild(a.firstChild)\n}else{var g=document.getElementById(f.dayId);\nvar k=0;\nfor(k=0;\nk<g.childNodes.length;\nk++){var h=g.childNodes[k];\nif((h.apptStartTimeOffset!==undefined)&&(h.apptStartTimeOffset>b.timeOffset[c])){break\n}}if(b.trEl[c].parentNode){b.trEl[c].parentNode.removeChild(b.trEl[c])\n}b.trEl[c].removeChild(a);\nvar e=g.insertRow(k);\ne.appendChild(a);\ne.id=b.trEl[c].id;\ne.className=b.trEl[c].className\n}a.innerHTML=a.saveHTML;\na.firstChild.className=\"\"\n}}}b.apptDiv={}\n};\nZmCalMonthView.prototype._removeDnDApptDiv=function(b){if(b.apptDiv){for(var a in b.apptDiv){b.apptDiv[a].parentNode.removeChild(b.apptDiv[a])\n}b.apptDiv=null\n}};\nZmCalMonthView.prototype._restoreApptLoc=function(a){if(a&&a.appt){if(a.appt.isAllDayEvent()){this._moveAllDayAppt(a,a.startDayIndex)\n}else{this._reattachApptDnDHtml(a,a.startDayIndex,false)\n}a.snap.dayIndex=a.startDayIndex\n}};\nZmCalMonthView.prototype._deselectDnDHighlight=function(d){if(d.appt.isAllDayEvent()){for(var c=0;\nc<d.numDays;\nc++){var b=d.apptEl||this._getAllDayDiv(d.appt,c);\nif(b){this._highlightAllDayDiv(b,d.appt,false)\n}}}else{if(d.snap.dayIndex==ZmCalMonthView.OUT_OF_BOUNDS_SNAP){for(var c=0;\nc<d.trEl.length;\nc++){var a=this._days[d.startDayIndex+c];\nif(a){var e=d.trEl[c].firstChild;\nZmCalBaseView._setApptOpacity(d.appt,d.tableEl[c])\n}}}else{this._reattachApptDnDHtml(d,d.snap.dayIndex-d.offsetDayIndex,true)\n}}};\nZmCalMonthView.prototype._restoreAppt=function(c){if(c.appt.isAllDayEvent()){for(var b=0;\nb<c.numDays;\nb++){var a=c.apptEl||this._getAllDayDiv(c.appt,b);\nif(a.saveHtml!==undefined){a.innerHTML=a.saveHtml;\na.saveHtml=undefined\n}}}};\nZmCalMonthView.prototype._handleApptScrollRegion=function(b,a,n,q){var d=0;\nvar i=document.getElementById(this._daysId);\nvar g=document.getElementById(this._bodyId);\nvar l=Dwt.getLocation(i);\nvar j=Dwt.getSize(i);\nvar c=document.getElementById(this._headerId);\nvar m=Dwt.getSize(c).y;\nvar f=Dwt.getLocation(c).y;\nDBG.println(AjxDebug.DBG3,\"_handleApptScrollRegion mouseY: \"+a+\"    headingHeight:\"+m+\"    headingBaseY: \"+f+\"    sizeY:\"+j.y);\nvar o=a<f+m+4;\nvar p=a>l.y+j.y-8;\nif(o||p){var r=i.scrollTop;\nif(o&&r>0){d=-(r>n?n:r)\n}else{if(p){var k=Dwt.getSize(g);\nvar h=k.y-j.y;\nif(r<h){var e=h-r;\nd=e>n?n:e\n}}}if(d!=0){i.scrollTop+=d;\nthis._containerRect.set(this._containerRect.x,this._containerRect.y-d);\nq.originY-=d\n}}return d\n};\nZmCalMonthView.prototype.startIndicatorTimer=function(){if(!this._indicatorTimer){this._indicatorTimer=this.updateTimeIndicator()\n}};\nZmCalMonthView.prototype.updateTimeIndicator=function(){if(this._selectedData){var a=new Date();\na.setHours(0,0,0,0);\nif(this._selectedData.date.getTime()!=a.getTime()){this._date=a;\nthis._dateUpdate()\n}}return this.setTimer(1)\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalScheduleView\")){ZmCalScheduleView=function(d,c,b,a){ZmCalColView.call(this,d,c,b,a,null,1,true)\n};\nZmCalScheduleView.prototype=new ZmCalColView;\nZmCalScheduleView.prototype.constructor=ZmCalScheduleView;\nZmCalScheduleView.prototype.toString=function(){return\"ZmCalScheduleView\"\n};\nZmCalScheduleView.prototype._apptMouseDownAction=function(b,a){appt=this.getItemFromElement(a);\nif(appt.isAllDayEvent()){return false\n}else{return ZmCalBaseView.prototype._apptMouseDownAction.call(this,b,a,appt)\n}};\nZmCalNewScheduleView=function(d,c,b,a){ZmCalColView.call(this,d,c,b,a,ZmId.VIEW_CAL_FB,1,true);\nvar e=appCtxt.getApp(ZmApp.CALENDAR);\nthis._fbCache=new ZmFreeBusyCache(e)\n};\nZmCalNewScheduleView.prototype=new ZmCalColView;\nZmCalNewScheduleView.prototype.constructor=ZmCalNewScheduleView;\nZmCalNewScheduleView.prototype.toString=function(){return\"ZmCalNewScheduleView\"\n};\nZmCalNewScheduleView.ATTENDEES_METADATA=\"MD_SCHED_VIEW_ATTENDEES\";\nZmCalNewScheduleView.prototype.getFreeBusyCache=function(){return this._fbCache\n};\nZmCalNewScheduleView.prototype._createHtml=function(a){this._days={};\nthis._columns=[];\nthis._hours={};\nthis._layouts=[];\nthis._allDayAppts=[];\nthis._calendarOwners={};\nthis._headerYearId=Dwt.getNextId();\nthis._yearHeadingDivId=Dwt.getNextId();\nthis._yearAllDayDivId=Dwt.getNextId();\nthis._leftAllDaySepDivId=Dwt.getNextId();\nthis._leftApptSepDivId=Dwt.getNextId();\nthis._allDayScrollDivId=Dwt.getNextId();\nthis._allDayHeadingDivId=Dwt.getNextId();\nthis._allDayApptScrollDivId=Dwt.getNextId();\nthis._allDayDivId=Dwt.getNextId();\nthis._hoursScrollDivId=Dwt.getNextId();\nthis._bodyHourDivId=Dwt.getNextId();\nthis._allDaySepDivId=Dwt.getNextId();\nthis._bodyDivId=Dwt.getNextId();\nthis._apptBodyDivId=Dwt.getNextId();\nthis._newApptDivId=Dwt.getNextId();\nthis._newAllDayApptDivId=Dwt.getNextId();\nthis._timeSelectionDivId=Dwt.getNextId();\nthis._unionHeadingDivId=Dwt.getNextId();\nthis._unionAllDayDivId=Dwt.getNextId();\nthis._unionHeadingSepDivId=Dwt.getNextId();\nthis._unionGridScrollDivId=Dwt.getNextId();\nthis._unionGridDivId=Dwt.getNextId();\nthis._unionGridSepDivId=Dwt.getNextId();\nthis._workingHrsFirstDivId=Dwt.getNextId();\nthis._workingHrsSecondDivId=Dwt.getNextId();\nthis._allDayRows=[];\nthis._attendees={};\nthis._attendees[ZmCalBaseItem.PERSON]={};\nthis._attendees[ZmCalBaseItem.LOCATION]={};\nthis._attendees[ZmCalBaseItem.EQUIPMENT]={};\nvar b=new AjxBuffer();\nb.append(\"<div id='\",this._bodyDivId,\"' class=calendar_body style='position:absolute'>\");\nb.append(\"<div id='\",this._apptBodyDivId,\"' style='width:100%;position:absolute;'>\",\"</div>\");\nb.append(\"</div>\");\nthis.getHtmlElement().innerHTML=b.toString()\n};\nZmCalNewScheduleView.prototype._layout=function(d){var c=this.getSize();\nvar b=c.x;\nvar a=c.y;\nif(b==0||a==0){return\n}this._setBounds(this._bodyDivId,0,0,b,a);\nthis._setBounds(this._apptBodyDivId,0,0,b-Dwt.SCROLLBAR_WIDTH,a)\n};\nZmCalNewScheduleView.prototype.getCalendarAccount=function(){return null\n};\nZmCalNewScheduleView.prototype._apptMouseDownAction=function(b,a){};\nZmCalNewScheduleView.prototype._doubleClickAction=function(a,b){this._mouseDownAction(a,b,true)\n};\nZmCalNewScheduleView.prototype._mouseDownAction=function(j,a,i){var h=DwtUiEvent.getTarget(j),k,e,f={},c,d=30,b=null,g=false;\ni=i||false;\nif(h&&h.className.indexOf(\"ZmSchedulerGridDiv\")!=-1){k=h.id;\ne=k.split(\"__\");\nf.start=e[1]-1;\nf.end=e[1];\nif(this._scheduleView){this._scheduleView.setDateBorder(f);\nthis._scheduleView._outlineAppt();\nif(!this._date){this._date=new Date()\n}c=new Date(this._date);\nc.setHours(0,f.end*30,0);\nthis._timeSelectionEvent(c,d,i,g,b,j.shiftKey)\n}}};\nZmCalNewScheduleView.prototype.getOrganizer=function(){var a=new ZmContact(null);\na.initFromEmail(appCtxt.getUsername(),true);\nreturn a\n};\nZmCalNewScheduleView.prototype.getRsvp=function(){return false\n};\nZmCalNewScheduleView.prototype._scrollToTime=function(a){};\nZmCalNewScheduleView.prototype.getDateInfo=function(a){var b={},c=a||new Date();\nb.startDate=AjxDateUtil.simpleComputeDateStr(c);\nb.endDate=AjxDateUtil.simpleComputeDateStr(c);\nb.timezone=AjxDateFormat.format(\"z\",c);\nb.isAllDay=true;\nreturn b\n};\nZmCalNewScheduleView.prototype._navDateChangeListener=function(a){this._date=a;\nthis._scheduleView.changeDate(this.getDateInfo(a))\n};\nZmCalNewScheduleView.prototype._dateUpdate=function(a){};\nZmCalNewScheduleView.prototype.set=function(a,b){this._preSet();\nif(!this._scheduleView){this._calNotRenderedList=a;\nreturn\n}this.resetListItems(a);\nthis.renderAppts(a)\n};\nZmCalNewScheduleView.prototype.resetListItems=function(b){this._selectedItems.removeAll();\nvar a=b;\nif(b&&(b==this._list)){a=b.clone()\n}this._resetList();\nthis._list=a\n};\nZmCalNewScheduleView.prototype.renderAppts=function(f){var a=this.getTimeRange();\nif(f){var c=f.size();\nif(c!=0){var e=appCtxt.get(ZmSetting.CAL_SHOW_DECLINED_MEETINGS);\nthis._computeApptLayout();\nfor(var b=0;\nb<c;\nb++){var d=f.get(b);\nif(d&&d.isInRange(a.start,a.end)&&(e||(d.ptst!=ZmCalBaseItem.PSTATUS_DECLINED))){this.addAppt(d)\n}}}}};\nZmCalNewScheduleView.prototype.addAppt=function(b){if(this._scheduleView){var a=this._createItemHtml(b),c=this._getDivForAppt(b);\nif(c){c.appendChild(a)\n}this._scheduleView.colorAppt(b,a)\n}};\nZmCalNewScheduleView.prototype.removeAppt=function(b){if(this._scheduleView){var c=this._getItemId(b),a=document.getElementById(c),d=this._getDivForAppt(b);\nif(d&&a){d.removeChild(a)\n}}};\nZmCalNewScheduleView.prototype.removeApptByEmail=function(a){if(this._scheduleView){for(var b=0;\nb<this._list.size();\nb++){var d=this._list.get(b);\nif(d&&d.getFolder().getOwner()==a){var e=this._getItemId(d),c=document.getElementById(e),f=this._getDivForAppt(d);\nif(f&&c){f.removeChild(c)\n}}}}};\nZmCalNewScheduleView.prototype.refreshAppts=function(){this._selectedItems.removeAll();\nvar a=this._list.clone();\nthis._resetList();\nthis._list=a;\nthis.renderAppts(a)\n};\nZmCalNewScheduleView.prototype._layoutAllDayAppts=function(){};\nZmCalNewScheduleView.prototype.getAtttendees=function(){return this._attendees[ZmCalBaseItem.PERSON].getArray()\n};\nZmCalNewScheduleView.prototype.getMetadataAttendees=function(a){var b=new ZmMetaData(a.getAccount());\nvar c=new AjxCallback(this,this.processMetadataAttendees);\nb.get(\"MD_SCHED_VIEW_ATTENDEES\",null,c)\n};\nZmCalNewScheduleView.prototype.processMetadataAttendees=function(c){var d=c.getResponse().BatchResponse.GetMailboxMetadataResponse[0].meta[0]._attrs,f=[],a,e,b;\nfor(a in d){if(a&&d[a]){f.push(d[a])\n}}this._mdAttendees=AjxVector.fromArray(f);\nfor(b=0;\nb<this._mdAttendees.size();\nb++){e=ZmApptViewHelper.getAttendeeFromItem(this._mdAttendees.get(b),ZmCalBaseItem.PERSON);\nthis._attendees[ZmCalBaseItem.PERSON].add(e,null,true)\n}AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\",\"CalendarAppt\"]);\nthis._scheduleView=new ZmFreeBusySchedulerView(this,this._attendees,this._controller,this.getDateInfo());\nthis._scheduleView.setComposeMode(false);\nthis._scheduleView.setVisible(true);\nthis._scheduleView.showMe();\nthis._scheduleView.reparentHtmlElement(this._apptBodyDivId);\nthis.resetListItems(this._calNotRenderedList);\nthis.renderAppts(this._calNotRenderedList);\ndelete this._calNotRenderedList\n};\nZmCalNewScheduleView.prototype.setMetadataAttendees=function(a,b){if(!a){a=this.getOrganizer()\n}if(b instanceof Array){b=b.join(\",\")\n}var c=new ZmMetaData(a.getAccount());\nthis._mdAttendees.add(b,null,true);\nreturn c.set(ZmCalNewScheduleView.ATTENDEES_METADATA,this._mdAttendees.getArray())\n};\nZmCalNewScheduleView.prototype.removeMetadataAttendees=function(a,b){if(!a){a=this.getOrganizer()\n}if(b instanceof Array){b=b.join(\",\")\n}var c=new ZmMetaData(a.getAccount());\nthis._mdAttendees.remove(b,null,true);\nreturn c.set(ZmCalNewScheduleView.ATTENDEES_METADATA,this._mdAttendees.getArray())\n};\nZmCalNewScheduleView.prototype._resetCalendarData=function(){var e,c,g,f,d,b,a=this.getOrganizer();\nthis._calendars=this._controller.getCheckedCalendars();\nthis._calendars.sort(ZmFolder.sortCompareNonMail);\nthis._folderIdToColIndex={};\nthis._columns=[];\nthis._numCalendars=this._calendars.length;\nthis._attendees[ZmCalBaseItem.PERSON]=new AjxVector();\nfor(e=0;\ne<this._numCalendars;\ne++){f=this._calendars[e].getOwner();\nif(a.getEmail()!=f){g=ZmApptViewHelper.getAttendeeFromItem(f,ZmCalBaseItem.PERSON);\nthis._attendees[ZmCalBaseItem.PERSON].add(g,null,true)\n}}if(this._scheduleView){for(e=0;\ne<this._mdAttendees.size();\ne++){g=ZmApptViewHelper.getAttendeeFromItem(this._mdAttendees.get(e),ZmCalBaseItem.PERSON);\nthis._attendees[ZmCalBaseItem.PERSON].add(g,null,true)\n}this._scheduleView.cleanup();\nthis._scheduleView.setComposeMode(false);\nthis._scheduleView.set(this.getDate(),a,this._attendees);\nthis._scheduleView.enablePartcipantStatusColumn(true)\n}else{this._mdAttendees=new AjxVector();\nthis.getMetadataAttendees(a)\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalListView\")){ZmCalListView=function(d,c,b,a){if(arguments.length==0){return\n}var e={parent:d,posStyle:c,controller:b,dropTgt:a,view:ZmId.VIEW_CAL_LIST,headerList:this._getHeaderList(d),pageless:true};\nZmApptListView.call(this,e);\nthis._dateSearchBar=this._createSearchBar(d);\nthis._needsRefresh=true;\nthis._timeRangeStart=0;\nthis._timeRangeEnd=0;\nthis._title=\"\"\n};\nZmCalListView.prototype=new ZmApptListView;\nZmCalListView.prototype.constructor=ZmCalListView;\nZmCalListView.DEFAULT_CALENDAR_PERIOD=AjxDateUtil.MSEC_PER_DAY*14;\nZmCalListView.DEFAULT_SEARCH_PERIOD=AjxDateUtil.MSEC_PER_DAY*400;\nZmCalListView.prototype.toString=function(){return\"ZmCalListView\"\n};\nZmCalListView.prototype.getTimeRange=function(){return{start:this._timeRangeStart,end:this._timeRangeEnd}\n};\nZmCalListView.prototype.getTitle=function(){return[ZmMsg.zimbraTitle,this.getCalTitle()].join(\": \")\n};\nZmCalListView.prototype.getCalTitle=function(){return this._title\n};\nZmCalListView.prototype.needsRefresh=function(){return this._needsRefresh\n};\nZmCalListView.prototype.setNeedsRefresh=function(a){this._needsRefresh=a\n};\nZmCalListView.prototype.createHeaderHtml=function(a){DwtListView.prototype.createHeaderHtml.call(this,a,true)\n};\nZmCalListView.prototype.getDate=function(){return this._date\n};\nZmCalListView.prototype.setDate=function(c,f,b){this._date=new Date(c.getTime());\nvar g=new Date(c.getTime());\ng.setHours(0,0,0,0);\nthis._timeRangeStart=g.getTime();\nthis._timeRangeEnd=this._timeRangeStart+ZmCalListView.DEFAULT_CALENDAR_PERIOD;\nthis._updateTitle();\nthis._segmentedDates=[];\nvar a=new Date(this._timeRangeStart);\nvar e=new Date(this._timeRangeEnd);\nthis._startDateField.setValue(AjxDateUtil.simpleComputeDateStr(a));\nthis._endDateField.setValue(AjxDateUtil.simpleComputeDateStr(e));\nthis._updateDateRange(a,e);\nif(this.isListenerRegistered(DwtEvent.DATE_RANGE)){if(!this._dateRangeEvent){this._dateRangeEvent=new DwtDateRangeEvent(true)\n}this._dateRangeEvent.item=this;\nthis._dateRangeEvent.start=new Date(this._timeRangeStart);\nthis._dateRangeEvent.end=new Date(this._timeRangeEnd);\nthis.notifyListeners(DwtEvent.DATE_RANGE,this._dateRangeEvent)\n}};\nZmCalListView.prototype.getRollField=function(){return AjxDateUtil.TWO_WEEKS\n};\nZmCalListView.prototype._fanoutAllDay=function(a){return false\n};\nZmCalListView.prototype._apptSelected=function(){};\nZmCalListView.prototype._updateTitle=function(){var b=DwtCalendar.getDayFormatter();\nvar c=new Date(this._timeRangeStart);\nvar a=new Date(this._timeRangeEnd);\nthis._title=[b.format(c),\" - \",b.format(a)].join(\"\")\n};\nZmCalListView.prototype._updateDateRange=function(a,b){var c=[AjxDateUtil._getMonthName(a,true),a.getDate(),AjxDateUtil._getMonthName(b,true),b.getDate()];\nthis._dateRangeField.innerHTML=AjxMessageFormat.format(ZmMsg.viewCalListDateRange,c)\n};\nZmCalListView.prototype.addTimeSelectionListener=function(a){};\nZmCalListView.prototype.addDateRangeListener=function(a){this.addListener(DwtEvent.DATE_RANGE,a)\n};\nZmCalListView.prototype.addViewActionListener=function(a){};\nZmCalListView.prototype.setBounds=function(b,d,c,a){if(this._dateSearchBar){this._dateSearchBar.setBounds(b,d,c,33);\nZmListView.prototype.setBounds.call(this,b,d+33,c,a-33)\n}else{ZmListView.prototype.setBounds.apply(this,arguments)\n}};\nZmCalListView.prototype.setLocation=function(a,b){if(this._dateSearchBar&&a==Dwt.LOC_NOWHERE){this._dateSearchBar.setLocation(a,b)\n}ZmApptListView.prototype.setLocation.call(this,a,b)\n};\nZmCalListView.prototype.setVisible=function(a){if(this._dateSearchBar){this._dateSearchBar.setVisible(a)\n}ZmApptListView.prototype.setVisible.apply(this,arguments)\n};\nZmCalListView.prototype._mouseOverAction=function(i,a){DwtListView.prototype._mouseOverAction.call(this,i,a);\nvar c=i.target.id||a.id;\nif(!c){return true\n}var d=this._data[a.id];\nvar h=d.type;\nif(h&&h==DwtListView.TYPE_HEADER_ITEM){var b=d.index;\nvar j=this._headerList[b]._field;\nthis.setToolTipContent(\"<span>\"+this._getHeaderToolTip(j,b)+\"</span>\")\n}else{var l=this.getItemFromElement(a);\nif(l){var e=this._parseId(c);\nif(!e){return\n}this.setToolTipContent(this._getToolTip({field:e.field,item:l,ev:i,div:a,match:e}));\nif(e.field!=ZmItem.F_SELECTION&&e.field!=ZmItem.F_TAG&&l.getToolTip){if(l.otherAttendees&&(l.ptstHashMap==null)){var g=ZmAppt.quickClone(l);\nvar f=this._currentMouseOverApptId=g.getUniqueId();\nvar k=new AjxCallback(null,ZmApptViewHelper.refreshApptTooltip,[g,this]);\nAjxTimedAction.scheduleAction(new AjxTimedAction(this,this.getApptDetails,[g,k,f]),2000)\n}}}}return true\n};\nZmCalListView.prototype.getApptDetails=function(b,c,a){if(this._currentMouseOverApptId&&this._currentMouseOverApptId==a){this._currentMouseOverApptId=null;\nb.getDetails(null,c,null,null,true)\n}};\nZmCalListView.prototype._createSearchBar=function(b){var d=this._htmlElId;\nvar c=new DwtComposite({parent:b,className:\"ZmCalListViewSearchBar\",posStyle:DwtControl.ABSOLUTE_STYLE});\nc.getHtmlElement().innerHTML=AjxTemplate.expand(\"calendar.Calendar#ListViewSearchBar\",d);\nvar a=new DwtMessageComposite({parent:c,parentElement:Dwt.byId(d+\"_searchBarControls\"),format:ZmMsg.showApptsFromThrough,controlCallback:this._createSearchBarComponent.bind(this)});\nthis._dateRangeField=document.getElementById(d+\"_searchBarDate\");\nthis._makeFocusable(this._dateRangeField);\nreturn c\n};\nZmCalListView.prototype._getSearchBarTabGroup=function(){if(!this._dateSearchBarTabGroup){var a=this._dateSearchBarTabGroup=new DwtTabGroup(\"ZmCalListView search\");\na.addMember([this._dateSearchBar.getChild(0).getTabGroupMember(),this._dateRangeField])\n}return this._dateSearchBarTabGroup\n};\nZmCalListView.prototype._createSearchBarComponent=function(a,j,e){var b=j.getIndex()==0;\nvar d=this._htmlElId;\nvar h=b?\"_start\":\"_end\";\nvar l=new DwtToolBar({parent:a});\nvar n=[d,h,\"DateInput\"].join(\"\");\nvar m=new DwtInputField({id:n,parent:l});\nDwt.setHandler(m.getInputElement(),DwtEvent.ONCHANGE,this._onDatesChange.bind(this,b));\nvar g=new AjxListener(this,this._dateButtonListener);\nvar c=new AjxListener(this,this._dateCalSelectionListener);\nvar k=[d,h,\"MiniCal\"].join(\"\");\nvar f=ZmCalendarApp.createMiniCalButton(l,k,g,c,false);\nif(b){this._startDateField=m;\nthis._startDateField.setToolTipContent(ZmMsg.startDate);\nthis._startDateButton=f\n}else{this._endDateField=m;\nthis._endDateField.setToolTipContent(ZmMsg.endDate);\nthis._endDateButton=f\n}return l\n};\nZmCalListView.prototype._dateButtonListener=function(b){var e=b.item==this._startDateButton?AjxDateUtil.simpleParseDateStr(this._startDateField.getValue()):AjxDateUtil.simpleParseDateStr(this._endDateField.getValue());\nif(isNaN(e)){e=new Date();\nvar d=b.item==this._startDateButton?this._startDateField:this._endDateField;\nd.setValue(AjxDateUtil.simpleComputeDateStr(e))\n}var f=b.item.getMenu();\nvar c=f.getItem(0);\nc.setDate(e,true);\nb.item.popup();\nif(AjxEnv.isIE){var a=f.getSize();\nf.setSize(a.x+12,a.y+12);\nf.getHtmlElement().style.width=\"180px\"\n}};\nZmCalListView.prototype._dateCalSelectionListener=function(a){var c=a.item.parent.parent;\nvar b=(c==this._startDateButton)?this._startDateField:this._endDateField;\nb.setValue(AjxDateUtil.simpleComputeDateStr(a.detail));\nthis._handleDateChange(c==this._startDateButton)\n};\nZmCalListView.prototype._handleDateChange=function(c){var e=AjxDateUtil.simpleParseDateStr(this._startDateField.getValue());\nvar a=AjxDateUtil.simpleParseDateStr(this._endDateField.getValue());\nvar d=e.getTime();\nvar b=a.getTime()+AjxDateUtil.MSEC_PER_DAY;\nif(c&&d>=b){b=d+AjxDateUtil.MSEC_PER_DAY;\na=new Date(b);\nthis._endDateField.setValue(AjxDateUtil.simpleComputeDateStr(a))\n}else{if(b<=d){d=a.getTime()-AjxDateUtil.MSEC_PER_DAY;\ne=new Date(d);\nthis._startDateField.setValue(AjxDateUtil.simpleComputeDateStr(e))\n}}this._timeRangeStart=d;\nthis._timeRangeEnd=b;\nthis._updateDateRange(e,a);\nthis._updateTitle();\nthis._segmentedDates=[];\nthis._segmentDates(d,b);\nthis.set((new AjxVector()),null,true);\nthis._search()\n};\nZmCalListView.prototype._segmentDates=function(d,b){var a=d;\nvar c=d+ZmCalListView.DEFAULT_SEARCH_PERIOD;\nif(c>b){c=b\n}do{this._segmentedDates.push({startTime:a,endTime:c});\na+=ZmCalListView.DEFAULT_SEARCH_PERIOD;\nvar e=c+ZmCalListView.DEFAULT_SEARCH_PERIOD;\nc=(e>b)?b:e\n}while(a<b)\n};\nZmCalListView.prototype._search=function(){var a=this._segmentedDates.shift();\nvar b={start:a.startTime,end:a.endTime,folderIds:this._controller.getCheckedCalendarFolderIds(),callback:(new AjxCallback(this,this._handleSearchResponse)),noBusyOverlay:true,query:this._controller._userQuery};\nthis._controller.apptCache.getApptSummaries(b)\n};\nZmCalListView.prototype._handleSearchResponse=function(a){this.addItems(a.getArray());\nDwt.setTitle(this.getTitle());\nif(this._segmentedDates.length>0&&this._getItemsNeeded(true)>0){this._search()\n}};\nZmCalListView.prototype.handleActionPopdown=function(a){};\nZmCalListView.prototype.addItems=function(a){if(AjxUtil.isArray(a)){if(!this._list){this._list=new AjxVector()\n}if(this._list.size()==0){this._resetList()\n}var f=appCtxt.get(ZmSetting.CAL_SHOW_DECLINED_MEETINGS);\nvar b=new AjxVector();\nfor(var d=0;\nd<a.length;\nd++){var e=a[d];\nif(f||(e.ptst!=ZmCalBaseItem.PSTATUS_DECLINED)){b.add(e)\n}}this._sortList(b,this._defaultSortField);\nthis._renderList(b,this._list.size()!=0,true);\nthis._list.addList(b.getArray());\nthis._resetColWidth();\nvar c=this.getSize();\nthis._listDiv.style.height=(c.y-DwtListView.HEADERITEM_HEIGHT)+\"px\"\n}};\nZmCalListView.prototype._checkItemCount=function(){if(this._segmentedDates.length>0){this._search()\n}};\nZmCalListView.prototype._onDatesChange=function(a){if(this._startDateField instanceof DwtInputField){this.validStartEnd();\nthis._handleDateChange(a);\nreturn\n}if(ZmApptViewHelper.handleDateChange(this._startDateField,this._endDateField,a)){this._handleDateChange(a)\n}};\nZmCalListView.prototype.validStartEnd=function(){var a=AjxDateUtil.simpleParseDateStr(this._startDateField.getValue());\nvar c=AjxDateUtil.simpleParseDateStr(this._endDateField.getValue());\nvar b=new Date();\nif(a==null||isNaN(a)){a=b;\nthis._startDateField.setValue(AjxDateUtil.simpleComputeDateStr(a))\n}if(c==null||isNaN(c)){c=b;\nthis._endDateField.setValue(AjxDateUtil.simpleComputeDateStr(c))\n}if((a.valueOf()>c.valueOf())){this._endDateField.setValue(AjxDateUtil.simpleComputeDateStr(a))\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmApptDeleteNotifyDialog\")){ZmApptDeleteNotifyDialog=function(b){b=Dwt.getParams(arguments,ZmApptDeleteNotifyDialog.PARAMS);\nvar a=[DwtDialog.YES_BUTTON,DwtDialog.NO_BUTTON,DwtDialog.CANCEL_BUTTON];\nDwtDialog.call(this,{parent:b.parent,standardButtons:a,id:\"CONFIRM_DELETE_APPT_DIALOG\"});\nthis._choiceLabel1=b.choiceLabel1;\nthis._choiceLabel2=b.choiceLabel2;\nthis._confirmMsg=b.confirmMsg;\nthis._choice2WarningMsg=b.choice2WarningMsg;\nthis.setTitle(b.title||AjxMsg.confirmTitle);\nthis.setContent(this._setHtml());\nthis._cacheFields();\nthis.registerCallback(DwtDialog.YES_BUTTON,new AjxCallback(this,this._handleYesButton));\nthis.registerCallback(DwtDialog.NO_BUTTON,new AjxCallback(this,this._handleNoButton))\n};\nZmApptDeleteNotifyDialog.PARAMS=[\"parent\",\"title\",\"confirmMsg\",\"choiceLabel1\",\"choiceLabel2\"];\nZmApptDeleteNotifyDialog.prototype=new DwtDialog;\nZmApptDeleteNotifyDialog.prototype.constructor=ZmApptDeleteNotifyDialog;\nZmApptDeleteNotifyDialog.prototype.toString=function(){return\"ZmApptDeleteNotifyDialog\"\n};\nZmApptDeleteNotifyDialog.prototype.initialize=function(b,a){this._appt=b;\nthis._attId=a;\nthis._defaultRadio.checked=true\n};\nZmApptDeleteNotifyDialog.prototype.getAppt=function(){return this._appt\n};\nZmApptDeleteNotifyDialog.prototype.getAttId=function(){return this._attId\n};\nZmApptDeleteNotifyDialog.prototype.isDefaultOptionChecked=function(){return this._defaultRadio.checked\n};\nZmApptDeleteNotifyDialog.prototype.addSelectionListener=function(a,b){this._button[a].addSelectionListener(b)\n};\nZmApptDeleteNotifyDialog.prototype._setHtml=function(){this._confirmMessageDivId=Dwt.getNextId();\nthis._defaultRadioId=Dwt.getNextId();\nthis._notifyChoiceName=Dwt.getNextId();\nvar b=new Array();\nvar a=0;\nb[a++]=\"<div style='width:300px;' id='\";\nb[a++]=this._confirmMessageDivId;\nb[a++]=\"'>\";\nb[a++]=this._confirmMsg;\nb[a++]=\"</div><div style='margin:1em;width:300px;'>\";\nb[a++]=\"<table class='ZRadioButtonTable'>\";\nb[a++]=\"<tr><td width=1%><input checked value='1' type='radio' id='\";\nb[a++]=this._defaultRadioId;\nb[a++]=\"' name='\";\nb[a++]=this._notifyChoiceName;\nb[a++]=\"'></td><td>\";\nb[a++]=\"<label for='\"+this._defaultRadioId+\"'>\";\nb[a++]=this._choiceLabel1;\nb[a++]=\"</label>\";\nb[a++]=\"</td></tr>\";\nb[a++]=\"<tr><td width=1%><input value='2' type='radio' id='\";\nb[a++]=this._defaultRadioId+this._notifyChoiceName;\nb[a++]=\"' name='\";\nb[a++]=this._notifyChoiceName;\nb[a++]=\"'></td><td>\";\nb[a++]=\"<label for='\"+this._defaultRadioId+this._notifyChoiceName+\"'>\";\nb[a++]=this._choiceLabel2;\nb[a++]=\"</label>\";\nb[a++]=\"</td></tr>\";\nif(this._choice2WarningMsg){b[a++]=\"<tr><td></td><td style='font-style:italic'>\"+this._choice2WarningMsg+\"</td></tr>\"\n}b[a++]=\"</table></div>\";\nreturn b.join(\"\")\n};\nZmApptDeleteNotifyDialog.prototype._cacheFields=function(){this._defaultRadio=document.getElementById(this._defaultRadioId);\ndelete this._defaultRadioId\n};\nZmApptDeleteNotifyDialog.prototype.popup=function(a,b){this._yesCallback=a;\nthis._noCallback=b;\nthis.setButtonVisible(DwtDialog.CANCEL_BUTTON,Boolean(b));\nDwtDialog.prototype.popup.call(this)\n};\nZmApptDeleteNotifyDialog.prototype._handleYesButton=function(a){if(this._yesCallback){this._yesCallback.run(a)\n}this.popdown()\n};\nZmApptDeleteNotifyDialog.prototype._handleNoButton=function(a){if(this._noCallback){this._noCallback.run(a)\n}this.popdown()\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalPrintDialog\")){ZmCalPrintDialog=function(d){var a=new DwtDialog_ButtonDescriptor(ZmCalPrintDialog.PRINT_BUTTON,ZmMsg.print,DwtDialog.ALIGN_RIGHT);\nvar c=new DwtDialog_ButtonDescriptor(ZmCalPrintDialog.PRINT_CANCEL_BUTTON,ZmMsg.cancel,DwtDialog.ALIGN_RIGHT);\nvar b=d.parent||appCtxt.getShell();\nZmDialog.call(this,{parent:b,standardButtons:[DwtDialog.NO_BUTTONS],extraButtons:[a,c]});\nthis.setButtonListener(ZmCalPrintDialog.PRINT_BUTTON,new AjxListener(this,this._printButtonListener));\nthis.setButtonListener(ZmCalPrintDialog.PRINT_CANCEL_BUTTON,new AjxListener(this,this._printCancelButtonListener));\nthis.setTitle(ZmMsg.printCalendar);\nthis.setContent(this._setHtml());\nthis._createControls();\nthis._setViewOptions()\n};\nZmCalPrintDialog.prototype=new ZmDialog;\nZmCalPrintDialog.prototype.constructor=ZmCalPrintDialog;\nZmCalPrintDialog.PRINT_BUTTON=++DwtDialog.LAST_BUTTON;\nZmCalPrintDialog.PRINT_CANCEL_BUTTON=++DwtDialog.LAST_BUTTON;\nZmCalPrintDialog.DATE_FORMAT=\"yyyyMMddTHHmmss\";\nZmCalPrintDialog.TIME_FORMAT=\"HH:mm\";\nZmCalPrintDialog.prototype.toString=function(){return\"ZmCalPrintDialog\"\n};\nZmCalPrintDialog.prototype.popup=function(h){h=h||{};\nvar b=this._treeIds=(h.treeIds&&h.treeIds.length)?h.treeIds:[ZmOrganizer.FOLDER];\nvar e={};\ne[ZmOrganizer.ID_TRASH]=true;\nvar f={treeIds:b,omit:e,fieldId:this._htmlElId+\"_calTreeContainer\",overviewId:h.overviewId,noRootSelect:h.noRootSelect,treeStyle:h.treeStyle||DwtTree.SINGLE_STYLE,appName:h.appName,selectable:false,forceSingle:h.forceSingle};\nvar g={};\nfor(var d=0;\nd<b.length;\nd++){g[b[d]]=true\n}var c=this._setOverview(f,f.forceSingle);\nZmDialog.prototype.popup.call(this);\nthis.currentViewId=h.currentViewId;\nvar a=ZmCalViewController.VIEW_TO_OP[h.currentViewId];\nif(a==ZmOperation.WORK_WEEK_VIEW){a=ZmOperation.WEEK_VIEW\n}else{if(a==ZmOperation.FB_VIEW){a=ZmOperation.DAY_VIEW\n}}this._viewSelect.setSelectedValue(a);\nthis._setViewOptions();\nthis.setWorkingHours(h.workHours);\nthis._selDate.setValue(h.currentDate);\nthis._dateRangeFrom.setValue(new Date(h.timeRange.start));\nthis._dateRangeTo.setValue(new Date(h.timeRange.end));\nif(ZmId.VIEW_CAL_WORK_WEEK==this.currentViewId){document.getElementById(this._htmlElId+\"_workDaysOnly\").checked=true\n}};\nZmCalPrintDialog.prototype.setWorkingHours=function(a){var c=new Date(),b=new Date();\nc.setHours(a.startTime[0]/100,a.startTime[0]%100,0,0);\nb.setHours(a.endTime[0]/100,a.endTime[0]%100,0,0);\nthis._fromTimeSelect.set(c);\nthis._toTimeSelect.set(b)\n};\nZmCalPrintDialog.prototype._setHtml=function(){var a=AjxTemplate.expand(\"calendar.Calendar#PrintDialog\",{id:this._htmlElId});\nreturn a\n};\nZmCalPrintDialog.prototype._createControls=function(){var b,f,d,c=document.getElementById(this._htmlElId+\"_dateRangeRadio\"),e=document.getElementById(this._htmlElId+\"_selDateRadio\"),a=AjxCallback.simpleClosure(this._setSelectedDateRadioListener,this);\nthis._selDate=new ZmDateInput(this,this._htmlElId+\"_selDate\",this._htmlElId+\"_selDateContainer\");\nthis._todayButton=new DwtButton({parent:this,parentElement:this._htmlElId+\"_todayButtonContainer\"});\nthis._todayButton.setText(ZmMsg.today);\nthis._todayButton.addSelectionListener(new AjxListener(this,this._setDateToToday));\nthis._dateRangeFrom=new ZmDateInput(this,this._htmlElId+\"_dateRangeFrom\",this._htmlElId+\"_dateRangeFromContainer\");\nthis._dateRangeTo=new ZmDateInput(this,this._htmlElId+\"_dateRangeTo\",this._htmlElId+\"_dateRangeToContainer\");\nthis._viewSelect=new DwtSelect({parent:this,parentElement:this._htmlElId+\"_printViewContainer\"});\nd=[ZmOperation.DAY_VIEW,ZmOperation.WEEK_VIEW,ZmOperation.MONTH_VIEW,ZmOperation.CAL_LIST_VIEW];\nfor(b=0;\nb<d.length;\nb++){f=ZmOperation.defineOperation(d[b]);\nthis._viewSelect.addOption(f.text,false,f.id,f.image)\n}this._viewSelect.addChangeListener(new AjxListener(this,this._setViewOptions));\nthis._fromTimeSelect=new DwtTimeInput(this,DwtTimeInput.START,this._htmlElId+\"_fromHoursContainer\");\nthis._toTimeSelect=new DwtTimeInput(this,DwtTimeInput.END,this._htmlElId+\"_toHoursContainer\");\nthis._printErrorMsgContainer=document.getElementById(this._htmlElId+\"_printErrorMsgContainer\");\nc.onclick=a;\ne.onclick=a\n};\nZmCalPrintDialog.prototype._setSelectedDateRadioListener=function(a){var b=DwtUiEvent.getTarget(a);\nif(b.id==this._htmlElId+\"_selDateRadio\"){this._setSelectedDateEnabled(true)\n}else{this._setSelectedDateEnabled(false)\n}};\nZmCalPrintDialog.prototype._setDateToToday=function(a){var b=new Date();\nthis._selDate.setValue(b)\n};\nZmCalPrintDialog.prototype._setSelectedDateEnabled=function(a){var b=document.getElementById(this._htmlElId+\"_dateRangeRadio\"),c=document.getElementById(this._htmlElId+\"_selDateRadio\");\nif(a){this._dateRangeFrom.setEnabled(false);\nthis._dateRangeTo.setEnabled(false);\nb.checked=false;\nthis._selDate.setEnabled(true);\nthis._todayButton.setEnabled(true);\nc.checked=true\n}else{this._dateRangeFrom.setEnabled(true);\nthis._dateRangeTo.setEnabled(true);\nb.checked=true;\nthis._selDate.setEnabled(false);\nthis._todayButton.setEnabled(false);\nc.checked=false\n}};\nZmCalPrintDialog.prototype._validateDateTime=function(e){var d=document.getElementById(this._htmlElId+\"_hoursContainer\"),g=false;\nif(this._selDate.getEnabled()){g=this._selDate.getValue()\n}else{if(this._dateRangeFrom.getEnabled()&&this._dateRangeTo.getEnabled()){var a=this._dateRangeFrom.getTimeValue();\nvar f=this._dateRangeTo.getTimeValue();\ng=a&&f&&f>=a\n}}if(g&&Dwt.getVisible(d)){var c=this._fromTimeSelect.getValue();\nvar b=this._toTimeSelect.getValue();\nif(b<c){g=false\n}}if(!g){Dwt.setDisplay(this._printErrorMsgContainer,Dwt.DISPLAY_BLOCK);\nthis._printErrorMsgContainer.innerHTML=ZmMsg.errorInvalidDates\n}return g\n};\nZmCalPrintDialog.prototype._setViewOptions=function(f){var g=this._viewSelect.getValue();\nvar d=document.getElementById(this._htmlElId+\"_workDaysOnlyContainer\");\nvar c=document.getElementById(this._htmlElId+\"_oneWeekPerPageContainer\");\nvar a=document.getElementById(this._htmlElId+\"_oneDayPerPageContainer\");\nvar b=document.getElementById(this._htmlElId+\"_includeMiniCalContainer\");\nvar e=document.getElementById(this._htmlElId+\"_hoursContainer\");\nDwt.setDisplay(b,Dwt.DISPLAY_BLOCK);\nDwt.setDisplay(e,Dwt.DISPLAY_BLOCK);\nthis._resetCheckboxes(false);\nswitch(g){case ZmOperation.FB_VIEW:case ZmOperation.DAY_VIEW:Dwt.setDisplay(d,Dwt.DISPLAY_NONE);\nDwt.setDisplay(c,Dwt.DISPLAY_NONE);\nDwt.setDisplay(a,Dwt.DISPLAY_BLOCK);\nthis._setSelectedDateEnabled(true);\nbreak;\ncase ZmOperation.WORK_WEEK_VIEW:case ZmOperation.WEEK_VIEW:Dwt.setDisplay(d,Dwt.DISPLAY_BLOCK);\nDwt.setDisplay(c,Dwt.DISPLAY_BLOCK);\nDwt.setDisplay(a,Dwt.DISPLAY_NONE);\nthis._setSelectedDateEnabled(false);\nbreak;\ncase ZmOperation.MONTH_VIEW:Dwt.setDisplay(d,Dwt.DISPLAY_BLOCK);\nDwt.setDisplay(c,Dwt.DISPLAY_NONE);\nDwt.setDisplay(a,Dwt.DISPLAY_NONE);\nDwt.setDisplay(e,Dwt.DISPLAY_NONE);\nthis._setSelectedDateEnabled(false);\nbreak;\ncase ZmOperation.CAL_LIST_VIEW:Dwt.setDisplay(d,Dwt.DISPLAY_NONE);\nDwt.setDisplay(c,Dwt.DISPLAY_NONE);\nDwt.setDisplay(a,Dwt.DISPLAY_NONE);\nDwt.setDisplay(e,Dwt.DISPLAY_NONE);\nthis._setSelectedDateEnabled(false);\nbreak\n}};\nZmCalPrintDialog.prototype._printCancelButtonListener=function(){this.popdown()\n};\nZmCalPrintDialog.prototype._printButtonListener=function(){if(!this._validateDateTime()){return false\n}var a=this._getPrintOptions();\nthis.popdown();\nwindow.open(a,\"_blank\")\n};\nZmCalPrintDialog.prototype.popdown=function(){Dwt.setDisplay(this._printErrorMsgContainer,Dwt.DISPLAY_NONE);\nthis._resetCheckboxes(false);\nDwtDialog.prototype.popdown.call(this)\n};\nZmCalPrintDialog.prototype._resetCheckboxes=function(a){document.getElementById(this._htmlElId+\"_workDaysOnly\").checked=a;\ndocument.getElementById(this._htmlElId+\"_oneWeekPerPage\").checked=a;\ndocument.getElementById(this._htmlElId+\"_oneDayPerPage\").checked=a;\ndocument.getElementById(this._htmlElId+\"_includeMiniCal\").checked=a\n};\nZmCalPrintDialog.prototype._getPrintViewName=function(a){var b;\nswitch(a){case ZmId.VIEW_CAL_DAY:b=\"day\";\nbreak;\ncase ZmId.VIEW_CAL_WORK_WEEK:b=\"workWeek\";\nbreak;\ncase ZmId.VIEW_CAL_WEEK:b=\"week\";\nbreak;\ncase ZmId.VIEW_CAL_LIST:b=\"list\";\nbreak;\ndefault:b=\"month\";\nbreak\n}return b\n};\nZmCalPrintDialog.prototype._getPrintOptions=function(){var k,u=[],g,n=0,l=0,s=[],r=\"\",e=this._selDate.getEnabled()?this._selDate.getValue():\"\",c=this._dateRangeFrom.getEnabled()?this._dateRangeFrom.getValue():new Date(e.getTime()),h=this._dateRangeTo.getEnabled()?this._dateRangeTo.getValue():new Date(e.getTime()),v=AjxDateFormat.format(ZmCalPrintDialog.TIME_FORMAT,this._fromTimeSelect.getValue()),f=AjxDateFormat.format(ZmCalPrintDialog.TIME_FORMAT,this._toTimeSelect.getValue()),b=ZmCalViewController.OP_TO_VIEW[this._viewSelect.getValue()],q=this._getPrintViewName(b),d=document.getElementById(this._htmlElId+\"_workDaysOnly\").checked,p=document.getElementById(this._htmlElId+\"_oneWeekPerPage\").checked,t=document.getElementById(this._htmlElId+\"_oneDayPerPage\").checked,a=document.getElementById(this._htmlElId+\"_includeMiniCal\").checked,g=this._opc.getOverview(this._curOverviewId).getTreeView(ZmOrganizer.CALENDAR);\nk=g.getSelected();\nfor(l=0;\nl<k.length;\nl++){u.push(k[l].id)\n}if(b==ZmId.VIEW_CAL_MONTH){var o=AjxDateUtil._daysPerMonth[h.getMonth()];\nif(h.getMonth()==\"1\"&&!AjxDateUtil.isLeapYear(h.getYear())){o=\"28\"\n}h.setDate(o);\nc.setDate(1)\n}else{if(b==ZmId.VIEW_CAL_WEEK||b==ZmId.VIEW_CAL_WORK_WEEK){var m=appCtxt.get(ZmSetting.CAL_FIRST_DAY_OF_WEEK)||0;\nc=AjxDateUtil.getFirstDayOfWeek(c,m);\nh=AjxDateUtil.getLastDayOfWeek(h,m)\n}}h.setHours(23,59,59,999);\nc=AjxDateFormat.format(ZmCalPrintDialog.DATE_FORMAT,c);\nh=AjxDateFormat.format(ZmCalPrintDialog.DATE_FORMAT,h);\ns[n++]=\"/h/printcalendar?\";\ns[n++]=\"l=\";\ns[n++]=u.join(\",\");\ns[n++]=\"&origView=\";\ns[n++]=this._getPrintViewName(this.currentViewId);\ns[n++]=\"&view=\";\ns[n++]=q;\ns[n++]=\"&date=\";\ns[n++]=c;\ns[n++]=\"&endDate=\";\ns[n++]=h;\ns[n++]=\"&ft=\";\ns[n++]=v;\ns[n++]=\"&tt=\";\ns[n++]=f;\ns[n++]=\"&wd=\";\ns[n++]=d;\ns[n++]=\"&ow=\";\ns[n++]=p;\ns[n++]=\"&od=\";\ns[n++]=t;\ns[n++]=\"&imc=\";\ns[n++]=a;\ns[n++]=\"&wdays=\";\ns[n++]=d?ZmCalPrintDialog.encodeWorkingDays():\"\";\ns[n++]=\"&tz=\";\ns[n++]=AjxTimezone.getServerId(AjxTimezone.DEFAULT);\ns[n++]=\"&skin=\";\ns[n++]=appCurrentSkin;\nr=appContextPath+s.join(\"\");\nreturn r\n};\nZmCalPrintDialog.encodeWorkingDays=function(){var c=ZmCalBaseView.parseWorkingHours(ZmCalBaseView.getWorkingHours()),b=[];\nfor(var a=0;\na<c.length;\na++){if(c[a].isWorkingDay){b.push(a)\n}}return b.join(\",\")\n};\nZmDateInput=function(b,c,a){if(arguments.length==0){return\n}DwtComposite.call(this,{parent:b,className:\"ZmDateInput\",parentElement:a});\nthis.id=c||Dwt.getNextId();\nthis._setHtml(c)\n};\nZmDateInput.prototype=new DwtComposite;\nZmDateInput.prototype.constructor=ZmDateInput;\nZmDateInput.prototype.getValue=function(){var a=\"\";\nif(this.getEnabled()){a=AjxDateUtil.simpleParseDateStr(this._dateInputField.getValue())\n}return a\n};\nZmDateInput.prototype.getTimeValue=function(){var a=this.getEnabled()&&AjxDateUtil.simpleParseDateStr(this._dateInputField.getValue());\nreturn a?a.getTime():null\n};\nZmDateInput.prototype.setValue=function(a){this._dateInputField.setValue(AjxDateUtil.simpleComputeDateStr(a))\n};\nZmDateInput.prototype.setEnabled=function(a){this._dateInputField.setEnabled(a);\nthis._dateButton.setEnabled(a)\n};\nZmDateInput.prototype.getEnabled=function(a){return this._dateInputField.getEnabled()&&this._dateButton.getEnabled()\n};\nZmDateInput.prototype._setHtml=function(e){var b=new AjxListener(this,this._dateButtonListener),c=new AjxListener(this,this._dateCalSelectionListener);\nthis.getHtmlElement().innerHTML=AjxTemplate.expand(\"calendar.Appointment#ApptTimeInput\",{id:this._htmlElId});\nthis._dateButton=ZmCalendarApp.createMiniCalButton(this.parent,this._htmlElId+\"_timeSelectBtn\",b,c);\nthis._dateButton.setSize(\"20\");\nvar d={parent:this,parentElement:(this._htmlElId+\"_timeSelectInput\"),type:DwtInputField.STRING,errorIconStyle:DwtInputField.ERROR_ICON_NONE,validationStyle:DwtInputField.CONTINUAL_VALIDATION,inputId:e};\nthis._dateInputField=new DwtInputField(d);\nvar a=this._dateInputField.getInputElement();\nDwt.setSize(a,\"80px\",\"2rem\");\na.typeId=this.id\n};\nZmDateInput.prototype._dateButtonListener=function(a){var c,d,b=AjxDateUtil.simpleParseDateStr(this._dateInputField.getValue());\nif(isNaN(b)){b=new Date();\nthis._dateInputField.setValue(AjxDateUtil.simpleComputeDateStr(b))\n}d=a.item.getMenu();\nc=d.getItem(0);\nc.setDate(b,true);\na.item.popup()\n};\nZmDateInput.prototype._dateCalSelectionListener=function(b){var a=AjxDateUtil.simpleComputeDateStr(b.detail);\nthis._dateInputField.setValue(a)\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmCalItemView\")){ZmCalItemView=function(c,b,a,d){if(arguments.length==0){return\n}params={parent:c,posStyle:b,controller:a};\nif(d){params.id=d\n}ZmMailMsgView.call(this,params)\n};\nZmCalItemView.prototype=new ZmMailMsgView;\nZmCalItemView.prototype.constructor=ZmCalItemView;\nZmCalItemView.prototype.isZmCalItemView=true;\nZmCalItemView.prototype.toString=function(){return\"ZmCalItemView\"\n};\nZmCalItemView.prototype.getController=function(){return this._controller\n};\nZmCalItemView.prototype.getSelection=function(){return[this._calItem]\n};\nZmCalItemView.prototype.getSelectionCount=function(){return 1\n};\nZmCalItemView.prototype.needsRefresh=function(){return false\n};\nZmCalItemView.prototype.addSelectionListener=function(){};\nZmCalItemView.prototype.addActionListener=function(){};\nZmCalItemView.prototype.handleActionPopdown=function(a){};\nZmCalItemView.prototype.getTitle=function(){};\nZmCalItemView.prototype.set=function(a,b,c){if(this._calItem==a){return\n}var d=this._controller._viewMgr;\nthis._prevView=b||(d&&(a.folderId!=ZmFolder.ID_TRASH)?d.getCurrentViewName():this._prevView);\nthis.reset();\nthis._calItem=this._item=a;\nthis._mode=c;\nthis._renderCalItem(a,true)\n};\nZmCalItemView.prototype.reset=function(){ZmMailMsgView.prototype.reset.call(this);\nthis._calItem=this._item=null\n};\nZmCalItemView.prototype.close=function(){};\nZmCalItemView.prototype.move=function(){};\nZmCalItemView.prototype.changeReminder=function(){};\nZmCalItemView.prototype._renderCalItem=function(h,m){this._lazyCreateObjectManager();\nvar f=this._getSubs(h);\nvar o=this._htmlElId+\"_closeBtnCell\";\nvar b=this._htmlElId+\"_editBtnCell\";\nthis._hdrTableId=this._htmlElId+\"_hdrTable\";\nvar g=h.getFolder();\nvar l=g.isReadOnly();\nf.allowEdit=!l&&(appCtxt.get(ZmSetting.CAL_APPT_ALLOW_ATTENDEE_EDIT)||h.isOrg);\nvar c=this.getHtmlElement();\nc.innerHTML=AjxTemplate.expand(\"calendar.Appointment#ReadOnlyView\",f);\nvar e=appCtxt.webClientOfflineHandler;\nif(e){var k=[ZmCalItem.ATT_LINK_IMAGE,ZmCalItem.ATT_LINK_MAIN,ZmCalItem.ATT_LINK_DOWNLOAD];\nvar j=this._getAttachmentLinkId.bind(this);\ne._handleAttachmentsForOfflineMode(h.getAttachments(),j,k)\n}if(m){this._closeButton=new DwtButton({parent:this,className:\"DwtToolbarButton\"});\nthis._closeButton.setImage(\"Close\");\nthis._closeButton.setText(ZmMsg.close);\nthis._closeButton.addSelectionListener(new AjxListener(this,this.close));\nthis._closeButton.reparentHtmlElement(o);\nif(document.getElementById(b)){this._editButton=new DwtButton({parent:this,className:\"DwtToolbarButton\"});\nthis._editButton.setImage(\"Edit\");\nthis._editButton.setText(ZmMsg.edit);\nthis._editButton.addSelectionListener(new AjxListener(this,this.edit));\nvar g=h&&appCtxt.getById(h.folderId);\nvar n=g&&g.id==ZmOrganizer.ID_TRASH;\nthis._editButton.setEnabled(!n);\nthis._editButton.reparentHtmlElement(b)\n}}var a=(h.notesTopPart&&h.notesTopPart.getContentType()==ZmMimeTable.MULTI_ALT);\nvar i=(a&&appCtxt.get(ZmSetting.VIEW_AS_HTML))?ZmMimeTable.TEXT_HTML:ZmMimeTable.TEXT_PLAIN;\nvar d=h.getNotesPart(i);\nif(d){this._msg=this._msg||this._calItem._currentlyLoaded;\nif(i===ZmMimeTable.TEXT_PLAIN){d=AjxStringUtil.convertToHtml(d)\n}this._makeIframeProxy({container:c,html:d,isTextMsg:(i==ZmMimeTable.TEXT_PLAIN)})\n}};\nZmCalItemView.prototype._getSubs=function(a){};\nZmCalItemView.prototype._getTimeString=function(a){};\nZmCalItemView.prototype._setAttachmentLinks=function(){};\nZmCalItemView.prototype._isOneDayAppt=function(c,b){var d=new Date(c.getTime());\nvar a=new Date(b.getTime());\nd.setHours(0,0,0,0);\na.setHours(0,0,0,0);\nreturn d.valueOf()==a.valueOf()\n};\nZmCalItemView.prototype._getAttachString=function(a){var f=[];\nvar d=0;\nvar c=a.getAttachments();\nif(c){var b=this._getAttachmentLinkId.bind(this);\nfor(var e=0;\ne<c.length;\ne++){f[d++]=ZmApptViewHelper.getAttachListHtml(a,c[e],false,b)\n}}return f.join(\"\")\n};\nZmCalItemView.rfc822Callback=function(a,b){AjxDispatcher.require(\"MailCore\",false);\nZmMailMsgView.rfc822Callback(a,b)\n};\nZmApptView=function(c,b,a){ZmCalItemView.call(this,c,b,a)\n};\nZmApptView.prototype=new ZmCalItemView;\nZmApptView.prototype.constructor=ZmApptView;\nZmApptView.prototype.isZmApptView=true;\nZmApptView.prototype.toString=function(){return\"ZmApptView\"\n};\nZmApptView.prototype.getTitle=function(){return[ZmMsg.zimbraTitle,ZmMsg.appointment].join(\": \")\n};\nZmApptView.prototype.edit=function(c){var b=this._calItem;\nif(!b.isOrg&&!(this._editWarningDialog&&this._editWarningDialog.isPoppedUp())){var a=this._editWarningDialog=appCtxt.getMsgDialog();\na.setMessage(ZmMsg.attendeeEditWarning,DwtMessageDialog.WARNING_STYLE);\na.popup();\na.registerCallback(DwtDialog.OK_BUTTON,this.edit,this);\nreturn\n}else{if(this._editWarningDialog){this._editWarningDialog.popdown();\nthis._editWarningDialog.reset()\n}}var e=ZmCalItem.MODE_EDIT;\nif(b.isRecurring()){e=this._mode||ZmCalItem.MODE_EDIT_SINGLE_INSTANCE\n}b.setViewMode(e);\nvar d=this._controller._app;\nd.getApptComposeController().show(b,e)\n};\nZmApptView.prototype.setBounds=function(b,d,c,a){ZmMailMsgView.prototype.setBounds.call(this,b,d,Dwt.DEFAULT,a)\n};\nZmApptView.prototype._renderCalItem=function(o){this._lazyCreateObjectManager();\nvar p=this._getSubs(o);\np.subject=AjxStringUtil.htmlEncode(p.subject);\np.location=AjxStringUtil.htmlEncode(p.location);\nthis._hdrTableId=this._htmlElId+\"_hdrTable\";\nvar m=o.getFolder();\nvar k=m.isReadOnly()||m.isInTrash();\np.allowEdit=!k&&(appCtxt.get(ZmSetting.CAL_APPT_ALLOW_ATTENDEE_EDIT)||o.isOrg);\nvar b=this.getHtmlElement();\nb.innerHTML=AjxTemplate.expand(\"calendar.Appointment#ReadOnlyView\",p);\nvar n=appCtxt.webClientOfflineHandler;\nif(n){var e=[ZmCalItem.ATT_LINK_IMAGE,ZmCalItem.ATT_LINK_MAIN,ZmCalItem.ATT_LINK_DOWNLOAD];\nvar l=this._getAttachmentLinkId.bind(this);\nn._handleAttachmentsForOfflineMode(o.getAttachments(),l,e)\n}var g=AjxStringUtil.trim(o.getName());\nif(g){var f=g.substring(0,ZmAppViewMgr.TAB_BUTTON_MAX_TEXT);\nappCtxt.getAppViewMgr().setTabTitle(this._controller.getCurrentViewId(),f)\n}this._createBubbles();\nvar d={parent:this,id:Dwt.getNextId(\"ZmNeedActionSelect_\")};\nvar h=new DwtSelect(d);\nvar j={};\nj[ZmCalBaseItem.PSTATUS_NEEDS_ACTION]=ZmMsg.ptstMsgNeedsAction;\nj[ZmCalBaseItem.PSTATUS_ACCEPT]=ZmMsg.ptstMsgAccepted;\nj[ZmCalBaseItem.PSTATUS_TENTATIVE]=ZmMsg.ptstMsgTentative;\nj[ZmCalBaseItem.PSTATUS_DECLINED]=ZmMsg.ptstMsgDeclined;\nthis._ptst=j;\nvar c=o.ptst||ZmCalBaseItem.PSTATUS_ACCEPT;\nvar s=null;\nfor(var q in j){if(q===ZmCalBaseItem.PSTATUS_NEEDS_ACTION&&c!==ZmCalBaseItem.PSTATUS_NEEDS_ACTION){continue\n}s=new DwtSelectOptionData(q,ZmCalItem.getLabelForParticipationStatus(q),false,null,ZmCalItem.getParticipationStatusIcon(q),Dwt.getNextId(\"ZmNeedActionOption_\"+q+\"_\"));\nh.addOption(s);\nif(q==c){h.setSelectedValue(q)\n}}if(k){h.setEnabled(false)\n}this._statusSelect=h;\nthis._origPtst=c;\nh.reparentHtmlElement(this._htmlElId+\"_responseActionSelectCell\");\nh.addChangeListener(new AjxListener(this,this._statusSelectListener));\nthis._statusMsgEl=document.getElementById(this._htmlElId+\"_responseActionMsgCell\");\nthis._statusMsgEl.innerHTML=j[c];\nvar r=(o.notesTopPart&&o.notesTopPart.getContentType()==ZmMimeTable.MULTI_ALT);\nvar i=(r&&appCtxt.get(ZmSetting.VIEW_AS_HTML))?ZmMimeTable.TEXT_HTML:ZmMimeTable.TEXT_PLAIN;\nvar a=o.getNotesPart(i);\nif(a){this._msg=this._msg||this._calItem._currentlyLoaded;\nif(i===ZmMimeTable.TEXT_PLAIN){a=AjxStringUtil.convertToHtml(a)\n}this._makeIframeProxy({container:b,html:a,isTextMsg:(i==ZmMimeTable.TEXT_PLAIN)})\n}};\nZmApptView.prototype._getSubs=function(h){var k=h.getName();\nvar p=h.location;\nvar j=h.getAttendeesText(ZmCalBaseItem.EQUIPMENT,true);\nvar d=h._orig.isException;\nvar e=this._getTimeString(h);\nthis._clearBubbles();\nvar c=this._getAttendeesByRoleCollapsed(h.getAttendees(ZmCalBaseItem.PERSON),ZmCalBaseItem.PERSON,ZmCalItem.ROLE_REQUIRED);\nvar a=this._getAttendeesByRoleCollapsed(h.getAttendees(ZmCalBaseItem.PERSON),ZmCalBaseItem.PERSON,ZmCalItem.ROLE_OPTIONAL);\nvar f=c||a;\nvar m,b;\nvar i=h.isRecurring()?h.getRecurBlurb():null;\nvar l=this._getAttachString(h);\nif(f){m=new AjxEmailAddress(h.getOrganizer(),null,h.getOrganizerName());\nvar g=h.message.getAddress(AjxEmailAddress.SENDER);\nvar o=h.message.getAddress(AjxEmailAddress.FROM);\nvar n=g||o;\nif(!m&&n){m=n.toString()\n}if(g&&m){b=o?new AjxEmailAddress(o.toString()):m\n}}m=m&&this._getBubbleHtml(m);\nb=b&&this._getBubbleHtml(b);\nreturn{id:this._htmlElId,subject:k,location:p,equipment:j,isException:d,dateStr:e,isAttendees:f,reqAttendees:c,optAttendees:a,org:m,obo:b,recurStr:i,attachStr:l,folder:appCtxt.getTree(ZmOrganizer.CALENDAR).getById(h.folderId),folderLabel:ZmMsg.calendar,reminderLabel:ZmMsg.reminder,alarm:h.alarm,isAppt:true,_infoBarId:this._infoBarId}\n};\nZmApptView.prototype._getAttendeesByRoleCollapsed=function(f,g,c){if(!(f&&f.length)){return\"\"\n}var a=ZmApptViewHelper.getAttendeesArrayByRole(f,c);\nvar e=[];\nfor(var d=0;\nd<a.length;\nd++){var h=a[d];\ne.push(new AjxEmailAddress(h.getEmail(),g,h.getFullName(),h.getFullName(),h.isGroup(),h.canExpand))\n}var j={};\nj.shortAddress=appCtxt.get(ZmSetting.SHORT_ADDRESS);\nvar b=this.getAddressesFieldHtmlHelper(e,j,c);\nreturn b.html\n};\nZmApptView.prototype._getTimeString=function(e){var k=e._orig.startDate;\nvar h=e._orig.endDate;\nvar d=TzMsg[AjxTimezone.DEFAULT]||AjxTimezone.getServerId(AjxTimezone.DEFAULT);\nif(e.isRecurring()&&this._mode==ZmCalItem.MODE_EDIT_SERIES){k=e.startDate;\nh=e.endDate;\nvar f=e.getTimezone();\nif(f!=AjxTimezone.getServerId(AjxTimezone.DEFAULT)){var b=AjxTimezone.getOffset(AjxTimezone.DEFAULT,k);\nvar a=AjxTimezone.getOffset(AjxTimezone.getClientId(f),k);\nk.setTime(k.getTime()+(b-a)*60*1000);\nh.setTime(h.getTime()+(b-a)*60*1000);\ne.setTimezone(AjxTimezone.getServerId(AjxTimezone.DEFAULT))\n}}var i=e.isAllDayEvent();\nvar l=e.isMultiDay();\nif(i&&l){var g=new Date(h.getTime());\nh.setDate(g.getDate()-1)\n}var j=i?(l?ZmMsg.apptTimeAllDayMulti:ZmMsg.apptTimeAllDay):(l?ZmMsg.apptTimeInstanceMulti:ZmMsg.apptTimeInstance);\nvar c=[k,h,d];\nreturn AjxMessageFormat.format(j,c)\n};\nZmApptView.prototype.set=function(a,b){this.reset();\nthis._calItem=this._item=a;\nthis._mode=b;\nthis._renderCalItem(a,false)\n};\nZmApptView.prototype.reEnableDesignMode=function(){};\nZmApptView.prototype.isDirty=function(){var b=false,a=this._statusSelect.getValue();\nif(this._origPtst!=a){b=true\n}return b\n};\nZmApptView.prototype.isValid=function(){return true\n};\nZmApptView.prototype.setOrigPtst=function(a){this._origPtst=a;\nthis._statusSelectListener()\n};\nZmApptView.prototype.cleanup=function(){return false\n};\nZmApptView.prototype.close=function(){this._controller._closeView()\n};\nZmApptView.prototype.getOpValue=function(){var b=this._statusSelect.getValue(),a={};\na[ZmCalBaseItem.PSTATUS_NEEDS_ACTION]=null;\na[ZmCalBaseItem.PSTATUS_ACCEPT]=ZmOperation.REPLY_ACCEPT;\na[ZmCalBaseItem.PSTATUS_TENTATIVE]=ZmOperation.REPLY_TENTATIVE;\na[ZmCalBaseItem.PSTATUS_DECLINED]=ZmOperation.REPLY_DECLINE;\nreturn a[b]\n};\nZmApptView.prototype._statusSelectListener=function(){var b=this.getController().getCurrentToolbar().getButton(ZmOperation.SAVE),a=this._statusSelect.getValue();\nb.setEnabled(this._origPtst!=a);\nthis._statusMsgEl.innerHTML=this._ptst[a]\n};\nZmApptView.prototype._getDialogXY=function(){var a=Dwt.toWindow(this.getHtmlElement(),0,0);\nreturn new DwtPoint(a.x+ZmApptComposeView.DIALOG_X,a.y+ZmApptComposeView.DIALOG_Y)\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.controller.ZmCalendarTreeController\")){ZmCalendarTreeController=function(){ZmTreeController.call(this,ZmOrganizer.CALENDAR);\nthis._listeners[ZmOperation.NEW_CALENDAR]=this._newListener.bind(this);\nthis._listeners[ZmOperation.ADD_EXTERNAL_CALENDAR]=this._addExternalCalendarListener.bind(this);\nthis._listeners[ZmOperation.CHECK_ALL]=this._checkAllListener.bind(this);\nthis._listeners[ZmOperation.CLEAR_ALL]=this._clearAllListener.bind(this);\nthis._listeners[ZmOperation.DETACH_WIN]=this._detachListener.bind(this);\nthis._listeners[ZmOperation.SHARE_CALENDAR]=this._shareCalListener.bind(this);\nthis._listeners[ZmOperation.MOVE]=this._moveListener.bind(this);\nthis._listeners[ZmOperation.RECOVER_DELETED_ITEMS]=this._recoverListener.bind(this);\nthis._eventMgrs={}\n};\nZmCalendarTreeController.prototype=new ZmTreeController;\nZmCalendarTreeController.prototype.constructor=ZmCalendarTreeController;\nZmCalendarTreeController.prototype.isZmCalendarTreeController=true;\nZmCalendarTreeController.prototype.toString=function(){return\"ZmCalendarTreeController\"\n};\nZmCalendarTreeController.prototype._initializeActionMenus=function(){ZmTreeController.prototype._initializeActionMenus.call(this);\nvar b=this._getRemoteActionMenuOps();\nif(!this._remoteActionMenu&&b){var a=[this._shell,b];\nthis._remoteActionMenu=new AjxCallback(this,this._createActionMenu,a)\n}};\nZmCalendarTreeController.prototype._treeListener=function(b){ZmTreeController.prototype._treeListener.call(this,b);\nif(b.detail==DwtTree.ITEM_EXPANDED){var a=b.item;\nvar c=a.getData(Dwt.KEY_OBJECT);\nif(c&&c.isRemote()&&c.isMountpoint){this._fixupTreeNode(a,c,a._tree)\n}}};\nZmCalendarTreeController.prototype.show=function(a){a.include=a.include||{};\na.include[ZmFolder.ID_TRASH]=true;\na.showUnread=false;\nreturn ZmFolderTreeController.prototype.show.call(this,a)\n};\nZmCalendarTreeController.prototype.getCalendars=function(f,d){var g=[];\nvar a=this._getItems(f);\nfor(var b=0;\nb<a.length;\nb++){var c=a[b];\nif(c._isSeparator){continue\n}var e=c.getData(Dwt.KEY_OBJECT);\nif(e){if(e.id==ZmOrganizer.ID_TRASH&&!d){continue\n}g.push(e)\n}}return g\n};\nZmCalendarTreeController.prototype.getOwnedCalendars=function(f,a){var g=[];\nvar b=this._getItems(f);\nfor(var c=0;\nc<b.length;\nc++){var d=b[c];\nif(!d||d._isSeparator){continue\n}var e=d.getData(Dwt.KEY_OBJECT);\nif(e&&e.getOwner()==a){g.push(e)\n}}return g\n};\nZmCalendarTreeController.prototype.addSelectionListener=function(b,a){if(!this._eventMgrs[b]){this._eventMgrs[b]=new AjxEventMgr;\nthis._eventMgrs[b]._selEv=new DwtSelectionEvent(true)\n}this._eventMgrs[b].addListener(DwtEvent.SELECTION,a)\n};\nZmCalendarTreeController.prototype.removeSelectionListener=function(b,a){if(this._eventMgrs[b]){this._eventMgrs[b].removeListener(DwtEvent.SELECTION,a)\n}};\nZmCalendarTreeController.prototype.resetOperations=function(o,m,a){if(o&&!appCtxt.isWebClientOffline()){var h=appCtxt.getById(a);\nvar b;\nif(h){b=h.nId;\nvar l=(!h.link||h.isAdmin())&&b!=ZmFolder.ID_TRASH;\nif(appCtxt.isOffline){var n=h.getAccount();\nl=!n.isMain&&n.isZimbraAccount\n}o.enable(ZmOperation.SHARE_CALENDAR,l);\no.enable(ZmOperation.SYNC,h.isFeed())\n}else{b=ZmOrganizer.normalizeId(a)\n}var k=(b==ZmFolder.ID_TRASH);\no.enable(ZmOperation.DELETE_WITHOUT_SHORTCUT,(b!=ZmOrganizer.ID_CALENDAR&&b!=ZmOrganizer.ID_TRASH));\nthis.setVisibleIfExists(o,ZmOperation.EMPTY_FOLDER,b==ZmFolder.ID_TRASH);\nvar e=((h.numTotal>0)||(h.children&&(h.children.size()>0)));\no.enable(ZmOperation.EMPTY_FOLDER,e);\nvar c=o.getItemById(ZmOperation.KEY_ID,ZmOperation.MOVE);\nvar p=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT);\nif(a==p){var j=this._getItems(this._actionedOverviewId);\nvar g=false;\nvar d=false;\nfor(var f=0;\nf<j.length;\nf++){var r=j[f];\nif(r._isSeparator){continue\n}r.getChecked()?g=true:d=true\n}o.enable(ZmOperation.CHECK_ALL,d);\no.enable(ZmOperation.CLEAR_ALL,g)\n}this._enableRecoverDeleted(o,k);\nthis._resetButtonPerSetting(o,ZmOperation.SHARE_CALENDAR,appCtxt.get(ZmSetting.SHARING_ENABLED));\nthis._resetButtonPerSetting(o,ZmOperation.FREE_BUSY_LINK,appCtxt.getActiveAccount().isZimbraAccount);\nvar q=o.getMenuItem(ZmOperation.FREE_BUSY_LINK);\nif(q){o._fbLinkSubMenu=o._fbLinkSubMenu||this._getFreeBusySubMenu(o,h.restUrl);\nq.setMenu(o._fbLinkSubMenu)\n}o.enable(ZmOperation.NEW_CALENDAR,!k&&!appCtxt.isExternalAccount()&&!appCtxt.isWebClientOffline())\n}};\nZmCalendarTreeController.prototype._getFreeBusySubMenu=function(e,c){var a=[ZmOperation.SEND_FB_HTML,ZmOperation.SEND_FB_ICS,ZmOperation.SEND_FB_ICS_EVENT];\nvar f={parent:e,menuItems:a};\nvar b=new ZmActionMenu(f);\nfor(var d=0;\nd<a.length;\nd++){b.addSelectionListener(a[d],this._freeBusyLinkListener.bind(this,a[d],c))\n}return b\n};\nZmCalendarTreeController.prototype._detachListener=function(d){var c=this._getActionedOrganizer(d);\nif(!c){return\n}var e=c.getAccount();\nvar b=true;\nvar a=c.getRestUrl(e,b);\nif(a){window.open(a+\".html?tz=\"+AjxTimezone.DEFAULT,\"_blank\")\n}};\nZmCalendarTreeController.prototype._freeBusyLinkListener=function(f,a,c){var b=false;\nvar e=appCtxt.getApp(ZmApp.CALENDAR);\nif(e){b=e._inNewWindow(c)\n}a=a||appCtxt.get(ZmSetting.REST_URL);\nif(a){a+=f===ZmOperation.SEND_FB_ICS_EVENT?\"?fmt=ifb&fbfmt=event\":f===ZmOperation.SEND_FB_ICS?\"?fmt=ifb\":\"?fmt=freebusy\"\n}var d={action:ZmOperation.NEW_MESSAGE,inNewWindow:b,msg:(new ZmMailMsg()),extraBodyText:a};\nAjxDispatcher.run(\"Compose\",d)\n};\nZmCalendarTreeController.prototype._recoverListener=function(a){appCtxt.getDumpsterDialog().popup(this._getSearchFor(),this._getSearchTypes())\n};\nZmCalendarTreeController.prototype._getSearchFor=function(a){return ZmItem.APPT\n};\nZmCalendarTreeController.prototype._getSearchTypes=function(a){return[ZmItem.APPT]\n};\nZmCalendarTreeController.prototype._getHeaderActionMenuOps=function(){var a=[];\nif(appCtxt.getCurrentApp().containsWritableFolder()){a.push(ZmOperation.NEW_CALENDAR,ZmOperation.ADD_EXTERNAL_CALENDAR,ZmOperation.CHECK_ALL,ZmOperation.CLEAR_ALL,ZmOperation.SEP,ZmOperation.FREE_BUSY_LINK)\n}else{a.push(ZmOperation.CHECK_ALL,ZmOperation.CLEAR_ALL)\n}a.push(ZmOperation.FIND_SHARES);\nreturn a\n};\nZmCalendarTreeController.prototype._getRemoteActionMenuOps=function(){return[ZmOperation.NEW_CALENDAR,ZmOperation.ADD_EXTERNAL_CALENDAR,ZmOperation.FREE_BUSY_LINK]\n};\nZmCalendarTreeController.prototype._getActionMenuOps=function(){if(appCtxt.getCurrentApp().containsWritableFolder()){return[ZmOperation.NEW_CALENDAR,ZmOperation.SYNC,ZmOperation.EMPTY_FOLDER,ZmOperation.RECOVER_DELETED_ITEMS,ZmOperation.SHARE_CALENDAR,ZmOperation.MOVE,ZmOperation.DELETE_WITHOUT_SHORTCUT,ZmOperation.EDIT_PROPS,ZmOperation.DETACH_WIN]\n}else{return[ZmOperation.EDIT_PROPS,ZmOperation.DETACH_WIN]\n}};\nZmCalendarTreeController.prototype.getItemActionMenu=function(b,a){var c=null;\nif(a.isRemoteRoot()){c=this._getRemoteActionMenu()\n}else{c=ZmTreeController.prototype.getItemActionMenu.apply(this,arguments)\n}return c\n};\nZmCalendarTreeController.prototype._getRemoteActionMenu=function(){if(this._remoteActionMenu instanceof AjxCallback){var a=this._remoteActionMenu;\nthis._remoteActionMenu=a.run()\n}return this._remoteActionMenu\n};\nZmCalendarTreeController.prototype._getActionMenu=function(e){var a=e.item.getData(Dwt.KEY_OBJECT);\nif(a.type!=this.type&&a.nId!=ZmOrganizer.ID_TRASH){return null\n}var f=ZmTreeController.prototype._getActionMenu.apply(this,arguments);\nif(appCtxt.isWebClientOffline()){f.enableAll(false)\n}else{var c=a.nId==ZmOrganizer.ID_TRASH;\nvar d=a.nId==ZmOrganizer.ID_CALENDAR;\nf.enableAll(!c);\nf.enable(ZmOperation.MOVE,!d&&!c);\nf.enable(ZmOperation.EMPTY_FOLDER,c);\nvar b=f.getMenuItem(ZmOperation.EMPTY_FOLDER);\nif(b){b.setText(c?ZmMsg.emptyTrash:ZmMsg.emptyFolder)\n}}return f\n};\nZmCalendarTreeController.prototype._itemClicked=function(a){if((a.type!=ZmOrganizer.CALENDAR)&&!a.isRemoteRoot()){if(a._showFoldersCallback){a._showFoldersCallback.run();\nreturn\n}if(a.nId==ZmOrganizer.ID_TRASH){return\n}var b=ZmOrganizer.APP[a.type];\nvar c=b&&appCtxt.getApp(b);\nif(c){var d=new AjxCallback(this,this._postActivateApp,[a,c]);\nappCtxt.getAppController().activateApp(b,null,d)\n}else{appCtxt.setStatusMsg({msg:AjxMessageFormat.format(ZmMsg.appUnknown,[b]),level:ZmStatusView.LEVEL_WARNING})\n}}};\nZmCalendarTreeController.prototype._postActivateApp=function(a,f){var b=appCtxt.getOverviewController();\nvar e=f.getOverviewId();\nvar d=a.type;\nvar c=b.getTreeView(e,d);\nif(c){c.setSelected(a)\n}};\nZmCalendarTreeController.prototype._dropListener=function(k){var d=k.srcData.data;\nvar g=k.targetControl.getData(Dwt.KEY_OBJECT);\nvar c=(!(d instanceof Array))?[d]:d;\nvar f=(k.shiftKey||k.uiEvent.shiftKey);\nif(k.action==DwtDropEvent.DRAG_ENTER){var j=k.targetControl.getData(ZmTreeView.KEY_TYPE);\nif(d instanceof ZmCalendar){k.doIt=g.mayContain(d,j)&&!d.isSystem()\n}else{if(!(c[0] instanceof ZmAppt)){k.doIt=false\n}else{if(this._dropTgt.isValidTarget(d)){var j=k.targetControl.getData(ZmTreeView.KEY_TYPE);\nk.doIt=g.mayContain(d,j);\nvar b;\nfor(var e=0;\ne<c.length;\ne++){if(c[e] instanceof ZmItem){b|=c[e].getDefaultDndAction(f)\n}}if(((b&ZmItem.DND_ACTION_COPY)!=0)){var l=(c.length==1)?k.dndProxy.firstChild.nextSibling:k.dndProxy.firstChild.nextSibling.nextSibling;\nDwt.setVisibility(l,true)\n}}}}}else{if(k.action==DwtDropEvent.DRAG_DROP){var m=k.srcData.controller;\nvar a=AjxDispatcher.run(\"GetCalController\");\nif(!f&&a.isMovingBetwAccounts(c,g.id)){var h=appCtxt.getMsgDialog();\nh.setMessage(ZmMsg.orgChange,DwtMessageDialog.WARNING_STYLE);\nh.popup()\n}else{if(d instanceof ZmCalendar){this._doMove(d,g)\n}else{m._doMove(c,g,null,f)\n}}}}};\nZmCalendarTreeController.prototype._dropToRemoteFolder=function(a){appCtxt.setStatusMsg(AjxMessageFormat.format(ZmMsg.calStatusUpdate,a))\n};\nZmCalendarTreeController.prototype._changeOrgCallback=function(a,c,b,d){c.popdown();\nif(!d.noSuchFolder){a._doMove(b,d,null,false)\n}else{var c=appCtxt.getMsgDialog();\nvar e=AjxMessageFormat.format(ZmMsg.noFolderExists,d.name);\nc.setMessage(e);\nc.popup()\n}};\nZmCalendarTreeController.prototype._getNewDialog=function(){return appCtxt.getNewCalendarDialog()\n};\nZmCalendarTreeController.prototype._newCallback=function(b){var a=this._pendingActionData instanceof ZmOrganizer?this._pendingActionData:(this._pendingActionData&&this._pendingActionData.organizer);\nif(a){b.l=a.id\n}ZmTreeController.prototype._newCallback.call(this,b)\n};\nZmCalendarTreeController.prototype.getExternalCalendarDialog=function(){if(!this._externalCalendarDialog){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\",\"CalendarAppt\"]);\nthis._externalCalendarDialog=new ZmExternalCalendarDialog({parent:this._shell,controller:this})\n}return this._externalCalendarDialog\n};\nZmCalendarTreeController.prototype._addExternalCalendarListener=function(){var a=this.getExternalCalendarDialog();\na.popup()\n};\nZmCalendarTreeController.prototype._changeListener=function(d,c,g){ZmTreeController.prototype._changeListener.call(this,d,c,g);\nif(d.type!=this.type||d.handled){return\n}var a=d.getDetail(\"fields\")||{};\nif(d.event==ZmEvent.E_CREATE||d.event==ZmEvent.E_DELETE||(d.event==ZmEvent.E_MODIFY&&a[ZmOrganizer.F_FLAGS])){var e=appCtxt.isChildWindow?parentAppCtxt:appCtxt;\nvar b=e.getApp(ZmApp.CALENDAR).getCalController();\nb._updateCheckedCalendars();\nif(d.event!=ZmEvent.E_DELETE){var f=b.getCheckedCalendarFolderIds();\nAjxDebug.println(AjxDebug.CALENDAR,\"tree change listener refreshing calendar event '\"+d.event+\"' with checked folder ids \"+f.join(\",\"));\nb._refreshAction(true);\nd.handled=true\n}}};\nZmCalendarTreeController.prototype._treeViewListener=function(a){if(a.detail==DwtTree.ITEM_CHECKED){var c=a.item.getData(ZmTreeView.KEY_ID);\nvar b=a.item.getData(Dwt.KEY_OBJECT);\nif(this._getActionMenu(a)){this._getActionMenu(a).popdown()\n}if(this._eventMgrs[c]){this._eventMgrs[c].notifyListeners(DwtEvent.SELECTION,a)\n}return\n}ZmTreeController.prototype._treeViewListener.call(this,a)\n};\nZmCalendarTreeController.prototype._checkAllListener=function(a){this._setAllChecked(a,true)\n};\nZmCalendarTreeController.prototype._clearAllListener=function(a){this._setAllChecked(a,false)\n};\nZmCalendarTreeController.prototype._shareCalListener=function(b){this._pendingActionData=this._getActionedOrganizer(b);\nif(this._pendingActionData.id===\"1\"){var a=new AjxException(\"Root folder sharing is not allowed, ignoring action.\",AjxException.INVALID_PARAM);\nappCtxt.getAppController()._handleException(a);\nreturn\n}appCtxt.getSharePropsDialog().popup(ZmSharePropsDialog.NEW,this._pendingActionData)\n};\nZmCalendarTreeController.prototype._deleteListener=function(c){var a=this._getActionedOrganizer(c);\nif(a.isInTrash()){var d=new AjxCallback(this,this._deleteListener2,[a]);\nvar b=AjxMessageFormat.format(ZmMsg.confirmDeleteCalendar,AjxStringUtil.htmlEncode(a.name));\nappCtxt.getConfirmationDialog().popup(b,d)\n}else{this._doMove(a,appCtxt.getById(ZmFolder.ID_TRASH))\n}};\nZmCalendarTreeController.prototype._deleteListener2=function(a){this._doDelete(a)\n};\nZmCalendarTreeController.prototype._emptyListener=function(a){this._getEmptyShieldWarning(a)\n};\nZmCalendarTreeController.prototype._notifyListeners=function(f,e,a,d,c,b){if(this._eventMgrs[f]&&this._eventMgrs[f].isListenerRegistered(e)){if(c){DwtUiEvent.copy(b,c)\n}b.items=a;\nif(a.length==1){b.item=a[0]\n}b.detail=d;\nthis._eventMgrs[f].notifyListeners(e,b)\n}};\nZmCalendarTreeController.prototype._getItems=function(f){var c=this.getTreeView(f);\nif(c){var d=appCtxt.multiAccounts?c._overview.account:null;\nif(!appCtxt.get(ZmSetting.CALENDAR_ENABLED,null,d)){return[]\n}var a=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT,d);\nvar b=c.getTreeItemById(a);\nif(b){var e=[];\nthis._getSubItems(b,e);\nreturn e\n}}return[]\n};\nZmCalendarTreeController.prototype._getSubItems=function(a,e){if(!a||(a&&a._isSeparator)){return\n}var b=a.getItems();\nfor(var c=0;\nc<b.length;\nc++){var d=b[c];\nif(d&&!d._isSeparator){e.push(d);\nthis._getSubItems(d,e)\n}}};\nZmCalendarTreeController.prototype._setAllChecked=function(g,f){var h=this._actionedOverviewId;\nvar c=this._getItems(h);\nvar b=[];\nvar e,a;\nfor(var d=0;\nd<c.length;\nd++){e=c[d];\nif(e._isSeparator){continue\n}a=e.getData(Dwt.KEY_OBJECT);\nif(!a||a.type!=ZmOrganizer.CALENDAR){continue\n}e.setChecked(f);\nb.push(e)\n}if(b.length&&this._eventMgrs[h]){this._notifyListeners(h,DwtEvent.SELECTION,b,DwtTree.ITEM_CHECKED,g,this._eventMgrs[h]._selEv)\n}};\nZmCalendarTreeController.prototype._createTreeView=function(a){if(a.treeStyle==null){a.treeStyle=DwtTree.CHECKEDITEM_STYLE\n}a.showUnread=false;\nreturn new ZmTreeView(a)\n};\nZmCalendarTreeController.prototype._postSetup=function(e,d){ZmTreeController.prototype._postSetup.apply(this,arguments);\nif(d&&d.isCalDavBased()){var a=this.getTreeView(e);\nvar b=ZmOrganizer.getSystemId(ZmOrganizer.ID_CALENDAR,d);\nvar c=a.getTreeItemById(b);\nc.dispose()\n}};\nZmCalendarTreeController.prototype._newListener=function(d,e,f){this._pendingActionData=this._getActionedOrganizer(d);\nvar c=this._getNewDialog();\nif(f&&this._extCalData){var a=this._extCalData.iCal;\nc.setICalData(a);\nc.setTitle(ZmMsg.addExternalCalendar);\nc.getButton(ZmNewCalendarDialog.BACK_BUTTON).setVisibility(true)\n}else{c.setTitle(ZmMsg.createNewCalendar);\nc.getButton(ZmNewCalendarDialog.BACK_BUTTON).setVisibility(false)\n}if(!this._newCb){this._newCb=new AjxCallback(this,this._newCallback)\n}if(this._pendingActionData&&!appCtxt.getById(this._pendingActionData.id)){this._pendingActionData=appCtxt.getFolderTree(e).root\n}if(!e&&appCtxt.multiAccounts){var b=this._opc.getOverview(this._actionedOverviewId);\ne=b&&b.account\n}ZmController.showDialog(c,this._newCb,this._pendingActionData,e);\nc.registerCallback(DwtDialog.CANCEL_BUTTON,this._clearDialog,this,c)\n};\nZmCalendarTreeController.prototype.setExternalCalendarData=function(a){this._extCalData=a\n};\nZmCalendarTreeController.prototype._clearDialog=function(a){ZmTreeController.prototype._clearDialog.apply(this,arguments);\nif(this._externalCalendarDialog){this._externalCalendarDialog.popdown()\n}};\nZmCalendarTreeController.prototype.createDataSourceErrorCallback=function(a){appCtxt.setStatusMsg(ZmMsg.addExternalCalendarError)\n};\nZmCalendarTreeController.prototype.createDataSourceCallback=function(a){var b=a.getResponse(),c=b&&b.caldav?b.caldav[0].id:\"\",e,d;\nif(c){e={ImportDataRequest:{_jsns:\"urn:zimbraMail\",caldav:{id:c}}};\nd={soapDoc:e,asyncMode:false};\nappCtxt.getAppController().sendRequest(d)\n}appCtxt.setStatusMsg(ZmMsg.addExternalCalendarSuccess);\nreturn a\n};\nZmCalendarTreeController.POLLING_INTERVAL=\"1m\";\nZmCalendarTreeController.CONN_TYPE_CLEARTEXT=\"cleartext\";\nZmCalendarTreeController.CONN_TYPE_SSL=\"ssl\";\nZmCalendarTreeController.SSL_PORT=\"443\";\nZmCalendarTreeController.GOOGLE_CALDAV_SERVER=\"www.google.com\";\nZmCalendarTreeController.ALT_GOOGLE_CALDAV_SERVER=\"apidata.googleusercontent.com\";\nZmCalendarTreeController.DATA_SOURCE_ATTR_YAHOO=\"p:/principals/users/_USERNAME_\";\nZmCalendarTreeController.DATA_SOURCE_ATTR=\"p:/calendar/dav/_USERNAME_/user\";\nZmCalendarTreeController.prototype.createDataSource=function(j,e){var h=this._extCalData&&this._extCalData.calDav?this._extCalData.calDav:null;\nif(!h){return\n}var a,b,l,d,k,g=ZmCalendarTreeController.CONN_TYPE_CLEARTEXT,f=ZmCalendarTreeController.DATA_SOURCE_ATTR;\nd=h.hostUrl;\nl=AjxStringUtil.parseURL(d);\na=l.domain;\nb=l.port||ZmCalendarTreeController.SSL_PORT;\nf=l.path?\"p:\"+l.path:ZmCalendarTreeController.DATA_SOURCE_ATTR;\nif(b==ZmCalendarTreeController.SSL_PORT){g=ZmCalendarTreeController.CONN_TYPE_SSL\n}if(h.hostUrl.indexOf(ZmCalendarTreeController.GOOGLE_CALDAV_SERVER)===-1&&h.hostUrl.indexOf(ZmCalendarTreeController.ALT_GOOGLE_CALDAV_SERVER)===-1){f=ZmCalendarTreeController.DATA_SOURCE_ATTR_YAHOO\n}k={CreateDataSourceRequest:{_jsns:\"urn:zimbraMail\",caldav:{name:j.name,pollingInterval:ZmCalendarTreeController.POLLING_INTERVAL,isEnabled:\"1\",l:j.nId,host:a,port:b,connectionType:g,username:h.userName,password:h.password,a:{n:\"zimbraDataSourceAttribute\",_content:f}}}};\nthis._extCalData=null;\ndelete this._extCalData;\nvar i=(appCtxt.multiAccounts?appCtxt.accountList.mainAccount.name:null);\nvar c={jsonObj:k,asyncMode:true,sensitive:true,callback:new AjxCallback(this,this.createDataSourceCallback),errorCallback:new AjxCallback(this,this.createDataSourceErrorCallback),accountName:i};\nappCtxt.getAppController().sendRequest(c)\n}\n}};\n"
                    },
                    "redirectURL": "",
                    "headersSize": 364,
                    "bodySize": 237503
                },
                "cache": {},
                "timings": {
                    "send": 0,
                    "wait": 0,
                    "receive": 0
                }
            }
        ],
        "_webSocketEntries": {},
        "_settings": {
            "_proxy": {}
        }
    }
}
