{
    "log": {
        "version": "1.2",
        "creator": {
            "name": "DevWeb",
            "version": "1.2"
        },
        "pages": [
            {
                "startedDateTime": "2022-12-06T11:38:15.200687Z",
                "id": "page_1",
                "title": "https://mail.etu.univ-lorraine.fr/zimbra/js/MailCore_all.js.zgz",
                "pageTimings": {}
            }
        ],
        "entries": [
            {
                "pageref": "page_1",
                "startedDateTime": "2022-12-06T11:38:15.200687Z",
                "time": 0,
                "_isResource": false,
                "request": {
                    "method": "GET",
                    "url": "https://mail.etu.univ-lorraine.fr/zimbra/js/MailCore_all.js.zgz?v=220726112844",
                    "httpVersion": "HTTP/2.0",
                    "cookies": [
                        {
                            "name": "UL-AUTHTRACE",
                            "value": "TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA",
                            "httpOnly": false
                        },
                        {
                            "name": "JSESSIONID",
                            "value": "node01ewv5q86m64i21vkfxtflutla86873.node0",
                            "httpOnly": false
                        },
                        {
                            "name": "ZM_AUTH_TOKEN",
                            "value": "0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b",
                            "httpOnly": false
                        }
                    ],
                    "headers": [
                        {
                            "name": "accept",
                            "value": "*/*"
                        },
                        {
                            "name": "accept-encoding",
                            "value": "gzip, deflate, br"
                        },
                        {
                            "name": "accept-language",
                            "value": "fr,fr-FR;q=0.8,en-US;q=0.5,en;q=0.3"
                        },
                        {
                            "name": "cookie",
                            "value": "UL-AUTHTRACE=TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA; JSESSIONID=node01ewv5q86m64i21vkfxtflutla86873.node0; ZM_AUTH_TOKEN=0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b"
                        },
                        {
                            "name": "dnt",
                            "value": "1"
                        },
                        {
                            "name": "referer",
                            "value": "https://mail.etu.univ-lorraine.fr/"
                        },
                        {
                            "name": "sec-fetch-dest",
                            "value": "empty"
                        },
                        {
                            "name": "sec-fetch-mode",
                            "value": "cors"
                        },
                        {
                            "name": "sec-fetch-site",
                            "value": "same-origin"
                        },
                        {
                            "name": "te",
                            "value": "trailers"
                        },
                        {
                            "name": "user-agent",
                            "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101 Firefox/102.0"
                        }
                    ],
                    "queryString": [
                        {
                            "name": "v",
                            "value": "220726112844"
                        }
                    ],
                    "headersSize": -1,
                    "bodySize": -1
                },
                "response": {
                    "status": 200,
                    "statusText": "OK",
                    "httpVersion": "HTTP/2.0",
                    "cookies": null,
                    "headers": [
                        {
                            "name": "accept-ranges",
                            "value": "bytes"
                        },
                        {
                            "name": "cache-control",
                            "value": "public, max-age=2595600"
                        },
                        {
                            "name": "content-type",
                            "value": "text/javascript"
                        },
                        {
                            "name": "date",
                            "value": "Tue, 06 Dec 2022 10:38:15 GMT"
                        },
                        {
                            "name": "expires",
                            "value": "Thu, 5 Jan 2023 11:38:15 GMT"
                        },
                        {
                            "name": "last-modified",
                            "value": "Tue, 26 Jul 2022 15:29:42 GMT"
                        },
                        {
                            "name": "server",
                            "value": "nginx"
                        },
                        {
                            "name": "x-frame-options",
                            "value": "SAMEORIGIN"
                        },
                        {
                            "name": "x-recouv-allowed",
                            "value": "Recouv"
                        }
                    ],
                    "content": {
                        "size": 500607,
                        "mimeType": "",
                        "text": "\n/* \n* Zimbra Collaboration Suite Web Client\n* Copyright (C) 2004-2017 Synacor, Inc.\n* https://www.zimbra.com/license\n*/\nif(AjxPackage.define(\"MailCore\")){if(AjxPackage.define(\"zimbraMail.mail.model.ZmMailItem\")){ZmMailItem=function(c,e,d,b){if(arguments.length==0){return\n}ZmItem.call(this,c,e,d,b);\nthis._loaded=false;\nthis._initializeParticipants()\n};\nZmMailItem.prototype=new ZmItem;\nZmMailItem.prototype.constructor=ZmMailItem;\nZmMailItem.sortBy=ZmSearch.DATE_DESC;\nZmMailItem.sortCompare=function(e,d){var f=ZmMailItem.sortBy;\nif(!f||(f!=ZmSearch.DATE_DESC&&f!=ZmSearch.DATE_ASC)){return 0\n}var c=parseInt(e.date);\nvar b=parseInt(d.date);\nif(f==ZmSearch.DATE_DESC){return(c>b)?-1:(c<b)?1:0\n}if(f==ZmSearch.DATE_ASC){return(c>b)?1:(c<b)?-1:0\n}};\nZmMailItem.prototype.toString=function(){return\"ZmMailItem\"\n};\nZmMailItem.prototype.getReadIcon=function(){return this.isUnread?\"MsgUnread\":\"MsgRead\"\n};\nZmMailItem.prototype.getMuteIcon=function(){return\"\"\n};\nZmMailItem.prototype.getColor=function(){if(!this.tags||this.tags.length!==1){return null\n}var c=appCtxt.getAccountTagList(this);\nvar b=c.getByNameOrRemote(this.tags[0]);\nreturn b.getColor()\n};\nZmMailItem.prototype.clear=function(){if(this.refCount<=1){this._clearParticipants();\nthis._loaded=false\n}ZmItem.prototype.clear.call(this)\n};\nZmMailItem.prototype.getFolderId=function(){return this.folderId\n};\nZmMailItem.prototype.notifyModify=function(d,e){var b={};\nif(d.e&&d.e.length){this._clearParticipants();\nthis._initializeParticipants();\nfor(var c=0;\nc<d.e.length;\nc++){this._parseParticipantNode(d.e[c])\n}b[ZmItem.F_FROM]=true;\nthis._notify(ZmEvent.E_MODIFY,{fields:b})\n}return ZmItem.prototype.notifyModify.apply(this,arguments)\n};\nZmMailItem.prototype._initializeParticipants=function(){this.participants=new AjxVector();\nthis.participantsElided=false\n};\nZmMailItem.prototype._clearParticipants=function(){if(this.participants){this.participants.removeAll();\nthis.participants=null;\nthis.participantsElided=false\n}};\nZmMailItem.prototype._getFlags=function(){var b=ZmItem.prototype._getFlags.call(this);\nb.push(ZmItem.FLAG_UNREAD,ZmItem.FLAG_MUTE,ZmItem.FLAG_REPLIED,ZmItem.FLAG_FORWARDED,ZmItem.FLAG_READ_RECEIPT_SENT,ZmItem.FLAG_PRIORITY);\nreturn b\n};\nZmMailItem.prototype._markReadLocal=function(b){this.isUnread=!b;\nthis._notify(ZmEvent.E_FLAGS,{flags:[ZmItem.FLAG_UNREAD]})\n};\nZmMailItem.prototype._parseParticipantNode=function(f){var d=AjxEmailAddress.fromSoapType[f.t];\nif(d==AjxEmailAddress.READ_RECEIPT){this.readReceiptRequested=true\n}else{var c=AjxDispatcher.run(\"GetContacts\"),b=c&&c.getContactByEmail(f.a),g=b&&b.getFullNameForDisplay(false);\nif(f.p&&f.a&&f.a.startsWith(g+\"@\")){g=f.p\n}var h=new AjxEmailAddress(f.a,d,g||f.p,f.d,f.isGroup,f.isGroup&&f.exp);\nvar e=window.parentAppCtxt||window.appCtxt;\ne.setIsExpandableDL(f.a,h.canExpand);\nthis.participants.add(h)\n}};\nZmMailItem.prototype.getEmails=function(){return this.participants.map(\"address\")\n};\nZmMailItem.prototype.ignoreJunkTrash=function(){return Boolean((this.folderId==ZmFolder.ID_SPAM&&!appCtxt.get(ZmSetting.SEARCH_INCLUDES_SPAM))||(this.folderId==ZmFolder.ID_TRASH&&!appCtxt.get(ZmSetting.SEARCH_INCLUDES_TRASH)))\n};\nZmMailItem.prototype.setAutoSendTime=function(d){var b=this.isScheduled;\nvar c=AjxUtil.isDate(d);\nthis.flagLocal(ZmItem.FLAG_ISSCHEDULED,c);\nvar d=c?d:null;\nif(d!=this.autoSendTime){this.autoSendTime=d;\nthis._notify(ZmEvent.E_MODIFY)\n}if(b!=this.isScheduled){this._notify(ZmEvent.E_FLAGS,{flags:ZmItem.FLAG_ISSCHEDULED})\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmConv\")){ZmConv=function(c,b){ZmMailItem.call(this,ZmItem.CONV,c,b);\nthis._sortBy=ZmSearch.DATE_DESC;\nthis._listChangeListener=new AjxListener(this,this._msgListChangeListener);\nthis.folders={};\nthis.msgFolder={}\n};\nZmConv.prototype=new ZmMailItem;\nZmConv.prototype.constructor=ZmConv;\nZmConv.prototype.isZmConv=true;\nZmConv.prototype.toString=function(){return\"ZmConv\"\n};\nZmConv.createFromDom=function(c,b){var d=new ZmConv(c.id,b.list);\nd._loadFromDom(c);\nreturn d\n};\nZmConv.createFromMsg=function(d,b){var c=new ZmConv(d.cid,b.list);\nc._loadFromMsg(d);\nreturn c\n};\nZmConv.prototype.load=function(d,m){d=d||{};\nvar l=appCtxt.getCurrentController();\nvar i=d.query;\nif(!i){i=(l&&l.getSearchString)?l.getSearchString():appCtxt.get(ZmSetting.INITIAL_SEARCH)\n}var n=d.queryHint;\nif(!n){n=(l&&l.getSearchStringHint)?l.getSearchStringHint():\"\"\n}var k=d.sortBy||ZmSearch.DATE_DESC;\nvar f=d.offset||0;\nvar e=d.limit||appCtxt.get(ZmSetting.CONVERSATION_PAGE_SIZE);\nvar h=true;\nif(this._loaded&&this._expanded&&this.msgs&&this.msgs.size()&&!d.forceLoad){var p=this.msgs.size();\nif(this._sortBy!=k||this._query!=i||(p!=this.numMsgs&&!f)){this.msgs.clear()\n}else{if(!this.msgs.hasMore()||f+e<=p){h=false\n}}}if(!h){if(m){m.run(this._createResult())\n}}else{this._sortBy=k;\nthis._query=i;\nthis._offset=f;\nthis._limit=e;\nvar j={query:i,queryHint:n,types:(AjxVector.fromArray([ZmItem.MSG])),sortBy:k,offset:f,limit:e,getHtml:(d.getHtml||this.isDraft||appCtxt.get(ZmSetting.VIEW_AS_HTML)),accountName:(appCtxt.multiAccounts&&this.getAccount().name)};\nvar o=this.search=new ZmSearch(j),b=(d.fetch===true)?ZmSetting.CONV_FETCH_UNREAD_OR_FIRST:d.fetch||ZmSetting.CONV_FETCH_NONE;\nvar c=b!==ZmSetting.CONV_FETCH_NONE;\nvar g={cid:this.id,callback:(new AjxCallback(this,this._handleResponseLoad,[d,m,c])),fetch:b,markRead:d.markRead,noTruncate:d.noTruncate,needExp:c};\no.getConv(g)\n}};\nZmConv.prototype._handleResponseLoad=function(e,f,c,b){var d=b.getResponse();\nif(!e.offset){this.msgs=d.getResults(ZmItem.MSG);\nthis.msgs.convId=this.id;\nthis.msgs.addChangeListener(this._listChangeListener);\nthis.msgs.setHasMore(d.getAttribute(\"more\"));\nthis._loaded=true;\nthis._expanded=c\n}if(f){f.run(b)\n}};\nZmConv.prototype.loadMsgs=function(e,i,b){e=e||{};\nvar h={GetConvRequest:{_jsns:\"urn:zimbraMail\"}};\nvar d=h.GetConvRequest;\nvar g=d.c={id:this.id,needExp:true,html:(e.getHtml||this.isDraft||appCtxt.get(ZmSetting.VIEW_AS_HTML))};\nif(e.fetchAll){g.fetch=\"all\"\n}ZmMailMsg.addRequestHeaders(g);\nvar f=this._handleResponseLoadMsgs.bind(this,i||null);\nif(b){b.addRequestParams(h,f)\n}else{appCtxt.getAppController().sendRequest({jsonObj:h,asyncMode:true,callback:f})\n}};\nZmConv.prototype._handleResponseLoadMsgs=function(h,c){var g=c.getResponse().GetConvResponse.c[0];\nthis.msgIds=[];\nif(!this.msgs){this.msgs=new ZmMailList(ZmItem.MSG,this.search);\nthis.msgs.convId=this.id;\nthis.msgs.addChangeListener(this._listChangeListener)\n}else{this.msgs.removeAllItems()\n}if(this.search&&!this.msgs.search){this.msgs.search=this.search\n}this.msgs.setHasMore(false);\nthis._loaded=true;\nvar b=g.m.length;\nfor(var e=b-1;\ne>=0;\ne--){var d=g.m[e];\nthis.msgIds.push(d.id);\nthis.msgFolder[d.id]=d.l;\nd.su=g.su;\nvar f=ZmMailMsg.createFromDom(d,{list:this.msgs});\nthis.msgs.add(f)\n}if(h){h.run(c)\n}};\nZmConv.prototype.addMsg=function(f,d){if(!this.msgs){this.msgs=new ZmMailList(ZmItem.MSG,this.search);\nthis.msgs.convId=this.id;\nthis.msgs.addChangeListener(this._listChangeListener);\nthis.msgs.setHasMore(false)\n}if(this.search&&!this.msgs.search){this.msgs.search=this.search\n}this.msgs.add(f,d);\nthis.msgIds=[];\nvar c=this.msgs.getArray();\nfor(var e=0,b=c.length;\ne<b;\ne++){this.msgIds.push(c[e].id)\n}this.msgFolder[f.id]=f.folderId\n};\nZmConv.prototype.removeMsg=function(b){if(this.msgs){this.msgs.remove(b,true)\n}if(this.msgIds&&this.msgIds.length){AjxUtil.arrayRemove(this.msgIds,b.id)\n}delete this.msgFolder[b.id]\n};\nZmConv.prototype.canAddTag=function(c){if(!this.msgs){return ZmItem.prototype.canAddTag.call(this,c)\n}var d=this.msgs.getArray();\nfor(var b=0;\nb<d.length;\nb++){var e=d[b];\nif(e.canAddTag(c)){return true\n}}return false\n};\nZmConv.prototype.mute=function(){this.isMute=true;\nif(this.msgs){var c=this.msgs.getArray();\nfor(var b=0;\nb<c.length;\nb++){var d=c[b];\nd.mute()\n}}};\nZmConv.prototype.unmute=function(){this.isMute=false;\nif(this.msgs){var c=this.msgs.getArray();\nfor(var b=0;\nb<c.length;\nb++){var d=c[b];\nd.unmute()\n}}};\nZmConv.prototype.getMuteIcon=function(){return this.isMute?\"Mute\":\"Unmute\"\n};\nZmConv.prototype.clear=function(){if(this.isInUse){return\n}if(this.msgs){this.msgs.clear();\nthis.msgs.removeChangeListener(this._listChangeListener);\nthis.msgs=null\n}this.msgIds=[];\nthis.folders={};\nthis.msgFolder={};\nZmMailItem.prototype.clear.call(this)\n};\nZmConv.prototype.isReadOnly=function(){if(this._loaded&&this.msgs&&this.msgs.size()){var e=this.msgs.getArray();\nfor(var c=0;\nc<e.length;\nc++){if(e[c].isReadOnly()){return true\n}}}else{var b=this.getFolderId();\nvar d=b&&appCtxt.getById(b);\nreturn !!(d&&d.isReadOnly())\n}return false\n};\nZmConv.prototype.hasMatchingMsg=function(e,b){var f=this.msgs&&this.msgs.getArray(),c=false;\nif(f&&f.length>0){for(var d=0;\nd<f.length;\nd++){var h=f[d],g=e.matches(h);\nif(g&&!h.ignoreJunkTrash()&&this.folders[h.folderId]){return true\n}else{if(g===null){c=true\n}}}}return c?!!b:false\n};\nZmConv.prototype.containsMsg=function(b){return this.msgIds&&AjxUtil.arrayContains(this.msgIds,b.id)\n};\nZmConv.prototype.ignoreJunkTrash=function(){return Boolean((this.numMsgs==1)&&this.folders&&((this.folders[ZmFolder.ID_SPAM]&&!appCtxt.get(ZmSetting.SEARCH_INCLUDES_SPAM))||(this.folders[ZmFolder.ID_TRASH]&&!appCtxt.get(ZmSetting.SEARCH_INCLUDES_TRASH))))\n};\nZmConv.prototype.getAccount=function(){if(!this.account){var b=this.getFolderId();\nvar c=b&&appCtxt.getById(b);\nif(!(c&&c._isRemote)){this.account=ZmOrganizer.parseId(this.id).account\n}}if(!this.account){this.account=appCtxt.getActiveAccount()\n}return this.account\n};\nZmConv.prototype.notifyModify=function(e,g){var b={};\nif(e._newId!=null){var f=appCtxt.getById(e._newId)||this;\nf._oldId=this.id;\nf.id=e._newId;\nappCtxt.cacheSet(f._oldId);\nappCtxt.cacheSet(f.id,f);\nf.msgs=f.msgs||this.msgs;\nif(f.msgs){f.msgs.convId=f.id;\nvar c=f.msgs.getArray();\nfor(var d=0;\nd<c.length;\nd++){c[d].cid=f.id\n}}f.folders=AjxUtil.hashCopy(this.folders);\nif(f.list&&f._oldId&&f.list._idHash[f._oldId]){delete f.list._idHash[f._oldId];\nf.list._idHash[f.id]=f\n}b[ZmItem.F_ID]=true;\nf._notify(ZmEvent.E_MODIFY,{fields:b})\n}if(e.n!=null){this.numMsgs=e.n;\nb[ZmItem.F_SIZE]=true;\nthis._notify(ZmEvent.E_MODIFY,{fields:b})\n}return ZmMailItem.prototype.notifyModify.apply(this,arguments)\n};\nZmConv.prototype.hasFlag=function(b,e){if(!this.msgs){return(this[ZmItem.FLAG_PROP[b]]==e)\n}var d=this.msgs.getArray();\nfor(var c=0;\nc<d.length;\nc++){var f=d[c];\nif(f[ZmItem.FLAG_PROP[b]]==e){return true\n}}return false\n};\nZmConv.prototype._checkFlags=function(d){var c={};\nvar g={};\nfor(var f=0;\nf<d.length;\nf++){var b=d[f];\nif(!(b==ZmItem.FLAG_FLAGGED||b==ZmItem.FLAG_UNREAD||b==ZmItem.FLAG_MUTE||b==ZmItem.FLAG_ATTACH||b==ZmItem.FLAG_PRIORITY)){continue\n}c[b]=this[ZmItem.FLAG_PROP[b]];\ng[b]=this.hasFlag(b,true)\n}var e=false;\nvar d=[];\nfor(var b in c){if(c[b]!=g[b]){this[ZmItem.FLAG_PROP[b]]=g[b];\nd.push(b);\ne=true\n}}if(e){this._notify(ZmEvent.E_FLAGS,{flags:d})\n}};\nZmConv.prototype._checkTags=function(){var b={};\nvar c={};\nfor(var f in this.tagHash){c[f]=true\n}if(this.msgs){var g=this.msgs.getArray();\nif(!(g&&g.length)){return\n}for(var e=0;\ne<g.length;\ne++){for(var f in g[e].tagHash){b[f]=true;\nc[f]=true\n}}var d=false;\nfor(var f in c){if(!this.tagHash[f]&&b[f]){if(this.tagLocal(f,true)){d=true\n}}else{if(this.tagHash[f]&&!b[f]){if(this.tagLocal(f,false)){d=true\n}}}}}if(d){this._notify(ZmEvent.E_TAGS)\n}};\nZmConv.prototype.moveLocal=function(b){if(this.folders){delete this.folders\n}this.folders={};\nthis.folders[b]=true\n};\nZmConv.prototype.getMsgList=function(j,e,f){var g=this.msgs&&this.msgs.getArray();\nvar c=g?(g.slice(j||0)):[];\nif(f){var b=[];\nfor(var d=0;\nd<c.length;\nd++){var h=c[d];\nif(!(h&&h.folderId&&f[h.folderId])){b.push(h)\n}}c=b\n}if(e){c.reverse()\n}return c\n};\nZmConv.prototype.getFolderId=function(){return this.folderId||(this.list&&this.list.search&&this.list.search.folderId)\n};\nZmConv.prototype.getFirstHotMsg=function(c,f){var b;\nc=c||{};\nif(this.msgs&&this.msgs.size()){b=this.msgs.getFirstHit(c.offset,c.limit,c.foldersToOmit)\n}if(f){if(b&&b._loaded&&!c.forceLoad){f.run(b)\n}else{var e=this._handleResponseGetFirstHotMsg.bind(this,c,f);\nc.fetch=ZmSetting.CONV_FETCH_FIRST;\nthis.load(c,e)\n}}else{if(!b&&this.msgIds&&this.msgIds.length){var d=this.msgIds[0];\nb=appCtxt.getById(d);\nif(!b){if(!this.msgs){this.msgs=new ZmMailList(ZmItem.MSG);\nthis.msgs.convId=this.id;\nthis.msgs.addChangeListener(this._listChangeListener)\n}b=new ZmMailMsg(d,this.msgs)\n}}return b\n}};\nZmConv.prototype._handleResponseGetFirstHotMsg=function(c,e){var b=this.msgs.getFirstHit(c.offset,c.limit,c.foldersToOmit);\nif(b&&b._loaded){if(e){e.run(b)\n}}else{if(!b&&this.msgIds&&this.msgIds.length){b=new ZmMailMsg(this.msgIds[0])\n}var d=this._handleResponseLoadMsg.bind(this,b,e);\nb.load({getHtml:c.getHtml,callback:d})\n}};\nZmConv.prototype._handleResponseLoadMsg=function(b,c){if(b&&c){c.run(b)\n}};\nZmConv.prototype._loadFromDom=function(h){this.numMsgs=h.n;\nthis.date=h.d;\nthis._parseFlagsOfMsgs(h.m);\nthis._parseTagNames(h.tn);\nif(h.e){for(var c=0;\nc<h.e.length;\nc++){this._parseParticipantNode(h.e[c])\n}}this.participantsElided=h.elided;\nthis.subject=h.su;\nthis.fragment=h.fr;\nthis.sf=h.sf;\nif(h.m){this.msgIds=[];\nthis.msgFolder={};\nfor(var c=0,d=h.m.length;\nc<d;\nc++){var b=h.m[c];\nthis.msgIds.push(b.id);\nthis.msgFolder[b.id]=b.l;\nthis.folders[b.l]=true\n}if(d==1){var b=h.m[0];\nvar g=this.list&&this.list.search&&this.list.search.folderId;\nif(g){this.folderId=g;\nthis.folders[g]=true\n}else{if(b.l){this.folderId=b.l;\nthis.folders[b.l]=true\n}else{AjxDebug.println(AjxDebug.NOTIFY,\"no folder added for conv\")\n}}if(b.s){this.size=b.s\n}if(b.autoSendTime){var e=parseInt(b.autoSendTime);\nif(e){this.setAutoSendTime(new Date(e))\n}}}}if(h.meta){this.meta={};\nfor(var c=0;\nc<h.meta.length;\nc++){var f=h.meta[c].section;\nthis.meta[f]={};\nthis.meta[f]._attrs={};\nfor(a in h.meta[c]._attrs){this.meta[f]._attrs[a]=h.meta[c]._attrs[a]\n}}}};\nZmConv.prototype._loadFromMsg=function(e){this.date=e.date;\nthis.isFlagged=e.isFlagged;\nthis.isUnread=e.isUnread;\nfor(var c=0;\nc<e.tags.length;\nc++){this.tagLocal(e.tags[c],true)\n}var b=e.participants?e.participants.getArray():null;\nthis.participants=new AjxVector();\nif(b&&b.length){for(var c=0;\nc<b.length;\nc++){var d=b[c];\nif((e.isDraft&&d.type==AjxEmailAddress.TO)||(!e.isDraft&&d.type==AjxEmailAddress.FROM)){this.participants.add(d)\n}}}this.subject=e.subject;\nthis.fragment=e.fragment;\nthis.sf=e.sf;\nthis.msgIds=[e.id];\nthis.msgFolder[e.id]=e.folderId;\nthis.redrawConvRow=true\n};\nZmConv.prototype._msgListChangeListener=function(b){if(b.type!=ZmEvent.S_MSG){return\n}if(b.event==ZmEvent.E_TAGS||b.event==ZmEvent.E_REMOVE_ALL){this._checkTags()\n}else{if(b.event==ZmEvent.E_FLAGS){this._checkFlags(b.getDetail(\"flags\"))\n}else{if(b.event==ZmEvent.E_DELETE||b.event==ZmEvent.E_MOVE){if(this.list&&this.list.search&&!this.hasMatchingMsg(this.list.search,true)){this.moveLocal(b.item&&b.item.folderId);\nthis._notify(b.event)\n}}}}};\nZmConv.prototype._createResult=function(){var b=new ZmSearchResult(this.search);\nb.type=ZmItem.MSG;\nb._results[ZmItem.MSG]=this.msgs;\nreturn new ZmCsfeResult(b)\n};\nZmConv.prototype.updateFragment=function(f){var e;\nvar c=this.msgs&&this.msgs.size();\nif(c){for(var b=c-1;\nb>=0;\nb--){var d=this.msgs.get(b);\nif(f&&AjxUtil.indexOf(f,d)!=-1){continue\n}if(d.fragment&&(!e||d.date>e.date)){e=d\n}}}if(e){this.fragment=e.fragment\n}};\nZmConv.prototype.getAddresses=function(d){var f=this.participants?this.participants.getArray():[];\nvar e=[];\nfor(var c=0,b=f.length;\nc<b;\nc++){var g=f[c];\nif(g.type==d){e.push(g)\n}}return AjxVector.fromArray(e)\n};\nZmConv.prototype.getStatusTooltip=function(){if(this.numMsgs===1&&this.msgIds&&this.msgIds.length>0){var c=appCtxt.getById(this.msgIds[0]);\nif(c){return c.getStatusTooltip()\n}}var b=[];\nif(this.isScheduled){b.push(ZmMsg.scheduled)\n}if(this.isUnread){b.push(ZmMsg.unread)\n}if(this.isReplied){b.push(ZmMsg.replied)\n}if(this.isForwarded){b.push(ZmMsg.forwarded)\n}if(this.isDraft){b.push(ZmMsg.draft)\n}else{if(this.isSent){b.push(ZmMsg.sentAt)\n}}return b.join(\", \")\n};\nZmConv.prototype.getNumUnreadMsgs=function(){var c=0;\nvar e=this.getMsgList();\nif(e){for(var d=0,b=e.length;\nd<b;\nd++){if(e[d].isUnread){c++\n}}return c\n}return null\n};\nZmConv.prototype._parseFlagsOfMsgs=function(l){var k=ZmMailApp.getFoldersToOmit(this.list&&this.list.search),b,h=l?l.length:0,f,c={};\nfor(f=0;\nf<h;\nf++){b=l[f];\nif(!k[b.l]){var g=b.f&&b.f.split(\"\"),e=g?g.length:0,d;\nfor(d=0;\nd<e;\nd++){c[g[d]]=true\n}}}this.flags=AjxUtil.keys(c).join(\"\");\nZmItem.prototype._parseFlags.call(this,this.flags)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmMailMsg\")){ZmMailMsg=function(f,e,b){ZmMailItem.call(this,ZmItem.MSG,f,e,b);\nthis.inHitList=false;\nthis._attHitList=[];\nthis._inviteDescBody={};\nthis._addrs={};\nthis.attachments=[];\nthis._bodyParts=[];\nthis._contentType={};\nfor(var c=0;\nc<ZmMailMsg.ADDRS.length;\nc++){var d=ZmMailMsg.ADDRS[c];\nthis._addrs[d]=new AjxVector()\n}this.identity=null\n};\nZmMailMsg.prototype=new ZmMailItem;\nZmMailMsg.prototype.constructor=ZmMailMsg;\nZmMailMsg.prototype.isZmMailMsg=true;\nZmMailMsg.prototype.toString=function(){return\"ZmMailMsg\"\n};\nZmMailMsg.DL_SUB_VERSION=\"0.1\";\nZmMailMsg.ADDRS=[AjxEmailAddress.FROM,AjxEmailAddress.TO,AjxEmailAddress.CC,AjxEmailAddress.BCC,AjxEmailAddress.REPLY_TO,AjxEmailAddress.SENDER,AjxEmailAddress.RESENT_FROM];\nZmMailMsg.COMPOSE_ADDRS=[AjxEmailAddress.TO,AjxEmailAddress.CC,AjxEmailAddress.BCC];\nZmMailMsg.HDR_FROM=AjxEmailAddress.FROM;\nZmMailMsg.HDR_TO=AjxEmailAddress.TO;\nZmMailMsg.HDR_CC=AjxEmailAddress.CC;\nZmMailMsg.HDR_BCC=AjxEmailAddress.BCC;\nZmMailMsg.HDR_REPLY_TO=AjxEmailAddress.REPLY_TO;\nZmMailMsg.HDR_SENDER=AjxEmailAddress.SENDER;\nZmMailMsg.HDR_DATE=\"DATE\";\nZmMailMsg.HDR_SUBJECT=\"SUBJECT\";\nZmMailMsg.HDR_LISTID=\"List-ID\";\nZmMailMsg.HDR_XZIMBRADL=\"X-Zimbra-DL\";\nZmMailMsg.HDR_INREPLYTO=\"IN-REPLY-TO\";\nZmMailMsg.HDR_KEY={};\nZmMailMsg.HDR_KEY[ZmMailMsg.HDR_FROM]=ZmMsg.from;\nZmMailMsg.HDR_KEY[ZmMailMsg.HDR_TO]=ZmMsg.to;\nZmMailMsg.HDR_KEY[ZmMailMsg.HDR_CC]=ZmMsg.cc;\nZmMailMsg.HDR_KEY[ZmMailMsg.HDR_BCC]=ZmMsg.bcc;\nZmMailMsg.HDR_KEY[ZmMailMsg.HDR_REPLY_TO]=ZmMsg.replyTo;\nZmMailMsg.HDR_KEY[ZmMailMsg.HDR_SENDER]=ZmMsg.sender;\nZmMailMsg.HDR_KEY[ZmMailMsg.HDR_DATE]=ZmMsg.sentAt;\nZmMailMsg.HDR_KEY[ZmMailMsg.HDR_SUBJECT]=ZmMsg.subject;\nZmMailMsg.STATUS_LIST=[\"isScheduled\",\"isDraft\",\"isReplied\",\"isForwarded\",\"isSent\",\"isUnread\"];\nZmMailMsg.STATUS_ICON={};\nZmMailMsg.STATUS_ICON.isDraft=\"MsgStatusDraft\";\nZmMailMsg.STATUS_ICON.isReplied=\"MsgStatusReply\";\nZmMailMsg.STATUS_ICON.isForwarded=\"MsgStatusForward\";\nZmMailMsg.STATUS_ICON.isSent=\"MsgStatusSent\";\nZmMailMsg.STATUS_ICON.isUnread=\"MsgStatusUnread\";\nZmMailMsg.STATUS_ICON.isScheduled=\"SendLater\";\nZmMailMsg.PSTATUS_ACCEPT=\"AC\";\nZmMailMsg.PSTATUS_DECLINED=\"DE\";\nZmMailMsg.PSTATUS_TENTATIVE=\"TE\";\nZmMailMsg.STATUS_ICON[ZmMailMsg.PSTATUS_ACCEPT]=\"CalInviteAccepted\";\nZmMailMsg.STATUS_ICON[ZmMailMsg.PSTATUS_DECLINED]=\"CalInviteDeclined\";\nZmMailMsg.STATUS_ICON[ZmMailMsg.PSTATUS_TENTATIVE]=\"CalInviteTentative\";\nZmMailMsg.TOOLTIP={};\nZmMailMsg.TOOLTIP.Appointment=ZmMsg.appointment;\nZmMailMsg.TOOLTIP.CalInviteAccepted=ZmMsg.ptstAccept;\nZmMailMsg.TOOLTIP.CalInviteDeclined=ZmMsg.ptstDeclined;\nZmMailMsg.TOOLTIP.CalInviteTentative=ZmMsg.ptstTentative;\nZmMailMsg.SUBJ_PREFIX_RE=new RegExp(\"^\\\\s*(Re|Fw|Fwd|\"+ZmMsg.re+\"|\"+ZmMsg.fwd+\"|\"+ZmMsg.fw+\"):\\\\s*\",\"i\");\nZmMailMsg.URL_RE=/((telnet:)|((https?|ftp|gopher|news|file):\\/\\/)|(www\\.[\\w\\.\\_\\-]+))[^\\s\\xA0\\(\\)\\<\\>\\[\\]\\{\\}\\'\\\"]*/i;\nZmMailMsg.CONTENT_PART_ID=\"ci\";\nZmMailMsg.CONTENT_PART_LOCATION=\"cl\";\nZmMailMsg.requestHeaders={listId:ZmMailMsg.HDR_LISTID,xZimbraDL:ZmMailMsg.HDR_XZIMBRADL,replyTo:ZmMailMsg.HDR_INREPLYTO};\nZmMailMsg.fetchMsg=function(d){var f={GetMsgRequest:{_jsns:\"urn:zimbraMail\"}};\nvar c=f.GetMsgRequest;\nvar b=c.m={};\nb.id=d.msgId;\nif(d.partId){b.part=d.partId\n}if(d.markRead){b.read=1\n}if(d.getHtml){b.html=1\n}if(d.needExp!==false){b.needExp=1\n}if(d.ridZ){b.ridZ=d.ridZ\n}ZmMailMsg.addRequestHeaders(b);\nif(!d.noTruncate){b.max=appCtxt.get(ZmSetting.MAX_MESSAGE_SIZE)||ZmMailApp.DEFAULT_MAX_MESSAGE_SIZE\n}if(d.batchCmd){d.batchCmd.addRequestParams(f,d.callback)\n}else{var e={jsonObj:f,asyncMode:true,offlineCache:true,callback:ZmMailMsg._handleResponseFetchMsg.bind(null,d.callback),errorCallback:d.errorCallback,noBusyOverlay:d.noBusyOverlay,accountName:d.accountName};\ne.offlineCallback=ZmMailMsg._handleOfflineResponseFetchMsg.bind(null,b.id,e.callback);\nd.sender.sendRequest(e)\n}};\nZmMailMsg._handleResponseFetchMsg=function(c,b){if(c){c.run(b)\n}};\nZmMailMsg._handleOfflineResponseFetchMsg=function(c,d){var b=ZmMailMsg._handleOfflineResponseFetchMsgCallback.bind(null,d);\nZmOfflineDB.getItem(c,ZmApp.MAIL,b)\n};\nZmMailMsg._handleOfflineResponseFetchMsgCallback=function(d,b){var c={GetMsgResponse:{m:b}};\nif(d){d(new ZmCsfeResult(c))\n}};\nZmMailMsg.stripSubjectPrefixes=function(b){var c=ZmMailMsg.SUBJ_PREFIX_RE;\nwhile(c.test(b)){b=b.replace(c,\"\")\n}return b\n};\nZmMailMsg.prototype.getAddresses=function(j,m,b,c){if(!m){return this._addrs[j]\n}else{var k=this._addrs[j].getArray();\nvar f=[];\nfor(var d=0;\nd<k.length;\nd++){var h=k[d];\nvar g=h.getAddress();\nif(!g){continue\n}g=g.toLowerCase();\nif(!m[g]){var e=h;\nif(b){var l=AjxDispatcher.run(\"GetContacts\");\ne=l&&l.getContactByEmail(g);\nif(e==null||!l){e=new ZmContact(null);\ne.initFromEmail(h)\n}}f.push(e)\n}if(!c){m[g]=true\n}}return AjxVector.fromArray(f)\n}};\nZmMailMsg.prototype.getReplyAddresses=function(f,c,e){if(!this.isSent){var d=this._addrs[AjxEmailAddress.REPLY_TO]\n}if(!d&&this.isInvite()&&this.needsRsvp()){var b=this.invite.getOrganizerEmail(0);\nif(b){return AjxVector.fromArray([new AjxEmailAddress(b)])\n}}if(!(d&&d.size())){if(f==ZmOperation.REPLY_CANCEL||(this.isSent&&f==ZmOperation.REPLY_ALL)){d=this.isInvite()?this._getAttendees():this.getAddresses(AjxEmailAddress.TO,c,false,true)\n}else{d=this.getAddresses(AjxEmailAddress.FROM,c,false,true);\nif(d.size()==0){d=this.getAddresses(AjxEmailAddress.TO,c,false,true)\n}}}return d\n};\nZmMailMsg.prototype._getAttendees=function(){var d=this.invite.components[0].at;\nvar e=new AjxVector();\nfor(var c=0;\nc<(d?d.length:0);\nc++){var b=d[c];\ne.add(new AjxEmailAddress(b.a,null,null,b.d))\n}return e\n};\nZmMailMsg.prototype.getAddress=function(b){return this._addrs[b].get(0)\n};\nZmMailMsg.prototype.getFragment=function(b){var c=this.fragment;\nif(b&&c&&c.length){c=c.substring(0,b);\nif(this.fragment.length>b){c+=\"...\"\n}}return c\n};\nZmMailMsg.prototype.isReadOnly=function(){if(this._isReadOnly==null){var b=appCtxt.getById(this.folderId);\nthis._isReadOnly=(b?b.isReadOnly():false)\n}return this._isReadOnly\n};\nZmMailMsg.prototype.getHeaderStr=function(g,f){var c,e;\nif(g==ZmMailMsg.HDR_DATE){if(this.sentDate){var b=AjxDateFormat.getDateTimeInstance(AjxDateFormat.FULL,AjxDateFormat.MEDIUM);\ne=b.format(new Date(this.sentDate))\n}}else{if(g==ZmMailMsg.HDR_SUBJECT){e=this.subject\n}else{var d=this.getAddresses(g);\ne=d.toString(\", \",true)\n}}var c=ZmMailMsg.HDR_KEY[g]+\": \";\nif(!e){return\n}if(f){c=\"<b>\"+c+\"</b>\";\ne=AjxStringUtil.convertToHtml(e)\n}return c+e\n};\nZmMailMsg.prototype.isHtmlMail=function(){if(this.isInvite()){return this.invite.isHtmlInvite()\n}else{return this.getBodyPart(ZmMimeTable.TEXT_HTML)!=null\n}};\nZmMailMsg.prototype.setAddresses=function(c,b){this._onChange(\"address\",c,b);\nthis._addrs[c]=b\n};\nZmMailMsg.prototype.setAddress=function(b,c){this._onChange(\"address\",b,c);\nthis._addrs[b].removeAll();\nthis._addrs[b]=new AjxVector();\nthis._addrs[b].add(c)\n};\nZmMailMsg.prototype.clearAddresses=function(){for(var b=0;\nb<ZmMailMsg.ADDRS.length;\nb++){var c=ZmMailMsg.ADDRS[b];\nthis._addrs[c].removeAll()\n}};\nZmMailMsg.prototype.addAddresses=function(e,d){var c=d.size();\nfor(var b=0;\nb<c;\nb++){this._addrs[e].add(d.get(b))\n}};\nZmMailMsg.prototype.addAddress=function(c,b){b=b||c.type||AjxEmailAddress.TO;\nthis._addrs[b].add(c)\n};\nZmMailMsg.prototype.setSubject=function(b){this._onChange(\"subject\",b);\nthis.subject=b\n};\nZmMailMsg.prototype.setTopPart=function(b){this._onChange(\"topPart\",b);\nthis._topPart=b\n};\nZmMailMsg.prototype.setBodyParts=function(b){this._onChange(\"bodyParts\",b);\nthis._bodyParts=b;\nthis._loaded=this._bodyParts.length>0||this.attachments.length>0\n};\nZmMailMsg.prototype.addAttachmentId=function(b){if(this.attId){b=this.attId+\",\"+b\n}this._onChange(\"attachmentId\",b);\nthis.attId=b\n};\nZmMailMsg.prototype.addInlineAttachmentId=function(e,c,b,d){if(!this._inlineAtts){this._inlineAtts=[]\n}this._onChange(\"inlineAttachments\",c);\nif(d&&c&&b){this._inlineAtts.push({cid:e,mid:c,part:b})\n}else{if(c){this._inlineAtts.push({cid:e,aid:c})\n}else{if(b){this._inlineAtts.push({cid:e,part:b})\n}}}};\nZmMailMsg.prototype._resetAllInlineAttachments=function(){this._inlineAtts=[];\nfor(var b=0;\nb<this.attachments.length;\nb++){this.attachments[b].foundInMsgBody=false\n}};\nZmMailMsg.prototype.addInlineDocAttachment=function(e,c,d,b){if(!this._inlineDocAtts){this._inlineDocAtts=[]\n}this._onChange(\"inlineDocAttachments\",c,d,b);\nif(c){this._inlineDocAtts.push({cid:e,docid:c})\n}else{if(d){this._inlineDocAtts.push({cid:e,docpath:d})\n}else{if(b){this._inlineDocAtts.push({cid:e,part:b})\n}}}};\nZmMailMsg.prototype.setInlineAttachments=function(b){if(b){this._inlineAtts=b\n}};\nZmMailMsg.prototype.getInlineAttachments=function(){return this._inlineAtts||[]\n};\nZmMailMsg.prototype.getInlineDocAttachments=function(){return this._inlineDocAtts||[]\n};\nZmMailMsg.prototype.findInlineAtt=function(c){if(!(this.attachments&&this.attachments.length)){return null\n}for(var b=0;\nb<this.attachments.length;\nb++){if(this.attachments[b].contentId==c){return this.attachments[b]\n}}return null\n};\nZmMailMsg.prototype.setMessageAttachmentId=function(b){this._onChange(\"messageAttachmentId\",b);\nthis._msgAttIds=b\n};\nZmMailMsg.prototype.setDocumentAttachments=function(b){this._onChange(\"documentAttachmentId\",b);\nthis._docAtts=b\n};\nZmMailMsg.prototype.addDocumentAttachment=function(b){if(!this._docAtts){this._docAtts=[]\n}this._docAtts.push(b)\n};\nZmMailMsg.prototype.setForwardAttIds=function(b){this._onChange(\"forwardAttIds\",b);\nthis._forAttIds=b\n};\nZmMailMsg.prototype.setForwardAttObjs=function(b){this._forAttObjs=b\n};\nZmMailMsg.prototype.setContactAttIds=function(b){b=AjxUtil.toArray(b);\nthis._onChange(\"contactAttIds\",b);\nthis._contactAttIds=b\n};\nZmMailMsg.createFromDom=function(d,c,b){var e=new ZmMailMsg(d.id,c.list,b);\ne._loadFromDom(d);\nreturn e\n};\nZmMailMsg.prototype.load=function(c){if(this._loading&&!c.forceLoad){this._loadingWaitCount=(this._loadingWaitCount||0)+1;\nif(this._loadingWaitCount>20){this._loadingWaitCount=0;\nthis._loading=false\n}else{setTimeout(this.load.bind(this,c),500);\nreturn\n}}if(!this._loaded||c.forceLoad){this._loading=true;\nvar d=this._handleResponseLoad.bind(this,c,c.callback);\nc.getHtml=c.getHtml||this.isDraft||appCtxt.get(ZmSetting.VIEW_AS_HTML);\nc.sender=appCtxt.getAppController();\nc.msgId=this.id;\nc.partId=this.partId;\nc.callback=d;\nvar b=this._handleResponseLoadFail.bind(this,c,c.errorCallback);\nc.errorCallback=b;\nZmMailMsg.fetchMsg(c)\n}else{if(c.callback){c.callback.run(new ZmCsfeResult())\n}}};\nZmMailMsg.prototype._handleResponseLoad=function(d,e,b){var c=b.getResponse().GetMsgResponse;\nthis.clearAddresses();\nif(this.participants){this.participants.removeAll()\n}this._loadFromDom(c.m[0]);\nif(!this.isReadOnly()&&d.markRead){this.markRead()\n}else{this._setupNotify()\n}this.findAttsFoundInMsgBody();\nthis._loading=false;\nif(this._loadCallback){this._loadCallback.run(b);\nthis._loadCallback=null\n}else{if(e){e.run(b)\n}}};\nZmMailMsg.prototype.markRead=function(){if(!this.isReadOnly()){this._markReadLocal(!appCtxt.isWebClientOffline())\n}};\nZmMailMsg.prototype._handleResponseLoadFail=function(c,d,b){this._loading=false;\nif(d){return d.run(b)\n}};\nZmMailMsg.prototype._handleIndexedDBResponse=function(i,g,b){var h=b[0],d,f={},c=g.methodName;\nif(h){d=h[h.methodName][\"m\"];\nif(d){d.su=d.su._content;\nd.fr=d.mp[0].content._content;\nd.mp[0].content=d.fr;\nif(d.fr){d.mp[0].body=true\n}f[c.replace(\"Request\",\"Response\")]={m:[d]};\nvar e=new ZmCsfeResult(f);\nthis._handleResponseLoad(i,i.callback,e)\n}}};\nZmMailMsg.prototype.isLoaded=function(){return this._loaded\n};\nZmMailMsg.prototype.getBodyParts=function(f){if(f){this._lastContentType=f\n}if(!this.hasContentType(ZmMimeTable.MULTI_ALT)){return this._bodyParts\n}f=f||this._lastContentType;\nvar e=[];\nfor(var c=0;\nc<this._bodyParts.length;\nc++){var b=this._bodyParts[c];\nif(b.isZmMimePart){e.push(b)\n}else{if(b){var d=f&&b[f];\ne.push(d||AjxUtil.values(b)[0])\n}}}return e\n};\nZmMailMsg.prototype.hasContentType=function(b){return this._contentType[b]\n};\nZmMailMsg.prototype.hasMultipleBodyParts=function(){var b=this.getBodyParts();\nreturn(b&&b.length>1)\n};\nZmMailMsg.prototype.getBodyPart=function(e,d){if(e){this._lastContentType=e\n}function c(j){var g=this.getBodyParts(j);\nfor(var h=0;\nh<g.length;\nh++){var f=g[h];\nf=f.isZmMimePart?f:f[j];\nif(!j||(f.contentType===j)){return f\n}}}var b=c.call(this,e);\nif(this.isInvite()){if(!b){if(e===ZmMimeTable.TEXT_HTML){b=c.call(this,ZmMimeTable.TEXT_PLAIN)\n}else{if(e===ZmMimeTable.TEXT_PLAIN){b=c.call(this,ZmMimeTable.TEXT_HTML)\n}}}if(!b||(b&&!b.getContent())){b=this.getInviteDescriptionContent(e)\n}}if(d){if(b){d.run(b)\n}else{if(this.hasContentType(ZmMimeTable.MULTI_ALT)&&((e==ZmMimeTable.TEXT_PLAIN&&this.hasContentType(ZmMimeTable.TEXT_PLAIN))||(e==ZmMimeTable.TEXT_HTML&&this.hasContentType(ZmMimeTable.TEXT_HTML)))){ZmMailMsg.fetchMsg({sender:appCtxt.getAppController(),msgId:this.id,getHtml:(e==ZmMimeTable.TEXT_HTML),callback:this._handleResponseFetchAlternativePart.bind(this,e,d)})\n}else{d.run()\n}}}return b\n};\nZmMailMsg.prototype.fetchAlternativePart=function(d,c){var b=this._handleResponseFetchAlternativePart.bind(this,d,c);\nZmMailMsg.fetchMsg({sender:appCtxt.getAppController(),msgId:this.id,getHtml:(d==ZmMimeTable.TEXT_HTML),callback:b})\n};\nZmMailMsg.prototype._handleResponseFetchAlternativePart=function(j,h,b){var c=b.getResponse().GetMsgResponse;\nvar f=this._topPart&&this._topPart.addAlternativePart(c.m[0].mp[0],j,0);\nif(f){var g=false;\nfor(var d=0;\nd<this._bodyParts.length;\nd++){var e=this._bodyParts[d];\nif(!e.isZmMimePart){e[f.contentType]=f\n}}}if(h){h.run()\n}};\nZmMailMsg.prototype.getBodyContent=function(d,c){if(d){this._lastContentType=d\n}if(d==ZmMimeTable.TEXT_HTML&&!c&&this._htmlBody){return this._htmlBody\n}var b=this._loaded&&this.getBodyPart(d);\nreturn b?b.getContent():\"\"\n};\nZmMailMsg.getTextFromCalendarPart=function(d){var g=d?d.getContent():\"\";\nvar c=g.split(/\\r\\n/);\nvar k=[];\nvar h=\"\";\nfor(var f=0;\nf<c.length;\nf++){var b=c[f];\nif(b.match(/^DESCRIPTION:/)){k.push(b.substr(12));\nfor(var e=f+1;\ne<c.length;\ne++){b=c[e];\nif(b.match(/^\\s+/)){k.push(b.replace(/^\\s+/,\" \"));\ncontinue\n}break\n}break\n}else{if(b.match(/^COMMENT:/)){k.push(b.substr(8));\nfor(var e=f+1;\ne<c.length;\ne++){b=c[e];\nif(b.match(/^\\s+/)){k.push(b.replace(/^\\s+/,\" \"));\ncontinue\n}break\n}break\n}}}if(k.length>0){h=k.join(\"\");\nh=h.replace(/\\\\t/g,\"\\t\");\nh=h.replace(/\\\\n/g,\"\\n\");\nh=h.replace(/\\\\(.)/g,\"$1\")\n}return h\n};\nZmMailMsg.prototype.getTextBodyPart=function(){var b=this.getBodyPart(ZmMimeTable.TEXT_PLAIN)||this.getBodyPart();\nreturn(b&&b.isBody&&ZmMimeTable.isTextType(b.contentType))?b:null\n};\nZmMailMsg.prototype.hasInlineImage=function(){for(var b=0;\nb<this._bodyParts.length;\nb++){var c=this._bodyParts[b];\nif(c.isZmMimePart&&c.contentDisposition==\"inline\"&&c.fileName&&ZmMimeTable.isRenderableImage(c.contentType)){return true\n}}return false\n};\nZmMailMsg.prototype.setHtmlContent=function(b){this._onChange(\"htmlContent\",b);\nthis._htmlBody=b\n};\nZmMailMsg.prototype.setInviteDescriptionContent=function(c,b){this._inviteDescBody[c]=b\n};\nZmMailMsg.prototype.getInviteDescriptionContentValue=function(b){return this._inviteDescBody[b]\n};\nZmMailMsg.prototype.getInviteDescriptionContent=function(h){if(!h){h=ZmMimeTable.TEXT_HTML\n}var f=this._inviteDescBody[h];\nif(!f){var g=this._inviteDescBody[ZmMimeTable.TEXT_HTML];\nvar e=this._inviteDescBody[ZmMimeTable.TEXT_PLAIN];\nif(!g&&e){g=AjxStringUtil.convertToHtml(e)\n}if(!e&&g){e=AjxStringUtil.convertHtml2Text(g)\n}f=(h==ZmMimeTable.TEXT_HTML)?g:e\n}var b=f?f.indexOf(ZmItem.NOTES_SEPARATOR):-1;\nif(b==-1&&this.isInvite()){var d=this.invite.getSummary((h==ZmMimeTable.TEXT_HTML));\nf=f?(d+f):null\n}if(f!=null){var c=new ZmMimePart();\nc.contentType=c.ct=h;\nc.size=c.s=f.length;\nc.node={content:f};\nreturn c\n}};\nZmMailMsg.prototype.sendInviteReply=function(h,e,g,c,b,d,f){this._origMsg=this._origMsg||this;\nif(e==0){this._origMsg._customMsg=true\n}this._sendInviteReply(h,e||0,g,c,b,d,f)\n};\nZmMailMsg.prototype._sendInviteReply=function(f,t,m,n,u,b,q){var w={SendInviteReplyRequest:{_jsns:\"urn:zimbraMail\"}};\nvar l=w.SendInviteReplyRequest;\nl.id=this._origMsg.id;\nl.compNum=t;\nvar i=\"ACCEPT\";\nvar p=true;\nvar x;\nvar r;\nswitch(this.inviteMode){case ZmOperation.REPLY_ACCEPT_IGNORE:p=false;\ncase ZmOperation.REPLY_ACCEPT_NOTIFY:case ZmOperation.REPLY_ACCEPT:i=\"ACCEPT\";\nx=ZmCalBaseItem.PSTATUS_ACCEPT;\nr=ZmMsg.inviteAccepted;\nbreak;\ncase ZmOperation.REPLY_DECLINE_IGNORE:p=false;\ncase ZmOperation.REPLY_DECLINE_NOTIFY:case ZmOperation.REPLY_DECLINE:i=\"DECLINE\";\nx=ZmCalBaseItem.PSTATUS_DECLINED;\nr=ZmMsg.inviteDeclined;\nbreak;\ncase ZmOperation.REPLY_TENTATIVE_IGNORE:p=false;\ncase ZmOperation.REPLY_TENTATIVE_NOTIFY:case ZmOperation.REPLY_TENTATIVE:i=\"TENTATIVE\";\nx=ZmCalBaseItem.PSTATUS_TENTATIVE;\nr=ZmMsg.inviteAcceptedTentatively;\nbreak\n}l.verb=i;\nvar c=this._origMsg.invite;\nif(x){c.replies=[{reply:[{ptst:x}]}];\nif(appCtxt.isWebClientOffline()){var d=c.getMessageId();\nvar k=d;\nif(d.indexOf(\"-\")>=0){d=d.split(\"-\")[1]\n}else{k=[c.getAppointmentId(),d].join(\"-\")\n}var j=this.applyPtstOffline.bind(this,d,x);\nappCtxt.updateOfflineAppt(k,\"ptst\",x,null,j)\n}}if(this.getAddress(AjxEmailAddress.TO)==null&&!c.isOrganizer()){var g=c.getOrganizerEmail()||c.getSentBy();\nif(g==null){var v=window.parentAppCtxt||window.appCtxt;\nvar e=v.accountList.mainAccount.getEmail();\nvar s=this._origMsg.getAddresses(AjxEmailAddress.FROM).get(0);\nif(s&&s.address!=e){g=s.address\n}}if(g){this.setAddress(AjxEmailAddress.TO,(new AjxEmailAddress(g)))\n}}if(!this.identity){var v=window.parentAppCtxt||window.appCtxt;\nvar h=(v.multiAccounts&&v.getActiveAccount().isMain)?v.accountList.defaultAccount:null;\nvar o=v.getIdentityCollection(h);\nthis.identity=o?o.selectIdentity(this._origMsg):null\n}if(this.identity){l.idnt=this.identity.id\n}if(q){p=false\n}this._sendInviteReplyContinue(w,p?\"TRUE\":\"FALSE\",f,m,n,u,b,r)\n};\nZmMailMsg.prototype.applyPtstOffline=function(d,c){var b=this._applyPtstOffline.bind(this,c);\nZmOfflineDB.getItem(d,ZmApp.MAIL,b)\n};\nZmMailMsg.prototype._applyPtstOffline=function(f,d){if(d&&d[0]&&d[0].inv&&d[0].inv[0]){var c=d[0].inv[0];\nif(!c.replies){c.replies=[{reply:[{ptst:f}]}]\n}else{c.replies[0].reply[0].ptst=f\n}d[0].l=ZmFolder.ID_TRASH;\nZmOfflineDB.setItem(d,ZmApp.MAIL);\nvar b=this._origMsg;\nb.moveLocal(ZmFolder.ID_TRASH);\nif(b.list){b.list.moveLocal([b],ZmFolder.ID_TRASH)\n}var e={oldFolderId:b.folderId};\nb._notify(ZmEvent.E_MOVE,e)\n}};\nZmMailMsg.prototype._sendInviteReplyContinue=function(l,f,g,j,e,n,h,m){var d=l.SendInviteReplyRequest;\nd.updateOrganizer=f;\nif(n){var c=AjxDateUtil.getServerDateTime(n);\nvar i=AjxTimezone.getServerId(AjxTimezone.DEFAULT);\nvar b=AjxTimezone.getClientId(i);\nZmTimezone.set(d,b,null,true);\nd.exceptId={d:c,tz:i}\n}if(g){this._createMessageNode(d,null,h)\n}var k=new AjxCallback(this,this._handleResponseSendInviteReply,[j,m]);\nthis._sendMessage({jsonObj:l,isInvite:true,isDraft:false,callback:k,errorCallback:e,accountName:h})\n};\nZmMailMsg.prototype._handleResponseSendInviteReply=function(i,e,c){var f=c.getResponse();\nvar h=f.id?f.id.split(\"-\")[0]:null;\nvar d=(h||f.status==\"OK\");\nif(d){this._notifySendListeners();\nthis._origMsg.folderId=ZmFolder.ID_TRASH\n}var g;\nif((this.acceptFolderId!=appCtxt.get(ZmSetting.CAL_DEFAULT_ID))||(appCtxt.multiAccounts&&!this.getAccount().isMain&&this.acceptFolderId==appCtxt.get(ZmSetting.CAL_DEFAULT_ID))){g=true\n}if(this.acceptFolderId&&g&&f.apptId!=null){this.moveApptItem(f.apptId,this.acceptFolderId)\n}if(window.parentController){window.close()\n}if(e){var b=window.parentAppCtxt||window.appCtxt;\nb.setStatusMsg(e)\n}if(i){i.run(c,this._origMsg.getPtst())\n}};\nZmMailMsg.prototype.getPtst=function(){return this.invite&&this.invite.replies&&this.invite.replies[0].reply[0].ptst\n};\nZmMailMsg.APPT_TRASH_FOLDER=3;\nZmMailMsg.prototype.isInviteCanceled=function(){var b=this.invite;\nif(!b){return false\n}return b.components[0].ciFolder==ZmMailMsg.APPT_TRASH_FOLDER\n};\nZmMailMsg.prototype.moveApptItem=function(f,e){var g=new AjxCallback(this,this._handleMoveApptResponse,[e]);\nvar b=new AjxCallback(this,this._handleMoveApptError,[e]);\nvar d=window.parentAppCtxt||window.appCtxt;\nvar c=d.multiAccounts&&d.accountList.mainAccount.name;\nZmItem.move(f,e,g,b,c)\n};\nZmMailMsg.prototype._handleMoveApptResponse=function(b,c){this._lastApptFolder=b\n};\nZmMailMsg.prototype._handleMoveApptError=function(b,d){var c={msg:ZmMsg.errorMoveAppt,level:ZmStatusView.LEVEL_CRITICAL};\nappCtxt.setStatusMsg(c);\nreturn true\n};\nZmMailMsg.prototype.send=function(b,m,g,j,c,l,d,k,h){var o=j;\nif(!o){var i=appCtxt.getActiveAccount();\nif(i&&!i.isMain){o=i.name\n}}if(this.isInviteReply&&!b){return this.sendInviteReply(true,0,m,g,this._instanceDate,o,false)\n}else{var n,f;\nif(b){n={SaveDraftRequest:{_jsns:\"urn:zimbraMail\"}};\nf=n.SaveDraftRequest\n}else{n={SendMsgRequest:{_jsns:\"urn:zimbraMail\"}};\nf=n.SendMsgRequest;\nif(this.sendUID){f.suid=this.sendUID\n}}if(c){f.noSave=1\n}this._createMessageNode(f,b,o,l,k);\nappCtxt.notifyZimlets(\"addExtraMsgParts\",[f,b]);\nvar e={jsonObj:n,isInvite:false,isDraft:b,isAutoSave:h,accountName:o,callback:(new AjxCallback(this,this._handleResponseSend,[b,m])),errorCallback:g,batchCmd:d,skipOfflineCheck:true};\nthis._sendMessage(e)\n}};\nZmMailMsg.prototype._handleResponseSend=function(c,e,b){var d=b.getResponse().m[0];\nif(!c){if(d.id||!appCtxt.get(ZmSetting.SAVE_TO_SENT)){this._notifySendListeners()\n}}else{this._loadFromDom(d);\nif(d.autoSendTime){this._notifySendListeners()\n}}if(e){e.run(b)\n}};\nZmMailMsg.prototype._createMessageNode=function(g,e,p,m,u){var T=g.m={};\nvar q=window.parentAppCtxt||window.appCtxt;\nvar b=q.accountList.activeAccount;\nvar l=q.accountList.mainAccount;\nvar z=!q.isOffline&&p&&l.name!==p;\nif(this.origId){if(appCtxt.isOffline){var c=this._origMsg&&this._origMsg.getAccount();\nz=q.multiAccounts&&c.id==l.id\n}var E=this.origId;\nif(z){E=ZmOrganizer.getSystemId(this.origId,l,true)\n}T.origid=E\n}var M=null;\nif((e||this.isDraft)&&this.id){var J=q.getById(this.id);\nvar O=J?q.getById(J.folderId):null;\nif(!O||(O&&!O.isInTrash())){if(!q.isOffline&&!e&&this._origMsg&&this._origMsg.isDraft){var C=q.accountList.defaultAccount||q.accountList.mainAccount;\nvar r=this._origMsg.getAddresses(AjxEmailAddress.FROM).get(0);\nif(r&&r.address!=C.getEmail()){M=(this.id.indexOf(\":\")==-1)?([C.id,\":\",this.id].join(\"\")):this.id;\nT.id=M\n}else{T.id=this.nId\n}}else{T.id=this.nId\n}if(!e){var h=this.nId||this.id;\nif(z){h=ZmOrganizer.getSystemId(h,l,true)\n}T.did=h\n}}}if(this.isForwarded){T.rt=\"w\"\n}else{if(this.isReplied){T.rt=\"r\"\n}}if(this.identity){T.idnt=this.identity.id\n}if(this.isHighPriority){T.f=ZmItem.FLAG_HIGH_PRIORITY\n}else{if(this.isLowPriority){T.f=ZmItem.FLAG_LOW_PRIORITY\n}}if(this.isPriority){T.f=ZmItem.FLAG_PRIORITY\n}if(this.isOfflineCreated){T.f=T.f||\"\";\nif(T.f.indexOf(ZmItem.FLAG_OFFLINE_CREATED)===-1){T.f=T.f+ZmItem.FLAG_OFFLINE_CREATED\n}}var H=T.e=[];\nfor(var Q=0;\nQ<ZmMailMsg.COMPOSE_ADDRS.length;\nQ++){var Y=ZmMailMsg.COMPOSE_ADDRS[Q];\nthis._addAddressNodes(H,Y,e)\n}this._addFrom(H,T,e,p);\nthis._addReplyTo(H);\nif(m){this._addReadReceipt(H,p)\n}if(H.length){T.e=H\n}var x=[];\nappCtxt.notifyZimlets(\"addCustomMimeHeaders\",[x]);\nif((x instanceof Array)&&x.length>0){T.header=x\n}T.su={_content:this.subject};\nvar w={ct:this._topPart.getContentType()};\nT.mp=[w];\nvar K=this._topPart.children?this._topPart.children.size():0;\nif(K>0){var V=w.mp=[];\nfor(var Q=0;\nQ<K;\nQ++){var t=this._topPart.children.get(Q);\nvar o=t.getContent();\nvar s=t.children?t.children.size():0;\nif(o==null&&s==0){continue\n}var A={ct:t.getContentType()};\nif(s>0){var G=A.mp=[];\nfor(var P=0;\nP<s;\nP++){var f=t.children.get(P);\nG.push({ct:f.getContentType(),content:{_content:f.getContent()}})\n}if(t.getContentType()==ZmMimeTable.MULTI_RELATED){var F=this.getInlineAttachments()||[];\nif(F.length){for(P=0;\nP<F.length;\nP++){var v={ci:F[P].cid};\nvar X=v.attach={};\nif(F[P].aid){X.aid=F[P].aid\n}else{var E=F[P].mid||(e||this.isDraft)?(F[P].mid||M||this.id||this.origId):(this.origId||this.id);\nif(!E&&this._origMsg){E=this._origMsg.id\n}if(E&&z){E=ZmOrganizer.getSystemId(E,l,true)\n}if(E){X.mp=[{mid:E,part:F[P].part}]\n}}G.push(v)\n}}var k=this.getInlineDocAttachments()||[];\nif(k.length){for(P=0;\nP<k.length;\nP++){var L={ci:k[P].cid};\nvar X=L.attach={};\nif(k[P].docpath){X.doc=[{path:k[P].docpath,optional:1}]\n}else{if(k[P].docid){X.doc=[{id:k[P].docid}]\n}}G.push(L)\n}}}}else{A.content={_content:o}\n}V.push(A)\n}}else{w.content={_content:this._topPart.getContent()}\n}if(this.irtMessageId){T.irt={_content:this.irtMessageId}\n}if(this.attId||(this._msgAttIds&&this._msgAttIds.length)||(this._docAtts&&this._docAtts.length)||(this._forAttIds&&this._forAttIds.length)||(this._contactAttIds&&this._contactAttIds.length)){var X=T.attach={};\nif(this.attId){X.aid=this.attId\n}if(this._msgAttIds&&this._msgAttIds.length){var B=X.m=[];\nfor(var Q=0;\nQ<this._msgAttIds.length;\nQ++){B.push({id:this._msgAttIds[Q]})\n}}if(this._docAtts){var D=X.doc=[];\nfor(var Q=0;\nQ<this._docAtts.length;\nQ++){var U=this._docAtts[Q];\nvar N=(U.id.indexOf(\":\")==-1)?([l.id,U.id].join(\":\")):U.id;\nvar y={id:N};\nif(U.ver){y.ver=U.ver\n}D.push(y)\n}}if(this._forAttObjs&&this._forAttObjs.length){var S=X.mp=this._forAttObjs;\nif(z){for(var Q=0;\nQ<S.length;\nQ++){var t=S[Q];\nt.mid=ZmOrganizer.getSystemId(t.mid,l,true)\n}}}if(this._contactAttIds&&this._contactAttIds.length){X.cn=[];\nfor(var Q=0;\nQ<this._contactAttIds.length;\nQ++){X.cn.push({id:this._contactAttIds[Q]})\n}}}if(u&&u.date){var R=u.date;\nvar n=u.timezone||AjxTimezone.DEFAULT;\nvar I=AjxTimezone.getOffset(n,R);\nvar W=R.getTime()-((R.getTimezoneOffset()+I)*60*1000);\nT.autoSendTime=W\n}};\nZmMailMsg.prototype._sendMessage=function(b){var d=new AjxCallback(this,this._handleResponseSendMessage,[b]),c=this._handleOfflineResponseSendMessage.bind(this,b);\nif(b.batchCmd){b.batchCmd.addNewRequestParams(b.jsonObj,d,b.errorCallback)\n}else{appCtxt.getAppController().sendRequest({jsonObj:b.jsonObj,asyncMode:true,noBusyOverlay:b.isDraft&&b.isAutoSave,callback:d,errorCallback:b.errorCallback,offlineCallback:c,accountName:b.accountName,timeout:((b.isDraft&&this.attId)?0:null)})\n}};\nZmMailMsg.prototype._handleResponseSendMessage=function(d,b){var c=b.getResponse();\nif(d.isInvite){b.set(c.SendInviteReplyResponse)\n}else{if(d.isDraft){b.set(c.SaveDraftResponse)\n}else{b.set(c.SendMsgResponse)\n}}if(d.callback){d.callback.run(b)\n}};\nZmMailMsg.prototype._handleOfflineResponseSendMessage=function(k){var t=$.extend(true,{},k.jsonObj),r=Object.keys(t)[0],b=t[r].m,p=b.attach,n=this._origMsg,d=new Date().getTime(),s,f=[];\nvar c=this.getFolderId();\nt.methodName=r;\nb.d=d;\nif(p&&p.aid){var h=p.aid.split(\",\");\nfor(var m=0;\nm<h.length;\nm++){var o=h[m];\nif(o){f.push(o);\np[o]=appCtxt.getById(o);\nappCtxt.cacheRemove(o)\n}}}if(n&&n.hasAttach){var e=n.attachments;\nif(p){delete p.mp\n}else{p=b.attach={}\n}for(var l=0;\nl<e.length;\nl++){var g=e[l].node;\nif(g&&g.isOfflineUploaded){f.push(g.aid);\np[g.aid]=g\n}}}if(p){if(f.length>0){p.aid=f.join()\n}if(Object.keys(p).length===0){delete b.attach\n}}if(this.getInlineAttachments().length>0||(n&&n.getInlineAttachments().length>0)){b.isInlineAttachment=true\n}s=this._handleOfflineResponseSendMessageCallback.bind(this,k,t);\nif(c==ZmFolder.ID_OUTBOX){b.id=n&&n.id\n}if(b.id){t.id=b.id;\nvar q={update:true,methodName:r,id:b.id,value:t};\nZmOfflineDB.setItemInRequestQueue(q,s)\n}else{t.id=b.id=d.toString();\nb.f=(b.f||\"\").replace(ZmItem.FLAG_OFFLINE_CREATED,\"\").concat(ZmItem.FLAG_OFFLINE_CREATED);\nZmOfflineDB.setItemInRequestQueue(t,s)\n}};\nZmMailMsg.prototype._handleOfflineResponseSendMessageCallback=function(g,i){var c=ZmOffline.generateMsgResponse(i);\nvar f={},h=this._generateOfflineHeader(g,i,c),e=h.context.notify[0],b;\nif(!g.isInvite){ZmOfflineDB.setItem(c,ZmApp.MAIL)\n}f[i.methodName.replace(\"Request\",\"Response\")]=e.modified;\nb=new ZmCsfeResult(f,false,h);\nthis._handleResponseSendMessage(g,b);\nappCtxt.getRequestMgr()._notifyHandler(e);\nif(!g.isDraft&&!g.isInvite){var d={methodName:\"SaveDraftRequest\",id:i[i.methodName].m.id};\nZmOfflineDB.deleteItemInRequestQueue(d)\n}};\nZmMailMsg.prototype._generateOfflineHeader=function(e,g,b){var d=[],f={context:{notify:[{created:{m:b},modified:{folder:d,m:b}}]}};\nif(!e.isInvite){var c=this.getFolderId();\nif(e.isDraft||e.isAutoSave){if(c!=ZmFolder.ID_DRAFTS){d.push({id:ZmFolder.ID_DRAFTS,n:appCtxt.getById(ZmFolder.ID_DRAFTS).numTotal+1})\n}}else{if(c!=ZmFolder.ID_OUTBOX){d.push({id:ZmFolder.ID_OUTBOX,n:appCtxt.getById(ZmFolder.ID_OUTBOX).numTotal+1})\n}if(c==ZmFolder.ID_DRAFTS){d.push({id:ZmFolder.ID_DRAFTS,n:appCtxt.getById(ZmFolder.ID_DRAFTS).numTotal-1})\n}}}return f\n};\nZmMailMsg.prototype._notifySendListeners=function(){var b,c;\nif(this.isForwarded){b=ZmItem.FLAG_FORWARDED;\nc=this._origMsg\n}else{if(this.isReplied){b=ZmItem.FLAG_REPLIED;\nc=this._origMsg\n}}if(b&&c){c[ZmItem.FLAG_PROP[b]]=true;\nif(c.list){c.list._notify(ZmEvent.E_FLAGS,{items:[c.list],flags:[b]})\n}}};\nZmMailMsg.prototype.detachedChangeListener=function(c){var b=c.item;\nthis.isUnread=b.isUnread;\nthis.isFlagged=b.isFlagged\n};\nZmMailMsg.prototype.isRealAttachment=function(c){var b=c.contentType;\nif(ZmMimeTable.isIgnored(b)){return false\n}if(b==ZmMimeTable.TEXT_CAL&&appCtxt.get(ZmSetting.CALENDAR_ENABLED)&&this.isInvite()){return false\n}return true\n};\nZmMailMsg.prototype.getContentPartAttachUrl=function(c,d){if(c!=ZmMailMsg.CONTENT_PART_ID&&c!=ZmMailMsg.CONTENT_PART_LOCATION){return null\n}var b=this._getContentPartAttachUrlFromCollection(this.attachments,c,d);\nif(b){return b\n}return this._getContentPartAttachUrlFromCollection(this._bodyParts,c,d)\n};\nZmMailMsg.prototype._getContentPartAttachUrlFromCollection=function(f,d,e){if(!f){return null\n}for(var c=0;\nc<f.length;\nc++){var b=f[c];\nif(b[d]==e){return this.getUrlForPart(b)\n}}return null\n};\nZmMailMsg.prototype.findAttsFoundInMsgBody=function(){if(this.findAttsFoundInMsgBodyDone){return\n}var f=\"\",g;\nvar d=this.getBodyParts();\nfor(var e=0;\ne<d.length;\ne++){var c=d[e];\nif(c.contentType==ZmMimeTable.TEXT_HTML){f=c.getContent();\nvar b=this;\nf.replace(/src=([\\x27\\x22])cid:([^\\x27\\x22]+)\\1/ig,function(i,j,k){k=k.replace(/&#64;/g,\"@\");\nvar h=b.findInlineAtt(\"<\"+AjxStringUtil.urlComponentDecode(k)+\">\");\nif(h){h.foundInMsgBody=true\n}})\n}}this.findAttsFoundInMsgBodyDone=true\n};\nZmMailMsg.prototype.hasInlineImagesInMsgBody=function(){var b=this.getBodyContent(ZmMimeTable.TEXT_HTML);\nreturn(b&&b.search(/src=([\\x27\\x22])cid:([^\\x27\\x22]+)\\1/ig)!=-1)\n};\nZmMailMsg.prototype.getAttachmentCount=function(c){var b=c?[].concat(this.attachments,this._getInlineAttachments()):this.attachments;\nreturn b?b.length:0\n};\nZmMailMsg.prototype._getInlineAttachments=function(){var e=[];\nvar d=this.getBodyParts();\nif(d&&d.length>1){var c;\nfor(var b=0;\nb<d.length;\nb++){c=d[b];\nif(c.fileName&&c.contentDisposition==\"inline\"){e.push(c)\n}}}return e\n};\nZmMailMsg.prototype.getAttachmentInfo=function(g,b,f){this._attInfo=[];\nvar h=(f||b)?[].concat(this.attachments,this._getInlineAttachments()):this.attachments;\nif(h&&h.length>0){this.findAttsFoundInMsgBody();\nfor(var j=0;\nj<h.length;\nj++){var k=h[j];\nif(!this.isRealAttachment(k)||(k.contentType.match(/^image/)&&k.contentId&&k.foundInMsgBody&&!b)||(k.contentDisposition==\"inline\"&&k.fileName&&ZmMimeTable.isRenderableText(k.contentType,k.isBody)&&!f)||(k.contentDisposition==\"inline\"&&(k.contentType===\"application/pdf\"||k.contentType===\"text/html\")&&k.contentId&&k.foundInMsgBody)){continue\n}var q={};\nq.links={};\nq.label=k.name||k.fileName||(ZmMsg.unknown+\" <\"+k.contentType+\">\");\nvar e=false;\nq.sizeInBytes=k.s||0;\nif(k.size!=null&&k.size>=0){var m=AjxNumberFormat.getInstance();\nif(k.size<1024){q.size=m.format(k.size)+\" \"+ZmMsg.b\n}else{if(k.size<(1024*1024)){q.size=m.format(Math.round((k.size/1024)*10)/10)+\" \"+ZmMsg.kb\n}else{q.size=m.format(Math.round((k.size/(1024*1024))*10)/10)+\" \"+ZmMsg.mb\n}}}if(k.part){e=k.contentLocation&&(k.relativeCl||ZmMailMsg.URL_RE.test(k.contentLocation))\n}else{e=k.contentLocation&&true\n}if(k.contentType==ZmMimeTable.MSG_RFC822){q.rfc822Part=k.part;\nvar p=(k.children.size()==1)&&k.children.get(0);\nif(appCtxt.get(ZmSetting.CALENDAR_ENABLED)&&p&&(p.contentType==ZmMimeTable.TEXT_CAL)){q.links.importICS=true;\nq.rfc822CalPart=p.part\n}}else{var c=e?k.contentLocation:this.getUrlForPart(k);\nif(!e){var o=c.indexOf(\"?auth=co&\");\nvar r=AjxStringUtil.urlComponentEncode(k.fileName);\nr=r.replace(/\\x27/g,\"%27\");\nc=c.substring(0,o)+r+c.substring(o)\n}if(!e){q.links.download=true\n}var d=appCtxt.getById(this.folderId);\nif((k.name||k.fileName)&&appCtxt.get(ZmSetting.BRIEFCASE_ENABLED)){if(!e){q.links.briefcase=true\n}}var l=(k.fileName&&k.fileName.match(/\\./)&&k.fileName.replace(/^.*\\./,\"\").toLowerCase()==\"ics\");\nif(appCtxt.get(ZmSetting.CALENDAR_ENABLED)&&((k.contentType==ZmMimeTable.TEXT_CAL)||l)){q.links.importICS=true\n}if(!e){if(ZmMimeTable.isVcard(k.contentType)){q.links.vcard=true\n}else{if(ZmMimeTable.hasHtmlVersion(k.contentType)&&appCtxt.get(ZmSetting.VIEW_ATTACHMENT_AS_HTML)){q.links.html=true\n}else{var s=k.contentType;\nq.objectify=s&&s.match(/^image/)&&!s.match(/tif/)\n}}}else{q.url=c\n}if(k.part){q.links.remove=true\n}}var n=ZmMimeTable.getInfo(k.contentType);\nq.linkIcon=n?n.image:\"GenericDoc\";\nq.ct=k.contentType;\nq.isHit=g&&this._isAttInHitList(k);\nif(k.part){q.part=k.part\n}else{q.generated=true;\nq.part=k.cachekey\n}if(!e){if(k.node&&k.node.isOfflineUploaded){q.url=k.node.data\n}else{q.url=this.getUrlForPart(k)\n}}if(k.contentId||(b&&k.contentDisposition==\"inline\")){q.ci=true\n}q.mid=this.id;\nq.foundInMsgBody=k.foundInMsgBody;\nthis._attInfo.push(q)\n}}return this._attInfo\n};\nZmMailMsg.prototype.getAttachmentLinks=ZmMailMsg.prototype.getAttachmentInfo;\nZmMailMsg.prototype.removeAttachments=function(c,f){var e={RemoveAttachmentsRequest:{_jsns:\"urn:zimbraMail\"}};\nvar b=e.RemoveAttachmentsRequest;\nb.m={id:this.id,part:c.join(\",\")};\nvar d={jsonObj:e,asyncMode:true,callback:f,noBusyOverlay:true};\nreturn appCtxt.getAppController().sendRequest(d)\n};\nZmMailMsg.prototype._loadFromDom=function(b){if(b.id){this.id=b.id\n}if(b.part){this.partId=b.part\n}if(b.cid){this.cid=b.cid\n}if(b.s){this.size=b.s\n}if(b.d){this.date=b.d\n}if(b.sd){this.sentDate=b.sd\n}if(b.l){this.folderId=b.l\n}if(b.tn){this._parseTagNames(b.tn)\n}if(b.cm){this.inHitList=b.cm\n}if(b.su){this.subject=b.su\n}if(b.fr){this.fragment=b.fr\n}if(b.rt){this.rt=b.rt\n}if(b.origid){this.origId=b.origid\n}if(b.hp){this._attHitList=b.hp\n}if(b.mid){this.messageId=b.mid\n}if(b.irt){this.irtMessageId=b.irt\n}if(b._attrs){this.attrs=b._attrs\n}if(b.sf){this.sf=b.sf\n}if(b.cif){this.cif=b.cif\n}if(b.md){this.md=b.md\n}if(b.ms){this.ms=b.ms\n}if(b.rev){this.rev=b.rev\n}if(b.idnt){var f=appCtxt.getIdentityCollection();\nthis.identity=f&&f.getById(b.idnt)\n}if(b.header){this.headers={};\nfor(var k=0;\nk<b.header.length;\nk++){this.headers[b.header[k].n]=b.header[k]._content\n}}if(b.meta){this.meta={};\nfor(var k=0;\nk<b.meta.length;\nk++){var p=b.meta[k].section;\nthis.meta[p]={};\nthis.meta[p]._attrs={};\nfor(a in b.meta[k]._attrs){this.meta[p]._attrs[a]=b.meta[k]._attrs[a]\n}}}var q=this.id.indexOf(\":\");\nthis.nId=(q!=-1)?(this.id.substr(q+1)):this.id;\nif(b._convCreateNode){this._convCreateNode=b._convCreateNode\n}if(b.cid&&b.l){var s=appCtxt.getById(b.cid);\nif(s){if(s.folders){s.folders[b.l]=true\n}var c=AjxUtil.keys(s.folders);\nAjxDebug.println(AjxDebug.NOTIFY,\"update conv folder list: conv spans \"+c.length+\" folder(s): \"+c.join(\" \"));\nif(!s.msgIds){s.msgIds=[this.id]\n}if(s.isMute){this.isMute=true\n}}}this._parseFlags(b.f);\nif(b.mp){this.attachments=[];\nthis._bodyParts=[];\nthis._contentType={};\nthis.findAttsFoundInMsgBodyDone=false;\nvar n={attachments:this.attachments,bodyParts:this._bodyParts,contentTypes:this._contentType};\nthis._topPart=ZmMimePart.createFromDom(b.mp[0],n);\nthis._loaded=this._bodyParts.length>0||this.attachments.length>0;\nthis._cleanupCIds()\n}if(b.shr){var d=AjxXmlDoc.createFromXml(b.shr[0].content);\ntry{AjxDispatcher.require(\"Share\");\nthis.share=ZmShare.createFromDom(d.getDoc());\nthis.share._msgId=b.id\n}catch(o){}}if(b.dlSubs){var r=AjxXmlDoc.createFromXml(b.dlSubs[0].content);\ntry{this.subscribeReq=ZmMailMsg.createDlSubFromDom(r.getDoc());\nthis.subscribeReq._msgId=b.id\n}catch(o){}}if(b.e&&this.participants&&this.participants.size()==0){for(var k=0;\nk<b.e.length;\nk++){this._parseParticipantNode(b.e[k])\n}this.clearAddresses();\nvar h=this.participants.getArray();\nfor(var g=0;\ng<h.length;\ng++){this.addAddress(h[g])\n}}if(b.autoSendTime){var m=parseInt(b.autoSendTime)||null;\nif(m){this.setAutoSendTime(new Date(m))\n}}if(b.inv){try{this.invite=ZmInvite.createFromDom(b.inv);\nif(this.invite.isEmpty()){return\n}this.invite.setMessageId(this.id);\nvar l=this.invite.getComponentDescription();\nvar e=this.invite.getComponentDescriptionHtml();\nif(e){this.setHtmlContent(e);\nthis.setInviteDescriptionContent(ZmMimeTable.TEXT_HTML,e)\n}if(l){this.setInviteDescriptionContent(ZmMimeTable.TEXT_PLAIN,l)\n}if(!appCtxt.get(ZmSetting.CALENDAR_ENABLED)&&this.invite.type==\"appt\"){this.flagLocal(ZmItem.FLAG_ATTACH,true)\n}}catch(o){}}if(b.certificate){this.certificate=b.certificate\n}if(b.isSigned){this.isSigned=b.isSigned==\"true\"\n}if(b.isEncrypted){this.isEncrypted=b.isEncrypted==\"true\"\n}if(b.decryptionErrorCode){this.decryptionErrorCode=b.decryptionErrorCode\n}};\nZmMailMsg.createDlSubFromDom=function(d){var b={};\nvar c=d.documentElement;\nb.version=c.getAttribute(\"version\");\nb.subscribe=c.getAttribute(\"action\")==\"subscribe\";\nif(b.version!=ZmMailMsg.DL_SUB_VERSION){throw\"Zimbra dl sub version must be \"+ZmMailMsg.DL_SUB_VERSION\n}for(var e=c.firstChild;\ne!=null;\ne=e.nextSibling){if(e.nodeName!=\"dl\"&&e.nodeName!=\"user\"){continue\n}b[e.nodeName]={id:e.getAttribute(\"id\"),email:e.getAttribute(\"email\"),name:e.getAttribute(\"name\")}\n}if(!b.dl){throw\"missing dl element\"\n}if(!b.user){throw\"missing user element\"\n}return b\n};\nZmMailMsg.prototype.hasNoViewableContent=function(){if(this.isRfc822){return false\n}var b=this.invite&&!this.invite.isEmpty();\nreturn !this.fragment&&!b&&!this.hasInlineImagesInMsgBody()&&!this.hasInlineImage()\n};\nZmMailMsg.prototype._cleanupCIds=function(d){d=d||this.attachments;\nif(!d||d.length==0){return\n}for(var c=0;\nc<d.length;\nc++){var b=d[c];\nif(b.contentId&&!/^<.+>$/.test(b.contentId)){b.contentId=\"<\"+b.contentId+\">\"\n}}};\nZmMailMsg.prototype.mute=function(){this.isMute=true\n};\nZmMailMsg.prototype.unmute=function(){this.isMute=false\n};\nZmMailMsg.prototype.isInvite=function(){return(this.invite!=null)\n};\nZmMailMsg.prototype.forwardAsInvite=function(){if(!this.invite){return false\n}return this.invite.getInviteMethod()==\"REQUEST\"\n};\nZmMailMsg.prototype.needsRsvp=function(){if(!this.isInvite()||this.invite.isOrganizer()){return false\n}var e=false;\nvar c=appCtxt.getActiveAccount().getEmail();\nif(this.isInvite()){var b=this.invite.getAttendees();\nfor(var d in b){if(b[d].url==c){return b[d].rsvp\n}if(b[d].rsvp){e=true\n}}b=this.invite.getResources();\nfor(var d in b){if(b[d].url==c){return b[d].rsvp\n}if(b[d].rsvp){e=true\n}}}return e\n};\nZmMailMsg.prototype._addAddressNodes=function(d,l,b){var h=this._addrs[l];\nvar g=h.size();\nvar m;\nif(g){if(appCtxt.isOffline){m=appCtxt.getApp(ZmApp.CONTACTS)\n}else{m=appCtxt.get(ZmSetting.CONTACTS_ENABLED)&&appCtxt.getApp(ZmApp.CONTACTS)\n}if(m&&!m.isContactListLoaded()){m=null\n}for(var f=0;\nf<g;\nf++){var k=h.get(f);\nk=k.isAjxEmailAddress?k:AjxEmailAddress.parse(k);\nif(k){var j=k.getAddress();\nvar c=k.getName();\nvar e={t:AjxEmailAddress.toSoapType[l],a:j};\nif(c){e.p=c\n}d.push(e)\n}}}};\nZmMailMsg.prototype._addFrom=function(c,k,q,b){var v=window.parentAppCtxt||window.appCtxt;\nvar x=this.identity;\nvar o=x==null||x.isDefault;\nif(this.delegatedSenderAddr&&!this.delegatedSenderAddrIsDL){o=false\n}if(this._origMsg&&this._origMsg.isInvite()&&this.isReplied&&(!this._origMsg._customMsg||!x)){var r=this._origMsg._getAttendees();\nvar l=r&&r.size()>0?r.size():0;\nvar g=\",\"+appCtxt.get(ZmSetting.MAIL_ALIASES).join(\",\")+\",\";\nfor(var s=0;\ns<l;\ns++){var t=r.get(s).address;\nif(t&&g.indexOf(\",\"+t+\",\")>=0){var w={t:\"f\",a:t};\nc.push(w);\nreturn\n}}}if(!appCtxt.isOffline&&b&&o){var e=v.accountList.mainAccount.getEmail();\nvar m=false;\nvar h=appCtxt.getById(this.folderId);\nif((!h||h.isRemote())&&(!this._origMsg||!this._origMsg.sendAsMe)){b=(h&&h.getOwner())||b;\nm=(b!=e)\n}if(this._origMsg&&this._origMsg.isDraft&&!this._origMsg.sendAsMe){var p=this._origMsg.getAddresses(AjxEmailAddress.FROM).get(0);\nif(p&&p.address.toLowerCase()!=e.toLowerCase()){b=p.address;\nm=true\n}}if(!m&&appCtxt.isFamilyMbox&&this._origMsg&&h){m=(h.getOwner()!=e)\n}var j,f;\nif(this.fromSelectValue){j=this.fromSelectValue.addr.address;\nf=this.fromSelectValue.addr.name\n}else{if(this._origMsg&&this._origMsg.isInvite()&&appCtxt.multiAccounts){x=this._origMsg.getAccount().getIdentity();\nj=x?x.sendFromAddress:this._origMsg.getAccount().name;\nf=x&&x.sendFromDisplay\n}else{if(m){j=b\n}else{j=x?x.sendFromAddress:(this.delegatedSenderAddr||b);\nm=this.isOnBehalfOf;\nf=x&&x.sendFromDisplay\n}}}var n={t:\"f\",a:j};\nif(f){n.p=f\n}c.push(n);\nif(m||!(v.multiAccounts||q)){c.push({t:\"s\",a:e})\n}}else{var e=v.accountList.mainAccount.getEmail();\nvar m=false;\nvar h=appCtxt.getById(this.folderId);\nif(h&&h.isRemote()&&!this._origMsg.sendAsMe){b=h.getOwner();\nm=(b!=e)\n}if(this._origMsg&&this._origMsg.isDraft&&!this._origMsg.sendAsMe){var p=this._origMsg.getAddresses(AjxEmailAddress.FROM).get(0);\nif(p&&p.address.toLowerCase()!=e.toLowerCase()&&!appCtxt.isMyAddress(p.address.toLowerCase())){b=p.address;\nm=true\n}}var j,f;\nif(m){j=b\n}else{if(x){if(x.sendFromAddressType==ZmSetting.SEND_ON_BEHALF_OF){j=x.sendFromAddress.replace(ZmMsg.onBehalfOfMidLabel+\" \",\"\");\nm=true\n}else{j=x.sendFromAddress||e\n}f=x.sendFromDisplay\n}else{j=this.delegatedSenderAddr||e;\nm=this.isOnBehalfOf\n}}var w={t:\"f\",a:j};\nif(f){w.p=f\n}c.push(w);\nif(m){c.push({t:\"s\",a:e})\n}if(x&&x.isFromDataSource){var u=v.getDataSourceCollection().getById(x.id);\nif(u){w.t=\"f\";\nw.a=u.getEmail();\nif(v.get(ZmSetting.DEFAULT_DISPLAY_NAME)){var d=u.identity&&u.identity.sendFromDisplay;\nw.p=d||u.userName||u.getName()\n}}}}};\nZmMailMsg.prototype._addReplyTo=function(b){if(this.identity){if(this.identity.setReplyTo&&this.identity.setReplyToAddress){var c={t:\"r\",a:this.identity.setReplyToAddress};\nif(this.identity.setReplyToDisplay){c.p=this.identity.setReplyToDisplay\n}b.push(c)\n}}};\nZmMailMsg.prototype._addReadReceipt=function(g,c){var h={t:\"n\"};\nvar b=this.identity;\nvar e=window.parentAppCtxt||window.appCtxt;\nif(b){h.a=b.readReceiptAddr||b.sendFromAddress;\nh.p=b.sendFromDisplay;\nif(b.isFromDataSource){var f=e.getDataSourceCollection().getById(b.id);\nif(f){h.a=f.getEmail();\nif(e.get(ZmSetting.DEFAULT_DISPLAY_NAME)){var d=f.identity&&f.identity.sendFromDisplay;\nh.p=d||f.userName||f.getName()\n}}}}else{h.a=c||appCtxt.getActiveAccount().getEmail()\n}g.push(h)\n};\nZmMailMsg.prototype._isAttInHitList=function(b){for(var c=0;\nc<this._attHitList.length;\nc++){if(b.part==this._attHitList[c].part){return true\n}}return false\n};\nZmMailMsg.prototype._onChange=function(f,e,d,g){if(this.onChange){this.onChange.run(f,e,d,g)\n}};\nZmMailMsg.prototype.getStatusIcon=function(){if(this.isInvite()&&appCtxt.get(ZmSetting.CALENDAR_ENABLED)){var e=this.invite.getInviteMethod();\nvar b;\nif(e==ZmCalendarApp.METHOD_REPLY){var d=this.invite.getAttendees();\nb=d&&d[0]&&d[0].ptst\n}else{if(e==ZmCalendarApp.METHOD_CANCEL){b=ZmMailMsg.PSTATUS_DECLINED\n}}return ZmMailMsg.STATUS_ICON[b]||\"Appointment\"\n}for(var c=0;\nc<ZmMailMsg.STATUS_LIST.length;\nc++){var b=ZmMailMsg.STATUS_LIST[c];\nif(this[b]){return ZmMailMsg.STATUS_ICON[b]\n}}return\"MsgStatusRead\"\n};\nZmMailMsg.prototype.getStatusTooltip=function(){var b=[];\nif(this.isInvite()){var c=this.getStatusIcon();\nb.push(ZmMailMsg.TOOLTIP[c])\n}if(this.isScheduled){b.push(ZmMsg.scheduled)\n}if(this.isUnread){b.push(ZmMsg.unread)\n}if(this.isReplied){b.push(ZmMsg.replied)\n}if(this.isForwarded){b.push(ZmMsg.forwarded)\n}if(this.isDraft){b.push(ZmMsg.draft)\n}else{if(this.isSent){b.push(ZmMsg.sentAt)\n}}if(b.length==0){b=[ZmMsg.read]\n}return b.join(\", \")\n};\nZmMailMsg.prototype.notifyModify=function(b,c){if(b.cid!=null){this.cid=b.cid\n}return ZmMailItem.prototype.notifyModify.apply(this,arguments)\n};\nZmMailMsg.prototype.isResourceInvite=function(){if(!this.cif||!this.invite){return false\n}var c=this.invite.getResources();\nfor(var b in c){if(c[b]&&c[b].url==this.cif){return true\n}}return false\n};\nZmMailMsg.prototype.setAutoSendTime=function(b){this._setAutoSendTime(b)\n};\nZmMailMsg.prototype._setAutoSendTime=function(b){ZmMailItem.prototype.setAutoSendTime.call(this,b);\nvar c=this.cid&&appCtxt.getById(this.cid);\nif(Dwt.instanceOf(c,\"ZmConv\")){c.setAutoSendTime(b)\n}};\nZmMailMsg.prototype.sendReadReceipt=function(e){var d={SendDeliveryReportRequest:{_jsns:\"urn:zimbraMail\"}};\nvar c=d.SendDeliveryReportRequest;\nc.mid=this.id;\nvar b=window.parentAppCtxt||window.appCtxt;\nb.getRequestMgr().sendRequest({jsonObj:d,asyncMode:true,callback:e})\n};\nZmMailMsg.prototype.redirect=function(g,m){var o={BounceMsgRequest:{_jsns:\"urn:zimbraMail\"}};\nvar c=o.BounceMsgRequest;\nc.m={id:this.id};\nvar h=c.m.e=[];\nfor(var n=0;\nn<ZmMailMsg.COMPOSE_ADDRS.length;\nn++){if(g[ZmMailMsg.COMPOSE_ADDRS[n]]){var l=g[ZmMailMsg.COMPOSE_ADDRS[n]].all;\nfor(var d=0,f=l.size();\nd<f;\nd++){var j=l.get(d);\nvar b=AjxEmailAddress.toSoapType[j.type];\nh.push({t:b,a:j.address})\n}}}var k=appCtxt.multiAccounts&&appCtxt.accountList.mainAccount;\nappCtxt.getAppController().sendRequest({jsonObj:o,asyncMode:true,accountName:k,callback:m})\n};\nZmMailMsg.prototype.doDelete=function(){var d={jsonObj:{MsgActionRequest:{_jsns:\"urn:zimbraMail\",action:{id:this.id,op:\"delete\"}}},asyncMode:true};\nif(appCtxt.isChildWindow&&(AjxEnv.isIE||AjxEnv.isModernIE)){var c=function(h){var g=window.opener.Object();\nfor(var e in h){var f=h[e];\ng[e]=(AjxUtil.isObject(f))?c(f):f\n}return g\n};\nd=c(d)\n}var b=window.parentAppCtxt||window.appCtxt;\nb.getRequestMgr().sendRequest(d)\n};\nZmMailMsg.prototype.getMsgSender=function(){var c=this.getAddress(AjxEmailAddress.FROM);\nvar b=this.getAddress(AjxEmailAddress.SENDER);\nif(b&&b.address!=(c&&c.address)){return b.address\n}return c&&c.address\n};\nZmMailMsg.prototype.getListIdHeader=function(){var c=null;\nif(this.attrs&&this.attrs[ZmMailMsg.HDR_LISTID]){var b=this.attrs[ZmMailMsg.HDR_LISTID];\nc=b.match(/<(.*)>/);\nif(AjxUtil.isArray(c)){c=c[c.length-1]\n}}return c\n};\nZmMailMsg.prototype.getXZimbraDLHeader=function(){if(this.attrs&&this.attrs[ZmMailMsg.HDR_XZIMBRADL]){return AjxEmailAddress.parseEmailString(this.attrs[ZmMailMsg.HDR_XZIMBRADL])\n}return null\n};\nZmMailMsg.prototype.getMimeHeader=function(b){var c=null;\nif(this.attrs&&this.attrs[b]){c=this.attrs[b]\n}return c\n};\nZmMailMsg.addRequestHeaders=function(d){if(!d){return\n}if(d.isAjxSoapDoc){for(var e in ZmMailMsg.requestHeaders){var b=d.set(\"header\",null,null);\nb.setAttribute(\"n\",ZmMailMsg.requestHeaders[e])\n}}else{var c=ZmMailMsg.requestHeaders;\nif(c){d.header=d.header||[];\nfor(var e in c){d.header.push({n:c[e]})\n}}}};\nZmMailMsg.prototype.getUrlForPart=function(b){return appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI)+\"&loc=\"+AjxEnv.DEFAULT_LOCALE+\"&id=\"+this.id+\"&part=\"+b.part\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmMimePart\")){ZmMimePart=function(b){ZmModel.call(this,ZmEvent.S_ATT);\nthis.parent=b;\nthis.children=new AjxVector()\n};\nZmMimePart.prototype=new ZmModel;\nZmMimePart.prototype.constructor=ZmMimePart;\nZmMimePart.prototype.isZmMimePart=true;\nZmMimePart.prototype.toString=function(){return\"ZmMimePart\"\n};\nZmMimePart.createFromDom=function(d,b,c){var e=new ZmMimePart(c);\ne._loadFromDom(d,b);\nreturn e\n};\nZmMimePart.prototype.getContent=function(){return this.content||(this.node&&this.node.content)||\"\"\n};\nZmMimePart.prototype.getContentForType=function(e){if(this.contentType==e){return this.getContent()\n}else{var c=this.children.getArray();\nif(c.length){for(var b=0;\nb<c.length;\nb++){var d=c[b].getContentForType(e);\nif(d){return d\n}}}}return\"\"\n};\nZmMimePart.prototype.setContent=function(b){this.content=b\n};\nZmMimePart.prototype.getContentDisposition=function(){return this.contentDisposition\n};\nZmMimePart.prototype.getContentType=function(){return this.contentType\n};\nZmMimePart.prototype.setContentType=function(b){this.contentType=b\n};\nZmMimePart.prototype.setIsBody=function(b){this.isBody=b\n};\nZmMimePart.prototype.getFilename=function(){return this.fileName\n};\nZmMimePart.prototype.isIgnoredPart=function(){if(this.parent&&this.parent.contentType==ZmMimeTable.MULTI_APPLE_DBL&&this.contentType==ZmMimeTable.APP_APPLE_DOUBLE){return true\n}if(this.isBody&&this.getContent()&&(this.contentType==ZmMimeTable.TEXT_HTML||this.contentType==ZmMimeTable.TEXT_PLAIN)){return true\n}if(this.contentType==ZmMimeTable.MULTI_DIGEST){return true\n}return false\n};\nZmMimePart.prototype._loadFromDom=function(f,b){this._loadProps(f);\nif(f.content){this._loaded=true\n}if(b.contentTypes){b.contentTypes[f.ct]=true\n}var g=false;\nif(this.contentDisposition==\"attachment\"||this.contentType==ZmMimeTable.MSG_RFC822||this.contentType==ZmMimeTable.TEXT_CAL||this.fileName||this.contentId||this.contentLocation){if(!this.isIgnoredPart()){if(b.attachments){b.attachments.push(this)\n}g=true\n}}if(this.isBody){var c=AjxUtil.isSpecified(f.content);\nif((ZmMimeTable.isRenderableImage(this.contentType)||c)){if(b.bodyParts){if(this.contentType==ZmMimeTable.MULTI_ALT){b.bodyParts.push({})\n}else{if(ZmMimePart._isPartOfMultipartAlternative(this)){var e={};\ne[this.contentType]=this;\nb.bodyParts.push(e)\n}else{b.bodyParts.push(this)\n}}}if(g&&b.attachments){b.attachments.pop()\n}}else{if(!g&&this.size!=0&&!this.isIgnoredPart()){if(b.attachments){b.attachments.push(this)\n}}}}if(f.mp&&this.contentType!=ZmMimeTable.MSG_RFC822){for(var d=0;\nd<f.mp.length;\nd++){this.children.add(ZmMimePart.createFromDom(f.mp[d],b,this))\n}}};\nZmMimePart.prototype._loadProps=function(c){this.node=c;\nthis.contentType=this.ct=c.ct;\nthis.format=c.format;\nthis.name=c.name;\nthis.part=c.part;\nthis.cachekey=c.cachekey;\nthis.size=this.s=c.s;\nthis.contentDisposition=this.cd=c.cd;\nvar b=c.ci;\nthis.contentId=this.ci=b&&b.indexOf(\"<\")!==0?\"<\"+b+\">\":b;\nthis.contentLocation=this.cl=c.cl;\nthis.fileName=this.filename=c.filename;\nthis.isTruncated=this.truncated=!!(c.truncated);\nthis.isBody=this.body=!!(c.body)\n};\nZmMimePart._isPartOfMultipartAlternative=function(b){if(!b){return false\n}if(b.contentType==ZmMimeTable.MULTI_ALT){return true\n}return ZmMimePart._isPartOfMultipartAlternative(b.parent)\n};\nZmMimePart.prototype.addAlternativePart=function(e,g,b){if(e.ct==g&&ZmMimePart._isPartOfMultipartAlternative(this.parent)&&e.body&&!this.getContent()){var f=new ZmMimePart(this);\nf._loadProps(e);\nthis.parent.children.replace(b,f);\nreturn f\n}if(e.mp&&e.mp.length){for(var c=0;\nc<e.mp.length;\nc++){var f=this.children.get(c);\nvar d=f&&f.addAlternativePart(e.mp[c],g,c);\nif(d){return d\n}}}}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmMailList\")){ZmMailList=function(c,b){ZmList.call(this,c,b);\nthis.convId=null;\nvar d=appCtxt.getFolderTree();\nif(d){this._folderChangeListener=new AjxListener(this,this._folderTreeChangeListener);\nd.addChangeListener(this._folderChangeListener)\n}};\nZmMailList.prototype=new ZmList;\nZmMailList.prototype.constructor=ZmMailList;\nZmMailList.prototype.isZmMailList=true;\nZmMailList.prototype.toString=function(){return\"ZmMailList\"\n};\nZmMailList._SPECIAL_FOLDERS=[ZmFolder.ID_DRAFTS,ZmFolder.ID_TRASH,ZmFolder.ID_SPAM,ZmFolder.ID_SENT];\nZmMailList._SPECIAL_FOLDERS_HASH=AjxUtil.arrayAsHash(ZmMailList._SPECIAL_FOLDERS);\nZmMailList.prototype.moveItems=function(g){if(this.type!=ZmItem.CONV){return ZmList.prototype.moveItems.apply(this,arguments)\n}g=Dwt.getParams(arguments,[\"items\",\"folder\",\"attrs\",\"callback\",\"finalCallback\",\"noUndo\",\"actionTextKey\",\"fromFolderId\"]);\ng.items=AjxUtil.toArray(g.items);\nvar e=AjxUtil.hashCopy(g);\ndelete e.fromFolderId;\ne.attrs={};\nvar d=this._getTcon(g.items,g.fromFolderId);\nif(d){e.attrs.tcon=d\n}e.attrs.l=g.folder.id;\ne.action=(g.folder.id==ZmFolder.ID_TRASH)?\"trash\":\"move\";\nif(e.folder.id==ZmFolder.ID_TRASH){e.actionTextKey=g.actionTextKey||\"actionTrash\"\n}else{e.actionTextKey=g.actionTextKey||\"actionMove\";\ne.actionArg=e.folder.getName(false,false,true)\n}e.callback=new AjxCallback(this,this._handleResponseMoveItems,[g]);\nif(appCtxt.multiAccounts){var c=g.items[0].getFolderId&&g.items[0].getFolderId();\nif(!c){var f=g.items[0]&&g.items[0].id;\nc=f&&appCtxt.getById(f)&&appCtxt.getById(f).folderId\n}var b=c&&appCtxt.getById(c);\nif((g.items[0].isDraft&&g.folder.id==ZmFolder.ID_DRAFTS)||(g.folder.isRemote())||(b&&b.isRemote())){e.accountName=g.items[0].getAccount().name\n}}if(this._handleDeleteFromSharedFolder(g,e)){return\n}e.safeMove=true;\nthis._itemAction(e)\n};\nZmMailList.prototype.spamItems=function(d){var b=d.items=AjxUtil.toArray(d.items);\nif(appCtxt.multiAccounts){var c=this._filterItemsByAccount(b);\nthis._spamAccountItems(c,d)\n}else{this._spamItems(d)\n}};\nZmMailList.prototype._spamAccountItems=function(d,e){var b;\nfor(var c in d){b=d[c];\nbreak\n}if(b){delete d[c];\ne.accountName=appCtxt.accountList.getAccount(c).name;\ne.items=b;\ne.callback=new AjxCallback(this,this._spamAccountItems,[d,e]);\nthis._spamItems(e)\n}};\nZmMailList.prototype._spamItems=function(d){d=Dwt.getParams(arguments,[\"items\",\"markAsSpam\",\"folder\",\"childWin\"]);\nvar c=AjxUtil.hashCopy(d);\nc.action=d.markAsSpam?\"spam\":\"!spam\";\nc.attrs={};\nif(this.type===ZmItem.CONV){var b=this._getTcon(d.items);\nif(b){c.attrs.tcon=b\n}}if(d.folder){c.attrs.l=d.folder.id\n}c.actionTextKey=d.markAsSpam?\"actionMarkAsJunk\":\"actionMarkAsNotJunk\";\nc.callback=new AjxCallback(this,this._handleResponseSpamItems,d);\nthis._itemAction(c)\n};\nZmMailList.prototype._handleResponseSpamItems=function(f,o){var h=o.getResponse();\nvar k;\nif(h&&h.length){var d=f.markAsSpam?ZmFolder.ID_SPAM:(f.folder?f.folder.id:ZmFolder.ID_INBOX);\nthis.moveLocal(h,d);\nvar e={};\nfor(var g=0;\ng<h.length;\ng++){var n=h[g];\nif(n.cid){var m=appCtxt.getById(n.cid);\nif(m){if(!e[m.id]){e[m.id]={conv:m,msgs:[]}\n}e[m.id].msgs.push(n)\n}}var b={oldFolderId:n.folderId,fields:{}};\nb.fields[ZmItem.F_FRAGMENT]=true;\nn.moveLocal(d)\n}for(var c in e){if(e.hasOwnProperty(c)){var m=e[c].conv;\nvar l=e[c].msgs;\nm.updateFragment(l)\n}}var n=h[0];\nvar j=n.list;\nif(j){j._evt.batchMode=true;\nj._evt.item=n;\nj._evt.items=h;\nj._notify(ZmEvent.E_MOVE,b)\n}if(f.actionText){k=ZmList.getActionSummary(f)\n}if(f.childWin){f.childWin.close()\n}}f.actionSummary=k;\nif(f.callback){f.callback.run(o)\n}};\nZmMailList.prototype.deleteItems=function(d){d=Dwt.getParams(arguments,[\"items\",\"hardDelete\",\"attrs\",\"childWin\"]);\nif(this.type==ZmItem.CONV){var c=this.search?appCtxt.getById(this.search.folderId):null;\nif(c&&c.isHardDelete()){if(!d.confirmDelete){d.confirmDelete=true;\nvar e=ZmMailList.prototype.deleteItems.bind(this,d);\nthis._popupDeleteWarningDialog(e,false,d.items.length);\nreturn\n}var b=appCtxt.getAppController().getInstantNotify();\nif(b){appCtxt.getAppController().setInstantNotify(false);\nd.errorCallback=new AjxCallback(this,this._handleErrorDeleteItems)\n}d.attrs=d.attrs||{};\nd.attrs.tcon=ZmFolder.TCON_CODE[c.nId];\nd.action=\"delete\";\nd.actionTextKey=\"actionDelete\";\nd.callback=new AjxCallback(this,this._handleResponseDeleteItems,b);\nreturn this._itemAction(d)\n}}ZmList.prototype.deleteItems.call(this,d)\n};\nZmMailList.prototype._handleResponseDeleteItems=function(c,b){var e=b.getResponse();\nif(e&&e.length){this.deleteLocal(e);\nfor(var d=0;\nd<e.length;\nd++){e[d].deleteLocal()\n}ZmModel.notifyEach(e,ZmEvent.E_DELETE)\n}if(c){appCtxt.getAppController().setInstantNotify(true)\n}};\nZmMailList.prototype._handleErrorDeleteItems=function(){appCtxt.getAppController().setInstantNotify(true)\n};\nZmMailList.prototype.markRead=function(f){var c=AjxUtil.toArray(f.items);\nvar b;\nif(c[0]&&c[0] instanceof ZmItem){b=[];\nfor(var d=0;\nd<c.length;\nd++){var e=c[d];\nif((e.type==ZmItem.CONV&&e.hasFlag(ZmItem.FLAG_UNREAD,f.value))||(e.isUnread==f.value)){b.push(e)\n}}}else{b=c\n}if(b.length){f.items=b;\nf.op=\"read\";\nif(b.length>1){f.actionTextKey=f.value?\"actionMarkRead\":\"actionMarkUnread\"\n}this.flagItems(f)\n}else{if(f.forceCallback){if(f.callback){f.callback.run(new ZmCsfeResult([]))\n}if(f.finalCallback){f.finalCallback(f)\n}return\n}}};\nZmMailList.prototype.markMute=function(f){var c=AjxUtil.toArray(f.items);\nvar b;\nif(c[0]&&c[0] instanceof ZmItem){b=[];\nfor(var d=0;\nd<c.length;\nd++){var e=c[d];\nif(f.value!=e.isMute){b.push(e)\n}}}else{b=c\n}if(b.length){f.items=b;\nf.op=\"mute\";\nf.actionTextKey=f.value?\"actionMarkMute\":\"actionMarkUnmute\";\nthis.flagItems(f)\n}else{if(f.forceCallback){if(f.callback){f.callback.run(new ZmCsfeResult([]))\n}if(f.finalCallback){f.finalCallback(f)\n}return\n}}};\nZmMailList.prototype.deleteLocal=function(b){for(var c=0;\nc<b.length;\nc++){this.remove(b[c],true)\n}};\nZmMailList.prototype.moveLocal=function(c,b){ZmList.prototype.moveLocal.call(this,c,b);\nif(b!=ZmFolder.ID_TRASH){return\n}var e=[];\nfor(var d=0;\nd<c.length;\nd++){if(c[d].isUnread){c[d].flagLocal(ZmItem.FLAG_UNREAD,false);\ne.push(c[d])\n}}ZmModel.notifyEach(e,ZmEvent.E_FLAGS,{flags:[ZmItem.FLAG_UNREAD]})\n};\nZmMailList.prototype.notifyCreate=function(g,m){var v=[];\nvar x=[];\nvar w=[];\nvar p=[];\nvar f=[];\nvar c={};\nvar r={};\nvar s=this.search?this.search.sortBy:null;\nvar h={};\nif(this.type==ZmItem.CONV){for(var q in g){AjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: handling conv create \"+q);\nif(this.getById(q)){AjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: conv already exists \"+q);\ncontinue\n}c[q]=g[q];\nvar d=g[q];\nvar n=this.search&&this.search.matches(d)&&!d.ignoreJunkTrash();\nif(n){if(!appCtxt.multiAccounts||(appCtxt.multiAccounts&&(this.search.isMultiAccount()||d.getAccount()==appCtxt.getActiveAccount()))){d.list=this;\nx.push(d);\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: conv added \"+q)\n}else{AjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: conv failed account checks \"+q)\n}}else{var j=this.search?this.search.query:\"\";\nvar u=d.ignoreJunkTrash();\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: conv does not match search '\"+j+\"' or was ignored (\"+u+\"); match function:\");\nif(!d){AjxDebug.println(AjxDebug.NOTIFY,\"conv is null!\")\n}else{var t=AjxUtil.keys(d.folders)||\"\";\nAjxDebug.println(AjxDebug.NOTIFY,\"conv folders: \"+t.join(\" \"))\n}}}for(var q in m){var i=m[q];\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: CLV handling msg create \"+q);\nvar l=i.cid;\nvar b=this.search&&this.search.matches(i)&&!i.ignoreJunkTrash();\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: CLV msg matches: \"+b);\nvar o=(!appCtxt.multiAccounts||(appCtxt.multiAccounts&&i.getAccount()==appCtxt.getActiveAccount()));\nvar d=c[l]||this.getById(l);\nvar k=false;\nif(b&&o){if(!d){var e={list:this};\nif(i._convCreateNode){if(i._convCreateNode._newId){i._convCreateNode.id=i._convCreateNode._newId\n}d=appCtxt.getById(l);\nif(!d){d=ZmConv.createFromDom(i._convCreateNode,e)\n}}else{d=appCtxt.getById(l)||ZmConv.createFromMsg(i,e)\n}c[l]=d;\nd.folders[i.folderId]=true;\nx.push(d)\n}d.list=this\n}if(d&&!(d.msgs&&d.msgs.getById(q))){if(!d.msgs){d.msgs=new ZmMailList(ZmItem.MSG);\nd.msgs.addChangeListener(d._listChangeListener)\n}i.list=d.msgs;\nif(!i.isSent&&i.isUnread){d.isUnread=true;\np.push(d)\n}if(b){i.inHitList=true\n}if(b||((b===null)&&!i.isSent)){if(d.fragment!=i.fragment){d.fragment=i.fragment;\nr[ZmItem.F_FRAGMENT]=true\n}if(d.date!=i.date){d.date=i.date;\nr[ZmItem.F_DATE]=true\n}if(d.numMsgs===1){d.size=i.size\n}else{d.size=null\n}if(i._convCreateNode){r[ZmItem.F_SIZE]=true\n}if(!c[d.id]&&this._vector.contains(d)){r[ZmItem.F_INDEX]=true\n}f.push(d)\n}AjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: conv list accepted msg \"+q);\nw.push(i)\n}}}else{if(this.type==ZmItem.MSG){for(var q in m){var i=m[q];\nvar b=this.search&&this.search.matches(i)&&!i.ignoreJunkTrash();\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: handling msg create \"+q);\nif(this.getById(q)){if(b){var j=this.search?this.search.query:\"\";\nvar u=i.ignoreJunkTrash();\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: msg does not match search '\"+j+\"' or was ignored (\"+u+\")\");\ni.list=this\n}continue\n}if(this.convId){if(i.cid==this.convId&&!this.getById(i.id)){i.list=this;\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: msg list (CV) accepted msg \"+q);\nw.push(i)\n}}else{if(b){i.list=this;\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailList: msg list (TV) accepted msg \"+q);\nw.push(i)\n}}}}}if(x.length>1){ZmMailItem.sortBy=s;\nx.sort(ZmMailItem.sortCompare);\nx.reverse()\n}this._sortAndNotify(x,s,ZmEvent.E_CREATE);\nthis._sortAndNotify(w,s,ZmEvent.E_CREATE);\nZmModel.notifyEach(p,ZmEvent.E_FLAGS,{flags:[ZmItem.FLAG_UNREAD]});\nthis._sortAndNotify(f,s,ZmEvent.E_MODIFY,{fields:r});\nthis._sortAndNotify(w,s,ZmEvent.E_MODIFY,{fields:r})\n};\nZmMailList.prototype.addMsgs=function(c){var b=[];\nfor(var e in c){var d=c[e];\nif(d.cid==this.convId){this.add(d,0);\nd.list=this;\nb.push(d)\n}}ZmModel.notifyEach(b,ZmEvent.E_CREATE)\n};\nZmMailList.prototype.removeAllItems=function(){this._vector=new AjxVector();\nthis._idHash={}\n};\nZmMailList.prototype.remove=function(b,c){if(!this.convId||c){ZmList.prototype.remove.call(this,b)\n}};\nZmMailList.prototype.clear=function(){if(this._folderChangeListener){var c=appCtxt.getFolderTree();\nif(c){c.removeChangeListener(this._folderChangeListener)\n}}if(this._tagChangeListener){var b=appCtxt.getTagTree();\nif(b){b.removeChangeListener(this._tagChangeListener)\n}}ZmList.prototype.clear.call(this)\n};\nZmMailList.prototype.getFirstHit=function(j,c,g){if(this.type!==ZmItem.MSG){return null\n}var h=null;\nj=j||0;\nc=c||appCtxt.get(ZmSetting.CONVERSATION_PAGE_SIZE);\nvar f=this.size();\nif(f>0&&j>=0&&j<f){var b=(j+c>f)?f:j+c;\nvar e=this.getArray();\nfor(var d=j;\nd<b;\nd++){if(!(g&&e[d].folderId&&g[e[d].folderId])){h=e[d];\nbreak\n}}if(!h){h=e[0]\n}}return h\n};\nZmMailList.prototype._getSortIndex=function(g,k){if(!k||(k!=ZmSearch.DATE_DESC&&k!=ZmSearch.DATE_ASC)){return 0\n}var h=parseInt(g.date);\nvar b=this.getArray();\nif(this.convId&&k==ZmSearch.DATE_ASC){var c=[];\nfor(var e=b.length-1;\ne>=0;\ne--){c.push({date:b[e].date})\n}b=c\n}for(var f=0;\nf<b.length;\nf++){var d=parseInt(b[f].date);\nif((k==ZmSearch.DATE_DESC&&(h>=d))||(k==ZmSearch.DATE_ASC&&(h<=d))){return f\n}}return f\n};\nZmMailList.prototype._sortAndNotify=function(j,l,d,c){if(!(j&&j.length)){return\n}var h=j[0]&&j[0].type;\nif((this.type==ZmItem.MSG)&&(h==ZmItem.CONV)){return\n}c=c||{};\nvar k=((d==ZmEvent.E_CREATE)||(c.fields&&c.fields[ZmItem.F_DATE]));\nfor(var g=0;\ng<j.length;\ng++){var n=j[g];\nif(k){var f=(h==this.type);\nvar b=0,e=0;\nif(this.type==ZmItem.CONV&&h==ZmItem.MSG){var m=this.getById(n.cid)||appCtxt.getById(n.cid);\nif(m){b=m.msgs._getSortIndex(n,ZmSearch.DATE_DESC);\ne=m.msgs._getSortIndex(n,appCtxt.get(ZmSetting.CONVERSATION_ORDER));\nif(d==ZmEvent.E_CREATE){m.addMsg(n,b)\n}}}else{e=b=this._getSortIndex(n,l)\n}if(d!=ZmEvent.E_CREATE){if(b!=this.indexOf(n)){this.remove(n)\n}else{f=false\n}}if(f){this.add(n,b)\n}c.sortIndex=e\n}n._notify(d,c)\n}};\nZmMailList.prototype._isItemInSpecialFolder=function(e){var f=e.msgs;\nif(!f){return false\n}for(var d=0;\nd<f.size();\nd++){var g=f.get(d);\nvar c=appCtxt.getById(g.folderId);\nvar b=c&&c.nId;\nif(!ZmMailList._SPECIAL_FOLDERS_HASH[b]){return false\n}}return true\n};\nZmMailList.prototype._getTcon=function(j,g){var l=true;\nfor(var f=0;\nf<j.length;\nf++){if(!this._isItemInSpecialFolder(j[f])){l=false;\nbreak\n}}if(l){return\"\"\n}var b=g||(this.search&&this.search.folderId);\nvar h=b&&appCtxt.getById(b);\nb=h&&h.nId;\nvar n=[];\nfor(f=0;\nf<ZmMailList._SPECIAL_FOLDERS.length;\nf++){var d=ZmMailList._SPECIAL_FOLDERS[f];\nif(!h){n.push(ZmFolder.TCON_CODE[d]);\ncontinue\n}if(b==d){continue\n}var c;\nif(appCtxt.multiAccounts){var k=j&&j[0].getAccount&&j[0].getAccount();\nvar m=k?k.id:appCtxt.getActiveAccount().id;\nvar e=[m,\":\",d].join(\"\");\nc=appCtxt.getById(e)\n}else{c=appCtxt.getById(d)\n}if(!h.isChildOf(c)){n.push(ZmFolder.TCON_CODE[d])\n}}return(n.length)?(\"-\"+n.join(\"\")):\"\"\n};\nZmMailList.prototype._folderTreeChangeListener=function(h){if(this.size()==0){return\n}var f=h.getDetail(\"flag\");\nvar j=appCtxt.getCurrentViewId();\nvar l=appCtxt.getCurrentController();\nif(h.event==ZmEvent.E_FLAGS&&(f==ZmItem.FLAG_UNREAD)){if(this.type==ZmItem.CONV){if((j==ZmId.VIEW_CONVLIST)&&l._currentSearch.hasUnreadTerm()){this._redoSearch(l)\n}}else{if(this.type==ZmItem.MSG){if(j==ZmId.VIEW_TRAD&&l._currentSearch.hasUnreadTerm()){this._redoSearch(l)\n}else{var e=h.getDetail(\"state\");\nvar k=h.getDetail(\"item\");\nvar g=[];\nvar d=this.getArray();\nfor(var c=0;\nc<d.length;\nc++){var b=d[c];\nif((k.type==ZmOrganizer.FOLDER&&b.folderId==k.id)||(k.type==ZmOrganizer.TAG&&b.hasTag(k.id))){b.isUnread=e;\ng.push(b)\n}}ZmModel.notifyEach(g,ZmEvent.E_FLAGS,{flags:[f]})\n}}}}else{ZmList.prototype._folderTreeChangeListener.call(this,h)\n}};\nZmMailList.prototype._tagTreeChangeListener=function(c){if(this.size()==0){return\n}var b=c.getDetail(\"flag\");\nif(c.event==ZmEvent.E_FLAGS&&(b==ZmItem.FLAG_UNREAD)){this._folderTreeChangeListener(c)\n}else{ZmList.prototype._tagTreeChangeListener.call(this,c)\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.view.object.ZmImageAttachmentObjectHandler\")){ZmImageAttachmentObjectHandler=function(){ZmObjectHandler.call(this,ZmImageAttachmentObjectHandler.TYPE);\nthis._imageHash={}\n};\nZmImageAttachmentObjectHandler.prototype=new ZmObjectHandler;\nZmImageAttachmentObjectHandler.prototype.constructor=ZmImageAttachmentObjectHandler;\nZmImageAttachmentObjectHandler.TYPE=\"imageAttachemnt\";\nZmImageAttachmentObjectHandler.THUMB_SIZE='width=\"320\" height=\"240\"';\nZmImageAttachmentObjectHandler.THUMB_SIZE_MAX=320;\nZmImageAttachmentObjectHandler.prototype._getHtmlContent=function(d,b,e,c){d[b++]=e;\nreturn b\n};\nZmImageAttachmentObjectHandler.prototype.getToolTipText=function(b,c){var e=this._imageHash[c.url];\nif(!e){e={id:Dwt.getNextId()}\n}if(!e.el||(e.el.src!==c.url)){this._imageHash[c.url]=e;\nthis._preload(c.url,e.id)\n}var d=document.getElementById(e.id);\nif(d&&!e.el){e.el=d\n}if(e.el){return e.el.xml||e.el.outerHTML\n}return'<img id=\"'+e.id+'\" style=\"visibility:hidden;\"/>'\n};\nZmImageAttachmentObjectHandler.prototype.getActionMenu=function(b){return null\n};\nZmImageAttachmentObjectHandler.prototype._preload=function(c,d){var b=new Image();\nb.onload=AjxCallback.simpleClosure(this._setSize,this,d,b);\nb.src=c\n};\nZmImageAttachmentObjectHandler.prototype._setSize=function(f,c){var e=document.getElementById(f);\nif(e){var d=c.width;\nvar b=c.height;\nif(d>ZmImageAttachmentObjectHandler.THUMB_SIZE_MAX&&d>=b){e.width=ZmImageAttachmentObjectHandler.THUMB_SIZE_MAX\n}else{if(b>ZmImageAttachmentObjectHandler.THUMB_SIZE_MAX&&b>d){e.height=ZmImageAttachmentObjectHandler.THUMB_SIZE_MAX\n}else{e.width=d;\ne.width=b\n}}e.src=c.src;\ne.style.visibility=\"visible\"\n}c.onload=null;\nc=null\n}\n}if(AjxPackage.define(\"zimbraMail.share.zimlet.handler.ZmEmailObjectHandler\")){ZmEmailObjectHandler=function(){ZmObjectHandler.call(this,\"email\")\n};\nZmEmailObjectHandler.prototype=new ZmObjectHandler;\nZmEmailObjectHandler.prototype.constructor=ZmEmailObjectHandler;\nZmEmailObjectHandler.prototype.isZmEmailObjectHandler=true;\nZmEmailObjectHandler.prototype.toString=function(){return\"ZmEmailObjectHandler\"\n};\nZmEmailObjectHandler.RE=/\\b(mailto:[ ]*)?([0-9a-zA-Z\\u00C0-\\u00ff]+[.&#!$%'*+-\\/=?^_`{}|~])*[0-9a-zA-Z_-\\u00C0-\\u00ff]+@([-0-9a-zA-Z]+[.])+[a-zA-Z]{2,6}([\\w\\/_\\.]*(\\?[-0-9a-zA-Z_\\.~%!$'\\(\\)\\*\\+,;:@=&]+)?)/gi;\nZmEmailObjectHandler.prototype.match=function(c,e,d){ZmEmailObjectHandler.RE.lastIndex=e;\nvar b=ZmEmailObjectHandler.RE.exec(c);\nif(b){b.context=b;\nb.objectMgr=d\n}return b\n};\nZmEmailObjectHandler.prototype.hoverOver=function(c,d,b,f,e){c=AjxStringUtil.parseMailtoLink(c).to;\nif(!appCtxt.notifyZimlets(\"onEmailHover\",[c,d,b,f,e])){ZmObjectHandler.prototype.hoverOver.apply(this,arguments)\n}};\nZmEmailObjectHandler.prototype.getToolTipText=function(c,b){return new AjxCallback(this,function(d){appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,{address:AjxStringUtil.parseMailtoLink(c).to},d)\n})\n};\nZmEmailObjectHandler.prototype.clicked=function(d,f,c,e){var b=this._getController(c),g=AjxStringUtil.parseMailtoLink(f);\nvar h={action:ZmOperation.NEW_MESSAGE,inNewWindow:b&&b._app&&b._app._inNewWindow(e),toOverride:g.to,subjOverride:AjxStringUtil.htmlEncode(g.subject),extraBodyText:AjxStringUtil.htmlEncode(g.body),extraBodyTextIsExternal:Boolean(g.body)};\nAjxDispatcher.run(\"Compose\",h)\n};\nZmEmailObjectHandler.prototype.getActionMenu=function(f,d,c,e){var b=this._getController(c);\nif(!b){return null\n}b._actionEv=e;\nb._actionEv.address=AjxStringUtil.parseMailtoLink(f).to;\nb._actionEv.handler=this;\nif(!this._actionMenu&&b._getBubbleActionMenu){this._actionMenu=b._getBubbleActionMenu()\n}b._bubbleActionListener(e,b._actionEv.address);\nreturn this._actionMenu\n};\nZmEmailObjectHandler.prototype._getController=function(d){var c=d&&d.objectMgr,b=c&&c.getView();\nreturn b&&b._controller\n};\nZmObjectManager.registerHandler(\"ZmEmailObjectHandler\",\"email\",4)\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmMailListView\")){ZmMailListView=function(b){if(arguments.length==0){return\n}b.pageless=true;\nZmListView.call(this,b);\nthis._folderId=null;\nthis._selectAllEnabled=true;\nthis._isMultiColumn=this.isMultiColumn();\nif(!this._isMultiColumn){this._normalClass=ZmMailListView.ROW_DOUBLE_CLASS\n}this._disallowSelection[ZmItem.F_READ]=true\n};\nZmMailListView.prototype=new ZmListView;\nZmMailListView.prototype.constructor=ZmMailListView;\nZmMailListView.prototype.isZmMailListView=true;\nZmMailListView.prototype.toString=function(){return\"ZmMailListView\"\n};\nZmMailListView.ROW_DOUBLE_CLASS=\"RowDouble\";\nZmMailListView.FIRST_ITEM=-1;\nZmMailListView.LAST_ITEM=-2;\nZmMailListView.SINGLE_COLUMN_SORT=[{field:ZmItem.F_FROM,msg:\"from\"},{field:ZmItem.F_TO,msg:\"to\"},{field:ZmItem.F_SUBJECT,msg:\"subject\"},{field:ZmItem.F_SIZE,msg:\"size\"},{field:ZmItem.F_DATE,msg:\"date\"},{field:ZmItem.F_ATTACHMENT,msg:\"attachment\"},{field:ZmItem.F_FLAG,msg:\"flag\"},{field:ZmItem.F_PRIORITY,msg:\"priority\"},{field:ZmItem.F_READ,msg:\"readUnread\"}];\nZmMailListView.SORTBY_HASH=[];\nZmMailListView.SORTBY_HASH[ZmSearch.NAME_ASC]={field:ZmItem.F_FROM,msg:\"from\"};\nZmMailListView.SORTBY_HASH[ZmSearch.NAME_DESC]={field:ZmItem.F_FROM,msg:\"from\"};\nZmMailListView.SORTBY_HASH[ZmSearch.SUBJ_ASC]={field:ZmItem.F_SUBJECT,msg:\"subject\"};\nZmMailListView.SORTBY_HASH[ZmSearch.SUBJ_DESC]={field:ZmItem.F_SUBJECT,msg:\"subject\"};\nZmMailListView.SORTBY_HASH[ZmSearch.SIZE_ASC]={field:ZmItem.F_SIZE,msg:\"size\"};\nZmMailListView.SORTBY_HASH[ZmSearch.SIZE_DESC]={field:ZmItem.F_SIZE,msg:\"size\"};\nZmMailListView.SORTBY_HASH[ZmSearch.DATE_ASC]={field:ZmItem.F_DATE,msg:\"date\"};\nZmMailListView.SORTBY_HASH[ZmSearch.DATE_DESC]={field:ZmItem.F_DATE,msg:\"date\"};\nZmMailListView.SORTBY_HASH[ZmSearch.ATTACH_ASC]={field:ZmItem.F_ATTACHMENT,msg:\"attachment\"};\nZmMailListView.SORTBY_HASH[ZmSearch.ATTACH_DESC]={field:ZmItem.F_ATTACHMENT,msg:\"attachment\"};\nZmMailListView.SORTBY_HASH[ZmSearch.FLAG_ASC]={field:ZmItem.F_FLAG,msg:\"flag\"};\nZmMailListView.SORTBY_HASH[ZmSearch.FLAG_DESC]={field:ZmItem.F_FLAG,msg:\"flag\"};\nZmMailListView.SORTBY_HASH[ZmSearch.MUTE_ASC]={field:ZmItem.F_MUTE,msg:\"mute\"};\nZmMailListView.SORTBY_HASH[ZmSearch.MUTE_DESC]={field:ZmItem.F_MUTE,msg:\"mute\"};\nZmMailListView.SORTBY_HASH[ZmSearch.READ_ASC]={field:ZmItem.F_READ,msg:\"readUnread\"};\nZmMailListView.SORTBY_HASH[ZmSearch.READ_DESC]={field:ZmItem.F_READ,msg:\"readUnread\"};\nZmMailListView.SORTBY_HASH[ZmSearch.PRIORITY_ASC]={field:ZmItem.F_PRIORITY,msg:\"priority\"};\nZmMailListView.SORTBY_HASH[ZmSearch.PRIORITY_DESC]={field:ZmItem.F_PRIORITY,msg:\"priority\"};\nZmMailListView.SORTBY_HASH[ZmSearch.RCPT_ASC]={field:ZmItem.F_TO,msg:\"to\"};\nZmMailListView.SORTBY_HASH[ZmSearch.RCPT_DESC]={field:ZmItem.F_TO,msg:\"to\"};\nZmMailListView.prototype.markUIAsMute=function(b){};\nZmMailListView.prototype.markUIAsRead=function(d,b){this._setImage(d,ZmItem.F_READ,d.getReadIcon(),this._getClasses(ZmItem.F_READ));\nvar e=this._getRowClass(d);\nvar c=this._getRowClassValue(b);\nvar c=this._getRowClassValue(b);\nvar f=this._getElement(d,ZmItem.F_ITEM_ROW);\nif(f){if(c){$(f).removeClass(c)\n}if(e){$(f).addClass(e)\n}}this._controller._checkKeepReading()\n};\nZmMailListView.prototype.set=function(f,c){var e=this._controller._activeSearch&&this._controller._activeSearch.search;\nthis._folderId=e&&e.folderId;\nif(this._folderId){this._group=this.getGroup(this._folderId)\n}var g=e&&e.sortBy;\nif(g){var d;\nif(g==ZmSearch.SUBJ_DESC||g==ZmSearch.SUBJ_ASC){d=ZmItem.F_SUBJECT\n}else{if(g==ZmSearch.DATE_DESC||g==ZmSearch.DATE_ASC){d=ZmItem.F_DATE\n}else{if(g==ZmSearch.NAME_DESC||g==ZmSearch.NAME_ASC){d=ZmItem.F_FROM\n}else{if(g==ZmSearch.SIZE_DESC||g==ZmSearch.SIZE_ASC){d=ZmItem.F_SIZE\n}}}}if(d){var b=(g==ZmSearch.SUBJ_ASC||g==ZmSearch.DATE_ASC||g==ZmSearch.NAME_ASC||g==ZmSearch.SIZE_ASC);\nthis.setSortByAsc(d,b)\n}}ZmListView.prototype.set.apply(this,arguments);\nthis.markDefaultSelection(f)\n};\nZmMailListView.prototype.markDefaultSelection=function(e){if(window.defaultSelection){var d=[];\nvar b=e.getArray();\nfor(var c in b){if(window.defaultSelection[b[c].id]){d.push(b[c])\n}}if(d.length>0){this.setSelectedItems(d)\n}window.defaultSelection=null\n}};\nZmMailListView.prototype.handleKeyAction=function(c,d){switch(c){case DwtKeyMap.SELECT_ALL:ZmListView.prototype.handleKeyAction.apply(this,arguments);\nvar b=this._controller;\nb._resetOperations(b.getCurrentToolbar(),this.getSelectionCount());\nreturn true;\ncase DwtKeyMap.SELECT_NEXT:case DwtKeyMap.SELECT_PREV:if(d.charCode===32){return false\n}this._controller.lastListAction=c;\ndefault:return ZmListView.prototype.handleKeyAction.apply(this,arguments)\n}};\nZmMailListView.prototype.getTitle=function(){var b=this._controller._activeSearch?this._controller._activeSearch.search:null;\nreturn b?b.getTitle():\"\"\n};\nZmMailListView.prototype.replenish=function(b){DwtListView.prototype.replenish.call(this,b);\nthis._resetColWidth()\n};\nZmMailListView.prototype.resetSize=function(d,b){this.setSize(d,b);\nvar e=this.getMargins();\nvar c=Dwt.getInsets(this._parentEl);\nif(d!==Dwt.DEFAULT){d-=e.left+e.right;\nd-=c.left+c.right\n}if(b!==Dwt.DEFAULT){b-=Dwt.getOuterSize(this._listColDiv).y;\nb-=e.top+e.bottom;\nb-=c.top+c.bottom\n}Dwt.setSize(this._parentEl,d,b)\n};\nZmMailListView.prototype.calculateMaxEntries=function(){return(Math.floor(this._parentEl.clientHeight/(this._isMultiColumn?20:40))+5)\n};\nZmMailListView.prototype.isMultiColumn=function(){return !this._controller.isReadingPaneOnRight()\n};\nZmMailListView.prototype._getExtraStyle=function(d,e,b){if(!appCtxt.get(ZmSetting.COLOR_MESSAGES)){return null\n}var c=d.getColor&&d.getColor();\nif(!c){return null\n}e=e||0.75;\nb=b||0.25;\nreturn Dwt.createLinearGradientCss(AjxColor.lighten(c,e),AjxColor.lighten(c,b),\"v\")\n};\nZmMailListView.prototype._getAbridgedContent=function(b,c){};\nZmMailListView.prototype._getListFlagsWrapper=function(c,b,d){c[b++]=\"<div class='ZmListFlagsWrapper'\";\nvar e=this._getExtraStyle(d,0.49,0.33);\nif(e){c[b++]=\" style='\"+e+\";'>\"\n}else{c[b++]=\">\"\n}return b\n};\nZmMailListView.prototype._getStyleViaZimlet=function(d,c){if(d!=\"fr\"&&d!=\"su\"&&d!=\"st\"){return\"\"\n}if(appCtxt.zimletsPresent()&&this._ignoreProcessingGetMailCellStyle==undefined){if(!this._zimletMgr){this._zimletMgr=appCtxt.getZimletMgr()\n}var b=this._zimletMgr.processARequest(\"getMailCellStyle\",c,d);\nif(b!=undefined&&b!=null){return b\n}else{if(b==null&&this._zimletMgr.isLoaded()){this._ignoreProcessingGetMailCellStyle=true\n}}}return\"\"\n};\nZmMailListView.prototype._getAbridgedCell=function(j,i,k,h,e,b,f,c){var d={};\nc=c||[];\nvar g=this._getCellClass(k,h,d);\nif(g){c.push(g)\n}i=this._getCellContents(j,i,k,h,e,d,c);\nreturn i\n};\nZmMailListView.prototype._getCellContents=function(i,h,j,g,f,e,d){if(g==ZmItem.F_ACCOUNT){h=this._getImageHtml(i,h,j.getAccount().getIcon(),this._getFieldId(j,g),d)\n}else{if(g==ZmItem.F_DATE){var k=appCtxt.get(ZmSetting.DISPLAY_TIME_IN_MAIL_LIST);\nvar c=AjxDateUtil.computeDateStr(e.now||new Date(),j.date,k);\ni[h++]=\"<div id='\";\ni[h++]=this._getFieldId(j,g);\ni[h++]=\"' \";\nif(!this.isMultiColumn()){var b=this._getExtraStyle(j,0.69,0.55);\nif(b){i[h++]=\" style='\"+b+\"'\"\n}}i[h++]=AjxUtil.getClassAttr(d);\ni[h++]=\">\"+c+\"</div>\"\n}else{h=ZmListView.prototype._getCellContents.apply(this,arguments)\n}}return h\n};\nZmMailListView.prototype.reRenderListView=function(){var c=this.isMultiColumn();\nif(c!=this._isMultiColumn){this._saveState({selection:true,focus:true,scroll:true,expansion:true});\nthis._isMultiColumn=c;\nthis.headerColCreated=false;\nthis._headerList=this._getHeaderList();\nthis._rowHeight=null;\nthis._normalClass=c?DwtListView.ROW_CLASS:ZmMailListView.ROW_DOUBLE_CLASS;\nvar b=this.getList()||(new AjxVector());\nthis.clearGroupSections(this._folderId);\nthis.set(b.clone());\nthis._restoreState();\nthis._resetFromColumnLabel()\n}};\nZmMailListView.prototype._getLabelForField=function(g,h){switch(h){case ZmItem.F_READ:break;\ncase ZmItem.F_FLAG:return g.isFlagged?ZmMsg.flagged:\"\";\ncase ZmItem.F_ATTACHMENT:return g.hasAttach&&ZmMsg.hasAttachment;\ncase ZmItem.F_STATUS:return g.getStatusTooltip();\ncase ZmItem.F_SUBJECT:return g.subject||ZmMsg.noSubject;\ncase ZmItem.F_PRIORITY:if(g.isLowPriority){return ZmMsg.priorityLow\n}else{if(g.isHighPriority){return ZmMsg.priorityHigh\n}}break;\ncase ZmItem.F_TAG:if(g.tags.length>0){var d=g.tags.join(\" & \");\nreturn AjxMessageFormat.format(ZmMsg.taggedAs,[d])\n}break;\ncase ZmItem.F_DATE:return AjxDateUtil.computeWordyDateStr(new Date(),g.date);\ncase ZmItem.F_FROM:var b=this._isOutboundFolder()?AjxEmailAddress.TO:AjxEmailAddress.FROM;\nvar c=g.getAddresses(b)||g.participants||new AjxVector();\nvar f=[];\nif(c.size()<=0){return AjxStringUtil.stripTags(ZmMsg.noRecipients)\n}for(var e=0;\ne<Math.min(c.size(),3);\ne++){f.push(c.get(e).toString(true,true))\n}return f.join(\", \");\ncase ZmItem.F_SIZE:if(g.size){return AjxUtil.formatSize(g.size)\n}break\n}return ZmListView.prototype._getLabelForField.apply(this,arguments)\n};\nZmMailListView.prototype._initHeaders=function(){if(!this._headerInit){this._headerInit={};\nthis._headerInit[ZmItem.F_SELECTION]={icon:\"CheckboxUnchecked\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.selection,precondition:ZmSetting.SHOW_SELECTION_CHECKBOX,cssClass:\"ZmMsgListColSelection\"};\nthis._headerInit[ZmItem.F_FLAG]={icon:\"FlagRed\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.flag,sortable:ZmItem.F_FLAG,noSortArrow:true,precondition:ZmSetting.FLAGGING_ENABLED,cssClass:\"ZmMsgListColFlag\"};\nthis._headerInit[ZmItem.F_PRIORITY]={icon:\"PriorityHigh_list\",width:ZmListView.COL_WIDTH_NARROW_ICON,name:ZmMsg.priority,sortable:ZmItem.F_PRIORITY,noSortArrow:true,precondition:ZmSetting.MAIL_PRIORITY_ENABLED,cssClass:\"ZmMsgListColPriority\"};\nthis._headerInit[ZmItem.F_TAG]={icon:\"Tag\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.tag,precondition:ZmSetting.TAGGING_ENABLED,cssClass:\"ZmMsgListColTag\"};\nthis._headerInit[ZmItem.F_ACCOUNT]={icon:\"AccountAll\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.account,noRemove:true,resizeable:true,cssClass:\"ZmMsgListColAccount\"};\nthis._headerInit[ZmItem.F_STATUS]={icon:\"MsgStatus\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.status,cssClass:\"ZmMsgListColStatus\"};\nthis._headerInit[ZmItem.F_MUTE]={icon:\"Mute\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.muteUnmute,sortable:false,noSortArrow:true,cssClass:\"ZmMsgListColMute\"};\nthis._headerInit[ZmItem.F_READ]={icon:\"MsgUnread\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.readUnread,sortable:ZmItem.F_READ,noSortArrow:true,cssClass:\"ZmMsgListColRead\"};\nthis._headerInit[ZmItem.F_FROM]={text:ZmMsg.from,width:ZmMsg.COLUMN_WIDTH_FROM_MLV,resizeable:true,sortable:ZmItem.F_FROM,cssClass:\"ZmMsgListColFrom\"};\nthis._headerInit[ZmItem.F_ATTACHMENT]={icon:\"Attachment\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.attachment,sortable:ZmItem.F_ATTACHMENT,noSortArrow:true,cssClass:\"ZmMsgListColAttachment\"};\nthis._headerInit[ZmItem.F_SUBJECT]={text:ZmMsg.subject,sortable:ZmItem.F_SUBJECT,noRemove:true,resizeable:true,cssClass:\"ZmMsgListColSubject\"};\nthis._headerInit[ZmItem.F_FOLDER]={text:ZmMsg.folder,width:ZmMsg.COLUMN_WIDTH_FOLDER,resizeable:true,cssClass:\"ZmMsgListColFolder\"};\nthis._headerInit[ZmItem.F_SIZE]={text:ZmMsg.size,width:ZmMsg.COLUMN_WIDTH_SIZE,sortable:ZmItem.F_SIZE,resizeable:true,cssClass:\"ZmMsgListColSize\"};\nvar b=appCtxt.get(ZmSetting.DISPLAY_TIME_IN_MAIL_LIST)?ZmMsg.COLUMN_WIDTH_DATE_TIME:ZmMsg.COLUMN_WIDTH_DATE;\nthis._headerInit[ZmItem.F_DATE]={text:ZmMsg.received,width:b,sortable:ZmItem.F_DATE,resizeable:true,cssClass:\"ZmMsgListColDate\"};\nthis._headerInit[ZmItem.F_SORTED_BY]={text:AjxMessageFormat.format(ZmMsg.arrangedBy,ZmMsg.date),sortable:ZmItem.F_SORTED_BY,resizeable:false}\n}};\nZmMailListView.prototype._getLabelFieldList=function(){var b=[];\nb.push(ZmItem.F_SELECTION);\nif(appCtxt.get(ZmSetting.FLAGGING_ENABLED)){b.push(ZmItem.F_FLAG)\n}b.push(ZmItem.F_PRIORITY,ZmItem.F_TAG,ZmItem.F_READ,ZmItem.F_STATUS,ZmItem.F_FROM,ZmItem.F_ATTACHMENT,ZmItem.F_SUBJECT,ZmItem.F_FOLDER,ZmItem.F_SIZE);\nif(appCtxt.accountList.size()>2){b.push(ZmItem.F_ACCOUNT)\n}b.push(ZmItem.F_DATE);\nreturn b\n};\nZmMailListView.prototype._getHeaderList=function(){var b;\nif(this.isMultiColumn()){b=this._getLabelFieldList()\n}else{b=[ZmItem.F_SELECTION,ZmItem.F_SORTED_BY]\n}return this._getHeaders(this._mode,b)\n};\nZmMailListView.prototype._getHeaders=function(q,b){this._initHeaders();\nvar r=[];\nthis._defaultCols=b.join(ZmListView.COL_JOIN);\nvar n=!this._controller.isReadingPaneOnRight();\nvar o=n&&appCtxt.get(ZmSetting.LIST_VIEW_COLUMNS,q);\nvar c=b;\nif(o&&n){c=o.split(ZmListView.COL_JOIN);\nc=this._normalizeHeaders(c,b)\n}if(appCtxt.isOffline&&appCtxt.getSearchController().searchAllAccounts&&n){var j=false;\nfor(var g=0;\ng<c.length;\ng++){if(c[g]==ZmItem.F_ACCOUNT){j=true\n}}if(!j){c.splice(c.length-1,0,ZmId.FLD_ACCOUNT)\n}}for(var h=0,m=c.length;\nh<m;\nh++){var l=c[h];\nvar p=l.substr(0,2);\nvar f=this._headerInit[p];\nif(!f){continue\n}var e=f.precondition;\nif(!e||appCtxt.get(e)){f.field=p;\nif(appCtxt.multiAccounts&&appCtxt.accountList.size()>2&&appCtxt.get(ZmSetting.OFFLINE_SHOW_ALL_MAILBOXES)&&l.indexOf(ZmItem.F_ACCOUNT)!=-1){f.visible=true;\nthis._showingAccountColumn=true\n}else{var d=(appCtxt.multiAccounts&&l==ZmItem.F_ACCOUNT&&!o)?false:(l.indexOf(\"*\")==-1);\nif(!o&&n){if(typeof f.visible===\"undefined\"){f.visible=d\n}}else{f.visible=d\n}}r.push(new DwtListHeaderItem(f))\n}}return r\n};\nZmMailListView.prototype._normalizeHeaders=function(k,c){var b=AjxUtil.arrayAsHash(c);\nvar d=[],n={},e={};\nfor(var g=0;\ng<k.length;\ng++){var m=k[g];\nvar l=m.indexOf(\"*\");\nif(l!=-1){m=m.substr(0,l);\ne[m]=true\n}if(b[m]&&!n[m]){d.push(m);\nn[m]=true\n}}for(var f=0;\nf<c.length;\nf++){var m=c[f];\nif(!n[m]){if(m==ZmId.FLD_ACCOUNT){e[ZmItem.F_ACCOUNT]=true\n}if(m==ZmId.FLD_SELECTION){d.unshift(m)\n}else{d.splice(d.length-1,0,m)\n}}}var h=AjxUtil.map(d,function(i){return e[i]?i+\"*\":i\n});\nappCtxt.set(ZmSetting.LIST_VIEW_COLUMNS,h.join(ZmListView.COL_JOIN),this.view);\nreturn h\n};\nZmMailListView.prototype.createHeaderHtml=function(m){var q=this.getActiveSearchSortBy();\nif(appCtxt.multiAccounts){var d=appCtxt.getSearchController().searchAllAccounts;\nif(this._headerHash&&((this._showingAccountColumn&&!d)||(!this._showingAccountColumn&&d))){var o=this._headerHash[ZmItem.F_ACCOUNT];\nif(o){o._visible=this._showingAccountColumn=d;\nthis.headerColCreated=false\n}}}if(this._headerList&&!this.headerColCreated){var p=this._controller._getReadingPanePref();\nif(p==ZmSetting.RP_RIGHT&&this._controller._itemCountText[p]){this._controller._itemCountText[p].dispose()\n}if(q&&ZmMailListView.SORTBY_HASH[q]){m=ZmMailListView.SORTBY_HASH[q].field\n}DwtListView.prototype.createHeaderHtml.call(this,m,this._isMultiColumn);\nif(p==ZmSetting.RP_RIGHT){var k=document.getElementById(this._itemCountTextTdId);\nif(k){var i=DwtId.makeId(this.view,p,\"text\");\nvar b=document.getElementById(i);\nif(!b){var l=this._controller._itemCountText[p]=new DwtText({parent:this,className:\"itemCountText\",id:i});\nk.appendChild(l.getHtmlElement())\n}}}}this._resetFromColumnLabel();\nvar g=Dwt.byId(this._currentColId);\nvar r=this._isMultiColumn?this._headerHash[ZmItem.F_DATE]:(g&&this.getItemFromElement(g))||(this._headerHash&&this._headerHash[ZmItem.F_SORTED_BY])||null;\nif(r){var n=\"\";\nvar e;\nif(this._isMultiColumn){n=ZmMsg.received;\nif(this._isOutboundFolder()){n=(this._folderId==ZmFolder.ID_DRAFTS)?ZmMsg.lastSaved:ZmMsg.sentAt;\nn=\"&nbsp;\"+n\n}}else{if(q&&ZmMailListView.SORTBY_HASH[q]){var h=ZmMailListView.SORTBY_HASH[q].msg;\nvar c=ZmMailListView.SORTBY_HASH[q].field;\nif(h){n=AjxMessageFormat.format(ZmMsg.arrangedBy,ZmMsg[h])\n}if(c){r._sortable=c\n}}}var j=document.getElementById(DwtId.getListViewHdrId(DwtId.WIDGET_HDR_LABEL,this._view,r._field));\nif(j){j.innerHTML=n\n}if(this._colHeaderActionMenu){if(!this._isMultiColumn){var t=this._colHeaderActionMenu.getMenuItem(c);\nif(t){t.setChecked(true,true)\n}}}var f=this._controller,s=f.getCurrentViewType();\nf._updateViewMenu(s);\nf._updateViewMenu(f._getReadingPanePref());\nf._updateViewMenu(appCtxt.get(ZmSetting.CONVERSATION_ORDER))\n}};\nZmMailListView.prototype._createHeader=function(k,j,f,d,c,b,h){if(f._field==ZmItem.F_SORTED_BY){var g=f._field;\nvar e=this._itemCountTextTdId=DwtId.makeId(this.view,ZmSetting.RP_RIGHT,\"td\");\nk[j++]=\"<td id='\";\nk[j++]=b;\nk[j++]=\"' class='\";\nk[j++]=(b==this._currentColId)?\"DwtListView-Column DwtListView-ColumnActive'\":\"DwtListView-Column'\";\nk[j++]=\" width='auto'><table width='100%'><tr><td id='\";\nk[j++]=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_LABEL,this._view,g);\nk[j++]=\"' class='DwtListHeaderItem-label'>\";\nk[j++]=f._label;\nk[j++]=\"</td>\";\nk[j++]=\"<td class='itemSortIcon' id='\";\nk[j++]=DwtId.getListViewHdrId(DwtId.WIDGET_HDR_ARROW,this._view,g);\nk[j++]=\"'>\";\nk[j++]=AjxImg.getImageHtml(this._bSortAsc?\"ColumnUpArrow\":\"ColumnDownArrow\");\nk[j++]=\"</td>\";\nk[j++]=\"<td align=right class='itemCountText' id='\";\nk[j++]=e;\nk[j++]=\"'></td></tr></table></td>\";\nreturn j\n}else{return DwtListView.prototype._createHeader.apply(this,arguments)\n}};\nZmMailListView.prototype._resetColWidth=function(){if(!this.headerColCreated){return\n}var c=this._getLastColumnIndex();\nif(c){var b=this._headerList[c];\nif(b._field!=ZmItem.F_SORTED_BY){DwtListView.prototype._resetColWidth.apply(this,arguments)\n}}};\nZmMailListView.prototype._mouseOverAction=function(c,e){var b=this._getItemData(e,\"type\");\nif(b==DwtListView.TYPE_HEADER_ITEM){var d=this.getItemFromElement(e);\nif(d&&this.sortingEnabled&&d._sortable&&d._sortable==ZmItem.F_FROM){if(this._isOutboundFolder()){e.className=\"DwtListView-Column DwtListView-ColumnHover\";\nreturn true\n}}}return ZmListView.prototype._mouseOverAction.apply(this,arguments)\n};\nZmMailListView.prototype._columnClicked=function(d,c){var f=this.getItemFromElement(d);\nvar e=this.getGroup(this._folderId);\nif(e&&f&&f._sortable){var b=ZmMailListGroup.getGroupIdFromSortField(f._sortable,this.type);\nif(b!=e.id){this.setGroup(b)\n}}ZmListView.prototype._columnClicked.call(this,d,c)\n};\nZmMailListView.prototype._resetFromColumnLabel=function(){var e=this._headerHash[ZmItem.F_FROM];\nif(e){var c=this._isOutboundFolder()?ZmMsg.to:ZmMsg.from;\ne._sortable=this._isOutboundFolder()?ZmItem.F_TO:ZmItem.F_FROM;\nvar b=document.getElementById(DwtId.getListViewHdrId(DwtId.WIDGET_HDR_LABEL,this._view,e._field));\nif(b){b.innerHTML=\"&nbsp;\"+c\n}var d=this._colHeaderActionMenu?this._colHeaderActionMenu.getItem(e._index):null;\nif(d){d.setText(c)\n}}};\nZmMailListView.prototype._isOutboundFolder=function(b){b=b||(this._folderId&&appCtxt.getById(this._folderId));\nreturn(b&&b.isOutbound())\n};\nZmMailListView.prototype.getFolder=function(){return this._folderId&&appCtxt.getById(this._folderId)\n};\nZmMailListView.prototype.useListElement=function(){return true\n};\nZmMailListView.prototype._getRowClass=function(c){var b=this._isMultiColumn?[\"DwtMsgListMultiCol\"]:[\"ZmRowDoubleHeader\"];\nvar d=this._getRowClassValue(c.isUnread&&!c.isMute);\nif(d){b.push(d)\n}return b.join(\" \")\n};\nZmMailListView.prototype._getRowClassValue=function(b){return b?\"Unread\":null\n};\nZmMailListView.prototype._getCellId=function(b,c){if(c==ZmItem.F_DATE){return null\n}else{if(c==ZmItem.F_SORTED_BY){return this._getFieldId(b,c)\n}else{return ZmListView.prototype._getCellId.apply(this,arguments)\n}}};\nZmMailListView.prototype._getHeaderToolTip=function(c,b){var d=this._isOutboundFolder();\nif(c==ZmItem.F_FROM&&d){return ZmMsg.to\n}if(c==ZmItem.F_STATUS){return ZmMsg.messageStatus\n}if(c==ZmItem.F_MUTE){return ZmMsg.muteUnmute\n}if(c==ZmItem.F_READ){return ZmMsg.readUnread\n}return ZmListView.prototype._getHeaderToolTip.call(this,c,b,d)\n};\nZmMailListView.prototype._getToolTip=function(d){var n,i=d.field,l=d.item,j=d.match&&d.match.participant||0;\nif(!l){return\n}if(i===ZmItem.F_STATUS){n=l.getStatusTooltip()\n}else{if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)&&(i===ZmItem.F_FROM||i===ZmItem.F_PARTICIPANT)){var g;\nif(!l.getAddress){return\n}if(i===ZmItem.F_FROM){if(this._isOutboundFolder()){var f=l.getAddresses(AjxEmailAddress.TO).getArray();\ng=f[j]\n}else{g=l.getAddress(AjxEmailAddress.FROM)\n}}else{if(i===ZmItem.F_PARTICIPANT){g=l.participants&&l.participants.get(j)\n}}if(!g){return\n}var h={address:g,ev:d.ev};\nvar e=new AjxCallback(this,function(o){appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,h,o)\n});\nn={callback:e}\n}else{if(i===ZmItem.F_SUBJECT||i===ZmItem.F_FRAGMENT){var k=(l.type===ZmItem.MSG)&&l.isInvite()&&l.invite;\nif(k&&l.needsRsvp()){n=k.getToolTip()\n}else{if(k&&!k.isEmpty()){var b=l.getBodyPart();\nn=b&&ZmInviteMsgView.truncateBodyContent(b.getContent(),true);\nn=AjxStringUtil.stripTags(n)\n}else{n=AjxStringUtil.htmlEncode(l.fragment||(l.hasAttach?\"\":ZmMsg.fragmentIsEmpty))\n}}n=AjxStringUtil.trim(n,false,\"\\\\s\")\n}else{if(i===ZmItem.F_FOLDER){var c=appCtxt.getById(l.folderId);\nif(c&&c.parent){var m=c.getPath();\nif(m!==c.getName()){n=m\n}}}else{if(i===ZmItem.F_ACCOUNT){n=l.getAccount().getDisplayName()\n}else{n=ZmListView.prototype._getToolTip.apply(this,arguments)\n}}}}}return n\n};\nZmMailListView.prototype._getCell=function(c,b,e,f,h,g){var d=this._getCellClass(e,f,g,h);\nb=this._getCellContents(c,b,e,f,h,g,[d||\"\"]);\nreturn b\n};\nZmMailListView.prototype._getCellClass=function(d,e,f,g){var c=null;\nif(!this._isMultiColumn&&e==ZmItem.F_SUBJECT){c=\"SubjectDoubleRow \"\n}if(g==null){return c\n}var b=f.headerList||this._headerList;\nreturn c?c+b[g]._cssClass:b[g]._cssClass\n};\nZmMailListView.prototype._getFlagIcon=function(c,b){return(c||b)?\"FlagRed\":(this._isMultiColumn?\"Blank_16\":\"FlagDis\")\n};\nZmMailListView.prototype._fitParticipants=function(g,m,h){h-=15;\nvar e=AjxStringUtil.getWidth(AjxStringUtil.LIST_SEP,m.isUnread);\nvar j=AjxStringUtil.getWidth(AjxStringUtil.ELLIPSIS,m.isUnread);\nvar k=[];\nvar d=Math.min(20,g.length);\nvar c=0;\nfor(var f=0;\nf<d;\nf++){var b=g[f];\nvar l=b.name||b.address||b.company||\"\";\nc+=AjxStringUtil.getWidth(AjxStringUtil.htmlEncode(l),m.isUnread);\nk.push({name:l,index:f})\n}c+=(d-1)*e;\nif(c<h){return k\n}k=[];\nfor(var f=0;\nf<d;\nf++){var b=g[f];\nvar l=b.dispName||b.address||b.company||\"\";\nk.push({name:l,index:f})\n}while(k.length){var c=0;\nfor(var f=0;\nf<k.length;\nf++){c+=AjxStringUtil.getWidth(AjxStringUtil.htmlEncode(k[f].name),m.isUnread)\n}c+=(k.length-1)*e;\nif(k.length<d){c+=j\n}if(c<h){return k\n}else{k.shift()\n}}var b=g[d-1];\nvar l=b.dispName||b.address||b.company||\"\";\nreturn[{name:l,index:d-1}]\n};\nZmMailListView.prototype._getActionMenuForColHeader=function(b){var d;\nif(this.isMultiColumn()){var c=(!this._colHeaderActionMenu||b);\nd=ZmListView.prototype._getActionMenuForColHeader.call(this,b,this,\"header\");\nif(c){this._resetFromColumnLabel();\nthis._groupByActionMenu=this._getGroupByActionMenu(d)\n}else{if(this._groupByActionMenu){this._setGroupByCheck()\n}}}else{if(!this._colHeaderActionMenu||b){this._colHeaderActionMenu=this._setupSortMenu(null,true)\n}d=this._colHeaderActionMenu\n}return d\n};\nZmMailListView.prototype._getSingleColumnSortFields=function(){return ZmMailListView.SINGLE_COLUMN_SORT\n};\nZmMailListView.prototype._setupSortMenu=function(e,f){var b=this.getActiveSearchSortBy();\nvar g=b&&ZmMailListView.SORTBY_HASH[b]?ZmMailListView.SORTBY_HASH[b].field:ZmItem.F_DATE;\nvar d=this._getSortMenu(this._getSingleColumnSortFields(),g,e);\nif(f){this._groupByActionMenu=this._getGroupByActionMenu(d);\nthis._setGroupByCheck()\n}var c=d.getMenuItem(ZmItem.F_FROM);\nif(c){c.setVisible(!this._isOutboundFolder())\n}c=d.getMenuItem(ZmItem.F_TO);\nif(c){c.setVisible(this._isOutboundFolder())\n}return d\n};\nZmMailListView.prototype._getNoResultsMessage=function(){if(appCtxt.isOffline&&!appCtxt.getSearchController().searchAllAccounts){var d=ZmOrganizer.getSystemId(this._controller._getSearchFolderId());\nvar c=d&&appCtxt.getById(d);\nif(c){if(c.isOfflineSyncable&&!c.isOfflineSyncing){var b=\"ZmMailListView.toggleSync('\"+c.id+\"', '\"+this._htmlElId+\"');\";\nreturn AjxMessageFormat.format(ZmMsg.notSyncing,b)\n}}}return DwtListView.prototype._getNoResultsMessage.call(this)\n};\nZmMailListView.toggleSync=function(b,c){var e=appCtxt.getById(b);\nvar f=e?document.getElementById(c):null;\nvar d=f?DwtControl.fromElement(f):null;\nif(d){var g=new AjxCallback(d,d._handleToggleSync,[e]);\ne.toggleSyncOffline(g)\n}};\nZmMailListView.prototype._handleToggleSync=function(b){b.getAccount().sync();\nthis.removeAll(true)\n};\nZmMailListView.prototype.handleUnmuteConv=function(b){};\nZmMailListView.prototype._changeListener=function(i){var l=this._getItemFromEvent(i);\nif(!l||i.handled||!this._handleEventType[l.type]){if(i&&i.event==ZmEvent.E_CREATE){AjxDebug.println(AjxDebug.NOTIFY,\"ZmMailListView: initial check failed\")\n}return\n}if((!this.isMultiColumn()||appCtxt.get(ZmSetting.COLOR_MESSAGES))&&(i.event==ZmEvent.E_TAGS||i.event==ZmEvent.E_REMOVE_ALL)){this.redrawItem(l);\nZmListView.prototype._changeListener.call(this,i);\ni.handled=true\n}if(i.event==ZmEvent.E_FLAGS){var c=i.getDetail(\"flags\");\nfor(var d=0;\nd<c.length;\nd++){var h=c[d];\nif(h==ZmItem.FLAG_MUTE){var g=l[ZmItem.FLAG_PROP[h]];\nthis.markUIAsMute(l,!g)\n}else{if(h==ZmItem.FLAG_UNREAD){var g=l[ZmItem.FLAG_PROP[h]];\nthis.markUIAsRead(l,!g)\n}}}}if(i.event==ZmEvent.E_CREATE){AjxDebug.println(AjxDebug.NOTIFY,\"ZmMailListView: handle create \"+l.id);\nif(this._controller.actionedMsgId){var b=appCtxt.getById(this._controller.actionedMsgId);\nif(b){this._itemToSelect=this._controller.isZmConvListController?appCtxt.getById(b.cid):b\n}this._controller.actionedMsgId=null\n}if(this._list&&this._list.contains(l)){AjxDebug.println(AjxDebug.NOTIFY,\"ZmMailListView: list already has item \"+l.id);\nreturn\n}if(!this._handleEventType[l.type]){AjxDebug.println(AjxDebug.NOTIFY,\"ZmMailListView: list view of type \"+this._mode+\" does not handle \"+l.type);\nreturn\n}if(this._isPageless||this.offset==0){var f=i.getDetail(\"sortIndex\")||0;\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmMailListView: adding item \"+l.id+\" at index \"+f);\nthis.addItem(l,f);\nif(appCtxt.isOffline&&appCtxt.getActiveAccount().isOfflineInitialSync()){this._controller._app.numEntries++\n}}i.handled=true\n}if(!i.handled){ZmListView.prototype._changeListener.call(this,i);\nif(i.event==ZmEvent.E_MOVE||i.event==ZmEvent.E_DELETE){var e=this._controller.getItemView();\nvar k=e&&e.getItem();\nif(k==l){e.set(null,true)\n}}}};\nZmMailListView.prototype._itemClicked=function(d,h){if(window.webkitNotifications&&appCtxt.get(ZmSetting.MAIL_NOTIFY_TOASTER)){var f=webkitNotifications.checkPermission();\nif(f==1){webkitNotifications.requestPermission(function(){})\n}}Dwt.setLoadingTime(\"ZmMailItem\");\nZmListView.prototype._itemClicked.apply(this,arguments);\nvar i=this._controller;\nif(i.isReadingPaneOn()){if(appCtxt.get(ZmSetting.SHOW_SELECTION_CHECKBOX)&&h.button==DwtMouseEvent.LEFT){if(!h.shiftKey&&!h.ctrlKey){var g=this._getEventTarget(h);\nvar b=(g&&g.id&&g.id.indexOf(\"AjxImg\")==-1)?g.id:d.id;\nvar e=b?this._parseId(b):null;\nif(e&&e.field==ZmItem.F_SELECTION){if(this.getSelectionCount()==1){var j=this.getSelection()[0];\nvar c=(j instanceof ZmConv)?j.getFirstHotMsg():j;\nif(c&&i._curItem&&(c.id!=i._curItem.id)){i.reset()\n}}}}}}};\nZmMailListView.prototype._setNextSelection=function(){if(this._itemToSelect){var b=this._getItemToSelect();\nif(b){this.setSelection(b,false);\nthis._itemToSelect=null\n}}};\nZmMailListView.prototype._getItemToSelect=function(){var b=this._itemToSelect||(this._list&&this._list.get(0));\nvar c=this.getList(true);\nif(b==ZmMailListView.FIRST_ITEM){c=c&&c.getArray();\nb=c&&c[0]\n}else{if(b==ZmMailListView.LAST_ITEM){c=c&&c.getArray();\nb=c&&c[c.length-1]\n}}return b\n};\nZmMailListView.prototype._getSearchForSort=function(c,b){b=b||this._controller;\nvar d=b.getSearchString();\nif(!d){return\"\"\n}if(c!=ZmItem.F_READ){return\n}var e=\"is:unread\";\nif(d.indexOf(e)!=-1){d=AjxStringUtil.trim(d.replace(e,\"\"))\n}else{d=d+\" \"+e\n}return d\n};\nZmMailListView.prototype._columnHasCustomQuery=function(b){return b._sortable==ZmItem.F_READ\n};\nZmMailListView.prototype._isDefaultSortAscending=function(b){var d=b._sortable;\nvar c=d===ZmItem.F_DATE||d===ZmItem.F_FLAG||d===ZmItem.F_ATTACHMENT||d===ZmItem.F_SIZE;\nreturn !c\n};\nZmMailListView.prototype.reset=function(){this.clearGroupSections(this.getActiveSearchFolderId());\nZmListView.prototype.reset.call(this)\n};\nZmMailListView.prototype.removeAll=function(){this.clearGroupSections(this.getActiveSearchFolderId());\nZmListView.prototype.removeAll.call(this)\n};\nZmMailListView.prototype.clearGroupSections=function(b){if(b){var c=this.getGroup(b);\nif(c){c.clearSections()\n}}else{if(this._group){this._group.clearSections()\n}}};\nZmMailListView.prototype.setGroup=function(b){this._group=ZmMailListGroup.getGroup(b);\nif(this._folderId&&!this._controller.isSearchResults){appCtxt.set(ZmSetting.GROUPBY_LIST,b||ZmId.GROUPBY_NONE,this._folderId);\nappCtxt.set(ZmSetting.GROUPBY_HASH,this._group,this._folderId)\n}};\nZmMailListView.prototype.getGroup=function(c){if(c){var e=appCtxt.get(ZmSetting.GROUPBY_HASH,c);\nif(!e){var d=appCtxt.get(ZmSetting.GROUPBY_LIST,c);\ne=ZmMailListGroup.getGroup(d);\nappCtxt.set(ZmSetting.GROUPBY_HASH,e,c)\n}var b=this.getActiveSearchSortBy();\nif(b&&ZmMailListView.SORTBY_HASH[b]&&e&&e.field!=ZmMailListView.SORTBY_HASH[b].field){e=null;\nappCtxt.set(ZmSetting.GROUPBY_HASH,e,c);\nappCtxt.set(ZmSetting.GROUPBY_LIST,ZmId.GROUPBY_NONE,c)\n}return e\n}else{return this._group\n}};\nZmMailListView.prototype._getGroupByActionMenu=function(m,j,o){var k=[ZmOperation.GROUPBY_NONE,ZmOperation.GROUPBY_DATE,ZmOperation.GROUPBY_FROM,ZmOperation.GROUPBY_SIZE];\nif(this._mode==ZmId.VIEW_CONVLIST||this._isOutboundFolder()){AjxUtil.arrayRemove(k,ZmOperation.GROUPBY_FROM)\n}var c=this._groupByActionListener.bind(this);\nvar p=this._sortByActionListener.bind(this);\nif(!j){m.createSeparator()\n}var b=m.createMenuItem(Dwt.getNextId(\"GROUP_BY_\"),{text:ZmMsg.groupBy,style:DwtMenuItem.NO_STYLE});\nvar d=new ZmPopupMenu(o?b:m);\nvar n=Dwt.getNextId(\"GroupByActionMenu_\");\nvar l=Dwt.getNextId(\"SortByActionMenu_\");\nfor(var g=0;\ng<k.length;\ng++){var h=d.createMenuItem(k[g],{text:ZmMsg[ZmOperation.getProp(k[g],\"textKey\")],style:DwtMenuItem.RADIO_STYLE,radioGroupId:n});\nh.addSelectionListener(c);\nif(this._group&&this._group.id===k[g]){h.setChecked(true,true)\n}else{if(!this._group&&k[g]===ZmOperation.GROUPBY_NONE){h.setChecked(true,true)\n}}}d.createSeparator();\nvar e=d.createMenuItem(ZmOperation.SORT_ASC,{text:ZmMsg[ZmOperation.getProp(ZmOperation.SORT_ASC,\"textKey\")],style:DwtMenuItem.RADIO_STYLE,radioGroupId:l});\ne.addSelectionListener(p);\nvar f=d.createMenuItem(ZmOperation.SORT_DESC,{text:ZmMsg[ZmOperation.getProp(ZmOperation.SORT_DESC,\"textKey\")],style:DwtMenuItem.RADIO_STYLE,radioGroupId:l});\nf.addSelectionListener(p);\nif(this._bSortAsc){e.setChecked(true,true)\n}else{f.setChecked(true,true)\n}b.setMenu(d);\nreturn d\n};\nZmMailListView.prototype._groupByActionListener=function(h){var d=h&&h.item&&h.item.getData(ZmOperation.MENUITEM_ID);\nvar b=this.getGroup(this._folderId);\nvar k=ZmMailListGroup.getHeaderField(d,this._isMultiColumn);\nvar n=this._headerHash[k];\nif(!n){if(b){k=ZmMailListGroup.getHeaderField(b.id,this._isMultiColumn)\n}else{k=ZmId.FLD_DATE\n}n=this._headerHash[k];\nthis.setGroup(null)\n}else{if(!b||(b.id!=d)){n._sortable=ZmMailListGroup.getHeaderField(d);\nthis.setGroup(d)\n}}if(!this._isMultiColumn){var c=ZmMailListGroup.getHeaderField(d);\nfor(var e=0;\ne<ZmMailListView.SINGLE_COLUMN_SORT.length;\ne++){if(c==ZmMailListView.SINGLE_COLUMN_SORT[e].field){if(this._colHeaderActionMenu){var f=this._colHeaderActionMenu.getMenuItem(c);\nif(f){f.setChecked(true,true);\nvar j=AjxMessageFormat.format(ZmMsg.arrangeBy,ZmMsg[ZmMailListView.SINGLE_COLUMN_SORT[e].msg]);\nc=this._headerHash[ZmItem.F_SORTED_BY];\nvar m=document.getElementById(DwtId.getListViewHdrId(DwtId.WIDGET_HDR_LABEL,this._view,k));\nif(m){m.innerHTML=j\n}break\n}}}}}if(h&&h.item){h.item.setChecked(true,h,true)\n}this._sortColumn(n,this._bSortAsc);\nvar g=this.getList();\nif(g&&g.size()==1&&this._sortByString){this._renderList(g)\n}var l=this._controller;\nl._updateViewMenu(d,l._groupByViewMenu)\n};\nZmMailListView.prototype._sortByActionListener=function(f){var g=f&&f.item&&f.item.getData(ZmOperation.MENUITEM_ID);\nvar d=(g===ZmId.OP_SORT_ASC);\nvar e=this._bSortAsc;\nif(e!=d){this._bSortAsc=d;\nvar c=Dwt.byId(this._currentColId);\nvar h=(c&&this.getItemFromElement(c))||(this._headerHash&&this._headerHash[ZmItem.F_SORTED_BY])||null;\nif(h){this.clearGroupSections(this._folderId);\nthis._sortColumn(h,this._bSortAsc);\nif(!this._isMultiColumn){this._setSortedColStyle(h._id)\n}}}if(f&&f.item){f.item.setChecked(true,f,true)\n}var b=this._controller;\nb._updateViewMenu(g,b._groupByViewMenu)\n};\nZmMailListView.prototype._sortMenuListener=function(f){if(this._groupByActionMenu){var e=this._bSortAsc?ZmOperation.OP_SORT_DESC:ZmOperation.OP_SORT_ASC;\nvar c=this._groupByActionMenu.getMenuItem(e);\nif(c){c.setChecked(true,true)\n}}var b=f&&f.item&&f.item.getData(ZmOperation.MENUITEM_ID);\nif(this._group&&b){var d=ZmMailListGroup.getGroupIdFromSortField(b,this.type);\nthis.setGroup(d)\n}this._setGroupByCheck();\nZmListView.prototype._sortMenuListener.call(this,f)\n};\nZmMailListView.prototype._sortColumn=function(c,d,e){ZmListView.prototype._sortColumn.apply(this,arguments);\nvar b=this._controller;\nb._updateViewMenu(c._sortable,b._sortViewMenu)\n};\nZmMailListView.prototype._setGroupByCheck=function(){if(this._groupByActionMenu){var b=this._group&&this._group.id?this._groupByActionMenu.getMenuItem(this._group.id):this._groupByActionMenu.getMenuItem(ZmOperation.GROUPBY_NONE);\nif(b){b.setChecked(true,true)\n}b=this._bSortAsc?this._groupByActionMenu.getMenuItem(ZmOperation.SORT_ASC):this._groupByActionMenu.getMenuItem(ZmOperation.SORT_DESC);\nif(b){b.setChecked(true,true)\n}}};\nZmMailListView.prototype.addItem=function(l,f,h,b){var k=this._group;\nif(!k){return ZmListView.prototype.addItem.call(this,l,f,h,b)\n}if(!this._list){this._list=new AjxVector()\n}if(this._list.size()==0){this._resetList()\n}var i;\nvar g;\nthis._list.add(l,(b!=null)?b:f);\nvar c=this._createItemHtml(l);\nif(c){if(c instanceof Array){for(var e=0;\ne<c.length;\ne++){i=k.addMsgToSection(l,c[e]);\nif(k.getSectionSize(i)==1){g=this._getSectionHeaderDiv(k,i);\nthis._addRow(g)\n}this._addRow(c[e])\n}}else{i=k.addMsgToSection(l,c);\nif(k.getSectionSize(i)==1){g=this._getSectionHeaderDiv(k,i);\nthis._addRow(g,f)\n}f=parseInt(f)||0;\nvar d=1;\nif(this._sortByString===ZmSearch.DATE_ASC){d=this._group.getAllSectionHeaders().length\n}this._addRow(c,f+d)\n}}if(!h&&this._evtMgr.isListenerRegistered(DwtEvent.STATE_CHANGE)){this._evtMgr.notifyListeners(DwtEvent.STATE_CHANGE,this._stateChangeEv)\n}};\nZmMailListView.prototype.getActiveSearchSortBy=function(){var b=AjxUtil.get(this._controller,\"_activeSearch\",\"search\",\"sortBy\")||null;\nreturn b\n};\nZmMailListView.prototype.getActiveSearchFolderId=function(){var b=AjxUtil.get(this._controller,\"_activeSearch\",\"search\",\"folderId\")||null;\nreturn b\n};\nZmMailListView.prototype._changeFolderName=function(e,d){var c=appCtxt.getById(e.folderId);\nif(!this._controller.isReadingPaneOn()||!this._controller.isReadingPaneOnRight()){var b=c?this._getElement(e,ZmItem.F_FOLDER):null;\nif(b){b.innerHTML=c.getName()\n}}if(c&&(c.nId==ZmFolder.ID_TRASH||d==ZmFolder.ID_TRASH)){this._changeTrashStatus(e)\n}};\nZmMailListView.prototype._changeTrashStatus=function(d){var c=this._getElement(d,ZmItem.F_ITEM_ROW);\nif(c){if(d.isUnread){Dwt.addClass(c,\"Unread\")\n}var b=appCtxt.getById(d.folderId);\nif(b&&b.isInTrash()){Dwt.addClass(c,\"Trash\")\n}else{Dwt.delClass(c,\"Trash\")\n}if(d.isSent){Dwt.addClass(c,\"Sent\")\n}}}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmMailItemView\")){ZmMailItemView=function(b){if(arguments.length==0){return\n}DwtComposite.call(this,b);\nthis._controller=b.controller\n};\nZmMailItemView.prototype=new DwtComposite;\nZmMailItemView.prototype.constructor=ZmMailItemView;\nZmMailItemView.prototype.isZmMailItemView=true;\nZmMailItemView.prototype.toString=function(){return\"ZmMailItemView\"\n};\nZmMailItemView.prototype.set=function(b,c){};\nZmMailItemView.prototype.getItem=function(){};\nZmMailItemView.prototype.reset=function(){};\nZmMailItemView.prototype.getMinHeight=function(){return 20\n};\nZmMailItemView.prototype.getMinWidth=function(){return 20\n};\nZmMailItemView.prototype.getHtmlBodyElement=function(){};\nZmMailItemView.prototype.hasHtmlBody=function(){return false\n};\nZmMailItemView.prototype.getItem=function(){return this._item\n};\nZmMailItemView.prototype.getTitle=function(){return this._item?[ZmMsg.zimbraTitle,this._item.subject].join(\": \"):ZmMsg.zimbraTitle\n};\nZmMailItemView.prototype.setReadingPane=function(){};\nZmMailItemView.prototype.getInviteMsgView=function(){return this._inviteMsgView\n};\nZmMailItemView.prototype._lazyCreateObjectManager=function(c){var b=(AjxUtil.isBoolean(this._objectManager)&&this._objectManager);\nvar d=(!this.zimletLoadFlag&&appCtxt.getZimletMgr().isLoaded());\nif(b||d){this.zimletLoadFlag=appCtxt.getZimletMgr().isLoaded();\nthis._objectManager=new ZmObjectManager(c||this)\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmDoublePaneView\")){ZmDoublePaneView=function(d){if(arguments.length==0){return\n}var c=this._view=d.view=d.controller.getCurrentViewId();\nd.id=ZmId.getViewId(c);\nDwtComposite.call(this,d);\nthis._controller=d.controller;\nthis._initHeader();\nd.className=null;\nd.id=DwtId.getListViewId(c);\nd.parent=this;\nd.posStyle=Dwt.ABSOLUTE_STYLE;\nthis._mailListView=this._createMailListView(d);\nd.className=null;\nthis._itemView=this._createMailItemView(d);\nvar b=appCtxt.getViewTypeFromId(c);\nif(b===ZmId.VIEW_TRAD||b===ZmId.VIEW_CONVLIST){this._createSashes()\n}this.setReadingPane()\n};\nZmDoublePaneView.prototype=new DwtComposite;\nZmDoublePaneView.prototype.constructor=ZmDoublePaneView;\nZmDoublePaneView.prototype.isZmDoublePaneView=true;\nZmDoublePaneView.prototype.toString=function(){return\"ZmDoublePaneView\"\n};\nZmDoublePaneView.SASH_THRESHOLD=5;\nZmDoublePaneView.MIN_LISTVIEW_WIDTH=40;\nZmDoublePaneView._TAG_IMG=\"TI\";\nZmDoublePaneView.prototype.getController=function(){return this._controller\n};\nZmDoublePaneView.prototype.getTitle=function(){return this._mailListView.getTitle()\n};\nZmDoublePaneView.prototype.setReadingPane=function(d){var j=this._mailListView,i=this._itemView,g=this._vertSash&&this._horizSash;\nvar h=this._controller.isReadingPaneOn();\nif(!h){i.setVisible(false);\nif(g){this._vertSash.setVisible(false);\nthis._horizSash.setVisible(false)\n}}else{if(!i.getVisible()){if(j.getSelectionCount()==1){this._controller._setSelectedItem()\n}else{i.reset()\n}}var c=this._controller.isReadingPaneOnRight();\ni.setVisible(true,c);\nif(g){var b=c?this._vertSash:this._horizSash;\nvar e=c?this._horizSash:this._vertSash;\ne.setVisible(false);\nb.setVisible(true)\n}}j.reRenderListView();\nif(!d){i.setReadingPane()\n}i.noTab=!h||AjxEnv.isIE;\nvar f=this.getSize();\nthis._resetSize(f.x,f.y,true)\n};\nZmDoublePaneView.prototype.getMailListView=function(){return this._mailListView\n};\nZmDoublePaneView.prototype.getItemView=function(){return this._itemView\n};\nZmDoublePaneView.prototype.getMsgView=ZmDoublePaneView.prototype.getItemView;\nZmDoublePaneView.prototype.getInviteMsgView=function(){return this._itemView.getInviteMsgView()\n};\nZmDoublePaneView.prototype.getSelectionCount=function(){return this._mailListView.getSelectionCount()\n};\nZmDoublePaneView.prototype.getSelection=function(){return this._mailListView.getSelection()\n};\nZmDoublePaneView.prototype.reset=function(){this._mailListView.reset();\nthis._itemView.reset()\n};\nZmDoublePaneView.prototype.getItem=function(){return this._itemView.getItem()\n};\nZmDoublePaneView.prototype.setItem=function(c,d,b){this._itemView.set(c,d);\nthis._controller._checkKeepReading()\n};\nZmDoublePaneView.prototype.clearItem=function(){this._itemView.set()\n};\nZmDoublePaneView.prototype.getMsg=function(){return(this._controller.getCurrentViewType()==ZmId.VIEW_TRAD)?this._itemView.getMsg():null\n};\nZmDoublePaneView.prototype.setMsg=function(b){this._itemView.set(b);\nthis._controller._restoreFocus()\n};\nZmDoublePaneView.prototype.addInviteReplyListener=function(b){this._itemView.addInviteReplyListener(b)\n};\nZmDoublePaneView.prototype.addShareListener=function(b){this._itemView.addShareListener(b)\n};\nZmDoublePaneView.prototype.addSubscribeListener=function(b){this._itemView.addSubscribeListener(b)\n};\nZmDoublePaneView.prototype.resetMsg=function(b){this._itemView.resetMsg(b)\n};\nZmDoublePaneView.prototype.isReadingPaneVisible=function(){return this._itemView.getVisible()\n};\nZmDoublePaneView.prototype.setBounds=function(c,e,d,b){DwtComposite.prototype.setBounds.call(this,c,e,d,b);\nthis._resetSize(d,b)\n};\nZmDoublePaneView.prototype.setList=function(b){this._mailListView.set(b,ZmItem.F_DATE);\nthis.isStale=false\n};\nZmDoublePaneView.prototype._initHeader=function(){};\nZmDoublePaneView.prototype._createMailListView=function(b){};\nZmDoublePaneView.prototype._createMailItemView=function(b){};\nZmDoublePaneView.prototype._createSashes=function(){var b={parent:this,style:DwtSash.HORIZONTAL_STYLE,className:\"AppSash-horiz\",threshold:ZmDoublePaneView.SASH_THRESHOLD,posStyle:Dwt.ABSOLUTE_STYLE};\nthis._vertSash=new DwtSash(b);\nthis._vertSash.registerCallback(this._sashCallback,this);\nthis._vertSash.addListener(DwtEvent.ONMOUSEUP,this._sashVertRelease.bind(this));\nb.style=DwtSash.VERTICAL_STYLE;\nb.className=\"AppSash-vert\";\nthis._horizSash=new DwtSash(b);\nthis._horizSash.registerCallback(this._sashCallback,this);\nthis._horizSash.addListener(DwtEvent.ONMOUSEUP,this._sashHorizRelease.bind(this));\nthis.addListener(DwtEvent.CONTROL,this._controlEventListener.bind(this))\n};\nZmDoublePaneView.prototype._resetSize=function(f,b,c){if(f<=0||b<=0){return\n}if(!c&&f==this._lastResetWidth&&b==this._lastResetHeight){return\n}var d=this._controller.isReadingPaneOnRight();\nif(this.isReadingPaneVisible()){var h=this.getSash();\nvar g=h.getSize();\nvar e=d?g.x:g.y;\nvar i=this._itemView.getMargins();\nif(d){var j=this.getReadingSashPosition(true)||(Number(ZmMsg.LISTVIEW_WIDTH))||Math.floor(f/2.5);\nthis._mailListView.resetSize(j,b);\nh.setLocation(j,0);\nthis._itemView.setBounds(j+e,0,f-(j+e+i.left+i.right),b)\n}else{var k=this.getReadingSashPosition(false)||(Math.floor(b/2)-DwtListView.HEADERITEM_HEIGHT);\nthis._mailListView.resetSize(f,k);\nh.setLocation(0,k);\nthis._itemView.setBounds(0,k+e,f-i.left-i.right,b-(k+e))\n}}else{this._mailListView.resetSize(f,b)\n}this._mailListView._resetColWidth();\nthis._lastResetWidth=f;\nthis._lastResetHeight=b\n};\nZmDoublePaneView.prototype._sashCallback=function(l){var d=this._controller.isReadingPaneOnRight();\nvar k=this._mailListView;\nvar i=this._itemView;\nvar j=i.getSize(true);\nvar c=k.getSize(true);\nvar f;\nvar m;\nvar g=Math.abs(l);\nif(d){var e=AjxEnv.isIE?this._vertSash.getLocation().x:c.x;\nvar h=j.x;\nl=this._getLimitedDelta(l,h,i.getMinWidth(),e,ZmDoublePaneView.MIN_LISTVIEW_WIDTH);\nif(!l){return 0\n}f={width:e+l,height:Dwt.DEFAULT};\nm={left:i.getLocation().x+l,top:Dwt.DEFAULT,width:h-l,height:Dwt.DEFAULT}\n}else{var n=AjxEnv.isIE?this._horizSash.getLocation().y:c.y;\nvar b=j.y;\nl=this._getLimitedDelta(l,b,i.getMinHeight(),n,this._getMinListViewHeight(k));\nif(!l){return 0\n}f={width:Dwt.DEFAULT,height:n+l};\nm={left:Dwt.DEFAULT,top:i.getLocation().y+l,width:Dwt.DEFAULT,height:b-l}\n}k.resetSize(f.width,f.height);\ni.setBounds(m.left,m.top,m.width,m.height);\nk._resetColWidth();\nif(d){this._vertSashX=this._vertSash.getLocation().x+l\n}else{this._horizSashY=this._horizSash.getLocation().y+l\n}return l\n};\nZmDoublePaneView.prototype._getLimitedDelta=function(g,c,f,d,e){if(g>0){return Math.max(0,Math.min(g,c-f))\n}var b=Math.abs(g);\nreturn -Math.max(0,Math.min(b,d-e))\n};\nZmDoublePaneView.prototype._getMinListViewHeight=function(b){if(this._minListViewHeight){return this._minListViewHeight\n}var d=b.getList();\nif(!d||!d.size()){return DwtListView.HEADERITEM_HEIGHT\n}var c=d.get(0);\nvar e=document.getElementById(b._getItemId(c));\nthis._minListViewHeight=DwtListView.HEADERITEM_HEIGHT+Dwt.getSize(e).y*2;\nreturn this._minListViewHeight\n};\nZmDoublePaneView.prototype._selectFirstItem=function(){var c=this._mailListView.getList();\nvar b=c?c.get(0):null;\nif(b){this._mailListView.setSelection(b,false)\n}};\nZmDoublePaneView.prototype.getSash=function(){var b=this._controller.isReadingPaneOnRight();\nreturn b?this._vertSash:this._horizSash\n};\nZmDoublePaneView.prototype.getLimit=function(b){return this._mailListView.getLimit(b)\n};\nZmDoublePaneView.prototype._staleHandler=function(){var c=this._controller._currentSearch;\nif(c){c.lastId=c.lastSortVal=null;\nc.offset=c.limit=0;\nvar g={isRefresh:true};\nvar b=this._mailListView;\nif(b.getSelectionCount()==1){var f=b.getSelection();\nvar e=f&&f[0];\nvar d=this.getItem();\nif(e&&d&&e.id==d.id){g.selectedItem=e\n}}appCtxt.getSearchController().redoSearch(c,false,g)\n}};\nZmDoublePaneView.prototype.handleRemoveAttachment=function(c,b){this._itemView.handleRemoveAttachment(c,b)\n};\nZmDoublePaneView.prototype.getReadingSashPosition=function(c){if(c){if(!this._vertSashX){var e=this._readingPaneSashVertPos||appCtxt.get(ZmSetting.READING_PANE_SASH_VERTICAL);\nvar b=e/100;\nvar d=this.getSize().x;\nthis._vertSashX=Math.round(b*d)\n}return this._vertSashX\n}else{if(!this._horizSashY){var e=this._readingPaneSashHorizPos||appCtxt.get(ZmSetting.READING_PANE_SASH_HORIZONTAL);\nvar f=e/100;\nvar g=this.getSize().y;\nthis._horizSashY=Math.round(f*g)\n}return this._horizSashY\n}};\nZmDoublePaneView.prototype.setReadingSashPosition=function(b,d){if(b){var c=this.getSize().x;\nvar e=Math.round((d/c)*100);\nif(this._controller.isSearchResults){this._readingPaneSashVertPos=e\n}else{appCtxt.set(ZmSetting.READING_PANE_SASH_VERTICAL,e)\n}}else{var g=this.getSize().y;\nvar f=Math.round((d/g)*100);\nif(this._controller.isSearchResults){this._readingPaneSashHorizPos=f\n}else{appCtxt.set(ZmSetting.READING_PANE_SASH_HORIZONTAL,f)\n}}};\nZmDoublePaneView.prototype._sashVertRelease=function(){this.setReadingSashPosition(true,this._vertSashX)\n};\nZmDoublePaneView.prototype._sashHorizRelease=function(){this.setReadingSashPosition(false,this._horizSashY)\n};\nZmDoublePaneView.prototype._controlEventListener=function(c){if(c&&(c.newWidth==c.requestedWidth)&&(c.newHeight==c.requestedHeight)){var b=this._controller.isReadingPaneOnRight();\nif(b){this._readingPaneSashVertPos=appCtxt.get(ZmSetting.READING_PANE_SASH_VERTICAL);\ndelete this._vertSashX\n}else{this._readingPaneSashHorizPos=appCtxt.get(ZmSetting.READING_PANE_SASH_HORIZONTAL);\ndelete this._horizSashY\n}var d=this.getSize();\nthis._resetSize(d.x,d.y,true)\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmTradView\")){ZmTradView=function(b){b.className=b.className||\"ZmTradView\";\nb.mode=ZmId.VIEW_TRAD;\nZmDoublePaneView.call(this,b)\n};\nZmTradView.prototype=new ZmDoublePaneView;\nZmTradView.prototype.constructor=ZmTradView;\nZmTradView.prototype.isZmTradView=true;\nZmTradView.prototype.toString=function(){return\"ZmTradView\"\n};\nZmTradView.prototype._createMailListView=function(b){return new ZmMailMsgListView(b)\n};\nZmTradView.prototype._createMailItemView=function(b){b.id=ZmId.getViewId(ZmId.VIEW_MSG,null,b.view);\nreturn new ZmMailMsgView(b)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmInviteMsgView\")){ZmInviteMsgView=function(b){if(arguments.length==0){return\n}this.parent=b.parent;\nthis.mode=b.mode\n};\nZmInviteMsgView.REPLY_INVITE_EVENT=\"inviteReply\";\nZmInviteMsgView.prototype.toString=function(){return\"ZmInviteMsgView\"\n};\nZmInviteMsgView.prototype.reset=function(b){if(this._inviteToolbar){if(b){this._inviteToolbar.dispose();\nthis._inviteToolbar=null\n}else{this._inviteToolbar.setDisplay(Dwt.DISPLAY_NONE)\n}}if(this._counterToolbar){if(b){this._counterToolbar.dispose();\nthis._counterToolbar=null\n}else{this._counterToolbar.setDisplay(Dwt.DISPLAY_NONE)\n}}if(this._dayView){if(b){this._dayView.dispose();\nthis._dayView=null\n}else{this._dayView.setDisplay(Dwt.DISPLAY_NONE)\n}Dwt.delClass(this.parent.getHtmlElement(),\"RightBorderSeparator\")\n}this._msg=null;\nthis._invite=null\n};\nZmInviteMsgView.prototype.isActive=function(){return((this._invite&&!this._invite.isEmpty())||(this._inviteToolbar&&this._inviteToolbar.getVisible())||(this._counterToolbar&&this._counterToolbar.getVisible()))\n};\nZmInviteMsgView.prototype.set=function(f){this._msg=f;\nvar u=this._invite=f.invite;\nthis.parent._lazyCreateObjectManager();\nvar g=appCtxt.getById(f.folderId);\nvar k=!appCtxt.isExternalAccount();\nif(k&&g&&g.isRemote()){var n=g.isPermAllowed(ZmOrganizer.PERM_WORKFLOW);\nvar m=g.isPermAllowed(ZmOrganizer.PERM_ADMIN);\nvar k=(m||n)&&(ZmOrganizer.normalizeId(f.folderId)!=ZmFolder.ID_TRASH)\n}if(u&&u.hasAcceptableComponents()&&f.folderId!=ZmFolder.ID_SENT){if(f.isInviteCanceled()){return\n}if(u.hasCounterMethod()){if(!this._counterToolbar){this._counterToolbar=this._getCounterToolbar()\n}this._counterToolbar.reparentHtmlElement(this.parent.getHtmlElement(),0);\nthis._counterToolbar.setVisible(k)\n}else{if(!u.isOrganizer()&&u.hasInviteReplyMethod()){var y=window.parentAppCtxt||window.appCtxt;\nif(AjxEnv.isIE&&this._inviteToolbar){this._inviteToolbar.dispose();\nthis._inviteToolbar=null\n}var h=this.getInviteToolbar();\nh.setVisible(k);\nthis._respondOnBehalfLabel.setContent(f.cif?AjxMessageFormat.format(ZmMsg.onBehalfOfText,[f.cif]):\"\");\nthis._respondOnBehalfLabel.setVisible(!!f.cif);\nvar s=AjxDispatcher.run(\"GetCalController\");\nvar w=f.getAccount();\nvar d=y.get(ZmSetting.CALENDAR_ENABLED,null,w)&&(!f.cif)?s.getCalendars({includeLinks:true,account:w,onlyWritable:true}):[];\nvar o=y.getById(f.getFolderId());\nvar t=o&&o.isMountpoint?ZmOrganizer.parseId(o.id).acctId:w.id;\nif(appCtxt.multiAccounts){var l=y.accountList.visibleAccounts;\nfor(var v=0;\nv<l.length;\nv++){var p=l[v];\nif(p==w||!y.get(ZmSetting.CALENDAR_ENABLED,null,p)){continue\n}if(appCtxt.isOffline&&p.isMain){continue\n}d=d.concat(s.getCalendars({includeLinks:true,account:p,onlyWritable:true}))\n}if(appCtxt.isOffline){d.push(appCtxt.getById(ZmOrganizer.ID_CALENDAR))\n}}var c=(d.length>1||appCtxt.multiAccounts);\nif(c){this._inviteMoveSelect.clearOptions();\nfor(var v=0;\nv<d.length;\nv++){var r=d[v];\nvar e=null;\nvar b;\nif(r.isMountpoint){b=ZmOrganizer.parseId(r.id).acctId\n}else{e=r.getAccount();\nb=e.id\n}var x=(appCtxt.multiAccounts&&e)?e.getIcon():(r.getIcon()+\",color=\"+r.color);\nvar z=(appCtxt.multiAccounts&&e)?([r.name,\" (\",e.getDisplayName(),\")\"].join(\"\")):r.name;\nvar j=(b&&t)?(b==t&&r.nId==appCtxt.get(ZmSetting.CAL_DEFAULT_ID)):r.nId==appCtxt.get(ZmSetting.CAL_DEFAULT_ID);\nif(f.cif&&r.owner==f.cif&&r.rid==appCtxt.get(ZmSetting.CAL_DEFAULT_ID)){j=true\n}var q=new DwtSelectOptionData(r.id,z,j,null,x);\nthis._inviteMoveSelect.addOption(q)\n}if(!y.get(ZmSetting.CALENDAR_ENABLED,null,w)){this._inviteMoveSelect.setSelectedValue(ZmOrganizer.ID_CALENDAR)\n}}this._inviteMoveSelect.setVisible(c)\n}}}};\nZmInviteMsgView.prototype.showMoreInfo=function(h,b){var f=this._invite&&this._invite.hasAttendeeResponse()&&this._invite.getAppointmentId();\nif(f!==\"0\"&&f){var g={GetAppointmentRequest:{_jsns:\"urn:zimbraMail\"}};\nvar c=g.GetAppointmentRequest;\nvar d=this._invite.msgId;\nvar e=d.indexOf(\":\");\nif(e!==-1){f=[d.substr(0,e),f].join(\":\")\n}c.id=f;\nappCtxt.getAppController().sendRequest({jsonObj:g,asyncMode:true,callback:(new AjxCallback(this,this._handleShowMoreInfo,[h,b]))})\n}else{this._showFreeBusy(b);\nif(h){h.run()\n}}};\nZmInviteMsgView.prototype._handleShowMoreInfo=function(m,h,o){var b=o&&o.getResponse().GetAppointmentResponse.appt[0];\nif(b){var j=this.parent._objectManager;\nvar g=[];\nvar l=0;\nvar c=b.inv[0].comp[0].at||[];\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\"]);\nvar n={};\nn.shortAddress=appCtxt.get(ZmSetting.SHORT_ADDRESS);\nfor(var f=0;\nf<c.length;\nf++){var d=c[f];\nvar e={icon:ZmCalItem.getParticipationStatusIcon(d.ptst),attendee:this.parent._getBubbleHtml(new AjxEmailAddress(d.a),n)};\ng[l++]=AjxTemplate.expand(\"mail.Message#InviteHeaderPtst\",e)\n}var k=document.getElementById(this._ptstId);\nif(k){k.innerHTML=g.join(\"\")\n}}if(m){m.run()\n}this._showFreeBusy(h)\n};\nZmInviteMsgView.prototype._showFreeBusy=function(d){var e=window.parentAppCtxt||window.appCtxt;\nif(!appCtxt.isChildWindow&&(e.get(ZmSetting.CALENDAR_ENABLED)||e.multiAccounts)&&(this._invite&&this._invite.type!=\"task\")){var f=this._getInviteDate();\nif(f==null){return\n}AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nvar i=AjxDispatcher.run(\"GetCalController\");\nif(!this._dayView){var c=(this.mode&&(this.mode==ZmId.VIEW_CONV2))?this.parent:this.parent.parent;\nthis._dayView=new ZmCalDayView(c,DwtControl.ABSOLUTE_STYLE,i,null,this.parent._viewId,null,true,true,this.isRight());\nthis._dayView.addSelectionListener(new AjxListener(this,this._apptSelectionListener));\nthis._dayView.setZIndex(Dwt.Z_VIEW)\n}this._dayView.setDisplay(Dwt.DISPLAY_BLOCK);\nthis._dayView.setDate(f,0,false);\nthis.resize();\nvar g=[].concat(i.getCheckedCalendarFolderIds());\nif(this._msg.cif){g=g.concat(i.getUncheckedCalendarIdsByOwner(this._msg.cif))\n}var b=this._dayView.getTimeRange();\nvar h={start:b.start,end:b.end,fanoutAllDay:this._dayView._fanoutAllDay(),callback:(new AjxCallback(this,this._dayResultsCallback,[d,f.getHours()])),accountFolderIds:[g]};\ni.apptCache.batchRequest(h)\n}};\nZmInviteMsgView.prototype._getInviteDate=function(){if(!this._invite){return null\n}var c=this._invite.getServerStartDate(null,true);\nif(c!=null){var b=this._invite.getServerStartTimeTz();\nc=AjxTimezone.convertTimezone(c,AjxTimezone.getClientId(b),AjxTimezone.DEFAULT)\n}return c\n};\nZmInviteMsgView.prototype.isRight=function(){return this.parent._controller.isReadingPaneOnRight()\n};\nZmInviteMsgView.prototype.convResize=function(){var c=this.parent.getSize();\nif(this._dayView){this._dayView.setSize(c.x-5,218);\nvar b=this._dayView.getHtmlElement();\nb.style.left=b.style.top=\"auto\";\nthis._dayView.layout()\n}};\nZmInviteMsgView.prototype.resize=function(k){if(appCtxt.isChildWindow){return\n}if(this.parent.isZmMailMsgCapsuleView){return\n}var o=this.isRight();\nvar c=this.parent.parent.getSize();\nif(k){if(o){this.parent.setSize(Dwt.DEFAULT,c.y)\n}else{this.parent.setSize(c.x,Dwt.DEFAULT)\n}}else{if(this._dayView){var n=0;\nif(this.parent.getController() instanceof ZmMsgController){var h=appCtxt.getAppViewMgr()._getContainerBounds(ZmAppViewMgr.C_APP_CONTENT);\nif(!o){c={x:h.width,y:h.height}\n}n=h.x\n}var m=this.parent.getBounds();\nif(isNaN(m.x)){m.x=0\n}if(isNaN(m.y)){m.y=0\n}if(o){var l=c.y;\nvar q=Math.floor(l/3);\nvar j=l-q;\nthis._dayView.setBounds(m.x,j,m.width,q);\nif(this.parent&&this.parent instanceof ZmMailMsgView){var b=this.parent.getHtmlElement();\nif(this.mode&&this.mode!=ZmId.VIEW_MSG){if(b){b.style.height=j+\"px\";\nDwt.setScrollStyle(b,Dwt.SCROLL)\n}}else{var e=this.parent.getMsgBodyElement();\nif(e){Dwt.setScrollStyle(e,Dwt.CLIP)\n}if(b){Dwt.setScrollStyle(b,Dwt.SCROLL);\nvar g=this.parent.getBounds().y||0;\nb.style.height=(j-g)+\"px\"\n}}}Dwt.delClass(this.parent.getHtmlElement(),\"RightBorderSeparator\")\n}else{var p=c.x;\nvar f=Math.floor(p/3);\nvar i=5;\nvar d=p-f-i;\nthis._dayView.setBounds(d+n+i,m.y,f,m.height);\nDwt.setSize(this.parent.getHtmlElement(),d,Dwt.DEFAULT);\nDwt.addClass(this.parent.getHtmlElement(),\"RightBorderSeparator\")\n}}}};\nZmInviteMsgView.prototype.enableToolbarButtons=function(g){var e={};\nswitch(g){case ZmCalBaseItem.PSTATUS_ACCEPT:e[ZmOperation.REPLY_ACCEPT]=true;\nbreak;\ncase ZmCalBaseItem.PSTATUS_DECLINED:e[ZmOperation.REPLY_DECLINE]=true;\nbreak;\ncase ZmCalBaseItem.PSTATUS_TENTATIVE:e[ZmOperation.REPLY_TENTATIVE]=true;\nbreak\n}if(appCtxt.isWebClientOffline()){e[ZmOperation.PROPOSE_NEW_TIME]=true\n}var f=this.getInviteToolbar();\nvar b=[ZmOperation.REPLY_ACCEPT,ZmOperation.REPLY_DECLINE,ZmOperation.REPLY_TENTATIVE,ZmOperation.PROPOSE_NEW_TIME];\nfor(var c=0;\nc<b.length;\nc++){var d=b[c];\nf.getButton(d).setEnabled(appCtxt.isExternalAccount()?false:!e[d])\n}};\nZmInviteMsgView.prototype.updatePtstMsg=function(e){var b=document.getElementById(this._ptstMsgBannerId);\nif(!b){return\n}b.className=ZmInviteMsgView.PTST_MSG[e].className;\nb.style.display=\"block\";\nvar d=document.getElementById(this._ptstMsgId);\nd.innerHTML=ZmInviteMsgView.PTST_MSG[e].msg;\nvar f=document.getElementById(this._ptstMsgIconId);\nvar c=ZmCalItem.getParticipationStatusIcon(e);\nf.innerHTML=AjxImg.getImageHtml(c)\n};\nZmInviteMsgView.PTST_MSG=[];\nZmInviteMsgView.PTST_MSG[ZmCalBaseItem.PSTATUS_ACCEPT]={msg:AjxMessageFormat.format(ZmMsg.inviteAccepted),className:\"InviteStatusAccept\"};\nZmInviteMsgView.PTST_MSG[ZmCalBaseItem.PSTATUS_DECLINED]={msg:AjxMessageFormat.format(ZmMsg.inviteDeclined),className:\"InviteStatusDecline\"};\nZmInviteMsgView.PTST_MSG[ZmCalBaseItem.PSTATUS_TENTATIVE]={msg:AjxMessageFormat.format(ZmMsg.inviteAcceptedTentatively),className:\"InviteStatusTentative\"};\nZmInviteMsgView.PTST_MSG[ZmCalBaseItem.PSTATUS_NEEDS_ACTION]={msg:AjxMessageFormat.format(ZmMsg.ptstMsgNeedsAction),className:\"InviteStatusTentative\"};\nZmInviteMsgView.prototype.addSubs=function(A,D,g,l){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nA.invite=this._invite;\nif(!this._msg.isInviteCanceled()&&!A.invite.isOrganizer()&&A.invite.hasInviteReplyMethod()){var h=this._msg.getPtst();\nthis.enableToolbarButtons(h);\nif(h){A.ptstMsg=ZmInviteMsgView.PTST_MSG[h].msg;\nA.ptstClassName=ZmInviteMsgView.PTST_MSG[h].className;\nA.ptstIcon=ZmCalItem.getParticipationStatusIcon(h)\n}}A.ptstMsgBannerId=this._ptstMsgBannerId=(this.parent._htmlElId+\"_ptstMsgBanner\");\nA.ptstMsgId=this._ptstMsgId=(this.parent._htmlElId+\"_ptstMsg\");\nA.ptstMsgIconId=this._ptstMsgIconId=(this.parent._htmlElId+\"_ptstMsgIcon\");\nvar k=this._invite&&this._invite.isOrganizer();\nvar n=this._invite.components&&this._invite.components[0].method===ZmId.OP_CANCEL;\nif(this._invite.hasCounterMethod()&&this._msg.folderId!=ZmFolder.ID_SENT){var x=this._msg.getAddress(AjxEmailAddress.FROM)&&this._msg.getAddress(AjxEmailAddress.FROM).getAddress();\nA.counterInvMsg=(!g||g==x)?AjxMessageFormat.format(ZmMsg.counterInviteMsg,[x]):AjxMessageFormat.format(ZmMsg.counterInviteMsgOnBehalfOf,[g,x])\n}else{if(n){var E=this._invite.getOrganizerName()||this._invite.getOrganizerEmail();\nA.ptstMsg=AjxMessageFormat.format(ZmMsg.inviteMsgCancelled,E.split());\nA.ptstIcon=ZmCalItem.getParticipationStatusIcon(ZmCalBaseItem.PSTATUS_DECLINED);\nA.ptstClassName=\"InviteStatusDecline\"\n}else{if(k&&this._invite.hasAttendeeResponse()){var m=this._invite.getAttendees()[0];\nvar p=m&&m.ptst;\nif(p){var t=[];\nvar d=m.d||m.a;\nvar D=m.sentBy;\nvar j=null;\nif(D){t.push(m.sentBy)\n}t.push(d);\nA.ptstIcon=ZmCalItem.getParticipationStatusIcon(p);\nswitch(p){case ZmCalBaseItem.PSTATUS_ACCEPT:j=(!D)?ZmMsg.inviteMsgAccepted:ZmMsg.inviteMsgOnBehalfOfAccepted;\nA.ptstClassName=\"InviteStatusAccept\";\nbreak;\ncase ZmCalBaseItem.PSTATUS_DECLINED:j=(!D)?ZmMsg.inviteMsgDeclined:ZmMsg.inviteMsgOnBehalfOfDeclined;\nA.ptstClassName=\"InviteStatusDecline\";\nbreak;\ncase ZmCalBaseItem.PSTATUS_TENTATIVE:j=(!D)?ZmMsg.inviteMsgTentative:ZmMsg.inviteMsgOnBehalfOfTentative;\nA.ptstClassName=\"InviteStatusTentative\";\nbreak\n}if(j){A.ptstMsg=AjxMessageFormat.format(j,t)\n}}}}}if(k&&this._invite&&this._invite.hasAttendeeResponse()&&this._invite.getAppointmentId()){A.ptstId=this._ptstId=(this.parent._htmlElId+\"_ptst\")\n}var e={};\ne.shortAddress=appCtxt.get(ZmSetting.SHORT_ADDRESS);\nvar o=this.parent._objectManager;\nvar c=new AjxEmailAddress(this._invite.getOrganizerEmail(),null,this._invite.getOrganizerName());\nA.invOrganizer=this.parent._getBubbleHtml(c,e);\nif(l){A.obo=this.parent._getBubbleHtml(l,e)\n}var D=this._invite.getSentBy();\nif(D){A.invSentBy=this.parent._getBubbleHtml(D,e)\n}if(this._msg.cif){A.intendedForMsg=AjxMessageFormat.format(ZmMsg.intendedForInfo,[this._msg.cif]);\nA.intendedForClassName=\"InviteIntendedFor\"\n}var v=[];\nvar u=[];\nvar C=this._invite.getAttendees();\nfor(var z=0;\nz<C.length;\nz++){var s=C[z];\nvar m=new AjxEmailAddress(s.a,null,s.d);\nif(s.role==ZmCalItem.ROLE_OPTIONAL){u.push(m)\n}else{v.push(m)\n}}var B=this.parent.getAddressesFieldInfo(v,e,\"inv\");\nA.invitees=B.html;\nB=this.parent.getAddressesFieldInfo(u,e,\"opt\");\nA.optInvitees=B.html;\nvar y=this._invite.getServerStartTimeTz();\nvar w=AjxTimezone.getServerId(AjxTimezone.DEFAULT);\nif(y){var b=AjxTimezone.convertTimezone(this._invite.getServerStartDate(null,true),AjxTimezone.getClientId(y),AjxTimezone.DEFAULT);\nvar f=AjxTimezone.convertTimezone(this._invite.getServerEndDate(null,true),AjxTimezone.getClientId(y),AjxTimezone.DEFAULT);\nA.timezone=AjxTimezone.getMediumName(w)\n}var r=this._invite.getDurationText(null,null,null,true,b,f);\nA.invDate=r;\nif(this._invite.isRecurring()){var q=new ZmRecurrence();\nq.setRecurrenceRules(this._invite.getRecurrenceRules(),this._invite.getServerStartDate());\nA.recur=q.getBlurb()\n}var F=this._invite.getChanges();\nif(F&&F[ZmInvite.CHANGES_LOCATION]){A.locChangeClass=\"InvChanged\"\n}if(F&&F[ZmInvite.CHANGES_SUBJECT]){A.subjChangeClass=\"InvChanged\"\n}if(F&&F[ZmInvite.CHANGES_TIME]){A.timeChangeClass=\"InvChanged\"\n}};\nZmInviteMsgView.truncateBodyContent=function(f,d){if(!f){return f\n}var g=f.indexOf(ZmItem.NOTES_SEPARATOR);\nif(g==-1){return f\n}if(d){f=f.replace(\"<div>\"+ZmItem.NOTES_SEPARATOR+\"</div>\",ZmItem.NOTES_SEPARATOR);\nf=f.replace(ZmItem.NOTES_SEPARATOR,\"<div id='separatorId'>\"+ZmItem.NOTES_SEPARATOR+\"</div>\");\nvar c=document.createElement(\"div\");\nc.innerHTML=f;\nvar e=Dwt.byId(\"separatorId\",c);\nif(e){var b=e.parentNode;\nwhile(e.previousSibling){b.removeChild(e.previousSibling)\n}b.removeChild(e)\n}return c.innerHTML\n}return f.substring(g+ZmItem.NOTES_SEPARATOR.length)\n};\nZmInviteMsgView.prototype._getCounterToolbar=function(){var e={parent:this.parent,buttons:[ZmOperation.ACCEPT_PROPOSAL,ZmOperation.DECLINE_PROPOSAL],posStyle:DwtControl.STATIC_STYLE,className:\"ZmCounterToolBar\",buttonClassName:\"DwtToolbarButton\",context:this.mode,toolbarType:ZmId.TB_COUNTER};\nvar b=new ZmButtonToolBar(e);\nvar d=new AjxListener(this,this._inviteToolBarListener);\nfor(var c=0;\nc<b.opList.length;\nc++){b.addSelectionListener(b.opList[c],d)\n}return b\n};\nZmInviteMsgView.prototype.getInviteToolbar=function(){if(!this._inviteToolbar){this._inviteToolbar=this._createInviteToolbar();\nthis._inviteToolbar.setDisplay(Dwt.DISPLAY_NONE)\n}return this._inviteToolbar\n};\nZmInviteMsgView.prototype._createInviteToolbar=function(){var g=[ZmOperation.INVITE_REPLY_ACCEPT,ZmOperation.INVITE_REPLY_TENTATIVE,ZmOperation.INVITE_REPLY_DECLINE];\nvar p=[ZmOperation.REPLY_ACCEPT_NOTIFY,ZmOperation.REPLY_TENTATIVE_NOTIFY,ZmOperation.REPLY_DECLINE_NOTIFY];\nvar q=[ZmOperation.REPLY_ACCEPT_IGNORE,ZmOperation.REPLY_TENTATIVE_IGNORE,ZmOperation.REPLY_DECLINE_IGNORE];\nvar o=[ZmOperation.REPLY_ACCEPT,ZmOperation.REPLY_TENTATIVE,ZmOperation.REPLY_DECLINE,ZmOperation.PROPOSE_NEW_TIME];\nvar h={parent:this.parent,buttons:o,posStyle:DwtControl.STATIC_STYLE,className:\"ZmInviteToolBar\",buttonClassName:\"DwtToolbarButton\",context:this.parent.getHTMLElId(),toolbarType:ZmId.TB_INVITE};\nvar l=new ZmButtonToolBar(h);\nvar e=new AjxListener(this,this._inviteToolBarListener);\nfor(var m=0;\nm<l.opList.length;\nm++){var c=l.opList[m];\nl.addSelectionListener(c,e);\nif(c==ZmOperation.PROPOSE_NEW_TIME){continue\n}var n=l.getButton(c);\nvar f=[p[m],g[m],q[m]];\nvar d=new ZmActionMenu({parent:n,menuItems:f});\nf=d.opList;\nfor(var k=0;\nk<f.length;\nk++){var b=d.getItem(k);\nb.addSelectionListener(e)\n}n.setMenu(d)\n}this._respondOnBehalfLabel=l.addFiller();\nl.addFiller();\nthis._inviteMoveSelect=new DwtSelect({parent:l});\nthis._inviteMoveSelect.setVisible(false);\nreturn l\n};\nZmInviteMsgView.prototype._inviteToolBarListener=function(b){b._inviteReplyType=b.item.getData(ZmOperation.KEY_ID);\nb._inviteReplyFolderId=((this._inviteMoveSelect&&this._inviteMoveSelect.getValue())||ZmOrganizer.ID_CALENDAR);\nb._inviteComponentId=null;\nb._msg=this._msg;\nthis.parent.notifyListeners(ZmInviteMsgView.REPLY_INVITE_EVENT,b)\n};\nZmInviteMsgView.prototype._dayResultsCallback=function(c,b,e,f,d){if(this._dayView){this._dayView.set(e,true);\nthis._dayView._scrollToTime(b)\n}if(c){c.run()\n}};\nZmInviteMsgView.prototype.getDayView=function(){return this._dayView\n};\nZmInviteMsgView.prototype._apptSelectionListener=function(d){if(d.detail==DwtListView.ITEM_DBL_CLICKED){var c=d.item;\nif(c.isPrivate()&&c.getFolder().isRemote()&&!c.getFolder().hasPrivateAccess()){var b=appCtxt.getMsgDialog();\nb.setMessage(ZmMsg.apptIsPrivate,DwtMessageDialog.INFO_STYLE);\nb.popup()\n}else{var e=AjxDispatcher.run(\"GetCalController\");\ne._showAppointmentDetails(c)\n}}};\nZmInviteMsgView.prototype.scrollToInvite=function(){var b=this._getInviteDate();\nif((b!=null)&&this._dayView){this._dayView._scrollToTime(b.getHours())\n}};\nZmInviteMsgView.prototype.repositionCounterToolbar=function(b){if(this._invite&&this._invite.hasCounterMethod()&&b&&this._counterToolbar){this._counterToolbar.reparentHtmlElement(b+\"_counterToolbar\",0)\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmMailMsgView\")){ZmMailMsgView=function(b){if(arguments.length==0){return\n}b.className=b.className||\"ZmMailMsgView\";\nZmMailItemView.call(this,b);\nthis._mode=b.mode;\nthis._controller=b.controller;\nthis._viewId=this._getViewId(b.sessionId);\nthis._displayImagesId=ZmId.getViewId(this._viewId,ZmId.MV_DISPLAY_IMAGES,this._mode);\nthis._msgTruncatedId=ZmId.getViewId(this._viewId,ZmId.MV_MSG_TRUNC,this._mode);\nthis._infoBarId=ZmId.getViewId(this._viewId,ZmId.MV_INFO_BAR,this._mode);\nthis._tagRowId=ZmId.getViewId(this._viewId,ZmId.MV_TAG_ROW,this._mode);\nthis._tagCellId=ZmId.getViewId(this._viewId,ZmId.MV_TAG_CELL,this._mode);\nthis._attLinksId=ZmId.getViewId(this._viewId,ZmId.MV_ATT_LINKS,this._mode);\nthis._scrollWithIframe=b.scrollWithIframe;\nthis._limitAttachments=this._scrollWithIframe?3:0;\nthis._attcMaxSize=this._limitAttachments*16+8;\nthis.setScrollStyle(this._scrollWithIframe?DwtControl.CLIP:DwtControl.SCROLL);\nZmTagsHelper.setupListeners(this);\nthis._setMouseEventHdlrs();\nthis._objectManager=true;\nthis._changeListener=this._msgChangeListener.bind(this);\nthis.addListener(DwtEvent.ONSELECTSTART,this._selectStartListener.bind(this));\nthis.addListener(DwtEvent.CONTROL,this._controlEventListener.bind(this));\nif(!appCtxt.isOffline){this._setAllowSelection()\n}this.noTab=true;\nthis._attachmentLinkIdToFileNameMap=null;\nthis._bubbleParams={};\nif(this._controller&&this._controller._checkKeepReading){Dwt.setHandler(this.getHtmlElement(),DwtEvent.ONSCROLL,ZmDoublePaneController.handleScroll)\n}this._tabGroupMember=new DwtTabGroup(\"ZmMailMsgView\");\nthis._headerTabGroup=new DwtTabGroup(\"ZmMailMsgView (header)\");\nthis._attachmentTabGroup=new DwtTabGroup(\"ZmMailMsgView (attachments)\");\nthis._bodyTabGroup=new DwtTabGroup(\"ZmMailMsgView (body)\");\nthis._footerTabGroup=new DwtTabGroup(\"ZmMailMsgView (footer)\");\nthis._tabGroupMember.addMember([this._headerTabGroup,this._bodyTabGroup,this._footerTabGroup]);\nif(this._mode===ZmId.VIEW_TRAD){this.setAttribute(\"role\",\"region\")\n}};\nZmMailMsgView.prototype=new ZmMailItemView;\nZmMailMsgView.prototype.constructor=ZmMailMsgView;\nZmMailMsgView.prototype.isZmMailMsgView=true;\nZmMailMsgView.prototype.toString=function(){return\"ZmMailMsgView\"\n};\nZmMailMsgView.displayAdditionalHdrsInMsgView={};\nZmMailMsgView.SCROLL_WITH_IFRAME=true;\nZmMailMsgView.LIMIT_ATTACHMENTS=ZmMailMsgView.SCROLL_WITH_IFRAME?3:0;\nZmMailMsgView.ATTC_COLUMNS=2;\nZmMailMsgView.ATTC_MAX_SIZE=ZmMailMsgView.LIMIT_ATTACHMENTS*16+8;\nZmMailMsgView.QUOTE_DEPTH_MOD=3;\nZmMailMsgView.MAX_SIG_LINES=8;\nZmMailMsgView.SIG_LINE=/^(- ?-+)|(__+)\\r?$/;\nZmMailMsgView._inited=false;\nZmMailMsgView.SHARE_EVENT=\"share\";\nZmMailMsgView.SUBSCRIBE_EVENT=\"subscribe\";\nZmMailMsgView.IMG_FIX_RE=new RegExp(\"(<img\\\\s+.*dfsrc\\\\s*=\\\\s*)[\\\"']http[^'\\\"]+part=([\\\\d\\\\.]+)[\\\"']([^>]*>)\",\"gi\");\nZmMailMsgView.FILENAME_INV_CHARS_RE=/[\\.\\/?*:;{}'\\\\]/g;\nZmMailMsgView.SETHEIGHT_MAX_TRIES=3;\nZmMailMsgView._URL_RE=/^((https?|ftps?):\\x2f\\x2f.+)$/;\nZmMailMsgView._MAILTO_RE=/^mailto:[\\x27\\x22]?([^@?&\\x22\\x27]+@[^@?&]+\\.[^@?&\\x22\\x27]+)[\\x27\\x22]?/;\nZmMailMsgView.MAX_ADDRESSES_IN_FIELD=10;\nZmMailMsgView.TRUSTED_TAGS=[\"#text\",\"a\",\"abbr\",\"acronym\",\"address\",\"article\",\"b\",\"basefont\",\"bdo\",\"big\",\"blockquote\",\"body\",\"br\",\"caption\",\"center\",\"cite\",\"code\",\"col\",\"colgroup\",\"dd\",\"del\",\"dfn\",\"dir\",\"div\",\"dl\",\"dt\",\"em\",\"font\",\"footer\",\"h1\",\"h2\",\"h3\",\"h4\",\"h5\",\"h6\",\"head\",\"header\",\"hr\",\"html\",\"i\",\"img\",\"ins\",\"kbd\",\"li\",\"mark\",\"menu\",\"meter\",\"nav\",\"ol\",\"p\",\"pre\",\"q\",\"s\",\"samp\",\"section\",\"small\",\"span\",\"strike\",\"strong\",\"sub\",\"sup\",\"table\",\"tbody\",\"td\",\"tfoot\",\"th\",\"thead\",\"time\",\"tr\",\"tt\",\"u\",\"ul\",\"var\",\"wbr\"];\nZmMailMsgView.UNTRUSTED_ATTRS=[\"id\",\"class\",\"name\",\"profile\"];\nZmMailMsgView.prototype.getController=function(){return this._controller\n};\nZmMailMsgView.prototype.reset=function(){if(this._resizeAction){AjxTimedAction.cancelAction(this._resizeAction);\nthis._resizeAction=null\n}if(this._objectsAction){AjxTimedAction.cancelAction(this._objectsAction);\nthis._objectsAction=null\n}this._msg=this._item=null;\nthis._htmlBody=null;\nthis._containerEl=null;\nif(this._ifw){this._ifw.dispose();\nthis._ifw=null\n}if(this._inviteMsgView){this._inviteMsgView.reset(true)\n}var b=this.getHtmlElement();\nif(b){b.innerHTML=\"\"\n}if(this._objectManager&&this._objectManager.reset){this._objectManager.reset()\n}this.setScrollWithIframe(this._scrollWithIframe)\n};\nZmMailMsgView.prototype.dispose=function(){ZmTagsHelper.disposeListeners(this);\nZmMailItemView.prototype.dispose.apply(this,arguments)\n};\nZmMailMsgView.prototype.preventSelection=function(){return false\n};\nZmMailMsgView.prototype.set=function(f,e,c){if(!e&&this._msg&&f&&!f.force&&(this._msg==f)){return\n}var b=this._msg;\nthis.reset();\nvar d=this._getContainer();\nthis._msg=this._item=f;\nif(!f){if(this._inviteMsgView){this._inviteMsgView.resize(true)\n}d.innerHTML=(this._controller.getList().size())?AjxTemplate.expand(\"mail.Message#viewMessage\"):\"\";\nreturn\n}f.force=false;\nvar g=this._handleResponseSet.bind(this,f,b,c);\nthis._renderMessage(f,d,g)\n};\nZmMailMsgView.prototype._getContainer=function(){return this.getHtmlElement()\n};\nZmMailMsgView.prototype.__hasMountpoint=function(c){var b=appCtxt.getFolderTree();\nreturn b?this.__hasMountpoint2(b.root,c.grantor.id,c.link.id):false\n};\nZmMailMsgView.prototype.__hasMountpoint2=function(b,f,e){if(b.zid==f&&b.rid==e){return true\n}if(b.children){var d=b.children.getArray();\nfor(var c=0;\nc<d.length;\nc++){var g=this.__hasMountpoint2(d[c],f,e);\nif(g){return true\n}}}return false\n};\nZmMailMsgView.prototype.highlightObjects=function(d){if(d!=null){this._lazyCreateObjectManager();\nvar c=this._objectManager.findObjects(d,true,null,true);\nc=c.replace(/^ /mg,\"&nbsp;\").replace(/\\t/g,\"<pre style='display:inline;'>\\t</pre>\").replace(/\\n/g,\"<br>\");\nvar b=this.getContentContainer();\nb.innerHTML=c\n}else{this._processHtmlDoc()\n}};\nZmMailMsgView.prototype.resetMsg=function(b){if(this._msg){this._msg.removeChangeListener(this._changeListener)\n}};\nZmMailMsgView.prototype.getMsg=function(){return this._msg\n};\nZmMailMsgView.prototype.getItem=ZmMailMsgView.prototype.getMsg;\nZmMailMsgView.prototype.getSelection=function(){return[this._msg]\n};\nZmMailMsgView.prototype.getSelectionCount=function(){return 1\n};\nZmMailMsgView.prototype.getMinHeight=function(){if(!this._headerHeight){var b=document.getElementById(this._hdrTableId);\nthis._headerHeight=b?Dwt.getSize(b).y:0\n}return this._headerHeight\n};\nZmMailMsgView.prototype.hasHtmlBody=function(){return this._htmlBody!=null\n};\nZmMailMsgView.prototype.getDocument=function(){return this._usingIframe?Dwt.getIframeDoc(this.getIframe()):document\n};\nZmMailMsgView.prototype.getIframe=function(){if(!this._usingIframe){return null\n}var b=this._iframeId&&document.getElementById(this._iframeId);\nb=b||(this._ifw&&this._ifw.getIframe());\nreturn b\n};\nZmMailMsgView.prototype.getIframeElement=ZmMailMsgView.prototype.getIframe;\nZmMailMsgView.prototype.getContentContainer=function(){if(this._usingIframe){var c=this.getDocument();\nvar b=c&&c.body;\nreturn b&&b.childNodes.length===1?b.firstChild:b\n}else{return this._containerEl\n}};\nZmMailMsgView.prototype.getContent=function(){var b=this.getContentContainer();\nreturn b?b.innerHTML:\"\"\n};\nZmMailMsgView.prototype.addInviteReplyListener=function(b){this.addListener(ZmInviteMsgView.REPLY_INVITE_EVENT,b)\n};\nZmMailMsgView.prototype.addShareListener=function(b){this.addListener(ZmMailMsgView.SHARE_EVENT,b)\n};\nZmMailMsgView.prototype.addSubscribeListener=function(b){this.addListener(ZmMailMsgView.SUBSCRIBE_EVENT,b)\n};\nZmMailMsgView.prototype.getTabGroupMember=function(){return this._tabGroupMember\n};\nZmMailMsgView.prototype._getMessageTabMember=function(){if(this._usingIframe){return this.getIframe().parentNode\n}else{return Dwt.byId(this._msgBodyDivId)\n}};\nZmMailMsgView.prototype.setVisible=function(f,b,e){DwtComposite.prototype.setVisible.apply(this,arguments);\nvar c=this._inviteMsgView;\nif(!c){return\n}if(f&&this._msg){if(this._msg!=e){var d=c.getDayView();\nif(!d){return\n}d.setIsRight(b);\nc.set(this._msg);\nc.repositionCounterToolbar(this._hdrTableId);\nc.showMoreInfo(null,null,b)\n}}else{c.reset()\n}};\nZmMailMsgView.prototype._getSubscribeToolbar=function(b){if(this._subscribeToolbar){if(AjxEnv.isIE){this._subscribeToolbar.dispose();\nthis._subscribeToolbar=null\n}else{return this._subscribeToolbar\n}}this._subscribeToolbar=this._getButtonToolbar([ZmOperation.SUBSCRIBE_APPROVE,ZmOperation.SUBSCRIBE_REJECT],ZmId.TB_SUBSCRIBE,this._subscribeToolBarListener.bind(this,b));\nreturn this._subscribeToolbar\n};\nZmMailMsgView.prototype._getShareToolbar=function(){if(this._shareToolbar){if(AjxEnv.isIE){this._shareToolbar.dispose();\nthis._shareToolbar=null\n}else{return this._shareToolbar\n}}this._shareToolbar=this._getButtonToolbar([ZmOperation.SHARE_ACCEPT,ZmOperation.SHARE_DECLINE],ZmId.TB_SHARE,this._shareToolBarListener.bind(this));\nreturn this._shareToolbar\n};\nZmMailMsgView.prototype._getButtonToolbar=function(d,g,h){var j={parent:this,buttons:d,posStyle:DwtControl.STATIC_STYLE,className:\"ZmShareToolBar\",buttonClassName:\"DwtToolbarButton\",context:this._mode,toolbarType:g};\nvar f=new ZmButtonToolBar(j);\nfor(var e=0;\ne<d.length;\ne++){var k=d[e];\nvar c=f.getButton(k);\nc._hoverClassName=c._className+\"-\"+DwtCssStyle.HOVER;\nc._activeClassName=c._className+\"-\"+DwtCssStyle.ACTIVE;\nf.addSelectionListener(k,h)\n}return f\n};\nZmMailMsgView.prototype._handleResponseSet=function(g,c,d){var b=false;\nif(this._inviteMsgView){if(this._inviteMsgView.isActive()&&(this._controller.isReadingPaneOn()||(this._controller.isZmMsgController))){b=true;\nappCtxt.notifyZimlets(\"onMsgView\",[g,c,this]);\nthis._inviteMsgView.showMoreInfo(this._createBubbles.bind(this),d)\n}else{this._inviteMsgView.resize(true)\n}}this._setTags(g);\nif(c){c.removeChangeListener(this._changeListener)\n}g.addChangeListener(this._changeListener);\nif(g.cloneOf){g.cloneOf.addChangeListener(this._changeListener)\n}if(c&&c.cloneOf){c.cloneOf.removeChangeListener(this._changeListener)\n}var f=this.getHtmlElement();\nf.scrollTop=0;\nif(f.scrollTop!=0&&this._usingIframe){AjxDebug.println(AjxDebug.SCROLL,\"scrollTop not set to 0. scrollTop=\"+f.scrollTop+\" offsetHeight=\"+f.offsetHeight+\" scrollHeight=\"+f.scrollHeight+\" browser=\"+navigator.userAgent);\nAjxDebug.dumpObj(AjxDebug.SCROLL,f.outerHTML);\nvar e=this.getIframe();\nif(e){e.style.height=\"1px\";\nAjxDebug.println(AjxDebug.SCROLL,\"scrollTop after resetting it with the hack =\"+f.scrollTop)\n}}if(!b){this._createBubbles();\nappCtxt.notifyZimlets(\"onMsgView\",[g,c,this])\n}if(!g.isDraft&&g.readReceiptRequested){this._controller.sendReadReceipt(g)\n}};\nZmMailMsgView.__localLinkClicked=function(f,i){var c=this.getAttribute(\"href\");\nvar d=null;\nvar j=this.ownerDocument;\nif(c.substr(0,1)==\"#\"){c=c.substr(1);\nd=j.getElementById(c);\nif(!d){try{d=j.getElementsByName(c)[0]\n}catch(g){}}if(!d){c=decodeURIComponent(c);\nd=j.getElementById(c);\nif(!d){try{d=j.getElementsByName(c)[0]\n}catch(g){}}}}if(d){var b=f.getHtmlElement();\nvar e=f.getIframe();\nvar h=Dwt.getLocation(d);\nb.scrollTop=h.y+e.offsetTop-20;\nb.scrollLeft=h.x+e.offsetLeft\n}if(i){i.stopPropagation();\ni.preventDefault()\n}return false\n};\nZmMailMsgView.prototype.hasValidHref=function(c){try{var b=c.href;\nreturn ZmMailMsgView._URL_RE.test(b)||ZmMailMsgView._MAILTO_RE.test(b)\n}catch(d){return false\n}};\nZmMailMsgView.prototype._processHtmlDoc=function(){var d=this._usingIframe?this.getDocument():this._containerEl;\nif(!d){return\n}var b=d.getElementsByTagName(\"img\");\nif(b.length>0){var e=b.length;\nfor(var c=0;\nc<b.length;\nc++){this._checkImgInAttachments(b[c])\n}}this.lazyFindMailMsgObjects(500)\n};\nZmMailMsgView.prototype.lazyFindMailMsgObjects=function(b){var c=(this._msg&&this._msg.folderId==ZmOrganizer.ID_SPAM);\nif(this._objectManager&&!this._disposed&&!c){this._lazyCreateObjectManager();\nthis._objectsAction=new AjxTimedAction(this,this._findMailMsgObjects);\nAjxTimedAction.scheduleAction(this._objectsAction,(b||500))\n}};\nZmMailMsgView.prototype._findMailMsgObjects=function(){var c=this.getDocument();\nif(c){var b=this.getContentContainer();\nthis._objectManager.processObjectsInNode(c,b)\n}};\nZmMailMsgView.prototype._checkImgInAttachments=function(j){if(!this._msg){return\n}if(j.getAttribute(\"zmforced\")){j.className=\"InlineImage\";\nreturn\n}var g=this._msg.attachments;\nvar d=appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI);\ntry{var c=j.getAttribute(\"src\")||j.getAttribute(\"dfsrc\")\n}catch(k){AjxDebug.println(AjxDebug.DATA_URI,\"_checkImgInAttachments: couldn't access attribute src or dfsrc\")\n}var l;\nif(/^cid:(.*)/.test(c)){l=\"<\"+RegExp.$1+\">\"\n}for(var h=0;\nh<g.length;\nh++){var m=g[h];\nif(m.foundInMsgBody){continue\n}if(l&&m.contentId==l){m.foundInMsgBody=true;\nbreak\n}else{if(c&&c.indexOf(d)==0){var f=c.substring(c.lastIndexOf(\"=\")+1);\nif(f==m.part){m.foundInMsgBody=true;\nbreak\n}}else{if(m.contentLocation&&c){var b=c.substring(c.lastIndexOf(\"/\")+1);\nif(b==m.fileName){m.foundInMsgBody=true;\nbreak\n}}}}}};\nZmMailMsgView.prototype._fixMultipartRelatedImages=function(b,h){var g=h.getElementsByTagName(\"img\");\nvar j=false;\nif(this._usingIframe){var k=this;\nvar c=function(){ZmMailMsgView._resetIframeHeight(k);\nthis.onload=null\n}\n}for(var d=0;\nd<g.length;\nd++){var e=g[d];\nvar f=ZmMailMsgView._isExternalImage(e);\nif(!f){ZmMailMsgView.__unfangInternalImage(b,e,\"src\",false);\nif(c){e.onload=c\n}}else{e.src=\"/img/zimbra/1x1-trans.png\";\ne.setAttribute(\"savedDisplayMode\",e.style.display);\ne.style.display=\"none\"\n}j=f||j\n}j=this._fixMultipartRelatedImagesRecurse(b,this._usingIframe?h.body:h)||j;\nreturn !j\n};\nZmMailMsgView.prototype._fixMultipartRelatedImagesRecurse=function(e,d){var b=false;\nfunction c(f){var g=f.firstChild;\nwhile(g){if(g.nodeType==AjxUtil.ELEMENT_NODE){b=ZmMailMsgView.__unfangInternalImage(e,g,\"background\",true)||b;\nc(g)\n}g=g.nextSibling\n}}if(d.innerHTML.indexOf(\"dfbackground\")!=-1){c(d)\n}else{if(d.attributes&&d.getAttribute(\"dfbackground\")!=-1){b=ZmMailMsgView.__unfangInternalImage(e,d,\"background\",true)\n}}if(!b&&$(d).find(\"table[dfbackground], td[dfbackground]\").length){b=true\n}return b\n};\nZmMailMsgView._isExternalImage=function(b){if(!b){return false\n}return Boolean(b.getAttribute(\"dfsrc\"))\n};\nZmMailMsgView.__unfangInternalImage=function(h,d,c,g){var b,j;\nif(typeof c==\"undefined\"){return false\n}try{if(g){b=d.getAttribute(\"df\"+c)\n}else{j=b=d.getAttribute(\"pn\"+c);\nb=b||d.getAttribute(c)\n}}catch(f){AjxDebug.println(AjxDebug.DATA_URI,\"__unfangInternalImage: couldn't access attribute \"+c)\n}if(typeof b!==\"undefined\"&&b){if(b.substr(0,4)==\"cid:\"){if(typeof h==\"undefined\"){return false\n}var i=\"<\"+AjxStringUtil.urlComponentDecode(b.substr(4))+\">\";\nb=h.getContentPartAttachUrl(ZmMailMsg.CONTENT_PART_ID,i);\nif(b){d.setAttribute(c,b)\n}return false\n}else{if(b.substring(0,4)==\"doc:\"){b=[appCtxt.get(ZmSetting.REST_URL),ZmFolder.SEP,b.substring(4)].join(\"\");\nif(b){d.setAttribute(c,b);\nreturn false\n}}else{if(j){if(typeof h==\"undefined\"){return false\n}b=h.getContentPartAttachUrl(ZmMailMsg.CONTENT_PART_LOCATION,b);\nif(b){d.setAttribute(c,b);\nreturn false\n}}else{if(b.substring(0,5)==\"data:\"){return false\n}}}}return true\n}return false\n};\nZmMailMsgView.prototype._createDisplayImageClickClosure=function(d,c,e){var b=this;\nreturn function(r){var n=DwtUiEvent.getTarget(r),s=n?n.id:null,v=\"\";\nvar f=document.getElementById(e);\nvar g=(d&&d.showImages)||appCtxt.get(ZmSetting.DISPLAY_EXTERNAL_IMAGES);\nif(!g){if(!s){return\n}if(s.indexOf(\"domain\")!=-1){v=d.sentByDomain\n}else{if(s.indexOf(\"email\")!=-1){v=d.sentByAddr\n}else{if(s.indexOf(\"dispImgs\")!=-1){}else{if(s.indexOf(\"close\")!=-1){Dwt.setVisible(f,false);\nreturn\n}else{return\n}}}}}if(v){var m=b.getTrustedSendersList();\nm.add(v,null,true);\nvar t=b._addTrustedAddrCallback.bind(b,v);\nvar l=b._addTrustedAddrErrorCallback.bind(b,v);\nb._controller.addTrustedAddr(m.getArray(),t,l)\n}var p=c.getElementsByTagName(\"img\");\nvar h=null;\nif(b._usingIframe){h=function(){ZmMailMsgView._resetIframeHeight(b);\nthis.onload=null\n}\n}for(var k=0;\nk<p.length;\nk++){var q=p[k].getAttribute(\"dfsrc\");\nif(q&&q.match(/https?:\\/\\/([-\\w\\.]+)+(:\\d+)?(\\/([\\w\\_\\.]*(\\?\\S+)?)?)?/)){p[k].onload=h;\ntry{p[k].src=\"\";\np[k].src=p[k].getAttribute(\"dfsrc\")\n}catch(o){}p[k].style.display=p[k].getAttribute(\"savedDisplayMode\")\n}}var j=$(c).find(\"table[dfbackground], td[dfbackground]\");\nfor(var k=0;\nk<j.length;\nk++){var u=$(j[k]).attr(\"dfbackground\");\nif(ZmMailMsgView._URL_RE.test(u)){$(j[k]).attr(\"background\",u)\n}}Dwt.setVisible(f,false);\nb._htmlBody=b.getContentContainer().innerHTML;\nif(d){d.setHtmlContent(b._htmlBody);\nd.showImages=true\n}return false\n}\n};\nZmMailMsgView.prototype._resetIframeHeightOnTimer=function(c){if(!this._usingIframe){return\n}var b=this._resizeAction=new AjxTimedAction(this,ZmMailMsgView._resetIframeHeight,[this,c]);\nAjxTimedAction.scheduleAction(b,200)\n};\nZmMailMsgView.prototype._makeHighlightObjectsDiv=function(d){var b=this;\nfunction c(){var e=document.getElementById(b._highlightObjectsId);\ne.innerHTML=ZmMsg.pleaseWaitHilitingObjects;\nsetTimeout(function(){b.highlightObjects(d);\ne.parentNode.removeChild(e);\nZmMailMsgView._resetIframeHeight(b)\n},3);\nreturn false\n}(function(){var g=document.getElementById(b._infoBarId);\nif(g){b._highlightObjectsId=ZmId.getViewId(b._viewId,ZmId.MV_HIGHLIGHT_OBJ,b._mode);\nvar f={id:b._highlightObjectsId,text:ZmMsg.objectsNotDisplayed,link:ZmMsg.hiliteObjects};\nvar e=AjxTemplate.expand(\"mail.Message#InformationBar\",f);\ng.appendChild(Dwt.parseHtmlFragment(e));\nvar h=document.getElementById(f.id+\"_link\");\nDwt.setHandler(h,DwtEvent.ONCLICK,c)\n}})()\n};\nZmMailMsgView.prototype._stripHtmlComments=function(b){var c=/<(?:!(?:--[\\s\\S]*?--\\s*)?(>)\\s*|(?:script|style|SCRIPT|STYLE)[\\s\\S]*?<\\/(?:script|style|SCRIPT|STYLE)>)/g;\nb=b.replace(c,function(e,d){return d?\"\":e\n});\nreturn b\n};\nZmMailMsgView.prototype._useIframe=function(d,c,b){return true\n};\nZmMailMsgView.prototype._displayContent=function(E){var q=E.html||\"\";\nif(!E.isTextMsg){q=q.replace(/<span style=\"font-family:Wingdings\">J<\\/span>/g,\"\\u263a\");\nq=q.replace(/<span style=\"font-family:Wingdings\">L<\\/span>/g,\"\\u2639\")\n}var D=(this._msg&&this._msg.folderId==ZmOrganizer.ID_SPAM);\nvar t=(!this._msg||!this._msg.showImages);\nthis._needToShowInfoBar=D||(!E.isTextMsg&&(!appCtxt.get(ZmSetting.DISPLAY_EXTERNAL_IMAGES))&&t&&(/<img/i.test(q)||/<[^>]+dfbackground/.test(q)));\nvar b;\nif(this._needToShowInfoBar){b=this._showInfoBar(this._infoBarId)\n}var g;\nvar F=(q.length/1024);\nvar A=appCtxt.get(ZmSetting.HIGHLIGHT_OBJECTS);\nif(E.isTextMsg){if(this._objectManager){if(F<=A){g=this.lazyFindMailMsgObjects.bind(this,500)\n}else{this._makeHighlightObjectsDiv(E.origText)\n}}if(AjxEnv.isSafari){q=\"<html><head></head><body>\"+q+\"</body></html>\"\n}}else{q=this._stripHtmlComments(q);\nif(this._objectManager){var p=q.match(/<img[^>]+>/ig);\nF=(p)?F-(p.join().length/1024):F;\nif(F<=A){g=this._processHtmlDoc.bind(this)\n}else{this._makeHighlightObjectsDiv()\n}}}var v;\nthis._isMsgTruncated=false;\nif(E.isTruncated){this._isMsgTruncated=true;\nvar s=document.getElementById(this._msgTruncatedId);\nif(!s){var d=document.getElementById(this._infoBarId);\nif(d){var z={id:this._msgTruncatedId,text:ZmMsg.messageTooLarge,link:ZmMsg.viewEntireMessage};\nvar l=AjxTemplate.expand(\"mail.Message#InformationBar\",z);\nv=Dwt.parseHtmlFragment(l);\nd.appendChild(v);\nDwt.setHandler(v,DwtEvent.ONCLICK,this._handleMsgTruncated.bind(this))\n}}}this._msgBodyDivId=[this._htmlElId,ZmId.MV_MSG_BODY].join(\"_\");\nthis._bodyTabGroup.removeAllMembers();\nthis._usingIframe=this._useIframe(E.isTextMsg,q,E.isTruncated);\nif(this._usingIframe){var C={parent:this,parentElement:E.container,index:E.index,className:this._getBodyClass(),id:this._msgBodyDivId,hidden:true,html:\"<div>\"+(this._cleanedHtml||q)+\"</div>\",noscroll:!this._scrollWithIframe,posStyle:DwtControl.STATIC_STYLE,processHtmlCallback:g,useKbMgmt:true,title:this._getIframeTitle()};\nif(AjxEnv.isIE){C.styles=\".MsgBody-text, .MsgBody-text * { font: 10pt monospace; }\"\n}var h=this._ifw=new DwtIframe(C);\nif(h.initFailed){AjxDebug.println(AjxDebug.MSG_DISPLAY,\"Message display: IFRAME was not ready\");\nappCtxt.setStatusMsg(ZmMsg.messageDisplayProblem);\nreturn\n}this._iframeId=h.getIframe().id;\nvar w=h.getDocument();\nif(AjxEnv.isGeckoBased){var r=ZmMailMsgView.__localLinkClicked.bind(null,this);\nvar c=w.getElementsByTagName(\"a\");\nfor(var y=c.length;\n--y>=0;\n){var j=c[y];\nif(!j.target){j.onclick=r\n}}}Dwt.addClass(w.documentElement,\"user_font_size_\"+appCtxt.get(ZmSetting.FONT_SIZE));\nDwt.addClass(w.documentElement,\"user_font_\"+appCtxt.get(ZmSetting.FONT_NAME));\nw.body.className=this._getBodyClass()+(E.isTextMsg?\" MsgBody-text\":\" MsgBody-html\");\nvar e=w.body.offsetWidth;\nw.body.style.height=\"auto\";\nw.body.style.width=(e-20)+\"px\";\nw.body.style.position=\"absolute\";\nh.getIframe().onload=this._onloadIframe.bind(this,h);\nvar f=w.getElementsByTagName(\"head\")[0];\nif(!f){f=w.createElement(\"head\");\nw.body.parentNode.insertBefore(f,w.body)\n}if(!ZmMailMsgView._CSS){var x=[appContextPath,\"/css/msgview.css?v=\",cacheKillerVersion,\"&locale=\",window.appRequestLocaleId,\"&skin=\",window.appCurrentSkin].join(\"\");\nif(AjxEnv.supported.localstorage){ZmMailMsgView._CSS=localStorage.getItem(x)\n}if(!ZmMailMsgView._CSS){var o=AjxRpc.invoke(null,x,null,null,true);\nZmMailMsgView._CSS=o&&o.text\n}}var B=document.createElement(\"style\");\nvar n=document.createTextNode(ZmMailMsgView._CSS);\nB.type=\"text/css\";\nif(B.styleSheet){B.styleSheet.cssText=n.nodeValue\n}else{B.appendChild(n)\n}f.appendChild(B);\nh.getIframe().style.visibility=\"\";\nthis._bodyTabGroup.addMember(h)\n}else{var u=this._containerEl=document.createElement(\"div\");\nu.id=this._msgBodyDivId;\nu.className=\"MsgBody MsgBody-\"+(E.isTextMsg?\"text\":\"html\");\nvar k=this.getHtmlElement();\nif(!k){AjxDebug.println(AjxDebug.MSG_DISPLAY,\"Message display: DIV was not ready\");\nappCtxt.setStatusMsg(ZmMsg.messageDisplayProblem);\nreturn\n}if(E.index!=null){k.insertBefore(u,k.childNodes[E.index])\n}else{k.appendChild(u)\n}u.innerHTML=this._cleanedHtml||q;\nthis._makeFocusable(u);\nthis._bodyTabGroup.addMember(u)\n}if(!E.isTextMsg){this._htmlBody=this.getContentContainer().innerHTML;\nvar m=this._fixMultipartRelatedImages(this._msg,w||this._containerEl);\nif(m){Dwt.setVisible(b,false);\nthis._needToShowInfoBar=false\n}else{this._setupInfoBarClicks(b)\n}}this._resetIframeHeightOnTimer();\nif(g){g.run()\n}};\nZmMailMsgView.prototype._makeIframeProxy=ZmMailMsgView.prototype._displayContent;\nZmMailMsgView.prototype._showInfoBar=function(g,e,f){g=(typeof(g)==\"string\")?document.getElementById(g):g;\nif(!g){return\n}var h;\nvar b=document.getElementById(this._displayImagesId);\nif(!b){if(g){var d={id:this._displayImagesId,text:ZmMsg.externalImages,link:ZmMsg.displayExternalImages,alwaysText:ZmMsg.alwaysDisplayExternalImages,domain:this._msg.sentByDomain,email:this._msg.sentByAddr,or:ZmMsg.or};\nvar c=AjxTemplate.expand(\"mail.Message#ExtImageInformationBar\",d);\nh=Dwt.parseHtmlFragment(c);\ng.appendChild(h)\n}}return h\n};\nZmMailMsgView.prototype._setupInfoBarClicks=function(d){var b=this._usingIframe?this.getDocument():this._containerEl;\nvar c=this._createDisplayImageClickClosure(this._msg,b,this._displayImagesId);\nif(d){Dwt.setHandler(d,DwtEvent.ONCLICK,c)\n}else{if(appCtxt.get(ZmSetting.DISPLAY_EXTERNAL_IMAGES)||(this._msg&&this._msg.showImages)){c.call()\n}}};\nZmMailMsgView.prototype._getBodyClass=function(){return\"MsgBody\"\n};\nZmMailMsgView.prototype._addTrustedAddrCallback=function(d){this.getTrustedSendersList().add(d,null,true);\nappCtxt.set(ZmSetting.TRUSTED_ADDR_LIST,this.getTrustedSendersList().getArray());\nvar b=appCtxt.getApp(ZmApp.PREFERENCES);\nvar c=b&&b.refresh;\nif(c&&(typeof(c)==\"function\")){c.apply(b,[null,d])\n}};\nZmMailMsgView.prototype._addTrustedAddrErrorCallback=function(b){this.getTrustedSendersList().remove(b)\n};\nZmMailMsgView.prototype._isTrustedSender=function(c){var b=this.getTrustedSendersList();\nif(b.contains(c.sentByAddr.toLowerCase())||b.contains(c.sentByDomain.toLowerCase())){return true\n}return false\n};\nZmMailMsgView.prototype.getTrustedSendersList=function(){return this._controller.getApp().getTrustedSendersList()\n};\nZmMailMsgView.showMore=function(b,d){var e=document.getElementById(this._getShowMoreId(b,d));\nif(e){Dwt.setVisible(e,false)\n}var c=document.getElementById(this._getMoreId(b,d));\nif(c){c.style.display=\"inline\"\n}};\nZmMailMsgView._getShowMoreId=function(b,c){return b+\"showmore_\"+c\n};\nZmMailMsgView._getMoreId=function(b,c){return b+\"more_addrs_\"+c\n};\nZmMailMsgView.prototype.getAddressesFieldHtmlHelper=function(g,l,j){var b={};\nvar k=0,e=[];\nfor(var f=0;\nf<g.length;\nf++){if(f>0){e[k++]=\" \"\n}if(f==ZmMailMsgView.MAX_ADDRESSES_IN_FIELD){var d=ZmMailMsgView._getShowMoreId(this._htmlElId,j);\nb.showMoreLinkId=d+\"_link\";\nvar c=ZmMailMsgView._getMoreId(this._htmlElId,j);\ne[k++]=\"<span id='\"+d+\"' style='white-space:nowrap'>&nbsp;\";\ne[k++]=\"<a id='\"+b.showMoreLinkId+\"' href='' onclick='ZmMailMsgView.showMore(\\\"\"+this._htmlElId+'\", \"'+j+\"\\\"); return false;'>\";\ne[k++]=ZmMsg.showMore;\ne[k++]=\"</a></span><span style='display:none;' id='\"+c+\"'>\"\n}var h=g[f];\nif(h.address){e[k++]=this._getBubbleHtml(h,l)\n}else{e[k++]=AjxStringUtil.htmlEncode(h.name)\n}}if(b.showMoreLinkId){e[k++]=\"</span>\"\n}b.html=e.join(\"\");\nreturn b\n};\nZmMailMsgView.prototype._getBubbleHtml=function(h,e){if(!h){return\"\"\n}e=e||{};\nh=h.isAjxEmailAddress?h:new AjxEmailAddress(h);\nvar c=h.isGroup&&h.canExpand&&appCtxt.get(\"EXPAND_DL_ENABLED\"),b=this._controller;\nif(c&&!this._aclv){var f={dataClass:appCtxt.getAutocompleter(),matchValue:ZmAutocomplete.AC_VALUE_FULL,options:{massDLComplete:true},selectionCallback:b._dlAddrSelected.bind(b),contextId:this.toString()};\nthis._aclv=new ZmAutocompleteListView(f)\n}var g=ZmId.create({app:ZmId.APP_MAIL,containingView:this._viewId,field:ZmId.FLD_PARTICIPANT});\nvar d={parent:appCtxt.getShell(),parentId:this._htmlElId,addrObj:h,id:g,canExpand:c,email:h.address};\nZmAddressInputField.BUBBLE_OBJ_ID[g]=this._htmlElId;\nthis._bubbleParams[g]=d;\nreturn\"<span id='\"+g+\"'></span>\"\n};\nZmMailMsgView.prototype._clearBubbles=function(){if(this._bubbleList){this._bubbleList.clear()\n}this._bubbleList=new ZmAddressBubbleList();\nvar b=this._controller;\nthis._bubbleList.addSelectionListener(b._bubbleSelectionListener.bind(b));\nthis._bubbleList.addActionListener(b._bubbleActionListener.bind(b));\nthis._bubbleParams={}\n};\nZmMailMsgView.prototype._createBubbles=function(){for(var d in this._bubbleParams){if(!document.getElementById(d)){continue\n}var c=this._bubbleParams[d];\nif(c.created){continue\n}c.created=true;\nvar b=new ZmAddressBubble(c);\nb.replaceElement(d);\nif(this._bubbleList){this._bubbleList.add(b);\nthis._headerTabGroup.addMember(b)\n}}};\nZmMailMsgView.prototype.getAddressesFieldInfo=function(e,b,d,c){return this.getAddressesFieldHtmlHelper(e,b,d,this._objectManager,c||this._htmlElId)\n};\nZmMailMsgView.prototype._renderMessage=function(c,b,d){this._renderMessageHeader(c,b);\nthis._renderMessageBody(c,b,d);\nthis._renderMessageFooter(c,b);\nDwt.setLoadedTime(\"ZmMailItem\")\n};\nZmMailMsgView.prototype._renderMessageHeader=function(i,p,f){if(!f){this._clearBubbles()\n}this._renderInviteToolbar(i,p);\nvar v=this._getAddrInfo(i);\nvar j=AjxStringUtil.htmlEncode(i.subject||ZmMsg.noSubject);\nvar l=AjxDateFormat.getDateTimeInstance(AjxDateFormat.LONG,AjxDateFormat.SHORT);\nvar x=new Date(i.sentDate||i.date);\nvar y=l.format(x);\nvar B=[];\nvar t=i.invite;\nvar e=AjxUtil.isDate(i.autoSendTime)?AjxDateFormat.getDateTimeInstance(AjxDateFormat.FULL,AjxDateFormat.MEDIUM).format(i.autoSendTime):null;\nif(i.attrs){for(var q in ZmMailMsgView.displayAdditionalHdrsInMsgView){if(i.attrs[q]){B.push({hdrName:ZmMailMsgView.displayAdditionalHdrsInMsgView[q],hdrVal:i.attrs[q]})\n}}}var g={};\ng.shortAddress=appCtxt.get(ZmSetting.SHORT_ADDRESS);\nvar h=i.getAttachmentCount(true);\nvar k=appCtxt.getById(i.folderId);\nvar o=(k&&k.nId==ZmOrganizer.ID_SYNC_FAILURES);\nif(!i.showImages){i.showImages=k&&k.isFeed()\n}this._hdrTableId=ZmId.getViewId(this._viewId,ZmId.MV_HDR_TABLE,this._mode);\nvar c=ZmId.getViewId(this._viewId,ZmId.MV_REPORT_BTN_CELL,this._mode);\nthis._expandRowId=ZmId.getViewId(this._viewId,ZmId.MV_EXPAND_ROW,this._mode);\nvar s=v.sentByContact&&v.sentByContact.getImageUrl(48,96),b=s&&v.sentByContact&&v.sentByContact.getFullName();\nvar u={id:this._htmlElId,hdrTableId:this._hdrTableId,hdrTableTopRowId:ZmId.getViewId(this._viewId,ZmId.MV_HDR_TABLE_TOP_ROW,this._mode),expandRowId:this._expandRowId,attachId:this._attLinksId,infoBarId:this._infoBarId,subject:j,imageURL:s||ZmZimbraMail.DEFAULT_CONTACT_ICON,imageAltText:b||ZmMsg.noContactImage,dateString:y,hasAttachments:(h!=0),attachmentsCount:h,bwo:v.bwo,bwoAddr:v.bwoAddr,bwoId:ZmId.getViewId(this._viewId,ZmId.CMP_BWO_SPAN,this._mode)};\nif(i.isHighPriority||i.isLowPriority){u.priority=i.isHighPriority?\"high\":\"low\";\nu.priorityImg=i.isHighPriority?\"ImgPriorityHigh_list\":\"ImgPriorityLow_list\";\nu.priorityDivId=ZmId.getViewId(this._view,ZmId.MV_PRIORITY)\n}if(t&&!t.isEmpty()&&this._inviteMsgView){this._getInviteSubs(u,v.sentBy,v.sentByAddr,v.sender?v.fromAddr:null)\n}else{u.sentBy=v.sentBy;\nu.sentByNormal=v.sentByAddr;\nu.sentByAddr=v.sentByAddr;\nu.obo=v.obo;\nu.oboAddr=v.oboAddr;\nu.oboId=ZmId.getViewId(this._viewId,ZmId.CMP_OBO_SPAN,this._mode);\nu.addressTypes=v.addressTypes;\nu.participants=v.participants;\nu.reportBtnCellId=c;\nu.isSyncFailureMsg=o;\nu.autoSendTime=e;\nu.additionalHdrs=B;\nu.isOutDated=t&&t.isEmpty()\n}var A=(t&&!t.isEmpty()&&this._inviteMsgView)?\"mail.Message#InviteHeader\":\"mail.Message#MessageHeader\";\nvar n=AjxTemplate.expand(A,u);\nvar d=p||this.getHtmlElement();\nd.setAttribute(\"aria-label\",j);\nd.appendChild(Dwt.parseHtmlFragment(n));\nthis._headerElement=Dwt.byId(this._htmlElId+\"_headerElement\");\nthis._makeFocusable(this._headerElement);\nthis._headerTabGroup.removeAllMembers();\nthis._headerTabGroup.addMember(this._headerElement);\nif(this._inviteMsgView){if(this._inviteToolbarCellId&&this._inviteToolbarCellId&&this._inviteMsgView._inviteToolbar){this._inviteMsgView._inviteToolbar.reparentHtmlElement(this._inviteToolbarCellId,0)\n}if(this._calendarSelectCellId&&this._inviteMsgView._inviteMoveSelect){this._inviteMsgView._inviteMoveSelect.reparentHtmlElement(this._calendarSelectCellId,0)\n}this._inviteMsgView.repositionCounterToolbar(this._hdrTableId);\nthis._headerTabGroup.addMember(this._inviteMsgView._inviteToolbar)\n}var z=document.getElementById(c);\nif(z){var r=ZmId.getButtonId(this._mode,ZmId.REPORT,ZmId.MSG_VIEW);\nvar m=new DwtButton({parent:this,id:r,parentElement:z});\nm.setText(ZmMsg.reportSyncFailure);\nm.addSelectionListener(this._reportButtonListener.bind(this,i))\n}if(this._hasShareToolbar){var w=this._getShareToolbar();\nw.reparentHtmlElement(p);\nw.setVisible(Dwt.DISPLAY_BLOCK);\nthis._headerTabGroup.addMember(w)\n}};\nZmMailMsgView.prototype._getAddrInfo=function(l){var t=appCtxt.getActiveAccount().id;\nvar q;\nif(appCtxt.get(ZmSetting.CONTACTS_ENABLED)&&appCtxt.getApp(ZmApp.CONTACTS).contactsLoaded[t]){q=AjxDispatcher.run(\"GetContacts\")\n}var b=l.getAddress(AjxEmailAddress.FROM);\nif(!b){var m=l.folderId&&appCtxt.getById(l.folderId);\nif(m&&m.isOutbound()){var F=appCtxt.getIdentityCollection().defaultIdentity;\nif(F){b=new AjxEmailAddress(F.sendFromAddress,AjxEmailAddress.FROM,F.sendFromDisplay)\n}}}var d=l.getAddress(AjxEmailAddress.SENDER);\nvar C=(d&&d.address)?d:b;\nvar w=AjxStringUtil.htmlEncode(b?b.toString(true):ZmMsg.unknown);\nvar h=C&&C.getAddress();\nif(h){l.sentByAddr=h;\nl.sentByDomain=h.substr(h.indexOf(\"@\")+1);\nl.showImages=this._isTrustedSender(l)\n}var B=q&&q.getContactByEmail(C&&C.getAddress());\nvar r=d?b:null;\nvar D=r&&r.getAddress();\nvar o=l.getAddress(AjxEmailAddress.RESENT_FROM);\nvar E=o?o.getAddress():null;\nvar u=appCtxt.getApp(ZmApp.CONTACTS);\nif(u){var n=[];\nif(C){n.push(C)\n}if(r){n.push(r)\n}for(var z=1;\nz<ZmMailMsg.ADDRS.length;\nz++){var g=ZmMailMsg.ADDRS[z];\nif((g==AjxEmailAddress.SENDER)||(g==AjxEmailAddress.RESENT_FROM)){continue\n}var s=l.getAddresses(g).getArray();\nfor(var y=0;\ny<s.length;\ny++){if(s[y]){n.push(s[y].address)\n}}}if(n.length>1){u.setAddrLookupGroup(n)\n}}var f={};\nf.shortAddress=appCtxt.get(ZmSetting.SHORT_ADDRESS);\nif(this._objectManager){this._lazyCreateObjectManager();\nappCtxt.notifyZimlets(\"onFindMsgObjects\",[l,this._objectManager,this])\n}C=this._getBubbleHtml(C);\nr=r&&this._getBubbleHtml(b);\no=o&&this._getBubbleHtml(o);\nvar p={};\nvar c=[],e={};\nfor(var z=0;\nz<ZmMailMsg.ADDRS.length;\nz++){var g=ZmMailMsg.ADDRS[z];\nif((g==AjxEmailAddress.FROM)||(g==AjxEmailAddress.SENDER)||(g==AjxEmailAddress.RESENT_FROM)){continue\n}var s=AjxEmailAddress.dedup(l.getAddresses(g).getArray());\nif(g==AjxEmailAddress.REPLY_TO){var v=s.length;\nfor(var y=0;\ny<v;\n){if(s[y].address===b.address){s.splice(y,1);\nv--\n}else{y++\n}}}if(s.length>0){var x=AjxStringUtil.htmlEncode(ZmMsg[AjxEmailAddress.TYPE_STRING[g]]);\nvar A=this.getAddressesFieldInfo(s,f,g);\nc.push(g);\ne[g]={prefix:x,partStr:A.html};\nif(A.showMoreLinkId){p[A.showMoreLinkId]=true\n}}}return{fromAddr:b,from:w,sender:d,sentBy:C,sentByAddr:h,sentByContact:B,obo:r,oboAddr:D,bwo:o,bwoAddr:E,addressTypes:c,participants:e,showMoreIds:p}\n};\nZmMailMsgView.prototype._getInviteSubs=function(d,e,b,c,g){this._inviteMsgView.addSubs(d,e,b,c?g:null);\nvar f=this._inviteMsgView;\nif(f._inviteToolbar&&f._inviteToolbar.getVisible()){d.toolbarCellId=this._inviteToolbarCellId=[this._viewId,\"inviteToolbarCell\"].join(\"_\")\n}if(f._inviteMoveSelect&&f._inviteMoveSelect.getVisible()){d.calendarSelectCellId=this._calendarSelectCellId=[this._viewId,\"calendarSelectToolbarCell\"].join(\"_\")\n}};\nZmMailMsgView.prototype._renderInviteToolbar=function(e,c){this._dateObjectHandlerDate=new Date(e.sentDate||e.date);\nthis._hasShareToolbar=this._hasSubToolbar=false;\nvar k=e.invite;\nvar j=window.parentAppCtxt||window.appCtxt;\nif((j.get(ZmSetting.CALENDAR_ENABLED)||j.multiAccounts)&&(k&&!k.isEmpty()&&k.type!=\"task\")){if(!this._inviteMsgView){this._inviteMsgView=new ZmInviteMsgView({parent:this,mode:this._mode})\n}this._inviteMsgView.set(e)\n}else{if(appCtxt.get(ZmSetting.SHARING_ENABLED)&&e.share&&ZmOrganizer.normalizeId(e.folderId)!=ZmFolder.ID_TRASH&&ZmOrganizer.normalizeId(e.folderId)!=ZmFolder.ID_SENT&&appCtxt.getActiveAccount().id!=e.share.grantor.id){AjxDispatcher.require(\"Share\");\nvar f=e.share.action;\nvar h=f==ZmShare.NEW;\nvar g=f==ZmShare.EDIT;\nvar d=appCtxt.getById(e.folderId);\nvar i=(d&&d.isDataSource(null,true)&&(e.folderId!=ZmFolder.ID_INBOX));\nif(!i&&(h||(g&&!this.__hasMountpoint(e.share)))&&e.share.link.perm){this._hasShareToolbar=true\n}}else{if(e.subscribeReq&&e.folderId!=ZmFolder.ID_TRASH){var b=this._getSubscribeToolbar(e.subscribeReq);\nb.reparentHtmlElement(c);\nb.setVisible(Dwt.DISPLAY_BLOCK);\nthis._hasSubToolbar=true\n}}}};\nZmMailMsgView.prototype._renderMessageBody=function(d,b,g,c){var f=appCtxt.get(ZmSetting.VIEW_AS_HTML);\nvar e=f?ZmMimeTable.TEXT_HTML:ZmMimeTable.TEXT_PLAIN;\nd.getBodyPart(e,this._renderMessageBody1.bind(this,{msg:d,container:b,callback:g,index:c}))\n};\nZmMailMsgView.prototype._renderMessageBody1=function(E,t){var h=E.msg,f=appCtxt.get(ZmSetting.VIEW_AS_HTML),p=E.forceType||(f?ZmMimeTable.TEXT_HTML:ZmMimeTable.TEXT_PLAIN),C=(p===ZmMimeTable.TEXT_HTML&&h.hasContentType(ZmMimeTable.TEXT_HTML))||h.hasInlineImage(),n=h.hasMultipleBodyParts(),F=n?h.getBodyParts(p):[h.getBodyPart(p)||h.getBodyPart()],y=h.invite,r=y&&!y.isEmpty(),g,u=!C,G=false,d=false,o=[];\nF=AjxUtil.collapseList(F);\nfor(var A=0;\nA<F.length;\nA++){var H=F[A],e=H.contentType,x=this._getBodyContent(H),w=ZmMimeTable.isRenderableImage(e),q=(e===ZmMimeTable.TEXT_HTML),l=(e===ZmMimeTable.TEXT_PLAIN);\nG=G||this.isTruncated(H);\nif(r&&!n){if(!h.getMimeHeader(ZmMailMsg.HDR_INREPLYTO)){x=ZmInviteMsgView.truncateBodyContent(x,q)\n}var D=AjxStringUtil.stripTags(x);\nif(!AjxStringUtil._NON_WHITESPACE.test(D)){x=\"\"\n}}if(w){var k=(n&&x.length>0)?x:h.getUrlForPart(H),B=n?\"class='InlineImage' \":\" \";\nx=\"<img \"+[\"zmforced='1' \"+B+\"src='\"+k+\"'>\"].join(\"\")\n}else{if(e===ZmMimeTable.TEXT_CAL){x=ZmMailMsg.getTextFromCalendarPart(H);\nx=AjxStringUtil.htmlEncode(x)\n}else{if(q){if(f){if(h._attachments&&ZmMailMsgView.IMG_FIX_RE.test(x)){var v={};\nfor(var z=0;\nz<h._attachments.length;\nz++){var s=h._attachments[z];\nif(s.contentId){v[s.part]=s.contentId.substring(1,s.contentId.length-1)\n}}x=x.replace(ZmMailMsgView.IMG_FIX_RE,function(i,J,I,j){return v[I]?[J,'\"cid:',v[I],'\"',j].join(\"\"):i\n})\n}}else{x=\"<div style='white-space:pre-wrap;'>\"+AjxStringUtil.htmlEncode(AjxStringUtil.convertHtml2Text(x))+\"</div>\"\n}}else{if(l){g=x;\nif(H.format===ZmMimeTable.FORMAT_FLOWED){var b={text:x,isFlowed:true};\nx=AjxStringUtil.wordWrap(b)\n}x=AjxStringUtil.convertToHtml(x);\nif(x&&n&&C){x=\"<pre>\"+x+\"</pre>\"\n}}else{x=AjxStringUtil.convertToHtml(x)\n}}}}if(x&&x.length){if(!w&&AjxStringUtil.trimHtml(x).length>0){x=\"<div>\"+x+\"</div>\";\nd=true\n}o.push(x)\n}}if(!n&&!d&&h.hasNoViewableContent()){if(h.hasContentType(ZmMimeTable.MULTI_ALT)&&!E.forceType){var c=(p===ZmMimeTable.TEXT_HTML)?ZmMimeTable.TEXT_PLAIN:ZmMimeTable.TEXT_HTML;\nE.forceType=c;\nh.getBodyPart(c,this._renderMessageBody1.bind(this,E));\nreturn\n}var m=AjxTemplate.expand(\"mail.Message#EmptyMessage\");\no.push(x?[m,x].join(\"<br><br>\"):m)\n}if(o.length>0){this._displayContent({container:E.container||this.getHtmlElement(),html:o.join(\"\"),isTextMsg:u,isTruncated:G,index:E.index,origText:g})\n}this._completeMessageBody(E.callback,u)\n};\nZmMailMsgView.prototype.isTruncated=function(b){return b.isTruncated\n};\nZmMailMsgView.prototype._completeMessageBody=function(c,b){this._msgBodyCreated=true;\nthis._setAttachmentLinks(AjxUtil.isBoolean(b)?b:appCtxt.get(ZmSetting.VIEW_AS_HTML));\nif(c){c.run()\n}};\nZmMailMsgView.prototype._getBodyContent=function(b){return b?b.getContent():\"\"\n};\nZmMailMsgView.prototype._renderMessageFooter=function(c,b){};\nZmMailMsgView.prototype._setTags=function(e){if(!e){e=this._item\n}if(e&&e.cloneOf){e=e.cloneOf\n}var d=ZmTagsHelper.getTagsHtml(e,this);\nvar c=document.getElementById(this._hdrTableId);\nif(!c){return\n}var f=$(c).find(document.getElementById(this._tagRowId));\nif(f.length){f.remove()\n}if(d.length>0){var b=this._insertTagRow(c,this._tagCellId);\nb.innerHTML=d\n}};\nZmMailMsgView.prototype._insertTagRow=function(e,d){if(!e){return\n}var f=e.insertRow(-1);\nf.id=this._tagRowId;\nvar c=f.insertCell(-1);\nc.className=\"LabelColName\";\nc.innerHTML=ZmMsg.tags+\":\";\nc.style.verticalAlign=\"middle\";\nvar b=f.insertCell(-1);\nb.id=d;\nreturn b\n};\nZmMailMsgView.ATT_LINK_MAIN=\"main\";\nZmMailMsgView.ATT_LINK_CALENDAR=\"calendar\";\nZmMailMsgView.ATT_LINK_DOWNLOAD=\"download\";\nZmMailMsgView.ATT_LINK_BRIEFCASE=\"briefcase\";\nZmMailMsgView.ATT_LINK_VCARD=\"vcard\";\nZmMailMsgView.ATT_LINK_HTML=\"html\";\nZmMailMsgView.ATT_LINK_REMOVE=\"remove\";\nZmMailMsgView.prototype._setAttachmentLinks=function(D){this._attachmentLinkIdToFileNameMap=null;\nvar B=this._msg.getAttachmentInfo(true,false,D);\nvar c=document.getElementById(this._attLinksId+\"_container\");\nif(c){c.style.display=(B.length==0)?\"none\":\"\"\n}if(B.length==0){return\n}var z=document.getElementById(this._attLinksId+\"_table\");\nif(z){return\n}var E=[];\nvar w=0;\nvar K=0;\nvar x=(this._controller.isReadingPaneOn()&&this._controller.isReadingPaneOnRight())?1:ZmMailMsgView.ATTC_COLUMNS;\nvar f=w;\nE[w++]=\"<table id='\"+this._attLinksId+\"_table' border=0 cellpadding=0 cellspacing=0>\";\nvar A=[];\nvar o=0;\nfor(var H=0;\nH<B.length;\nH++){var C=B[H];\nif((H%x)==0){if(H!=0){E[w++]=\"</tr>\"\n}E[w++]=\"<tr>\";\n++o\n}E[w++]=\"<td>\";\nE[w++]=\"<table border=0 cellpadding=0 cellspacing=0 style='margin-right:1em; margin-bottom:1px'><tr>\";\nE[w++]=\"<td style='width:18px'>\";\nE[w++]=AjxImg.getImageHtml({imageName:C.linkIcon,styles:\"position:relative;\",altText:ZmMsg.attachment});\nE[w++]=\"</td><td style='white-space:nowrap'>\";\nif(appCtxt.get(ZmSetting.ATTACHMENTS_BLOCKED)){E[w++]=C.label\n}else{var q=[];\nvar G=0;\nvar F=AjxStringUtil.clipFile(C.label,30);\nif(F!=C.label){if(!this._attachmentLinkIdToFileNameMap){this._attachmentLinkIdToFileNameMap={}\n}this._attachmentLinkIdToFileNameMap[C.attachmentLinkId]=C.label\n}var J={att:C,id:this._getAttachmentLinkId(C.part,ZmMailMsgView.ATT_LINK_MAIN),text:F,mid:C.mid,rfc822Part:C.rfc822Part};\nvar l=ZmMailMsgView.getMainAttachmentLinkHtml(J);\nl=C.isHit?\"<span class='AttName-matched'>\"+l+\"</span>\":l;\nif(C.objectify&&this._objectManager){this._lazyCreateObjectManager();\nvar p=this._objectManager.getImageAttachmentHandler();\nw=this._objectManager.generateSpan(p,E,w,l,{url:C.url})\n}else{E[w++]=l\n}}var n=0;\nvar h=(C.links.vcard&&!appCtxt.isWebClientOffline());\nif(!appCtxt.isExternalAccount()&&(C.size||C.links.html||h||C.links.download||C.links.briefcase||C.links.importICS)){E[w++]=\"&nbsp;(\";\nif(C.size){E[w++]=C.size;\nE[w++]=\") \"\n}if(C.links.html&&!appCtxt.get(ZmSetting.ATTACHMENTS_BLOCKED)){var J={id:this._getAttachmentLinkId(C.part,ZmMailMsgView.ATT_LINK_HTML),blankTarget:true,href:C.url+\"&view=html\",text:ZmMsg.preview};\nE[w++]=ZmMailMsgView.getAttachmentLinkHtml(J);\nn++;\nA.push(J.id)\n}else{if(h){var J={id:this._getAttachmentLinkId(C.part,ZmMailMsgView.ATT_LINK_VCARD),jsHref:true,text:ZmMsg.addressBook};\nE[w++]=ZmMailMsgView.getAttachmentLinkHtml(J);\nn++;\nA.push(J.id)\n}}if(C.links.download&&!appCtxt.get(ZmSetting.ATTACHMENTS_BLOCKED)&&!appCtxt.get(ZmSetting.ATTACHMENTS_VIEW_IN_HTML_ONLY)){E[w++]=n?\" | \":\"\";\nvar J={id:this._getAttachmentLinkId(C.part,ZmMailMsgView.ATT_LINK_DOWNLOAD),text:ZmMsg.download};\nif(C.url.indexOf(\"data:\")===-1){J.href=C.url+\"&disp=a\"\n}else{J.href=C.url;\nJ.download=true;\nJ.downloadLabel=C.label\n}E[w++]=ZmMailMsgView.getAttachmentLinkHtml(J);\nn++;\nA.push(J.id)\n}if(C.links.briefcase&&!appCtxt.get(ZmSetting.ATTACHMENTS_BLOCKED)&&!appCtxt.isWebClientOffline()){E[w++]=n?\" | \":\"\";\nvar J={id:this._getAttachmentLinkId(C.part,ZmMailMsgView.ATT_LINK_BRIEFCASE),jsHref:true,text:ZmMsg.addToBriefcase};\nE[w++]=ZmMailMsgView.getAttachmentLinkHtml(J);\nn++;\nA.push(J.id)\n}if(C.links.importICS){E[w++]=n?\" | \":\"\";\nvar J={id:this._getAttachmentLinkId(C.part,ZmMailMsgView.ATT_LINK_CALENDAR),jsHref:true,text:ZmMsg.addToCalendar};\nE[w++]=ZmMailMsgView.getAttachmentLinkHtml(J);\nn++;\nA.push(J.id)\n}if(C.links.remove&&!appCtxt.isWebClientOffline()){E[w++]=n?\" | \":\"\";\nvar J={id:this._getAttachmentLinkId(C.part,ZmMailMsgView.ATT_LINK_REMOVE),jsHref:true,text:ZmMsg.remove};\nE[w++]=ZmMailMsgView.getAttachmentLinkHtml(J);\nn++;\nA.push(J.id)\n}if(ZmMailMsgView._attachmentHandlers){var I=ZmMailMsgView._attachmentHandlers[C.ct];\nvar k;\nif(I){for(var b in I){k=I[b];\nif(k){var v=k.call(this,C);\nif(v){E[w++]=\" | \"+v\n}}}}}}E[w++]=\"</td></tr></table>\";\nE[w++]=\"</td>\";\nif(C.ct.indexOf(\"image\")!=-1){++K\n}}if(this._limitAttachments!=0&&o>ZmMailMsgView._limitAttachments){E[f]=\"<div style='height:\";\nE[f]=this._attcMaxSize;\nE[f]=\"px; overflow:auto;' />\"\n}E[w++]=\"</tr></table>\";\nvar y;\nvar g=false;\nfor(var H=0;\nH<B.length;\nH++){g=g||C.generated\n}if(!g&&B.length>1&&!appCtxt.isWebClientOffline()){y=this._addAllAttachmentsLinks(B,(K>1),this._msg.subject);\nE[w++]=y.html\n}var d=document.getElementById(this._attLinksId);\nif(d){d.innerHTML=E.join(\"\")\n}for(var H=0;\nH<B.length;\nH++){var C=B[H];\nif(C.ct==ZmMimeTable.MSG_RFC822){this._addClickHandler(C.part,ZmMailMsgView.ATT_LINK_MAIN,ZmMailMsgView.rfc822Callback,null,this._msg.id,C.part)\n}if(C.links.importICS){this._addClickHandler(C.part,ZmMailMsgView.ATT_LINK_CALENDAR,ZmMailMsgView.addToCalendarCallback,null,this._msg.id,C.part)\n}if(C.links.briefcase){this._addClickHandler(C.part,ZmMailMsgView.ATT_LINK_BRIEFCASE,ZmMailMsgView.briefcaseCallback,null,this._msg.id,C.part,C.label.replace(/\\x27/g,\"&apos;\"))\n}if(C.links.download){if(C.url.indexOf(\"data:\")===-1){this._addClickHandler(C.part,ZmMailMsgView.ATT_LINK_DOWNLOAD,ZmMailMsgView.downloadCallback,null,C.url+\"&disp=a\")\n}}if(C.links.vcard){this._addClickHandler(C.part,ZmMailMsgView.ATT_LINK_VCARD,ZmMailMsgView.vcardCallback,null,this._msg.id,C.part)\n}if(C.links.remove){this._addClickHandler(C.part,ZmMailMsgView.ATT_LINK_REMOVE,this.removeAttachmentCallback,this,C.part)\n}}var u=appCtxt.webClientOfflineHandler;\nif(u){var r=this._getAttachmentLinkId.bind(this);\nvar e=[ZmMailMsgView.ATT_LINK_MAIN,ZmMailMsgView.ATT_LINK_DOWNLOAD];\nu._handleAttachmentsForOfflineMode(B,r,e)\n}if(y){var t=document.getElementById(y.downloadAllLinkId);\nif(t){t.onclick=y.downloadAllCallback\n}var m=document.getElementById(y.removeAllLinkId);\nif(m){m.onclick=y.removeAllCallback\n}}var s=d.querySelectorAll(\"A.AttLink\");\nfor(var H=0;\nH<s.length;\nH++){this._headerTabGroup.addMember(s[H])\n}};\nZmMailMsgView.getAttachmentLinkHtml=function(e){var d=[],c=0;\nd[c++]=\"<a class='AttLink' \";\nd[c++]=e.id?\"id='\"+e.id+\"' \":\"\";\nd[c++]=!e.noUnderline?\"style='text-decoration:underline' \":\"\";\nd[c++]=e.blankTarget?\"target='_blank' \":\"\";\nvar b=e.href||(e.jsHref&&\"javascript:;\");\nd[c++]=b?\"href='\"+AjxStringUtil.encodeQuotes(AjxStringUtil.htmlEncode(b))+\"' \":\"\";\nd[c++]=e.download?(\" download='\"+(e.downloadLabel||\"\")+\"'\"):\"\";\nif(e.isRfc822){d[c++]=\" onclick='ZmMailMsgView.rfc822Callback(\\\"\";\nd[c++]=e.mid;\nd[c++]='\",\"';\nd[c++]=e.rfc822Part;\nd[c++]=\"\\\"); return false;'\"\n}d[c++]=\"title='\"+AjxStringUtil.encodeQuotes(AjxStringUtil.htmlEncode(e.label||e.text));\nd[c++]=\"'>\"+AjxStringUtil.htmlEncode(e.text)+\"</a>\";\nreturn d.join(\"\")\n};\nZmMailMsgView.getMainAttachmentLinkHtml=function(c){var b={id:c.id,noUnderline:true,text:c.text,label:c.att.label};\nif(c.att.ct==ZmMimeTable.MSG_RFC822){b.jsHref=true;\nb.isRfc822=true;\nb.mid=c.mid;\nb.rfc822Part=c.rfc822Part\n}else{if(c.att.url&&c.att.url.indexOf(\"javascript:\")!==0){b.blankTarget=true\n}b.href=c.att.url\n}return ZmMailMsgView.getAttachmentLinkHtml(b)\n};\nZmMailMsgView.prototype._getAttachmentLinkId=function(b,c){if(!b){return\n}return[this._attLinksId,b,c].join(\"_\")\n};\nZmMailMsgView.prototype._addClickHandler=function(c,i,d,e,h,g,f){var b=this._getAttachmentLinkId(c,i);\nvar j=document.getElementById(b);\nif(j){j.onclick=d.bind(e,h,g,f)\n}};\nZmMailMsgView.prototype._addAllAttachmentsLinks=function(f,k,b){var i=this._msg.id;\nif(AjxUtil.isString(b)){b=b.replace(ZmMailMsgView.FILENAME_INV_CHARS_RE,\"\")\n}else{b=null\n}b=AjxStringUtil.urlComponentEncode(b||ZmMsg.downloadAllDefaultFileName);\nvar c=[appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI),\"&id=\",i,\"&filename=\",b,\"&charset=\",appCtxt.getCharset(),\"&part=\"].join(\"\");\nvar g=[];\nfor(var h=0;\nh<f.length;\nh++){g.push(f[h].part)\n}var d=g.join(\",\");\nvar e={url:(c+d),downloadAllLinkId:this._viewId+\"_downloadAll\",removeAllLinkId:this._viewId+\"_removeAll\"};\nif(k){e.viewAllUrl=\"/h/viewimages?id=\"+i\n}e.html=AjxTemplate.expand(\"mail.Message#AllAttachments\",e);\ne.downloadAllCallback=ZmZimbraMail.unloadHackCallback.bind(null);\ne.removeAllCallback=this.removeAttachmentCallback.bind(this,d);\nreturn e\n};\nZmMailMsgView.prototype.getToolTipContent=function(b){var e=DwtUiEvent.getTarget(b,false);\nif(e.id==ZmId.getViewId(this._view,ZmId.MV_PRIORITY)){return e.getAttribute(\"priority\")==\"high\"?ZmMsg.highPriorityTooltip:ZmMsg.lowPriorityTooltip\n}if(!this._attachmentLinkIdToFileNameMap){return null\n}if(e&&e.nodeName.toLowerCase()==\"a\"){var d=e.getAttribute(\"id\");\nif(d){var c=this._attachmentLinkIdToFileNameMap[d];\nif(c){return AjxStringUtil.htmlEncode(c)\n}}}return null\n};\nZmMailMsgView.prototype.addAttachmentLinkHandler=function(d,c,b){if(!ZmMailMsgView._attachmentHandlers){ZmMailMsgView._attachmentHandlers={}\n}if(!ZmMailMsgView._attachmentHandlers[d]){ZmMailMsgView._attachmentHandlers[d]={}\n}ZmMailMsgView._attachmentHandlers[d][c]=b\n};\nZmMailMsgView.prototype._controlEventListener=function(b){this._resetIframeHeightOnTimer();\nif(this._inviteMsgView&&this._inviteMsgView.isActive()){this._inviteMsgView.resize()\n}};\nZmMailMsgView.prototype._shareToolBarListener=function(b){b._buttonId=b.item.getData(ZmOperation.KEY_ID);\nb._share=this._msg.share;\nthis.notifyListeners(ZmMailMsgView.SHARE_EVENT,b)\n};\nZmMailMsgView.prototype._subscribeToolBarListener=function(c,b){b._buttonId=b.item.getData(ZmOperation.KEY_ID);\nb._subscribeReq=c;\nthis.notifyListeners(ZmMailMsgView.SUBSCRIBE_EVENT,b)\n};\nZmMailMsgView.prototype._msgChangeListener=function(b){if(b.type!=ZmEvent.S_MSG){return\n}if(b.event==ZmEvent.E_DELETE||b.event==ZmEvent.E_MOVE){if(b.source==this._msg&&(appCtxt.getCurrentViewId()==this._viewId)){this._controller._app.popView()\n}}else{if(b.event==ZmEvent.E_TAGS||b.event==ZmEvent.E_REMOVE_ALL){this._setTags(this._msg)\n}else{if(b.event==ZmEvent.E_MODIFY){if(b.source==this._msg){this.set(b.source,true)\n}}}}};\nZmMailMsgView.prototype._selectStartListener=function(b){b._stopPropagation=false;\nb._returnValue=true\n};\nZmMailMsgView.prototype._reportButtonListener=function(h,e){var c=AjxUtil.createProxy(h);\nc.clearAddresses();\nvar g=new AjxEmailAddress(appCtxt.get(ZmSetting.OFFLINE_REPORT_EMAIL));\nc._addrs[AjxEmailAddress.TO]=AjxVector.fromArray([g]);\nvar d=h.getBodyPart();\nif(d){var f=new ZmMimePart();\nf.setContentType(d.ct);\nf.setContent(h.getBodyPart().getContent());\nc.setTopPart(f)\n}var i=this._sendReportCallback.bind(this,h);\nvar b=this._sendReportError.bind(this);\nc.send(false,i,b,null,true)\n};\nZmMailMsgView.prototype._sendReportCallback=function(b){this._controller._doDelete([b],true)\n};\nZmMailMsgView.prototype._sendReportError=function(){appCtxt.setStatusMsg(ZmMsg.reportSyncError,ZmStatusView.LEVEL_WARNING)\n};\nZmMailMsgView.prototype._handleMsgTruncated=function(){this._msg.viewEntireMessage=true;\nthis._msg.force=true;\nif(this._controller._setSelectedItem){this._controller._setSelectedItem({noTruncate:true,forceLoad:true,markRead:false})\n}else{if(this._controller.show){this._controller.show(this._msg,this._controller,null,false,false,true,true)\n}}Dwt.setVisible(this._msgTruncatedId,false)\n};\nZmMailMsgView._swapIdAndSrc=function(g,e,b,h,f,c){try{g.src=g.getAttribute(\"dfsrc\")\n}catch(d){}if(e==b-1){if(h){h.setHtmlContent(f.innerHTML)\n}c._resetIframeHeightOnTimer()\n}};\nZmMailMsgView.prototype._onloadIframe=function(d){var c=d.getIframe();\ntry{c.onload=null\n}catch(b){}ZmMailMsgView._resetIframeHeight(this)\n};\nZmMailMsgView._resetIframeHeight=function(m,c){var b=m.getIframe();\nif(!b){return\n}var d;\nif(m._scrollWithIframe){d=m.getH();\nfunction g(h){if(h){if(typeof h==\"string\"){h=document.getElementById(h)\n}if(h){d-=Dwt.getSize(h).y\n}}}g(m._headerElement);\ng(m._displayImagesId);\ng(m._highlightObjectsId);\nif(m._isMsgTruncated){g(m._msgTruncatedId)\n}if(m._inviteMsgView&&m._inviteMsgView.isActive()){if(m._inviteMsgView._inviteToolbar){g(m._inviteMsgView.getInviteToolbar().getHtmlElement())\n}if(m._inviteMsgView._dayView){g(m._inviteMsgView._dayView.getHtmlElement())\n}}if(m._hasShareToolbar&&m._shareToolbar){g(m._shareToolbar.getHtmlElement())\n}b.style.height=d+\"px\"\n}else{if(c==null){c=0\n}try{if(!b.contentWindow||!b.contentWindow.document){if(c<ZmMailMsgView.SETHEIGHT_MAX_TRIES){c++;\nm._resetIframeHeightOnTimer(c)\n}return\n}}catch(f){if(c<ZmMailMsgView.SETHEIGHT_MAX_TRIES){c++;\nm._resetIframeHeightOnTimer(c++)\n}return\n}var j=b.contentWindow.document;\nvar l=j&&j.body&&j.body.scrollHeight||0;\nb.style.width=\"100%\";\nvar e=b.offsetWidth;\nvar i=j.body.scrollWidth;\nif(i>e){b.style.width=i+\"px\";\nj.body.style.overflow=\"visible\";\nif(e>20){j.body.style.width=e-20+\"px\"\n}}d=Math.max(j.documentElement.scrollHeight,l);\nb.style.height=d+\"px\";\nif(AjxEnv.isWebKitBased){var k=Math.max(j.body.scrollHeight,j.documentElement.scrollHeight);\nif(k>d){b.style.height=k+\"px\"\n}}}};\nZmMailMsgView.prototype.setScrollWithIframe=function(c){if(!this._usingIframe&&typeof this._usingIframe!==\"undefined\"){return\n}this._scrollWithIframe=c;\nthis._limitAttachments=this._scrollWithIframe?3:0;\nthis._attcMaxSize=this._limitAttachments*16+8;\nthis.setScrollStyle(c?DwtControl.CLIP:DwtControl.SCROLL);\nvar b=this.getIframe();\nif(b){b.style.width=\"100%\";\nb.scrolling=c;\nZmMailMsgView._resetIframeHeight(this)\n}};\nZmMailMsgView._detachCallback=function(f,d,c){var e=c.getResponse().GetMsgResponse.m[0];\nvar g=window.parentAppCtxt||window.appCtxt;\nvar b=g.getApp(ZmApp.MAIL).getMailListController();\nvar h=ZmMailMsg.createFromDom(e,{list:b.getList()},true);\nh._loaded=true;\nh.readReceiptRequested=false;\nZmMailMsgView.detachMsgInNewWindow(h,f,d)\n};\nZmMailMsgView.detachMsgInNewWindow=function(f,d,c){var e=window.parentAppCtxt||window.appCtxt;\nvar b=e.getNewWindow(true);\nif(b){b.command=\"msgViewDetach\";\nb.params={msg:f,isRfc822:d,parentController:c}\n}};\nZmMailMsgView.rfc822Callback=function(f,d,b){var c=Boolean((d!=null));\nvar e=window.parentAppCtxt||window.appCtxt;\nvar g={sender:e.getAppController(),msgId:f,partId:d,getHtml:e.get(ZmSetting.VIEW_AS_HTML),markRead:e.isExternalAccount()?false:true,callback:ZmMailMsgView._detachCallback.bind(null,c,b)};\nZmMailMsg.fetchMsg(g)\n};\nZmMailMsgView.vcardCallback=function(d,c){ZmZimbraMail.unloadHackCallback();\nvar b=window.parentAppCtxt||window.appCtxt;\nb.getApp(ZmApp.CONTACTS).createFromVCard(d,c)\n};\nZmMailMsgView.downloadCallback=function(b){ZmZimbraMail.unloadHackCallback();\nlocation.href=b\n};\nZmMailMsgView.prototype.removeAttachmentCallback=function(b){ZmZimbraMail.unloadHackCallback();\nif(!(b instanceof Array)){b=b.split(\",\")\n}var d=(b.length>1)?ZmMsg.attachmentConfirmRemoveAll:ZmMsg.attachmentConfirmRemove;\nvar c=appCtxt.getYesNoMsgDialog();\nc.registerCallback(DwtDialog.YES_BUTTON,this._removeAttachmentCallback,this,[b]);\nc.setMessage(d,DwtMessageDialog.WARNING_STYLE);\nc.popup()\n};\nZmMailMsgView.prototype._removeAttachmentCallback=function(b){appCtxt.getYesNoMsgDialog().popdown();\nthis._msg.removeAttachments(b,this._handleRemoveAttachment.bind(this))\n};\nZmMailMsgView.prototype._handleRemoveAttachment=function(c){var d=c.getResponse().RemoveAttachmentsResponse.m[0];\nvar e=window.parentAppCtxt||window.appCtxt;\nvar b=e.getApp(ZmApp.MAIL).getMailListController();\nvar f=ZmMailMsg.createFromDom(d,{list:b.getList()},true);\nthis._msg=this._item=null;\nb.actionedMsgId=d.id;\nif(this._controller.setMsg){this._controller.setMsg(f)\n}this.set(f)\n};\nZmMailMsgView.briefcaseCallback=function(f,e,b){ZmZimbraMail.unloadHackCallback();\nAjxDispatcher.require(\"BriefcaseCore\");\nvar d=appCtxt.isChildWindow?parentAppCtxt:appCtxt;\nvar c=d.getApp(ZmApp.BRIEFCASE);\nc._createDeferredFolders();\nappCtxt.getApp(ZmApp.BRIEFCASE).createFromAttachment(f,e,b)\n};\nZmMailMsgView.prototype.deactivate=function(){this._controller.inactive=true\n};\nZmMailMsgView.addToCalendarCallback=function(f,e,c){ZmZimbraMail.unloadHackCallback();\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\"]);\nvar d=appCtxt.isChildWindow?parentAppCtxt:appCtxt;\nvar b=d.getApp(ZmApp.CALENDAR);\nb._createDeferredFolders();\nappCtxt.getApp(ZmApp.CALENDAR).importAppointment(f,e,c)\n};\nZmMailMsgView.prototype.getMsgBodyElement=function(){return document.getElementById(this._msgBodyDivId)\n};\nZmMailMsgView.prototype._getViewId=function(){var b=this._controller.getCurrentViewId();\nreturn this._controller.isZmMsgController?b:[b,ZmId.VIEW_MSG].join(\"_\")\n};\nZmMailMsgView.prototype._keepReading=function(c){var b=this.getHtmlElement();\nvar d=Dwt.getSize(b).y;\nvar e=(b.scrollHeight>d&&(b.scrollTop+d<b.scrollHeight));\nif(e){if(!c){b.scrollTop=b.scrollTop+d\n}return true\n}return false\n};\nZmMailMsgView.prototype._getIframeTitle=function(){return AjxMessageFormat.format(ZmMsg.messageTitle,this._msg.subject)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmMailMsgListView\")){ZmMailMsgListView=function(b){this._mode=b.mode;\nthis.view=b.view;\nb.type=ZmItem.MSG;\nthis._controller=b.controller;\nb.headerList=this._getHeaderList();\nZmMailListView.call(this,b);\nthis.setAttribute(\"aria-label\",ZmMsg.messageList)\n};\nZmMailMsgListView.prototype=new ZmMailListView;\nZmMailMsgListView.prototype.constructor=ZmMailMsgListView;\nZmMailMsgListView.prototype.isZmMailMsgListView=true;\nZmMailMsgListView.prototype.toString=function(){return\"ZmMailMsgListView\"\n};\nZmMailMsgListView.SINGLE_COLUMN_SORT_CV=[{field:ZmItem.F_FROM,msg:\"from\"},{field:ZmItem.F_SIZE,msg:\"size\"},{field:ZmItem.F_DATE,msg:\"date\"}];\nZmMailMsgListView.prototype.markUIAsRead=function(c){ZmMailListView.prototype.markUIAsRead.apply(this,arguments);\nvar b=this._getClasses(ZmItem.F_STATUS,!this.isMultiColumn()?[\"ZmMsgListBottomRowIcon\"]:null);\nthis._setImage(c,ZmItem.F_STATUS,c.getStatusIcon(),b)\n};\nZmMailMsgListView.prototype._addParams=function(e,d){if(this._mode==ZmId.VIEW_TRAD){return ZmMailListView.prototype._addParams.apply(this,arguments)\n}else{var c=appCtxt.getById(e.cid);\nvar b=this._controller._activeSearch&&this._controller._activeSearch.search;\nd.isMatched=(b&&b.hasContentTerm()&&e.inHitList)\n}};\nZmMailMsgListView.prototype._getDivClass=function(c,b,d){if(d.isMatched&&!d.isDragProxy){return c+\" \"+[c,DwtCssStyle.MATCHED].join(\"-\")\n}else{return ZmMailListView.prototype._getDivClass.apply(this,arguments)\n}};\nZmMailMsgListView.prototype._getRowClass=function(d){var b=this._isMultiColumn?[\"DwtMsgListMultiCol\"]:[\"ZmRowDoubleHeader\"];\nif(this._mode!=ZmId.VIEW_TRAD){var c=appCtxt.getById(d.folderId);\nif(c&&c.isInTrash()){b.push(\"Trash\")\n}}if(d.isUnread){b.push(\"Unread\")\n}if(d.isSent){b.push(\"Sent\")\n}return b.join(\" \")\n};\nZmMailMsgListView.prototype._getCellId=function(b,c){if(c==ZmItem.F_SUBJECT&&(this._mode==ZmId.VIEW_CONV||this._mode==ZmId.VIEW_CONVLIST)){return this._getFieldId(b,c)\n}else{return ZmMailListView.prototype._getCellId.apply(this,arguments)\n}};\nZmMailMsgListView.prototype._getCellContents=function(n,l,f,d,k,s,r){var t=this._getStyleViaZimlet(d,f)||\"\";\nif(d==ZmItem.F_READ){l=this._getImageHtml(n,l,f.getReadIcon(),this._getFieldId(f,d),r)\n}else{if(d==ZmItem.F_STATUS){l=this._getImageHtml(n,l,f.getStatusIcon(),this._getFieldId(f,d),r)\n}else{if(d==ZmItem.F_FROM||d==ZmItem.F_PARTICIPANT){n[l++]=\"<div \"+AjxUtil.getClassAttr(r)+t+\">\";\nif(this._isOutboundFolder()){var i=f.getAddresses(AjxEmailAddress.TO).getArray();\nif(i&&i.length){var o=this._getFieldId(f,ZmItem.F_FROM);\nvar b=i.length;\nvar q=this._headerHash[d];\nvar g=q?q._width:ZmMsg.COLUMN_WIDTH_FROM_CLV;\nvar m=this._fitParticipants(i,f,g);\nfor(var p=0;\np<m.length;\np++){if(p==0&&(m.length<b)){n[l++]=AjxStringUtil.ELLIPSIS\n}else{if(m.length>1&&p>0){n[l++]=AjxStringUtil.LIST_SEP\n}}n[l++]=\"<span id='\";\nn[l++]=[o,m[p].index].join(DwtId.SEP);\nn[l++]=\"'>\";\nn[l++]=AjxStringUtil.htmlEncode(m[p].name);\nn[l++]=\"</span>\"\n}}else{n[l++]=\"&nbsp;\"\n}}else{var c=f.getAddress(AjxEmailAddress.FROM);\nvar e=c&&c.getText();\nif(e){n[l++]=\"<span id='\";\nn[l++]=this._getFieldId(f,ZmItem.F_FROM);\nn[l++]=\"'>\";\nn[l++]=AjxStringUtil.htmlEncode(e);\nn[l++]=\"</span>\"\n}else{n[l++]=\"<span>\"+ZmMsg.unknown+\"</span>\"\n}}n[l++]=\"</div>\"\n}else{if(d==ZmItem.F_SUBJECT){n[l++]=\"<div \"+AjxUtil.getClassAttr(r)+t+\">\";\nif(this._mode==ZmId.VIEW_CONV||this._mode==ZmId.VIEW_CONVLIST){n[l++]=\"<span \"+(this._isMultiColumn?\"\":\"class='ZmConvListFragment'\")+\" id='\"+this._getFieldId(f,ZmItem.F_FRAGMENT)+\"'>\";\nn[l++]=AjxStringUtil.htmlEncode(f.fragment,true);\nn[l++]=\"</span>\"\n}else{var u=f.subject||ZmMsg.noSubject;\nn[l++]=\"<span id='\";\nn[l++]=this._getFieldId(f,d);\nn[l++]=\"'>\"+AjxStringUtil.htmlEncode(u)+\"</span>\";\nif(appCtxt.get(ZmSetting.SHOW_FRAGMENTS)&&f.fragment){n[l++]=this._getFragmentSpan(f)\n}}n[l++]=\"</div>\"\n}else{if(d==ZmItem.F_FOLDER){n[l++]=\"<div \"+AjxUtil.getClassAttr(r)+\" id='\";\nn[l++]=this._getFieldId(f,d);\nn[l++]=\"'>\";\nvar h=appCtxt.getById(f.folderId);\nif(h){n[l++]=h.getName()\n}n[l++]=\"</div>\"\n}else{if(d==ZmItem.F_SIZE){n[l++]=\"<div \"+AjxUtil.getClassAttr(r)+\">\";\nn[l++]=AjxUtil.formatSize(f.size);\nn[l++]=\"</div>\"\n}else{if(d==ZmItem.F_SORTED_BY){n[l++]=this._getAbridgedContent(f,k)\n}else{if(this.isMultiColumn()||d!==ZmItem.F_SELECTION){l=ZmMailListView.prototype._getCellContents.apply(this,arguments)\n}}}}}}}}return l\n};\nZmMailMsgListView.prototype._getAbridgedContent=function(g,j){var c=[];\nvar b=0;\nvar f=(AjxEnv.isIE||AjxEnv.isSafari)?\"22\":\"16\";\nvar h=\"\";\nfor(var e=0;\ne<this._headerList.length;\ne++){if(this._headerList[e]._field==ZmItem.F_SELECTION){h=\"ZmMsgListSelection\";\nbreak\n}}c[b++]=\"<div class='TopRow \"+h+\"' \";\nc[b++]=\"id='\";\nc[b++]=DwtId.getListViewItemId(DwtId.WIDGET_ITEM_FIELD,this._view,g.id,ZmItem.F_ITEM_ROW_3PANE);\nc[b++]=\"'>\";\nif(h){b=ZmMailListView.prototype._getCellContents.apply(this,[c,b,g,ZmItem.F_SELECTION,j])\n}b=this._getAbridgedCell(c,b,g,ZmItem.F_READ,j,f);\nb=this._getAbridgedCell(c,b,g,ZmItem.F_FROM,j);\nb=this._getAbridgedCell(c,b,g,ZmItem.F_DATE,j,ZmMsg.COLUMN_WIDTH_DATE,\"align=right\",[\"ZmMsgListDate\"]);\nc[b++]=\"</div>\";\nc[b++]=\"<div class='BottomRow \"+h+\"'>\";\nb=this._getAbridgedCell(c,b,g,ZmItem.F_STATUS,j,f,null,[\"ZmMsgListBottomRowIcon\"]);\nif(appCtxt.multiAccounts&&appCtxt.getSearchController().searchAllAccounts){b=this._getAbridgedCell(c,b,g,ZmItem.F_ACCOUNT,j,\"16\",\"align=right\")\n}if(g.isHighPriority||g.isLowPriority){b=this._getAbridgedCell(c,b,g,ZmItem.F_PRIORITY,j,\"10\",\"align=right\")\n}b=this._getAbridgedCell(c,b,g,ZmItem.F_SUBJECT,j);\nb=this._getListFlagsWrapper(c,b,g);\nif(g.hasAttach){b=this._getAbridgedCell(c,b,g,ZmItem.F_ATTACHMENT,j,f)\n}var d=g.getVisibleTags();\nif(d&&d.length){b=this._getAbridgedCell(c,b,g,ZmItem.F_TAG,j,f,null,[\"ZmMsgListColTag\"])\n}if(appCtxt.get(\"FLAGGING_ENABLED\")){b=this._getAbridgedCell(c,b,g,ZmItem.F_FLAG,j,f)\n}c[b++]=\"</div></div>\";\nreturn c.join(\"\")\n};\nZmMailMsgListView.prototype._getToolTip=function(h){var f,g=h.field,e=h.item;\nif(!e){return\n}if(!this._isMultiColumn&&(g==ZmItem.F_SUBJECT||g==ZmItem.F_FRAGMENT)){var c=(e.type==ZmItem.MSG)&&e.isInvite()&&e.invite;\nif(c&&(e.needsRsvp()||!c.isEmpty())){f=ZmMailListView.prototype._getToolTip.apply(this,arguments)\n}else{f=AjxStringUtil.htmlEncode(e.fragment||(e.hasAttach?\"\":ZmMsg.fragmentIsEmpty));\nvar b=null;\nvar d=appCtxt.getById(e.folderId);\nif(d&&d.parent){b=AjxMessageFormat.format(ZmMsg.accountDownloadToFolder,d.getPath())\n}f=(f&&b)?[f,b].join(\"<br>\"):f||b\n}}else{f=ZmMailListView.prototype._getToolTip.apply(this,arguments)\n}return f\n};\nZmMailMsgListView.prototype._changeListener=function(f){var h=this._getItemFromEvent(f);\nif(!h||f.handled||!this._handleEventType[h.type]){return\n}if((f.event==ZmEvent.E_DELETE||f.event==ZmEvent.E_MOVE)&&this._mode==ZmId.VIEW_CONV){if(!this._controller.handleDelete()){if(f.event==ZmEvent.E_DELETE){ZmMailListView.prototype._changeListener.call(this,f)\n}else{if(h.folderId==ZmFolder.ID_SPAM){this._controller._list.remove(h,true);\nZmMailListView.prototype._changeListener.call(this,f)\n}else{this._changeFolderName(h,f.getDetail(\"oldFolderId\"));\nthis._checkReplenishOnTimer()\n}}}}else{if(this._mode==ZmId.VIEW_CONV&&f.event==ZmEvent.E_CREATE){var g=AjxDispatcher.run(\"GetConvController\").getConv();\nif(g&&(h.cid==g.id)){ZmMailListView.prototype._changeListener.call(this,f)\n}}else{if(f.event==ZmEvent.E_FLAGS){var d=f.getDetail(\"flags\");\nfor(var e=0;\ne<d.length;\ne++){var c=d[e];\nvar b=h[ZmItem.FLAG_PROP[c]];\nif(c==ZmItem.FLAG_REPLIED&&b){this._setImage(h,ZmItem.F_STATUS,\"MsgStatusReply\",this._getClasses(ZmItem.F_STATUS))\n}else{if(c==ZmItem.FLAG_FORWARDED&&b){this._setImage(h,ZmItem.F_STATUS,\"MsgStatusForward\",this._getClasses(ZmItem.F_STATUS))\n}}}ZmMailListView.prototype._changeListener.call(this,f)\n}else{ZmMailListView.prototype._changeListener.call(this,f);\nif(f.event==ZmEvent.E_CREATE||f.event==ZmEvent.E_DELETE||f.event==ZmEvent.E_MOVE){this._resetColWidth()\n}}}}};\nZmMailMsgListView.prototype._initHeaders=function(){ZmMailListView.prototype._initHeaders.apply(this,arguments);\nif(this._mode==ZmId.VIEW_CONV){this._headerInit[ZmItem.F_SUBJECT]={text:ZmMsg.message,noRemove:true,resizeable:true}\n}};\nZmMailMsgListView.prototype._getHeaderToolTip=function(c,b){if(c==ZmItem.F_SUBJECT&&this._mode==ZmId.VIEW_CONV){return ZmMsg.message\n}else{return ZmMailListView.prototype._getHeaderToolTip.apply(this,arguments)\n}};\nZmMailMsgListView.prototype._getSingleColumnSortFields=function(){return(this._mode==ZmId.VIEW_CONV)?ZmMailMsgListView.SINGLE_COLUMN_SORT_CV:ZmMailListView.SINGLE_COLUMN_SORT\n};\nZmMailMsgListView.prototype._sortColumn=function(b,c,g){ZmMailListView.prototype._sortColumn.call(this,b,c);\nvar f;\nvar e=this.getList();\nif(this._columnHasCustomQuery(b)){f=this._getSearchForSort(b._sortable,this._controller)\n}else{if(e&&e.size()>1&&this._sortByString){f=this._controller.getSearchString()\n}}var j=this._controller.getSearchStringHint();\nif(f||j){var d={query:f,queryHint:j,sortBy:this._sortByString,userInitiated:this._controller._currentSearch.userInitiated,sessionId:this._controller._currentSearch.sessionId};\nif(this._mode==ZmId.VIEW_CONV){var h=this._controller.getConv();\nif(h){var i=new AjxCallback(this,this._handleResponseSortColumn,[h,b,this._controller,g]);\nh.load(d,i)\n}}else{d.types=[ZmItem.MSG];\nd.limit=this.getLimit();\nd.callback=g;\nappCtxt.getSearchController().search(d)\n}}};\nZmMailMsgListView.prototype._handleResponseSortColumn=function(g,e,d,h,c){var b=c.getResponse();\nvar f=b.getResults(ZmItem.MSG);\nd.setList(f);\nd._activeSearch=b;\nthis.offset=0;\nthis.set(g.msgs,e);\nthis.setSelection(g.getFirstHotMsg({offset:this.offset,limit:this.getLimit(this.offset)}));\nif(h instanceof AjxCallback){h.run()\n}};\nZmMailMsgListView.prototype._getParentForColResize=function(){return this.parent\n}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmConvListView\")){ZmConvDoublePaneView=function(b){this._invitereplylisteners=[];\nthis._sharelisteners=[];\nthis._subscribelisteners=[];\nb.className=b.className||\"ZmConvDoublePaneView\";\nb.mode=ZmId.VIEW_CONVLIST;\nZmDoublePaneView.call(this,b)\n};\nZmConvDoublePaneView.prototype=new ZmDoublePaneView;\nZmConvDoublePaneView.prototype.constructor=ZmConvDoublePaneView;\nZmConvDoublePaneView.prototype.isZmConvDoublePaneView=true;\nZmConvDoublePaneView.prototype.toString=function(){return\"ZmConvDoublePaneView\"\n};\nZmConvDoublePaneView.prototype._createMailListView=function(b){return new ZmConvListView(b)\n};\nZmConvDoublePaneView.prototype._createMailItemView=function(b){this._itemViewParams=b;\nreturn this._getItemView(ZmItem.CONV)\n};\nZmConvDoublePaneView.prototype._getItemView=function(c){var b;\nthis._itemViewParams.className=null;\nif(c==ZmItem.CONV){if(!this._convView){this._itemViewParams.id=ZmId.getViewId(ZmId.VIEW_CONV,null,this._itemViewParams.view);\nb=this._convView=new ZmConvView2(this._itemViewParams)\n}}else{if(c==ZmItem.MSG){if(!this._mailMsgView){this._itemViewParams.id=ZmId.getViewId(ZmId.VIEW_MSG,null,this._itemViewParams.view);\nb=this._mailMsgView=new ZmMailMsgView(this._itemViewParams)\n}}}if(b){AjxUtil.foreach(this._invitereplylisteners,function(d){b.addInviteReplyListener(d)\n});\nAjxUtil.foreach(this._sharelisteners,function(d){b.addShareListener(d)\n});\nAjxUtil.foreach(this._subscribelisteners,function(d){b.addSubscribeListener(d)\n})\n}return(c==ZmItem.CONV)?this._convView:this._mailMsgView\n};\nZmConvDoublePaneView.prototype.setItem=function(c,d){if(!d&&!this._controller.popShield(null,this.setItem.bind(this,c,true))){return\n}var e=((c.type==ZmItem.CONV)!=(this._itemView&&this._itemView==this._convView));\nvar b=this._itemView=this._getItemView(c.type);\nvar f=(c.type==ZmItem.CONV)?this._mailMsgView:this._convView;\nif(f){f.setVisible(false)\n}if(e&&b&&b._replyView){b._replyView.reset()\n}this._itemView.setVisible(true,null,c);\nif(e){this.setReadingPane(true)\n}return ZmDoublePaneView.prototype.setItem.apply(this,arguments)\n};\nZmConvDoublePaneView.prototype.addInviteReplyListener=function(b){this._invitereplylisteners.push(b);\nZmDoublePaneView.prototype.addInviteReplyListener.call(this,b)\n};\nZmConvDoublePaneView.prototype.addShareListener=function(b){this._sharelisteners.push(b);\nZmDoublePaneView.prototype.addShareListener.call(this,b)\n};\nZmConvDoublePaneView.prototype.addSubscribeListener=function(b){this._subscribelisteners.push(b);\nZmDoublePaneView.prototype.addSubscribeListener.call(this,b)\n};\nZmConvListView=function(b){b.type=ZmItem.CONV;\nthis._controller=b.controller;\nthis._mode=this.view=ZmId.VIEW_CONVLIST;\nb.headerList=this._getHeaderList();\nZmMailListView.call(this,b);\nthis._handleEventType[ZmItem.CONV]=true;\nthis._handleEventType[ZmItem.MSG]=true;\nthis.setAttribute(\"aria-label\",ZmMsg.conversationList);\nthis._hasHiddenRows=true;\nthis._resetExpansion()\n};\nZmConvListView.prototype=new ZmMailListView;\nZmConvListView.prototype.constructor=ZmConvListView;\nZmConvListView.prototype.isZmConvListView=true;\nZmConvListView.prototype.toString=function(){return\"ZmConvListView\"\n};\nZmConvListView.prototype.role=\"tree\";\nZmConvListView.prototype.itemRole=\"treeitem\";\nZmListView.FIELD_CLASS[ZmItem.F_EXPAND]=\"Expand\";\nZmConvListView.MSG_STYLE=\"ZmConvExpanded\";\nZmConvListView.prototype.set=function(c,b){if(this.offset==0){this._resetExpansion()\n}ZmMailListView.prototype.set.apply(this,arguments)\n};\nZmConvListView.prototype._isAllChecked=function(){var c=this.getSelection();\nvar e=0;\nfor(var b=0;\nb<c.length;\nb++){if(c[b].type==ZmItem.CONV){e++\n}}var d=this.getList();\nreturn(d&&e==d.size())\n};\nZmConvListView.prototype.markUIAsMute=function(b){ZmMailListView.prototype.markUIAsMute.apply(this,arguments)\n};\nZmConvListView.prototype.markUIAsRead=function(c){ZmMailListView.prototype.markUIAsRead.apply(this,arguments);\nif(c.type==ZmItem.MSG){var b=this._getClasses(ZmItem.F_STATUS,!this.isMultiColumn()?[\"ZmMsgListBottomRowIcon\"]:null);\nthis._setImage(c,ZmItem.F_STATUS,c.getStatusIcon(),b)\n}};\nZmConvListView.prototype.getList=function(d){if(!d){return ZmMailListView.prototype.getList.call(this)\n}else{var f=[];\nvar g=this._parentEl.childNodes;\nfor(var b=0;\nb<g.length;\nb++){var c=g[b];\nif(Dwt.getVisible(c)){var e=this.getItemFromElement(c);\nif(e){f.push(e)\n}}}return AjxVector.fromArray(f)\n}};\nZmConvListView.prototype.getSelection=function(){return this._selectedMsg?[this._selectedMsg]:ZmMailListView.prototype.getSelection.apply(this,arguments)\n};\nZmConvListView.prototype.getItemIndex=function(e,d){var f=this.getList(d);\nif(e&&f){var b=f.size();\nfor(var c=0;\nc<b;\n++c){var g=f.get(c);\nif(g&&g.id==e.id){return c\n}}}return null\n};\nZmConvListView.prototype._initHeaders=function(){if(!this._headerInit){ZmMailListView.prototype._initHeaders.call(this);\nthis._headerInit[ZmItem.F_EXPAND]={icon:\"NodeCollapsed\",width:ZmListView.COL_WIDTH_ICON,name:ZmMsg.expand,tooltip:ZmMsg.expandCollapse,cssClass:\"ZmMsgListColExpand\"};\nthis._headerInit[ZmItem.F_FROM]={text:ZmMsg.from,width:ZmMsg.COLUMN_WIDTH_FROM_CLV,resizeable:true,cssClass:\"ZmMsgListColFrom\"};\nthis._headerInit[ZmItem.F_FOLDER]={text:ZmMsg.folder,width:ZmMsg.COLUMN_WIDTH_FOLDER,resizeable:true,cssClass:\"ZmMsgListColFolder\",visible:false}\n}};\nZmConvListView.prototype._getLabelFieldList=function(){var c=ZmMailListView.prototype._getLabelFieldList.call(this);\nvar b=AjxUtil.indexOf(c,ZmItem.F_SELECTION);\nif(b>=0){c.splice(b+1,0,ZmItem.F_EXPAND)\n}return c\n};\nZmConvListView.prototype._getDivClass=function(c,b,d){if(b.type==ZmItem.MSG){if(d.isDragProxy||d.isMatched){return ZmMailMsgListView.prototype._getDivClass.apply(this,arguments)\n}else{return[c,ZmConvListView.MSG_STYLE].join(\" \")\n}}else{return ZmMailListView.prototype._getDivClass.apply(this,arguments)\n}};\nZmConvListView.prototype._getRowClass=function(b){return(b.type==ZmItem.MSG)?ZmMailMsgListView.prototype._getRowClass.apply(this,arguments):ZmMailListView.prototype._getRowClass.apply(this,arguments)\n};\nZmConvListView.prototype._addParams=function(b,c){if(b.type==ZmItem.MSG){ZmMailMsgListView.prototype._addParams.apply(this,arguments)\n}};\nZmConvListView.prototype._getCellId=function(b,c){return((c==ZmItem.F_FROM||c==ZmItem.F_SUBJECT)&&b.type==ZmItem.CONV)?this._getFieldId(b,c):ZmMailListView.prototype._getCellId.apply(this,arguments)\n};\nZmConvListView.prototype._getCellClass=function(c,d,e){var b=ZmMailListView.prototype._getCellClass.apply(this,arguments);\nreturn c.type===ZmItem.CONV&&d===ZmItem.F_SIZE?\"Count \"+b:b\n};\nZmConvListView.prototype._getCellCollapseExpandImage=function(b){if(!this._isExpandable(b)){return null\n}return this._expanded[b.id]?\"NodeExpanded\":\"NodeCollapsed\"\n};\nZmConvListView.prototype._getCellContents=function(k,j,l,i,f,e,d){var d=d||[];\nvar c=this._getStyleViaZimlet(i,l)||\"\";\nif(i===ZmItem.F_SELECTION){if(this.isMultiColumn()){j=ZmMailListView.prototype._getCellContents.apply(this,arguments)\n}}else{if(i===ZmItem.F_EXPAND){j=this._getImageHtml(k,j,this._getCellCollapseExpandImage(l),this._getFieldId(l,i),d)\n}else{if(i===ZmItem.F_READ){j=this._getImageHtml(k,j,l.getReadIcon(),this._getFieldId(l,i),d)\n}else{if(l.type===ZmItem.MSG){j=ZmMailMsgListView.prototype._getCellContents.apply(this,arguments)\n}else{var g=this._getDisplayedMsgCount(l);\nif(i===ZmItem.F_STATUS){if(l.type==ZmItem.CONV&&l.numMsgs==1&&l.isScheduled){j=this._getImageHtml(k,j,\"SendLater\",this._getFieldId(l,i),d)\n}else{k[j++]=\"<div \"+AjxUtil.getClassAttr(d)+\"></div>\"\n}}else{if(i===ZmItem.F_FROM){k[j++]=\"<div id='\"+this._getFieldId(l,i)+\"' \"+AjxUtil.getClassAttr(d)+c+\">\";\nk[j++]=this._getParticipantHtml(l,this._getFieldId(l,ZmItem.F_PARTICIPANT));\nif(l.type===ZmItem.CONV&&(g>1)&&!this.isMultiColumn()){k[j++]=\" - <span class='ZmConvListNumMsgs'>\";\nk[j++]=g;\nk[j++]=\"</span>\"\n}k[j++]=\"</div>\"\n}else{if(i===ZmItem.F_SUBJECT){var h=l.subject||ZmMsg.noSubject;\nif(l.numMsgs>1){h=ZmMailMsg.stripSubjectPrefixes(h)\n}k[j++]=\"<div id='\"+this._getFieldId(l,i)+\"' \"+AjxUtil.getClassAttr(d)+c+\">\";\nk[j++]=\"<span>\";\nk[j++]=AjxStringUtil.htmlEncode(h,true)+\"</span>\";\nif(appCtxt.get(ZmSetting.SHOW_FRAGMENTS)&&l.fragment){k[j++]=this._getFragmentSpan(l)\n}k[j++]=\"</div>\"\n}else{if(i===ZmItem.F_FOLDER){k[j++]=\"<div \"+AjxUtil.getClassAttr(d)+\" id='\";\nk[j++]=this._getFieldId(l,i);\nk[j++]=\"'>\";\nif(l.folderId){var b=appCtxt.getById(l.folderId);\nif(b){k[j++]=b.getName()\n}}k[j++]=\"</div>\"\n}else{if(i===ZmItem.F_SIZE){k[j++]=\"<div id='\"+this._getFieldId(l,i)+\"' \"+AjxUtil.getClassAttr(d)+\">\";\nif(l.size){k[j++]=AjxUtil.formatSize(l.size)\n}else{k[j++]=\"(\";\nk[j++]=g;\nk[j++]=\")\"\n}k[j++]=\"</div>\"\n}else{if(i===ZmItem.F_SORTED_BY){k[j++]=this._getAbridgedContent(l,f)\n}else{j=ZmMailListView.prototype._getCellContents.apply(this,arguments)\n}}}}}}}}}}return j\n};\nZmConvListView.prototype._getAbridgedContent=function(l,f){var k=[];\nvar j=0;\nvar c=(AjxEnv.isIE||AjxEnv.isSafari)?22:16;\nvar d=(l.type===ZmItem.MSG);\nvar h=(l.type===ZmItem.CONV&&this._getDisplayedMsgCount(l)>1);\nvar b=\"\";\nfor(var e=0;\ne<this._headerList.length;\ne++){if(this._headerList[e]._field==ZmItem.F_SELECTION){b=\"ZmMsgListSelection\";\nbreak\n}}k[j++]=\"<div class='TopRow \"+b+\"' \";\nk[j++]=\"id='\";\nk[j++]=DwtId.getListViewItemId(DwtId.WIDGET_ITEM_FIELD,this._view,l.id,ZmItem.F_ITEM_ROW_3PANE);\nk[j++]=\"'>\";\nif(b){j=ZmMailListView.prototype._getCellContents.apply(this,[k,j,l,ZmItem.F_SELECTION,f])\n}if(d){j=this._getAbridgedCell(k,j,l,ZmItem.F_EXPAND,f)\n}j=this._getAbridgedCell(k,j,l,ZmItem.F_READ,f,c);\nif(h){j=this._getAbridgedCell(k,j,l,ZmItem.F_EXPAND,f,\"16\",null,[\"ZmMsgListExpand\"])\n}if(appCtxt.multiAccounts&&!d&&appCtxt.getSearchController().searchAllAccounts){j=this._getAbridgedCell(k,j,l,ZmItem.F_ACCOUNT,f,\"16\")\n}j=this._getAbridgedCell(k,j,l,ZmItem.F_FROM,f);\nj=this._getAbridgedCell(k,j,l,ZmItem.F_DATE,f,ZmMsg.COLUMN_WIDTH_DATE,null,[\"ZmMsgListDate\"]);\nk[j++]=\"</div>\";\nk[j++]=\"<div class='BottomRow \"+b+\"'>\";\nvar g=[\"ZmMsgListBottomRowIcon\"];\nif(d){j=this._getAbridgedCell(k,j,l,ZmItem.F_STATUS,f,c,null,g);\ng=null\n}if(l.isHighPriority||l.isLowPriority){j=this._getAbridgedCell(k,j,l,ZmItem.F_PRIORITY,f,\"10\",null,g);\ng=null\n}j=this._getAbridgedCell(k,j,l,ZmItem.F_SUBJECT,f,null,null,g);\nj=this._getListFlagsWrapper(k,j,l);\nif(l.hasAttach){j=this._getAbridgedCell(k,j,l,ZmItem.F_ATTACHMENT,f,c)\n}var m=l.getVisibleTags();\nif(m&&m.length){j=this._getAbridgedCell(k,j,l,ZmItem.F_TAG,f,c,null,[\"ZmMsgListColTag\"])\n}if(appCtxt.get(ZmSetting.FLAGGING_ENABLED)){j=this._getAbridgedCell(k,j,l,ZmItem.F_FLAG,f,c)\n}k[j++]=\"</div></div>\";\nreturn k.join(\"\")\n};\nZmConvListView.prototype._getParticipantHtml=function(f,s){var m=[];\nvar o=0;\nvar r=f.participants?f.participants.getArray():[],n=this._isOutboundFolder(),e=[];\nfor(var u=0;\nu<r.length;\nu++){var q=r[u];\nif((n&&q.type===AjxEmailAddress.TO)||(!n&&q.type===AjxEmailAddress.FROM)){e.push(q)\n}}if(e.length===0&&n){e=r\n}var b=e?e.length:0;\nif(b>0){if(b==1&&(e[0].type===AjxEmailAddress.FROM)&&f.isZmConv&&n){var h=f.getFirstHotMsg();\nif(h){var l=h.getAddresses(AjxEmailAddress.TO).getArray();\nif(l&&l.length){e=l\n}else{return\"&nbsp;\"\n}}}var v=this._headerHash[ZmItem.F_FROM];\nvar k=v?v._width:ZmMsg.COLUMN_WIDTH_FROM_CLV;\nvar c=this._fitParticipants(e,f,k);\nfor(var t=0;\nt<c.length;\nt++){if(t===0&&(f.participantsElided||c.length<b)){m[o++]=AjxStringUtil.ELLIPSIS\n}else{if(c.length>1&&t>0){m[o++]=AjxStringUtil.LIST_SEP\n}}var d=(c&&c[t]&&(c[t].index!=null))?c[t].index:\"\";\nvar g=[s,d].join(DwtId.SEP);\nm[o++]=\"<span id='\";\nm[o++]=g;\nm[o++]=\"'>\";\nm[o++]=(c&&c[t])?AjxStringUtil.htmlEncode(c[t].name):\"\";\nm[o++]=\"</span>\"\n}}else{m[o++]=n?\"&nbsp;\":ZmMsg.noRecipients\n}return m.join(\"\")\n};\nZmConvListView.prototype._getDisplayedMsgCount=function(d){var c=ZmMailApp.getFoldersToOmit(),b=0,e;\nif(AjxUtil.arraySize(d.msgFolder)<d.numMsgs){return d.numMsgs\n}for(e in d.msgFolder){if(!c[d.msgFolder[e]]){b++\n}}return b\n};\nZmConvListView.prototype._getLabelForField=function(c,d){switch(d){case ZmItem.F_EXPAND:if(this._isExpandable(c)){return this.isExpanded(c)?ZmMsg.expanded:ZmMsg.collapsed\n}break;\ncase ZmItem.F_SIZE:if(c.numMsgs>1){var b=AjxMessageFormat.format(ZmMsg.typeMessage,c.numMsgs);\nreturn AjxMessageFormat.format(ZmMsg.itemCount,[c.numMsgs,b])\n}break\n}return ZmMailListView.prototype._getLabelForField.apply(this,arguments)\n};\nZmConvListView.prototype._getHeaderToolTip=function(c,b){if(c==ZmItem.F_EXPAND){return\"\"\n}if(c==ZmItem.F_FROM){return ZmMsg.from\n}return ZmMailListView.prototype._getHeaderToolTip.call(this,c,b)\n};\nZmConvListView.prototype._getToolTip=function(f){if(!f.item){return\n}if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)&&(f.field==ZmItem.F_PARTICIPANT)){var e=f.item.participants;\nvar d=f.match&&f.match.participant;\nvar g=e&&e.get(d||0);\nif(!g){return\"\"\n}var c={address:g,ev:f.ev};\nvar b=new AjxCallback(this,function(h){appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,c,h)\n});\nreturn{callback:b}\n}else{if(f.item.type==ZmItem.MSG){return ZmMailMsgListView.prototype._getToolTip.apply(this,arguments)\n}else{if(f.field==ZmItem.F_FROM){}else{return ZmMailListView.prototype._getToolTip.apply(this,arguments)\n}}}};\nZmConvListView.prototype._expand=function(o,d,c){var p=d||o;\nvar k=(p.type==ZmItem.CONV);\nvar f=this._msgRowIdList[p.id];\nvar r;\nif(f&&f.length&&this._rowsArePresent(p)&&!c){this._showMsgs(f,true);\nr=document.getElementById(f[f.length-1])\n}else{this._msgRowIdList[p.id]=[];\nvar h=o.msgs;\nif(!h){return\n}if(k){h.addChangeListener(this._listChangeListener)\n}var e=(appCtxt.get(ZmSetting.CONVERSATION_ORDER)==ZmSearch.DATE_ASC);\nvar l=this._getRowIndex(p);\nif(e&&d){l--\n}var g=this._msgOffset[p.id]||0;\nvar n=o.getMsgList(g,e,ZmMailApp.getFoldersToOmit());\nfor(var j=0;\nj<n.length;\nj++){var d=n[j];\nvar b=this._createItemHtml(d);\nthis._addRow(b,l+j+1);\nf=this._msgRowIdList[p.id];\nif(f){f.push(b.id)\n}b.setAttribute(\"aria-level\",2);\nf=this._msgRowIdList[p.id];\nif(j==n.length-1){r=b\n}}}this._setImage(p,ZmItem.F_EXPAND,\"NodeExpanded\",this._getClasses(ZmItem.F_EXPAND));\nthis._expanded[p.id]=true;\nvar m=k?p.id:p.cid;\nif(!this._expandedItems[m]){this._expandedItems[m]=[]\n}this._expandedItems[m].push(p);\nthis._resetColWidth();\nif(r){this._scrollList(r);\nif(f){var q=f.length*Dwt.getSize(r).y;\nif(q>Dwt.getSize(r.parentNode).y){this._scrollList(this._getElFromItem(p))\n}}}this._updateLabelForItem(p)\n};\nZmConvListView.prototype._collapse=function(e){var g=(e.type==ZmItem.CONV);\nvar f=g?e.id:e.cid;\nvar d=this._expandedItems[f];\nif(d&&d.length){var c=false;\nwhile(!c){var b=d.pop();\nthis._doCollapse(b);\nc=((b.id==e.id)||(d.length==0))\n}}if(g){this._expanded[e.id]=false;\nthis._expandedItems[f]=[]\n}this._resetColWidth();\nthis._updateLabelForItem(e)\n};\nZmConvListView.prototype._updateLabelForItem=function(c){ZmMailListView.prototype._updateLabelForItem.apply(this,arguments);\nif(c&&this._isExpandable(c)){var b=this._getElFromItem(c);\nif(b&&b.setAttribute){b.setAttribute(\"aria-expanded\",this.isExpanded(c))\n}}};\nZmConvListView.prototype._doCollapse=function(c){var b=this._msgRowIdList[c.id];\nif(b&&b.length){this._showMsgs(b,false)\n}this._setImage(c,ZmItem.F_EXPAND,\"NodeCollapsed\",this._getClasses(ZmItem.F_EXPAND));\nthis._expanded[c.id]=false;\nthis._updateLabelForItem(c)\n};\nZmConvListView.prototype._showMsgs=function(d,b){if(!(d&&d.length)){return\n}for(var c=0;\nc<d.length;\nc++){var e=document.getElementById(d[c]);\nif(e){Dwt.setVisible(e,b)\n}}};\nZmConvListView.prototype._rowsArePresent=function(d){var b=this._msgRowIdList[d.id];\nif(b&&b.length){for(var c=0;\nc<b.length;\nc++){if(document.getElementById(b[c])){return true\n}}}this._msgRowIdList[d.id]=[];\nthis._expanded[d.id]=false;\nif(d.type==ZmItem.CONV){this._expandedItems[d.id]=[]\n}else{AjxUtil.arrayRemove(this._expandedItems[d.cid],d)\n}return false\n};\nZmConvListView.prototype._isExpandable=function(g){var e=false;\nif(g.type==ZmItem.CONV){e=(this._getDisplayedMsgCount(g)>1)\n}else{var h=appCtxt.getById(g.cid);\nif(!h){return false\n}var d=h.msgs?h.msgs.getArray():null;\nif(d&&d.length){var c=appCtxt.get(ZmSetting.CONVERSATION_PAGE_SIZE);\nvar b=null;\nfor(var f=0;\nf<d.length;\nf++){if(d[f].id==g.id){b=f+1;\nbreak\n}}if(b&&(b%c==0)&&(b<d.length||h.msgs._hasMore)){this._msgOffset[g.id]=b;\ne=true\n}}}return e\n};\nZmConvListView.prototype._resetExpansion=function(){for(var c in this._expandedItems){var b=this._expandedItems[c];\nif(b&&b.msgs){b.msgs.removeChangeListener(this._listChangeListener)\n}}this._expanded={};\nthis._msgRowIdList={};\nthis._msgOffset={};\nthis._expandedItems={}\n};\nZmConvListView.prototype.isExpanded=function(b){return Boolean(b&&this._expanded[b.id])\n};\nZmConvListView.prototype._expandItem=function(b){if(b&&this._isExpandable(b)){this._controller._toggle(b)\n}else{if(b.type==ZmItem.MSG&&this._expanded[b.cid]){var c=appCtxt.getById(b.cid);\nthis._controller._toggle(c);\nthis.setSelection(c,true)\n}}};\nZmConvListView.prototype._expandAll=function(d){if(!this._list){return\n}var b=this._list.getArray();\nfor(var c=0,e=b.length;\nc<e;\nc++){var f=b[c];\nif(!this._isExpandable(f)||d===this.isExpanded(f)){continue\n}if(d){if(f._loaded){this._expandItem(f)\n}}else{if(!d){this._collapse(f)\n}}}};\nZmConvListView.prototype._sortColumn=function(c,g,h){ZmMailListView.prototype._sortColumn.apply(this,arguments);\nvar e;\nvar d=this.getList();\nif(this._columnHasCustomQuery(c)){e=this._getSearchForSort(c._sortable)\n}else{if(d&&d.size()>1&&this._sortByString){e=this._controller.getSearchString()\n}}var b=this._controller.getSearchStringHint();\nif(e||b){var f={query:e,queryHint:b,types:[ZmItem.CONV],sortBy:this._sortByString,limit:this.getLimit(),callback:h,userInitiated:this._controller._currentSearch.userInitiated,sessionId:this._controller._currentSearch.sessionId,isViewSwitch:true};\nappCtxt.getSearchController().search(f)\n}};\nZmConvListView.prototype._changeListener=function(C){var B=this._getItemFromEvent(C);\nif(!B||C.handled||!this._handleEventType[B.type]){if(C&&C.event==ZmEvent.E_CREATE){AjxDebug.println(AjxDebug.NOTIFY,\"ZmConvListView: initial check failed\")\n}return\n}var s=C.getDetail(\"fields\");\nvar f=(B.type==ZmItem.CONV);\nvar m=B.isMute?B.isMute:false;\nvar t=this._sortByString||ZmSearch.DATE_DESC;\nvar o=false;\nvar x=false;\nvar v=null;\nif(!f&&(C.event==ZmEvent.E_MOVE||C.event==ZmEvent.E_DELETE)){var r=C.batchMode?this._getItemsFromBatchEvent(C):[B];\nfor(var z=0,A=r.length;\nz<A;\nz++){var B=r[z];\nvar d=appCtxt.getById(B.cid);\no=true;\nif(d){if(B.folderId==ZmFolder.ID_SPAM||B.folderId==ZmFolder.ID_TRASH||C.event==ZmEvent.E_DELETE){if(B.folderId==ZmFolder.ID_TRASH){x=true;\nv=d\n}d.removeMsg(B);\nthis.removeItem(B,true,C.batchMode);\nthis._controller._app._checkReplenishListView=this;\nthis._setNextSelection()\n}else{if(!d.containsMsg(B)){k=d.msgs&&d.msgs._getSortIndex(B,ZmSearch.DATE_DESC);\nd.addMsg(B,k);\nx=true;\nv=d;\nvar w=this._expanded[d.id];\nthis._removeMsgRows(d.id);\nif(w){this._expand(d,null,true)\n}}else{if(!d.hasMatchingMsg(this._controller._currentSearch,true)){this._list.remove(d);\nthis._controller._list.remove(d);\nC.item=B=d;\nf=true;\no=false\n}else{this._changeFolderName(B,C.getDetail(\"oldFolderId\"))\n}}}}}}if(f&&(C.event==ZmEvent.E_MOVE||C.event==ZmEvent.E_DELETE)){var r=C.batchMode?this._getItemsFromBatchEvent(C):[B];\nfor(var z=0,A=r.length;\nz<A;\nz++){var d=r[z];\nif(this._itemToSelect&&(this._itemToSelect.cid==d.id||this._itemToSelect.id==d.id)){var e={};\nif(d.msgs){var D=d.msgs.getArray();\nfor(var y=0,n=D.length;\ny<n;\ny++){e[D[y].id]=true\n}}e[d.id]=true;\nthis._itemToSelect=this._controller._getNextItemToSelect(e)\n}this._removeMsgRows(d.id);\nthis._expanded[d.id]=false;\nthis._expandedItems[d.id]=[];\ndelete this._msgRowIdList[d.id]\n}}if(!f&&(C.event==ZmEvent.E_CREATE)){AjxDebug.println(AjxDebug.NOTIFY,\"ZmConvListView: handle msg create \"+B.id);\nvar h=this._msgRowIdList[B.cid];\nvar d=appCtxt.getById(B.cid);\nif(h&&h.length&&this._rowsArePresent(d)){var q=this._createItemHtml(B);\nif(!this._expanded[B.cid]){Dwt.setVisible(q,false)\n}var c=this._getRowIndex(d);\nvar k=C.getDetail(\"sortIndex\");\nvar u=k||0;\nAjxDebug.println(AjxDebug.NOTIFY,\"ZmConvListView: add msg row to conv \"+B.id+\" within \"+d.id);\nthis._addRow(q,c+u+1);\nh.push(q.id)\n}if(d){x=true;\nv=d;\no=C.handled=true\n}}if(f&&(C.event==ZmEvent.E_CREATE)){C.setDetail(\"sortIndex\",this._getSortIndex(B,t))\n}if(f&&(C.event==ZmEvent.E_MODIFY)&&(s&&s[ZmItem.F_ID])){var q=document.getElementById(this._getItemId({id:B._oldId}));\nif(q){this._createItemHtml(B,{div:q});\nthis.associateItemWithElement(B,q)\n}this._expanded[B.id]=this._expanded[B._oldId];\nthis._expandedItems[B.id]=this._expandedItems[B._oldId];\nthis._msgRowIdList[B.id]=this._msgRowIdList[B._oldId]||[]\n}if(f&&((C.event==ZmEvent.E_MODIFY)&&(s&&s[ZmItem.F_INDEX]))){AjxDebug.println(AjxDebug.NOTIFY,\"ZmConvListView: handle conv create \"+B.id);\nvar k=this._getSortIndex(B,t);\nvar p=this.getItemIndex(B,true);\nif((k!=null)&&(p!=null)&&(k!=p)&&!this._expanded[B.id]){AjxDebug.println(AjxDebug.NOTIFY,\"ZmConvListView: change position of conv \"+B.id+\" to \"+k);\nthis._removeMsgRows(B.id);\nthis.removeItem(B);\nthis.addItem(B,k)\n}}if((C.event==ZmEvent.E_MODIFY||C.event==ZmEvent.E_MOVE)&&(s&&s[ZmItem.F_FRAGMENT])){this._updateField(f?B:appCtxt.getById(B.cid),ZmItem.F_SUBJECT)\n}if(C.event==ZmEvent.E_MODIFY&&(s&&(s[ZmItem.F_PARTICIPANT]||s[ZmItem.F_FROM]||(s[ZmItem.F_SIZE]&&!this.isMultiColumn())))){this._updateField(B,ZmItem.F_FROM)\n}if(C.event==ZmEvent.E_FLAGS){var l=C.getDetail(\"flags\");\nif(AjxUtil.isArray(l)&&AjxUtil.indexOf(l,ZmItem.FLAG_UNREAD)!=-1){B=B||(r&&r[z]);\nvar d=f?B:B&&appCtxt.getById(B.cid);\nif(d){d.unreadHasChanged=true\n}}}if(x||(f&&(C.event===ZmEvent.E_MODIFY&&s&&s[ZmItem.F_SIZE]))){d=v||B;\nvar b=this._getDisplayedMsgCount(d);\nif(d.redrawConvRow||b===1||b===2){if(b===1){this._collapse(d)\n}this.redrawItem(d)\n}this._updateField(d,this.isMultiColumn()?ZmItem.F_SIZE:ZmItem.F_FROM)\n}if(C.event==ZmEvent.E_MODIFY&&(s&&s[ZmItem.F_DATE])){this._updateField(B,ZmItem.F_DATE)\n}if(!o){if(f){if(C.event==ZmEvent.E_MODIFY&&B.msgs){var g=this.getController()._convView;\nif(g){B.msgs.addChangeListener(g._listChangeListener)\n}B.msgs.addChangeListener(this._listChangeListener)\n}ZmMailListView.prototype._changeListener.apply(this,arguments)\n}else{ZmMailMsgListView.prototype._changeListener.apply(this,arguments)\n}}};\nZmConvListView.prototype.handleUnmuteConv=function(b){for(var d=0;\nd<b.length;\nd++){var e=b[d];\nvar h=(e.type==ZmItem.CONV);\nif(!h){continue\n}var g=this._sortByString||ZmSearch.DATE_DESC;\nvar f=this._getSortIndex(e,g);\nvar c=this.getItemIndex(e,true);\nif((f!=null)&&(c!=null)&&(f!=c)&&!this._expanded[e.id]){AjxDebug.println(AjxDebug.NOTIFY,\"ZmConvListView: change position of conv \"+e.id+\" to \"+f);\nthis._removeMsgRows(e.id);\nthis.removeItem(e);\nthis.addItem(e,f)\n}}};\nZmConvListView.prototype._getSortIndex=function(h,j){var g=parseInt(h.date);\nvar f=this.getList(true);\nvar b=f&&f.getArray();\nif(b&&b.length){for(var d=0;\nd<b.length;\nd++){var e=b[d];\nif(!e||(e&&e.type==ZmItem.MSG)){continue\n}var c=parseInt(e.date);\nif((j&&j.toLowerCase()===ZmSearch.DATE_DESC.toLowerCase()&&(g>=c))||(j&&j.toLowerCase()===ZmSearch.DATE_ASC.toLowerCase()&&(g<=c))){return d\n}}return d\n}else{return null\n}};\nZmConvListView.prototype._removeMsgRows=function(e){var b=this._msgRowIdList[e];\nif(b&&b.length){for(var c=0;\nc<b.length;\nc++){var d=document.getElementById(b[c]);\nif(d){this._selectedItems.remove(d);\nthis._parentEl.removeChild(d)\n}}}};\nZmConvListView.prototype.removeItem=function(c,b){if(c.type==ZmItem.MSG){AjxUtil.arrayRemove(this._msgRowIdList[c.cid],this._getItemId(c))\n}DwtListView.prototype.removeItem.apply(this,arguments)\n};\nZmConvListView.prototype._allowFieldSelection=function(d,c){if(c==ZmItem.F_EXPAND){var b=appCtxt.getById(d);\nreturn(b&&!this._isExpandable(b))\n}else{return ZmListView.prototype._allowFieldSelection.apply(this,arguments)\n}};\nZmConvListView.prototype.redoExpansion=function(){var e=[];\nvar d={};\nfor(var g in this._expandedItems){var b=this._expandedItems[g];\nif(b&&b.length){for(var c=0;\nc<b.length;\nc++){var f=b[c];\ne.push(f);\nd[f]=this._msgOffset[f]\n}}}this._expandAll(false);\nthis._resetExpansion();\nfor(var c=0;\nc<e.length;\nc++){var f=e[c];\nthis._expand(f,d[f])\n}};\nZmConvListView.prototype._getLastItem=function(){var c=this.getList();\nvar b=c&&c.getArray();\nif(b&&b.length>1){return b[b.length-1]\n}return null\n};\nZmConvListView.prototype._getActionMenuForColHeader=function(c){var d=ZmMailListView.prototype._getActionMenuForColHeader.apply(this,arguments);\nif(!this.isMultiColumn()){var b=this._colHeaderActionMenu.getMenuItem(ZmItem.F_FROM);\nif(b){b.setVisible(false)\n}b=this._colHeaderActionMenu.getMenuItem(ZmItem.F_TO);\nif(b){b.setVisible(false)\n}}return d\n};\nZmConvListView.prototype._saveState=function(b){ZmMailListView.prototype._saveState.apply(this,arguments);\nthis._state.expanded=b&&b.expansion&&this._expanded\n};\nZmConvListView.prototype._restoreState=function(c){var b=c||this._state;\nif(b.expanded){for(var d in b.expanded){if(b.expanded[d]){this._expandItem(b.expanded[d])\n}}}ZmMailListView.prototype._restoreState.call(this)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmMailListSectionHeader\")){ZmMailListSectionHeader=function(b,c){var c=c||{};\nc.parent=c.parent||appCtxt.getShell();\nc.id=this.id=c.id||Dwt.getNextId();\nc.className=c.className||\"groupHeader\";\nDwtControl.call(this,c);\nthis._group=b;\nthis.setHtmlElementId(Dwt.getNextId(ZmMailListSectionHeader.HEADER_ID));\nthis._createHtml(c);\nthis._setEventHdlrs([DwtEvent.ONMOUSEDOWN]);\nthis.addListener(DwtEvent.ONMOUSEDOWN,new AjxListener(this,this._groupHeaderMouseClick));\nthis._collapsed=false\n};\nZmMailListSectionHeader.prototype=new DwtControl;\nZmMailListSectionHeader.prototype.constructor=ZmMailListSectionHeader;\nZmMailListSectionHeader.HEADER_ID=\"GroupHeader_\";\nZmMailListSectionHeader.prototype.getHeaderHtml=function(){return this._el.innerHTML\n};\nZmMailListSectionHeader.prototype._createHtml=function(b){this._el=this.getHtmlElement();\nthis._el.innerHTML=this._renderGroupHdr(b.headerTitle)\n};\nZmMailListSectionHeader.prototype._renderGroupHdr=function(e){var f=this._el.id;\nvar c=[];\nvar b=0;\nvar d=\"id='\"+f+\"_imgNode'\";\nc[b++]=\"<div id='\"+f+\"'>\";\nc[b++]=\"<table cellpadding=0 cellspacing=0 border=0 width=100% class='DwtListView-Column'><tr><td>\";\nc[b++]=AjxImg.getImageHtml(\"NodeExpanded\",\"float:left;\",d);\nc[b++]=\"<div class='DwtListHeaderItem-label black' style='padding:0px 0px 2px 2px; font-weight:bold; float:left;' id='\"+f+\"_groupTitle'>\";\nc[b++]=e;\nc[b++]=\"</div>\";\nc[b++]=\"</td></tr></table>\";\nc[b++]=\"</div>\";\nreturn c.join(\"\")\n};\nZmMailListSectionHeader.prototype._groupHeaderMouseClick=function(b){if(b&&b.button==DwtMouseEvent.RIGHT){this._actionMenuListener(b)\n}else{if(!this._collapsed){this._doCollapse(b)\n}else{this._doExpand(b)\n}}};\nZmMailListSectionHeader.prototype._doCollapse=function(c){var d=document.getElementById(this._el.id);\nwhile(d){var b=d.nextSibling;\nif(b&&b.id.indexOf(ZmMailListSectionHeader.HEADER_ID)==-1){Dwt.setVisible(b,false)\n}else{this._setImage(this._el.id+\"_imgNode\",\"NodeCollapsed\");\nthis._collapsed=true;\nreturn\n}d=b\n}};\nZmMailListSectionHeader.prototype._doExpand=function(c){var d=document.getElementById(this._el.id);\nwhile(d){var b=d.nextSibling;\nif(b&&b.id.indexOf(ZmMailListSectionHeader.HEADER_ID)==-1){Dwt.setVisible(b,true)\n}else{this._setImage(this._el.id+\"_imgNode\",\"NodeExpanded\");\nthis._collapsed=false;\nreturn\n}d=b\n}};\nZmMailListSectionHeader.prototype._collapseAll=function(c){if(this._group){var d=this._group.getAllSectionHeaders();\nfor(var b=0;\nb<d.length;\nb++){d[b]._doCollapse(c)\n}}};\nZmMailListSectionHeader.prototype._expandAll=function(c){if(this._group){var d=this._group.getAllSectionHeaders();\nfor(var b=0;\nb<d.length;\nb++){d[b]._doExpand(c)\n}}};\nZmMailListSectionHeader.prototype._setImage=function(b,d){var c=document.getElementById(b);\nif(c&&c.parentNode){AjxImg.setImage(c.parentNode,d)\n}};\nZmMailListSectionHeader.prototype._actionMenuListener=function(e){if(!this._menu){var f=new ZmPopupMenu(this);\nvar c=new AjxListener(this,this._collapseAll);\nvar b=new AjxListener(this,this._expandAll);\nvar d=f.createMenuItem(\"collapse_all\",{text:ZmMsg.collapseAllGroups,style:DwtMenuItem.NO_STYLE});\nd.addSelectionListener(c);\nd=f.createMenuItem(\"expand_all\",{text:ZmMsg.expandAllGroups,style:DwtMenuItem.NO_STYLE});\nd.addSelectionListener(b);\nthis._menu=f\n}this._menu.popup(0,e.docX,e.docY)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmConvView2\")){ZmConvView2=function(b){b.className=b.className||\"ZmConvView2 ZmConvView2FullWidth\";\nZmMailItemView.call(this,b);\nthis._mode=b.mode;\nthis._controller=b.controller;\nthis._convChangeHandler=this._convChangeListener.bind(this);\nthis._listChangeListener=this._msgListChangeListener.bind(this);\nthis._standalone=b.standalone;\nthis._hasBeenExpanded={};\nthis.inviteMsgsExpanded=0;\nthis.addControlListener(this._scheduleResize.bind(this));\nthis._setAllowSelection();\nthis._setEventHdlrs([DwtEvent.ONMOUSEOUT,DwtEvent.ONMOUSEOVER,DwtEvent.ONMOUSEENTER,DwtEvent.ONMOUSELEAVE]);\nthis._objectManager=true\n};\nZmConvView2.prototype=new ZmMailItemView;\nZmConvView2.prototype.constructor=ZmConvView2;\nZmConvView2.prototype.isZmConvView2=true;\nZmConvView2.prototype.toString=function(){return\"ZmConvView2\"\n};\nZmConvView2.MAX_INVITE_MSG_EXPANDED=10;\nZmConvView2.prototype.role=\"region\";\nZmConvView2.prototype.set=function(d){if(d&&this._item&&d.id===this._item.id&&!this._convDirty){return\n}var b=(d!=null);\nthis.reset(b);\nthis._item=d;\nthis._cleared=this.noTab=!b;\nif(b){this._initialize();\nd.addChangeListener(this._convChangeHandler);\nthis._renderConv(d);\nif(d.msgs){d.msgs.addChangeListener(this._listChangeListener);\nvar c=this._controller.getListView();\nif(c&&c.isZmConvListView){d.msgs.addChangeListener(c._listChangeListener);\nif(c.isExpanded(d)){c._removeMsgRows(d.id);\nc._expand(d,null,true)\n}}}}else{this._initializeClear();\nthis._clearDiv.innerHTML=(this._controller.getList().size())?this._viewConvHtml:\"\"\n}Dwt.setVisible(this._mainDiv,b);\nDwt.setVisible(this._clearDiv,!b)\n};\nZmConvView2.prototype._initialize=function(){if(this._initialized){return\n}this._mainDivId=this._htmlElId+\"_main\";\nvar d=this._htmlElId+\"_header\";\nthis._messagesDivId=this._htmlElId+\"_messages\";\nvar c={mainDivId:this._mainDivId,headerDivId:d,messagesDivId:this._messagesDivId};\nvar b=AjxTemplate.expand(\"mail.Message#Conv2View\",c);\nthis.getHtmlElement().appendChild(Dwt.parseHtmlFragment(b));\nthis._mainDiv=document.getElementById(this._mainDivId);\nthis._messagesDiv=document.getElementById(this._messagesDivId);\nthis._header=new ZmConvView2Header({parent:this,id:[this._htmlElId,ZmId.MV_MSG_HEADER].join(\"_\")});\nthis._header.replaceElement(d);\nthis.setAttribute(\"aria-labelledby\",this._header._convSubjectId);\nif(this._controller&&this._controller._checkKeepReading){Dwt.setHandler(this._messagesDiv,DwtEvent.ONSCROLL,ZmDoublePaneController.handleScroll)\n}this._initialized=true\n};\nZmConvView2.prototype._initializeClear=function(){if(this._initializedClear){return\n}this._viewConvHtml=AjxTemplate.expand(\"mail.Message#viewMessage\",{isConv:true});\nvar b=this._clearDiv=document.createElement(\"div\");\nb.id=this._htmlElId+\"_clear\";\nthis.getHtmlElement().appendChild(b);\nthis._initializedClear=true\n};\nZmConvView2.prototype._renderConv=function(c){this._now=new Date();\nthis._header.set(this._item);\nvar b=this._renderMessages(c,this._messagesDiv);\nthis._header._setExpandIcon();\nthis._scheduleResize(b||true);\nthis.inviteMsgsExpanded=0;\nDwt.setLoadedTime(\"ZmConv\");\nthis._convDirty=false\n};\nZmConvView2.prototype.redrawItem=function(b){this._renderConv(this._item)\n};\nZmConvView2.prototype.setSelection=function(d,c,b){};\nZmConvView2.prototype._renderMessages=function(c,j){this.getTabGroupMember().removeAllMembers();\nthis.getTabGroupMember().addMember(this._header);\nthis._msgViews={};\nthis._msgViewList=[];\nvar h=c.getMsgList(0,false,ZmMailApp.getFoldersToOmit());\nvar m=[],q={};\nfor(var n=0,o=h.length;\nn<o;\nn++){m.push(h[n].id);\nq[h[n].id]=h[n]\n}var e={},g={};\nvar p=this._controller._relatedMsg&&this._controller._relatedMsg.id;\nvar f=false;\nfor(var n=0,o=m.length;\nn<o;\nn++){var l=m[n];\nvar d=q[l];\nif(p){e[l]=(l==p);\ng[l]=(l!=p)\n}else{if(d&&d.isLoaded()&&!this._hasBeenExpanded[l]){e[l]=f=true\n}}}if(!f&&!p){e[m[0]]=true\n}var b=(appCtxt.get(ZmSetting.CONVERSATION_ORDER)==ZmSearch.DATE_ASC);\nif(b){m.reverse()\n}var k;\nvar s=b?0:h.length-1;\nfor(var n=0,o=m.length;\nn<o;\nn++){var l=m[n];\nvar d=q[l];\nvar t={parent:this,parentElement:j,controller:this._controller,index:n};\nt.forceExpand=e[l];\nt.forceCollapse=g[l];\nt.forceOriginal=(n==s);\nthis._renderMessage(d,t);\nvar r=this._msgViews[l];\nif(k==null){k=r._expanded?n:null\n}}return k&&this._msgViews[this._msgViewList[k]]\n};\nZmConvView2.prototype._renderMessage=function(c,d){d=AjxUtil.hashCopy(d)||{};\nd.mode=this._mode;\nd.msgId=c.id;\nd.sessionId=this._controller.getSessionId();\nd.isDraft=c.isDraft;\nvar b=d.parentElement;\nif(b){var h=d.parentElement=document.createElement(\"DIV\");\nh.setAttribute(\"role\",\"listitem\");\nif((d.index!=null)&&b.childNodes[d.index]){b.insertBefore(h,b.childNodes[d.index])\n}else{b.appendChild(h)\n}var i=this._item.msgs?this._item.msgs.size():0;\nvar f=(d.index!=null)?d.index+1:b.childNodes.length;\nvar e=AjxMessageFormat.format(ZmMsg.typeMessage,[i]);\nvar j=AjxMessageFormat.format(ZmMsg.itemCount1,[f,i,e]);\nh.setAttribute(\"aria-label\",j)\n}AjxUtil.arrayAdd(this._msgViewList,c.id,d.index);\nvar g=this._msgViews[c.id]=new ZmMailMsgCapsuleView(d);\nthis.getTabGroupMember().addMember(g.getTabGroupMember());\ng.set(c)\n};\nZmConvView2.prototype.clearChangeListeners=function(){if(!this._item){return\n}this._item.removeChangeListener(this._convChangeHandler);\nif(this._item.msgs){this._item.msgs.removeChangeListener(this._listChangeListener)\n}this._item=null\n};\nZmConvView2.prototype.reset=function(d){this._setSelectedMsg(null);\nthis.clearChangeListeners();\nfor(var e in this._msgViews){var c=this._msgViews[e];\nc.reset();\nc.dispose();\nc=null;\ndelete this._msgViews[e]\n}this._msgViewList=null;\nthis._currentMsgView=null;\nvar b=this._messagesDiv;\nwhile(b&&b.lastChild){b.removeChild(b.lastChild)\n}if(this._initialized){this._header.reset();\nDwt.setVisible(this._headerDiv,d)\n}if(this._replyView){this._replyView.reset()\n}};\nZmConvView2.prototype.dispose=function(){this.clearChangeListeners();\nZmMailItemView.prototype.dispose.apply(this,arguments)\n};\nZmConvView2.prototype._removeMessageView=function(b){AjxUtil.arrayRemove(this._msgViewList,b);\nthis._msgViews[b]=null;\ndelete this._msgViews[b]\n};\nZmConvView2.prototype._resize=function(o){this._resizePending=false;\nif(this.isDisposed()){return\n}if(this._cleared){return\n}if(!this._messagesDiv){return\n}var r=this._controller,b;\nif(this._isStandalone()){b=this\n}else{var q=r.isReadingPaneOnRight();\nb=q?r.getListView():r.getItemView()\n}var l=this._header;\nif(!b||!l||!this._messagesDiv){return\n}var f=b.getSize(AjxEnv.isIE);\nvar k=Dwt.getScrollbarSizes(this.getHtmlElement());\nvar d=f?f.y:0;\nvar n=l.getSize();\nvar j=n?n.y:0;\nvar p=d-j-1-k.y;\nvar e=this.getSize().x-k.x;\nDwt.setSize(this._messagesDiv,e,p);\nif(this._msgViewList&&this._msgViewList.length){for(var h=0;\nh<this._msgViewList.length;\nh++){var m=this._msgViews[this._msgViewList[h]];\nif(m){ZmMailMsgView._resetIframeHeight(m);\nvar g=m._usingIframe&&m.getIframe();\nvar c=g?Dwt.getOuterSize(g).x:m._contentWidth;\nc+=m.getInsets().left+m.getInsets().right;\nif(c&&c>Dwt.getSize(this._messagesDiv).x){m.setSize(c,Dwt.DEFAULT)\n}if(m._isCalendarInvite&&m._inviteMsgView){m._inviteMsgView.convResize();\nm._inviteMsgView.scrollToInvite()\n}}}}window.setTimeout(this._resizeMessages.bind(this,o),0)\n};\nZmConvView2.prototype._resizeMessages=function(b){if(this._msgViewList){for(var c=0;\nc<this._msgViewList.length;\nc++){this._msgViews[this._msgViewList[c]]._resetIframeHeightOnTimer()\n}}if(b){if(b===true){this._messagesDiv.scrollTop=0\n}else{if(b.isZmMailMsgCapsuleView){this._scrollToTop(b)\n}}}};\nZmConvView2.prototype._scrollToTop=function(e){var b=Dwt.toWindow(e.getHtmlElement(),0,0,null,null,DwtPoint.tmp).y;\nvar d=Dwt.toWindow(this._messagesDiv,0,0,null,null,DwtPoint.tmp).y;\nvar c=b-d;\nthis._messagesDiv.scrollTop=(c>0)?c:0;\nthis._currentMsgView=e\n};\nZmConvView2.prototype._scheduleResize=function(b){if(!this._resizePending){window.setTimeout(this._resize.bind(this,b),100);\nthis._resizePending=true\n}};\nZmConvView2.prototype.getTabGroupMember=function(){if(!this._tabGroupMember){this._tabGroupMember=new DwtTabGroup(this.toString())\n}return this._tabGroupMember\n};\nZmConvView2.prototype.setReadingPane=function(){var b=this._controller._getReadingPanePref();\nif(this._rpLoc&&this._item){if(this._rpLoc!=ZmSetting.RP_OFF&&b!=ZmSetting.RP_OFF&&this._rpLoc!=b){this.set(this._item)\n}}this._rpLoc=b\n};\nZmConvView2.prototype.getExpanded=function(b){var d=[];\nif(this._msgViewList&&this._msgViewList.length){for(var c=0;\nc<this._msgViewList.length;\nc++){var f=this._msgViewList[c];\nvar e=this._msgViews[f];\nif(e.isExpanded()==b){d.push(f)\n}}}return d\n};\nZmConvView2.prototype.getLoaded=function(b){var d=[];\nif(this._msgViewList&&this._msgViewList.length){for(var c=0;\nc<this._msgViewList.length;\nc++){var f=this._msgViewList[c];\nvar e=this._msgViews[f]&&this._msgViews[f]._msg;\nif(e&&(e.isLoaded()==b)){d.push(f)\n}}}return d\n};\nZmConvView2.prototype.setExpanded=function(b,f){var e=this.getExpanded(!b);\nif(e.length&&!b){if(!f&&!this._controller.popShield(null,this.setExpanded.bind(this,b,true))){return\n}for(var c=0;\nc<this._msgViewList.length;\nc++){var g=this._msgViews[this._msgViewList[c]];\ng._setExpansion(false)\n}this._header._setExpandIcon()\n}else{if(e.length&&b){var d=this.getLoaded(false);\nif(d.length){var h=this._handleResponseSetExpanded.bind(this,e);\nthis._item.loadMsgs({fetchAll:true},h)\n}else{this._handleResponseSetExpanded(e)\n}}}};\nZmConvView2.prototype._handleResponseSetExpanded=function(d){for(var c=0;\nc<d.length;\nc++){var f=d[c];\nvar e=this._msgViews[f];\nvar b=appCtxt.getById(f);\nif(b){e._msg=b;\nif(e._header){e._header._msg=b\n}}e._setExpansion(true)\n}this._header._setExpandIcon()\n};\nZmConvView2.prototype.isDirty=function(){return(this._replyView&&(this._replyView.getValue()!=\"\"))\n};\nZmConvView2.prototype._keepReading=function(b){if(!(this._msgViewList&&this._msgViewList.length)){return false\n}var i=this._msgViews[this._msgViewList[0]];\nif(!i){return false\n}var k=this._currentMsgView||i;\nvar e=k.getHtmlElement();\nif(!this._offsetAdjustment){var c=i.getHtmlElement();\nthis._offsetAdjustment=c.offsetTop-parseInt(DwtCssStyle.getComputedStyleObject(c).marginTop)\n}var l=this._messagesDiv;\nvar j=Dwt.getSize(l).y;\nvar d=(l.scrollHeight>j&&(l.scrollTop+j<l.scrollHeight));\nif(e&&d){var g=Dwt.getSize(e).y;\nif(((e.offsetTop-this._offsetAdjustment)+g)>(l.scrollTop+j)){if(!b){l.scrollTop=l.scrollTop+j\n}return true\n}}var h=this._getSiblingMsgView(k,true),f=false;\nwhile(h&&!f){if(h&&h._expanded){f=true\n}else{h=this._getSiblingMsgView(h,true)\n}}if(h&&f&&d){if(!b){this._scrollToTop(h)\n}return true\n}return false\n};\nZmConvView2.prototype._getSiblingMsgView=function(f,c){var d=this._msgViewList,b=AjxUtil.indexOf(d,f._msgId),e=null;\nif(b!==-1){var g=c?d[b+1]:d[b-1];\nif(g){e=this._msgViews[g]\n}}return e\n};\nZmConvView2.prototype._isStandalone=function(){return this._standalone\n};\nZmConvView2.prototype._setSelectedMsg=function(c){if(this._isStandalone()){this._selectedMsg=c\n}var b=this._controller._mailListView;\nif(b){b._selectedMsg=c\n}};\nZmConvView2.prototype._sendListener=function(){var c=this._replyView.getValue();\nif(c){var b={action:this._replyView.action,sendNow:true,inNewWindow:false};\nthis._compose(b)\n}this._renderCurMsgFooter()\n};\nZmConvView2.prototype._cancelListener=function(){if(this._replyView&&this._controller.popShield()){this._replyView.reset()\n}this._renderCurMsgFooter()\n};\nZmConvView2.prototype._renderCurMsgFooter=function(){var b=this._replyView&&this._replyView._msgView;\nif(b){b._renderMessageFooter()\n}};\nZmConvView2.prototype._compose=function(g){if(!this._item){return\n}g=g||{};\ng.action=g.action||ZmOperation.REPLY_ALL;\nvar f=g.msg=g.msg||(this._replyView&&this._replyView.getMsg());\nif(!f){return\n}g.hideView=g.sendNow;\nvar c=AjxDispatcher.run(\"GetComposeController\",g.hideView?ZmApp.HIDDEN_SESSION:null);\ng.composeMode=c._getComposeMode(f,c._getIdentity(f));\nvar h=(g.composeMode==Dwt.HTML);\ng.toOverride=this._replyView.getAddresses(AjxEmailAddress.TO);\ng.ccOverride=this._replyView.getAddresses(AjxEmailAddress.CC);\nvar b=this._replyView.getValue();\nif(b){g.extraBodyText=h?AjxStringUtil.convertToHtml(b):b\n}var d=appCtxt.get(ZmSetting.REPLY_INCLUDE_WHAT);\nif(f&&(d==ZmSetting.INC_BODY||d==ZmSetting.INC_SMART)){var e=h?ZmMimeTable.TEXT_HTML:ZmMimeTable.TEXT_PLAIN;\nf.getBodyPart(e,this._sendMsg.bind(this,g,c))\n}else{this._sendMsg(g,c)\n}};\nZmConvView2.prototype._sendMsg=function(c,b){b.doAction(c);\nif(c.sendNow){b.sendMsg(null,null,this._handleResponseSendMsg.bind(this))\n}};\nZmConvView2.prototype._handleResponseSendMsg=function(){this._replyView.reset()\n};\nZmConvView2.prototype.addInviteReplyListener=function(b){this._inviteReplyListener=b\n};\nZmConvView2.prototype.addShareListener=function(b){this._shareListener=b\n};\nZmConvView2.prototype.addSubscribeListener=function(b){this._subscribeListener=b\n};\nZmConvView2.prototype._convChangeListener=function(c){if(c.type!=ZmEvent.S_CONV){return\n}var b=c.getDetail(\"fields\");\nif((c.event==ZmEvent.E_MODIFY)&&(b&&b[ZmItem.F_SIZE])){this._header._setInfo()\n}this._convDirty=true\n};\nZmConvView2.prototype._msgListChangeListener=function(c){if(c.type!=ZmEvent.S_MSG){return\n}var g=c.item;\nif(!g){return\n}if(c.event==ZmEvent.E_CREATE&&this._item&&(g.cid==this._item.id)&&!g.isDraft){var b=c.getDetail(\"sortIndex\");\nvar d=this.getReplyViewIndex();\nb=(d!=-1&&b>d)?b+1:b;\nvar f={parent:this,parentElement:document.getElementById(this._messagesDivId),controller:this._controller,forceCollapse:true,forceExpand:g.isSent,index:b};\nthis._renderMessage(g,f);\nvar e=this._msgViews&&this._msgViews[g.id];\nif(e){e._resetIframeHeightOnTimer()\n}}else{var e=this._msgViews&&this._msgViews[g.id];\nif(e){return e._handleChange(c)\n}}this._convDirty=true\n};\nZmConvView2.prototype.resetMsg=function(b){};\nZmConvView2.prototype.isWaitOnMarkRead=function(){return this._item&&this._item.waitOnMarkRead\n};\nZmConvView2.prototype.getSelection=function(){if(this._selectedMsg){return[this._selectedMsg]\n}return[this._item]\n};\nZmConvView2.prototype.getSelectionCount=function(){return 1\n};\nZmConvView2.prototype.setReply=function(c,b,d){if(!this._replyView){this._replyView=new ZmConvReplyView({parent:this});\nthis.getTabGroupMember().addMember(this._replyView.getTabGroupMember())\n}this._replyView.set(c,b,d)\n};\nZmConvView2.prototype.getMsgViewIndex=function(d){var c=d&&d.getHtmlElement();\nif(d&&this._messagesDiv){for(var b=0;\nb<this._messagesDiv.childNodes.length;\nb++){if(this._messagesDiv.childNodes[b]==c){return b\n}}}return -1\n};\nZmConvView2.prototype.getReplyViewIndex=function(d){if(this._messagesDiv&&this._replyView){var c=this._messagesDiv.childNodes;\nfor(var b=0;\nb<c.length;\nb++){if(c[b].id==this._replyView._htmlElId){return b\n}}}return -1\n};\nZmConvView2.prototype.getController=function(){return this._controller\n};\nZmConvView2.prototype.isActiveQuickReply=function(){return this._replyView&&this._replyView._input==document.activeElement\n};\nZmConvView2.prototype.renderObjects=function(b,c,d){if(this._objectManager){this._lazyCreateObjectManager(b||this);\nreturn this._objectManager.findObjects(c,d)\n}return c\n};\nZmConvView2.prototype._getItemCountType=function(){return ZmId.ITEM_MSG\n};\nZmConvView2Header=function(b){b.className=b.className||\"Conv2Header\";\nDwtComposite.call(this,b);\nthis._setEventHdlrs([DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEUP,DwtEvent.ONDBLCLICK]);\nthis.setEventPropagation(true,[DwtEvent.ONMOUSEDOWN,DwtEvent.ONSELECTSTART,DwtEvent.ONMOUSEUP,DwtEvent.ONMOUSEMOVE]);\nthis._convView=this.parent;\nthis._conv=this.parent._item;\nthis._controller=this.parent._controller;\nif(!this._convView._isStandalone()){this._dblClickIsolation=true;\nthis.addListener(DwtEvent.ONDBLCLICK,this._dblClickListener.bind(this))\n}this.addListener(DwtEvent.ONMOUSEUP,this._mouseUpListener.bind(this));\nthis._createHtml();\nthis._setAllowSelection()\n};\nZmConvView2Header.prototype=new DwtComposite;\nZmConvView2Header.prototype.constructor=ZmConvView2Header;\nZmConvView2Header.prototype.isZmConvView2Header=true;\nZmConvView2Header.prototype.toString=function(){return\"ZmConvView2Header\"\n};\nZmConvView2Header.prototype.isFocusable=true;\nZmConvView2Header.prototype.set=function(b){this._item=b;\nthis._setSubject();\nthis._setInfo();\nthis.setVisible(true);\nif(AjxEnv.isWebKitBased&&!this._headerSet){Dwt.setSize(this._infoDiv,Dwt.DEFAULT,Dwt.getSize(this._subjectSpan).y);\nthis._headerSet=true\n}};\nZmConvView2Header.prototype.reset=function(){this.setVisible(false);\nif(this._subjectSpan&&this._infoDiv){this._subjectSpan.innerHTML=this._infoDiv.innerHTML=\"\";\nthis._subjectSpan.title=\"\"\n}};\nZmConvView2Header.prototype._createHtml=function(){this._convExpandId=this._htmlElId+\"_expand\";\nthis._convSubjectId=this._htmlElId+\"_subject\";\nthis._convInfoId=this._htmlElId+\"_info\";\nvar b={convExpandId:this._convExpandId,convSubjectId:this._convSubjectId,convInfoId:this._convInfoId};\nthis.getHtmlElement().innerHTML=AjxTemplate.expand(\"mail.Message#Conv2Header\",b);\nthis._expandDiv=document.getElementById(this._convExpandId);\nthis._subjectSpan=document.getElementById(this._convSubjectId);\nthis._infoDiv=document.getElementById(this._convInfoId);\nvar c=this._convView.getHtmlElement();\nc.setAttribute(\"aria-labelledby\",this._convSubjectId)\n};\nZmConvView2Header.prototype._setExpandIcon=function(){var d=this._convView.getExpanded(false);\nvar c=this._doExpand=(d.length>0);\nvar b=\"title='\"+(c?ZmMsg.expandAllMessages:ZmMsg.collapseAllMessages)+\"'\";\nthis._expandDiv.innerHTML=AjxImg.getImageHtml(c?\"ConvExpand\":\"ConvCollapse\",\"display:inline-block\",b)\n};\nZmConvView2Header.prototype._setSubject=function(){var b=this._item.subject||ZmMsg.noSubject;\nif(this._item.numMsgs>1){b=ZmMailMsg.stripSubjectPrefixes(b)\n}this._subjectSpan.innerHTML=AjxStringUtil.htmlEncode(b);\nthis._subjectSpan.title=this._convView.subject=b\n};\nZmConvView2Header.prototype._setInfo=function(){var e=this._item;\nif(!e){return\n}var d=e.numMsgs||(e.msgs&&e.msgs.size());\nif(!d){return\n}var c=AjxMessageFormat.format(ZmMsg.messageCount,d);\nvar b=e.getNumUnreadMsgs();\nif(b){c=c+\", \"+AjxMessageFormat.format(ZmMsg.unreadCount,b).toLowerCase()\n}this._infoDiv.innerHTML=c\n};\nZmConvView2Header.prototype._mouseUpListener=function(d){var e=false,c=false,b=false;\nif(typeof window.getSelection!=\"undefined\"){c=window.getSelection();\ne=c.toString();\nb=c.focusNode&&c.focusNode.parentNode&&c.focusNode.parentNode.id\n}else{if(typeof document.selection!=\"undefined\"&&document.selection.type==\"Text\"){c=document.selection.createRange();\ne=c.text;\nb=c.parentElement().id\n}}if(e&&b==this._convSubjectId){return\n}if(d.button==DwtMouseEvent.LEFT){this._convView.setExpanded(this._doExpand);\nthis._setExpandIcon()\n}};\nZmConvView2Header.prototype._dblClickListener=function(b){if(this._convView._isStandalone()){return\n}var c=b.dwtObj&&b.dwtObj.parent&&b.dwtObj.parent._item;\nif(c&&b.target!==this._subjectSpan){AjxDispatcher.run(\"GetConvController\",c.id).show(c,this._controller)\n}};\nZmConvReplyView=function(b){b.className=b.className||\"Conv2Reply\";\nb.id=b.parent._htmlElId+\"_reply\";\nDwtComposite.call(this,b);\nthis._convView=b.parent;\nthis._objectManager=new ZmObjectManager(this);\nthis.addControlListener(this._resized.bind(this))\n};\nZmConvReplyView.prototype=new DwtComposite;\nZmConvReplyView.prototype.constructor=ZmConvReplyView;\nZmConvReplyView.prototype.isZmConvReplyView=true;\nZmConvReplyView.prototype.toString=function(){return\"ZmConvReplyView\"\n};\nZmConvReplyView.prototype.TEMPLATE=\"mail.Message#Conv2Reply\";\nZmConvReplyView.prototype.TABLE_TEMPLATE=\"mail.Message#Conv2ReplyTable\";\nZmConvReplyView.ADDR_TYPES=[AjxEmailAddress.TO,AjxEmailAddress.CC];\nZmConvReplyView.prototype.set=function(g,e,h){this.action=h;\nAjxDispatcher.require(\"Mail\");\nvar b=this._addressInfo=this._getReplyAddressInfo(g,e,h);\nif(!this._initialized){var d=b;\nd.replyToDivId=this._htmlElId+\"_replyToDiv\";\nd.replyCcDivId=this._htmlElId+\"_replyCcDiv\";\nd.replyInputId=this._htmlElId+\"_replyInput\";\nthis._createHtmlFromTemplate(this.TEMPLATE,d);\nthis._initializeToolbar();\nthis._replyToDiv=document.getElementById(d.replyToDivId);\nthis._replyCcDiv=document.getElementById(d.replyCcDivId);\nthis._input=document.getElementById(d.replyInputId);\nthis._initialized=true\n}else{this.reset()\n}this._msg=g;\nvar f=(h==ZmOperation.REPLY_ALL&&b.participants[AjxEmailAddress.CC]);\nthis._replyToDiv.innerHTML=AjxTemplate.expand(this.TABLE_TEMPLATE,b.participants[AjxEmailAddress.TO]);\nthis._replyCcDiv.innerHTML=f?AjxTemplate.expand(this.TABLE_TEMPLATE,b.participants[AjxEmailAddress.CC]):\"\";\nDwt.setVisible(this._replyCcDiv,f);\nsetTimeout(this._resized.bind(this),0);\nvar c=this._convView.getMsgViewIndex(e);\nc=this._index=(c!=-1)?c+1:null;\nthis.reparentHtmlElement(this._convView._messagesDiv,c);\ne.addClassName(\"Reply\");\ne._createBubbles();\nthis._msgView=e;\nthis.setVisible(true);\nDwt.scrollIntoView(this.getHtmlElement(),this._convView._messagesDiv);\nappCtxt.getKeyboardMgr().grabFocus(this._input)\n};\nZmConvReplyView.prototype.getAddresses=function(b){return this._addressInfo&&this._addressInfo.participants[b]&&this._addressInfo.participants[b].addresses\n};\nZmConvReplyView.prototype.getValue=function(){return this._input?this._input.value:\"\"\n};\nZmConvReplyView.prototype.getMsg=function(){return this._msg\n};\nZmConvReplyView.prototype.setValue=function(b){if(this._input){this._input.value=b\n}};\nZmConvReplyView.prototype.reset=function(){var b=this._msg&&this._convView._msgViews[this._msg.id];\nif(b){b.delClassName(\"Reply\")\n}this.setValue(\"\");\nthis.setVisible(false);\nthis._msg=null\n};\nZmConvReplyView.prototype._initializeToolbar=function(){if(!this._replyToolbar){var c=[ZmOperation.SEND,ZmOperation.CANCEL,ZmOperation.FILLER];\nvar e={};\ne[ZmOperation.CANCEL]={tooltipKey:\"cancel\",shortcut:null};\nvar d={parent:this,buttons:c,overrides:e,posStyle:DwtControl.STATIC_STYLE,buttonClassName:\"DwtToolbarButton\",context:ZmId.VIEW_CONV2,toolbarType:ZmId.TB_REPLY};\nvar b=this._replyToolbar=new ZmButtonToolBar(d);\nb.addSelectionListener(ZmOperation.SEND,this._convView._sendListener.bind(this._convView));\nb.addSelectionListener(ZmOperation.CANCEL,this._convView._cancelListener.bind(this._convView))\n}};\nZmConvReplyView.prototype._getReplyAddressInfo=function(d,k,j){var e=ZmComposeView.getReplyAddresses(j,d,d);\nvar o={};\no.shortAddress=appCtxt.get(ZmSetting.SHORT_ADDRESS);\nvar n={};\nvar b=[],g={};\nfor(var f=0;\nf<ZmConvReplyView.ADDR_TYPES.length;\nf++){var m=ZmConvReplyView.ADDR_TYPES[f];\nvar l=e[m];\nif(l&&l.length>0){b.push(m);\nvar h=AjxStringUtil.htmlEncode(ZmMsg[AjxEmailAddress.TYPE_STRING[m]]);\nvar c=k.getAddressesFieldInfo(l,o,m,this._htmlElId);\ng[m]={addresses:l,prefix:h,partStr:c.html};\nif(c.showMoreLinkId){n[c.showMoreLinkId]=true\n}}}return{addressTypes:b,participants:g,showMoreIds:n}\n};\nZmConvReplyView.prototype._addAddresses=function(g,f,e,d){var b=e.getArray();\nfor(var c=0;\nc<b.length;\nc++){var h=b[c];\nif(h&&h.address){if(!d||!d[h.address]){g[f].push(h)\n}if(d){d[h.address]=true\n}}}};\nZmConvReplyView.prototype._resized=function(){var b=this.boundsForChild(this._input);\nDwt.setSize(this._input,b.width,Dwt.CLEAR)\n};\nZmMailMsgCapsuleView=function(b){this._normalClass=\"ZmMailMsgCapsuleView\";\nb.className=b.className||this._normalClass;\nthis._msgId=b.msgId;\nb.id=this._getViewId(b.sessionId);\nZmMailMsgView.call(this,b);\nthis._convView=this.parent;\nthis._controller=b.controller;\nthis._forceExpand=Boolean(b.forceExpand);\nthis._forceCollapse=Boolean(b.forceCollapse);\nthis._forceOriginal=b.forceOriginal&&!(DBG&&DBG.getDebugLevel()==\"orig\");\nthis._isDraft=b.isDraft;\nthis._index=b.index;\nthis._showingCalendar=false;\nthis._infoBarId=this._htmlElId;\nthis._browserToolTip=appCtxt.get(ZmSetting.BROWSER_TOOLTIPS_ENABLED);\nthis._linkClass=\"Link\";\nthis.setScrollStyle(Dwt.VISIBLE);\nthis._origContent={};\nthis.addListener(ZmInviteMsgView.REPLY_INVITE_EVENT,this._convView._inviteReplyListener);\nthis.addListener(ZmMailMsgView.SHARE_EVENT,this._convView._shareListener);\nthis.addListener(ZmMailMsgView.SUBSCRIBE_EVENT,this._convView._subscribeListener);\nthis.addListener(DwtEvent.ONFOCUS,ZmMailMsgCapsuleView.prototype.__onFocus.bind(this));\nthis.addListener(DwtEvent.ONBLUR,ZmMailMsgCapsuleView.prototype.__onBlur.bind(this))\n};\nZmMailMsgCapsuleView.prototype=new ZmMailMsgView;\nZmMailMsgCapsuleView.prototype.constructor=ZmMailMsgCapsuleView;\nZmMailMsgCapsuleView.prototype.isZmMailMsgCapsuleView=true;\nZmMailMsgCapsuleView.prototype.toString=function(){return\"ZmMailMsgCapsuleView\"\n};\nZmMailMsgCapsuleView.prototype._getViewId=function(c){var b=!c?\"\":this._standalone?ZmId.VIEW_CONV+c+\"_\":c+\"_\";\nreturn b+ZmId.VIEW_MSG_CAPSULE+this._msgId\n};\nZmMailMsgCapsuleView.prototype._getContainer=function(){return this._container\n};\nZmMailMsgCapsuleView.prototype._setHeaderClass=function(){var b=[this._normalClass];\nb.push(this._expanded?\"Expanded\":\"Collapsed\");\nif(this._isDraft){b.push(\"draft\")\n}if(this._lastCollapsed){b.push(\"Last\")\n}this.setClassName(b.join(\" \"))\n};\nZmMailMsgCapsuleView.prototype.set=function(d,c){if(this._controller.isSearchResults){this._expanded=this._isMatchingMsg=d.inHitList\n}else{this._expanded=!this._forceCollapse&&d.isUnread\n}this._isCalendarInvite=appCtxt.get(ZmSetting.CALENDAR_ENABLED)&&d.invite&&!d.invite.isEmpty();\nthis._expanded=this._expanded||this._forceExpand;\nif(this._expanded&&this._isCalendarInvite&&this._convView.inviteMsgsExpanded>=ZmConvView2.MAX_INVITE_MSG_EXPANDED){this._expanded=false;\nthis._forceExpand=false\n}if(this._expanded){this._convView._hasBeenExpanded[d.id]=true\n}this.setAttribute(\"aria-expanded\",Boolean(this._expanded));\nthis._setHeaderClass();\nvar b=null;\nvar e=appCtxt.get(ZmSetting.CONV_SHOW_CALENDAR);\nif(this._expanded){if(this._isCalendarInvite){this._convView.inviteMsgsExpanded++\n}b=this._handleShowCalendarLink.bind(this,ZmOperation.SHOW_ORIG,e)\n}ZmMailMsgView.prototype.set.apply(this,[d,c,b])\n};\nZmMailMsgCapsuleView.prototype.reset=function(){ZmMailMsgView.prototype.reset.call(this);\nif(this._header){this._header.dispose();\nthis._header=null\n}};\nZmMailMsgCapsuleView.prototype._resize=function(){this._resizePending=false;\nif(!this._expanded||!this._usingIframe){return\n}var c=this.getContentContainer();\nif(!c){return\n}var b=this._getHeightFromComputedStyle(c);\nb+=20;\nDwt.setSize(this.getIframeElement(),Dwt.DEFAULT,b)\n};\nZmMailMsgCapsuleView.prototype._getHeightFromComputedStyle=function(f){f.style.overflow=\"hidden\";\nvar g=DwtCssStyle.getComputedStyleObject(f),b=0;\nif(g&&g.height){var e=[\"height\",\"marginTop\",\"marginBottom\",\"paddingTop\",\"paddingBottom\"];\nfor(var c=0;\nc<e.length;\nc++){var j=e[c];\nvar d=parseInt(g[j]);\nb+=isNaN(d)?0:d\n}}f.style.overflow=\"\";\nif(AjxEnv.isGeckoBased&&f.style.cssText.length==0){f.removeAttribute(\"style\")\n}return b\n};\nZmMailMsgCapsuleView.prototype._resetIframeHeightOnTimer=function(){if(!this._resizePending){window.setTimeout(this._resize.bind(this),100);\nthis._resizePending=true\n}};\nZmMailMsgCapsuleView.prototype._renderMessage=function(c,b,d){c=this._msg;\nthis._clearBubbles();\nthis._createMessageHeader();\nif(this._expanded){this._renderMessageBodyAndFooter(c,b,d)\n}else{this._header.set(ZmMailMsgCapsuleViewHeader.COLLAPSED)\n}};\nZmMailMsgCapsuleView.prototype._createMessageHeader=function(){if(this._header){return\n}this._header=new ZmMailMsgCapsuleViewHeader({parent:this,id:[this._viewId,ZmId.MV_MSG_HEADER].join(\"_\")});\nthis._headerTabGroup.addMember(this._header)\n};\nZmMailMsgCapsuleView.prototype._renderMessageBodyAndFooter=function(d,b,e){if(!d.isLoaded()||this._showEntireMsg){var c={getHtml:appCtxt.get(ZmSetting.VIEW_AS_HTML),callback:this._handleResponseLoadMessage.bind(this,d,b,e),needExp:true,noTruncate:this._showEntireMsg,forceLoad:this._showEntireMsg,markRead:this._controller._handleMarkRead(d,true)};\nd.load(c);\nthis._showEntireMsg=false\n}else{this._handleResponseLoadMessage(d,b,e)\n}};\nZmMailMsgCapsuleView.prototype._handleResponseLoadMessage=function(c,b,e){if(this.isDisposed()){return\n}this._header.set(this._expanded?ZmMailMsgCapsuleViewHeader.EXPANDED:ZmMailMsgCapsuleViewHeader.COLLAPSED);\nvar d=this._handleResponseLoadMessage1.bind(this,c,b,e);\nthis._renderMessageBody(c,b,d)\n};\nZmMailMsgCapsuleView.prototype._handleResponseLoadMessage1=function(c,b,d){this._renderMessageFooter(c);\nif(appCtxt.get(ZmSetting.MARK_MSG_READ)!==ZmSetting.MARK_READ_NOW){this._controller._handleMarkRead(c)\n}if(d){d.run()\n}};\nZmMailMsgCapsuleView.prototype._useIframe=function(e,d,c){this._cleanedHtml=null;\nif(c){return true\n}if(e){return false\n}var b=AjxStringUtil.checkForCleanHtml(d,ZmMailMsgView.TRUSTED_TAGS,ZmMailMsgView.UNTRUSTED_ATTRS);\nif(!b.useIframe){this._cleanedHtml=b.html;\nthis._contentWidth=b.width;\nreturn false\n}else{this._cleanedHtml=b.html;\nreturn true\n}};\nZmMailMsgCapsuleView.prototype._renderMessageBody=function(d,c,p,i){this._addLine();\nthis._msgBodyDivId=[this._htmlElId,ZmId.MV_MSG_BODY].join(\"_\");\nvar g=AjxUtil.isDate(d.autoSendTime)?AjxDateFormat.getDateTimeInstance(AjxDateFormat.FULL,AjxDateFormat.MEDIUM).format(d.autoSendTime):null;\nif(g){var b=document.createElement(\"DIV\");\nb.id=this._autoSendHeaderId=this._msgBodyDivId+\"_autoSend\";\nb.innerHTML=AjxTemplate.expand(\"mail.Message#AutoSend\",{autoSendTime:g});\nthis.getHtmlElement().appendChild(b)\n}if(d.attrs){var n=[];\nfor(var k in ZmMailMsgView.displayAdditionalHdrsInMsgView){if(d.attrs[k]){n.push({hdrName:ZmMailMsgView.displayAdditionalHdrsInMsgView[k],hdrVal:d.attrs[k]})\n}}if(n.length){var b=document.createElement(\"DIV\");\nb.id=this._addedHeadersId=this._msgBodyDivId+\"_addedHeaders\";\nb.innerHTML=AjxTemplate.expand(\"mail.Message#AddedHeaders\",{additionalHdrs:n});\nthis.getHtmlElement().appendChild(b)\n}}var l=this._isCalendarInvite;\nvar m=this._isShareInvite=(appCtxt.get(ZmSetting.SHARING_ENABLED)&&d.share&&d.folderId!=ZmFolder.ID_TRASH&&appCtxt.getActiveAccount().id!=d.share.grantor.id&&(d.share.action==ZmShare.NEW||(d.share.action==ZmShare.EDIT&&!this.__hasMountpoint(d.share))));\nvar h=m&&d.share&&d.share.link&&!d.share.link.perm;\nvar j=d.subscribeReq&&d.folderId!=ZmFolder.ID_TRASH;\nif(!l){var f=this._msg.getAttachmentLinks(true,!appCtxt.get(ZmSetting.VIEW_AS_HTML),true).length;\nif(f>0){var b=document.createElement(\"DIV\");\nb.id=this._attLinksId;\nb.className=\"attachments\";\nthis.getHtmlElement().appendChild(b)\n}}if(l||j){ZmMailMsgView.prototype._renderMessageHeader.call(this,d,c,true)\n}var e={getHtml:appCtxt.get(ZmSetting.VIEW_AS_HTML),callback:ZmMailMsgView.prototype._renderMessageBody.bind(this,d,c,p,i),needExp:true};\nd.load(e);\nif(l){if(AjxEnv.isIE){Dwt.setSize(this._headerElement,this._header.getSize().x,Dwt.DEFAULT)\n}}if((m&&!h)||j){var q=this.getMsgBodyElement();\nvar o=m?this._getShareToolbar():this._getSubscribeToolbar(d.subscribeReq);\nif(o){o.reparentHtmlElement(q,0)\n}if(this._headerElement){q.insertBefore(this._headerElement.parentNode,q.firstChild)\n}}this._beenHere=true\n};\nZmMailMsgCapsuleView.prototype._getInviteSubs=function(b){ZmMailMsgView.prototype._getInviteSubs.apply(this,arguments);\nb.noTopHeader=true\n};\nZmMailMsgCapsuleView.prototype._addLine=function(){var b=document.createElement(\"div\");\nb.className=\"separator\";\nthis.getHtmlElement().appendChild(b)\n};\nZmMailMsgCapsuleView.prototype._getBodyContent=function(b){if(!b||!b.getContent()){return\"\"\n}var d=(b.ct==ZmMimeTable.TEXT_HTML);\nvar f=[b.part,b.contentType].join(\"|\");\nvar c=this._origContent[f];\nif(!c&&!this._forceOriginal&&!this._isMatchingMsg){c=AjxStringUtil.getOriginalContent(b.getContent(),d);\nif(c.length!=b.getContent().length){this._origContent[f]=c;\nthis._hasOrigContent=true\n}}var e=(this._showingQuotedText||this._forceOriginal||this._isMatchingMsg||!c)?b.getContent():c;\ne=e||\"\";\ne=d?AjxStringUtil.trimHtml(e):AjxStringUtil.trim(e);\nreturn e\n};\nZmMailMsgCapsuleView.prototype._renderMessageFooter=function(g,k){g=g||this._msg;\nvar c=this._footerId&&Dwt.byId(this._footerId);\nif(!c){c=document.createElement(\"div\");\nc.className=\"footer\";\nc.id=this._footerId=[this.getHTMLElId(),ZmId.MV_MSG_FOOTER].join(\"_\")\n}var b,m;\nif(this._isCalendarInvite){b=\"showCalendar\";\nm=this._handleShowCalendarLink\n}else{if(this._hasOrigContent){b=this._showingQuotedText?\"hideQuotedText\":\"showQuotedText\";\nm=this._handleShowTextLink\n}}var l=this._linkInfo={};\nvar o=appCtxt.isExternalAccount();\nl[ZmOperation.SHOW_ORIG]={key:b,handler:m,disabled:o};\nl[ZmOperation.DRAFT]={key:\"editDraft\",handler:this._handleEditDraftLink,op:ZmOperation.DRAFT,disabled:o};\nl[ZmOperation.REPLY]={key:\"reply\",handler:this._handleReplyLink,op:ZmOperation.REPLY,disabled:o};\nl[ZmOperation.REPLY_ALL]={key:\"replyAll\",handler:this._handleReplyLink,op:ZmOperation.REPLY_ALL,disabled:o};\nl[ZmOperation.FORWARD]={key:\"forward\",handler:this._handleForwardLink,op:ZmOperation.FORWARD,disabled:o};\nl[ZmOperation.ACTIONS_MENU]={key:\"moreActions\",handler:this._handleMoreActionsLink};\nl[ZmOperation.COMPOSE_OPTIONS]={key:\"moreComposeOptions\",handler:this._handleMoreOptionsLink,disabled:o};\nvar q;\nvar d=appCtxt.getById(g.folderId);\nif(d&&d.isFeed()){q=[ZmOperation.SHOW_ORIG,ZmOperation.FORWARD,ZmOperation.ACTIONS_MENU]\n}else{if(g.isDraft){q=[ZmOperation.SHOW_ORIG,ZmOperation.ACTIONS_MENU];\nif(!d.isReadOnly()){q=[].concat(ZmOperation.DRAFT,q)\n}}else{q=[ZmOperation.REPLY,ZmOperation.REPLY_ALL];\nif(k){q=(k===ZmOperation.REPLY)?[ZmOperation.REPLY_ALL]:[ZmOperation.REPLY]\n}q.unshift(ZmOperation.SHOW_ORIG);\nq.push(ZmOperation.FORWARD,ZmOperation.ACTIONS_MENU)\n}}if(k){q.push(ZmOperation.COMPOSE_OPTIONS)\n}var p=[];\nfor(var h=0;\nh<q.length;\nh++){var j=this._makeLink(q[h]);\nif(j){p.push(j)\n}}c.innerHTML=p.join(\"&nbsp;-&nbsp;\");\nthis.getHtmlElement().appendChild(c);\nthis._links=[];\nvar f=false;\nfor(var h=0;\nh<q.length;\nh++){var e=this._linkInfo[q[h]];\nvar n=e&&document.getElementById(e.linkId);\nif(n){this._makeFocusable(n);\nDwt.setHandler(n,DwtEvent.ONCLICK,this._linkClicked.bind(this,q[h],e.op));\nthis._footerTabGroup.addMember(n);\nn.noTab=f;\nthis._links.push(n);\nf=true\n}}this._handleShowCalendarLink(ZmOperation.SHOW_ORIG,appCtxt.get(ZmSetting.CONV_SHOW_CALENDAR))\n};\nZmMailMsgCapsuleView.prototype._makeLink=function(d){var b=this._linkInfo&&d&&this._linkInfo[d];\nif(!(b&&b.key&&b.handler)){return\"\"\n}var c=b.linkId=[this._footerId,b.key].join(\"_\");\nif(b.disabled){return\"<span id='\"+c+\"'>\"+ZmMsg[b.key]+\"</span>\"\n}return\"<a class='ConvLink Link' id='\"+c+\"'>\"+ZmMsg[b.key]+\"</a>\"\n};\nZmMailMsgCapsuleView.prototype._linkClicked=function(f,e,c){var d=this._linkInfo&&f&&this._linkInfo[f];\nvar b=(d&&!d.disabled)?d.handler:null;\nif(b){b.apply(this,[f,d.op,c])\n}};\nZmMailMsgCapsuleView.prototype._focusLink=function(e,b){var d;\nfor(var c=0;\nc<this._links.length;\nc++){if(this._links[c]===b){d=this._links[e?c-1:c+1];\nbreak\n}}if(d){appCtxt.getKeyboardMgr().grabFocus(d)\n}};\nZmMailMsgCapsuleView.prototype.__onFocus=function(b){if(!b||!b.target){return\n}Dwt.setOpacity(this._footerId,100)\n};\nZmMailMsgCapsuleView.prototype.__onBlur=function(b){if(!b||!b.target){return\n}var c=Dwt.byId(this._footerId);\nif(c){c.style.opacity=null\n}};\nZmMailMsgCapsuleView.prototype._handleShowTextLink=function(e,d,b){var c=this._msg;\nthis.reset();\nthis._showingQuotedText=!this._showingQuotedText;\nthis._forceExpand=true;\nthis.set(c,true)\n};\nZmMailMsgCapsuleView.prototype._handleShowCalendarLink=function(h,b){if(!this._isCalendarInvite){return\n}var c=this._linkInfo&&document.getElementById(this._linkInfo[ZmOperation.SHOW_ORIG].linkId);\nif(b!==undefined){this._showingCalendar=b\n}else{this._showingCalendar=!this._showingCalendar;\nappCtxt.set(ZmSetting.CONV_SHOW_CALENDAR,this._showingCalendar)\n}var f=this._inviteMsgView;\nif(!this._inviteCalendarContainer&&f){var e=f&&f._dayView;\nif(e&&c){var g=this._inviteCalendarContainer=document.createElement(\"div\");\nvar d=this.getHtmlElement();\nif(d){d.appendChild(g);\nDwt.setSize(g,Dwt.DEFAULT,220);\nDwt.setPosition(g,Dwt.RELATIVE_STYLE);\ne.reparentHtmlElement(g);\ne.setVisible(true);\nf.convResize()\n}}}if(this._inviteCalendarContainer){Dwt.setVisible(this._inviteCalendarContainer,this._showingCalendar)\n}if(f&&this._showingCalendar){f.scrollToInvite()\n}if(c){c.innerHTML=this._showingCalendar?ZmMsg.hideCalendar:ZmMsg.showCalendar\n}this._resetIframeHeightOnTimer()\n};\nZmMailMsgCapsuleView.prototype._handleForwardLink=function(f,e,c){var d=\"\",b=this._convView._replyView;\nif(b){d=b.getValue();\nb.reset()\n}this._controller._doAction({action:e,msg:this._msg,extraBodyText:d})\n};\nZmMailMsgCapsuleView.prototype._handleMoreActionsLink=function(g,f,c){c=DwtUiEvent.getEvent(c);\nvar b=c.clientX,e=c.clientY;\nif(!b||!e){var d=Dwt.getLocation(DwtUiEvent.getTarget(c));\nif(d){b=d.x;\ne=d.y\n}}c.docX=b;\nc.docY=e;\nthis._actionListener(c,true)\n};\nZmMailMsgCapsuleView.prototype._handleReplyLink=function(e,d,b,c){if(!c&&!this._controller.popShield(null,this._handleReplyLink.bind(this,e,d,b,true))){return\n}this._convView.setReply(this._msg,this,d);\nthis._renderMessageFooter(this._msg,d)\n};\nZmMailMsgCapsuleView.prototype._handleMoreOptionsLink=function(b){this._convView._compose({msg:this._msg,action:this.action});\nthis._convView._replyView.reset();\nthis._renderMessageFooter(this._msg)\n};\nZmMailMsgCapsuleView.prototype._handleEditDraftLink=function(d,c,b){this._controller._doAction({action:c,msg:this._msg})\n};\nZmMailMsgCapsuleView.prototype.isExpanded=function(){return this._expanded\n};\nZmMailMsgCapsuleView.prototype._toggleExpansion=function(){var b=!this._expanded;\nif(!b&&!this._controller.popShield(null,this._setExpansion.bind(this,false))){return\n}this._setExpansion(b);\nthis._resetIframeHeightOnTimer()\n};\nZmMailMsgCapsuleView.prototype._setExpansion=function(g){if(this.isDisposed()){return\n}if(Dwt.isAncestor(this.getHtmlElement(),document.activeElement)){this.getHtmlElement().focus()\n}var j=appCtxt.get(ZmSetting.CONV_SHOW_CALENDAR);\nthis._expanded=g;\nthis.setAttribute(\"aria-expanded\",Boolean(this._expanded));\nif(this._expanded&&!this._msgBodyCreated){var f=null;\nif(this._isCalendarInvite){f=this._handleShowCalendarLink.bind(this,ZmOperation.SHOW_ORIG,j)\n}var k=this._handleResponseSetExpansion.bind(this,this._msg,f);\nthis._renderMessage(this._msg,null,k)\n}else{var c=this.getHtmlElement().childNodes;\nfor(var d=0;\nd<c.length;\nd++){var b=c[d];\nif(b===this._header.getHtmlElement()){continue\n}var h=(b&&b.id===this._displayImagesId)?this._expanded&&this._needToShowInfoBar:this._expanded;\nDwt.setVisible(b,h)\n}this._header.set(this._expanded?ZmMailMsgCapsuleViewHeader.EXPANDED:ZmMailMsgCapsuleViewHeader.COLLAPSED);\nif(this._expanded){this._setTags(this._msg);\nthis._controller._handleMarkRead(this._msg);\nappCtxt.notifyZimlets(\"onMsgExpansion\",[this._msg,this])\n}else{var e=this._convView._replyView;\nif(e&&e._msg==this._msg){e.reset()\n}}this._convView._header._setExpandIcon();\nif(this._expanded&&this._isCalendarInvite){this._handleShowCalendarLink(ZmOperation.SHOW_ORIG,j)\n}}if(this._expanded){this._createBubbles();\nif(this._controller._checkKeepReading){this._controller._checkKeepReading()\n}this._lastCollapsed=false\n}this._setHeaderClass();\nthis._resetIframeHeightOnTimer()\n};\nZmMailMsgCapsuleView.prototype._handleResponseSetExpansion=function(b,c){this._handleResponseSet(b,null,c);\nthis._convView._header._setExpandIcon()\n};\nZmMailMsgCapsuleView.prototype._insertTagRow=function(e,d){if(!e){return\n}var f=e.insertRow(-1);\nvar b;\nf.id=this._tagRowId;\nb=f.insertCell(-1);\nb.className=\"LabelColName\";\nb.innerHTML=ZmMsg.tags+\":\";\nb.style.verticalAlign=\"middle\";\nvar c=f.insertCell(-1);\nc.className=\"LabelColValue\";\nc.id=d;\nb=f.insertCell(-1);\nb.style.align=\"right\";\nb.innerHTML=\"&nbsp;\";\nreturn c\n};\nZmMailMsgCapsuleView.prototype._selectionListener=function(e){this._toggleExpansion();\nvar d=this._convView,c=d._lastCollapsedId&&d._msgViews[d._lastCollapsedId];\nif(c){c._lastCollapsed=false;\nc._setHeaderClass()\n}var b=!this.isExpanded();\nthis._lastCollapsed=b;\nd._lastCollapsedId=b&&this._msgId;\nthis._setHeaderClass();\nreturn true\n};\nZmMailMsgCapsuleView.prototype._actionListener=function(c,d){var g=this._header;\nvar b=DwtUiEvent.getTargetWithProp(c,\"id\",false,g._htmlElId);\nif(d||(b==g.getHtmlElement())){var e=DwtUiEvent.getTarget(c);\nvar f=this._objectManager;\nif(f&&!AjxUtil.isBoolean(f)&&f._findObjectSpan(e)){return\n}this._convView._setSelectedMsg(this._msg);\nthis._controller._listActionListener.call(this._controller,c);\nreturn true\n}return false\n};\nZmMailMsgCapsuleView.prototype._isStandalone=function(){return this.parent._isStandalone()\n};\nZmMailMsgCapsuleView.prototype._msgChangeListener=function(b){};\nZmMailMsgCapsuleView.prototype._handleChange=function(e){if(e.type!=ZmEvent.S_MSG){return\n}if(this.isDisposed()){return\n}if(e.event==ZmEvent.E_FLAGS){var c=e.getDetail(\"flags\");\nfor(var d=0;\nd<c.length;\nd++){var b=c[d];\nif(b==ZmItem.FLAG_UNREAD){this._header._setReadIcon();\nthis._header._setHeaderClass();\nthis._convView._header._setInfo()\n}}}else{if(e.event==ZmEvent.E_DELETE){this.dispose();\nthis._convView._removeMessageView(this._msg.id);\nthis._convView._header._setInfo()\n}else{if(e.event==ZmEvent.E_MOVE){this._changeFolderName(e.getDetail(\"oldFolderId\"))\n}else{if(e.event==ZmEvent.E_TAGS||e.event==ZmEvent.E_REMOVE_ALL){this._setTags(this._msg)\n}}}}};\nZmMailMsgCapsuleView.prototype._changeFolderName=function(c){var d=this._msg;\nvar b=appCtxt.getById(d.folderId);\nif(b&&(b.nId==ZmFolder.ID_TRASH||c==ZmFolder.ID_TRASH)){this._header._setHeaderClass(d)\n}};\nZmMailMsgCapsuleView.prototype._handleMsgTruncated=function(){this._msg.viewEntireMessage=true;\nthis._showEntireMsg=true;\nif(this._inviteMsgView){this._inviteMsgView._dayView=null;\nthis._inviteCalendarContainer=null\n}this._forceExpand=true;\nthis.set(this._msg,true);\nDwt.setVisible(this._msgTruncatedId,false)\n};\nZmMailMsgCapsuleView.prototype.isTruncated=function(b){return(!this._hasOrigContent||this._showingQuotedText)?b.isTruncated:false\n};\nZmMailMsgCapsuleView.prototype._getIframeTitle=function(){return AjxMessageFormat.format(ZmMsg.messageTitleInConv,this._index+1)\n};\nZmMailMsgCapsuleViewHeader=function(d){this._normalClass=\"Conv2MsgHeader\";\nd.posStyle=DwtControl.RELATIVE_STYLE;\nd.className=d.className||this._normalClass;\nDwtControl.call(this,d);\nthis._setEventHdlrs([DwtEvent.ONMOUSEDOWN,DwtEvent.ONMOUSEMOVE,DwtEvent.ONMOUSEUP,DwtEvent.ONDBLCLICK]);\nthis._msgView=this.parent;\nthis._convView=this.parent._convView;\nthis._msg=this.parent._msg;\nthis._controller=this.parent._controller;\nthis._browserToolTip=this.parent._browserToolTip;\nif(this._controller.supportsDnD()){var c=new DwtDragSource(Dwt.DND_DROP_MOVE);\nc.addDragListener(this._dragListener.bind(this));\nthis.setDragSource(c);\nvar b=this._dropTgt=new DwtDropTarget(\"ZmTag\");\nb.addDropListener(this._dropListener.bind(this));\nthis.setDropTarget(b)\n}this.addListener(DwtEvent.ONDBLCLICK,this._dblClickListener);\nthis.addListener(DwtEvent.ONMOUSEUP,this._mouseUpListener.bind(this));\nthis.setScrollStyle(DwtControl.CLIP)\n};\nZmMailMsgCapsuleViewHeader.prototype=new DwtControl;\nZmMailMsgCapsuleViewHeader.prototype.constructor=ZmMailMsgCapsuleViewHeader;\nZmMailMsgCapsuleViewHeader.prototype.isZmMailMsgCapsuleViewHeader=true;\nZmMailMsgCapsuleViewHeader.prototype.toString=function(){return\"ZmMailMsgCapsuleViewHeader\"\n};\nZmMailMsgCapsuleViewHeader.prototype.isFocusable=true;\nZmMailMsgCapsuleViewHeader.prototype.role=\"header\";\nZmMailMsgCapsuleViewHeader.COLLAPSED=\"Collapsed\";\nZmMailMsgCapsuleViewHeader.EXPANDED=\"Expanded\";\nZmMailMsgCapsuleViewHeader.prototype.set=function(f,e){if(!e&&f==this._state){return\n}var k=!!this._state;\nf=this._state=f||this._state;\nvar d=(f==ZmMailMsgCapsuleViewHeader.EXPANDED);\nvar n=this._htmlElId;\nvar g=this._msg;\nvar q=this._msgView._getAddrInfo(g);\nthis._showMoreIds=q.showMoreIds;\nvar h=appCtxt.getById(g.folderId);\ng.showImages=g.showImages||(h&&h.isFeed());\nthis._idToAddr={};\nthis._dateCellId=n+\"_dateCell\";\nvar r=g.sentDate||g.date;\nvar i=AjxDateFormat.getDateTimeInstance(AjxDateFormat.LONG,AjxDateFormat.SHORT);\nvar s=i.format(new Date(r));\nthis._readIconId=n+\"_read\";\nthis._readCellId=n+\"_readCell\";\nvar m;\nvar p={readCellId:this._readCellId,date:s,dateCellId:this._dateCellId};\nvar l=d?48:32,o=q.sentByContact&&q.sentByContact.getImageUrl(l,l),b=o&&q.sentByContact&&q.sentByContact.getFullName();\nif(!d){var j=n+\"_0\";\nthis._idToAddr[j]=q.fromAddr;\nAjxUtil.hashUpdate(p,{imageURL:o||ZmZimbraMail.DEFAULT_CONTACT_ICON_SMALL,defaultImageUrl:ZmZimbraMail.DEFAULT_CONTACT_ICON_SMALL,imageAltText:b||ZmMsg.unknownPerson,from:q.from,fromId:j,fragment:AjxStringUtil.htmlEncode(g.fragment),isInvite:this.parent._isCalendarInvite});\nm=AjxTemplate.expand(\"mail.Message#Conv2MsgHeader-collapsed\",p)\n}else{AjxUtil.hashUpdate(p,{hdrTableId:this._msgView._hdrTableId=n+\"_hdrTable\",imageURL:o||ZmZimbraMail.DEFAULT_CONTACT_ICON,defaultImageUrl:ZmZimbraMail.DEFAULT_CONTACT_ICON,imageAltText:b||ZmMsg.unknownPerson,sentBy:q.sentBy,sentByAddr:q.sentByAddr,obo:q.obo,oboAddr:q.oboAddr,oboId:n+ZmId.CMP_OBO_SPAN,bwo:q.bwo,bwoAddr:q.bwoAddr,bwoId:n+ZmId.CMP_BWO_SPAN,addressTypes:q.addressTypes,participants:q.participants,isOutDated:g.invite&&g.invite.isEmpty()});\nm=AjxTemplate.expand(\"mail.Message#Conv2MsgHeader-expanded\",p)\n}this.setContent(m);\nthis._setHeaderClass();\nthis._setReadIcon();\nfor(var n in this._showMoreIds){var c=document.getElementById(n);\nif(c){c.notoggle=1\n}}};\nZmMailMsgCapsuleViewHeader.prototype.getToolTipContent=function(e){var c=DwtUiEvent.getTargetWithProp(e,\"id\");\nif(c&&c.id){var g=c.id;\nif(!g){return\"\"\n}var f=this._idToAddr[g];\nif(f){var d={address:f,ev:e,noRightClick:true};\nvar b=new AjxCallback(this,function(h){appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,d,h)\n});\nreturn{callback:b}\n}}};\nZmMailMsgCapsuleViewHeader.prototype.getTooltipBase=function(b){return b?DwtUiEvent.getTargetWithProp(b.object,\"id\"):DwtControl.prototype.getTooltipBase.apply(this,arguments)\n};\nZmMailMsgCapsuleViewHeader.prototype._setHeaderClass=function(){var d=this._msg;\nvar b=[this._normalClass];\nvar c=appCtxt.getById(d.folderId);\nif(c&&c.isInTrash()){b.push(\"Trash\")\n}if(d.isUnread&&!d.isMute){b.push(\"Unread\")\n}this.setClassName(b.join(\" \"))\n};\nZmMailMsgCapsuleViewHeader.prototype._setReadIcon=function(){var e=document.getElementById(this._readCellId);\nif(e){var f=(this._state==ZmMailMsgCapsuleViewHeader.EXPANDED);\nvar d=this._msg.isUnread?ZmMsg.markAsRead:ZmMsg.markAsUnread;\nvar c=\"id='\"+this._readIconId+\"' noToggle=1 title='\"+d+\"'\";\nvar b=AjxEnv.isIE?\"position:static\":null;\ne.innerHTML=AjxImg.getImageHtml(this._msg.getReadIcon(),f?b:\"display:inline-block\",c)\n}};\nZmMailMsgCapsuleViewHeader.prototype._mouseUpListener=function(d){var f=this._msgView;\nvar b=f._convView;\nvar e=DwtUiEvent.getTarget(d);\nif(e&&e.id==this._readIconId){var c=appCtxt.getById(this._msg.folderId);\nif(!(c&&c.isReadOnly())){this._controller._doMarkRead([this._msg],this._msg.isUnread)\n}return true\n}else{if(DwtUiEvent.getTargetWithProp(d,\"notoggle\")){return false\n}}if(d.button==DwtMouseEvent.LEFT){return f._selectionListener(d)\n}else{if(d.button==DwtMouseEvent.RIGHT){return f._actionListener(d)\n}}};\nZmMailMsgCapsuleViewHeader.prototype._dragListener=function(b){if(b.action==DwtDragEvent.SET_DATA){b.srcData={data:this._msg,controller:this._controller}\n}};\nZmMailMsgCapsuleViewHeader.prototype._getDragProxy=function(d){var b=this._msgView;\nvar c=ZmMailMsgListView.prototype._createItemHtml.call(this._controller._mailListView,b._msg,{now:new Date(),isDragProxy:true});\nDwt.setPosition(c,Dwt.ABSOLUTE_STYLE);\nappCtxt.getShell().getHtmlElement().appendChild(c);\nDwt.setZIndex(c,Dwt.Z_DND);\nreturn c\n};\nZmMailMsgCapsuleViewHeader.prototype._dropListener=function(e){var d=this._msg;\nvar f=e.srcData.data;\nif(e.action==DwtDropEvent.DRAG_ENTER){e.doIt=(d&&d.isZmItem&&!d.isReadOnly()&&this._dropTgt.isValidTarget(f));\nif(appCtxt.multiAccounts){var c=d?d.getAccount().id:null;\nvar b=(f.account&&f.account.id)||f[0].account.id;\nif(c!=b){e.doIt=false\n}}}else{if(e.action==DwtDropEvent.DRAG_DROP){this._controller._doTag([d],f,true)\n}}};\nZmMailMsgCapsuleViewHeader.prototype._dblClickListener=function(b){var c=b.dwtObj&&b.dwtObj.parent&&b.dwtObj.parent._msg;\nif(c){AjxDispatcher.run(\"GetMsgController\",c.nId).show(c,this._controller,null,true)\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmRecipients\")){ZmRecipients=function(b){this._divId={};\nthis._buttonTdId={};\nthis._fieldId={};\nthis._using={};\nthis._button={};\nthis._field={};\nthis._divEl={};\nthis._addrInputField={};\nthis._resetContainerSize=b.resetContainerSizeMethod;\nthis._enableContainerInputs=b.enableContainerInputs;\nthis._reenter=b.reenter;\nthis._contactPopdownListener=b.contactPopdownListener;\nthis._contextId=b.contextId;\nthis._bubbleOps={};\nthis._bubbleOps[AjxEmailAddress.TO]=ZmOperation.MOVE_TO_TO;\nthis._bubbleOps[AjxEmailAddress.CC]=ZmOperation.MOVE_TO_CC;\nthis._bubbleOps[AjxEmailAddress.BCC]=ZmOperation.MOVE_TO_BCC;\nthis._opToField={};\nthis._opToField[ZmOperation.MOVE_TO_TO]=AjxEmailAddress.TO;\nthis._opToField[ZmOperation.MOVE_TO_CC]=AjxEmailAddress.CC;\nthis._opToField[ZmOperation.MOVE_TO_BCC]=AjxEmailAddress.BCC\n};\nZmRecipients.OP={};\nZmRecipients.OP[AjxEmailAddress.TO]=ZmId.CMP_TO;\nZmRecipients.OP[AjxEmailAddress.CC]=ZmId.CMP_CC;\nZmRecipients.OP[AjxEmailAddress.BCC]=ZmId.CMP_BCC;\nZmRecipients.BAD=\"_bad_addrs_\";\nZmRecipients.prototype.attachFromSelect=function(b){this._fromSelect=b\n};\nZmRecipients.prototype.createRecipientIds=function(d,b){var e={};\nvar f=[\"row\",\"picker\",\"control\",\"cell\"];\nfor(var c=0;\nc<f.length;\nc++){e[f[c]]=[d,b,f[c]].join(\"_\")\n}return e\n};\nZmRecipients.prototype.createRecipientHtml=function(n,w,g,f){this._fieldNames=f;\nvar l=appCtxt.get(ZmSetting.CONTACTS_ENABLED);\nvar h=appCtxt.get(ZmSetting.GAL_ENABLED);\nif(l||h||appCtxt.isOffline){var x={dataClass:appCtxt.getAutocompleter(),matchValue:ZmAutocomplete.AC_VALUE_FULL,keyUpCallback:this._acKeyupHandler.bind(this),contextId:this._contextId};\nthis._acAddrSelectList=new ZmAutocompleteListView(x)\n}var o=l||h||appCtxt.multiAccounts;\nthis._pickerButton={};\nfor(var u=0;\nu<f.length;\nu++){var e=f[u];\nvar p=AjxEmailAddress.TYPE_STRING[e];\nvar t=this.createRecipientIds(g,p);\nthis._divId[e]=t.row;\nthis._buttonTdId[e]=t.picker;\nvar s=this._fieldId[e]=t.control;\nvar m=AjxMessageFormat.format(ZmMsg.addressFieldLabel,ZmMsg[AjxEmailAddress.TYPE_STRING[this._fieldNames[u]]]);\nthis._divEl[e]=document.getElementById(this._divId[e]);\nvar r;\nvar v={parent:n,autocompleteListView:this._acAddrSelectList,bubbleAddedCallback:this._bubblesChangedCallback.bind(this),bubbleRemovedCallback:this._bubblesChangedCallback.bind(this),bubbleMenuCreatedCallback:this._bubbleMenuCreated.bind(this),bubbleMenuResetOperationsCallback:this._bubbleMenuResetOperations.bind(this),inputId:s,label:m,type:e};\nvar j=this._addrInputField[e]=new ZmAddressInputField(v);\nr=j._htmlElId;\nj.reparentHtmlElement(t.cell);\nvar d=this._field[e]=document.getElementById(this._fieldId[e]);\nif(d){d.addrType=e;\nd.supportsAutoComplete=true\n}if(o){if(!l){appCtxt.getAppController()._createApp(ZmApp.CONTACTS)\n}var c=this._buttonTdId[e];\nvar q=document.getElementById(c);\nif(q){var k=ZmId.getButtonId(w,ZmRecipients.OP[e]);\nvar b=this._pickerButton[e]=new DwtButton({parent:n,id:k});\nb.setText(q.innerHTML);\nb.replaceElement(q);\nb.addSelectionListener(this.addressButtonListener.bind(this));\nb.addrType=e;\nthis._acAddrSelectList.handle(d,r);\nthis._button[e]=b\n}}else{d.supportsAutoComplete=false\n}}};\nZmRecipients.prototype.reset=function(){for(var c=0;\nc<this._fieldNames.length;\nc++){var d=this._fieldNames[c];\nvar b=this._field[d];\nb.value=\"\";\nvar e=this._addrInputField[d];\nif(e){e.clear()\n}}};\nZmRecipients.prototype.resetPickerButtons=function(f){var e=window.parentAppCtxt||window.appCtxt;\nvar d=e.get(ZmSetting.CONTACTS_ENABLED,null,f)||e.get(ZmSetting.GAL_ENABLED,null,f);\nfor(var c in this._pickerButton){var b=this._pickerButton[c];\nb.setEnabled(d)\n}};\nZmRecipients.prototype.setup=function(){if(this._field[AjxEmailAddress.TO]){this._showAddressField(AjxEmailAddress.TO,true,true,true)\n}if(this._field[AjxEmailAddress.CC]){this._showAddressField(AjxEmailAddress.CC,true,true,true)\n}if(this._field[AjxEmailAddress.BCC]){this._showAddressField(AjxEmailAddress.BCC,false,true,true)\n}};\nZmRecipients.prototype.getPicker=function(b){return this._pickerButton[b]\n};\nZmRecipients.prototype.getField=function(b){return document.getElementById(this._fieldId[b])\n};\nZmRecipients.prototype.getUsing=function(b){return this._using[b]\n};\nZmRecipients.prototype.getACAddrSelectList=function(){return this._acAddrSelectList\n};\nZmRecipients.prototype.getTabGroupMember=function(){var d=new DwtTabGroup(\"ZmRecipients\");\nfor(var b=0;\nb<ZmMailMsg.COMPOSE_ADDRS.length;\nb++){var c=ZmMailMsg.COMPOSE_ADDRS[b];\nd.addMember(this.getPicker(c));\nd.addMember(this.getAddrInputField(c).getTabGroupMember())\n}return d\n};\nZmRecipients.prototype.getAddrInputField=function(b){return this._addrInputField[b]\n};\nZmRecipients.prototype.addAddresses=function(j,b,l){var k=false;\nl=l||{};\nvar e=[];\nvar d=AjxUtil.toArray(b);\nif(d&&d.length){for(var c=0,f=d.length;\nc<f;\nc++){var h=d[c];\nvar g=h.isAjxEmailAddress?h&&h.getAddress():h;\nif(!g){continue\n}g=g.toLowerCase();\nif(!l[g]){this.setAddress(j,h);\nl[g]=true;\nk=true\n}}}return k\n};\nZmRecipients.prototype.setAddress=function(c,f){f=f||\"\";\nvar e=f.isAjxEmailAddress?f.toString():f;\nif(e.length&&!this._using[c]){this._using[c]=true;\nthis._showAddressField(c,true)\n}var d=this._addrInputField[c];\nif(!e){d.clear()\n}else{if(f.isAjxEmailAddress){var b={isDL:f.isGroup&&f.canExpand,email:e};\nd.addBubble({address:e,match:b,skipNotify:true,noFocus:true})\n}else{this._setAddrFieldValue(c,e)\n}}};\nZmRecipients.prototype.getRawAddrFields=function(){var d={};\nfor(var b=0;\nb<this._fieldNames.length;\nb++){var c=this._fieldNames[b];\nif(this._using[c]){d[c]=this.getAddrFieldValue(c)\n}}return d\n};\nZmRecipients.prototype.getAddrFields=function(){var d=[];\nfor(var b=0;\nb<this._fieldNames.length;\nb++){var c=this._fieldNames[b];\nif(this._using[c]){d.push(this._field[c])\n}}return d\n};\nZmRecipients.prototype.collectAddrs=function(){var e={};\ne[ZmRecipients.BAD]=new AjxVector();\nfor(var c=0;\nc<this._fieldNames.length;\nc++){var d=this._fieldNames[c];\nif(!this._field[d]){continue\n}var f=this.getAddrFieldValue(d);\nif(f.length==0){continue\n}f=f.replace(/[; ,]+$/,\"\");\nvar b=AjxEmailAddress.parseEmailString(f,d,false);\nif(b.all.size()==0){continue\n}e.gotAddress=true;\ne[d]=b;\nif(b.bad.size()){e[ZmRecipients.BAD].addList(b.bad);\nif(!e.badType){e.badType=d\n}}}return e\n};\nZmRecipients.prototype.getAddrFieldValue=function(b){var c=this._addrInputField[b];\nreturn c?c.getValue():\"\"\n};\nZmRecipients.prototype.enableInputs=function(b){for(var c=0;\nc<this._fieldNames.length;\nc++){this._field[this._fieldNames[c]].disabled=!b\n}};\nZmRecipients.prototype.addressButtonListener=function(l,g){if(appCtxt.isWebClientOffline()){return\n}var c=l?DwtControl.getTargetControl(l):null;\nif(this._enableContainerInputs){this._enableContainerInputs(false)\n}if(!this._contactPicker){AjxDispatcher.require(\"ContactsCore\");\nvar b=[];\nfor(var d=0;\nd<this._fieldNames.length;\nd++){b[d]={id:this._fieldNames[d],label:ZmMsg[AjxEmailAddress.TYPE_STRING[this._fieldNames[d]]]}\n}this._contactPicker=new ZmContactPicker(b);\nthis._contactPicker.registerCallback(DwtDialog.OK_BUTTON,this._contactPickerOkCallback,this);\nthis._contactPicker.registerCallback(DwtDialog.CANCEL_BUTTON,this._contactPickerCancelCallback,this)\n}var m=c?c.addrType:g;\nvar f={};\nfor(var d=0;\nd<this._fieldNames.length;\nd++){var k=this._fieldNames[d];\nf[k]=this._addrInputField[k].getAddresses(true)\n}if(this._contactPopdownListener){this._contactPicker.addPopdownListener(this._contactPopdownListener)\n}var j=(this._field[m].value&&!(f[m]&&f[m].length))?this._field[m].value:\"\";\nvar e;\nif(appCtxt.multiAccounts&&this._fromSelect){var h=this._fromSelect.getSelectedOption().addr;\ne=appCtxt.accountList.getAccountByEmail(h.address)\n}this._contactPicker.popup(m,f,j,e)\n};\nZmRecipients.prototype._showAddressField=function(d,b,c,e){this._using[d]=b;\nDwt.setVisible(this._divEl[d],b);\nthis._setAddrFieldValue(d,\"\");\nthis._field[d].noTab=!b;\nthis._addrInputField[d].noTab=!b;\nif(this._pickerButton[d]){this._pickerButton[d].noTab=!b\n}if(this._resetContainerSize){this._resetContainerSize()\n}};\nZmRecipients.prototype._acKeyupHandler=function(f,c,b,e){var d=DwtKeyEvent.getCharCode(f);\nif(b&&e&&(f.inputLengthChanged||(DwtKeyEvent.IS_RETURN[d]||d===DwtKeyEvent.KEY_BACKSPACE||d===DwtKeyEvent.KEY_DELETE||(AjxEnv.isMac&&d===DwtKeyEvent.KEY_COMMAND)))){e.value=e.value&&e.value.replace(/;([^\\s])/g,function(g,h){return\"; \"+h\n})||\"\"\n}};\nZmRecipients.prototype._bubblesChangedCallback=function(){if(this._resetContainerSize){this._resetContainerSize()\n}};\nZmRecipients.prototype._bubbleMenuCreated=function(f,e){this._bubbleActionMenu=e;\nif(this._fieldNames.length>1){e.addOp(ZmOperation.SEP);\nvar d=new AjxListener(this,this._bubbleMove);\nfor(var b=0;\nb<this._fieldNames.length;\nb++){var c=this._fieldNames[b];\nvar g=this._bubbleOps[c];\ne.addOp(g);\ne.addSelectionListener(g,d)\n}}};\nZmRecipients.prototype._bubbleMenuResetOperations=function(f,e){var d=f.getSelection();\nfor(var b=0;\nb<this._fieldNames.length;\nb++){var c=this._fieldNames[b];\nvar g=this._bubbleOps[c];\ne.enable(g,d.length>0&&(c!=f.type))\n}};\nZmRecipients.prototype._bubbleMove=function(f){var j=ZmAddressInputField.menuContext.addrInput;\nvar h=f&&f.item&&f.item.getData(ZmOperation.KEY_ID);\nvar e=this._opToField[h];\nvar c=this._addrInputField[e];\nif(j&&c){var g=j.getSelection();\nif(g.length){for(var d=0;\nd<g.length;\nd++){var b=g[d];\nthis._showAddressField(e,true);\nc.addBubble({bubble:b});\nj.removeBubble(b.id)\n}}}};\nZmRecipients.prototype._setAddrFieldValue=function(b,c){var d=this._addrInputField[b];\nif(d){d.setValue(c,true)\n}};\nZmRecipients.prototype._setEventHandler=function(f,b,d){var c=document.getElementById(f);\nc._recipients=this;\nif(d){c._addrType=d\n}var e=b.toLowerCase();\nc[e]=ZmRecipients[\"_\"+b]\n};\nZmRecipients._onFocus=function(c){c=DwtUiEvent.getEvent(c);\nvar b=DwtUiEvent.getTargetWithProp(c,\"id\");\nif(!b){return true\n}var d=appCtxt.getKeyboardMgr();\nif(d.__currTabGroup){d.__currTabGroup.setFocusMember(b)\n}};\nZmRecipients.prototype._contactPickerOkCallback=function(f){if(this._enableContainerInputs){this._enableContainerInputs(true)\n}for(var b=0;\nb<this._fieldNames.length;\nb++){var e=this._fieldNames[b];\nthis.setAddress(e,\"\");\nvar d=(this._fieldNames.length==1)?f:f[e];\nvar c=ZmRecipients.expandAddrs(d);\nthis.addAddresses(e,c)\n}this._bubblesChangedCallback();\nif(this._contactPopdownListener){this._contactPicker.removePopdownListener(this._contactPopdownListener)\n}this._contactPicker.popdown();\nif(this._reenter){this._reenter()\n}};\nZmRecipients.expandAddrs=function(f){var e=[];\nvar b=(f instanceof AjxVector)?f.getArray():f;\nif(b&&b.length){for(var d=0;\nd<b.length;\nd++){var g=b[d];\nif(g){if(g.isGroup&&!(g.__contact&&g.__contact.isDL)){var c=g.__contact?g.__contact.getGroupMembers().good.getArray():AjxEmailAddress.split(g.address);\ne=e.concat(c)\n}else{e.push(g)\n}}}}return AjxVector.fromArray(e)\n};\nZmRecipients.prototype._contactPickerCancelCallback=function(){if(this._enableContainerInputs){this._enableContainerInputs(true)\n}if(this._reenter){this._reenter()\n}};\nZmRecipients.prototype._toggleBccField=function(b){var c=AjxUtil.isBoolean(b)?b:!Dwt.getVisible(this._divEl[AjxEmailAddress.BCC]);\nthis._showAddressField(AjxEmailAddress.BCC,c)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.view.ZmMailRedirectDialog\")){ZmMailRedirectDialog=function(g,f){f=f||\"ZmFolderPropsDialog\";\nDwtDialog.call(this,{parent:g,className:f,title:ZmMsg.mailRedirect,id:\"RedirectDialog\"});\nthis.setButtonListener(DwtDialog.CANCEL_BUTTON,this._handleCancelButton.bind(this));\nvar j={};\nj.enableContainerInputs=this.enableInputs.bind(this);\nj.contactPopdownListener=this.contactPopdownListener.bind(this);\nj.contextId=this.toString();\nthis._recipients=new ZmRecipients(j);\nthis._fieldNames=[AjxEmailAddress.TO];\nvar h={id:this._htmlElId};\nfor(var d=0;\nd<this._fieldNames.length;\nd++){var b=AjxEmailAddress.TYPE_STRING[this._fieldNames[d]];\nvar e=this._recipients.createRecipientIds(this._htmlElId,b);\nh[b+\"RowId\"]=e.row;\nh[b+\"PickerId\"]=e.picker;\nh[b+\"InputId\"]=e.control;\nh[b+\"CellId\"]=e.cell\n}var c=AjxTemplate.expand(\"mail.Message#RedirectDialog\",h);\nthis.setContent(c);\nthis._recipients.createRecipientHtml(this,this._htmlElId,this._htmlElId,this._fieldNames);\nthis._tabGroup.addMember(this._recipients.getField(AjxEmailAddress.TO),0)\n};\nZmMailRedirectDialog.prototype=new DwtDialog;\nZmMailRedirectDialog.prototype.constructor=ZmMailRedirectDialog;\nZmMailRedirectDialog.prototype.isZmMailRedirectDialog=true;\nZmMailRedirectDialog.prototype.toString=function(){return\"ZmMailRedirectDialog\"\n};\nZmMailRedirectDialog.prototype.getAddrs=function(){return this._recipients.collectAddrs()\n};\nZmMailRedirectDialog.prototype.popup=function(b){this._recipients.setup();\nDwtDialog.prototype.popup.call(this)\n};\nZmMailRedirectDialog.prototype._resetTabFocus=function(){this._tabGroup.setFocusMember(this._recipients.getField(AjxEmailAddress.TO),true)\n};\nZmMailRedirectDialog.prototype.popdown=function(){this._recipients.reset();\nDwtDialog.prototype.popdown.call(this)\n};\nZmMailRedirectDialog.prototype.enableInputs=function(b){this._recipients.enableInputs(b)\n};\nZmMailRedirectDialog.prototype.contactPopdownListener=function(){this.enableInputs(true);\nappCtxt.getAppViewMgr().showPendingView(false)\n};\nZmMailRedirectDialog.prototype._handleCancelButton=function(b){this.popdown()\n}\n}if(AjxPackage.define(\"zimbraMail.mail.controller.ZmMailFolderTreeController\")){ZmMailFolderTreeController=function(c,b){if(arguments.length==0){return\n}ZmFolderTreeController.apply(this,arguments)\n};\nZmMailFolderTreeController.prototype=new ZmFolderTreeController;\nZmMailFolderTreeController.prototype.constructor=ZmMailFolderTreeController;\nZmMailFolderTreeController.prototype.toString=function(){return\"ZmMailFolderTreeController\"\n};\nZmMailFolderTreeController.prototype._updateOverview=function(d){ZmTreeController.prototype._updateOverview.call(this,d);\nvar e=d.organizer,c=d.fields;\nif(appCtxt.multiAccounts&&(c[ZmOrganizer.F_UNREAD]&&e.isSystem())||(c[ZmOrganizer.F_TOTAL]&&(e.nId==ZmFolder.ID_DRAFTS||e.nId==ZmOrganizer.ID_OUTBOX))){var b=appCtxt.getApp(ZmApp.MAIL).getOverviewContainer(true);\nif(b){b.updateLabel(e)\n}}};\nZmMailFolderTreeController.prototype._deleteListener=function(g){if(appCtxt.get(ZmSetting.POP_ACCOUNTS_ENABLED)){var b=this._getActionedOrganizer(g);\nif(b.isDataSource()){var f=appCtxt.getDataSourceCollection().getPopAccountsFor(b.id);\nvar c=[b.getName(),AjxStringUtil.htmlEncode(f[0].getName(),true)];\nvar e=AjxMessageFormat.format(ZmMsg.errorDeletePopFolder,c);\nvar d=appCtxt.getMsgDialog();\nd.setMessage(e);\nd.popup();\nreturn\n}}ZmFolderTreeController.prototype._deleteListener.apply(this,arguments)\n};\nZmMailFolderTreeController.prototype._dropListener=function(g){if((appCtxt.get(ZmSetting.POP_ACCOUNTS_ENABLED)||appCtxt.get(ZmSetting.IMAP_ACCOUNTS_ENABLED))&&g.action==DwtDropEvent.DRAG_DROP){var i=g.srcData.data;\nvar h=i instanceof ZmOrganizer?i:null;\nif(h&&h.isDataSource()){var b=appCtxt.getDataSourceCollection();\nvar d=appCtxt.get(ZmSetting.POP_ACCOUNTS_ENABLED)?b.getPopAccountsFor(h.id):[];\nvar c=appCtxt.get(ZmSetting.IMAP_ACCOUNTS_ENABLED)?b.getImapAccountsFor(h.id):[];\nif(d.length||c.length){var f=[h.getName(),d.length?d[0].getName():c[0].getName()];\nvar j=AjxMessageFormat.format(d.length?ZmMsg.errorMovePopFolder:ZmMsg.errorMoveImapFolder,f);\nvar e=appCtxt.getMsgDialog();\ne.setMessage(j);\ne.popup();\nreturn\n}}}ZmFolderTreeController.prototype._dropListener.apply(this,arguments)\n};\nZmMailFolderTreeController.prototype.resetOperations=function(d,c,e){ZmFolderTreeController.prototype.resetOperations.apply(this,arguments);\nif(appCtxt.get(ZmSetting.POP_ACCOUNTS_ENABLED)){var b=appCtxt.getById(e);\nif(b.isDataSource()){d.enable(ZmOperation.MOVE,false);\nd.enable(ZmOperation.MOVE_MENU,false)\n}}};\nZmMailFolderTreeController.prototype._doMarkAllRead=function(b){if(appCtxt.isOffline){appCtxt.getApp(ZmApp.MAIL).clearNewMailBadge()\n}ZmTreeController.prototype._doMarkAllRead.apply(this,arguments)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.controller.ZmMailListController\")){ZmMailListController=function(b,d,c,f,e){if(arguments.length==0){return\n}ZmListController.apply(this,arguments);\nthis._setStatics();\nthis._listeners[ZmOperation.SHOW_ORIG]=this._showOrigListener.bind(this);\nthis._listeners[ZmOperation.MARK_READ]=this._markReadListener.bind(this);\nthis._listeners[ZmOperation.MARK_UNREAD]=this._markUnreadListener.bind(this);\nthis._listeners[ZmOperation.FLAG]=this._flagListener.bind(this,true);\nthis._listeners[ZmOperation.UNFLAG]=this._flagListener.bind(this,false);\nif(appCtxt.get(ZmSetting.REPLY_MENU_ENABLED)){this._listeners[ZmOperation.REPLY]=this._replyListener.bind(this);\nthis._listeners[ZmOperation.REPLY_ALL]=this._replyListener.bind(this)\n}if(appCtxt.get(ZmSetting.FORWARD_MENU_ENABLED)){this._listeners[ZmOperation.FORWARD]=this._forwardListener.bind(this);\nthis._listeners[ZmOperation.FORWARD_CONV]=this._forwardConvListener.bind(this)\n}this._listeners[ZmOperation.REDIRECT]=new AjxListener(this,this._redirectListener);\nthis._listeners[ZmOperation.EDIT]=this._editListener.bind(this,false);\nthis._listeners[ZmOperation.EDIT_AS_NEW]=this._editListener.bind(this,true);\nthis._listeners[ZmOperation.MUTE_CONV]=this._muteConvListener.bind(this);\nthis._listeners[ZmOperation.UNMUTE_CONV]=this._unmuteConvListener.bind(this);\nif(appCtxt.get(ZmSetting.SPAM_ENABLED)){this._listeners[ZmOperation.SPAM]=this._spamListener.bind(this)\n}this._listeners[ZmOperation.DETACH]=this._detachListener.bind(this);\nthis._inviteReplyListener=this._inviteReplyHandler.bind(this);\nthis._shareListener=this._shareHandler.bind(this);\nthis._subscribeListener=this._subscribeHandler.bind(this);\nthis._acceptShareListener=this._acceptShareHandler.bind(this);\nthis._declineShareListener=this._declineShareHandler.bind(this);\nthis._listeners[ZmOperation.ADD_FILTER_RULE]=this._filterListener.bind(this,false,null);\nthis._listeners[ZmOperation.CREATE_APPT]=this._createApptListener.bind(this);\nthis._listeners[ZmOperation.CREATE_TASK]=this._createTaskListener.bind(this)\n};\nZmMailListController.prototype=new ZmListController;\nZmMailListController.prototype.constructor=ZmMailListController;\nZmMailListController.prototype.isZmMailListController=true;\nZmMailListController.prototype.toString=function(){return\"ZmMailListController\"\n};\nZmMailListController.GROUP_BY_ITEM={};\nZmMailListController.GROUP_BY_SETTING={};\nZmMailListController.GROUP_BY_ICON={};\nZmMailListController.GROUP_BY_MSG_KEY={};\nZmMailListController.GROUP_BY_SHORTCUT={};\nZmMailListController.GROUP_BY_VIEWS=[];\nZmMailListController.READING_PANE_TEXT={};\nZmMailListController.READING_PANE_TEXT[ZmSetting.RP_OFF]=ZmMsg.readingPaneOff;\nZmMailListController.READING_PANE_TEXT[ZmSetting.RP_BOTTOM]=ZmMsg.readingPaneAtBottom;\nZmMailListController.READING_PANE_TEXT[ZmSetting.RP_RIGHT]=ZmMsg.readingPaneOnRight;\nZmMailListController.READING_PANE_ICON={};\nZmMailListController.READING_PANE_ICON[ZmSetting.RP_OFF]=\"SplitPaneOff\";\nZmMailListController.READING_PANE_ICON[ZmSetting.RP_BOTTOM]=\"SplitPane\";\nZmMailListController.READING_PANE_ICON[ZmSetting.RP_RIGHT]=\"SplitPaneVertical\";\nZmMailListController.CONV_ORDER_DESC=ZmSearch.DATE_DESC;\nZmMailListController.CONV_ORDER_ASC=ZmSearch.DATE_ASC;\nZmMailListController.CONV_ORDER_TEXT={};\nZmMailListController.CONV_ORDER_TEXT[ZmMailListController.CONV_ORDER_DESC]=ZmMsg.convOrderDescending;\nZmMailListController.CONV_ORDER_TEXT[ZmMailListController.CONV_ORDER_ASC]=ZmMsg.convOrderAscending;\nZmMailListController.ACTION_CODE_TO_FOLDER={};\nZmMailListController.ACTION_CODE_TO_FOLDER[ZmKeyMap.GOTO_INBOX]=ZmFolder.ID_INBOX;\nZmMailListController.ACTION_CODE_TO_FOLDER[ZmKeyMap.GOTO_DRAFTS]=ZmFolder.ID_DRAFTS;\nZmMailListController.ACTION_CODE_TO_FOLDER[ZmKeyMap.GOTO_JUNK]=ZmFolder.ID_SPAM;\nZmMailListController.ACTION_CODE_TO_FOLDER[ZmKeyMap.GOTO_SENT]=ZmFolder.ID_SENT;\nZmMailListController.ACTION_CODE_TO_FOLDER[ZmKeyMap.GOTO_TRASH]=ZmFolder.ID_TRASH;\nZmMailListController.ACTION_CODE_TO_FOLDER_MOVE={};\nZmMailListController.ACTION_CODE_TO_FOLDER_MOVE[ZmKeyMap.MOVE_TO_INBOX]=ZmFolder.ID_INBOX;\nZmMailListController.ACTION_CODE_TO_FOLDER_MOVE[ZmKeyMap.MOVE_TO_TRASH]=ZmFolder.ID_TRASH;\nZmMailListController.ACTION_CODE_TO_FOLDER_MOVE[ZmKeyMap.MOVE_TO_JUNK]=ZmFolder.ID_SPAM;\nZmMailListController.ACTION_CODE_TO_MENU_ID={};\nZmMailListController.ACTION_CODE_TO_MENU_ID[ZmKeyMap.READING_PANE_OFF]=ZmSetting.RP_OFF;\nZmMailListController.ACTION_CODE_TO_MENU_ID[ZmKeyMap.READING_PANE_BOTTOM]=ZmSetting.RP_BOTTOM;\nZmMailListController.ACTION_CODE_TO_MENU_ID[ZmKeyMap.READING_PANE_RIGHT]=ZmSetting.RP_RIGHT;\nZmMailListController.ACTION_CODE_WHICH={};\nZmMailListController.ACTION_CODE_WHICH[ZmKeyMap.FIRST_UNREAD]=DwtKeyMap.SELECT_FIRST;\nZmMailListController.ACTION_CODE_WHICH[ZmKeyMap.LAST_UNREAD]=DwtKeyMap.SELECT_LAST;\nZmMailListController.ACTION_CODE_WHICH[ZmKeyMap.NEXT_UNREAD]=DwtKeyMap.SELECT_NEXT;\nZmMailListController.ACTION_CODE_WHICH[ZmKeyMap.PREV_UNREAD]=DwtKeyMap.SELECT_PREV;\nZmMailListController.viewToTab={};\nZmMailListController.prototype.switchView=function(h,b){if((h==ZmId.VIEW_TRAD||h==ZmId.VIEW_CONVLIST)&&h!=this.getCurrentViewType()){if(appCtxt.multiAccounts){delete this._showingAccountColumn\n}var k=ZmMailListController.GROUP_BY_SETTING[h];\nif(this.isSearchResults){appCtxt.getApp(ZmApp.SEARCH).setGroupMailBy(k)\n}else{this._app.setGroupMailBy(k)\n}var c=this._currentSearch&&this._currentSearch.folderId;\nvar i=appCtxt.get(ZmSetting.SORTING_PREF,c||h);\nif(h==ZmId.VIEW_CONVLIST&&(i==ZmSearch.NAME_DESC||i==ZmSearch.NAME_ASC)){i=appCtxt.get(ZmSetting.SORTING_PREF,h);\nappCtxt.set(ZmSetting.SORTING_PREF,i,c)\n}if(this._mailListView&&!appCtxt.isExternalAccount()){if(c){var j=this._mailListView.getGroup(c);\nif(j&&j.id==ZmId.GROUPBY_FROM){this._mailListView.setGroup(ZmId.GROUPBY_NONE)\n}}}this._currentSearch.clearCursor();\nvar e=this._listView[this._currentViewId].getLimit();\nvar f=appCtxt.get(ZmSetting.VIEW_AS_HTML);\nvar g=(h==ZmId.VIEW_TRAD)?ZmItem.MSG:ZmItem.CONV;\nvar d={types:[g],offset:0,limit:e,sortBy:i,getHtml:f,isViewSwitch:true};\nappCtxt.getSearchController().redoSearch(this._currentSearch,null,d)\n}};\nZmMailListController.prototype._setupReadingPaneMenu=function(){};\nZmMailListController.prototype._setupConvOrderMenu=function(){};\nZmMailListController.prototype.isReadingPaneOn=function(){return(this._getReadingPanePref()!=ZmSetting.RP_OFF)\n};\nZmMailListController.prototype.isReadingPaneOnRight=function(){return(this._getReadingPanePref()==ZmSetting.RP_RIGHT)\n};\nZmMailListController.prototype._getReadingPanePref=function(){return(this._readingPaneLoc||appCtxt.get(ZmSetting.READING_PANE_LOCATION))\n};\nZmMailListController.prototype._setReadingPanePref=function(b){if(this.isSearchResults||appCtxt.isExternalAccount()){this._readingPaneLoc=b\n}else{appCtxt.set(ZmSetting.READING_PANE_LOCATION,b)\n}};\nZmMailListController.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_MAIL\n};\nZmMailListController.prototype.handleKeyAction=function(e,t){var f=this._listView[this._currentViewId];\nvar k=f.getSelectionCount();\nvar s;\nif(k==1&&!this.isDraftsFolder()){var q=this._listView[this._currentViewId].getSelection();\nif(q&&q.length){s=q[0]\n}}var j=this._getSearchFolder();\nvar r=this.isSyncFailuresFolder();\nvar u=(s&&s.isDraft&&(s.type!=ZmId.ITEM_CONV||s.numMsgs==1))||this.isDraftsFolder();\nvar l=(j&&j.isFeed());\nvar g=appCtxt.isExternalAccount();\nswitch(e){case ZmKeyMap.FORWARD:if(!u&&!g){this._doAction({action:ZmOperation.FORWARD,foldersToOmit:ZmMailApp.getFoldersToOmit()})\n}break;\ncase ZmKeyMap.GET_MAIL:this._checkMailListener();\nbreak;\ncase ZmKeyMap.GOTO_INBOX:case ZmKeyMap.GOTO_DRAFTS:case ZmKeyMap.GOTO_JUNK:case ZmKeyMap.GOTO_SENT:case ZmKeyMap.GOTO_TRASH:if(g){break\n}if(e==ZmKeyMap.GOTO_JUNK&&!appCtxt.get(ZmSetting.SPAM_ENABLED)){break\n}this._folderSearch(ZmMailListController.ACTION_CODE_TO_FOLDER[e]);\nbreak;\ncase ZmKeyMap.MOVE_TO_INBOX:case ZmKeyMap.MOVE_TO_TRASH:case ZmKeyMap.MOVE_TO_JUNK:if(r||g){break\n}if(e==ZmKeyMap.MOVE_TO_JUNK&&!appCtxt.get(ZmSetting.SPAM_ENABLED)){break\n}if(k&&!(u&&e!=ZmKeyMap.MOVE_TO_TRASH)){var b=ZmMailListController.ACTION_CODE_TO_FOLDER_MOVE[e];\nj=appCtxt.getById(b);\nvar o=f.getSelection();\nthis._doMove(o,j)\n}break;\ncase ZmKeyMap.REPLY:case ZmKeyMap.REPLY_ALL:if(!u&&!g&&(k==1)&&!r&&!l){this._doAction({action:ZmMailListController.ACTION_CODE_TO_OP[e],foldersToOmit:ZmMailApp.getFoldersToOmit()})\n}break;\ncase ZmKeyMap.SELECT_ALL:f.selectAll(true);\nthis._resetToolbarOperations();\nbreak;\ncase ZmKeyMap.SPAM:if(g){break\n}if(k&&!u&&!g&&!r&&appCtxt.get(ZmSetting.SPAM_ENABLED)&&(j&&!j.isReadOnly())){this._spamListener()\n}break;\ncase ZmKeyMap.MUTE_UNMUTE_CONV:break;\ncase ZmKeyMap.MARK_READ:if(this._isPermissionDenied(j)){break\n}this._markReadListener();\nbreak;\ncase ZmKeyMap.MARK_UNREAD:if(this._isPermissionDenied(j)){break\n}this._markUnreadListener();\nbreak;\ncase ZmKeyMap.FLAG:if(this._isPermissionDenied(j)){break\n}this._doFlag(this.getItems());\nbreak;\ncase ZmKeyMap.VIEW_BY_CONV:if(!r&&appCtxt.get(ZmSetting.CONVERSATIONS_ENABLED)){this.switchView(ZmId.VIEW_CONVLIST)\n}break;\ncase ZmKeyMap.VIEW_BY_MSG:if(!r){this.switchView(ZmId.VIEW_TRAD)\n}break;\ncase ZmKeyMap.READING_PANE_BOTTOM:case ZmKeyMap.READING_PANE_RIGHT:case ZmKeyMap.READING_PANE_OFF:var n=ZmMailListController.ACTION_CODE_TO_MENU_ID[e];\nthis.switchView(n,true);\nthis._updateViewMenu(n,this._readingPaneViewMenu);\nbreak;\ncase ZmKeyMap.SHOW_FRAGMENT:if(k==1){var s=f.getSelection()[0];\nif(!s){break\n}var p=f._getFieldId(s,ZmItem.F_SUBJECT);\nvar h=document.getElementById(p);\nif(h){var m=Dwt.getLocation(h);\nvar c;\nif((s.type==ZmItem.MSG&&s.isInvite()&&s.needsRsvp())||(s.type==ZmId.ITEM_CONV&&this.getMsg()&&this.getMsg().isInvite()&&this.getMsg().needsRsvp())){c=s.invite?s.invite.getToolTip():this.getMsg().invite.getToolTip()\n}else{c=s.fragment?s.fragment:ZmMsg.fragmentIsEmpty;\nif(c!=\"\"){c=AjxStringUtil.htmlEncode(c);\nf.setToolTipContent(c,true)\n}}var d=this._shell.getToolTip();\nd.popdown();\nif(c!=\"\"){d.setContent(c);\nd.popup(m.x,m.y)\n}}}break;\ncase ZmKeyMap.NEXT_UNREAD:case ZmKeyMap.PREV_UNREAD:this.lastListAction=e;\ncase ZmKeyMap.FIRST_UNREAD:case ZmKeyMap.LAST_UNREAD:var i=this._getUnreadItem(ZmMailListController.ACTION_CODE_WHICH[e]);\nif(i){this._selectItem(f,i)\n}break;\ndefault:return ZmListController.prototype.handleKeyAction.apply(this,arguments)\n}return true\n};\nZmMailListController.prototype._isPermissionDenied=function(c){var b=appCtxt.isExternalAccount();\nif(b||(c&&c.isReadOnly())){appCtxt.setStatusMsg(ZmMsg.errorPermission);\nreturn true\n}return false\n};\nZmMailListController.prototype._selectItem=function(b,d){b._unmarkKbAnchorElement(true);\nb.setSelection(d);\nvar c=b._getElFromItem(d);\nif(c){b._scrollList(c)\n}};\nZmMailListController.prototype.mapSupported=function(b){return(b==\"list\")\n};\nZmMailListController.prototype.sendReadReceipt=function(d){if(!appCtxt.get(ZmSetting.MAIL_READ_RECEIPT_ENABLED)||d.readReceiptSent||d.isSent){return\n}var b=appCtxt.get(ZmSetting.MAIL_SEND_READ_RECEIPTS);\nif(b==ZmMailApp.SEND_RECEIPT_PROMPT){var c=appCtxt.getYesNoMsgDialog();\nc.registerCallback(DwtDialog.YES_BUTTON,this._sendReadReceipt,this,[d,c]);\nc.registerCallback(DwtDialog.NO_BUTTON,this._sendReadReceiptNotified,this,[d,c]);\nc.setMessage(ZmMsg.readReceiptSend,DwtMessageDialog.WARNING_STYLE);\nc.popup()\n}else{if(b==ZmMailApp.SEND_RECEIPT_ALWAYS){d.readReceiptSent=true;\nthis._sendReadReceipt(d)\n}}};\nZmMailListController.prototype._sendReadReceipt=function(c,b){if(b){b.popdown()\n}c.sendReadReceipt(this._handleSendReadReceipt.bind(this,c))\n};\nZmMailListController.prototype._handleSendReadReceipt=function(b){appCtxt.setStatusMsg(ZmMsg.readReceiptSent);\nthis._sendReadReceiptNotified(b)\n};\nZmMailListController.prototype._sendReadReceiptNotified=function(d,c){var e=c?(new AjxCallback(c,c.popdown)):null;\nvar b=d.setFlag(ZmItem.FLAG_READ_RECEIPT_SENT,true);\nd.list.flagItems({items:[d],op:\"update\",value:b,callback:e})\n};\nZmMailListController.prototype._updateViewMenu=function(e,d){var c=this.getCurrentToolbar().getButton(ZmOperation.VIEW_MENU);\nd=d||(c&&c.getMenu());\nif(d){var b=d.getItemById(ZmOperation.MENUITEM_ID,e);\nif(b){b.setChecked(true,true)\n}}if(!this._colHeaderViewMenu&&this._mailListView.isMultiColumn()){this._colHeaderViewMenu=this._setupColHeaderViewMenu(this._currentView,this._viewMenu)\n}if(this._colHeaderMenuItem&&(e===ZmSetting.RP_OFF||e===ZmSetting.RP_BOTTOM||e===ZmSetting.RP_RIGHT)){this._colHeaderMenuItem.setVisible(this._mailListView.isMultiColumn())\n}};\nZmMailListController.prototype._initialize=function(b){this._setActiveSearch(b);\nZmListController.prototype._initialize.call(this,b)\n};\nZmMailListController.prototype._initializeParticipantActionMenu=function(){if(!this._participantActionMenu){var b=this._participantOps();\nb.push(ZmOperation.SEP);\nvar c=this._getActionMenuOps();\nif(c&&c.length){b=b.concat(c)\n}this._participantActionMenu=new ZmActionMenu({parent:this._shell,menuItems:b,controller:this,context:this._currentViewId,menuType:ZmId.MENU_PARTICIPANT});\nif(appCtxt.get(ZmSetting.SEARCH_ENABLED)){this._setSearchMenu(this._participantActionMenu)\n}this._addMenuListeners(this._participantActionMenu);\nthis._participantActionMenu.addPopdownListener(this._menuPopdownListener);\nthis._setupTagMenu(this._participantActionMenu);\nappCtxt.notifyZimlets(\"onParticipantActionMenuInitialized\",[this,this._participantActionMenu])\n}return this._participantActionMenu\n};\nZmMailListController.prototype._initializeDraftsActionMenu=function(){if(!this._draftsActionMenu){var b=[ZmOperation.EDIT,ZmOperation.SEP,ZmOperation.TAG_MENU,ZmOperation.DELETE,ZmOperation.PRINT,ZmOperation.SEP,ZmOperation.SHOW_ORIG];\nthis._draftsActionMenu=new ZmActionMenu({parent:this._shell,menuItems:b,context:this._currentViewId,menuType:ZmId.MENU_DRAFTS});\nif(appCtxt.get(ZmSetting.SEARCH_ENABLED)){this._setSearchMenu(this._draftsActionMenu)\n}this._addMenuListeners(this._draftsActionMenu);\nthis._draftsActionMenu.addPopdownListener(this._menuPopdownListener);\nthis._setupTagMenu(this._draftsActionMenu);\nappCtxt.notifyZimlets(\"onDraftsActionMenuInitialized\",[this,this._draftsActionMenu])\n}};\nZmMailListController.prototype._setDraftSearchMenu=function(b,d,c){if(b&&appCtxt.get(ZmSetting.SEARCH_ENABLED)&&(c.field==ZmItem.F_PARTICIPANT||c.field==ZmItem.F_FROM)){if(!this._draftsActionMenu.getOp(ZmOperation.SEARCH_MENU)){ZmOperation.addOperation(this._draftsActionMenu,ZmOperation.SEARCH_MENU,[ZmOperation.SEARCH_MENU,ZmOperation.SEP],0);\nthis._setSearchMenu(this._draftsActionMenu)\n}if(d&&(d.getAddresses(AjxEmailAddress.TO).getArray().length+d.getAddresses(AjxEmailAddress.CC).getArray().length)>1){ZmOperation.setOperation(this._draftsActionMenu.getSearchMenu(),ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToRecipients);\nZmOperation.setOperation(this._draftsActionMenu.getSearchMenu(),ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromRecipients)\n}else{ZmOperation.setOperation(this._draftsActionMenu.getSearchMenu(),ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToRecipient);\nZmOperation.setOperation(this._draftsActionMenu.getSearchMenu(),ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromRecipient)\n}}else{if(this._draftsActionMenu.getOp(ZmOperation.SEARCH_MENU)){this._draftsActionMenu=null;\nthis._initializeDraftsActionMenu()\n}}};\nZmMailListController.prototype._getToolBarOps=function(){var b=[];\nb.push(ZmOperation.SEP);\nb=b.concat(this._msgOps());\nb.push(ZmOperation.SEP);\nb=b.concat(this._deleteOps());\nb.push(ZmOperation.SEP);\nb.push(ZmOperation.MOVE_MENU);\nb.push(ZmOperation.TAG_MENU);\nreturn b\n};\nZmMailListController.prototype._getRightSideToolBarOps=function(){if(appCtxt.isChildWindow){return[]\n}return[ZmOperation.VIEW_MENU]\n};\nZmMailListController.prototype._showDetachInSecondary=function(){return true\n};\nZmMailListController.prototype._getSecondaryToolBarOps=function(){var c=[],b=this.getCurrentViewType();\nc.push(ZmOperation.PRINT);\nc.push(ZmOperation.SEP);\nc=c.concat(this._flagOps());\nc.push(ZmOperation.SEP);\nc.push(ZmOperation.REDIRECT);\nc.push(ZmOperation.EDIT_AS_NEW);\nc.push(ZmOperation.SEP);\nc=c.concat(this._createOps());\nc.push(ZmOperation.SEP);\nc=c.concat(this._otherOps(true));\nif(b===ZmId.VIEW_TRAD){c.push(ZmOperation.SHOW_CONV)\n}return c\n};\nZmMailListController.prototype._initializeToolBar=function(b,c){if(!this._toolbar[b]){ZmListController.prototype._initializeToolBar.call(this,b,c);\nthis._createViewMenu(b);\nthis._setReplyText(this._toolbar[b]);\nif(!appCtxt.isChildWindow){this._initializeNavToolBar(b)\n}}if(!appCtxt.isChildWindow){this._setupViewMenu(b)\n}this._setupDeleteButton(this._toolbar[b]);\nif(appCtxt.get(ZmSetting.SPAM_ENABLED)){this._setupSpamButton(this._toolbar[b])\n}this._setupPrintButton(this._toolbar[b])\n};\nZmMailListController.prototype._getNumTotal=function(){if(AjxEnv.is1024x768orLower){return null\n}return ZmListController.prototype._getNumTotal.call(this)\n};\nZmMailListController.prototype._initializeActionMenu=function(){var b=(this._actionMenu!=null);\nZmListController.prototype._initializeActionMenu.call(this);\nif(this._actionMenu){this._setupSpamButton(this._actionMenu)\n}appCtxt.notifyZimlets(\"onActionMenuInitialized\",[this,this._actionMenu])\n};\nZmMailListController.prototype._flagOps=function(){return[ZmOperation.MARK_READ,ZmOperation.MARK_UNREAD,ZmOperation.FLAG,ZmOperation.UNFLAG]\n};\nZmMailListController.prototype._msgOps=function(){var b=[];\nb.push(ZmOperation.EDIT);\nif(appCtxt.get(ZmSetting.REPLY_MENU_ENABLED)){b.push(ZmOperation.REPLY,ZmOperation.REPLY_ALL)\n}if(appCtxt.get(ZmSetting.FORWARD_MENU_ENABLED)){b.push(ZmOperation.FORWARD)\n}return b\n};\nZmMailListController.prototype._deleteOps=function(){return[this.getDeleteOperation(),ZmOperation.SPAM]\n};\nZmMailListController.prototype._createOps=function(){var b=[];\nif(appCtxt.get(ZmSetting.FILTERS_ENABLED)){b.push(ZmOperation.ADD_FILTER_RULE)\n}if(appCtxt.get(ZmSetting.CALENDAR_ENABLED)){b.push(ZmOperation.CREATE_APPT)\n}if(appCtxt.get(ZmSetting.TASKS_ENABLED)){b.push(ZmOperation.CREATE_TASK)\n}return b\n};\nZmMailListController.prototype._otherOps=function(b){var c=[];\nif(!appCtxt.isChildWindow&&(!b||this._showDetachInSecondary())&&appCtxt.get(ZmSetting.DETACH_MAILVIEW_ENABLED)&&!appCtxt.isExternalAccount()){c.push(ZmOperation.DETACH)\n}c.push(ZmOperation.SHOW_ORIG);\nreturn c\n};\nZmMailListController.prototype.getDeleteOperation=function(){return ZmOperation.DELETE\n};\nZmMailListController.prototype._setActiveSearch=function(b){if(this._activeSearch){if(this._list){this._list.setHasMore(this._activeSearch.getAttribute(\"more\"))\n}if(this._listView[b]){this._listView[b].offset=parseInt(this._activeSearch.getAttribute(\"offset\"))\n}}};\nZmMailListController.prototype._getReadStatus=function(){var b={hasRead:false,hasUnread:false};\nvar f=this._getSearchFolder();\nif(f&&f.isReadOnly()){return b\n}var c=this.getItems();\nfor(var d=0;\nd<c.length;\nd++){var e=c[d];\nif(e.type==ZmItem.MSG){b[e.isUnread?\"hasUnread\":\"hasRead\"]=true;\nb[e.isFlagged?\"hasFlagged\":\"hasUnflagged\"]=true\n}else{if(e.type==ZmItem.CONV){b.hasUnread=b.hasUnread||e.hasFlag(ZmItem.FLAG_UNREAD,true);\nb.hasRead=b.hasRead||e.hasFlag(ZmItem.FLAG_UNREAD,false);\nb.hasUnflagged=b.hasUnflagged||e.hasFlag(ZmItem.FLAG_FLAGGED,false);\nb.hasFlagged=b.hasFlagged||e.hasFlag(ZmItem.FLAG_FLAGGED,true)\n}}if(b.hasUnread&&b.hasRead){break\n}}return b\n};\nZmMailListController.prototype._getConvMuteStatus=function(){var c=this.getItems();\nvar b={hasMuteConv:false,hasUnmuteConv:false},e,d;\nfor(d=0;\nd<c.length;\nd++){e=c[d];\nif(e.isMute){b.hasMuteConv=true\n}else{b.hasUnmuteConv=true\n}}return b\n};\nZmMailListController.prototype._enableReadUnreadToolbarActions=function(){var b=this.getCurrentToolbar().getActionsMenu();\nthis._enableFlags(b)\n};\nZmMailListController.prototype._enableMuteUnmuteToolbarActions=function(){var b=this.getCurrentToolbar().getActionsMenu();\nthis._enableMuteUnmute(b)\n};\nZmMailListController.prototype._actionsButtonListener=function(b){this._enableReadUnreadToolbarActions();\nthis._enableMuteUnmuteToolbarActions();\nZmBaseController.prototype._actionsButtonListener.call(this,b)\n};\nZmMailListController.prototype._listSelectionListener=function(e){var c=appCtxt.getCurrentSearch();\nif(appCtxt.isOffline&&e.detail==DwtListView.ITEM_DBL_CLICKED&&e.item&&e.item.isDraft&&c&&c.folderId==ZmFolder.ID_OUTBOX){var f=e.item.account||ZmOrganizer.parseId(e.item.id).account;\nvar d=appCtxt.getById(ZmOrganizer.getSystemId(ZmFolder.ID_DRAFTS,f));\nthis._list.moveItems({items:[e.item],folder:d});\nreturn false\n}var b=e.item.folderId||(c&&c.folderId);\nvar d=b&&appCtxt.getById(b);\nif(e.field===ZmItem.F_FLAG&&this._isPermissionDenied(d)){return true\n}if(e.field===ZmItem.F_READ){if(!this._isPermissionDenied(d)){this._doMarkRead([e.item],e.item.isUnread)\n}return true\n}else{return ZmListController.prototype._listSelectionListener.apply(this,arguments)\n}};\nZmMailListController.prototype._listActionListener=function(g){ZmListController.prototype._listActionListener.call(this,g);\nvar e=this._listView[this._currentViewId].getSelection();\nvar c=this._getSearchFolder();\nvar i=(appCtxt.get(ZmSetting.CONTACTS_ENABLED)&&g.field==ZmItem.F_PARTICIPANT)?g.detail:((g.item&&g.item.isZmMailMsg)?g.item.getAddress(AjxEmailAddress.FROM):null);\nvar d=i&&i.getAddress();\nvar j=(e&&e.length==1)?e[0]:null;\nif(this.isDraftsFolder()||(j&&j.isDraft&&(j.type!=ZmId.ITEM_CONV||j.numMsgs==1))){this._initializeDraftsActionMenu();\nthis._setDraftSearchMenu(i,j,g);\nif(i){this._actionEv.address=i\n}this._setTagMenu(this._draftsActionMenu);\nthis._resetOperations(this._draftsActionMenu,e.length);\nappCtxt.notifyZimlets(\"onMailActionMenuResetOperations\",[this,this._draftsActionMenu]);\nthis._draftsActionMenu.popup(0,g.docX,g.docY)\n}else{if(!appCtxt.isExternalAccount()&&d&&e.length==1&&(appCtxt.get(ZmSetting.CONTACTS_ENABLED)&&(g.field==ZmItem.F_PARTICIPANT||g.field==ZmItem.F_FROM))){this._initializeParticipantActionMenu();\nthis._setTagMenu(this._participantActionMenu);\nthis._actionEv.address=i;\nthis._setupSpamButton(this._participantActionMenu);\nthis._resetOperations(this._participantActionMenu,e.length);\nappCtxt.notifyZimlets(\"onMailActionMenuResetOperations\",[this,this._participantActionMenu]);\nthis._enableFlags(this._participantActionMenu);\nthis._enableMuteUnmute(this._participantActionMenu);\nvar b=this._participantActionMenu.getOp(ZmOperation.IM);\nvar h=appCtxt.getApp(ZmApp.CONTACTS);\nif(h){this._loadContactForMenu(this._participantActionMenu,i,g,b)\n}else{if(b){ZmImApp.updateImMenuItemByAddress(b,i,true);\nthis._participantActionMenu.popup(0,g.docX,g.docY)\n}}}else{if(this.isOutboxFolder()){}else{var f=this.getActionMenu();\nthis._setupSpamButton(f);\nthis._enableFlags(f);\nthis._enableMuteUnmute(f);\nappCtxt.notifyZimlets(\"onMailActionMenuResetOperations\",[this,f]);\nf.popup(0,g.docX,g.docY);\nif(g.ersatz){f.setSelectedItem(0)\n}}}}if(!c){c=this._getActiveSearchFolder()\n}if(c&&(c.nId==ZmFolder.ID_SENT&&(this._participantActionMenu&&this._participantActionMenu.getOp(ZmOperation.SEARCH_MENU)))){if(j&&(j.getAddresses(AjxEmailAddress.TO).getArray().length+j.getAddresses(AjxEmailAddress.CC).getArray().length)>1){ZmOperation.setOperation(this._participantActionMenu.getSearchMenu(),ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToRecipients);\nZmOperation.setOperation(this._participantActionMenu.getSearchMenu(),ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromRecipients)\n}else{ZmOperation.setOperation(this._participantActionMenu.getSearchMenu(),ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToRecipient);\nZmOperation.setOperation(this._participantActionMenu.getSearchMenu(),ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromRecipient)\n}}else{if(this._participantActionMenu&&this._participantActionMenu.getOp(ZmOperation.SEARCH_MENU)){ZmOperation.setOperation(this._participantActionMenu.getSearchMenu(),ZmOperation.SEARCH_TO,ZmOperation.SEARCH_TO,ZmMsg.findEmailToSender);\nZmOperation.setOperation(this._participantActionMenu.getSearchMenu(),ZmOperation.SEARCH,ZmOperation.SEARCH,ZmMsg.findEmailFromSender)\n}}};\nZmMailListController.prototype._markReadListener=function(b){var c=this._getMarkReadCallback();\nthis._doMarkRead(this._listView[this._currentViewId].getSelection(),true,c)\n};\nZmMailListController.prototype._showOrigListener=function(){var b=this.getMsg();\nif(!b){return\n}setTimeout(this._showMsgSource.bind(this,b),100)\n};\nZmMailListController.prototype._showMsgSource=function(c){var b=appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI)+\"&view=text&id=\"+c.id+(c.partId?\"&part=\"+c.partId:\"\");\nwindow.open(b,\"_blank\",\"menubar=yes,resizable=yes,scrollbars=yes\")\n};\nZmMailListController.prototype._getMarkReadCallback=function(){var b=this._listView[this._currentViewId];\nvar c=b.getSelection();\nif(this.isReadingPaneOn()&&appCtxt.get(ZmSetting.MARK_MSG_READ)==-1){var g=b.parent.getItemView&&b.parent.getItemView().getItem();\nif(g&&g.readReceiptRequested){for(var d=0;\nd<c.length;\nd++){var e=c[d];\nvar f=(e.id<0)?(e.id*(-1)):e.id;\nif(f==g.id){return this.sendReadReceipt.bind(this,g)\n}}}}return null\n};\nZmMailListController.prototype._markUnreadListener=function(b){appCtxt.killMarkReadTimer();\nthis._doMarkRead(this._listView[this._currentViewId].getSelection(),false)\n};\nZmMailListController.prototype._flagListener=function(b){this._doFlag(this._listView[this._currentViewId].getSelection(),b)\n};\nZmMailListController.prototype._replyListener=function(b){var c=b.item.getData(ZmOperation.KEY_ID);\nif(!c||c==ZmOperation.REPLY_MENU){c=ZmOperation.REPLY\n}this._doAction({ev:b,action:c,foldersToOmit:ZmMailApp.getReplyFoldersToOmit()})\n};\nZmMailListController.prototype._forwardListener=function(b){var c=b.item.getData(ZmOperation.KEY_ID);\nthis._doAction({ev:b,action:c,foldersToOmit:ZmMailApp.getReplyFoldersToOmit()})\n};\nZmMailListController.prototype._forwardConvListener=function(b){this._doAction({ev:b,action:ZmOperation.FORWARD_CONV,foldersToOmit:ZmMailApp.getReplyFoldersToOmit()})\n};\nZmMailListController.prototype._doAction=function(d){var c=d.msg||this.getMsg(d);\nif(!c){return\n}var i=appCtxt.getIdentityCollection();\nvar j=i.selectIdentity(c);\nvar e=d.action;\nif(!e||e==ZmOperation.FORWARD_MENU||e==ZmOperation.FORWARD){d.origAction=e;\ne=d.action=(appCtxt.get(ZmSetting.FORWARD_INCLUDE_ORIG)==ZmSetting.INC_ATTACH)?ZmOperation.FORWARD_ATT:ZmOperation.FORWARD_INLINE;\nif(c.isInvite()){e=d.action=ZmOperation.FORWARD_ATT\n}}if(e===ZmOperation.FORWARD_CONV){d.origAction=e;\nvar k=this.getSelection();\nd.conv=k&&k.length===1?k[0]:null;\ne=d.action=ZmOperation.FORWARD_ATT\n}var g=appCtxt.get(ZmSetting.HTML_COMPOSE_ENABLED);\nvar f=(appCtxt.get(ZmSetting.COMPOSE_AS_FORMAT)==ZmSetting.COMPOSE_HTML);\nvar h=appCtxt.get(ZmSetting.COMPOSE_SAME_FORMAT);\nd.getHtml=(g&&(e==ZmOperation.DRAFT||(f||(!c._loaded&&h))));\nif(e==ZmOperation.DRAFT){d.listController=this;\nif(!c.isOfflineCreated){d.forceLoad=true\n}}if(e!=ZmOperation.NEW_MESSAGE&&e!=ZmOperation.DRAFT&&c.viewEntireMessage){d.noTruncate=true;\nd.forceLoad=true\n}if(e==ZmOperation.DRAFT||e==ZmOperation.FORWARD_INLINE||e==ZmOperation.REPLY||e==ZmOperation.REPLY_ALL){var b=c.getBodyPart();\nif((b&&b.isTruncated)||!c._loaded){d.noTruncate=true;\nd.forceLoad=true\n}}if(d.msg){this._handleResponseDoAction(d,d.msg)\n}else{var l=this._handleResponseDoAction.bind(this,d);\nthis._getLoadedMsg(d,l)\n}};\nZmMailListController.prototype._handleResponseDoAction=function(e,d,i){if(!d){return\n}d._instanceDate=e.instanceDate;\ne.inNewWindow=(!appCtxt.isChildWindow&&this._app._inNewWindow(e.ev));\nif(d.list&&d.isUnread&&!appCtxt.getById(d.folderId).isReadOnly()){d.list.markRead({items:[d],value:true})\n}var f=e.action;\nif(f==ZmOperation.FORWARD_ATT||f==ZmOperation.FORWARD_INLINE){var j,h;\nif(e.msg){h=1\n}else{var c=this._listView[this._currentViewId];\nif(c){j=e.conv?[e.conv]:c.getSelection();\nh=e.conv?1:j.length;\nif(h===0&&d.isInvite()&&c.getSelection().length===0){j=this._lastSelectedListItem;\nif(j){h=j.length\n}}}}if(h==1&&d.forwardAsInvite()){var k=window.parentAppCtxt||window.appCtxt;\nif(k.get(ZmSetting.CALENDAR_ENABLED)){var g=k.getApp(ZmApp.CALENDAR).getCalController();\ng.forwardInvite(d);\nif(appCtxt.isChildWindow){window.close()\n}return\n}}if(h>1||e.origAction===ZmOperation.FORWARD_CONV||f===ZmOperation.FORWARD_ATT){f=e.action=ZmOperation.FORWARD_ATT;\nthis._handleLoadMsgs(e,j);\nreturn\n}}else{if(appCtxt.isOffline&&f==ZmOperation.DRAFT){var b=appCtxt.getById(d.folderId);\ne.accountName=b&&b.getAccount().name\n}else{if(f==ZmOperation.DECLINE_PROPOSAL){e.subjOverride=this._getInviteReplySubject(f)+d.subject\n}}}e.msg=d;\nAjxDispatcher.run(\"Compose\",e)\n};\nZmMailListController.prototype._redirectListener=function(c){var d=c.item.getData(ZmOperation.KEY_ID);\nvar e=this.getMsg({ev:c,action:d});\nif(!e){return\n}var f=appCtxt.getMailRedirectDialog();\nvar b=this._redirectCallback.bind(this,e);\nZmController.showDialog(f,b)\n};\nZmMailListController.prototype._redirectCallback=function(f){if(!f){return\n}var g=appCtxt.getMailRedirectDialog();\nvar c=g.getAddrs();\nif(c.gotAddress){if(c[ZmRecipients.BAD].size()){var e=AjxStringUtil.htmlEncode(c[ZmRecipients.BAD].toString(AjxEmailAddress.SEPARATOR));\nvar b=AjxMessageFormat.format(ZmMsg.compBadAddresses,e);\nvar d=appCtxt.getOkCancelMsgDialog();\nd.reset();\nd.setMessage(b,DwtMessageDialog.WARNING_STYLE);\nd.registerCallback(DwtDialog.OK_BUTTON,this._badRedirectAddrsOkCallback,this,[c,d,f]);\nd.registerCallback(DwtDialog.CANCEL_BUTTON,this._badRedirectAddrsCancelCallback,this,d);\nd.setVisible(true);\nd.popup()\n}else{g.popdown();\nf.redirect(c,this._handleSendRedirect.bind(this))\n}}else{g.popdown()\n}};\nZmMailListController.prototype._badRedirectAddrsOkCallback=function(c,b,d){b.popdown();\nappCtxt.getMailRedirectDialog().popdown();\nd.redirect(c,this._handleSendRedirect.bind(this))\n};\nZmMailListController.prototype._badRedirectAddrsCancelCallback=function(b){b.popdown()\n};\nZmMailListController.prototype._handleLoadMsgs=function(k,e){var b=new AjxVector(),h=k.foldersToOmit||{};\nfor(var d=0;\nd<e.length;\nd++){var f=e[d];\nif(f.type==ZmItem.CONV){for(var c=0;\nc<f.msgIds.length;\nc++){var g=f.msgIds[c];\nif(!h[f.msgFolder[g]]){b.add(g)\n}}}else{if(!b.contains(f.id)){b.add(f.id)\n}}}k.msgIds=b.getArray();\nk.selectedMessages=e;\nAjxDispatcher.run(\"Compose\",k)\n};\nZmMailListController.prototype._handleSendRedirect=function(){appCtxt.setStatusMsg(ZmMsg.redirectSent,ZmStatusView.LEVEL_INFO,null)\n};\nZmMailListController.prototype._handleMarkRead=function(e,b){var c=this._convView;\nvar d=c&&c.isWaitOnMarkRead();\nif(e&&e.isUnread&&!d){if(!e.isReadOnly()&&!appCtxt.isExternalAccount()){var f=appCtxt.get(ZmSetting.MARK_MSG_READ);\nif(f==ZmSetting.MARK_READ_NOW){if(b){return true\n}else{this._doMarkRead([e],true)\n}}else{if(f>0){if(!appCtxt.markReadAction){appCtxt.markReadAction=new AjxTimedAction(this,this._markReadAction)\n}appCtxt.markReadAction.args=[e];\nappCtxt.markReadActionId=AjxTimedAction.scheduleAction(appCtxt.markReadAction,f*1000)\n}}}}return false\n};\nZmMailListController.prototype._markReadAction=function(b){this._doMarkRead([b],true)\n};\nZmMailListController.prototype._doMarkRead=function(c,b,g,e){var f={items:c,value:b,callback:g,noBusyOverlay:true};\nvar d=f.list=this._getList(f.items);\nf.forceCallback=e;\nthis._setupContinuation(this._doMarkRead,[b,g],f);\nd.markRead(f)\n};\nZmMailListController.prototype._doMarkMute=function(c,b,g,e){var f={items:c,value:b,callback:g};\nvar d=f.list=this._getList(f.items);\nf.forceCallback=e;\nthis._setupContinuation(this._doMarkMute,[b,g],f);\nd.markMute(f)\n};\nZmMailListController.prototype._doSpam=function(b,g,c){this._listView[this._currentViewId]._itemToSelect=this._getNextItemToSelect();\nb=AjxUtil.toArray(b);\nvar f={items:b,markAsSpam:g,folder:c,childWin:appCtxt.isChildWindow&&window,closeChildWin:appCtxt.isChildWindow};\nvar e=this._getAllDoneCallback();\nvar d=f.list=this._getList(f.items);\nthis._setupContinuation(this._doSpam,[g,c],f,e);\nd.spamItems(f)\n};\nZmMailListController.prototype._inviteReplyHandler=function(e){var d=window.parentAppCtxt||window.appCtxt;\nthis._listView[this._currentViewId]._itemToSelect=this._getNextItemToSelect();\nd.getAppController().focusContentPane();\nvar c=e._inviteReplyType;\nif(c==ZmOperation.PROPOSE_NEW_TIME){d.getApp(ZmApp.CALENDAR).getCalController().proposeNewTime(e._msg);\nif(appCtxt.isChildWindow){window.close()\n}}else{if(c==ZmOperation.ACCEPT_PROPOSAL){this._acceptProposedTime(e._inviteComponentId,e._msg)\n}else{if(c==ZmOperation.DECLINE_PROPOSAL){this._declineProposedTime(e._inviteComponentId,e._msg)\n}else{if(c==ZmOperation.INVITE_REPLY_ACCEPT||c==ZmOperation.EDIT_REPLY_CANCEL||c==ZmOperation.INVITE_REPLY_DECLINE||c==ZmOperation.INVITE_REPLY_TENTATIVE){this._editInviteReply(ZmMailListController.INVITE_REPLY_MAP[c],e._inviteComponentId,null,null,e._inviteReplyFolderId)\n}else{var f=new AjxCallback(this,this._handleInviteReplySent);\nvar b=d.multiAccounts&&d.accountList.mainAccount.name;\nthis._sendInviteReply(c,e._inviteComponentId,null,b,null,e._msg,e._inviteReplyFolderId,f)\n}}}}return false\n};\nZmMailListController.prototype._handleInviteReplySent=function(b,c){var d=this.getCurrentView().getInviteMsgView();\nif(!d||!c){return\n}d.enableToolbarButtons(c);\nd.updatePtstMsg(c)\n};\nZmMailListController.prototype._shareHandler=function(d){var f=this.getMsg();\nvar b=f?f.getAddress(AjxEmailAddress.FROM).address:null;\nif(d._buttonId==ZmOperation.SHARE_ACCEPT){var c=appCtxt.getAcceptShareDialog();\nc.setAcceptListener(this._acceptShareListener);\nc.popup(d._share,b)\n}else{if(d._buttonId==ZmOperation.SHARE_DECLINE){var e=appCtxt.getDeclineShareDialog();\ne.setDeclineListener(this._declineShareListener);\ne.popup(d._share,b)\n}}};\nZmMailListController.prototype._subscribeHandler=function(d){var c=d._subscribeReq;\nvar b;\nvar e=false;\nif(d._buttonId==ZmOperation.SUBSCRIBE_APPROVE){b=c.subscribe?ZmMsg.dlSubscribeRequestApproved:ZmMsg.dlUnsubscribeRequestApproved;\ne=true\n}else{if(d._buttonId==ZmOperation.SUBSCRIBE_REJECT){b=c.subscribe?ZmMsg.dlSubscribeRequestRejected:ZmMsg.dlUnsubscribeRequestRejected\n}}var g={DistributionListActionRequest:{_jsns:\"urn:zimbraAccount\",dl:{by:\"name\",_content:c.dl.email},action:{op:e?\"acceptSubsReq\":\"rejectSubsReq\",subsReq:{op:c.subscribe?\"subscribe\":\"unsubscribe\",_content:c.user.email}}}};\nvar f=this._subscribeResponseHandler.bind(this,b);\nappCtxt.getAppController().sendRequest({jsonObj:g,asyncMode:true,callback:f})\n};\nZmMailListController.prototype._subscribeResponseHandler=function(b,c){var d=this.getMsg();\nthis._removeActionMsg(d);\nappCtxt.setStatusMsg(b)\n};\nZmMailListController.prototype._acceptShareHandler=function(b){var c=appCtxt.getById(b._share._msgId);\nthis._removeActionMsg(c)\n};\nZmMailListController.prototype._removeActionMsg=function(d){var b=appCtxt.getById(ZmFolder.ID_TRASH);\nthis._listView[this._currentViewId]._itemToSelect=this._getNextItemToSelect();\nvar c=d.list||this.getList();\nvar e=(appCtxt.isChildWindow)?(new AjxCallback(this,this._handleAcceptShareInNewWindow)):null;\nc.moveItems({items:[d],folder:b,callback:e,closeChildWin:appCtxt.isChildWindow})\n};\nZmMailListController.prototype._declineShareHandler=ZmMailListController.prototype._acceptShareHandler;\nZmMailListController.prototype._handleAcceptShareInNewWindow=function(){window.close()\n};\nZmMailListController.prototype._createViewMenu=function(b){var c=this._toolbar[b].getButton(ZmOperation.VIEW_MENU);\nif(!c){return\n}c.setMenu(new AjxCallback(this,this._setupViewMenuItems,[b,c]));\nc.noMenuBar=true\n};\nZmMailListController.prototype._setupViewMenu=function(c){var d=this._toolbar[c].getButton(ZmOperation.VIEW_MENU);\nif(d){var b=appCtxt.getViewTypeFromId(c);\nd.setImage(ZmMailListController.GROUP_BY_ICON[b])\n}};\nZmMailListController.prototype._setupViewMenuItems=function(b,c){var f=this._viewMenu=new ZmPopupMenu(c,null,null,this);\nc.setMenu(f);\nvar d=appCtxt.isExternalAccount(),e=appCtxt.get(ZmSetting.CONVERSATIONS_ENABLED);\nif(e&&this.supportsGrouping()){this._setupGroupByMenuItems(b,f)\n}if(f.getItemCount()>0){new DwtMenuItem({parent:f,style:DwtMenuItem.SEPARATOR_STYLE})\n}this._readingPaneViewMenu=this._setupReadingPaneMenu(b,f);\nif(!d&&e){this._convOrderViewMenu=this._setupConvOrderMenu(b,f)\n}if(this.supportsSorting()){this._sortViewMenu=this._setupSortViewMenu(b,f);\nthis._groupByViewMenu=this._mailListView._getGroupByActionMenu(f,true,true)\n}return f\n};\nZmMailListController.prototype._setupSortViewMenu=function(b,e){var d=e.createMenuItem(Dwt.getNextId(\"SORT_\"),{text:ZmMsg.sortBy,style:DwtMenuItem.NO_STYLE}),c=this._mailListView._setupSortMenu(d,false);\nd.setMenu(c);\nreturn c\n};\nZmMailListController.prototype._setupColHeaderViewMenu=function(b,d){var c=this._colHeaderMenuItem=d.createMenuItem(Dwt.getNextId(\"COL_HEADER_\"),{text:ZmMsg.display,style:DwtMenuItem.NO_STYLE}),e=ZmListView.prototype._getActionMenuForColHeader.call(this._mailListView,true,c,\"view\");\nc.setMenu(e);\nreturn e\n};\nZmMailListController.prototype._setupDeleteButton=function(c){var e=this._getSearchFolder();\nvar b=(e&&e.nId==ZmFolder.ID_TRASH);\nvar h=(e&&e.nId==ZmFolder.ID_SPAM);\nvar g=c.getButton(ZmOperation.DELETE);\nvar d=c.getButton(ZmOperation.DELETE_MENU);\nvar f=(b||h)?ZmMsg.deletePermanentTooltip:ZmMsg.deleteTooltip;\nif(g){g.setToolTipContent(ZmOperation.getToolTip(ZmOperation.DELETE,this.getKeyMapName(),f),true)\n}if(d){d.setToolTipContent(ZmOperation.getToolTip(ZmOperation.DELETE_MENU,this.getKeyMapName(),f),true)\n}};\nZmMailListController.prototype._setupSpamButton=function(d){if(!d){return\n}var f=d.getOp(ZmOperation.SPAM);\nif(f){var c=this._getSearchFolderId();\nvar e=appCtxt.getById(c);\nvar h=((e&&e.nId==ZmFolder.ID_SPAM)||(!e&&c==ZmFolder.ID_SPAM)||(this._currentSearch&&this._currentSearch.folderId==ZmFolder.ID_SPAM));\nvar b=(d.isZmActionMenu);\nif(d.isZmButtonToolBar){b=d.getActionsMenu()&&d.getActionsMenu().getOp(ZmOperation.SPAM)\n}if(b){f.setText(h?ZmMsg.notJunkMarkLabel:ZmMsg.junkMarkLabel)\n}else{f.setText(h?ZmMsg.notJunkLabel:ZmMsg.junkLabel)\n}f.setImage(h?\"NotJunk\":\"JunkMail\");\nif(f.setToolTipContent){var g=h?ZmMsg.notJunkTooltip:ZmMsg.junkTooltip;\nf.setToolTipContent(ZmOperation.getToolTip(ZmOperation.SPAM,this.getKeyMapName(),g),true)\n}f.isMarkAsSpam=!h\n}};\nZmMailListController.prototype._setupPrintButton=function(b){if(!b){return\n}var c=b.getOp(ZmOperation.PRINT);\nif(c){c.setToolTipContent(ZmMsg.printMultiTooltip,true)\n}};\nZmMailListController.prototype.getMsg=function(c){var b=this._listView[this._currentViewId].getSelection();\nreturn(b&&b.length)?b[0]:null\n};\nZmMailListController.prototype._filterListener=function(b,c){if(b){this._handleResponseFilterListener(c,this._actionEv.address)\n}else{this._getLoadedMsg(null,this._handleResponseFilterListener.bind(this,c))\n}};\nZmMailListController.prototype._setAddToFilterMenu=function(c){if(this._filterMenu){return\n}var b=c.getOp(ZmOperation.ADD_TO_FILTER_RULE);\nthis._filterMenu=new ZmPopupMenu(b);\nb.setMenu(this._filterMenu);\nthis._rules=AjxDispatcher.run(\"GetFilterRules\");\nthis._rules.addChangeListener(this._rulesChangeListener.bind(this));\nthis._resetFilterMenu()\n};\nZmMailListController.prototype._resetFilterMenu=function(){var b=this._filterMenu.getItems();\nwhile(b.length>0){this._filterMenu.removeChild(b[0])\n}this._rules.loadRules(false,this._populateFiltersMenu.bind(this))\n};\nZmMailListController.prototype._populateFiltersMenu=function(e){var f=e.getResponse();\nvar h=this._filterMenu;\nvar d=new DwtMenuItem({parent:h});\nd.setText(ZmMsg.newFilter);\nd.setImage(\"Plus\");\nd.addSelectionListener(this._filterListener.bind(this,true,null));\nif(!f.size()){return\n}h.createSeparator();\nfor(var c=0;\nc<f.size();\nc++){var g=f.get(c);\nvar b=new DwtMenuItem({parent:h});\nb.setText(AjxStringUtil.clipByLength(g.name,20));\nb.addSelectionListener(this._filterListener.bind(this,true,g))\n}};\nZmMailListController.prototype._rulesChangeListener=function(b){if(b.handled||b.type!==ZmEvent.S_FILTER){return\n}this._resetFilterMenu();\nb.handled=true\n};\nZmMailListController.prototype._createApptListener=function(){this._getLoadedMsg(null,this._handleResponseNewApptListener.bind(this))\n};\nZmMailListController.prototype._createTaskListener=function(){this._getLoadedMsg(null,this._handleResponseNewTaskListener.bind(this))\n};\nZmMailListController.prototype._handleResponseNewApptListener=function(d){if(!d){return\n}if(d.cloneOf){d=d.cloneOf\n}var b=appCtxt.isChildWindow?window.opener:window;\nvar c=b.AjxDispatcher.run(\"GetCalController\");\nc.newApptFromMailItem(d,new Date());\nif(appCtxt.isChildWindow){window.close()\n}};\nZmMailListController.prototype._handleResponseNewTaskListener=function(d){if(!d){return\n}if(d.cloneOf){d=d.cloneOf\n}var b=appCtxt.isChildWindow?window.opener:window;\nvar c=appCtxt.isChildWindow?parentAppCtxt:appCtxt;\nb.AjxDispatcher.require([\"TasksCore\",\"Tasks\"]);\nc.getApp(ZmApp.TASKS).newTaskFromMailItem(d,new Date());\nif(appCtxt.isChildWindow){window.close()\n}};\nZmMailListController.prototype._handleResponseFilterListener=function(n,p){if(!p){return\n}var e=p.isZmMailMsg?p:null;\nif(e&&e.cloneOf){e=e.cloneOf\n}if(appCtxt.isChildWindow){var d=window.opener.AjxDispatcher.run(\"GetMailListController\");\nd._handleResponseFilterListener(n,p);\nwindow.close();\nreturn\n}AjxDispatcher.require([\"PreferencesCore\",\"Preferences\"]);\nvar b=!!n;\nif(n){n=this._rules.getRuleByName(n.name)||n\n}else{n=new ZmFilterRule()\n}if(e){var k=e.getListIdHeader();\nif(k){n.addCondition(ZmFilterRule.TEST_HEADER,ZmFilterRule.OP_CONTAINS,k,ZmMailMsg.HDR_LISTID)\n}else{var q=e.getAddress(AjxEmailAddress.FROM);\nif(q){var s=ZmFilterRule.C_ADDRESS_VALUE[ZmFilterRule.C_FROM];\nn.addCondition(ZmFilterRule.TEST_ADDRESS,ZmFilterRule.OP_CONTAINS,q.address,s)\n}var f=e.getAddress(AjxEmailAddress.CC);\nif(f){var s=ZmFilterRule.C_ADDRESS_VALUE[ZmFilterRule.C_CC];\nn.addCondition(ZmFilterRule.TEST_ADDRESS,ZmFilterRule.OP_CONTAINS,f.address,s)\n}var r=e.getXZimbraDLHeader();\nif(r&&r.good){var j=r.good.getArray();\nvar m=j.length<5?j.length:5;\nfor(var h=0;\nh<m;\nh++){n.addCondition(ZmFilterRule.TEST_HEADER,ZmFilterRule.OP_CONTAINS,j[h].address,ZmMailMsg.HDR_XZIMBRADL)\n}}var l=e.subject;\nif(l){var s=ZmFilterRule.C_HEADER_VALUE[ZmFilterRule.C_SUBJECT];\nn.addCondition(ZmFilterRule.TEST_HEADER,ZmFilterRule.OP_IS,l,s)\n}n.setGroupOp(ZmFilterRule.GROUP_ALL)\n}}else{var s=ZmFilterRule.C_ADDRESS_VALUE[ZmFilterRule.C_FROM];\nn.addCondition(ZmFilterRule.TEST_ADDRESS,ZmFilterRule.OP_CONTAINS,p.isAjxEmailAddress?p.address:p,s)\n}if(!b){n.addAction(ZmFilterRule.A_KEEP)\n}var o=appCtxt.multiAccounts&&e&&e.getAccount().name,c=e&&appCtxt.getById(e.getFolderId()),g=!!(c&&c.isOutbound());\nappCtxt.getFilterRuleDialog().popup(n,b,null,o,g)\n};\nZmMailListController.prototype._getLoadedMsg=function(c,e){c=c||{};\nvar b=this.getMsg(c);\nif(!b){e.run()\n}if(b._loaded&&!c.forceLoad){e.run(b)\n}else{if(b.id==this._pendingMsg){return\n}this._lastSelectedListItem=this._view[this._currentViewId].getSelection();\nb._loadPending=true;\nthis._pendingMsg=b.id;\nc.markRead=(c.markRead!=null)?c.markRead:this._handleMarkRead(b,true);\nvar d=new AjxCallback(this,ZmMailListController.prototype._handleResponseGetLoadedMsg,[e,b]);\nb.load({getHtml:c.getHtml,markRead:c.markRead,callback:d,noBusyOverlay:false,forceLoad:c.forceLoad,noTruncate:c.noTruncate})\n}};\nZmMailListController.prototype._handleResponseGetLoadedMsg=function(c,b){if(this._pendingMsg&&(b.id!=this._pendingMsg)){return\n}b._loadPending=false;\nthis._pendingMsg=null;\nc.run(b)\n};\nZmMailListController.prototype._getInviteReplyBody=function(e,b,d){var c;\nif(b){switch(e){case ZmOperation.REPLY_ACCEPT:c=ZmMsg.defaultInviteReplyAcceptInstanceMessage;\nbreak;\ncase ZmOperation.REPLY_CANCEL:c=ZmMsg.apptInstanceCanceled;\nbreak;\ncase ZmOperation.REPLY_DECLINE:c=ZmMsg.defaultInviteReplyDeclineInstanceMessage;\nbreak;\ncase ZmOperation.REPLY_TENTATIVE:c=ZmMsg.defaultInviteReplyTentativeInstanceMessage;\nbreak\n}if(d){switch(e){case ZmOperation.REPLY_ACCEPT:c=ZmMsg.defaultInviteReplyResourceAcceptInstanceMessage;\nbreak;\ncase ZmOperation.REPLY_CANCEL:c=ZmMsg.apptInstanceCanceled;\nbreak;\ncase ZmOperation.REPLY_DECLINE:c=ZmMsg.defaultInviteReplyResourceDeclineInstanceMessage;\nbreak;\ncase ZmOperation.REPLY_TENTATIVE:c=ZmMsg.defaultInviteReplyResourceTentativeInstanceMessage;\nbreak\n}}if(c){return AjxMessageFormat.format(c,b)\n}}switch(e){case ZmOperation.REPLY_ACCEPT:c=ZmMsg.defaultInviteReplyAcceptMessage;\nbreak;\ncase ZmOperation.REPLY_CANCEL:c=ZmMsg.apptCanceled;\nbreak;\ncase ZmOperation.DECLINE_PROPOSAL:c=\"\";\nbreak;\ncase ZmOperation.REPLY_DECLINE:c=ZmMsg.defaultInviteReplyDeclineMessage;\nbreak;\ncase ZmOperation.REPLY_TENTATIVE:c=ZmMsg.defaultInviteReplyTentativeMessage;\nbreak;\ncase ZmOperation.REPLY_NEW_TIME:c=ZmMsg.defaultInviteReplyNewTimeMessage;\nbreak\n}if(d){switch(e){case ZmOperation.REPLY_ACCEPT:c=ZmMsg.defaultInviteReplyResourceAcceptMessage;\nbreak;\ncase ZmOperation.REPLY_CANCEL:c=ZmMsg.apptCanceled;\nbreak;\ncase ZmOperation.REPLY_DECLINE:c=ZmMsg.defaultInviteReplyResourceDeclineMessage;\nbreak;\ncase ZmOperation.REPLY_TENTATIVE:c=ZmMsg.defaultInviteReplyResourceTentativeMessage;\nbreak;\ncase ZmOperation.REPLY_NEW_TIME:c=ZmMsg.defaultInviteReplyNewTimeMessage;\nbreak\n}}if(c){c=AjxMessageFormat.format(c,[])\n}return c\n};\nZmMailListController.prototype._getInviteReplySubject=function(b){var c=null;\nswitch(b){case ZmOperation.REPLY_ACCEPT:c=ZmMsg.subjectAccept+\": \";\nbreak;\ncase ZmOperation.DECLINE_PROPOSAL:c=ZmMsg.subjectDecline+\" - \";\nbreak;\ncase ZmOperation.REPLY_DECLINE:c=ZmMsg.subjectDecline+\": \";\nbreak;\ncase ZmOperation.REPLY_TENTATIVE:c=ZmMsg.subjectTentative+\": \";\nbreak;\ncase ZmOperation.REPLY_NEW_TIME:c=ZmMsg.subjectNewTime+\": \";\nbreak\n}return c\n};\nZmMailListController.prototype._editInviteReply=function(g,f,b,e,d){var c=this._getInviteReplyBody(g,b);\nthis._doAction({action:g,extraBodyText:c,instanceDate:b,accountName:e,acceptFolderId:d})\n};\nZmMailListController.prototype._acceptProposedTime=function(e,b){var d=b.invite;\nvar g=d.getAppointmentId();\nvar f=window.parentAppCtxt||window.appCtxt;\nvar c=f.getApp(ZmApp.CALENDAR).getCalController();\nvar h=new AjxCallback(this,this._handleAcceptDeclineProposedTime,[b]);\nc.acceptProposedTime(g,d,appCtxt.isChildWindow?null:h);\nif(appCtxt.isChildWindow){window.close()\n}};\nZmMailListController.prototype._declineProposedTime=function(d,b){var c=this._getInviteReplyBody(ZmOperation.DECLINE_PROPOSAL);\nvar e=new AjxCallback(this,this._handleAcceptDeclineProposedTime,[b]);\nthis._doAction({action:ZmOperation.DECLINE_PROPOSAL,extraBodyText:c,instanceDate:null,sendMsgCallback:e})\n};\nZmMailListController.prototype._handleAcceptDeclineProposedTime=function(b){this._doDelete([b])\n};\nZmMailListController.prototype._sendInviteReply=function(f,r,s,c,n,m,t,g){var h=new ZmMailMsg();\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\"]);\nh._origMsg=m||this.getMsg();\nh.inviteMode=f;\nh.isReplied=true;\nh.isForwarded=false;\nh.isInviteReply=true;\nh.acceptFolderId=t;\nh.folderId=h._origMsg.folderId;\nvar b=ZmMailListController.REPLY_ACTION_MAP[f]?ZmMailListController.REPLY_ACTION_MAP[f]:f;\nvar e=this._getInviteReplyBody(b,s,h._origMsg.isResourceInvite());\nif(e!=null){var k=new ZmAppt();\nk.setFromMessage(h._origMsg);\nvar o=k.getTextSummary()+\"\\n\"+e;\nvar p=new ZmMimePart();\np.setContentType(ZmMimeTable.TEXT_PLAIN);\np.setContent(o);\nvar q=k.getHtmlSummary()+\"<p>\"+e+\"</p>\";\nvar l=new ZmMimePart();\nl.setContentType(ZmMimeTable.TEXT_HTML);\nl.setContent(q);\nvar d=new ZmMimePart();\nd.setContentType(ZmMimeTable.MULTI_ALT);\nd.children.add(p);\nd.children.add(l);\nh.setTopPart(d)\n}var j=this._getInviteReplySubject(b)+h._origMsg.invite.getEventName();\nif(j!=null){h.setSubject(j)\n}var i=new AjxCallback(this,this._handleErrorInviteReply);\nh.sendInviteReply(true,r,g,i,s,c,n)\n};\nZmMailListController.prototype._handleErrorInviteReply=function(b){if(b.code==ZmCsfeException.MAIL_NO_SUCH_ITEM){var c=appCtxt.getErrorDialog();\nc.setMessage(ZmMsg.inviteOutOfDate);\nc.popup(null,true);\nreturn true\n}};\nZmMailListController.prototype._spamListener=function(d){var b=this._listView[this._currentViewId].getSelection();\nvar c=this.getCurrentToolbar().getButton(ZmOperation.SPAM);\nthis._doSpam(b,c.isMarkAsSpam)\n};\nZmMailListController.prototype._detachListener=function(b,d){var c=this.getMsg();\nif(c){if(c._loaded){ZmMailMsgView.detachMsgInNewWindow(c,false,this);\nif(c.isUnread&&!appCtxt.getById(c.folderId).isReadOnly()){c.list.markRead({items:[c],value:true})\n}}else{ZmMailMsgView.rfc822Callback(c.id,null,this)\n}}if(d){d.run()\n}};\nZmMailListController.prototype._printListener=function(k){var m=this._listView[this._currentViewId];\nvar h=m.getSelection();\nh=AjxUtil.toArray(h);\nvar b=[];\nvar l=false;\nfor(var g=0;\ng<h.length;\ng++){var n=h[g];\nif(n.toString()==\"ZmConv\"){if(appCtxt.isOffline&&n.id.split(\":\")[1]<0){b.push(n.msgIds[0])\n}else{b.push(\"C:\"+n.id)\n}if(n.isZmConv){var f=n.getMsgList();\nfor(var e=0;\ne<f.length;\ne++){if(f[e].showImages){l=true;\nbreak\n}}}}else{b.push(n.id);\nif(n.showImages){l=true\n}}}var c=(\"/h/printmessage?id=\"+b.join(\",\"))+\"&tz=\"+AjxTimezone.getServerId(AjxTimezone.DEFAULT);\nif(appCtxt.get(ZmSetting.DISPLAY_EXTERNAL_IMAGES)||l){c=c+\"&xim=1\"\n}if(appCtxt.isOffline){var d=h[0].getAccount().name;\nc+=\"&acct=\"+d\n}window.open(appContextPath+c,\"_blank\")\n};\nZmMailListController.prototype._editListener=function(b,c){this._doAction({ev:c,action:ZmOperation.DRAFT,isEditAsNew:b})\n};\nZmMailListController.prototype._muteUnmuteConvListener=function(c){var b=this._getConvMuteStatus();\nif(b.hasUnmuteConv){this._muteConvListener()\n}else{this._unmuteConvListener()\n}};\nZmMailListController.prototype._muteConvListener=function(e){var b=this._listView[this._currentView];\nvar c=b.getSelection();\nc=AjxUtil.toArray(c);\nvar d=this._getMarkReadCallback();\nvar f=new AjxCallback(this,this._handleMuteUnmuteConvResponse,[d,ZmId.OP_MUTE_CONV]);\nthis._doMarkMute(c,true,f,true)\n};\nZmMailListController.prototype._unmuteConvListener=function(e){var b=this._listView[this._currentView];\nvar c=b.getSelection();\nc=AjxUtil.toArray(c);\nvar f=this._mailListView||this._parentController._mailListView;\nvar d=null;\nif(f&&f.toString()==\"ZmConvListView\"){d=new AjxCallback(f,f.handleUnmuteConv,c)\n}var g=new AjxCallback(this,this._handleMuteUnmuteConvResponse,[d,ZmId.OP_UNMUTE_CONV]);\nthis._doMarkMute(c,false,g,true)\n};\nZmMailListController.prototype._handleMuteUnmuteConvResponse=function(d,c,b){if(d!=null){d.run()\n}};\nZmMailListController.prototype._checkMailListener=function(){if(appCtxt.isOffline){var h=new AjxCallback(this,this._handleSyncAll);\nappCtxt.accountList.syncAll(h)\n}var d=this._getSearchFolder();\nvar f=(d&&d.isFeed());\nif(f){d.sync()\n}else{var e=false;\nif(!appCtxt.isOffline){var b=appCtxt.get(ZmSetting.POP_ACCOUNTS_ENABLED)||appCtxt.get(ZmSetting.IMAP_ACCOUNTS_ENABLED);\nif(d&&!f&&b){var g=d.getDataSources(null,true);\nif(g){e=true;\nvar c=AjxDispatcher.run(\"GetDataSourceCollection\");\nc.importMail(g)\n}}}if((d&&d.nId==ZmFolder.ID_INBOX)||!e){appCtxt.getAppController().sendNoOp()\n}}};\nZmMailListController.prototype._handleSyncAll=function(){};\nZmMailListController.prototype.runRefresh=function(){this._checkMailListener()\n};\nZmMailListController.prototype._sendReceiveListener=function(b){var c=appCtxt.accountList.getAccount(b.item.getData(ZmOperation.MENUITEM_ID));\nif(c){c.sync()\n}};\nZmMailListController.prototype._folderSearch=function(b){appCtxt.getSearchController().search({query:\"in:\"+ZmFolder.QUERY_NAME[b]})\n};\nZmMailListController.prototype._setupGroupByMenuItems=function(b,e){for(var d=0;\nd<ZmMailListController.GROUP_BY_VIEWS.length;\nd++){var f=ZmMailListController.GROUP_BY_VIEWS[d];\nvar c=e.createMenuItem(f,{image:ZmMailListController.GROUP_BY_ICON[f],text:ZmMsg[ZmMailListController.GROUP_BY_MSG_KEY[f]],shortcut:ZmMailListController.GROUP_BY_SHORTCUT[f],style:DwtMenuItem.RADIO_STYLE});\nc.setData(ZmOperation.MENUITEM_ID,f);\nc.addSelectionListener(this._listeners[ZmOperation.VIEW]);\nif(f==this.getDefaultViewType()){c.setChecked(true,true)\n}}};\nZmMailListController.prototype._setReplyText=function(c){if(c&&appCtxt.get(ZmSetting.REPLY_MENU_ENABLED)){var e=c.getOp(ZmOperation.REPLY_MENU);\nif(e){var d=e.getMenu();\nvar b=d.getOp(ZmOperation.REPLY);\nb.setText(ZmMsg.replySender)\n}}};\nZmMailListController.prototype._resetOperations=function(m,i){ZmListController.prototype._resetOperations.call(this,m,i);\nvar g=appCtxt.isWebClientOffline();\nm.enable(ZmOperation.PRINT,(i>0)&&!g);\nm.enable(ZmOperation.SHOW_ORIG,!g);\nif(this.isSyncFailuresFolder()){m.enableAll(false);\nm.enable([ZmOperation.NEW_MENU],true);\nm.enable([ZmOperation.DELETE,ZmOperation.FORWARD],i>0);\nreturn\n}var o;\nif(i==1&&!this.isDraftsFolder()){var d=this._listView[this._currentViewId].getSelection();\nif(d&&d.length){o=d[0]\n}}var j=o&&o.folderId&&appCtxt.getById(o.folderId);\nvar b=j;\nif(!b){var c=this._getSearchFolderId(true);\nb=c&&appCtxt.getById(c)\n}var n=(o&&o.isDraft&&(o.type!=ZmId.ITEM_CONV||o.numMsgs==1))||this.isDraftsFolder();\nvar f=(b&&b.isFeed());\nvar k=(b&&b.isReadOnly());\nvar e=this.isOutboxFolder();\nm.setItemVisible(ZmOperation.EDIT,(n||e)&&(!b||!b.isReadOnly()));\nm.setItemVisible(ZmOperation.EDIT_AS_NEW,!(n||e));\nm.setItemVisible(ZmOperation.REDIRECT,!(n||e));\nm.enable(ZmOperation.REDIRECT,!(n||e||g));\nm.setItemVisible(ZmOperation.MARK_READ,!(n||e));\nm.setItemVisible(ZmOperation.MARK_UNREAD,!(n||e));\nm.setItemVisible(ZmOperation.FLAG,!(n||e));\nm.setItemVisible(ZmOperation.UNFLAG,!(n||e));\nm.setItemVisible(ZmOperation.SPAM,!(n||e));\nm.setItemVisible(ZmOperation.DETACH,!(n||e));\nm.enable(ZmOperation.MOVE_MENU,!(n||e)&&i>0);\nm.enable(ZmOperation.DETACH,(appCtxt.get(ZmSetting.DETACH_MAILVIEW_ENABLED)&&!(n||e||g)&&i==1));\nm.setItemVisible(ZmOperation.ADD_FILTER_RULE,!(n||e));\nm.setItemVisible(ZmOperation.CREATE_APPT,!(n||e));\nm.setItemVisible(ZmOperation.CREATE_TASK,!(n||e));\nm.setItemVisible(ZmOperation.ACTIONS_MENU,!e);\nvar h=appCtxt.isChildWindow&&window.newWindowParams&&window.newWindowParams.isRfc822;\nif(h||(k&&i>0)){m.enable([ZmOperation.DELETE,ZmOperation.MOVE,ZmOperation.MOVE_MENU,ZmOperation.SPAM,ZmOperation.TAG_MENU],false)\n}else{m.enable([ZmOperation.REPLY,ZmOperation.REPLY_ALL],(!(n||e)&&!f&&i==1));\nm.enable([ZmOperation.VIEW_MENU],true);\nm.enable([ZmOperation.FORWARD,ZmOperation.SPAM],(!(n||e)&&i>0))\n}if(this._draftsActionMenu){var l=this._draftsActionMenu.getOp(ZmOperation.EDIT);\nif(l){l.setEnabled(i==1&&(this.isDraftsFolder()||!k))\n}}var p=appCtxt.getCurrentSearch();\nif(appCtxt.multiAccounts&&i>1&&p&&p.isMultiAccount()){m.enable(ZmOperation.TAG_MENU,false)\n}if(appCtxt.isExternalAccount()){m.enable([ZmOperation.REPLY,ZmOperation.REPLY_ALL,ZmOperation.FORWARD,ZmOperation.EDIT_AS_NEW,ZmOperation.REDIRECT,ZmOperation.MARK_READ,ZmOperation.MARK_UNREAD,ZmOperation.SPAM,ZmOperation.MOVE,ZmOperation.MOVE_MENU,ZmOperation.DELETE,ZmOperation.DETACH,ZmOperation.ADD_FILTER_RULE,ZmOperation.CREATE_APPT,ZmOperation.SEARCH_TO,ZmOperation.SEARCH,ZmOperation.CREATE_TASK],false);\nm.setItemVisible(ZmOperation.TAG_MENU,false)\n}this._cleanupToolbar(m)\n};\nZmMailListController.prototype._showMailItem=function(){var d=appCtxt.getAppViewMgr();\nthis._setup(this._currentViewId);\nvar g=this.getViewElements(this._currentViewId,this._view[this._currentViewId]);\nvar b=d.getCurrentViewId();\nvar e=ZmMailListController.viewToTab[b]||Dwt.getNextId();\nZmMailListController.viewToTab[this._currentViewId]=e;\nvar c={view:this._currentViewId,viewType:this._currentViewType,elements:g,hide:this._elementsToHide,clear:appCtxt.isChildWindow,tabParams:this._getTabParams(e,this._tabCallback.bind(this))};\nvar f=(this._conv&&this._conv.subject)?this._conv.subject.substr(0,ZmAppViewMgr.TAB_BUTTON_MAX_TEXT):(this._msg&&this._msg.subject&&this._msg.subject.substr(0,ZmAppViewMgr.TAB_BUTTON_MAX_TEXT))||ZmMsgController.DEFAULT_TAB_TEXT;\nthis._setView(c);\nd.setTabTitle(this._currentViewId,f);\nthis._resetOperations(this._toolbar[this._currentViewId],1);\nthis._resetNavToolBarButtons()\n};\nZmMailListController.prototype._cleanupToolbar=function(b){if(!b.getActionsMenu){return\n}var c=b.getActionsMenu();\nif(!c){return\n}c.cleanupSeparators()\n};\nZmMailListController.prototype._enableFlags=function(c){if(appCtxt.isExternalAccount()){c.enable([ZmOperation.MARK_READ,ZmOperation.MARK_UNREAD,ZmOperation.FLAG,ZmOperation.UNFLAG],false);\nreturn\n}var b=this._getReadStatus();\nc.enable(ZmOperation.MARK_READ,b.hasUnread);\nc.enable(ZmOperation.MARK_UNREAD,b.hasRead);\nc.enable(ZmOperation.FLAG,b.hasUnflagged);\nc.enable(ZmOperation.UNFLAG,b.hasFlagged);\nif(appCtxt.isWebClientOffline()){c.enable([ZmOperation.ADD_FILTER_RULE,ZmOperation.CREATE_APPT,ZmOperation.CREATE_TASK],false)\n}};\nZmMailListController.prototype._enableMuteUnmute=function(c){c.enable([ZmOperation.UNMUTE_CONV,ZmOperation.MUTE_CONV],false);\nif(appCtxt.isExternalAccount()||appCtxt.isChildWindow||this._app.getGroupMailBy()===ZmItem.MSG){return\n}var b=this._getConvMuteStatus();\nif(b.hasMuteConv&&b.hasUnmuteConv){c.enable(ZmOperation.UNMUTE_CONV,true);\nc.enable(ZmOperation.MUTE_CONV,true)\n}else{if(b.hasMuteConv){c.enable(ZmOperation.UNMUTE_CONV,true)\n}else{c.enable(ZmOperation.MUTE_CONV,true)\n}}};\nZmMailListController.prototype.pageItemSilently=function(d,b,e){var c=this._getNextItem(d,b);\nif(c){if(e){e.inactive=true\n}var f=this._listView[this._currentViewId];\nf.emulateDblClick(c)\n}};\nZmMailListController.prototype._getNextItem=function(e,c){var g=this._list.getArray();\nvar b=g.length;\nfor(var d=0;\nd<b;\nd++){if(e==g[d]){break\n}}if(d==b){return\n}var f=c?d+1:d-1;\nif(f>=b){if(!this._list.hasMore()){return\n}this._paginate(this._currentViewId,true,f);\nreturn\n}return g[f]\n};\nZmMailListController.prototype._handleResponsePaginate=function(c,e,d,g,b){ZmListController.prototype._handleResponsePaginate.apply(this,arguments);\nvar f=d?this._list.getVector().get(d):null;\nif(f){this._listView[this._currentViewId].emulateDblClick(f)\n}};\nZmMailListController.prototype._getMenuContext=function(){return this.getCurrentViewId()\n};\nZmMailListController.prototype._doFlag=function(c,b){ZmListController.prototype._doFlag.call(this,c,b);\nappCtxt.notifyZimlets(\"onMailFlagClick\",[c,b])\n};\nZmMailListController.prototype._doTag=function(c,b,d){ZmListController.prototype._doTag.call(this,c,b,d);\nappCtxt.notifyZimlets(\"onTagAction\",[c,b,d])\n};\nZmMailListController.prototype._getUnreadItem=function(g,k,h){var e=this._listView[this._currentViewId];\nvar d=e.getList(true);\nvar j=d&&d.getArray();\nvar n=j&&j.length;\nif(!n){return\n}var b,i;\nif(g==DwtKeyMap.SELECT_FIRST){i=0\n}else{if(g==DwtKeyMap.SELECT_LAST){i=j.length-1\n}else{var c=e.getSelection();\nvar b,i;\nif(c&&c.length){b=(g==DwtKeyMap.SELECT_NEXT)?c[c.length-1]:c[0]\n}else{b=(g==DwtKeyMap.SELECT_NEXT)?j[0]:j[j.length-1]\n}if(b){var l=e.getItemIndex(b,true);\nif(c&&c.length&&!h){i=(g==DwtKeyMap.SELECT_NEXT)?l+1:l-1\n}else{i=l\n}}}}var f=null;\nwhile((i>=0&&i<n)&&!f){var m=j[i];\nif(m.isUnread&&(!k||m.type==k)){f=m\n}else{i=(g==DwtKeyMap.SELECT_NEXT||g==DwtKeyMap.SELECT_FIRST)?i+1:i-1\n}}return f\n};\nZmMailListController.prototype._getNextItemToSelect=function(){};\nZmMailListController.prototype.addTrustedAddr=function(f,g,b){var d=AjxSoapDoc.create(\"ModifyPrefsRequest\",\"urn:zimbraAccount\"),e,c;\nfor(c=0;\nc<f.length;\nc++){e=d.set(\"pref\",AjxStringUtil.trim(f[c]));\ne.setAttribute(\"name\",\"zimbraPrefMailTrustedSenderList\")\n}return appCtxt.getAppController().sendRequest({soapDoc:d,asyncMode:true,callback:g,errorCallback:b})\n};\nZmMailListController.prototype._getActiveSearchFolderId=function(){var b=this._activeSearch&&this._activeSearch.search;\nreturn b&&b.folderId\n};\nZmMailListController.prototype._getActiveSearchFolder=function(){var b=this._getActiveSearchFolderId();\nreturn b&&appCtxt.getById(b)\n};\nZmMailListController.prototype._doDelete=function(d,c,e,b){var g=AjxUtil.toArray(d);\nif(!g.length){return\n}var f=this._doRetentionPolicyWarning(g,ZmListController.prototype._doDelete,[c,e,false]);\nif(!f){ZmListController.prototype._doDelete.call(this,g,c,e,b)\n}};\nZmMailListController.prototype._doMove=function(c,g,d,b){var f=AjxUtil.toArray(c);\nif(!f.length){return\n}var e=false;\nif(g&&(g.nId==ZmFolder.ID_TRASH)){e=this._doRetentionPolicyWarning(f,ZmListController.prototype._doMove,[g,d,b])\n}if(!e){ZmListController.prototype._doMove.call(this,c,g,d,b)\n}};\nZmMailListController.prototype._doRetentionPolicyWarning=function(g,n,l){var k=0;\nvar d;\nvar b;\nvar e=new Date();\nvar j=[];\nvar m={};\nfor(var h=0;\nh<g.length;\nh++){var c=g[h].folderId;\nif(!m[c]){m[c]=-1;\nd=appCtxt.getById(c);\nb=(d?d.getRetentionPolicy(ZmOrganizer.RETENTION_KEEP):null);\nif(b){var f=d.getRetentionPolicyLifetimeMsec(b);\nm[c]=e.getTime()-f\n}}if(m[c]>0){if(g[h].date<m[c]){j.push(g[h])\n}}else{j.push(g[h])\n}}k=g.length-j.length;\nif(k>0){var o=((k==1)?ZmMsg.retentionKeepWarning:AjxMessageFormat.format(ZmMsg.retentionKeepWarnings,[k.toString()]))+\"<BR><BR>\";\nif(j.length==0){this._showSimpleRetentionWarning(o,g,n,l)\n}else{o+=ZmMsg.retentionDeleteAllExplanation+\"<BR><BR>\"+((j.length==1)?ZmMsg.retentionDeleteValidExplanation:AjxMessageFormat.format(ZmMsg.retentionDeleteValidExplanations,[j.length.toString()]));\nthis._showRetentionWarningDialog(o,g,j,n,l)\n}}return k!=0\n};\nZmMailListController.prototype._showSimpleRetentionWarning=function(c,f,b,d){c+=(f.length==1)?ZmMsg.retentionDeleteOne:ZmMsg.retentionDeleteMultiple;\nvar e=[f].concat(d);\nvar h=new AjxCallback(this,b,e);\nvar g=appCtxt.getOkCancelMsgDialog();\ng.registerCallback(DwtDialog.OK_BUTTON,this._handleRetentionWarningOK,this,[g,h]);\ng.setMessage(c,DwtMessageDialog.WARNING_STYLE);\ng.setVisible(true);\ng.popup()\n};\nZmMailListController.prototype._showRetentionWarningDialog=function(i,c,d,h,e){var j=appCtxt.getRetentionWarningDialog();\nj.reset();\nvar g;\nvar b=[c].concat(e);\ng=new AjxCallback(this,h,b);\nj.registerCallback(ZmRetentionWarningDialog.DELETE_ALL_BUTTON,this._handleRetentionWarningOK,this,[j,g]);\nvar f=[d].concat(e);\ng=new AjxCallback(this,h,f);\nj.registerCallback(ZmRetentionWarningDialog.DELETE_VALID_BUTTON,this._handleRetentionWarningOK,this,[j,g]);\nj.setMessage(i,DwtMessageDialog.WARNING_STYLE);\nj.setVisible(true);\nj.popup()\n};\nZmMailListController.prototype._handleRetentionWarningOK=function(b,c){b.popdown();\nc.run()\n};\nZmMailListController.prototype._setStatics=function(){if(!ZmMailListController.INVITE_REPLY_MAP){ZmMailListController.INVITE_REPLY_MAP={};\nZmMailListController.INVITE_REPLY_MAP[ZmOperation.INVITE_REPLY_ACCEPT]=ZmOperation.REPLY_ACCEPT;\nZmMailListController.INVITE_REPLY_MAP[ZmOperation.INVITE_REPLY_DECLINE]=ZmOperation.REPLY_DECLINE;\nZmMailListController.INVITE_REPLY_MAP[ZmOperation.INVITE_REPLY_TENTATIVE]=ZmOperation.REPLY_TENTATIVE;\nZmMailListController.REPLY_ACTION_MAP={};\nZmMailListController.REPLY_ACTION_MAP[ZmOperation.REPLY_ACCEPT_NOTIFY]=ZmOperation.REPLY_ACCEPT;\nZmMailListController.REPLY_ACTION_MAP[ZmOperation.REPLY_ACCEPT_IGNORE]=ZmOperation.REPLY_ACCEPT;\nZmMailListController.REPLY_ACTION_MAP[ZmOperation.REPLY_DECLINE_NOTIFY]=ZmOperation.REPLY_DECLINE;\nZmMailListController.REPLY_ACTION_MAP[ZmOperation.REPLY_DECLINE_IGNORE]=ZmOperation.REPLY_DECLINE;\nZmMailListController.REPLY_ACTION_MAP[ZmOperation.REPLY_TENTATIVE_NOTIFY]=ZmOperation.REPLY_TENTATIVE;\nZmMailListController.REPLY_ACTION_MAP[ZmOperation.REPLY_TENTATIVE_IGNORE]=ZmOperation.REPLY_TENTATIVE;\nZmMailListController.ACTION_CODE_TO_OP={};\nZmMailListController.ACTION_CODE_TO_OP[ZmKeyMap.REPLY]=ZmOperation.REPLY;\nZmMailListController.ACTION_CODE_TO_OP[ZmKeyMap.REPLY_ALL]=ZmOperation.REPLY_ALL;\nZmMailListController.ACTION_CODE_TO_OP[ZmKeyMap.FORWARD_INLINE]=ZmOperation.FORWARD_INLINE;\nZmMailListController.ACTION_CODE_TO_OP[ZmKeyMap.FORWARD_ATT]=ZmOperation.FORWARD_ATT\n}};\nZmMailListController.prototype.supportsGrouping=function(){return true\n}\n}if(AjxPackage.define(\"zimbraMail.mail.controller.ZmDoublePaneController\")){ZmDoublePaneController=function(b,d,c,f,e){if(arguments.length==0){return\n}ZmMailListController.apply(this,arguments);\nif(this.supportsDnD()){this._dragSrc=new DwtDragSource(Dwt.DND_DROP_MOVE);\nthis._dragSrc.addDragListener(this._dragListener.bind(this))\n}this._listSelectionShortcutDelayAction=new AjxTimedAction(this,this._listSelectionTimedAction);\nthis._listeners[ZmOperation.KEEP_READING]=this._keepReadingListener.bind(this)\n};\nZmDoublePaneController.prototype=new ZmMailListController;\nZmDoublePaneController.prototype.constructor=ZmDoublePaneController;\nZmDoublePaneController.prototype.isZmDoublePaneController=true;\nZmDoublePaneController.prototype.toString=function(){return\"ZmDoublePaneController\"\n};\nZmDoublePaneController.LIST_SELECTION_SHORTCUT_DELAY=300;\nZmDoublePaneController.RP_IDS=[ZmSetting.RP_BOTTOM,ZmSetting.RP_RIGHT,ZmSetting.RP_OFF];\nZmDoublePaneController.DEFAULT_TAB_TEXT=ZmMsg.conversation;\nZmDoublePaneController.prototype.show=function(e,g,h,d){ZmMailListController.prototype.show.call(this,e);\nvar k=this._listView[this._currentViewId];\nvar j=e&&e.search;\nvar c=j&&(j.isRefresh||j.isRedo);\nvar i=(c&&k&&k.hasItem(j.selectedItem)&&j.selectedItem);\nif(this._doublePaneView){if(!i){this._doublePaneView._itemView.reset()\n}}this.setList(g);\nthis._setup(this._currentViewId);\nk=this._listView[this._currentViewId];\nk.reset();\nthis._displayResults(this._currentViewId,null,i);\nif(i){k.setSelection(i,true);\nthis._resetOperations(this._toolbar[this._currentViewId],1)\n}else{var f=this._doublePaneView;\nvar b=this.isReadingPaneOn();\nif(f.isReadingPaneVisible()!=b){f.setReadingPane()\n}if(!this._itemViewCurrent()){f.clearItem()\n}}if(h){h.run()\n}};\nZmDoublePaneController.prototype._itemViewCurrent=function(){var d=this._doublePaneView;\nvar c=d._mailListView;\nc._restoreState();\nvar g=d.getItem();\nif(g){var h=c.getSelection();\nfor(var e=0,b=h.length;\ne<b;\ne++){var f=h[e];\nif(f.id==g.id){return true\n}}}return false\n};\nZmDoublePaneController.prototype.switchView=function(b,f){if(b===ZmSetting.RP_OFF||b===ZmSetting.RP_BOTTOM||b===ZmSetting.RP_RIGHT){this._mailListView._colHeaderActionMenu=null;\nvar c=this._getReadingPanePref();\nif(b!==c){var e=this._convView;\nif(e){var d=e._replyView;\nif(d&&b===ZmSetting.RP_OFF){if(!f&&!e._controller.popShield(null,this.switchView.bind(this,b,true))){this._readingPaneViewMenu.getMenuItem(c)._setChecked(true);\nreturn\n}this._readingPaneViewMenu.getMenuItem(b)._setChecked(true);\nd.reset()\n}}this._setReadingPanePref(b);\nthis._doublePaneView.setReadingPane(true);\nif(d&&b!==ZmSetting.RP_OFF){d._resized()\n}}}else{ZmMailListController.prototype.switchView.apply(this,arguments)\n}this._resetNavToolBarButtons()\n};\nZmDoublePaneController.prototype.reset=function(){if(this._doublePaneView){this._doublePaneView.reset()\n}var b=this._listView[this._currentViewId];\nif(b){b._itemToSelect=b._selectedItem=null\n}};\nZmDoublePaneController.prototype._handleResponseSwitchView=function(b){this._doublePaneView.setItem(b)\n};\nZmDoublePaneController.prototype.handleDelete=function(){return false\n};\nZmDoublePaneController.prototype.handleKeyAction=function(b,c){var d=this._listView[this._currentViewId];\nswitch(b){case DwtKeyMap.SELECT_NEXT:case DwtKeyMap.SELECT_PREV:if(d){return d.handleKeyAction(b,c)\n}break;\ndefault:return ZmMailListController.prototype.handleKeyAction.apply(this,arguments)\n}return true\n};\nZmDoublePaneController.prototype._createDoublePaneView=function(){};\nZmDoublePaneController.prototype._initialize=function(b){if(!this._doublePaneView){var c=this._doublePaneView=this._createDoublePaneView();\nthis._mailListView=c.getMailListView();\nc.addInviteReplyListener(this._inviteReplyListener);\nc.addShareListener(this._shareListener);\nc.addSubscribeListener(this._subscribeListener)\n}ZmMailListController.prototype._initialize.call(this,b)\n};\nZmDoublePaneController.prototype._initializeNavToolBar=function(b){var c=this._toolbar[b];\nthis._itemCountText[ZmSetting.RP_BOTTOM]=c.getButton(ZmOperation.TEXT);\nif(AjxEnv.isFirefox){this._itemCountText[ZmSetting.RP_BOTTOM].setScrollStyle(Dwt.CLIP)\n}};\nZmDoublePaneController.prototype._getRightSideToolBarOps=function(){var b=[];\nif(appCtxt.isChildWindow){return b\n}b.push(ZmOperation.KEEP_READING);\nb.push(ZmOperation.VIEW_MENU);\nreturn b\n};\nZmDoublePaneController.prototype._getActionMenuOps=function(){var b=[];\nb=b.concat(this._msgOps());\nb.push(ZmOperation.SEP);\nb=b.concat(this._deleteOps());\nb.push(ZmOperation.SEP);\nb=b.concat(this._standardActionMenuOps());\nb.push(ZmOperation.SEP);\nb=b.concat(this._flagOps());\nb.push(ZmOperation.SEP);\nb.push(ZmOperation.REDIRECT);\nb.push(ZmOperation.EDIT_AS_NEW);\nb.push(ZmOperation.SEP);\nb=b.concat(this._createOps());\nb.push(ZmOperation.SEP);\nb=b.concat(this._otherOps());\nif(this.getCurrentViewType()==ZmId.VIEW_TRAD){b.push(ZmOperation.SHOW_CONV)\n}return b\n};\nZmDoublePaneController.prototype._createNewView=function(){if(this._mailListView&&this._dragSrc){this._mailListView.setDragSource(this._dragSrc)\n}return this._mailListView\n};\nZmDoublePaneController.prototype.getCurrentView=function(){return this._doublePaneView\n};\nZmDoublePaneController.prototype.getReferenceView=ZmDoublePaneController.prototype.getCurrentView;\nZmDoublePaneController.prototype.getItemView=function(){return this._doublePaneView&&this._doublePaneView._itemView\n};\nZmDoublePaneController.prototype._getTagMenuMsg=function(b){return AjxMessageFormat.format(ZmMsg.tagMessages,b)\n};\nZmDoublePaneController.prototype._getMoveDialogTitle=function(b){return AjxMessageFormat.format(ZmMsg.moveMessages,b)\n};\nZmDoublePaneController.prototype._initializeTabGroup=function(b){if(this._tabGroups[b]){return\n}ZmListController.prototype._initializeTabGroup.apply(this,arguments);\nif(this._view[b]!==this.getItemView()){this._tabGroups[b].addMember(this.getItemView().getTabGroupMember())\n}};\nZmDoublePaneController.prototype._setViewContents=function(b){this._doublePaneView.setList(this._list)\n};\nZmDoublePaneController.prototype._displayItem=function(b){if(!b._loaded){return\n}appCtxt.killMarkReadTimer();\nthis._doublePaneView.setItem(b);\nthis._handleMarkRead(b);\nthis._curItem=b\n};\nZmDoublePaneController.prototype._displayMsg=ZmDoublePaneController.prototype._displayItem;\nZmDoublePaneController.prototype._markReadAction=function(b){this._doMarkRead([b],true)\n};\nZmDoublePaneController.prototype._preHideCallback=function(){appCtxt.killMarkReadTimer();\nreturn ZmController.prototype._preHideCallback.call(this)\n};\nZmDoublePaneController.prototype._setupReadingPaneMenu=function(h,d){var g=d.createMenuItem(Dwt.getNextId(\"READING_PANE_\"),{text:ZmMsg.readingPane,style:DwtMenuItem.NO_STYLE}),k=new ZmPopupMenu(g);\nvar j={text:ZmMsg.readingPaneAtBottom,style:DwtMenuItem.RADIO_STYLE,radioGroupId:\"RP\"};\nvar b=ZmDoublePaneController.RP_IDS;\nvar l=this._getReadingPanePref();\nfor(var e=0;\ne<b.length;\ne++){var c=b[e];\nif(!k._menuItems[c]){j.text=ZmMailListController.READING_PANE_TEXT[c];\nj.image=ZmMailListController.READING_PANE_ICON[c];\nvar f=k.createMenuItem(c,j);\nf.setData(ZmOperation.MENUITEM_ID,c);\nf.addSelectionListener(this._listeners[ZmOperation.VIEW]);\nif(c==l){f.setChecked(true,true)\n}}}g.setMenu(k);\nreturn k\n};\nZmDoublePaneController.prototype._displayResults=function(b,i,h){var f=this.getViewElements(b,this._doublePaneView);\nif(!h){this._doublePaneView.setReadingPane()\n}var d=i&&Dwt.getNextId();\nthis._setView({view:b,noPush:this.isSearchResults,viewType:this._currentViewType,elements:f,hide:this._elementsToHide,tabParams:i&&this._getTabParams(d,this._tabCallback.bind(this)),isAppView:this._isTopLevelView()});\nif(this.isSearchResults){appCtxt.getAppViewMgr().setViewComponents(this.searchResultsController.getCurrentViewId(),f,true)\n}this._resetNavToolBarButtons(b);\nif(i){var e=(this._conv&&this._conv.subject)?this._conv.subject.substr(0,ZmAppViewMgr.TAB_BUTTON_MAX_TEXT):ZmDoublePaneController.DEFAULT_TAB_TEXT;\nvar c=appCtxt.getAppViewMgr();\nc.setTabTitle(b,e)\n}var g=this._doublePaneView.getSize();\nthis._doublePaneView._resetSize(g.x,g.y)\n};\nZmDoublePaneController.prototype._getTabParams=function(c,b){return{id:c,image:\"ConvView\",textPrecedence:85,tooltip:ZmDoublePaneController.DEFAULT_TAB_TEXT,tabCallback:b}\n};\nZmDoublePaneController.prototype._doGetMsg=function(b){if(!b){return\n}if(b.id==this._pendingMsg){return\n}b._loadPending=true;\nthis._pendingMsg=b.id;\nvar c=new AjxCallback(this,this._handleResponseDoGetMsg,b);\nb.load({callback:c,noBusyOverlay:true})\n};\nZmDoublePaneController.prototype._handleResponseDoGetMsg=function(b){if(this._pendingMsg&&(b.id!=this._pendingMsg)){return\n}b._loadPending=false;\nthis._pendingMsg=null;\nthis._doublePaneView.setItem(b)\n};\nZmDoublePaneController.prototype._resetOperations=function(d,c){ZmMailListController.prototype._resetOperations.call(this,d,c);\nvar b=this.isDraftsFolder();\nif(c==1){var f=this._mailListView.getSelection()[0];\nif(f){b=f.isDraft\n}d.enable(ZmOperation.SHOW_ORIG,true);\nif(appCtxt.get(ZmSetting.FILTERS_ENABLED)){var e=this.isSyncFailuresFolder();\nd.enable(ZmOperation.ADD_FILTER_RULE,!e)\n}}d.enable(ZmOperation.DETACH,(appCtxt.get(ZmSetting.DETACH_MAILVIEW_ENABLED)&&c==1&&!b));\nd.enable(ZmOperation.TEXT,true);\nd.enable(ZmOperation.KEEP_READING,this._keepReading(true));\nif(appCtxt.isWebClientOffline()){d.enable([ZmOperation.ACTIONS_MENU,ZmOperation.VIEW_MENU,ZmOperation.DETACH,ZmOperation.SHOW_ORIG,ZmOperation.SHOW_CONV,ZmOperation.PRINT,ZmOperation.ADD_FILTER_RULE,ZmOperation.CREATE_APPT,ZmOperation.CREATE_TASK,ZmOperation.CONTACT,ZmOperation.REDIRECT],false)\n}};\nZmDoublePaneController.prototype._resetOperation=function(c,d,b){if(c&&d==ZmOperation.KEEP_READING){c.enable(ZmOperation.KEEP_READING,this._keepReading(true))\n}};\nZmDoublePaneController.prototype._isTopLevelView=function(){var b=this.getSessionId();\nreturn(!b||(b==ZmApp.MAIN_SESSION))\n};\nZmDoublePaneController.prototype._handleEmptyList=function(b){this.reset();\nZmMailListController.prototype._handleEmptyList.apply(this,arguments)\n};\nZmDoublePaneController.prototype._listSelectionListener=function(g){var e=ZmMailListController.prototype._listSelectionListener.call(this,g);\nvar i=this._listView[this._currentViewId];\nif(!e&&g.detail==DwtListView.ITEM_DBL_CLICKED){var k=g.item;\nif(!k){return\n}var f=appCtxt.isOffline&&appCtxt.getCurrentSearch();\nif(f&&f.isMultiAccount()){appCtxt.accountList.setActiveAccount(k.getAccount())\n}var b=this._mailListView.getTargetItemDiv(g);\nthis._mailListView._itemSelected(b,g);\nif(appCtxt.get(ZmSetting.SHOW_SELECTION_CHECKBOX)){this._mailListView.setSelectionHdrCbox(false)\n}var j=new AjxCallback(this,this._handleResponseListSelectionListener,k);\nvar c=appCtxt.getById(k.getFolderId());\nif(k.isDraft&&c&&c.id==ZmFolder.ID_DRAFTS&&(!c||!c.isReadOnly())){this._doAction({ev:g,action:ZmOperation.DRAFT});\nreturn true\n}else{if(appCtxt.get(ZmSetting.OPEN_MAIL_IN_NEW_WIN)){this._detachListener(null,j);\nreturn true\n}else{var j=this._handleResponseListSelectionListener.bind(this,k);\nvar h=AjxDispatcher.run(k.type===ZmItem.CONV?\"GetConvController\":\"GetMsgController\",k.nId);\nh.show(k,this,j,true);\nreturn true\n}}}else{if(!e){if(this.isReadingPaneOn()){if(g.kbNavEvent&&ZmDoublePaneController.LIST_SELECTION_SHORTCUT_DELAY){if(this._listSelectionShortcutDelayActionId){AjxTimedAction.cancelAction(this._listSelectionShortcutDelayActionId)\n}this._listSelectionShortcutDelayActionId=AjxTimedAction.scheduleAction(this._listSelectionShortcutDelayAction,ZmDoublePaneController.LIST_SELECTION_SHORTCUT_DELAY)\n}else{this._setSelectedItem()\n}return true\n}else{var d=i.getSelection()[0];\nif(d){this._doublePaneView.resetMsg(d)\n}}}}return e\n};\nZmDoublePaneController.prototype._handleResponseListSelectionListener=function(b){if(b.type==ZmItem.MSG&&b._loaded&&b.isUnread&&(appCtxt.get(ZmSetting.MARK_MSG_READ)==ZmSetting.MARK_READ_NOW)){this._list.markRead([b],true)\n}this._setSelectedItem()\n};\nZmDoublePaneController.prototype._listSelectionTimedAction=function(){if(this._listSelectionShortcutDelayActionId){AjxTimedAction.cancelAction(this._listSelectionShortcutDelayActionId)\n}this._setSelectedItem()\n};\nZmDoublePaneController.prototype._setSelectedItem=function(c){var b=this._listView[this._currentViewId].getSelectionCount();\nif(b==1){var d=this._handleResponseSetSelectedItem.bind(this);\nthis._getLoadedMsg(c,d)\n}};\nZmDoublePaneController.prototype._handleResponseSetSelectedItem=function(g){if(g){if(appCtxt.isOffline){this._app.clearNewMailBadge();\nvar j=g.getAccount();\nvar c=appCtxt.getCurrentSearch();\nif(c&&c.isMultiAccount()){var e=j||appCtxt.accountList.defaultAccount;\nappCtxt.accountList.setActiveAccount(e)\n}if(j&&j.inNewMailMode){j.inNewMailMode=false;\nvar d=appCtxt.getOverviewController()._overviewContainer;\nfor(var b in d){d[b].updateAccountInfo(j,true,true)\n}}}if(!this.isReadingPaneOn()){return\n}var f=this._listView[this._currentViewId];\nvar h=(f.type==ZmItem.CONV&&g.type==ZmItem.MSG)?g.cid:g.id;\nif(f.hasItem(h)){this._displayMsg(g)\n}}};\nZmDoublePaneController.prototype._listActionListener=function(b){ZmMailListController.prototype._listActionListener.call(this,b);\nif(!this.isReadingPaneOn()){var c=this._listView[this._currentViewId].getSelection()[0];\nif(c){this._doublePaneView.resetMsg(c)\n}}};\nZmDoublePaneController.prototype._doDelete=function(d,c,e,b){this._listView[this._currentViewId]._itemToSelect=this._getNextItemToSelect();\nZmMailListController.prototype._doDelete.apply(this,arguments)\n};\nZmDoublePaneController.prototype._doMove=function(l,g,n,j){var k=false;\nif(l&&l.length==1){var f=this.getListView();\nvar m=f&&f.getSelection();\nif(m&&m.length){k=true;\nvar e=l[0];\nvar d=e.id;\nvar c={};\nvar b=0;\nif((e.type===ZmId.ITEM_CONV)&&e.msgIds){for(var h=0;\nh<e.msgIds.length;\nh++){c[e.msgIds[h]]=true\n}}for(var h=0;\nh<m.length;\nh++){if(m[h].id==d){k=false\n}if(c[m[h].id]){b++\n}}if(b==m.length){k=false\n}}}if(!k){this._listView[this._currentViewId]._itemToSelect=this._getNextItemToSelect()\n}ZmMailListController.prototype._doMove.apply(this,arguments)\n};\nZmDoublePaneController.prototype._keepReadingListener=function(b){this.handleKeyAction(ZmKeyMap.KEEP_READING,b)\n};\nZmDoublePaneController.prototype._keepReading=function(b){};\nZmDoublePaneController.prototype._checkKeepReading=function(){setTimeout(this._resetOperation.bind(this,this._toolbar[this._currentViewId],ZmOperation.KEEP_READING),250)\n};\nZmDoublePaneController.handleScroll=function(d){var e=DwtUiEvent.getTarget(d);\nvar c=DwtControl.findControl(e);\nvar b=c&&c._controller;\nif(b&&b._checkKeepReading){b._checkKeepReading()\n}};\nZmDoublePaneController.prototype._dragListener=function(b){ZmListController.prototype._dragListener.call(this,b);\nif(b.action==DwtDragEvent.DRAG_END){this._resetOperations(this._toolbar[this._currentViewId],this._doublePaneView.getSelection().length)\n}};\nZmDoublePaneController.prototype._draftSaved=function(d,c){if(c){if(!d){d=new ZmMailMsg()\n}d._loadFromDom(c)\n}appCtxt.cacheSet(d.id,d);\nthis._redrawDraftItemRows(d);\nvar b=this._doublePaneView.getMsg();\nif(b&&b.id==d.id){this._doublePaneView.reset();\nthis._doublePaneView.setItem(d,null,true)\n}};\nZmDoublePaneController.prototype._redrawDraftItemRows=function(b){this._listView[this._currentViewId].redrawItem(b);\nthis._listView[this._currentViewId].setSelection(b,true)\n};\nZmDoublePaneController.prototype.selectFirstItem=function(){this._doublePaneView._selectFirstItem()\n};\nZmDoublePaneController.prototype._getDefaultFocusItem=function(){return this.getListView()\n};\nZmDoublePaneController.prototype._getNextItemToSelect=function(c){c=c||{};\nvar j=this._listView[this._currentViewId];\nvar f=j.getSelectionCount();\nif(f){var h=j.getSelection();\nvar d={};\nfor(var e=0;\ne<h.length;\ne++){d[h[e].id]=true\n}var m=appCtxt.get(ZmSetting.SELECT_AFTER_DELETE);\nvar b=(m==ZmSetting.DELETE_SELECT_PREV||(m==ZmSetting.DELETE_SELECT_ADAPT&&(this.lastListAction==DwtKeyMap.SELECT_PREV||this.lastListAction==ZmKeyMap.PREV_UNREAD)));\nif(b&&(f==1)){var g=j._getRowIndex(h[h.length-1]);\nvar k=j._parentEl.childNodes;\nfor(var e=g-1;\ne>=0;\ne--){var l=j.getItemFromElement(k[e]);\nif(l&&!d[l.id]&&!c[l.id]&&!(l.cid&&(d[l.cid]||c[l.cid]))){return l\n}}return ZmMailListView.FIRST_ITEM\n}else{var g=j._getRowIndex(h[0]);\nvar k=j._parentEl.childNodes;\nfor(var e=g+1;\ne<k.length;\ne++){var l=j.getItemFromElement(k[e]);\nif(l&&!d[l.id]&&!c[l.id]&&!(l.cid&&(d[l.cid]||c[l.cid]))){return l\n}}return ZmMailListView.LAST_ITEM\n}}return ZmMailListView.FIRST_ITEM\n};\nZmDoublePaneController.prototype._setItemCountText=function(c){c=c||this._getItemCountText();\nvar b=(this._getReadingPanePref()==ZmSetting.RP_RIGHT);\nif(this._itemCountText[ZmSetting.RP_RIGHT]){this._itemCountText[ZmSetting.RP_RIGHT].setText(b?c:\"\")\n}if(this._itemCountText[ZmSetting.RP_BOTTOM]){this._itemCountText[ZmSetting.RP_BOTTOM].setText(b?\"\":c)\n}};\nZmDoublePaneController.prototype._postShowCallback=function(){ZmMailListController.prototype._postShowCallback.apply(this,arguments);\nvar b=this._doublePaneView;\nif(b&&b.isStale&&b._staleHandler){b._staleHandler()\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.controller.ZmConvListController\")){ZmConvListController=function(b,d,c,f,e){ZmDoublePaneController.apply(this,arguments)\n};\nZmConvListController.prototype=new ZmDoublePaneController;\nZmConvListController.prototype.constructor=ZmConvListController;\nZmConvListController.prototype.isZmConvListController=true;\nZmConvListController.prototype.toString=function(){return\"ZmConvListController\"\n};\nZmMailListController.ACTION_CODE_WHICH[ZmKeyMap.FIRST_UNREAD_MSG]=DwtKeyMap.SELECT_FIRST;\nZmMailListController.ACTION_CODE_WHICH[ZmKeyMap.LAST_UNREAD_MSG]=DwtKeyMap.SELECT_LAST;\nZmMailListController.ACTION_CODE_WHICH[ZmKeyMap.NEXT_UNREAD_MSG]=DwtKeyMap.SELECT_NEXT;\nZmMailListController.ACTION_CODE_WHICH[ZmKeyMap.PREV_UNREAD_MSG]=DwtKeyMap.SELECT_PREV;\nZmMailListController.GROUP_BY_SETTING[ZmId.VIEW_CONVLIST]=ZmSetting.GROUP_BY_CONV;\nZmMailListController.GROUP_BY_ICON[ZmId.VIEW_CONVLIST]=\"ConversationView\";\nZmMailListController.GROUP_BY_MSG_KEY[ZmId.VIEW_CONVLIST]=\"byConversation\";\nZmMailListController.GROUP_BY_SHORTCUT[ZmId.VIEW_CONVLIST]=ZmKeyMap.VIEW_BY_CONV;\nZmMailListController.GROUP_BY_VIEWS.push(ZmId.VIEW_CONVLIST);\nZmConvListController.getDefaultViewType=function(){return ZmId.VIEW_CONVLIST\n};\nZmConvListController.prototype.getDefaultViewType=ZmConvListController.getDefaultViewType;\nZmConvListController.prototype.show=function(b,c){if(!c&&!this.popShield(null,this.show.bind(this,b,true))){return\n}ZmDoublePaneController.prototype.show.call(this,b,b.getResults(ZmItem.CONV));\nif(!appCtxt.isExternalAccount()&&!this.isSearchResults&&!(b&&b.search&&b.search.isDefaultToMessageView)){appCtxt.set(ZmSetting.GROUP_MAIL_BY,ZmSetting.GROUP_BY_CONV)\n}};\nZmConvListController.prototype.switchView=function(b,d){if(b==ZmSearch.DATE_DESC||b==ZmSearch.DATE_ASC){if(!d&&!this.popShield(null,this.switchView.bind(this,b,true))){return\n}if((appCtxt.get(ZmSetting.CONVERSATION_ORDER)!=b)||d){appCtxt.set(ZmSetting.CONVERSATION_ORDER,b);\nif(this._currentViewType==ZmId.VIEW_CONVLIST){this._mailListView.redoExpansion()\n}var c=this.getItemView();\nvar e=c&&c.getItem();\nif(e){c.set(e)\n}}}else{ZmDoublePaneController.prototype.switchView.apply(this,arguments)\n}};\nZmConvListController.prototype.getKeyMapName=function(){return this._convView&&this._convView.isActiveQuickReply()?ZmKeyMap.MAP_QUICK_REPLY:ZmKeyMap.MAP_CONVERSATION_LIST\n};\nZmConvListController.prototype.handleKeyAction=function(k,l){var p=this._mailListView,g=DwtUiEvent.getTargetWithClass(l,\"ZmMailMsgCapsuleView\"),f=document.activeElement,b=f&&f.id.indexOf(ZmId.MV_MSG_FOOTER)!==-1;\nswitch(k){case DwtKeyMap.DBLCLICK:if(b){f.click()\n}else{return ZmDoublePaneController.prototype.handleKeyAction.apply(this,arguments)\n}break;\ncase ZmKeyMap.EXPAND:case ZmKeyMap.COLLAPSE:if(g){if(b){var i=DwtControl.findControl(f);\nif(i&&i.isZmMailMsgCapsuleView){i._focusLink(k===ZmKeyMap.COLLAPSE,f)\n}}else{var e=DwtControl.fromElement(g);\nif((k===ZmKeyMap.EXPAND)!==e.isExpanded()){e._toggleExpansion()\n}}break\n}var o=p.getItemFromElement(p._kbAnchor);\nif(!o){return false\n}if((k==ZmKeyMap.EXPAND)!=p.isExpanded(o)){p._expandItem(o)\n}break;\ncase ZmKeyMap.TOGGLE:if(g){DwtControl.fromElement(g)._toggleExpansion();\nbreak\n}var o=p.getItemFromElement(p._kbAnchor);\nif(!o){return false\n}if(p._isExpandable(o)){p._expandItem(o)\n}break;\ncase ZmKeyMap.EXPAND_ALL:case ZmKeyMap.COLLAPSE_ALL:var m=(k==ZmKeyMap.EXPAND_ALL);\nif(g){DwtControl.fromElement(g).parent.setExpanded(m)\n}else{p._expandAll(m)\n}break;\ncase ZmKeyMap.NEXT_UNREAD_MSG:case ZmKeyMap.PREV_UNREAD_MSG:this.lastListAction=k;\nvar d,h=false;\nif(p.getSelectionCount()==1){var c=p.getSelection();\nd=c[0];\nif(d&&p._isExpandable(d)){h=true\n}}case ZmKeyMap.FIRST_UNREAD_MSG:case ZmKeyMap.LAST_UNREAD_MSG:var o=(d&&d.type==ZmItem.MSG&&h)?d:this._getUnreadItem(ZmMailListController.ACTION_CODE_WHICH[k],null,h);\nif(!o){return\n}if(!p.isExpanded(o)&&p._isExpandable(o)){var n=new AjxCallback(this,this._handleResponseExpand,[k]);\nif(o.type==ZmItem.MSG){this._expand({conv:appCtxt.getById(o.cid),msg:o,offset:p._msgOffset[o.id],callback:n})\n}else{this._expand({conv:o,callback:n})\n}}else{if(o){this._selectItem(p,o)\n}}break;\ncase ZmKeyMap.KEEP_READING:return this._keepReading(false,l);\nbreak;\ncase ZmKeyMap.SEND:if(!appCtxt.get(ZmSetting.USE_SEND_MSG_SHORTCUT)){break\n}var j=this.getItemView();\nif(j&&j._sendListener){j._sendListener()\n}break;\ncase ZmKeyMap.CANCEL:var j=this.getItemView();\nif(j&&j._cancelListener&&j._replyView&&j._replyView.getVisible()){j._cancelListener();\nbreak\n}default:return ZmDoublePaneController.prototype.handleKeyAction.apply(this,arguments)\n}return true\n};\nZmConvListController.prototype._handleResponseExpand=function(c){var b=this._getUnreadItem(ZmMailListController.ACTION_CODE_WHICH[c],ZmItem.MSG);\nif(b){this._selectItem(this._mailListView,b)\n}};\nZmConvListController.prototype._keepReading=function(b,j){if(!this.isReadingPaneOn()||!this._itemViewCurrent()){return false\n}var n=this._mailListView;\nif(!n||n.getSelectionCount()!=1){return false\n}var o=false;\nvar h=this.getItemView();\nif(h&&h.isZmConvView2){o=h._keepReading(b);\no=o||(b?!!(this._getUnreadItem(DwtKeyMap.SELECT_NEXT)):this.handleKeyAction(ZmKeyMap.NEXT_UNREAD,j))\n}else{if(h&&h.isZmMailMsgView){var o=h._keepReading(b);\nif(!b||!o){var d=n.getSelection()[0];\nvar k=d&&appCtxt.getById(d.cid);\nvar f=k&&k.msgs&&k.msgs.getArray();\nvar c,l;\nif(f&&f.length){for(var g=0;\ng<f.length;\ng++){var e=f[g];\nc=c||(e.id==d.id);\nif(c&&e.isUnread){l=e;\nbreak\n}}}if(l){o=true;\nif(!b){this._selectItem(n,l)\n}}else{o=b?!!(this._getUnreadItem(DwtKeyMap.SELECT_NEXT)):this.handleKeyAction(ZmKeyMap.NEXT_UNREAD,j)\n}}}}if(!b&&o){this._checkKeepReading()\n}return o\n};\nZmConvListController.prototype.pageItemSilently=function(j,e){if(!j){return\n}if(j.type==ZmItem.CONV){ZmMailListController.prototype.pageItemSilently.apply(this,arguments);\nreturn\n}var k=appCtxt.getById(j.cid);\nif(!(k&&k.msgs)){return\n}var l=false;\nvar g=k.msgs.getArray();\nfor(var d=0,f=g.length;\nd<f;\nd++){if(g[d]==j){l=true;\nbreak\n}}if(!l){return\n}var c=e?d+1:d-1;\nif(c>=0&&c<g.length){var b=g[c];\nvar h=this._listView[this._currentViewId];\nh.emulateDblClick(b)\n}};\nZmConvListController.prototype._createDoublePaneView=function(){var b=new ZmConvDoublePaneView({parent:this._container,posStyle:Dwt.ABSOLUTE_STYLE,controller:this,dropTgt:this._dropTgt});\nthis._convView=b._itemView;\nreturn b\n};\nZmConvListController.prototype._paginate=function(d,e,b,c){d=d||this._currentViewId;\nreturn ZmDoublePaneController.prototype._paginate.call(this,d,e,b,c)\n};\nZmConvListController.prototype._resetNavToolBarButtons=function(b){b=b||this.getCurrentViewId();\nZmDoublePaneController.prototype._resetNavToolBarButtons.call(this,b);\nif(!this._navToolBar[b]){return\n}this._navToolBar[b].setToolTip(ZmOperation.PAGE_BACK,ZmMsg.previousPage);\nthis._navToolBar[b].setToolTip(ZmOperation.PAGE_FORWARD,ZmMsg.nextPage)\n};\nZmConvListController.prototype._setupConvOrderMenu=function(j,d){var e=d.createMenuItem(Dwt.getNextId(\"CONV_ORDER_\"),{text:ZmMsg.expandConversations,style:DwtMenuItem.NO_STYLE}),f=new ZmPopupMenu(e);\nvar b=[ZmMailListController.CONV_ORDER_DESC,ZmMailListController.CONV_ORDER_ASC];\nvar l=appCtxt.get(ZmSetting.CONVERSATION_ORDER);\nvar k={style:DwtMenuItem.RADIO_STYLE,radioGroupId:\"CO\"};\nfor(var g=0;\ng<b.length;\ng++){var c=b[g];\nif(!f._menuItems[c]){k.text=ZmMailListController.CONV_ORDER_TEXT[c];\nvar h=f.createMenuItem(c,k);\nh.setData(ZmOperation.MENUITEM_ID,c);\nh.addSelectionListener(this._listeners[ZmOperation.VIEW]);\nh.setChecked((l==c),true)\n}}e.setMenu(f);\nreturn f\n};\nZmConvListController.prototype._getNumTotal=function(){return null\n};\nZmConvListController.prototype._preUnloadCallback=function(b){return !(this._convView&&this._convView.isDirty())\n};\nZmConvListController.prototype._preHideCallback=function(b,d,c){return d?true:this.popShield(b,null,c)\n};\nZmConvListController.prototype._getActionMenuOps=function(){var c=ZmDoublePaneController.prototype._getActionMenuOps.apply(this,arguments),b=AjxUtil.indexOf(c,ZmOperation.FORWARD);\nif(b!==-1){c.splice(b+1,0,ZmOperation.FORWARD_CONV)\n}return c\n};\nZmConvListController.prototype._getSecondaryToolBarOps=function(){var c=ZmDoublePaneController.prototype._getSecondaryToolBarOps.apply(this,arguments),b=AjxUtil.indexOf(c,ZmOperation.EDIT_AS_NEW);\nif(b!==-1&&appCtxt.get(ZmSetting.FORWARD_MENU_ENABLED)){c.splice(b+1,0,ZmOperation.FORWARD_CONV)\n}return c\n};\nZmConvListController.prototype._resetOperations=function(c,b){ZmDoublePaneController.prototype._resetOperations.apply(this,arguments);\nthis._resetForwardConv(c,b)\n};\nZmConvListController.prototype._resetForwardConv=function(f,d){var e=true,b=false;\nif(d==null||d===1){var c=this._mailListView,g=this._conv||c.getSelection()[0];\nif(g&&g.type===ZmItem.CONV){if(c&&c._getDisplayedMsgCount(g)>1){b=true\n}}else{e=false\n}}var h=f.getOp(ZmOperation.FORWARD_CONV);\nif(h){h.setVisible(e);\nf.enable(ZmOperation.FORWARD_CONV,b)\n}};\nZmConvListController.prototype.popShield=function(b,g,c){var d=c&&appCtxt.getViewTypeFromId(c);\nvar e=(d==ZmId.VIEW_TRAD);\nif(this._convView&&this._convView.isDirty()&&(!d||e)){var f=this._popShield=this._popShield||appCtxt.getYesNoMsgDialog();\nf.reset();\nf.setMessage(ZmMsg.convViewCancel,DwtMessageDialog.WARNING_STYLE);\nf.registerCallback(DwtDialog.YES_BUTTON,this._popShieldYesCallback,this,[e,g]);\nf.registerCallback(DwtDialog.NO_BUTTON,this._popShieldNoCallback,this,[e,g]);\nf.popup();\nreturn false\n}else{return true\n}};\nZmConvListController.prototype._popShieldYesCallback=function(b,c){this._convView._replyView.reset();\nthis._popShield.popdown();\nif(b){appCtxt.getAppViewMgr().showPendingView(true)\n}else{if(c){c()\n}}};\nZmConvListController.prototype._popShieldNoCallback=function(c,f){this._popShield.popdown();\nif(c){this._updateViewMenu(ZmId.VIEW_CONVLIST);\nif(!appCtxt.isExternalAccount()&&!this.isSearchResults&&!this._currentSearch.isDefaultToMessageView){this._app.setGroupMailBy(ZmMailListController.GROUP_BY_SETTING[ZmId.VIEW_CONVLIST],true)\n}}var b=this.getSelection();\nvar e=b&&b.length&&b[0];\nvar d=this._convView._item;\nif(d.id!==e.id){this.getListView().setSelection(d,true)\n}appCtxt.getKeyboardMgr().grabFocus(this._convView._replyView._input)\n};\nZmConvListController.prototype._listSelectionListener=function(c){var b=c.item;\nif(!b){return\n}this._mailListView._selectedMsg=null;\nif(c.field==ZmItem.F_EXPAND&&this._mailListView._isExpandable(b)){this._toggle(b);\nreturn true\n}return ZmDoublePaneController.prototype._listSelectionListener.apply(this,arguments)\n};\nZmConvListController.prototype._handleConvLoaded=function(d){var c=d.getFirstHotMsg();\nvar b=c||d;\nthis._showItem(b)\n};\nZmConvListController.prototype._showItem=function(b){if(b.type==ZmItem.MSG){AjxDispatcher.run(\"GetMsgController\",b&&b.nId).show(b,this,null,true)\n}else{AjxDispatcher.run(\"GetConvController\").show(b,this,null,true)\n}};\nZmConvListController.prototype._menuPopdownActionListener=function(b){ZmDoublePaneController.prototype._menuPopdownActionListener.apply(this,arguments);\nthis._mailListView._selectedMsg=null\n};\nZmConvListController.prototype._setSelectedItem=function(){var b=this._listView[this._currentViewId].getSelectionCount();\nif(b==1){var e=this._listView[this._currentViewId].getSelection();\nvar c=(e&&e.length)?e[0]:null;\nif(c.type==ZmItem.CONV){Dwt.setLoadingTime(\"ZmConv\",new Date());\nvar d={};\nd.markRead=this._handleMarkRead(c,true);\nif(this.isSearchResults){d.fetch=ZmSetting.CONV_FETCH_MATCHES\n}else{d.fetch=ZmSetting.CONV_FETCH_UNREAD_OR_FIRST;\nd.query=this._currentSearch.query\n}d.forceLoad=c.unreadHasChanged;\nc.load(d,this._handleResponseSetSelectedItem.bind(this,c))\n}else{ZmDoublePaneController.prototype._setSelectedItem.apply(this,arguments)\n}}};\nZmConvListController.prototype._handleResponseSetSelectedItem=function(b){if(b.type===ZmItem.CONV&&this.isReadingPaneOn()){var c=this._listView[this._currentViewId];\nif(c.hasItem(b.id)){this._displayItem(b)\n}b.unreadHasChanged=false\n}else{ZmDoublePaneController.prototype._handleResponseSetSelectedItem.call(this,b)\n}};\nZmConvListController.prototype._getTagMenuMsg=function(c,b){var d=this._getLabelType(b);\nreturn AjxMessageFormat.format((d==ZmItem.MSG)?ZmMsg.tagMessages:ZmMsg.tagConversations,c)\n};\nZmConvListController.prototype._getMoveDialogTitle=function(c,b){var d=this._getLabelType(b);\nreturn AjxMessageFormat.format((d==ZmItem.MSG)?ZmMsg.moveMessages:ZmMsg.moveConversations,c)\n};\nZmConvListController.prototype._getLabelType=function(b){if(!(b&&b.length)){return ZmItem.MSG\n}for(var c=0;\nc<b.length;\nc++){if(b[c].type==ZmItem.MSG){return ZmItem.MSG\n}}return ZmItem.CONV\n};\nZmConvListController.prototype.getMsg=function(f){var e=this._listView[this._currentViewId];\nvar d=e&&e._selectedMsg;\nif(d&&DwtMenu.menuShowing()){return d\n}var c=e.getSelection();\nvar b=(c&&c.length)?c[0]:null;\nif(b){if(b.type==ZmItem.CONV){return b.getFirstHotMsg(f)\n}else{if(b.type==ZmItem.MSG){return ZmDoublePaneController.prototype.getMsg.apply(this,arguments)\n}}}return null\n};\nZmConvListController.prototype._getLoadedMsg=function(d,f){d=d||{};\nvar c=this._listView[this._currentViewId].getSelection();\nthis._lastSelectedListItem=c;\nvar b=(c&&c.length)?c[0]:null;\nif(b){if(b.type==ZmItem.CONV){d.markRead=(d.markRead!=null)?d.markRead:this._handleMarkRead(b,true);\nvar e=new AjxCallback(this,this._handleResponseGetLoadedMsg,f);\nb.getFirstHotMsg(d,e)\n}else{if(b.type==ZmItem.MSG){ZmDoublePaneController.prototype._getLoadedMsg.apply(this,arguments)\n}}}else{f.run()\n}};\nZmConvListController.prototype._handleResponseGetLoadedMsg=function(c,b){c.run(b)\n};\nZmConvListController.prototype._getSelectedMsg=function(c){var b=this._listView[this._currentViewId].getSelection()[0];\nif(!b){return null\n}return(b.type==ZmItem.CONV)?b.getFirstHotMsg(null,c):b\n};\nZmConvListController.prototype._displayItem=function(c){appCtxt.killMarkReadTimer();\nvar b=this._doublePaneView.getItem();\nc.waitOnMarkRead=true;\nthis._doublePaneView.setItem(c);\nc.waitOnMarkRead=false;\nif(!(b&&c.id==b.id)){this._handleMarkRead(c)\n}};\nZmConvListController.prototype._toggle=function(b){if(this._mailListView.isExpanded(b)){this._collapse(b)\n}else{var e=b,d=null,c=0;\nif(b.type==ZmItem.MSG){e=appCtxt.getById(b.cid);\nd=b;\nc=this._mailListView._msgOffset[b.id]\n}this._expand({conv:e,msg:d,offset:c})\n}};\nZmConvListController.prototype._expand=function(e){var d=e.conv;\nvar c=e.offset||0;\nvar f=new AjxCallback(this,this._handleResponseLoadItem,[e]);\nvar b=false;\nif(c){if(this._paginateConv(d,c,f)){this._handleResponseLoadItem(e,new ZmCsfeResult(d.msgs))\n}}else{if(!d._loaded){d.load(null,f)\n}else{this._handleResponseLoadItem(e,new ZmCsfeResult(d.msgs))\n}}};\nZmConvListController.prototype._handleResponseLoadItem=function(c,b){if(b){this._mailListView._expand(c.conv,c.msg)\n}if(c.callback){c.callback.run()\n}};\nZmConvListController.prototype._paginateConv=function(f,e,i){var d=f.msgs;\nvar c=appCtxt.get(ZmSetting.CONVERSATION_PAGE_SIZE);\nif(e&&d&&((e+c>d.size())&&d.hasMore())){var h=(e+c)-d.size();\nvar b=h<c&&h>0?h:c;\nif(b<c){e=((e+c)-b)+1\n}var g=new AjxCallback(this,this._handleResponsePaginateConv,[f,e,i]);\nf.load({offset:e,limit:c},g);\nreturn false\n}else{return true\n}};\nZmConvListController.prototype._handleResponsePaginateConv=function(f,e,g,c){if(!f.msgs){return\n}var b=c.getResponse();\nf.msgs.setHasMore(b.getAttribute(\"more\"));\nvar d=b.getResults(ZmItem.MSG).getVector();\nf.msgs.cache(e,d);\nif(g){g.run(c)\n}};\nZmConvListController.prototype._collapse=function(b){if(this._mailListView._rowsArePresent(b)){this._mailListView._collapse(b)\n}else{this._toggle(b)\n}};\nZmConvListController.prototype._divvyItems=function(d){var j=[],h=[];\nvar f={};\nfor(var e=0;\ne<d.length;\ne++){var g=d[e];\nif(g.type==ZmItem.CONV){j.push(g);\nf[g.id]=true\n}else{h.push(g)\n}}var c=[];\nfor(var e=0;\ne<h.length;\ne++){if(!f[h[e].cid]){c.push(h[e])\n}}var b={};\nb[ZmItem.MSG]=c;\nb[ZmItem.CONV]=j;\nreturn b\n};\nZmConvListController.prototype._draftSaved=function(f,e){if(e){f=f||new ZmMailMsg();\nf._loadFromDom(e)\n}var d=appCtxt.getById(f.cid);\nif(d&&d.msgs&&d.msgs.size()){var b=d.msgs.getArray();\nfor(var c=0;\nc<b.length;\nc++){if(b[c].id==f.id){b[c]=f\n}}}ZmDoublePaneController.prototype._draftSaved.apply(this,[f])\n};\nZmConvListController.prototype._redrawDraftItemRows=function(d){var c=this._listView[this._currentViewId];\nvar b=appCtxt.getById(d.cid);\nif(b){b._loadFromMsg(d);\nc.redrawItem(b);\nc.setSelection(b,true)\n}c.redrawItem(d)\n};\nZmConvListController.prototype._getNextItemToSelect=function(b){var c=this._listView[this._currentViewId];\nreturn(c&&c._selectedMsg)?null:ZmDoublePaneController.prototype._getNextItemToSelect.apply(this,arguments)\n};\nZmConvListController.prototype._applyAction=function(d,f,e){e=e?e:[];\nvar b=this._divvyItems(d);\nvar c=false;\nif(b[ZmItem.MSG]&&b[ZmItem.MSG].length){e.unshift(b[ZmItem.MSG]);\nZmDoublePaneController.prototype[f].apply(this,e);\nc=true\n}if(b[ZmItem.CONV]&&b[ZmItem.CONV].length){if(c){e[0]=b[ZmItem.CONV]\n}else{e.unshift(b[ZmItem.CONV])\n}ZmDoublePaneController.prototype[f].apply(this,e)\n}};\nZmConvListController.prototype._doFlag=function(c,b){if(b!==true&&b!==false){b=!c[0].isFlagged\n}this._applyAction(c,\"_doFlag\",[b])\n};\nZmConvListController.prototype._doMsgPriority=function(c){var b=!c[0].isPriority;\nthis._applyAction(c,\"_doMsgPriority\",[b])\n};\nZmConvListController.prototype._doTag=function(c,b,d){this._applyAction(c,\"_doTag\",[b,d])\n};\nZmConvListController.prototype._doRemoveAllTags=function(b){this._applyAction(b,\"_doRemoveAllTags\")\n};\nZmConvListController.prototype._doDelete=function(c,b,d){this._applyAction(c,\"_doDelete\",[b,d])\n};\nZmConvListController.prototype._doMove=function(c,e,d,b){this._applyAction(c,\"_doMove\",[e,d,b])\n};\nZmConvListController.prototype._doMarkRead=function(c,b,e,d){this._applyAction(c,\"_doMarkRead\",[b,e,d])\n};\nZmConvListController.prototype._doMarkMute=function(c,b,e,d){this._applyAction(c,\"_doMarkMute\",[b,e,d])\n};\nZmConvListController.prototype._doSpam=function(b,d,c){this._applyAction(b,\"_doSpam\",[d,c])\n};\nZmConvListController.prototype._handleResponsePaginate=function(d,f,e,g,c,b){ZmListController.prototype._handleResponsePaginate.call(this,d,f,e,g,c,true)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.controller.ZmTradController\")){ZmTradController=function(b,d,c,f,e){ZmDoublePaneController.apply(this,arguments);\nthis._listeners[ZmOperation.SHOW_CONV]=this._showConvListener.bind(this)\n};\nZmTradController.prototype=new ZmDoublePaneController;\nZmTradController.prototype.constructor=ZmTradController;\nZmTradController.prototype.isZmTradController=true;\nZmTradController.prototype.toString=function(){return\"ZmTradController\"\n};\nZmMailListController.GROUP_BY_ITEM[ZmId.VIEW_TRAD]=ZmItem.MSG;\nZmMailListController.GROUP_BY_SETTING[ZmId.VIEW_TRAD]=ZmSetting.GROUP_BY_MESSAGE;\nZmMailListController.GROUP_BY_ICON[ZmId.VIEW_TRAD]=\"MessageView\";\nZmMailListController.GROUP_BY_MSG_KEY[ZmId.VIEW_TRAD]=\"byMessage\";\nZmMailListController.GROUP_BY_SHORTCUT[ZmId.VIEW_TRAD]=ZmKeyMap.VIEW_BY_MSG;\nZmMailListController.GROUP_BY_VIEWS.push(ZmId.VIEW_TRAD);\nZmTradController.getDefaultViewType=function(){return ZmId.VIEW_TRAD\n};\nZmTradController.prototype.getDefaultViewType=ZmTradController.getDefaultViewType;\nZmTradController.prototype.show=function(b){ZmDoublePaneController.prototype.show.call(this,b,b.getResults(ZmItem.MSG));\nif(!appCtxt.isExternalAccount()&&!this.isSearchResults&&!(b&&b.search&&b.search.isDefaultToMessageView)){appCtxt.set(ZmSetting.GROUP_MAIL_BY,ZmSetting.GROUP_BY_MESSAGE)\n}this._resetNavToolBarButtons(ZmId.VIEW_TRAD)\n};\nZmTradController.prototype.handleKeyAction=function(b,c){switch(b){case ZmKeyMap.KEEP_READING:return this._keepReading(false,c);\nbreak;\ndefault:return ZmDoublePaneController.prototype.handleKeyAction.apply(this,arguments)\n}};\nZmTradController.prototype._createDoublePaneView=function(){return(new ZmTradView({parent:this._container,posStyle:Dwt.ABSOLUTE_STYLE,controller:this,dropTgt:this._dropTgt}))\n};\nZmTradController.prototype._resetOperations=function(c,b){ZmDoublePaneController.prototype._resetOperations.apply(this,arguments);\nc.enable(ZmOperation.SHOW_CONV,(b==1)&&!appCtxt.isWebClientOffline())\n};\nZmTradController.prototype._paginate=function(d,e,b,c){d=d||this._currentViewId;\nreturn ZmDoublePaneController.prototype._paginate.call(this,d,e,b,c)\n};\nZmTradController.prototype._resetNavToolBarButtons=function(b){b=b||this.getCurrentViewId();\nZmDoublePaneController.prototype._resetNavToolBarButtons.call(this,b);\nif(!this._navToolBar[b]){return\n}this._navToolBar[b].setToolTip(ZmOperation.PAGE_BACK,ZmMsg.previousPage);\nthis._navToolBar[b].setToolTip(ZmOperation.PAGE_FORWARD,ZmMsg.nextPage)\n};\nZmTradController.prototype._keepReading=function(c,f){if(!this.isReadingPaneOn()||!this._itemViewCurrent()){return false\n}var d=this._mailListView;\nif(!d||d.getSelectionCount()!=1){return false\n}var e=this.getItemView();\nvar b=e&&e._keepReading(c);\nif(c){b=b||!!(this._getUnreadItem(DwtKeyMap.SELECT_NEXT))\n}else{b=b||this.handleKeyAction(ZmKeyMap.NEXT_UNREAD,f);\nif(b){this._checkKeepReading()\n}}return b\n};\nZmTradController.prototype._showConvListener=function(){var d=this.getMsg();\nif(!d){return\n}var b=new ZmMailList(ZmItem.CONV);\nb.search=d.list.search;\nvar c=ZmConv.createFromMsg(d,{list:b});\nAjxDispatcher.run(\"GetConvController\").show(c,this,null,null,d)\n};\nZmTradController.prototype._handleResponsePaginate=function(d,f,e,g,c,b){ZmMailListController.prototype._handleResponsePaginate.call(this,d,f,e,g,c,true)\n}\n}if(AjxPackage.define(\"zimbraMail.mail.controller.ZmMsgController\")){ZmMsgController=function(b,d,c,e){if(arguments.length==0){return\n}ZmMailListController.apply(this,arguments);\nthis._elementsToHide=ZmAppViewMgr.LEFT_NAV\n};\nZmMsgController.prototype=new ZmMailListController;\nZmMsgController.prototype.constructor=ZmMsgController;\nZmMsgController.MODE_TO_CONTROLLER={};\nZmMsgController.MODE_TO_CONTROLLER[ZmId.VIEW_TRAD]=\"GetTradController\";\nZmMsgController.MODE_TO_CONTROLLER[ZmId.VIEW_CONV]=\"GetConvController\";\nZmMsgController.MODE_TO_CONTROLLER[ZmId.VIEW_CONVLIST]=\"GetConvListController\";\nZmMsgController.DEFAULT_TAB_TEXT=ZmMsg.message;\nZmMsgController.viewToTab={};\nZmMsgController.prototype.isZmMsgController=true;\nZmMsgController.prototype.toString=function(){return\"ZmMsgController\"\n};\nZmMsgController.getDefaultViewType=function(){return ZmId.VIEW_MSG\n};\nZmMsgController.prototype.getDefaultViewType=ZmMsgController.getDefaultViewType;\nZmMsgController.prototype.show=function(c,f,j,d,e,g,h){this.setMsg(c);\nthis._parentController=f;\nthis.setList(c.list);\nif(!c._loaded||g){var k=new AjxCallback(this,this._handleResponseShow,[j,e]);\nif(c._loadPending){c._loadCallback=k\n}else{d=d||(appCtxt.get(ZmSetting.MARK_MSG_READ)==ZmSetting.MARK_READ_NOW);\nc.load({callback:k,markRead:d,forceLoad:g,noTruncate:h})\n}}else{var b=false;\nif(!c.isReadOnly()&&c.isUnread&&(appCtxt.get(ZmSetting.MARK_MSG_READ)!=ZmSetting.MARK_READ_NONE)){if(c.list){b=true;\nvar i=this._handleResponseShow.bind(this,j,e);\nc.list.markRead({items:c,value:true,callback:i,noBusyOverlay:true})\n}else{c.markRead()\n}}if(!b){this._handleResponseShow(j,e)\n}}};\nZmMsgController.prototype._handleResponseShow=function(d,c,b){this._showMsg();\nthis._showNavToolBarButtons(this._currentViewId,!c);\nif(d&&d.run){d.run(this,this._view[this._currentViewId])\n}};\nZmMsgController.prototype._setupContinuation=function(){this._continuation.lastItem=true;\nthis._continuation.totalItems=1;\nZmListController.prototype._setupContinuation.apply(this,arguments)\n};\nZmMsgController.prototype.dispose=function(){this._tagList.removeChangeListener(this._tagChangeListener)\n};\nZmMsgController.prototype._showMsg=function(){this._showMailItem()\n};\nZmMsgController.prototype._getTabParams=function(c,b){return{id:c,textPrecedence:85,image:\"CloseGray\",hoverImage:\"Close\",style:DwtLabel.IMAGE_RIGHT,tooltip:ZmMsgController.DEFAULT_TAB_TEXT,tabCallback:b}\n};\nZmMsgController.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_MESSAGE\n};\nZmMsgController.prototype.handleKeyAction=function(b){switch(b){case ZmKeyMap.CANCEL:this._backListener();\nbreak;\ncase ZmKeyMap.NEXT_PAGE:this._goToMsg(this._currentViewId,true);\nbreak;\ncase ZmKeyMap.PREV_PAGE:this._goToMsg(this._currentViewId,false);\nbreak;\ncase ZmKeyMap.VIEW_BY_CONV:case ZmKeyMap.VIEW_BY_MSG:break;\ndefault:if(ZmMsgController.ALLOWED_SHORTCUT[b]){return ZmMailListController.prototype.handleKeyAction.call(this,b)\n}}return true\n};\nZmMsgController.prototype.mapSupported=function(b){return false\n};\nZmMsgController.prototype._getToolBarOps=function(){var b=[ZmOperation.CLOSE,ZmOperation.SEP];\nb=b.concat(ZmMailListController.prototype._getToolBarOps.call(this));\nreturn b\n};\nZmMsgController.prototype._getRightSideToolBarOps=function(){if(appCtxt.isChildWindow||!appCtxt.get(ZmSetting.DETACH_MAILVIEW_ENABLED)||appCtxt.isExternalAccount()){return[]\n}return[ZmOperation.DETACH]\n};\nZmMsgController.prototype._showDetachInSecondary=function(){return false\n};\nZmMsgController.prototype._initializeToolBar=function(b){var c=appCtxt.isChildWindow?\"ZmMsgViewToolBar_cw\":null;\nZmMailListController.prototype._initializeToolBar.call(this,b,c)\n};\nZmMsgController.prototype._navBarListener=function(b){var c=b.item.getData(ZmOperation.KEY_ID);\nif(c==ZmOperation.PAGE_BACK||c==ZmOperation.PAGE_FORWARD){this._goToMsg(this._currentViewId,(c==ZmOperation.PAGE_FORWARD))\n}};\nZmMsgController.prototype._setupViewMenu=function(b,c){};\nZmMsgController.prototype._getActionMenuOps=function(){return null\n};\nZmMsgController.prototype._initializeView=function(b){if(!this._view[b]){var c={parent:this._container,id:ZmId.getViewId(ZmId.VIEW_MSG,null,b),posStyle:Dwt.ABSOLUTE_STYLE,mode:ZmId.VIEW_MSG,controller:this};\nthis._view[b]=new ZmMailMsgView(c);\nthis._view[b].addInviteReplyListener(this._inviteReplyListener);\nthis._view[b].addShareListener(this._shareListener);\nthis._view[b].addSubscribeListener(this._subscribeListener)\n}};\nZmMsgController.prototype._initializeTabGroup=function(b){if(this._tabGroups[b]){return\n}ZmMailListController.prototype._initializeTabGroup.apply(this,arguments);\nthis._tabGroups[b].removeMember(this._view[b])\n};\nZmMsgController.prototype._getSearchFolderId=function(){return this._msg.folderId?this._msg.folderId:(this._msg.list&&this._msg.list.search)?this._msg.list.search.folderId:null\n};\nZmMsgController.prototype._getTagMenuMsg=function(){return ZmMsg.tagMessage\n};\nZmMsgController.prototype._getMoveDialogTitle=function(){return ZmMsg.moveMessage\n};\nZmMsgController.prototype._setViewContents=function(b){this._view[b].set(this._msg)\n};\nZmMsgController.prototype._resetNavToolBarButtons=function(b){b=b||this.getCurrentViewId();\nif(!this._navToolBar[b]){return\n}if(!appCtxt.isChildWindow){var d=this._msg.list&&this._msg.list.getVector();\nthis._navToolBar[b].enable(ZmOperation.PAGE_BACK,(d&&(d.get(0)!=this._msg)));\nvar c=d&&(this._msg.list.hasMore()||(d.getLast()!=this._msg));\nthis._navToolBar[b].enable(ZmOperation.PAGE_FORWARD,c);\nthis._navToolBar[b].setToolTip(ZmOperation.PAGE_BACK,ZmMsg.previousMessage);\nthis._navToolBar[b].setToolTip(ZmOperation.PAGE_FORWARD,ZmMsg.nextMessage)\n}};\nZmMsgController.prototype._showNavToolBarButtons=function(c,b){var d=this._navToolBar[c];\nif(!d){return\n}if(!appCtxt.isChildWindow){d.getButton(ZmOperation.PAGE_BACK).setVisible(b);\nd.getButton(ZmOperation.PAGE_FORWARD).setVisible(b)\n}};\nZmMsgController.prototype._goToMsg=function(c,d){var b=this._parentController;\nif(b&&b.pageItemSilently){b.pageItemSilently(this._msg,d,this)\n}};\nZmMsgController.prototype._selectNextItemInParentListView=function(){var b=this._parentController;\nif(b&&b._getNextItemToSelect){b._view[b._currentViewId]._itemToSelect=b._getNextItemToSelect()\n}};\nZmMsgController.prototype._doDelete=function(){this._selectNextItemInParentListView();\nZmMailListController.prototype._doDelete.apply(this,arguments)\n};\nZmMsgController.prototype._doMove=function(){this._selectNextItemInParentListView();\nZmMailListController.prototype._doMove.apply(this,arguments)\n};\nZmMsgController.prototype._doSpam=function(){this._selectNextItemInParentListView();\nZmMailListController.prototype._doSpam.apply(this,arguments)\n};\nZmMsgController.prototype._menuPopdownActionListener=function(b){};\nZmMsgController.prototype.getMsg=function(b){return this._msg\n};\nZmMsgController.prototype.getItems=function(){return[this._msg]\n};\nZmMsgController.prototype._getLoadedMsg=function(b,c){c.run(this._msg)\n};\nZmMsgController.prototype._getSelectedMsg=function(){return this._msg\n};\nZmMsgController.prototype.setMsg=function(b){this._msg=b;\nb.refCount++\n};\nZmMsgController.prototype.getItemView=function(){return this._view[this._currentViewId]\n};\nZmMsgController.prototype._checkReplenish=function(b){};\nZmMsgController.prototype._checkItemCount=function(){if(!appCtxt.isChildWindow){this._backListener()\n}};\nZmMsgController.prototype._getDefaultFocusItem=function(){return this._toolbar[this._currentViewId]\n};\nZmMsgController.prototype._backListener=function(c){if(appCtxt.isOffline&&(this._currentViewId!=appCtxt.getCurrentViewId())){return\n}var b=appCtxt.isChildWindow;\nif(!this._app.popView()&&!b){this._app.mailSearch()\n}};\nZmMsgController.prototype.isTransient=function(b,c){return(appCtxt.getViewTypeFromId(c)!=ZmId.VIEW_COMPOSE)\n};\nZmMsgController.prototype._tabCallback=function(b,c){return(appCtxt.getViewTypeFromId(b)==ZmId.VIEW_MSG)\n};\nZmMsgController.prototype._printListener=function(i){var b=[];\nvar l=this._msg;\nvar e;\nvar k;\nif(l.toString()==\"ZmConv\"){if(appCtxt.isOffline&&l.id.split(\":\")[1]<0){e=l.msgIds[0]\n}else{e=\"C:\"+l.id\n}var g=l.getMsgList();\nfor(var h=0;\nh<g.length;\nh++){if(g[h].showImages){k=true;\nbreak\n}}}else{e=l.id;\nvar f=l.partId;\nif(f){e+=\"&part=\"+f\n}if(l.showImages){k=true\n}}var c=\"/h/printmessage?id=\"+e+\"&tz=\"+AjxTimezone.getServerId(AjxTimezone.DEFAULT);\nif(appCtxt.get(ZmSetting.DISPLAY_EXTERNAL_IMAGES)||k){c+=\"&xim=1\"\n}if(appCtxt.isOffline){var d=l.getAccount().name;\nc+=\"&acct=\"+d\n}window.open(appContextPath+c,\"_blank\")\n};\nZmMsgController.prototype._subscribeResponseHandler=function(b,c){ZmMailListController.prototype._subscribeResponseHandler.call(this,b,c);\nappCtxt.getAppViewMgr().popView()\n};\nZmMsgController.prototype._acceptShareHandler=function(b){ZmMailListController.prototype._acceptShareHandler.call(this,b);\nif(!appCtxt.isChildWindow){appCtxt.getAppViewMgr().popView()\n}};\nZmMsgController.prototype._setStatics=function(){if(!ZmMsgController.ALLOWED_SHORTCUT){ZmMsgController.ALLOWED_SHORTCUT=AjxUtil.arrayAsHash([ZmKeyMap.FORWARD,ZmKeyMap.MOVE,ZmKeyMap.PRINT,ZmKeyMap.TAG,ZmKeyMap.UNTAG,ZmKeyMap.REPLY,ZmKeyMap.REPLY_ALL,ZmKeyMap.SPAM,ZmKeyMap.MARK_READ,ZmKeyMap.MARK_UNREAD,ZmKeyMap.FLAG])\n}ZmMailListController.prototype._setStatics()\n};\nZmMsgController.prototype._postRemoveCallback=function(){this._msg.refCount--\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmIdentity\")){ZmIdentity=function(b){this.reset();\nthis.name=b;\nthis.id=\"\"\n};\nZmIdentity.prototype.toString=function(){return\"ZmIdentity\"\n};\nZmIdentity.COMPOSE_SAME=\"same\";\nZmIdentity.COMPOSE_TEXT=\"text\";\nZmIdentity.COMPOSE_HTML=\"html\";\nZmIdentity.DEFAULT_NAME=\"DEFAULT\";\nZmIdentity.FIELDS={};\nZmIdentity._SOAP={};\nZmIdentity.SIG_ID_NONE=\"11111111-1111-1111-1111-111111111111\";\nZmIdentity.addField=function(c,b){ZmIdentity[c]=c;\nZmIdentity.FIELDS[c]=b;\nZmIdentity._SOAP[b.soap]=b\n};\nZmIdentity.addField(\"NAME\",{name:\"name\",soap:\"zimbraPrefIdentityName\",type:ZmSetting.D_STRING});\nZmIdentity.addField(\"SEND_FROM_DISPLAY\",{name:\"sendFromDisplay\",soap:\"zimbraPrefFromDisplay\",type:ZmSetting.D_STRING});\nZmIdentity.addField(\"SEND_FROM_ADDRESS\",{name:\"sendFromAddress\",soap:\"zimbraPrefFromAddress\",type:ZmSetting.D_STRING});\nZmIdentity.addField(\"SEND_FROM_ADDRESS_TYPE\",{name:\"sendFromAddressType\",soap:\"zimbraPrefFromAddressType\",type:ZmSetting.D_STRING});\nZmIdentity.addField(\"SET_REPLY_TO\",{name:\"setReplyTo\",soap:\"zimbraPrefReplyToEnabled\",type:ZmSetting.D_BOOLEAN});\nZmIdentity.addField(\"SET_REPLY_TO_DISPLAY\",{name:\"setReplyToDisplay\",soap:\"zimbraPrefReplyToDisplay\",type:ZmSetting.D_STRING});\nZmIdentity.addField(\"SET_REPLY_TO_ADDRESS\",{name:\"setReplyToAddress\",soap:\"zimbraPrefReplyToAddress\",type:ZmSetting.D_STRING});\nZmIdentity.addField(\"SIGNATURE\",{name:\"signature\",soap:\"zimbraPrefDefaultSignatureId\",type:ZmSetting.D_STRING});\nZmIdentity.addField(\"REPLY_SIGNATURE\",{name:\"replySignature\",soap:\"zimbraPrefForwardReplySignatureId\",type:ZmSetting.D_STRING});\nZmIdentity.addField(\"USE_WHEN_SENT_TO\",{name:\"useWhenSentTo\",soap:\"zimbraPrefWhenSentToEnabled\",type:ZmSetting.D_BOOLEAN});\nZmIdentity.addField(\"WHEN_SENT_TO_ADDRESSES\",{name:\"whenSentToAddresses\",soap:\"zimbraPrefWhenSentToAddresses\",type:ZmSetting.D_LIST});\nZmIdentity.addField(\"USE_WHEN_IN_FOLDER\",{name:\"useWhenInFolder\",soap:\"zimbraPrefWhenInFoldersEnabled\",type:ZmSetting.D_BOOLEAN});\nZmIdentity.addField(\"WHEN_IN_FOLDERIDS\",{name:\"whenInFolderIds\",soap:\"zimbraPrefWhenInFolderIds\",type:ZmSetting.D_LIST});\nZmIdentity.prototype.getField=function(b){return this[ZmIdentity.FIELDS[b].name]\n};\nZmIdentity.prototype.setField=function(b,c){this[ZmIdentity.FIELDS[b].name]=c\n};\nZmIdentity.prototype.create=function(d,c,b){return this._doRequest(\"Create\",this._handleCreateResponse,d,c,b)\n};\nZmIdentity.prototype.save=function(d,c,b){return this._doRequest(\"Modify\",this._handleSaveResponse,d,c,b)\n};\nZmIdentity.prototype.doDelete=function(d,c,b){return this._doRequest(\"Delete\",this._handleDeleteResponse,d,c,b)\n};\nZmIdentity.prototype.reset=function(){for(var c in ZmIdentity.FIELDS){var b=ZmIdentity.FIELDS[c];\nswitch(b.type){case ZmSetting.D_STRING:this[b.name]=\"\";\nbreak;\ncase ZmSetting.D_BOOLEAN:this[b.name]=false;\nbreak;\ncase ZmSetting.D_LIST:this[b.name]=[];\nbreak\n}}};\nZmIdentity.prototype._doRequest=function(c,f,k,l,o){var u=AjxSoapDoc.create(c+\"IdentityRequest\",\"urn:zimbraAccount\");\nvar b=u.set(\"identity\");\nvar v=this.isDefault?ZmIdentity.DEFAULT_NAME:this.name;\nif(c!=\"Create\"&&this.id!==\"\"){b.setAttribute(\"id\",this.id)\n}else{b.setAttribute(\"name\",this.name)\n}if(c!=\"Delete\"){for(var r in ZmIdentity.FIELDS){var d=ZmIdentity.FIELDS[r];\nif(this.hasOwnProperty(d.name)){var p=this.getField(r);\nif(d.type==ZmSetting.D_LIST){for(var q=0,m=p.length;\nq<m;\nq++){if(p[q]){var h=u.set(\"a\",p[q],b);\nh.setAttribute(\"name\",d.soap)\n}}}else{if(d.type==ZmSetting.D_BOOLEAN){p=p?\"TRUE\":\"FALSE\"\n}var n=(r==ZmIdentity.SIGNATURE||r==ZmIdentity.REPLY_SIGNATURE);\nvar g=(r==ZmIdentity.SEND_FROM_DISPLAY||r==ZmIdentity.SET_REPLY_TO_DISPLAY);\nvar t=(r==ZmIdentity.SET_REPLY_TO_ADDRESS);\nif(p||n||g||t){var h=u.set(\"a\",p,b);\nh.setAttribute(\"name\",d.soap)\n}}}}}var e=new AjxCallback(this,f,[k]);\nif(o){o.addNewRequestParams(u,e,l);\nreturn\n}var s={soapDoc:u,asyncMode:Boolean(k),callback:e,errorCallback:l};\nreturn appCtxt.getAppController().sendRequest(s)\n};\nZmIdentity.prototype._loadFromDom=function(e){this.id=e.id;\nvar c=e._attrs;\nif(c){for(var b in c){var f=ZmIdentity._SOAP[b];\nif(f){var d=c[b];\nif(f.type==ZmSetting.D_BOOLEAN){this[f.name]=(d.toString().toUpperCase()==\"TRUE\")\n}else{if(f.type==ZmSetting.D_LIST){this[f.name]=AjxUtil.isArray(d)?d:[d]\n}else{this[f.name]=d\n}}}}}if(e.name){if(e.name==ZmIdentity.DEFAULT_NAME){this.isDefault=true\n}}};\nZmIdentity.prototype._handleCreateResponse=function(e,b,c){this.id=c.identity[0].id;\ndelete this._new;\ndelete this._dirty;\nvar d=appCtxt.getIdentityCollection();\nd.add(this);\nd._notify(ZmEvent.E_CREATE,{item:this});\nif(e){e.run(this,b)\n}};\nZmIdentity.prototype._handleSaveResponse=function(e,b,c){delete this._dirty;\nvar d=appCtxt.getIdentityCollection();\nd.remove(this);\nd.add(this);\nd._notify(ZmEvent.E_MODIFY,{item:this});\nif(e){e.run(this,b)\n}};\nZmIdentity.prototype._handleDeleteResponse=function(e,b,c){var d=appCtxt.getIdentityCollection();\nd.remove(this);\nd._notify(ZmEvent.E_DELETE,{item:this});\nif(e){e.run(this,b)\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmIdentityCollection\")){ZmIdentityCollection=function(){ZmModel.call(this,ZmEvent.S_IDENTITY);\nthis.defaultIdentity=null;\nthis._initialized=false;\nthis._idToIdentity={};\nthis._addressToIdentity={};\nthis._folderToIdentity={};\nthis._size=0\n};\nZmIdentityCollection.prototype=new ZmModel;\nZmIdentityCollection.prototype.constructor=ZmIdentityCollection;\nZmIdentityCollection.prototype.toString=function(){return\"ZmIdentityCollection\"\n};\nZmIdentityCollection.prototype.getSize=function(){return this.getIdentities().length\n};\nZmIdentityCollection.prototype.getIdentities=function(e){var c,d=0,b=[],f=appCtxt.isOffline;\nfor(var g in this._idToIdentity){c=this._idToIdentity[g];\nif(f&&c.isFromDataSource){continue\n}b[d++]=c\n}if(e){b.sort(ZmIdentityCollection._comparator)\n}return b\n};\nZmIdentityCollection.prototype.getById=function(b){return this._idToIdentity[b]\n};\nZmIdentityCollection.prototype.getByName=function(c){c=c.toLowerCase();\nfor(var d in this._idToIdentity){var b=this._idToIdentity[d];\nif(b.name.toLowerCase()==c){return b\n}}return null\n};\nZmIdentityCollection.prototype.add=function(b){if(!this._idToIdentity[b.id]){this._idToIdentity[b.id]=b;\nif(b.isDefault){this.defaultIdentity=b\n}this._addToMaps(b);\nthis._size++\n}};\nZmIdentityCollection.prototype.remove=function(b){if(this._idToIdentity[b.id]){this._removeFromMaps(b);\ndelete this._idToIdentity[b.id];\nthis._size--\n}};\nZmIdentityCollection.prototype.selectIdentityFromFolder=function(b){if(!b){return this.defaultIdentity\n}var d=appCtxt.getById(b);\nvar c=d.parent;\nreturn this._folderToIdentity[d.getRemoteId()]||this.selectIdentityFromFolder(c&&c.id)\n};\nZmIdentityCollection.prototype.selectIdentity=function(d,c){if(!appCtxt.get(ZmSetting.IDENTITIES_ENABLED)||!d){return this.defaultIdentity\n}if(c){return this._selectIdentityFromAddresses(d,c)\n}var b=this._selectIdentityFromAddresses(d,AjxEmailAddress.TO);\nif(b){return b\n}b=this._selectIdentityFromAddresses(d,AjxEmailAddress.CC);\nif(b){return b\n}if(d.isInvite()){b=this._selectIdentityFromAttendees(d);\nif(b){return b\n}}return this.selectIdentityFromFolder(d.folderId)\n};\nZmIdentityCollection.prototype.initialize=function(f){if(this._initialized||this.getSize()||!f){return\n}var d=f.identity;\nfor(var c=0,e=d?d.length:0;\nc<e;\nc++){var b=new ZmIdentity(\"\");\nb._loadFromDom(d[c]);\nthis.add(b)\n}this._initialized=true\n};\nZmIdentityCollection.prototype._addToMaps=function(c){if(c.useWhenSentTo){var j=c.whenSentToAddresses;\nfor(var e=0,g=j.length;\ne<g;\ne++){var b=j[e].toLowerCase();\nif(!this._addressToIdentity[b]||!c.isFromDataSource){this._addressToIdentity[b]=c\n}}}if(c.useWhenInFolder){var d=c.whenInFolderIds;\nfor(var e=0,g=d.length;\ne<g;\ne++){var f=appCtxt.getById(d[e]);\nif(f){var h=f.getRemoteId();\nthis._folderToIdentity[h]=c\n}}}};\nZmIdentityCollection.prototype._removeFromMaps=function(c){for(var d=0,f=c.whenSentToAddresses.length;\nd<f;\nd++){var b=c.whenSentToAddresses[d];\ndelete this._addressToIdentity[b]\n}for(var d=0,f=c.whenInFolderIds.length;\nd<f;\nd++){var e=appCtxt.getById(c.whenInFolderIds[d]);\nif(e){var g=e.getRemoteId();\ndelete this._folderToIdentity[g]\n}}};\nZmIdentityCollection._comparator=function(d,c){if(d.isDefault){return -1\n}else{if(c.isDefault){return 1\n}else{return d.name==c.name?0:d.name<c.name?-1:1\n}}};\nZmIdentityCollection.prototype.getSortIndex=function(b){var d=this.getIdentities(true);\nif(!(d&&d.length)){return 0\n}if(this.getById(b.id)){for(var c=0;\nc<d.length;\nc++){if(d[c].id==b.id){return c\n}}}else{for(var c=0;\nc<d.length;\nc++){var e=ZmIdentityCollection._comparator(b,d[c]);\nif(e==-1){return c\n}}}return d.length-1\n};\nZmIdentityCollection.prototype._selectIdentityFromAddresses=function(g,e){var c;\nvar h=g.getAddresses(e).getArray();\nfor(var d=0,f=h.length;\nd<f;\nd++){var b=h[d].getAddress();\nif(b){c=this._addressToIdentity[b.toLowerCase()];\nif(c){return c\n}}}return null\n};\nZmIdentityCollection.prototype._selectIdentityFromAttendees=function(g){if(!g.isInvite()){return null\n}var c;\nvar f=g.invite.getAttendees();\nif(!f){return null\n}for(var d=0,e=f.length;\nd<e;\nd++){var b=f[d].url;\nif(b){c=this._addressToIdentity[b.toLowerCase()];\nif(c){return c\n}}}return null\n};\nZmIdentityCollection.prototype.getIdentityBySendAddress=function(b){for(var d in this._idToIdentity){var c=this._idToIdentity[d];\nif(c.sendFromAddress==b){return c\n}}return null\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmDataSource\")){ZmDataSource=function(b,c){if(arguments.length==0){return\n}ZmAccount.call(this,b,c);\nthis.reset()\n};\nZmDataSource.prototype=new ZmAccount;\nZmDataSource.prototype.constructor=ZmDataSource;\nZmDataSource.prototype.toString=function(){return\"ZmDataSource\"\n};\nZmDataSource.CONNECT_CLEAR=\"cleartext\";\nZmDataSource.CONNECT_SSL=\"ssl\";\nZmDataSource.CONNECT_DEFAULT=ZmDataSource.CONNECT_CLEAR;\nZmDataSource.POLL_NEVER=\"0\";\nZmDataSource.DATASOURCE_ATTRS={id:\"id\",name:\"name\",isEnabled:\"enabled\",emailAddress:\"email\",host:\"mailServer\",port:\"port\",username:\"userName\",password:\"password\",l:\"folderId\",connectionType:\"connectionType\",pollingInterval:\"pollingInterval\",smtpEnabled:\"smtpEnabled\",leaveOnServer:\"leaveOnServer\"};\nZmDataSource.IDENTITY_ATTRS={fromDisplay:\"sendFromDisplay\",useAddressForForwardReply:\"setReplyTo\",replyToAddress:\"setReplyToAddress\",replyToDisplay:\"setReplyToDisplay\",defaultSignature:\"signature\",forwardReplySignature:\"replySignature\"};\nZmDataSource.prototype.ELEMENT_NAME=\"dsrc\";\nZmDataSource.prototype.enabled=true;\nZmDataSource.prototype.mailServer=\"\";\nZmDataSource.prototype.userName=\"\";\nZmDataSource.prototype.password=\"\";\nZmDataSource.prototype.folderId=ZmOrganizer.ID_INBOX;\nZmDataSource.prototype.leaveOnServer=true;\nZmDataSource.prototype.connectionType=ZmDataSource.CONNECT_DEFAULT;\nZmDataSource.prototype.setEmail=function(b){this.email=b\n};\nZmDataSource.prototype.getEmail=function(){var b=this.email!=null?this.email:this.identity.getField(ZmIdentity.SEND_FROM_ADDRESS);\nif(!b){var d=ZmDataSource.getProviderForAccount(this);\nvar c=(d&&d._host)||this.mailServer;\nb=\"\";\nif(this.userName){if(this.userName.match(/@/)){b=this.userName\n}else{if(c){b=[this.userName,c].join(\"@\")\n}}}}return b\n};\nZmDataSource.prototype.setFolderId=function(b){if(b==-1&&this.folderId!=ZmOrganizer.ID_INBOX){return\n}this.folderId=b\n};\nZmDataSource.prototype.getFolderId=function(){return this.folderId\n};\nZmDataSource.prototype.getIdentity=function(){return this.identity\n};\nZmDataSource.prototype.create=function(j,f,c){var i=AjxSoapDoc.create(\"CreateDataSourceRequest\",\"urn:zimbraMail\");\nvar l=i.set(this.ELEMENT_NAME);\nfor(var h in ZmDataSource.DATASOURCE_ATTRS){var e=ZmDataSource.DATASOURCE_ATTRS[h];\nvar b=e==\"folderId\"?ZmOrganizer.normalizeId(this[e]):this[e];\nif(e==\"id\"||(!b&&e!=\"enabled\"&&e!=\"leaveOnServer\")){continue\n}l.setAttribute(h,String(b))\n}var g=this.getIdentity();\nfor(var h in ZmDataSource.IDENTITY_ATTRS){var e=ZmDataSource.IDENTITY_ATTRS[h];\nvar b=g[e];\nif(!b){continue\n}l.setAttribute(h,String(b))\n}var k=new AjxCallback(this,this._handleCreateResponse,[j]);\nif(c){c.addNewRequestParams(i,k,f);\nc.setSensitive(Boolean(this.password));\nreturn\n}var d={soapDoc:i,sensitive:Boolean(this.password),asyncMode:Boolean(j),callback:k,errorCallback:f};\nreturn appCtxt.getAppController().sendRequest(d)\n};\nZmDataSource.prototype.save=function(k,f,b,e){var j=AjxSoapDoc.create(\"ModifyDataSourceRequest\",\"urn:zimbraMail\");\nvar m=j.set(this.ELEMENT_NAME);\nm.setAttribute(\"id\",this.id);\nif(!e){for(var i in ZmDataSource.DATASOURCE_ATTRS){var d=ZmDataSource.DATASOURCE_ATTRS[i];\nif(!this.hasOwnProperty(d)){continue\n}var g=this[d];\nif(d===\"folderId\"){g=ZmOrganizer.normalizeId(g)\n}else{if(d===\"pollingInterval\"){continue\n}}m.setAttribute(i,String(g))\n}}var h=this.getIdentity();\nfor(var i in ZmDataSource.IDENTITY_ATTRS){var d=ZmDataSource.IDENTITY_ATTRS[i];\nif(!h.hasOwnProperty(d)){continue\n}var g=h[d];\nm.setAttribute(i,String(g))\n}var l=new AjxCallback(this,this._handleSaveResponse,[k]);\nif(b){b.addNewRequestParams(j,l,f);\nb.setSensitive(Boolean(this.password));\nreturn\n}var c={soapDoc:j,sensitive:Boolean(this.password),asyncMode:Boolean(k),callback:l,errorCallback:f};\nreturn appCtxt.getAppController().sendRequest(c)\n};\nZmDataSource.prototype.doDelete=function(h,b,e){var c=AjxSoapDoc.create(\"DeleteDataSourceRequest\",\"urn:zimbraMail\");\nvar d=c.set(this.ELEMENT_NAME);\nd.setAttribute(\"id\",this.id);\nvar g=new AjxCallback(this,this._handleDeleteResponse,[h]);\nif(e){e.addNewRequestParams(c,g,b);\nreturn\n}var f={soapDoc:c,asyncMode:Boolean(h),callback:g,errorCallback:b};\nreturn appCtxt.getAppController().sendRequest(f)\n};\nZmDataSource.prototype.testConnection=function(l,f,b,j){var h=AjxSoapDoc.create(\"TestDataSourceRequest\",\"urn:zimbraMail\");\nvar m=h.set(this.ELEMENT_NAME);\nvar k=[\"host\",\"port\",\"username\",\"password\",\"connectionType\",\"leaveOnServer\"];\nfor(var e=0;\ne<k.length;\ne++){var g=k[e];\nvar d=ZmDataSource.DATASOURCE_ATTRS[g];\nm.setAttribute(g,this[d])\n}if(b){b.addNewRequestParams(h,l,f);\nb.setSensitive(true);\nreturn\n}var c={soapDoc:h,sensitive:true,asyncMode:Boolean(l),noBusyOverlay:j,callback:l,errorCallback:f};\nreturn appCtxt.getAppController().sendRequest(c)\n};\nZmDataSource.prototype.getPort=function(){return this.port||this.getDefaultPort()\n};\nZmDataSource.prototype.isStatusOk=function(){return this.enabled&&!this.failingSince\n};\nZmDataSource.prototype.setFromJson=function(f){if(f.failingSince){this.failingSince=f.failingSince;\nthis.lastError=(f.lastError&&f.lastError[0]._content)||ZmMsg.unknownError\n}else{delete this.failingSince;\ndelete this.lastError\n}for(var d in ZmDataSource.DATASOURCE_ATTRS){var b=f[d];\nif(b==null){continue\n}if(d==\"isEnabled\"||d==\"leaveOnServer\"){b=b==\"1\"||String(b).toLowerCase()==\"true\"\n}else{if(d===\"pollingInterval\"){b=b/1000\n}}var e=ZmDataSource.DATASOURCE_ATTRS[d];\nthis[e]=b\n}var c=this.getIdentity();\nfor(var d in ZmDataSource.IDENTITY_ATTRS){var b=f[d];\nif(b==null){continue\n}if(d==\"useAddressForForwardReply\"){b=b==\"1\"||String(b).toLowerCase()==\"true\"\n}var e=ZmDataSource.IDENTITY_ATTRS[d];\nc[e]=b\n}this._setupIdentity()\n};\nZmDataSource.prototype.reset=function(){delete this.mailServer;\ndelete this.userName;\ndelete this.password;\ndelete this.folderId;\ndelete this.leaveOnServer;\ndelete this.connectionType;\ndelete this.pollingInterval;\nthis.email=\"\";\nthis.port=this.getDefaultPort();\nvar c=this.identity=new ZmIdentity();\nc.id=this.id;\nc.isFromDataSource=true;\nvar b=this;\nc.save=function(f,d,e){ZmDataSource.prototype.save.call(b,f,d,e,true)\n}\n};\nZmDataSource.prototype.getProvider=function(){return ZmDataSource.getProviderForAccount(this)\n};\nZmDataSource.addProvider=function(e){var b=ZmDataSource.getProviders();\nb[e.id]=e;\nif(e.type){e.type=e.type.toLowerCase()==\"pop\"?ZmAccount.TYPE_POP:ZmAccount.TYPE_IMAP\n}else{e.type=ZmAccount.TYPE_POP\n}if(e.connectionType){var d=e.connectionType.toLowerCase()==\"ssl\";\ne.connectionType=d?ZmDataSource.CONNECT_SSL:ZmDataSource.CONNECT_CLEAR\n}else{e.connectionType=ZmDataSource.CONNECT_CLEAR\n}if(!e.port){var c=e.type==ZmAccount.TYPE_POP;\nif(d){e.port=c?ZmPopAccount.PORT_SSL:ZmImapAccount.PORT_SSL\n}else{e.port=c?ZmPopAccount.PORT_CLEAR:ZmImapAccount.PORT_CLEAR\n}}};\nZmDataSource.getProviders=function(){if(!ZmDataSource._providers){ZmDataSource._providers={}\n}return ZmDataSource._providers\n};\nZmDataSource.getProviderForAccount=function(b){return ZmDataSource.getProviderForHost(b.mailServer)\n};\nZmDataSource.getProviderForHost=function(c){var b=ZmDataSource.getProviders();\nfor(var e in b){hasProviders=true;\nvar d=b[e];\nif(d.host==c){return d\n}}return null\n};\nZmDataSource.removeAllProviders=function(){delete ZmDataSource._providers\n};\nZmDataSource.prototype._setupIdentity=function(){this.identity.useWhenSentTo=true;\nthis.identity.whenSentToAddresses=[this.getEmail()];\nthis.identity.name=this.name\n};\nZmDataSource.prototype._loadFromDom=function(b){this.setFromJson(b)\n};\nZmDataSource.prototype._handleCreateResponse=function(n,o){var g=o._data.CreateDataSourceResponse;\nthis.id=g[this.ELEMENT_NAME][0].id;\nthis.identity.id=this.id;\nthis._setupIdentity();\ndelete this._new;\ndelete this._dirty;\nappCtxt.getDataSourceCollection().add(this);\nvar b=[ZmApp.MAIL,ZmApp.PORTAL];\nfor(var h=0;\nh<b.length;\nh++){var c=appCtxt.getApp(b[h]);\nif(c){var f=c.getOverviewId();\nvar d=appCtxt.getOverviewController().getTreeView(f,ZmOrganizer.FOLDER);\nvar e=appCtxt.getActiveAccount().isMain?this.folderId:ZmOrganizer.getSystemId(this.folderId);\nvar k=d?d.getTreeItemById(e):null;\nif(k){if(this.type==ZmAccount.TYPE_POP&&this.folderId!=ZmFolder.ID_INBOX){k.setImage(\"POPAccount\")\n}else{if(this.type==ZmAccount.TYPE_IMAP){k.dispose();\nvar m=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT);\nvar j=d.getTreeItemById(m);\nvar l=appCtxt.getById(this.folderId);\nd._addNew(j,l)\n}}}}}if(n){n.run()\n}};\nZmDataSource.prototype._handleSaveResponse=function(d,b){delete this._dirty;\nvar c=appCtxt.getDataSourceCollection();\nc.remove(this);\nc.add(this);\nif(d){d.run()\n}};\nZmDataSource.prototype._handleDeleteResponse=function(i,d){appCtxt.getDataSourceCollection().remove(this);\nvar h=appCtxt.getApp(ZmApp.MAIL).getOverviewId();\nvar e=appCtxt.getOverviewController().getTreeView(h,ZmOrganizer.FOLDER);\nvar g=appCtxt.getActiveAccount().isMain?this.folderId:ZmOrganizer.getSystemId(this.folderId);\nif(this.folderId==ZmAccountsPage.DOWNLOAD_TO_FOLDER&&this._object_&&this._object_.folderId){g=this._object_.folderId\n}var f=e?e.getTreeItemById(g):null;\nif(f){if(this.type==ZmAccount.TYPE_POP&&this.folderId!=ZmFolder.ID_INBOX){f.setImage(\"Folder\")\n}else{if(this.type==ZmAccount.TYPE_IMAP){f.dispose();\nvar c=e.getTreeItemById(ZmOrganizer.ID_ROOT);\nvar b=appCtxt.getById(g);\nif(b){e._addNew(c,b)\n}}}}if(i){i.run()\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmDataSourceCollection\")){ZmDataSourceCollection=function(){ZmModel.call(this,ZmEvent.S_DATA_SOURCE);\nthis._initialized=false;\nthis._itemMap={};\nthis._pop3Map={};\nthis._imapMap={}\n};\nZmDataSourceCollection.prototype=new ZmModel;\nZmDataSourceCollection.prototype.constructor=ZmDataSourceCollection;\nZmDataSourceCollection.prototype.toString=function(){return\"ZmDataSourceCollection\"\n};\nZmDataSourceCollection.prototype.getItems=function(){return AjxUtil.values(this._itemMap)\n};\nZmDataSourceCollection.prototype.getItemsFor=function(b){var c=[];\nfor(var e in this._itemMap){var d=this._itemMap[e];\nif(d.folderId==b&&d.enabled){c.push(d)\n}}return c\n};\nZmDataSourceCollection.prototype.getPopAccounts=function(){return AjxUtil.values(this._pop3Map)\n};\nZmDataSourceCollection.prototype.getImapAccounts=function(){return AjxUtil.values(this._imapMap)\n};\nZmDataSourceCollection.prototype.getPopAccountsFor=function(b){var c=[];\nfor(var e in this._pop3Map){var d=this._pop3Map[e];\nif(d.folderId==b&&d.enabled){c.push(d)\n}}return c\n};\nZmDataSourceCollection.prototype.getImapAccountsFor=function(b){var c=[];\nfor(var e in this._imapMap){var d=this._imapMap[e];\nif(d.folderId==b&&d.enabled){c.push(d)\n}}return c\n};\nZmDataSourceCollection.prototype.importMailFor=function(b){this.importMail(this.getItemsFor(b))\n};\nZmDataSourceCollection.prototype.importPopMailFor=function(b){this.importMail(this.getPopAccountsFor(b))\n};\nZmDataSourceCollection.prototype.importImapMailFor=function(b){this.importMail(this.getImapAccountsFor(b))\n};\nZmDataSourceCollection.prototype.importMail=function(b){if(b&&b.length>0){var f={};\nvar h=AjxSoapDoc.create(\"ImportDataRequest\",\"urn:zimbraMail\");\nfor(var e=0;\ne<b.length;\ne++){var g=b[e];\nf[g.id]=g;\nvar j=h.set(g.ELEMENT_NAME);\nj.setAttribute(\"id\",g.id)\n}var d={soapDoc:h,asyncMode:true,noBusyOverlay:true,callback:null,errorCallback:null};\nappCtxt.getAppController().sendRequest(d);\nvar k=2000;\nvar c=new AjxTimedAction(this,this.checkStatus,[f,k]);\nAjxTimedAction.scheduleAction(c,k)\n}};\nZmDataSourceCollection.prototype.getById=function(b){return this._itemMap[b]\n};\nZmDataSourceCollection.prototype.getByFolderId=function(b,c){var e=[];\nfor(var f in this._itemMap){var d=this._itemMap[f];\nif(d.folderId==b){if(!c||(c&&c==d.type)){e.push(d)\n}}}return e\n};\nZmDataSourceCollection.prototype.add=function(b){this._itemMap[b.id]=b;\nif(b.type==ZmAccount.TYPE_POP){this._pop3Map[b.id]=b\n}else{if(b.type==ZmAccount.TYPE_IMAP){this._imapMap[b.id]=b\n}}appCtxt.getIdentityCollection().add(b.getIdentity());\nthis._notify(ZmEvent.E_CREATE,{item:b})\n};\nZmDataSourceCollection.prototype.modify=function(b){appCtxt.getIdentityCollection().notifyModify(b.getIdentity(),true);\nthis._notify(ZmEvent.E_MODIFY,{item:b})\n};\nZmDataSourceCollection.prototype.remove=function(b){delete this._itemMap[b.id];\ndelete this._pop3Map[b.id];\ndelete this._imapMap[b.id];\nappCtxt.getIdentityCollection().remove(b.getIdentity());\nthis._notify(ZmEvent.E_DELETE,{item:b})\n};\nZmDataSourceCollection.prototype.initialize=function(b){if(!b||this._initialized){return\n}var q=[];\nif(appCtxt.get(ZmSetting.POP_ACCOUNTS_ENABLED)){var g=b.pop3||[];\nfor(var h=0;\nh<g.length;\nh++){var e=g[h];\nvar c=new ZmPopAccount(e.id);\nc.setFromJson(e);\nthis.add(c);\nif(!c.isStatusOk()){q.push(c)\n}}}if(appCtxt.get(ZmSetting.IMAP_ACCOUNTS_ENABLED)){var f=b.imap||[];\nfor(var h=0;\nh<f.length;\nh++){var e=f[h];\nvar c=new ZmImapAccount(e.id);\nc.setFromJson(e);\nthis.add(c);\nif(!c.isStatusOk()){q.push(c)\n}}}this._initialized=true;\nvar k=q.length;\nif(k>0){var m=[AjxMessageFormat.format(ZmMsg.dataSourceFailureDescription,[k])];\nfor(var h=0;\nh<k;\nh++){var c=q[h];\nvar l=Number(c.failingSince);\nvar p=c.lastError;\nif(isNaN(l)){var o=ZmMsg.dataSourceFailureItem_noDate;\nvar d=[AjxStringUtil.htmlEncode(c.getName()),AjxStringUtil.htmlEncode(p)]\n}else{var o=ZmMsg.dataSourceFailureItem;\nvar d=[AjxStringUtil.htmlEncode(c.getName()),new Date(l*1000),AjxStringUtil.htmlEncode(p)]\n}m.push(AjxMessageFormat.format(o,d))\n}m.push(ZmMsg.dataSourceFailureInstructions);\nvar r=m.join(\"\");\nvar j=DwtShell.getShell(window);\nvar n=new DwtMessageDialog({parent:j,buttons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]});\nn.setMessage(r,DwtMessageDialog.CRITICAL_STYLE,ZmMsg.dataSourceFailureTitle);\nn.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this.__handleErrorDialogOk,[n]));\nn.popup()\n}};\nZmDataSourceCollection.prototype.__handleErrorDialogOk=function(b){b.popdown();\nvar c=new AjxCallback(this,this.__gotoPrefSection,[\"ACCOUNTS\"]);\nappCtxt.getAppController().activateApp(ZmApp.PREFERENCES,true,c)\n};\nZmDataSourceCollection.prototype.__gotoPrefSection=function(c){var b=appCtxt.getApp(ZmApp.PREFERENCES).getPrefController();\nb.getPrefsView().selectSection(c)\n};\nZmDataSourceCollection.prototype.checkStatus=function(g,c){if(c&&c<15000){c+=2000\n}var b=AjxSoapDoc.create(\"GetImportStatusRequest\",\"urn:zimbraMail\");\nvar h=new AjxCallback(this,this._checkStatusResponse,[g,c]);\nvar f={soapDoc:b,asyncMode:true,callback:h,errorCallback:null};\nvar e=appCtxt.getAppController();\nvar d=new AjxTimedAction(e,e.sendRequest,[f]);\nAjxTimedAction.scheduleAction(d,c||2000)\n};\nZmDataSourceCollection.prototype._checkStatusResponse=function(e,m,n){var c=[];\nvar f=n._data.GetImportStatusResponse.pop3;\nif(f){for(var d in f){c.push(f[d])\n}}var h=n._data.GetImportStatusResponse.imap;\nif(h){for(var d in h){c.push(h[d])\n}}var l=n._data.GetImportStatusResponse.dsrc;\nif(l){for(var d in l){c.push(l[d])\n}}if(c.length==0){return\n}for(var d=0;\nd<c.length;\nd++){var j=c[d];\nif(!j.isRunning&&e[j.id]){var b=e[j.id];\nif(e[j.id]){delete e[j.id];\nif(j.success){var k=AjxMessageFormat.format(ZmMsg.dataSourceLoadSuccess,AjxStringUtil.htmlEncode(b.name));\nappCtxt.setStatusMsg(k)\n}else{var k=AjxMessageFormat.format(ZmMsg.dataSourceLoadFailure,AjxStringUtil.htmlEncode(b.name));\nappCtxt.setStatusMsg(k,ZmStatusView.LEVEL_CRITICAL);\nvar g=appCtxt.getErrorDialog();\ng.setMessage(k,j.error,DwtMessageDialog.CRITICAL_STYLE);\ng.popup()\n}}}}if(AjxUtil.keys(e).length>0){this.checkStatus(e,m)\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmMailListGroup\")){ZmMailListGroup=function(){this._showEmptySectionHeader=false;\nthis._sectionHeaders=[];\nthis._init()\n};\nZmMailListGroup.prototype.getAllSections=function(b){};\nZmMailListGroup.prototype.addMsgToSection=function(c,b){};\nZmMailListGroup.prototype.isMsgInSection=function(b,c){};\nZmMailListGroup.prototype.clearSections=function(){this._init()\n};\nZmMailListGroup.prototype.getSectionSize=function(b){if(this._section[b]){return this._section[b].length\n}return -1\n};\nZmMailListGroup.prototype.getSectionTitle=function(b){return this._getSectionHeaderTitle(b)\n};\nZmMailListGroup.prototype.getSectionHeader=function(b){var c=new ZmMailListSectionHeader(this,{headerTitle:b});\nthis._sectionHeaders.push(c);\nreturn c.getHeaderHtml()\n};\nZmMailListGroup.prototype.resetSectionHeaders=function(){for(var b=0;\nb<this._sectionHeaders.length;\nb++){var c=this._sectionHeaders[b].getHtmlElement();\nc.parentNode.removeChild(c)\n}this._sectionHeaders=[]\n};\nZmMailListGroup.prototype.getSortBy=function(b){return null\n};\nZmMailListGroup.prototype.getAllSectionHeaders=function(){return this._sectionHeaders\n};\nZmMailListGroup.prototype._init=function(){this._section={}\n};\nZmMailListGroup.prototype._getSectionHeaderTitle=function(b){return\"\"\n};\nZmMailListGroup.getGroup=function(b){switch(b){case ZmId.GROUPBY_DATE:return new ZmMailListDateGroup();\ncase ZmId.GROUPBY_SIZE:return new ZmMailListSizeGroup();\ncase ZmId.GROUPBY_PRIORITY:return new ZmMailListPriorityGroup();\ncase ZmId.GROUPBY_FROM:return new ZmMailListFromGroup();\ndefault:return null\n}};\nZmMailListGroup.getHeaderField=function(b,c){if(c==false){return ZmId.FLD_SORTED_BY\n}switch(b){case ZmId.GROUPBY_SIZE:return ZmId.FLD_SIZE;\ncase ZmId.GROUPBY_FROM:return ZmId.FLD_FROM;\ncase ZmId.GROUPBY_DATE:return ZmId.FLD_DATE;\ndefault:return null\n}};\nZmMailListGroup.getGroupIdFromSortField=function(b,c){switch(b){case ZmId.FLD_FROM:if(c===ZmItem.CONV){return ZmId.GROUPBY_NONE\n}return ZmId.GROUPBY_FROM;\ncase ZmId.FLD_SIZE:return ZmId.GROUPBY_SIZE;\ncase ZmId.FLD_DATE:return ZmId.GROUPBY_DATE;\ndefault:return ZmId.GROUPBY_NONE\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmMailListDateGroup\")){ZmMailListDateGroup=function(){this.id=ZmId.GROUPBY_DATE;\nthis.field=ZmItem.F_DATE;\nthis._weekStartDay=appCtxt.get(ZmSetting.CAL_FIRST_DAY_OF_WEEK)||0;\nvar b=this._getToday().getDay();\nthis._keys=this._sortKeys(b,false);\nZmMailListGroup.call(this)\n};\nZmMailListDateGroup.prototype=new ZmMailListGroup;\nZmMailListDateGroup.prototype.constructor=ZmMailListDateGroup;\nZmMailListDateGroup.MONDAY=\"MONDAY\";\nZmMailListDateGroup.TUESDAY=\"TUESDAY\";\nZmMailListDateGroup.WEDNESDAY=\"WEDNESDAY\";\nZmMailListDateGroup.THURSDAY=\"THURSDAY\";\nZmMailListDateGroup.FRIDAY=\"FRIDAY\";\nZmMailListDateGroup.SATURDAY=\"SATURDAY\";\nZmMailListDateGroup.SUNDAY=\"SUNDAY\";\nZmMailListDateGroup.TODAY=\"TODAY\";\nZmMailListDateGroup.YESTERDAY=\"YESTERDAY\";\nZmMailListDateGroup.LAST_WEEK=\"LAST_WEEK\";\nZmMailListDateGroup.TWO_WEEKS_AGO=\"TWO_WEEKS_AGO\";\nZmMailListDateGroup.THREE_WEEKS_AGO=\"THREE_WEEKS_AGO\";\nZmMailListDateGroup.EARLIER_THIS_MONTH=\"EARLIER_THIS_MONTH\";\nZmMailListDateGroup.LAST_MONTH=\"LAST_MONTH\";\nZmMailListDateGroup.OLDER=\"OLDER\";\nZmMailListDateGroup.GROUP=[ZmMailListDateGroup.TODAY,ZmMailListDateGroup.YESTERDAY,ZmMailListDateGroup.SUNDAY,ZmMailListDateGroup.MONDAY,ZmMailListDateGroup.TUESDAY,ZmMailListDateGroup.WEDNESDAY,ZmMailListDateGroup.THURSDAY,ZmMailListDateGroup.FRIDAY,ZmMailListDateGroup.SATURDAY,ZmMailListDateGroup.LAST_WEEK,ZmMailListDateGroup.TWO_WEEKS_AGO,ZmMailListDateGroup.THREE_WEEKS_AGO,ZmMailListDateGroup.EARLIER_THIS_MONTH,ZmMailListDateGroup.LAST_MONTH,ZmMailListDateGroup.OLDER];\nZmMailListDateGroup.WEEKDAYS=[ZmMailListDateGroup.SUNDAY,ZmMailListDateGroup.MONDAY,ZmMailListDateGroup.TUESDAY,ZmMailListDateGroup.WEDNESDAY,ZmMailListDateGroup.THURSDAY,ZmMailListDateGroup.FRIDAY,ZmMailListDateGroup.SATURDAY];\nZmMailListDateGroup.SECTION_TITLE={};\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.TODAY]=ZmMsg.today;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.YESTERDAY]=ZmMsg.yesterday;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.MONDAY]=I18nMsg.weekdayMonLong;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.TUESDAY]=I18nMsg.weekdayTueLong;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.WEDNESDAY]=I18nMsg.weekdayWedLong;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.THURSDAY]=I18nMsg.weekdayThuLong;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.FRIDAY]=I18nMsg.weekdayFriLong;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.SATURDAY]=I18nMsg.weekdaySatLong;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.SUNDAY]=I18nMsg.weekdaySunLong;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.LAST_WEEK]=ZmMsg.lastWeek;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.TWO_WEEKS_AGO]=ZmMsg.twoWeeksAgo;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.THREE_WEEKS_AGO]=ZmMsg.threeWeeksAgo;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.EARLIER_THIS_MONTH]=ZmMsg.earlierThisMonth;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.LAST_MONTH]=ZmMsg.lastMonth;\nZmMailListDateGroup.SECTION_TITLE[ZmMailListDateGroup.OLDER]=ZmMsg.older;\nZmMailListDateGroup.TIME={};\nZmMailListDateGroup.TIME.YESTERDAY=AjxDateUtil.MSEC_PER_DAY;\nZmMailListDateGroup.TIME.LAST_WEEK=AjxDateUtil.MSEC_PER_DAY*7;\nZmMailListDateGroup.TIME.TWO_WEEKS_AGO=AjxDateUtil.MSEC_PER_DAY*14;\nZmMailListDateGroup.TIME.THREE_WEEKS_AGO=AjxDateUtil.MSEC_PER_DAY*21;\nZmMailListDateGroup.prototype.getAllSections=function(e){var b=[];\nvar c=this._getToday().getDay();\nvar f=e?this._sortKeys(c,e):this._keys;\nfor(var d=0;\nd<f.length;\nd++){if(this._section[f[d]].length>0){b.push(this.getSectionHeader(ZmMailListDateGroup.SECTION_TITLE[f[d]]));\nb.push(this._section[f[d]].join(\"\"))\n}else{if(this._showEmptySectionHeader){b.push(this.getSectionHeader(ZmMailListDateGroup.SECTION_TITLE[f[d]]))\n}}}return b.join(\"\")\n};\nZmMailListDateGroup.prototype.addMsgToSection=function(d,c){for(var b=0;\nb<this._keys.length;\nb++){if(this.isMsgInSection(this._keys[b],d)){this._section[this._keys[b]].push(c);\nreturn this._keys[b]\n}}};\nZmMailListDateGroup.prototype.isMsgInSection=function(b,c){switch(b){case ZmMailListDateGroup.TODAY:return this._isToday(c);\ncase ZmMailListDateGroup.YESTERDAY:return this._isYesterday(c);\ncase ZmMailListDateGroup.MONDAY:return this._isDayOfWeek(c,AjxDateUtil.MONDAY);\ncase ZmMailListDateGroup.TUESDAY:return this._isDayOfWeek(c,AjxDateUtil.TUESDAY);\ncase ZmMailListDateGroup.WEDNESDAY:return this._isDayOfWeek(c,AjxDateUtil.WEDNESDAY);\ncase ZmMailListDateGroup.THURSDAY:return this._isDayOfWeek(c,AjxDateUtil.THURSDAY);\ncase ZmMailListDateGroup.FRIDAY:return this._isDayOfWeek(c,AjxDateUtil.FRIDAY);\ncase ZmMailListDateGroup.SATURDAY:return this._isDayOfWeek(c,AjxDateUtil.SATURDAY);\ncase ZmMailListDateGroup.SUNDAY:return this._isDayOfWeek(c,AjxDateUtil.SUNDAY);\ncase ZmMailListDateGroup.LAST_WEEK:return this._isWeeksAgo(c,ZmMailListDateGroup.LAST_WEEK,ZmMailListDateGroup.YESTERDAY);\ncase ZmMailListDateGroup.TWO_WEEKS_AGO:return this._isWeeksAgo(c,ZmMailListDateGroup.TWO_WEEKS_AGO,ZmMailListDateGroup.LAST_WEEK);\ncase ZmMailListDateGroup.THREE_WEEKS_AGO:return this._isWeeksAgo(c,ZmMailListDateGroup.THREE_WEEKS_AGO,ZmMailListDateGroup.TWO_WEEKS_AGO);\ncase ZmMailListDateGroup.EARLIER_THIS_MONTH:return this._isEarlierThisMonth(c);\ncase ZmMailListDateGroup.LAST_MONTH:return this._isLastMonth(c);\ncase ZmMailListDateGroup.OLDER:return this._isOlder(c);\ndefault:return false\n}};\nZmMailListDateGroup.prototype.getSortBy=function(b){if(b){return ZmSearch.DATE_ASC\n}return ZmSearch.DATE_DESC\n};\nZmMailListDateGroup.prototype._init=function(){this._section={};\nthis._section[ZmMailListDateGroup.TODAY]=[];\nthis._section[ZmMailListDateGroup.YESTERDAY]=[];\nthis._section[ZmMailListDateGroup.SUNDAY]=[];\nthis._section[ZmMailListDateGroup.MONDAY]=[];\nthis._section[ZmMailListDateGroup.TUESDAY]=[];\nthis._section[ZmMailListDateGroup.WEDNESDAY]=[];\nthis._section[ZmMailListDateGroup.THURSDAY]=[];\nthis._section[ZmMailListDateGroup.FRIDAY]=[];\nthis._section[ZmMailListDateGroup.SATURDAY]=[];\nthis._section[ZmMailListDateGroup.LAST_WEEK]=[];\nthis._section[ZmMailListDateGroup.TWO_WEEKS_AGO]=[];\nthis._section[ZmMailListDateGroup.THREE_WEEKS_AGO]=[];\nthis._section[ZmMailListDateGroup.EARLIER_THIS_MONTH]=[];\nthis._section[ZmMailListDateGroup.LAST_MONTH]=[];\nthis._section[ZmMailListDateGroup.OLDER]=[]\n};\nZmMailListDateGroup.prototype._isToday=function(e){if(e){var b=this._getToday();\nvar c=this._getDateFromMsg(e,true);\nif(c){return b.getTime()==c.getTime()\n}}return false\n};\nZmMailListDateGroup.prototype._isYesterday=function(i){if(i){var h=this._getDateFromMsg(i,true);\nvar b=new Date();\nvar g=b.getTimezoneOffset();\nvar f=new Date();\nf.setTime(b.getTime()-AjxDateUtil.MSEC_PER_DAY);\nvar e=f.getTimezoneOffset();\nvar c=g-e;\nf.setTime(f.getTime()-(c*60000));\nf.setHours(0,0,0,0);\nif(h){return f.getTime()==h.getTime()\n}}return false\n};\nZmMailListDateGroup.prototype._isDayOfWeek=function(h,e){if(h){var c=this._getToday();\nvar b=AjxDateUtil.getWeekNumber(c);\nvar f=c.getYear();\nvar g=this._getDateFromMsg(h,true);\nif(g){return g.getDay()==e&&AjxDateUtil.getWeekNumber(g)==b&&!this._isYesterday(h)&&!this._isToday(h)&&f==g.getYear()\n}}return false\n};\nZmMailListDateGroup.prototype._isWeeksAgo=function(i,f,h){if(i){var c=this._getToday();\nvar b=c.getTime()-ZmMailListDateGroup.TIME[h];\nvar e=c.getTime()-ZmMailListDateGroup.TIME[f];\nvar g=this._getDateFromMsg(i,true);\nif(g){return g.getTime()>=e&&g.getTime()<b\n}}return false\n};\nZmMailListDateGroup.prototype._isEarlierThisMonth=function(h){if(h){var c=this._getToday();\nvar f=c.getTime()-ZmMailListDateGroup.TIME[ZmMailListDateGroup.THREE_WEEKS_AGO];\nvar b=c.getMonth();\nvar e=c.getYear();\nvar g=this._getDateFromMsg(h,true);\nif(g){return g.getTime()<f&&(g.getYear()==e&&g.getMonth()==b)\n}}return false\n};\nZmMailListDateGroup.prototype._isLastMonth=function(i){if(i){var c=this._getToday();\nvar g=c.getTime()-ZmMailListDateGroup.TIME[ZmMailListDateGroup.THREE_WEEKS_AGO];\nvar b=c.getMonth();\nvar e=c.getYear();\nvar f=this._calculateLastMonth(b);\nvar h=this._getDateFromMsg(i,true);\nif(h){if(h.getMonth()!=b){if(h.getYear()==e){return h.getMonth()==f&&h.getTime()<g\n}else{if(h.getYear()==(e-1)&&b==0&&f==11){return h.getTime()<g\n}}}}}return false\n};\nZmMailListDateGroup.prototype._isOlder=function(f){if(f){var b=this._getToday();\nvar c=b.getTime()-ZmMailListDateGroup.TIME[ZmMailListDateGroup.THREE_WEEKS_AGO];\nvar e=this._getDateFromMsg(f,true);\nif(e){return e.getTime()<c&&!this._isEarlierThisMonth(f)&&!this._isLastMonth(f)\n}}return false\n};\nZmMailListDateGroup.prototype._getDateFromMsg=function(e,b){if(e){var c=e.sentDate?new Date(e.sentDate):new Date(e.date);\nif(c&&b){c.setHours(0,0,0,0)\n}return c\n}return null\n};\nZmMailListDateGroup.prototype._sortKeys=function(b,c){var d=[];\nvar e=this._sortThisWeek(b);\ne=e.slice(2);\nd=[ZmMailListDateGroup.TODAY,ZmMailListDateGroup.YESTERDAY];\nd=d.concat(e);\nd=d.concat([ZmMailListDateGroup.LAST_WEEK,ZmMailListDateGroup.TWO_WEEKS_AGO,ZmMailListDateGroup.THREE_WEEKS_AGO,ZmMailListDateGroup.EARLIER_THIS_MONTH,ZmMailListDateGroup.LAST_MONTH,ZmMailListDateGroup.OLDER]);\nif(c){d.reverse()\n}return d\n};\nZmMailListDateGroup.prototype._calculateLastMonth=function(c){var b=c-1;\nif(b==-1){b=11\n}return b\n};\nZmMailListDateGroup.prototype._getToday=function(){var b=new Date();\nb.setHours(0,0,0,0);\nreturn b\n};\nZmMailListDateGroup.prototype._getSectionHeaderTitle=function(b){if(ZmMailListDateGroup.SECTION_TITLE[b]){return ZmMailListDateGroup.SECTION_TITLE[b]\n}return\"\"\n};\nZmMailListDateGroup.prototype._sortThisWeek=function(b){var e=[];\nvar d=0;\nvar c=false;\nwhile(d<7&&!c){if(b==this._weekStartDay){c=true\n}e[d]=ZmMailListDateGroup.WEEKDAYS[b];\nb--;\nif(b<0){b=6\n}d++\n}return e\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmMailListFromGroup\")){ZmMailListFromGroup=function(){this.id=ZmId.GROUPBY_FROM;\nthis.field=ZmItem.F_FROM;\nZmMailListGroup.call(this)\n};\nZmMailListFromGroup.prototype=new ZmMailListGroup;\nZmMailListFromGroup.prototype.constructor=ZmMailListFromGroup;\nZmMailListFromGroup.prototype.getAllSections=function(){var b=[];\nvar e=this._sectionList;\nfor(var c=0;\nc<e.length;\nc++){var d=e[c];\nb.push(this.getSectionHeader(d));\nb.push(this._section[d].join(\"\"))\n}return b.join(\"\")\n};\nZmMailListFromGroup.prototype.addMsgToSection=function(e,c){var d=e.getAddress(AjxEmailAddress.FROM);\nif(!d){return null\n}var b=d.getText();\nif(!this._section.hasOwnProperty(b)){this._section[b]=[];\nthis._sectionList.push(b)\n}this._section[b].push(c);\nreturn b\n};\nZmMailListFromGroup.prototype.getSortBy=function(b){return b?ZmSearch.NAME_ASC:ZmSearch.NAME_DESC\n};\nZmMailListFromGroup.prototype._init=function(){this._section={};\nthis._sectionList=[]\n};\nZmMailListFromGroup.prototype._getSectionHeaderTitle=function(b){return b\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmMailListPriorityGroup\")){ZmMailListPriorityGroup=function(b){this.id=ZmId.GROUPBY_PRIORITY;\nZmMailListGroup.call(this)\n};\nZmMailListPriorityGroup.prototype=new ZmMailListGroup;\nZmMailListPriorityGroup.prototype.constructor=ZmMailListPriorityGroup;\nZmMailListPriorityGroup.IMPORTANT_UNREAD=\"IMPORTANT_UNREAD\";\nZmMailListPriorityGroup.IMPORTANT_READ=\"IMPORTANT_READ\";\nZmMailListPriorityGroup.FLAGGED=\"FLAGGED\";\nZmMailListPriorityGroup.EVERYTHING_ELSE=\"EVERYTHING_ELSE\";\nZmMailListPriorityGroup.TAG=\"Important\";\nZmMailListPriorityGroup.GROUP=[ZmMailListPriorityGroup.IMPORTANT_UNREAD,ZmMailListPriorityGroup.FLAGGED,ZmMailListPriorityGroup.IMPORTANT_READ,ZmMailListPriorityGroup.EVERYTHING_ELSE];\nZmMailListPriorityGroup.SECTION_TITLE={};\nZmMailListPriorityGroup.SECTION_TITLE[ZmMailListPriorityGroup.IMPORTANT_READ]=ZmMsg.mailPriorityImportantRead;\nZmMailListPriorityGroup.SECTION_TITLE[ZmMailListPriorityGroup.IMPORTANT_UNREAD]=ZmMsg.mailPriorityImportantUnread;\nZmMailListPriorityGroup.SECTION_TITLE[ZmMailListPriorityGroup.FLAGGED]=ZmMsg.mailPriorityFlagged;\nZmMailListPriorityGroup.SECTION_TITLE[ZmMailListPriorityGroup.EVERYTHING_ELSE]=ZmMsg.mailPriorityEverythingElse;\nZmMailListPriorityGroup.prototype.getAllSections=function(){var b=[];\nfor(var c=0;\nc<ZmMailListPriorityGroup.GROUP.length;\nc++){if(this._section[ZmMailListPriorityGroup.GROUP[c]].length>0){b.push(this.getSectionHeader(ZmMailListPriorityGroup.SECTION_TITLE[ZmMailListPriorityGroup.GROUP[c]]));\nb.push(this._section[ZmMailListPriorityGroup.GROUP[c]].join(\"\"))\n}else{if(this._showEmptySectionHeader){b.push(this.getSectionHeader(ZmMailListPriorityGroup.SECTION_TITLE[ZmMailListPriorityGroup.GROUP[c]]))\n}}}return b.join(\"\")\n};\nZmMailListPriorityGroup.prototype.addMsgToSection=function(d,c){for(var b=0;\nb<ZmMailListPriorityGroup.GROUP.length;\nb++){if(this.isMsgInSection(ZmMailListPriorityGroup.GROUP[b],d)){this._section[ZmMailListPriorityGroup.GROUP[b]].push(c);\nreturn true\n}}return false\n};\nZmMailListPriorityGroup.prototype.isMsgInSection=function(b,c){switch(b){case ZmMailListPriorityGroup.IMPORTANT_UNREAD:return this._isImportantAndUnread(c);\ncase ZmMailListPriorityGroup.IMPORTANT_READ:return this._isImportantAndRead(c);\ncase ZmMailListPriorityGroup.FLAGGED:return this._isFlagged(c);\ncase ZmMailListPriorityGroup.EVERYTHING_ELSE:return this._noMatchingGroup(c);\ndefault:return false\n}};\nZmMailListPriorityGroup.prototype._init=function(){this._section={};\nthis._section[ZmMailListPriorityGroup.IMPORTANT_UNREAD]=[];\nthis._section[ZmMailListPriorityGroup.IMPORTANT_READ]=[];\nthis._section[ZmMailListPriorityGroup.FLAGGED]=[];\nthis._section[ZmMailListPriorityGroup.EVERYTHING_ELSE]=[];\nif(!this._importantTag){this._importantTag=this._getImportantTag()\n}};\nZmMailListPriorityGroup.prototype._isImportantAndUnread=function(b){if(b&&this._importantTag){if(b.hasTag(this._importantTag.id)&&b.isUnread){return true\n}}return false\n};\nZmMailListPriorityGroup.prototype._isImportantAndRead=function(b){if(b&&this._importantTag){if(b.hasTag(this._importantTag.id)&&!b.isUnread){return true\n}}return false\n};\nZmMailListPriorityGroup.prototype._isFlagged=function(b){if(b){return b.isFlagged\n}return false\n};\nZmMailListPriorityGroup.prototype._noMatchingGroup=function(b){if(!this._isImportantAndUnread(b)&&!this._isImportantAndRead(b)&&!this._isFlagged(b)){return true\n}return false\n};\nZmMailListPriorityGroup.prototype._getImportantTag=function(){var b=appCtxt.getTagTree();\nif(b){return b.getByName(\"Important\")\n}return null\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmMailListSizeGroup\")){ZmMailListSizeGroup=function(){this.id=ZmId.GROUPBY_SIZE;\nthis.field=ZmItem.F_SIZE;\nZmMailListGroup.call(this)\n};\nZmMailListSizeGroup.prototype=new ZmMailListGroup;\nZmMailListSizeGroup.prototype.constructor=ZmMailListSizeGroup;\nZmMailListSizeGroup.ENORMOUS=\"ENORMOUS\";\nZmMailListSizeGroup.HUGE=\"HUGE\";\nZmMailListSizeGroup.VERY_LARGE=\"VERY_LARGE\";\nZmMailListSizeGroup.LARGE=\"LARGE\";\nZmMailListSizeGroup.MEDIUM=\"MEDIUM\";\nZmMailListSizeGroup.SMALL=\"SMALL\";\nZmMailListSizeGroup.TINY=\"TINY\";\nZmMailListSizeGroup.KILOBYTE=1024;\nZmMailListSizeGroup.MEGABYTE=1024*1024;\nZmMailListSizeGroup.GROUP=[ZmMailListSizeGroup.ENORMOUS,ZmMailListSizeGroup.HUGE,ZmMailListSizeGroup.VERY_LARGE,ZmMailListSizeGroup.LARGE,ZmMailListSizeGroup.MEDIUM,ZmMailListSizeGroup.SMALL,ZmMailListSizeGroup.TINY];\nZmMailListSizeGroup.SIZE={};\nZmMailListSizeGroup.SIZE[ZmMailListSizeGroup.ENORMOUS]={min:5*ZmMailListSizeGroup.MEGABYTE-ZmMailListSizeGroup.MEGABYTE/2};\nZmMailListSizeGroup.SIZE[ZmMailListSizeGroup.HUGE]={min:(ZmMailListSizeGroup.MEGABYTE)-512,max:(5*ZmMailListSizeGroup.MEGABYTE)-ZmMailListSizeGroup.MEGABYTE/2};\nZmMailListSizeGroup.SIZE[ZmMailListSizeGroup.VERY_LARGE]={min:(500*ZmMailListSizeGroup.KILOBYTE)-512,max:ZmMailListSizeGroup.MEGABYTE-512};\nZmMailListSizeGroup.SIZE[ZmMailListSizeGroup.LARGE]={min:100*ZmMailListSizeGroup.KILOBYTE-512,max:(500*ZmMailListSizeGroup.KILOBYTE)-512};\nZmMailListSizeGroup.SIZE[ZmMailListSizeGroup.MEDIUM]={min:25*ZmMailListSizeGroup.KILOBYTE-512,max:(100*ZmMailListSizeGroup.KILOBYTE)-512};\nZmMailListSizeGroup.SIZE[ZmMailListSizeGroup.SMALL]={min:10*ZmMailListSizeGroup.KILOBYTE-512,max:(25*ZmMailListSizeGroup.KILOBYTE)-512};\nZmMailListSizeGroup.SIZE[ZmMailListSizeGroup.TINY]={max:(10*ZmMailListSizeGroup.KILOBYTE)-512};\nZmMailListSizeGroup.SECTION_TITLE={};\nZmMailListSizeGroup.SECTION_TITLE[ZmMailListSizeGroup.ENORMOUS]=ZmMsg.mailSizeEnormousTitle;\nZmMailListSizeGroup.SECTION_TITLE[ZmMailListSizeGroup.HUGE]=ZmMsg.mailSizeHugeTitle;\nZmMailListSizeGroup.SECTION_TITLE[ZmMailListSizeGroup.VERY_LARGE]=ZmMsg.mailSizeVeryLargeTitle;\nZmMailListSizeGroup.SECTION_TITLE[ZmMailListSizeGroup.LARGE]=ZmMsg.mailSizeLargeTitle;\nZmMailListSizeGroup.SECTION_TITLE[ZmMailListSizeGroup.MEDIUM]=ZmMsg.mailSizeMediumTitle;\nZmMailListSizeGroup.SECTION_TITLE[ZmMailListSizeGroup.SMALL]=ZmMsg.mailSizeSmallTitle;\nZmMailListSizeGroup.SECTION_TITLE[ZmMailListSizeGroup.TINY]=ZmMsg.mailSizeTinyTitle;\nZmMailListSizeGroup.prototype.getAllSections=function(d){var e=ZmMailListSizeGroup.GROUP.slice(0);\nvar b=[];\nif(d){e.reverse()\n}for(var c=0;\nc<e.length;\nc++){if(this._section[e[c]].length>0){b.push(this.getSectionHeader(ZmMailListSizeGroup.SECTION_TITLE[e[c]]));\nb.push(this._section[e[c]].join(\"\"))\n}else{if(this._showEmptySectionHeader){b.push(this.getSectionHeader(ZmMailListSizeGroup.SECTION_TITLE[e[c]]))\n}}}return b.join(\"\")\n};\nZmMailListSizeGroup.prototype.addMsgToSection=function(d,c){for(var b=0;\nb<ZmMailListSizeGroup.GROUP.length;\nb++){if(this.isMsgInSection(ZmMailListSizeGroup.GROUP[b],d)){this._section[ZmMailListSizeGroup.GROUP[b]].push(c);\nreturn ZmMailListSizeGroup.GROUP[b]\n}}return null\n};\nZmMailListSizeGroup.prototype.isMsgInSection=function(c,d){var b=d.size;\nif(!b&&d.type==ZmId.ITEM_CONV){b=d.sf\n}switch(c){case ZmMailListSizeGroup.ENORMOUS:return this._isInSizeRange(b,c);\ncase ZmMailListSizeGroup.HUGE:return this._isInSizeRange(b,c);\ncase ZmMailListSizeGroup.VERY_LARGE:return this._isInSizeRange(b,c);\ncase ZmMailListSizeGroup.LARGE:return this._isInSizeRange(b,c);\ncase ZmMailListSizeGroup.MEDIUM:return this._isInSizeRange(b,c);\ncase ZmMailListSizeGroup.SMALL:return this._isInSizeRange(b,c);\ncase ZmMailListSizeGroup.TINY:return this._isInSizeRange(b,c);\ndefault:return false\n}};\nZmMailListSizeGroup.prototype.getSortBy=function(b){if(b){return ZmSearch.SIZE_ASC\n}return ZmSearch.SIZE_DESC\n};\nZmMailListSizeGroup.prototype._init=function(){this._section={};\nthis._section[ZmMailListSizeGroup.ENORMOUS]=[];\nthis._section[ZmMailListSizeGroup.HUGE]=[];\nthis._section[ZmMailListSizeGroup.VERY_LARGE]=[];\nthis._section[ZmMailListSizeGroup.LARGE]=[];\nthis._section[ZmMailListSizeGroup.MEDIUM]=[];\nthis._section[ZmMailListSizeGroup.SMALL]=[];\nthis._section[ZmMailListSizeGroup.TINY]=[]\n};\nZmMailListSizeGroup.prototype._isInSizeRange=function(d,e){if(d>=0&&e){var c=ZmMailListSizeGroup.SIZE[e].min;\nvar b=ZmMailListSizeGroup.SIZE[e].max;\nif(c&&b){return d>=ZmMailListSizeGroup.SIZE[e].min&&d<ZmMailListSizeGroup.SIZE[e].max\n}else{if(b){return d<ZmMailListSizeGroup.SIZE[e].max\n}else{if(c){return d>=ZmMailListSizeGroup.SIZE[e].min\n}}}}return false\n};\nZmMailListSizeGroup.prototype._getSectionHeaderTitle=function(b){if(ZmMailListSizeGroup.SECTION_TITLE[b]){return ZmMailListSizeGroup.SECTION_TITLE[b]\n}return\"\"\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmPopAccount\")){ZmPopAccount=function(b){ZmDataSource.call(this,ZmAccount.TYPE_POP,b)\n};\nZmPopAccount.prototype=new ZmDataSource;\nZmPopAccount.prototype.constructor=ZmPopAccount;\nZmPopAccount.PORT_CLEAR=110;\nZmPopAccount.PORT_SSL=995;\nZmPopAccount.PORT_DEFAULT=ZmPopAccount.PORT_CLEAR;\nZmPopAccount.prototype.ELEMENT_NAME=\"pop3\";\nZmPopAccount.prototype.port=ZmPopAccount.PORT_DEFAULT;\nZmPopAccount.prototype.toString=function(){return\"ZmPopAccount\"\n};\nZmPopAccount.prototype.getDefaultPort=function(){return(this.connectionType==ZmDataSource.CONNECT_SSL)?ZmPopAccount.PORT_SSL:ZmPopAccount.PORT_DEFAULT\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmImapAccount\")){ZmImapAccount=function(b){ZmDataSource.call(this,ZmAccount.TYPE_IMAP,b)\n};\nZmImapAccount.prototype=new ZmDataSource;\nZmImapAccount.prototype.constructor=ZmImapAccount;\nZmImapAccount.PORT_CLEAR=143;\nZmImapAccount.PORT_SSL=993;\nZmImapAccount.PORT_DEFAULT=ZmImapAccount.PORT_CLEAR;\nZmImapAccount.prototype.ELEMENT_NAME=\"imap\";\nZmImapAccount.prototype.port=ZmImapAccount.PORT_DEFAULT;\nZmImapAccount.prototype.toString=function(){return\"ZmImapAccount\"\n};\nZmImapAccount.prototype.getDefaultPort=function(){return(this.connectionType==ZmDataSource.CONNECT_SSL)?ZmImapAccount.PORT_SSL:ZmImapAccount.PORT_DEFAULT\n};\nZmImapAccount.sortCompare=function(f,e){var b=ZmOrganizer.checkSortArgs(f,e);\nif(b!=null){return b\n}var d=ZmFolder.getIdForName(f.name);\nvar c=ZmFolder.getIdForName(e.name);\nif(ZmFolder.SORT_ORDER[d]&&ZmFolder.SORT_ORDER[c]){return(ZmFolder.SORT_ORDER[d]-ZmFolder.SORT_ORDER[c])\n}if(!ZmFolder.SORT_ORDER[d]&&ZmFolder.SORT_ORDER[c]){return 1\n}if(ZmFolder.SORT_ORDER[d]&&!ZmFolder.SORT_ORDER[c]){return -1\n}if(f.name.toLowerCase()>e.name.toLowerCase()){return 1\n}if(f.name.toLowerCase()<e.name.toLowerCase()){return -1\n}return 0\n}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmSignature\")){ZmSignature=function(b){this.id=b\n};\nZmSignature.prototype.toString=function(){return\"ZmSignature\"\n};\nZmSignature.prototype.name=\"\";\nZmSignature.prototype.contentType=ZmMimeTable.TEXT_PLAIN;\nZmSignature.prototype.value=\"\";\nZmSignature.createFromJson=function(c){var b=new ZmSignature(c.id);\nb.setFromJson(c);\nreturn b\n};\nZmSignature.prototype.create=function(f,c,b){var e=f?new AjxCallback(this,this._handleCreateResponse,[f]):null;\nvar d=this._sendRequest(\"CreateSignatureRequest\",false,e,c,b);\nif(!f&&!b){this._handleCreateResponse(f,d)\n}};\nZmSignature.prototype.save=function(f,c,b){var e=f?new AjxCallback(this,this._handleModifyResponse,[f]):null;\nvar d=this._sendRequest(\"ModifySignatureRequest\",false,e,c,b);\nif(!f&&!b){this._handleModifyResponse(f,d)\n}};\nZmSignature.prototype.doDelete=function(f,c,b){var e=f?new AjxCallback(this,this._handleDeleteResponse,[f]):null;\nvar d=this._sendRequest(\"DeleteSignatureRequest\",true,e,c,b);\nif(!f&&!b){this._handleDeleteResponse(f,d)\n}};\nZmSignature.prototype.setFromJson=function(b){this.name=b.name||this.name;\nvar e=b.content;\nif(e){var d=e[0]._content?e[0]:e[1];\nthis.contentType=d.type||this.contentType;\nthis.value=d._content||this.value\n}if(b.cid){this.contactId=b.cid[0]._content\n}};\nZmSignature.prototype.getContentType=function(){return this.contentType\n};\nZmSignature.prototype.setContentType=function(b){this.contentType=b||ZmMimeTable.TEXT_PLAIN\n};\nZmSignature.prototype.getValue=function(e){var c=this.contentType==ZmMimeTable.TEXT_HTML;\nvar d=this.value;\nvar b=e||this.contentType;\nif(b!=this.contentType){d=c?AjxStringUtil.convertHtml2Text(d):AjxStringUtil.convertToHtml(d)\n}if(appCtxt.isWebClientOffline()){d=ZmOffline.modifySignature(d)\n}return d\n};\nZmSignature.prototype._sendRequest=function(c,l,k,h,e){var i=AjxSoapDoc.create(c,\"urn:zimbraAccount\");\nvar g=i.set(\"signature\");\nif(this.id){g.setAttribute(\"id\",this.id)\n}if(!l){g.setAttribute(\"name\",this.name);\nif(this.contactId||(c==\"ModifySignatureRequest\")){i.set(\"cid\",this.contactId||null,g)\n}var d=i.set(\"content\",this.value,g);\nd.setAttribute(\"type\",this.contentType);\nvar b=(this.contentType==ZmMimeTable.TEXT_HTML)?ZmMimeTable.TEXT_PLAIN:ZmMimeTable.TEXT_HTML;\nd=i.set(\"content\",\"\",g);\nd.setAttribute(\"type\",b)\n}if(e){e.addNewRequestParams(i,k,h);\nreturn\n}var j=appCtxt.getAppController();\nvar f={soapDoc:i,asyncMode:Boolean(k),callback:k,errorCallback:h};\nreturn j.sendRequest(f)\n};\nZmSignature.prototype._handleCreateResponse=function(d,c){this.id=c._data.CreateSignatureResponse.signature[0].id;\nvar b=appCtxt.getSignatureCollection();\nb.add(this);\nif(d){d.run()\n}};\nZmSignature.prototype._handleModifyResponse=function(e,d){var c=appCtxt.getSignatureCollection();\nvar b=c.getById(this.id);\nb.name=this.name;\nb.value=this.value;\nb.contentType=this.contentType;\nc._notify(ZmEvent.E_MODIFY,{item:b});\nif(e){e.run()\n}};\nZmSignature.prototype._handleDeleteResponse=function(d,c){var b=appCtxt.getSignatureCollection();\nb.remove(this);\nif(d){d.run()\n}}\n}if(AjxPackage.define(\"zimbraMail.mail.model.ZmSignatureCollection\")){ZmSignatureCollection=function(){ZmModel.call(this,ZmEvent.S_SIGNATURE);\nthis._idMap={};\nthis._nameMap={};\nthis._size=0\n};\nZmSignatureCollection.prototype=new ZmModel;\nZmSignatureCollection.prototype.constructor=ZmSignatureCollection;\nZmSignatureCollection.prototype.toString=function(){return\"ZmSignatureCollection\"\n};\nZmSignatureCollection.prototype.add=function(b){if(!this._idMap[b.id]){this._idMap[b.id]=b;\nthis._nameMap[b.name]=b;\nthis._size++;\nthis._notify(ZmEvent.E_CREATE,{item:b})\n}};\nZmSignatureCollection.prototype.remove=function(b){if(this._idMap[b.id]){delete this._idMap[b.id];\ndelete this._nameMap[b.name];\nthis._size--;\nthis._notify(ZmEvent.E_DELETE,{item:b})\n}};\nZmSignatureCollection.prototype.getSize=function(){return this._size\n};\nZmSignatureCollection.prototype.getSignatures=function(b){var c=AjxUtil.values(this._idMap);\nif(b){c.sort(ZmSignatureCollection.BY_NAME)\n}return c\n};\nZmSignatureCollection.prototype.getSignatureOptions=function(){var e=[];\nfor(var g in this._idMap){e.push(this._idMap[g])\n}e.sort(ZmSignatureCollection.BY_NAME);\nvar c=[];\nvar f=appCtxt.isWebClientOffline();\nfor(var d=0;\nd<e.length;\nd++){var b=e[d];\nif(f&&b.contactId){continue\n}c.push(new DwtSelectOptionData(b.id,b.name))\n}c.push(new DwtSelectOptionData(\"\",ZmMsg.signatureDoNotAttach));\nreturn c\n};\nZmSignatureCollection.prototype.getById=function(b){return this._idMap[b]\n};\nZmSignatureCollection.prototype.getByName=function(c){var b=c.toLowerCase();\nfor(var d in this._nameMap){if(d.toLowerCase()==b){return this._nameMap[d]\n}}};\nZmSignatureCollection.prototype.initialize=function(d){if(this._size){return\n}var e=d.signature;\nif(!e){return\n}for(var c=0;\nc<e.length;\nc++){var b=ZmSignature.createFromJson(e[c]);\nthis.add(b)\n}};\nZmSignatureCollection.BY_NAME=function(d,c){return d.name.localeCompare(c.name)\n}\n}}if(AjxPackage.define(\"mail.Message\")){AjxTemplate.register(\"mail.Message#MessageHeader\",function(d,j,h,b){var g=Boolean(b);\nh=(typeof h==\"string\"?{id:h}:h)||{};\nb=b||[];\nvar f=b.length;\nb[f++]=\"<div><!-- empty container DIV here so Dwt.parseHtmlFragment returns the infoBar div below --><table class='MsgHeaderTable' id='\";\nb[f++]=h.id;\nb[f++]=\"_headerElement' width=100%><tr><td class='MsgHeaderContactContainer'><img class='MsgHeaderContactImage' src=\\\"\";\nb[f++]=h.imageURL;\nb[f++]='\" alt=\"';\nb[f++]=h.imageAltText;\nb[f++]='\" onerror=\"this.style.visibility=\\'hidden\\'\"/></td><td><div><table role=\"presentation\" width=100%><tr id=\\'';\nb[f++]=h.hdrTableTopRowId;\nb[f++]=\"'>\";\nif(h.isSyncFailureMsg){b[f++]=\"<td>&nbsp;</td><td id='\";\nb[f++]=h.reportBtnCellId;\nb[f++]=\"'></td><td>&nbsp;</td>\"\n}b[f++]=\"<td>&nbsp;</td>\";\nif(h.priorityImg){b[f++]=\"<td><div priority='\";\nb[f++]=h.priority;\nb[f++]=\"' id='\";\nb[f++]=h.priorityDivId;\nb[f++]=\"' style='margin-left:4px;' class='\";\nb[f++]=h.priorityImg;\nb[f++]=\"'></div></td>\"\n}b[f++]=\"<td class='LabelColValue SubjectCol' valign=top width=100%>\";\nb[f++]=h.subject;\nb[f++]=\"</td><td class='LabelColValue DateCol' align=right title='\";\nb[f++]=h.dateTooltip;\nb[f++]=\"'>\";\nb[f++]=h.dateString;\nb[f++]=\"</td><td>&nbsp;</td></tr></table><table id='\";\nb[f++]=h.hdrTableId;\nb[f++]=\"' class='ZPropertySheet' cellspacing='6' style='margin:0 7px;'><tr id='\";\nb[f++]=h.expandRowId;\nb[f++]=\"'><td><table role=\\\"presentation\\\" align=right><tr><td class='LabelColName' style='padding-left:7px;'>\";\nb[f++]=ZmMsg.fromLabel;\nb[f++]='</td></tr></table></td><td valign=top colspan=10><table role=\"presentation\"><tr id=\"OBJ_PREFIX_';\nb[f++]=Dwt.getNextId();\nb[f++]='_from\"><td id=\"OBJ_PREFIX_';\nb[f++]=Dwt.getNextId();\nb[f++]=\"_from\\\" class='LabelColValue' style='white-space:nowrap'>\";\nb[f++]=AjxTemplate.expand(\"#SentBy\",h);\nb[f++]=\"</td></tr></table></td></tr>\";\nfor(var e=0;\ne<h.addressTypes.length;\ne++){var c=h.participants[h.addressTypes[e]];\nb[f++]=\"<tr id='OBJ_PREFIX_\";\nb[f++]=Dwt.getNextId();\nb[f++]=\"_\";\nb[f++]=c.prefix.toLowerCase();\nb[f++]=\"'><td class='LabelColName'>\";\nb[f++]=c.prefix?AjxMessageFormat.format(ZmMsg.makeLabel,c.prefix):\"&nbsp;\";\nb[f++]=\"</td><td class='LabelColValue' colspan='10'>\";\nb[f++]=c.partStr;\nb[f++]=\"</td></tr>\"\n}b[f++]=AjxTemplate.expand(\"#AutoSend\",h);\nb[f++]=AjxTemplate.expand(\"#AddedHeaders\",h);\nb[f++]=\"</table>\";\nif(h.hasAttachments){b[f++]='<div class=\"MessageHeaderAttachments\" id=\"';\nb[f++]=h.attachId;\nb[f++]='_container\"><div id=\"';\nb[f++]=h.attachId;\nb[f++]=\"\\\" style='overflow:auto;'></div></div>\"\n}b[f++]=\"</div>\";\nif(h.isOutDated){b[f++]=AjxTemplate.expand(\"#InviteNotCurrent\",h)\n}b[f++]=\"</td><td id='\";\nb[f++]=h.id;\nb[f++]=\"_contactArea' class='ContactArea'><!-- Area reserved zimlets to add to message views. --></td></tr></table><div id='\";\nb[f++]=h.infoBarId;\nb[f++]=\"'></div></div>\";\nreturn g?b.length:b.join(\"\")\n},{id:\"mail.Message#MessageHeader\"},false);\nAjxTemplate.register(\"mail.Message\",AjxTemplate.getTemplate(\"mail.Message#MessageHeader\"),AjxTemplate.getParams(\"mail.Message#MessageHeader\"));\nAjxTemplate.register(\"mail.Message#SentBy\",function(d,i,h,b){var g=Boolean(b);\nh=(typeof h==\"string\"?{id:h}:h)||{};\nb=b||[];\nvar f=b.length;\nb[f++]=\"<span>\";\nb[f++]=h.sentBy;\nb[f++]=\"</span>\";\nvar e=h.obo&&(h.oboAddr!=h.sentByAddr);\nvar c=h.bwo&&(h.bwoAddr!=h.sentByAddr);\nif(e){b[f++]=\"<span style='margin:0 .5em;'>\";\nb[f++]=ZmMsg.onBehalfOfMidLabel;\nb[f++]='</span><span id=\"';\nb[f++]=h.oboId;\nb[f++]='\">';\nb[f++]=h.obo;\nb[f++]=\"</span>\"\n}if(c){b[f++]=\"<span style='margin:0 .5em;'>\";\nb[f++]=ZmMsg.byWayOfMidLabel;\nb[f++]='</span><span id=\"';\nb[f++]=h.bwoId;\nb[f++]='\">';\nb[f++]=h.bwo;\nb[f++]=\"</span>\"\n}return g?b.length:b.join(\"\")\n},{id:\"mail.Message#SentBy\"},false);\nAjxTemplate.register(\"mail.Message#InviteNotCurrent\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<div class=\\\"InviteOutDated\\\"><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td>\";\nb[d++]=AjxImg.getImageHtml(\"Warning\");\nb[d++]=\"</td><td>\";\nb[d++]=ZmMsg.inviteNotCurrent;\nb[d++]=\"</td></tr></table></div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#InviteNotCurrent\"},false);\nAjxTemplate.register(\"mail.Message#MailAttachmentBubble\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<span id=\"';\nb[d++]=f.id;\nb[d++]='\" class=\"AttachmentLoading attachmentBubble AttachmentSpan\" name=\"mailAttUploadingSpan\" style=\"max-width:235px; position:static; overflow:visible;padding:0 2px 4px\"><span class=\"AttProgressSpan1\">';\nb[d++]=f.fileName;\nb[d++]='</span><span class=\"AttProgressSpan2\">';\nb[d++]=f.fileName;\nb[d++]='</span><span onclick=\"window.appCtxt.getCurrentView()._abortUploadFile()\" class=\"ImgBubbleDelete AttachmentClose\"></span></span>';\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#MailAttachmentBubble\"},false);\nAjxTemplate.register(\"mail.Message#AutoSend\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nif(f.autoSendTime){b[d++]=\"<tr id='OBJ_PREFIX_\";\nb[d++]=Dwt.getNextId();\nb[d++]=\"_scheduled'><td valign='top' class='LabelColName'>\";\nb[d++]=ZmMsg.messageScheduledSendLabel;\nb[d++]=\"</td><td class='LabelColValue' colspan=10>\";\nb[d++]=f.autoSendTime;\nb[d++]=\"</td></tr>\"\n}return e?b.length:b.join(\"\")\n},{id:\"mail.Message#AutoSend\"},false);\nAjxTemplate.register(\"mail.Message#AddedHeaders\",function(c,h,g,b){var f=Boolean(b);\ng=(typeof g==\"string\"?{id:g}:g)||{};\nb=b||[];\nvar e=b.length;\nfor(var d=0;\nd<g.additionalHdrs.length;\nd++){b[e++]=\"<tr><td valign='top' class='LabelColName'>\";\nb[e++]=g.additionalHdrs[d].hdrName;\nb[e++]=\"</td><td class='LabelColValue' colspan='10'>\";\nb[e++]=g.additionalHdrs[d].hdrVal;\nb[e++]=\"</td></tr>\"\n}return f?b.length:b.join(\"\")\n},{id:\"mail.Message#AddedHeaders\"},false);\nAjxTemplate.register(\"mail.Message#InviteHeader\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<div><!-- empty container DIV here so Dwt.parseHtmlFragment returns the infoBar div below --><table class='InvHeaderTable' id='\";\nb[d++]=f.id;\nb[d++]=\"_headerElement'><tr>\";\nif(!f.noTopHeader){b[d++]=\"<td class='InvHeaderContactContainer'><img class='InvHeaderContactImage' src=\\\"\";\nb[d++]=f.imageURL;\nb[d++]='\" onerror=\"this.style.visibility=\\'hidden\\'\"/></td>'\n}b[d++]=\"<td><div class='InvHeaderDiv'>\";\nif(!f.noTopHeader){b[d++]=\"<table role=\\\"presentation\\\" width=100% class='ZPropertySheet' cellspacing='6'><tr id='\";\nb[d++]=f.hdrTableTopRowId;\nb[d++]=\"'>\";\nif(f.closeBtnCellId){b[d++]=\"<td id='\";\nb[d++]=f.closeBtnCellId;\nb[d++]=\"'></td>\"\n}b[d++]=\"<td class='LabelColValue SubjectCol \";\nb[d++]=f.subjChangeClass;\nb[d++]=\"' valign=top width=100%>\";\nb[d++]=f.subject;\nb[d++]=\"</td><td class='LabelColValue DateCol' align=right title='\";\nb[d++]=f.dateTooltip;\nb[d++]=\"'>\";\nb[d++]=f.dateString;\nb[d++]=\"</td></tr></table>\"\n}b[d++]='<table role=\"presentation\" id=\\'';\nb[d++]=f.hdrTableId;\nb[d++]=\"' width=100% class='ZPropertySheet' cellspacing='6'>\";\nif(f.counterInvMsg){b[d++]=\"<tr><td class='LabelColValue' colspan=2><div class='InvCounter'><table role=\\\"presentation\\\" width='100%' class='ZPropertySheet' cellspacing='6'><tr><td width=20>\";\nb[d++]=AjxImg.getImageHtml(\"Information\");\nb[d++]=\"</td><td class='LabelColValue'>\";\nb[d++]=f.counterInvMsg;\nb[d++]=\"</td><td id='\";\nb[d++]=f.hdrTableId;\nb[d++]='_counterToolbar\\' width=\"1\"></td></tr></table></div></td></tr>'\n}b[d++]=\"<tr><td class='LabelColName \";\nb[d++]=f.timeChangeClass;\nb[d++]=\"'>\";\nb[d++]=f.counterInvMsg?ZmMsg.proposedTimeLabel:ZmMsg.timeLabel;\nb[d++]=\"</td><td class='LabelColValue \";\nb[d++]=f.timeChangeClass;\nb[d++]=\"'>\";\nb[d++]=f.invDate;\nb[d++]=\"<br>\";\nb[d++]=f.timezone;\nb[d++]=\"</td></tr>\";\nif(f.invite.getLocation()){b[d++]=\"<tr><td class='LabelColName \";\nb[d++]=f.locChangeClass;\nb[d++]=\"'>\";\nb[d++]=ZmMsg.locationLabel;\nb[d++]=\"</td><td class='LabelColValue \";\nb[d++]=f.locChangeClass;\nb[d++]=\"'>\";\nb[d++]=AjxStringUtil.htmlEncode(f.invite.getLocation());\nb[d++]=\"</td></tr>\"\n}b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.organizerLabel;\nb[d++]=\"</td><td class='LabelColValue'>\";\nb[d++]=f.invOrganizer;\nb[d++]=\"</td></tr>\";\nif(f.invSentBy){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.sentByLabel;\nb[d++]=\"</td><td class='LabelColValue'>\";\nb[d++]=f.invSentBy;\nb[d++]=\"</td></tr>\"\n}if(f.obo&&(AjxStringUtil.stripTags(f.obo)!=AjxStringUtil.stripTags(f.invSentBy))){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.onBehalfOfLabel;\nb[d++]=\" </td><td class='LabelColValue'>\";\nb[d++]=f.obo;\nb[d++]=\"</td></tr>\"\n}if(f.bwo){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.byWayOfLabel;\nb[d++]=\"</td><td class='LabelColValue'>\";\nb[d++]=f.bwo;\nb[d++]=\"</td></tr>\"\n}if(f.ptstId){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.inviteesLabel;\nb[d++]=\"</td><td class='LabelColValue' id='\";\nb[d++]=f.ptstId;\nb[d++]=\"'></td></tr>\"\n}else{if(f.invite.hasOtherIndividualAttendees()){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.inviteesLabel;\nb[d++]=\"</td><td class='LabelColValue'>\";\nb[d++]=f.invitees;\nb[d++]=\"</td></tr>\";\nif(f.optInvitees){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.optionalLabel;\nb[d++]=\"</td><td class='LabelColValue'>\";\nb[d++]=f.optInvitees;\nb[d++]=\"</td></tr>\"\n}}}if(f.recur){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.repeats;\nb[d++]=\":</td><td class='LabelColValue'>\";\nb[d++]=f.recur;\nb[d++]=\"</td></tr>\"\n}if(f.toolbarCellId){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.respondLabel;\nb[d++]=\"</td><td class='LabelColValue' id='\";\nb[d++]=f.toolbarCellId;\nb[d++]=\"'></td></tr>\"\n}if(f.calendarSelectCellId){b[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=ZmMsg.calendarLabel;\nb[d++]=\"</td><td class='LabelColValue' style='padding-left:2px;' id='\";\nb[d++]=f.calendarSelectCellId;\nb[d++]=\"'></td></tr>\"\n}b[d++]=\"</table>\";\nif(f.hasAttachments){b[d++]='<div class=\"MessageHeaderAttachments\" id=\"';\nb[d++]=f.attachId;\nb[d++]='_container\"><div id=\"';\nb[d++]=f.attachId;\nb[d++]=\"\\\" style='overflow:auto;'></div></div>\"\n}b[d++]=\"</div>\";\nif(f.intendedForMsg){b[d++]='<div class=\"';\nb[d++]=f.intendedForClassName;\nb[d++]=\"\\\"><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td>\";\nb[d++]=AjxImg.getImageHtml(\"Information\");\nb[d++]=\"</td><td>\";\nb[d++]=f.intendedForMsg;\nb[d++]=\"</td></tr></table></div>\"\n}b[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_contactArea' class='ContactArea'><!-- Area reserved zimlets to add to message views. --></td></tr></table><div id='\";\nb[d++]=f.ptstMsgBannerId;\nb[d++]=\"' class='\";\nb[d++]=f.ptstClassName;\nb[d++]=\"' \";\nif(!f.ptstMsg){b[d++]=\" style='display:none;' \"\n}b[d++]=\" ><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td id=\\\"\";\nb[d++]=f.ptstMsgIconId;\nb[d++]='\">';\nb[d++]=AjxImg.getImageHtml(f.ptstIcon);\nb[d++]='</td><td id=\"';\nb[d++]=f.ptstMsgId;\nb[d++]='\">';\nb[d++]=f.ptstMsg;\nb[d++]=\"</td></tr></table></div><div id='\";\nb[d++]=f.infoBarId;\nb[d++]=\"'></div></div><div class='separator'></div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#InviteHeader\"},false);\nAjxTemplate.register(\"mail.Message#InviteHeaderPtst\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td>\";\nb[d++]=AjxImg.getImageHtml(f.icon);\nb[d++]=\"</td><td class='LabelColValue'>\";\nb[d++]=f.attendee;\nb[d++]=\"</td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#InviteHeaderPtst\"},false);\nAjxTemplate.register(\"mail.Message#AttachmentsView\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<table role=\\\"presentation\\\" width='100%' height='100%'><tr><td width='20%'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_filters'></div></td><td><div id='\";\nb[d++]=f.id;\nb[d++]=\"_results'>Loading...</div></td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#AttachmentsView\"},false);\nAjxTemplate.register(\"mail.Message#MessageListHeader\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<table role=\\\"presentation\\\" class='SubjectBar' width=100%><tr><td id='\";\nb[d++]=f.id;\nb[d++]=\"_closeBtnCell' width='1%' style='padding-right:10px;'></td><td width='1%'>\";\nb[d++]=AjxImg.getImageHtml(\"ConversationView\");\nb[d++]=\"</td><td><div class='Subject' id='\";\nb[d++]=f.id;\nb[d++]=\"_subjDiv'></div></td></tr>\";\nif(f.tagDivId){b[d++]=\"<tr><td colspan=4><div class='Tags' id='\";\nb[d++]=f.id;\nb[d++]=\"_tagDiv'></div></td></tr>\"\n}b[d++]=\"</table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#MessageListHeader\"},false);\nAjxTemplate.register(\"mail.Message#InformationBar\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<div id='\";\nb[d++]=f.id;\nb[d++]=\"' class='DisplayImages'><table role=\\\"presentation\\\" width='100%'><tr><td width='1%' style='padding:0 1em;'>\";\nb[d++]=AjxImg.getImageHtml(\"Warning\");\nb[d++]=\"</td><td>\";\nb[d++]=f.text;\nb[d++]=\" <span id='\";\nb[d++]=f.id;\nb[d++]=\"_link' class='FakeAnchor'>\";\nb[d++]=f.link;\nb[d++]=\"</span></td></tr></table></div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#InformationBar\"},false);\nAjxTemplate.register(\"mail.Message#ExtImageInformationBar\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<div id='\";\nb[d++]=f.id;\nb[d++]=\"' class='DisplayImages'><table role=\\\"presentation\\\" width='100%'><tr><td width='1%' style='padding:0 1em;'>\";\nb[d++]=AjxImg.getImageHtml(\"Warning\");\nb[d++]=\"</td><td><div><span>\";\nb[d++]=f.text;\nb[d++]=\"</span>&nbsp; \\n\";\nb[d++]='\\t\\t\\t\\t<a href=\"javascript:void(0);\" id=\\'';\nb[d++]=f.id;\nb[d++]=\"_dispImgs'>\";\nb[d++]=f.link;\nb[d++]=\"</a></div>\";\nif(f.domain||f.email){b[d++]=\"<div><span>\";\nb[d++]=f.alwaysText;\nb[d++]=\"</span>&nbsp; \\n\";\nb[d++]='\\t\\t\\t\\t<a href=\"javascript:void(0);\" id=\\'';\nb[d++]=f.id;\nb[d++]=\"_domain'>\";\nb[d++]=f.domain;\nb[d++]=\"</a> \\n\";\nb[d++]=\"\\t\\t\\t\\t\";\nb[d++]=f.or;\nb[d++]=\" \\n\";\nb[d++]='\\t\\t\\t\\t<a href=\"javascript:void(0);\" id=\\'';\nb[d++]=f.id;\nb[d++]=\"_email'>\";\nb[d++]=f.email;\nb[d++]=\"</a></div>\"\n}b[d++]=\"</td><td width='1%' style='padding:0 1em;'><div class=\\\"ImgClose\\\" id='\";\nb[d++]=f.id;\nb[d++]=\"_close'></div></td></tr></table></div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#ExtImageInformationBar\"},false);\nAjxTemplate.register(\"mail.Message#AllAttachments\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<table role=\\\"presentation\\\" style='margin:5px 0 1px'>\";\nif(f.viewAllUrl&&!appCtxt.get(ZmSetting.ATTACHMENTS_BLOCKED)){b[d++]=\"<tr><td width='1%' style='padding-right:3px;'>\";\nb[d++]=AjxImg.getImageHtml(\"ViewAll\",\"position:relative;\");\nb[d++]=\"</td><td style='white-space:nowrap;'><a style='text-decoration:underline' class='AttLink' href='\";\nb[d++]=f.viewAllUrl;\nb[d++]='\\' target=\"_blank\">';\nb[d++]=ZmMsg.viewAllImages;\nb[d++]=\"</a></td></tr>\"\n}if(!appCtxt.get(ZmSetting.ATTACHMENTS_BLOCKED)&&!appCtxt.get(ZmSetting.ATTACHMENTS_VIEW_IN_HTML_ONLY)){b[d++]=\"<tr><td width='1%' style='padding-right:3px;'>\";\nb[d++]=AjxImg.getImageHtml(ZmMimeTable.getInfo(ZmMimeTable.APP_ZIP).image,\"position:relative;\");\nb[d++]=\"</td><td style='white-space:nowrap;'><a style='text-decoration:underline' class='AttLink' id='\";\nb[d++]=f.downloadAllLinkId;\nb[d++]=\"' href='\";\nb[d++]=f.url;\nb[d++]=\"&disp=a&fmt=zip'>\";\nb[d++]=ZmMsg.downloadAll;\nb[d++]=\"</a></td></tr>\"\n}if(!appCtxt.isExternalAccount()){b[d++]=\"<tr><td width='1%' style='padding-right:3px;'>\";\nb[d++]=AjxImg.getImageHtml(\"AttachmentRemove\",\"position:relative;\");\nb[d++]=\"</td><td style='white-space:nowrap;'><a style='text-decoration:underline' class='AttLink' id='\";\nb[d++]=f.removeAllLinkId;\nb[d++]='\\' href=\"javascript:;\">';\nb[d++]=ZmMsg.removeAllAttachments;\nb[d++]=\"</a></td></tr>\"\n}b[d++]=\"</table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#AllAttachments\"},false);\nAjxTemplate.register(\"mail.Message#To_Recipient\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<tr id='\";\nb[d++]=f.toRowId;\nb[d++]=\"'><td width='1%' align=right valign=top style='\";\nb[d++]=f.labelStyle;\nb[d++]=\"'><div id='\";\nb[d++]=f.toPickerId;\nb[d++]=\"'>\";\nb[d++]=ZmMsg.toLabel;\nb[d++]=\"</div></td><td id='\";\nb[d++]=f.toCellId;\nb[d++]=\"'></td><td width='1%'></td></tr>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#To_Recipient\"},false);\nAjxTemplate.register(\"mail.Message#CC_Recipient\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<tr id='\";\nb[d++]=f.ccRowId;\nb[d++]=\"' style='display:none;'><td width='1%' align=right valign=top style='\";\nb[d++]=f.labelStyle;\nb[d++]=\"'><div id='\";\nb[d++]=f.ccPickerId;\nb[d++]=\"'>\";\nb[d++]=ZmMsg.ccLabel;\nb[d++]=\"</div></td><td id='\";\nb[d++]=f.ccCellId;\nb[d++]=\"'></td><td width='1%'></td></tr>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#CC_Recipient\"},false);\nAjxTemplate.register(\"mail.Message#BCC_Recipient\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<tr id='\";\nb[d++]=f.bccRowId;\nb[d++]=\"' style='display:none;'><td width='1%' align=right valign=top style='\";\nb[d++]=f.labelStyle;\nb[d++]=\"'><div id='\";\nb[d++]=f.bccPickerId;\nb[d++]=\"'>\";\nb[d++]=ZmMsg.bccLabel;\nb[d++]=\"</div></td><td id='\";\nb[d++]=f.bccCellId;\nb[d++]=\"'></td><td width='1%'></td></tr>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#BCC_Recipient\"},false);\nAjxTemplate.register(\"mail.Message#Compose\",function(d,i,g,c){var f=Boolean(c);\ng=(typeof g==\"string\"?{id:g}:g)||{};\nc=c||[];\nvar e=c.length;\nvar b=g.labelStyle=\"width:\"+(AjxEnv.isIE?60:64)+\"px; overflow:visible; white-space:nowrap\";\nvar h=g.inputStyle=AjxEnv.isSafari&&!AjxEnv.isSafariNightly?\"height:52px;\":\"height:21px; overflow:hidden\";\nc[e++]=\"<!-- header --><table id='\";\nc[e++]=g.headerId;\nc[e++]=\"' width=100% class='ZPropertySheet' cellspacing='6'>\";\nif(appCtxt.multiAccounts){c[e++]=\"<tr><td width='1%' align=right valign=top style='\";\nc[e++]=b;\nc[e++]=\"'>\";\nc[e++]=ZmMsg.fromLabel;\nc[e++]=\"</td><td><div id='\";\nc[e++]=g.fromSelectId;\nc[e++]=\"'></div></td><td width='1%'></td></tr>\"\n}else{c[e++]=\"<tr id='\";\nc[e++]=g.identityRowId;\nc[e++]=\"' style='display:none;'><td width='1%' align=right style='\";\nc[e++]=b;\nc[e++]=\"'>\";\nc[e++]=ZmMsg.fromLabel;\nc[e++]=\"</td><td><div id='\";\nc[e++]=g.identitySelectId;\nc[e++]=\"'></div></td><td width='1%'></td></tr>\"\n}c[e++]=AjxTemplate.expand(\"#To_Recipient\",g);\nc[e++]=AjxTemplate.expand(\"#CC_Recipient\",g);\nc[e++]=AjxTemplate.expand(\"#BCC_Recipient\",g);\nc[e++]=\"<tr id='\";\nc[e++]=g.subjectRowId;\nc[e++]=\"'><td width='1%' align=right style='\";\nc[e++]=b;\nc[e++]=\"'>\";\nc[e++]=ZmMsg.subjectLabel;\nc[e++]=\"</td><td><table role=\\\"presentation\\\" width='100%'><tr><td style='padding-right:4px;'><input type='text' id='\";\nc[e++]=g.subjectInputId;\nc[e++]=\"' class='subjectField' autocomplete=off aria-label='\";\nc[e++]=ZmMsg.subject;\nc[e++]=\"'></td></tr></table></td><td nowrap width='1%'></td></tr><tr id='\";\nc[e++]=g.attRowId;\nc[e++]=\"'><td width='1%' style='vertical-align:top; \";\nc[e++]=b;\nc[e++]=\"'><table role=\\\"presentation\\\" width='100%'><tr><td align=right id='\";\nc[e++]=g.attBtnId;\nc[e++]=\"'></td></tr></table></td><td><div id='\";\nc[e++]=g.attDivId;\nc[e++]=\"'></div></td><td width='1%'></td></tr><tr id='\";\nc[e++]=g.replyAttRowId;\nc[e++]=\"' style='display:none;'><td></td><td colspan=\\\"2\\\"><a class='FakeAnchor' onclick=\\\"window.appCtxt.getCurrentView()._addReplyAttachments()\\\">\";\nc[e++]=ZmMsg.replyAttach;\nc[e++]=\"</a></td></tr></table><!-- compose editor is automatically appended below the header -->\";\nreturn f?c.length:c.join(\"\")\n},{id:\"mail.Message#Compose\"},false);\nAjxTemplate.register(\"mail.Message#RedirectDialog\",function(d,i,g,c){var f=Boolean(c);\ng=(typeof g==\"string\"?{id:g}:g)||{};\nc=c||[];\nvar e=c.length;\nvar b=g.labelStyle=\"width:\"+(AjxEnv.isIE?60:64)+\"px; overflow:visible; white-space:nowrap;\";\nvar h=g.inputStyle=AjxEnv.isSafari&&!AjxEnv.isSafariNightly?\"height:52px;\":\"height:21px; overflow:hidden;\";\nc[e++]='<table role=\"presentation\" width=500 class=\"ZPropertySheet\" cellspacing=\"6\">';\nc[e++]=AjxTemplate.expand(\"#To_Recipient\",g);\nc[e++]=\"<tr><td align=right valign=top colspan=3>\";\nc[e++]=ZmMsg.redirectExplanation;\nc[e++]=\"</td></tr></table>\";\nreturn f?c.length:c.join(\"\")\n},{id:\"mail.Message#RedirectDialog\"},false);\nAjxTemplate.register(\"mail.Message#UploadProgressContainer\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<table role=\"presentation\" width=100%><tr style=\"display:table-row;\"><td width=\"96%\" colspan=\"2\"><div class=\"attBubbleContainer\"><div class=\"attBubbleHolder\">';\nb[d++]=AjxTemplate.expand(\"mail.Message#MailAttachmentBubble\",f);\nb[d++]=\"</div></div></td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#UploadProgressContainer\"},false);\nAjxTemplate.register(\"mail.Message#NoAttachments\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<table role=\"presentation\" width=100%><tr><td width=\"96%\" colspan=\"2\"><div class=\"attBubbleContainer\"><div class=\"attBubbleHolder attPlaceholderHint\">\\n';\nb[d++]=\"\\t\\t\\t\\t\\t\\t\";\nb[d++]=f.hint;\nb[d++]=\"\\n\";\nb[d++]=\"\\t\\t\\t\\t\\t</div></div></td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#NoAttachments\"},false);\nAjxTemplate.register(\"mail.Message#ForwardAttachments\",function(b,d,h,g){var e=Boolean(g);\nh=(typeof h==\"string\"?{id:h}:h)||{};\ng=g||[];\nvar f=g.length;\ng[f++]='<table role=\"presentation\" width=100%>';\nvar c=Dwt.getNextId(h.rowId);\ng[f++]=\"<tr '\";\ng[f++]=c;\ng[f++]='\\' style=\"display:table-row;\"><td width=\"96%\" colspan=\"2\"><div class=\"attBubbleContainer\"><div class=\"attBubbleHolder\">';\nfor(var j=0;\nj<h.attachments.length;\nj++){var k=h.attachments[j];\ng[f++]=\"<span id='\";\ng[f++]=k.spanId;\ng[f++]='\\' class=\"AttachmentLoading attachmentBubble AttachmentSpan\"><span><input type=\"hidden\" mid=\\'';\ng[f++]=k.mid;\ng[f++]=\"' value='\";\ng[f++]=k.part;\ng[f++]=\"' name='\";\ng[f++]=h.fwdFieldName;\ng[f++]=\"' ></span>\";\nif(appCtxt.get(ZmSetting.ATTACHMENTS_BLOCKED)){g[f++]=AjxStringUtil.htmlEncode(AjxStringUtil.clipFile(k.label,100))\n}else{g[f++]=\"<!-- The open A element is within the attachment.link string -->\";\ng[f++]=k.link\n}if(k.size){g[f++]=\"\\n\";\ng[f++]=\"\\t\\t\\t\\t\\t\\t\\t(\";\ng[f++]=k.size;\ng[f++]=\")\\n\";\ng[f++]=\"\\t\\t\\t\\t\\t\\t\"\n}g[f++]='<span tabindex=0 onclick=\"';\ng[f++]=k.closeHandler;\ng[f++]='\" onkeypress=\"';\ng[f++]=k.closeHandler;\ng[f++]='\" class=\"ImgBubbleDelete AttachmentClose\" role=\"button\" aria-label=\"';\ng[f++]=ZmMsg.remove;\ng[f++]='\"></span></span>'\n}g[f++]=\"</td></tr></table>\";\nreturn e?g.length:g.join(\"\")\n},{id:\"mail.Message#ForwardAttachments\"},false);\nAjxTemplate.register(\"mail.Message#ZmMailConfirmView\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<table role=\"presentation\" width=100%><tr><td valign=top id=\\'';\nb[d++]=f.id;\nb[d++]=\"_confirm'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_loading'>\";\nb[d++]=ZmMsg.loading;\nb[d++]=\"</div><div id='\";\nb[d++]=f.id;\nb[d++]=\"_notLoading'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_summary' class=\\\"Summary\\\"></div><p><div id='\";\nb[d++]=f.id;\nb[d++]='_displayAddresses\\' class=\"displayAddresses\"><div>';\nb[d++]=ZmMsg.confirmDisplayAddresss;\nb[d++]=\"</div><div id='\";\nb[d++]=f.id;\nb[d++]=\"_displayAddressBox' class=\\\"Box DisplayAddressBox\\\"></div></div><div id='\";\nb[d++]=f.id;\nb[d++]='_newAddresses\\' class=\"NewAddresses\"><div>';\nb[d++]=ZmMsg.confirmNewAddresses;\nb[d++]=\"</div><div>\";\nb[d++]=ZmMsg.confirmNewAddressesCheck;\nb[d++]=\"</div><div id='\";\nb[d++]=f.id;\nb[d++]='_newAddressBox\\' class=\"Box NewAddressBox\"></div></div><div style=\"margin:3px\" id=\\'';\nb[d++]=f.id;\nb[d++]=\"_addButton'></div><br><div id='\";\nb[d++]=f.id;\nb[d++]='_existingContacts\\' class=\"ExistingContacts\"><div>';\nb[d++]=ZmMsg.confirmExistingContacts;\nb[d++]=\"</div><div id='\";\nb[d++]=f.id;\nb[d++]=\"_existingContactBox' class=\\\"Box ExistingContactBox\\\"></div></div></p></div></td><td valign=top id='\";\nb[d++]=f.id;\nb[d++]=\"_ad'>&nbsp;</td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#ZmMailConfirmView\"},false);\nAjxTemplate.register(\"mail.Message#ZmMailConfirmViewNewAddress\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<div id=\"';\nb[d++]=f.id;\nb[d++]='_CHECKBOX\" tabindex=\\'10\\'></div><table role=\"presentation\" style=\"margin-bottom:3px\"><tr><td><div id=\"';\nb[d++]=f.id;\nb[d++]=\"_FIRST\\\" tabindex='20'/></td><td><div id=\\\"\";\nb[d++]=f.id;\nb[d++]=\"_LAST\\\" tabindex='30'/></td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#ZmMailConfirmViewNewAddress\"},false);\nAjxTemplate.register(\"mail.Message#ZmMailConfirmViewExistingContact\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<div style=\"padding:3px\">';\nb[d++]=f.text;\nb[d++]=\"</div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#ZmMailConfirmViewExistingContact\"},false);\nAjxTemplate.register(\"mail.Message#viewMessage\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<table role=\\\"presentation\\\" width='100%'><tr><td class='NoResults'>\";\nb[d++]=(f&&f.isConv)?ZmMsg.viewConversation:ZmMsg.viewMessage;\nb[d++]=\"</td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#viewMessage\"},false);\nAjxTemplate.register(\"mail.Message#EmptyMessage\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<table role=\\\"presentation\\\" width='100%'><tr><td class='NoResults'>\";\nb[d++]=ZmMsg.messageEmptyTextContent;\nb[d++]=\"</td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#EmptyMessage\"},false);\nAjxTemplate.register(\"mail.Message#Conv2View\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<div class='Conv2View' id=\\\"\";\nb[d++]=f.mainDivId;\nb[d++]='\"><div id=\"';\nb[d++]=f.headerDivId;\nb[d++]=\"\\\"></div><div role='list' id=\\\"\";\nb[d++]=f.messagesDivId;\nb[d++]=\"\\\" class='Conv2Messages'></div></div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#Conv2View\"},false);\nAjxTemplate.register(\"mail.Message#Conv2Header\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<span class=\"expandIcon\" id=\\'';\nb[d++]=f.convExpandId;\nb[d++]='\\'></span><span class=\"subject\" role=\"heading\" aria-level=\"1\" id=\\'';\nb[d++]=f.convSubjectId;\nb[d++]=\"'></span><span class=\\\"info\\\" id='\";\nb[d++]=f.convInfoId;\nb[d++]=\"'></span>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#Conv2Header\"},false);\nAjxTemplate.register(\"mail.Message#Conv2Reply\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<div id=\"';\nb[d++]=f.replyToDivId;\nb[d++]='\"></div><div id=\"';\nb[d++]=f.replyCcDivId;\nb[d++]='\" style=\"display:none;\"></div><div><textarea id=\"';\nb[d++]=f.replyInputId;\nb[d++]='\" class=\"ReplyTextarea\"></textarea></div><div id=\"';\nb[d++]=f.replyToolbarId;\nb[d++]='\"></div>';\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#Conv2Reply\"},false);\nAjxTemplate.register(\"mail.Message#Conv2ReplyTable\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]='<table role=\"presentation\" class=\"ZPropertySheet\">';\nb[d++]=AjxTemplate.expand(\"#Conv2MsgAddressRow\",f);\nb[d++]=\"</table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#Conv2ReplyTable\"},false);\nAjxTemplate.register(\"mail.Message#Conv2MsgHeader-collapsed\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<div class='image'><img src=\\\"\";\nb[d++]=f.imageURL;\nb[d++]='\" alt=\"';\nb[d++]=f.imageAltText;\nb[d++]='\"\\n';\nb[d++]=\"\\t\\t\";\nif(f.defaultImageUrl){b[d++]=\"\\n\";\nb[d++]=\"\\t\\t\\tonerror=\\\"this.onerror=null;this.src='\";\nb[d++]=f.defaultImageUrl;\nb[d++]=\"';\\\"\\n\";\nb[d++]=\"\\t\\t\"\n}b[d++]=\"\\n\";\nb[d++]=\"\\t\\t/></div><div class='info'><div id='\";\nb[d++]=f.fromId;\nb[d++]=\"' class='ZmConvListFrom'>\";\nb[d++]=f.from;\nb[d++]=\"</div><div class='ZmConvListFragment'>\";\nb[d++]=f.fragment;\nb[d++]=\"</div></div><div id='\";\nb[d++]=f.readCellId;\nb[d++]=\"' class='readUnreadDot'></div><div class='date' id='\";\nb[d++]=f.dateCellId;\nb[d++]=\"' title='\";\nb[d++]=f.dateTooltip;\nb[d++]=\"'>\";\nb[d++]=f.date;\nb[d++]=\"</div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#Conv2MsgHeader-collapsed\"},false);\nAjxTemplate.register(\"mail.Message#Conv2MsgHeader-expanded\",function(c,h,g,b){var f=Boolean(b);\ng=(typeof g==\"string\"?{id:g}:g)||{};\nb=b||[];\nvar e=b.length;\nb[e++]=\"<div class='image'><img src=\\\"\";\nb[e++]=g.imageURL;\nb[e++]='\" alt=\"';\nb[e++]=g.imageAltText;\nb[e++]='\"\\n';\nb[e++]=\"\\t\\t\";\nif(g.defaultImageUrl){b[e++]=\"\\n\";\nb[e++]=\"\\t\\t\\tonerror=\\\"this.onerror=null;this.src='\";\nb[e++]=g.defaultImageUrl;\nb[e++]=\"';\\\"\\n\";\nb[e++]=\"\\t\\t\"\n}b[e++]=\"\\n\";\nb[e++]=\"\\t\\t/></div><div class='info'><table role=\\\"presentation\\\" id='\";\nb[e++]=g.hdrTableId;\nb[e++]=\"' class='ZPropertySheet' cellspacing='6'><tr><td class='LabelColName'>\";\nb[e++]=ZmMsg.fromLabel;\nb[e++]=\"</td><td class='LabelColValue' style='white-space:nowrap'>\";\nb[e++]=AjxTemplate.expand(\"#SentBy\",g);\nb[e++]=\"</td></tr>\";\nfor(var d=0;\nd<g.addressTypes.length;\nd++){b[e++]=AjxTemplate.expand(\"#Conv2MsgAddressRow\",g.participants[g.addressTypes[d]])\n}b[e++]=\"</table></div><div id='\";\nb[e++]=g.readCellId;\nb[e++]=\"' class='readUnreadDot'></div><div class='date' id='\";\nb[e++]=g.dateCellId;\nb[e++]=\"' title='\";\nb[e++]=g.dateTooltip;\nb[e++]=\"'>\";\nb[e++]=g.date;\nb[e++]=\"</div>\";\nif(g.isOutDated){b[e++]=AjxTemplate.expand(\"#InviteNotCurrent\",g)\n}return f?b.length:b.join(\"\")\n},{id:\"mail.Message#Conv2MsgHeader-expanded\"},false);\nAjxTemplate.register(\"mail.Message#Conv2MsgAddressRow\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<tr><td class='LabelColName'>\";\nb[d++]=f.prefix?AjxMessageFormat.format(ZmMsg.makeLabel,f.prefix):\"\";\nb[d++]=\"</td><td class='LabelColValue'>\";\nb[d++]=f.partStr;\nb[d++]=\"</td></tr>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#Conv2MsgAddressRow\"},false);\nAjxTemplate.register(\"mail.Message#VacationRemindDialog\",function(c,g,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<div style='width:350px;' id='\";\nb[d++]=f.id;\nb[d++]=\"_question'><table role=\\\"presentation\\\" align='center' cellspacing='6' class=\\\"ZPropertySheet\\\"><tr><td>\";\nb[d++]=AjxImg.getImageHtml(DwtMessageDialog.ICON[DwtMessageDialog.INFO_STYLE]);\nb[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_dontRemindMsg'>\";\nb[d++]=ZmMsg.outOfOfficeRemindQuestion;\nb[d++]=\"</td></tr></table></div><table role=\\\"presentation\\\" align='center'><tr><td><input checked value='0' type='checkbox' id='\";\nb[d++]=f.id;\nb[d++]=\"_dontRemind' name='\";\nb[d++]=f.id;\nb[d++]=\"_dontRemind'></td><td style='white-space:nowrap'><label id='\";\nb[d++]=f.id;\nb[d++]=\"_dontRemindMsg' for='\";\nb[d++]=f.id;\nb[d++]=\"_dontRemind'>\";\nb[d++]=ZmMsg.dontRemind;\nb[d++]=\"</label></td></tr></table>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"mail.Message#VacationRemindDialog\"},false)\n};\n"
                    },
                    "redirectURL": "",
                    "headersSize": 364,
                    "bodySize": 500607
                },
                "cache": {},
                "timings": {
                    "send": 0,
                    "wait": 0,
                    "receive": 0
                }
            }
        ],
        "_webSocketEntries": {},
        "_settings": {
            "_proxy": {}
        }
    }
}
