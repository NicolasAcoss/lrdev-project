{
    "log": {
        "version": "1.2",
        "creator": {
            "name": "DevWeb",
            "version": "1.2"
        },
        "pages": [
            {
                "startedDateTime": "2022-12-06T11:38:19.609622Z",
                "id": "page_1",
                "title": "https://mail.etu.univ-lorraine.fr/zimbra/js/Contacts_all.js.zgz",
                "pageTimings": {}
            }
        ],
        "entries": [
            {
                "pageref": "page_1",
                "startedDateTime": "2022-12-06T11:38:19.609622Z",
                "time": 0,
                "_isResource": false,
                "request": {
                    "method": "GET",
                    "url": "https://mail.etu.univ-lorraine.fr/zimbra/js/Contacts_all.js.zgz?v=220726112844",
                    "httpVersion": "HTTP/2.0",
                    "cookies": [
                        {
                            "name": "UL-AUTHTRACE",
                            "value": "TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA",
                            "httpOnly": false
                        },
                        {
                            "name": "JSESSIONID",
                            "value": "node01ewv5q86m64i21vkfxtflutla86873.node0",
                            "httpOnly": false
                        },
                        {
                            "name": "ZM_AUTH_TOKEN",
                            "value": "0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b",
                            "httpOnly": false
                        }
                    ],
                    "headers": [
                        {
                            "name": "accept",
                            "value": "*/*"
                        },
                        {
                            "name": "accept-encoding",
                            "value": "gzip, deflate, br"
                        },
                        {
                            "name": "accept-language",
                            "value": "fr,fr-FR;q=0.8,en-US;q=0.5,en;q=0.3"
                        },
                        {
                            "name": "cookie",
                            "value": "UL-AUTHTRACE=TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA; JSESSIONID=node01ewv5q86m64i21vkfxtflutla86873.node0; ZM_AUTH_TOKEN=0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b"
                        },
                        {
                            "name": "dnt",
                            "value": "1"
                        },
                        {
                            "name": "referer",
                            "value": "https://mail.etu.univ-lorraine.fr/"
                        },
                        {
                            "name": "sec-fetch-dest",
                            "value": "empty"
                        },
                        {
                            "name": "sec-fetch-mode",
                            "value": "cors"
                        },
                        {
                            "name": "sec-fetch-site",
                            "value": "same-origin"
                        },
                        {
                            "name": "te",
                            "value": "trailers"
                        },
                        {
                            "name": "user-agent",
                            "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101 Firefox/102.0"
                        }
                    ],
                    "queryString": [
                        {
                            "name": "v",
                            "value": "220726112844"
                        }
                    ],
                    "headersSize": -1,
                    "bodySize": -1
                },
                "response": {
                    "status": 200,
                    "statusText": "OK",
                    "httpVersion": "HTTP/2.0",
                    "cookies": null,
                    "headers": [
                        {
                            "name": "accept-ranges",
                            "value": "bytes"
                        },
                        {
                            "name": "cache-control",
                            "value": "public, max-age=2595600"
                        },
                        {
                            "name": "content-type",
                            "value": "text/javascript"
                        },
                        {
                            "name": "date",
                            "value": "Tue, 06 Dec 2022 10:38:19 GMT"
                        },
                        {
                            "name": "expires",
                            "value": "Thu, 5 Jan 2023 11:38:19 GMT"
                        },
                        {
                            "name": "last-modified",
                            "value": "Tue, 26 Jul 2022 15:29:28 GMT"
                        },
                        {
                            "name": "server",
                            "value": "nginx"
                        },
                        {
                            "name": "x-frame-options",
                            "value": "SAMEORIGIN"
                        },
                        {
                            "name": "x-recouv-allowed",
                            "value": "Recouv"
                        }
                    ],
                    "content": {
                        "size": 185492,
                        "mimeType": "",
                        "text": "\n/* \n* Zimbra Collaboration Suite Web Client\n* Copyright (C) 2004-2017 Synacor, Inc.\n* https://www.zimbra.com/license\n*/\nif(AjxPackage.define(\"Contacts\")){if(AjxPackage.define(\"zimbraMail.abook.view.ZmEditContactView\")){ZmEditContactView=function(c,a){if(arguments.length==0){return\n}var d={ondirty:this._handleDirty,items:this.getFormItems()};\nvar f={id:\"editcontactform\",parent:c,className:\"ZmEditContactView\",posStyle:DwtControl.ABSOLUTE_STYLE,form:d};\nDwtForm.call(this,f);\nvar b=this.getControl(\"DETAILS\");\nif(b){var e=this.__getDetailsMenu();\nif(e){b.setMenu(e);\nb.addSelectionListener(new AjxListener(b,b.popup,[e]))\n}else{this.setVisible(\"DETAILS\",false)\n}}this._controller=a;\nZmTagsHelper.setupListeners(this);\nthis._changeListener=new AjxListener(this,this._contactChangeListener);\nthis.setScrollStyle(Dwt.SCROLL);\nthis.clean=false\n};\nZmEditContactView.prototype=new DwtForm;\nZmEditContactView.prototype.constructor=ZmEditContactView;\nZmEditContactView.prototype.toString=function(){return\"ZmEditContactView\"\n};\nZmEditContactView.prototype.getFormItems=function(){if(!this._formItems){this._formItems=[{id:\"FULLNAME\",type:\"DwtText\",className:\"contactHeader\",getter:this._getFullName,ignore:true},{id:\"IMAGE\",type:\"ZmEditContactViewImage\"},{id:\"ZIMLET_IMAGE\",type:\"DwtText\"},{id:\"PREFIX\",type:\"DwtInputField\",width:38,tooltip:ZmMsg.namePrefix,hint:ZmMsg.AB_FIELD_prefix,visible:\"get('SHOW_PREFIX')\"},{id:\"FIRST\",type:\"DwtInputField\",width:95,tooltip:ZmMsg.firstName,hint:ZmMsg.AB_FIELD_firstName,visible:\"get('SHOW_FIRST')\",onblur:\"this._controller.updateTabTitle()\"},{id:\"MIDDLE\",type:\"DwtInputField\",width:95,tooltip:ZmMsg.middleName,hint:ZmMsg.AB_FIELD_middleName,visible:\"get('SHOW_MIDDLE')\"},{id:\"MAIDEN\",type:\"DwtInputField\",width:95,tooltip:ZmMsg.maidenName,hint:ZmMsg.AB_FIELD_maidenName,visible:\"get('SHOW_MAIDEN')\"},{id:\"LAST\",type:\"DwtInputField\",width:95,tooltip:ZmMsg.lastName,hint:ZmMsg.AB_FIELD_lastName,visible:\"get('SHOW_LAST')\",onblur:\"this._controller.updateTabTitle()\"},{id:\"SUFFIX\",type:\"DwtInputField\",width:38,tooltip:ZmMsg.nameSuffix,hint:ZmMsg.AB_FIELD_suffix,visible:\"get('SHOW_SUFFIX')\"},{id:\"NICKNAME\",type:\"DwtInputField\",width:66,hint:ZmMsg.AB_FIELD_nickname,visible:\"get('SHOW_NICKNAME')\"},{id:\"COMPANY\",type:\"DwtInputField\",width:209,hint:ZmMsg.AB_FIELD_company,visible:\"get('SHOW_COMPANY')\",onblur:\"this._controller.updateTabTitle()\"},{id:\"TITLE\",type:\"DwtInputField\",width:209,hint:ZmMsg.AB_FIELD_jobTitle,visible:\"get('SHOW_TITLE')\"},{id:\"DEPARTMENT\",type:\"DwtInputField\",width:209,hint:ZmMsg.AB_FIELD_department,visible:\"get('SHOW_DEPARTMENT')\"},{id:\"NOTES\",type:\"DwtInputField\",hint:ZmMsg.notes,width:\"47em\",rows:4},{id:\"PHONETIC_PREFIX\",visible:\"this.isVisible('PREFIX')\",ignore:true},{id:\"PHONETIC_FIRST\",type:\"DwtInputField\",width:95,hint:ZmMsg.AB_FIELD_phoneticFirstName,visible:\"this.isVisible('FIRST')\"},{id:\"PHONETIC_MIDDLE\",visible:\"this.isVisible('MIDDLE')\",ignore:true},{id:\"PHONETIC_MAIDEN\",visible:\"this.isVisible('MAIDEN')\",ignore:true},{id:\"PHONETIC_LAST\",type:\"DwtInputField\",width:95,hint:ZmMsg.AB_FIELD_phoneticLastName,visible:\"this.isVisible('LAST')\"},{id:\"PHONETIC_SUFFIX\",visible:\"this.isVisible('SUFFIX')\",ignore:true},{id:\"PHONETIC_COMPANY\",type:\"DwtInputField\",width:209,hint:ZmMsg.AB_FIELD_phoneticCompany,visible:\"this.isVisible('COMPANY')\"},{id:\"EMAIL\",type:\"ZmEditContactViewInputSelectRows\",rowitem:{type:\"ZmEditContactViewInputSelect\",equals:ZmEditContactViewInputSelect.equals,params:{inputWidth:352,tooltip:ZmMsg.email,hint:ZmMsg.emailAddrHint,options:this.getEmailOptions()}},validator:ZmEditContactView.emailValidator},{id:\"PHONE\",type:\"ZmEditContactViewInputSelectRows\",rowitem:{type:\"ZmEditContactViewInputSelect\",equals:ZmEditContactViewInputSelect.equals,params:{inputWidth:351,tooltip:ZmMsg.phone,hint:ZmMsg.phoneNumberHint,options:this.getPhoneOptions()}}},{id:\"IM\",type:\"ZmEditContactViewInputSelectRows\",rowitem:{type:\"ZmEditContactViewIM\",equals:ZmEditContactViewIM.equals,params:{inputWidth:351,tooltip:ZmMsg.imShort,hint:ZmMsg.imScreenNameHint,options:this.getIMOptions()}}},{id:\"ADDRESS\",type:\"ZmEditContactViewInputSelectRows\",rowtemplate:\"abook.Contacts#ZmEditContactViewAddressRow\",rowitem:{type:\"ZmEditContactViewAddress\",equals:ZmEditContactViewAddress.equals,params:{options:this.getAddressOptions()}}},{id:\"URL\",type:\"ZmEditContactViewInputSelectRows\",rowitem:{type:\"ZmEditContactViewInputSelect\",equals:ZmEditContactViewInputSelect.equals,params:{inputWidth:351,hint:ZmMsg.url,options:this.getURLOptions()}}},{id:\"OTHER\",type:\"ZmEditContactViewInputSelectRows\",rowitem:{type:\"ZmEditContactViewOther\",equals:ZmEditContactViewInputSelect.equals,params:{inputWidth:300,selectInputWidth:112,hint:ZmMsg.date,options:this.getOtherOptions()}},validator:ZmEditContactViewOther.validator},{id:\"DETAILS\",type:\"DwtButton\",label:\"\\u00BB\",tooltip:ZmMsg.chooseFields,ignore:true,className:\"ZmEditContactViewDetailsButton\",template:\"abook.Contacts#ZmEditContactViewDetailsButton\",onblur:\"this._controller.updateTabTitle()\"},{id:\"FILE_AS\",type:\"DwtSelect\",onchange:this._handleFileAsChange,items:this.getFileAsOptions(),tooltip:ZmMsg.fileAs},{id:\"FOLDER\",type:\"DwtButton\",image:\"ContactsFolder\",imageAltText:ZmMsg.location,tooltip:ZmMsg.location,enabled:\"this._contact && !this._contact.isReadOnly()\",onclick:this._handleFolderButton},{id:\"TAG\",type:\"DwtControl\",enabled:\"this._contact && !this._contact.isShared()\",visible:\"appCtxt.get(ZmSetting.TAGGING_ENABLED)\"},{id:\"ACCOUNT\",type:\"DwtLabel\",visible:\"appCtxt.multiAccounts\"},{id:\"VIEW_IMAGE\",ignore:true,onclick:\"open(get('IMAGE')) && false\",visible:\"get('IMAGE')\"},{id:\"REMOVE_IMAGE\",ignore:true,onclick:this._handleRemoveImage,visible:\"get('IMAGE')\"},{id:\"JOB\",notab:true,ignore:true,visible:\"get('SHOW_TITLE') && get('SHOW_DEPARTMENT')\"},{id:\"TITLE_DEPARTMENT_SEP\",notab:true,ignore:true,visible:\"get('SHOW_TITLE') && get('SHOW_DEPARTMENT')\"}]\n}return this._formItems\n};\nZmEditContactView.emailValidator=function(c){for(var b=0;\nb<c.length;\nb++){var a=c[b];\nif(a&&!AjxEmailAddress.validateAddress(a)){throw ZmMsg.invalidEmailAddress\n}}return true\n};\nZmEditContactView.prototype.getFormItemById=function(d,a){a=a||this.getFormItems()||[];\nfor(var b=0;\nb<a.length;\nb++){var c=a[b];\nif(c.id==d){return c\n}}return null\n};\nZmEditContactView.prototype.getEmailOptions=function(){return null\n};\nZmEditContactView.prototype.getPhoneOptions=function(){return[{value:ZmContact.F_mobilePhone,label:ZmMsg.phoneLabelMobile},{value:ZmContact.F_workPhone,label:ZmMsg.phoneLabelWork},{value:ZmContact.F_workFax,label:ZmMsg.phoneLabelWorkFax},{value:ZmContact.F_companyPhone,label:ZmMsg.phoneLabelCompany},{value:ZmContact.F_homePhone,label:ZmMsg.phoneLabelHome},{value:ZmContact.F_homeFax,label:ZmMsg.phoneLabelHomeFax},{value:ZmContact.F_pager,label:ZmMsg.phoneLabelPager},{value:ZmContact.F_callbackPhone,label:ZmMsg.phoneLabelCallback},{value:ZmContact.F_assistantPhone,label:ZmMsg.phoneLabelAssistant},{value:ZmContact.F_carPhone,label:ZmMsg.phoneLabelCar},{value:ZmContact.F_otherPhone,label:ZmMsg.phoneLabelOther},{value:ZmContact.F_otherFax,label:ZmMsg.phoneLabelOtherFax}]\n};\nZmEditContactView.prototype.getIMOptions=function(){return[{value:\"xmpp\",label:ZmMsg.imGateway_xmpp},{value:\"yahoo\",label:ZmMsg.imGateway_yahoo},{value:\"aol\",label:ZmMsg.imGateway_aol},{value:\"msn\",label:ZmMsg.imGateway_msn},{value:\"im\",label:ZmMsg.other}]\n};\nZmEditContactView.prototype.getAddressOptions=function(){return[{value:\"home\",label:ZmMsg.home},{value:\"work\",label:ZmMsg.work},{value:\"other\",label:ZmMsg.other}]\n};\nZmEditContactView.prototype.getURLOptions=function(){return[{value:ZmContact.F_homeURL,label:ZmMsg.home},{value:ZmContact.F_workURL,label:ZmMsg.work},{value:ZmContact.F_otherURL,label:ZmMsg.other}]\n};\nZmEditContactView.prototype.getOtherOptions=function(){return[{value:ZmContact.F_birthday,label:ZmMsg.AB_FIELD_birthday},{value:ZmContact.F_anniversary,label:ZmMsg.AB_FIELD_anniversary},{value:\"custom\",label:ZmMsg.AB_FIELD_custom}]\n};\nZmEditContactView.prototype.getFileAsOptions=function(){return[{id:\"FA_LAST_C_FIRST\",value:ZmContact.FA_LAST_C_FIRST,label:ZmMsg.AB_FILE_AS_lastFirst},{id:\"FA_FIRST_LAST\",value:ZmContact.FA_FIRST_LAST,label:ZmMsg.AB_FILE_AS_firstLast},{id:\"FA_COMPANY\",value:ZmContact.FA_COMPANY,label:ZmMsg.AB_FILE_AS_company},{id:\"FA_LAST_C_FIRST_COMPANY\",value:ZmContact.FA_LAST_C_FIRST_COMPANY,label:ZmMsg.AB_FILE_AS_lastFirstCompany},{id:\"FA_FIRST_LAST_COMPANY\",value:ZmContact.FA_FIRST_LAST_COMPANY,label:ZmMsg.AB_FILE_AS_firstLastCompany},{id:\"FA_COMPANY_LAST_C_FIRST\",value:ZmContact.FA_COMPANY_LAST_C_FIRST,label:ZmMsg.AB_FILE_AS_companyLastFirst},{id:\"FA_COMPANY_FIRST_LAST\",value:ZmContact.FA_COMPANY_FIRST_LAST,label:ZmMsg.AB_FILE_AS_companyFirstLast}]\n};\nZmEditContactView.DIALOG_X=50;\nZmEditContactView.DIALOG_Y=100;\nZmEditContactView.SHOW_ID_PREFIXES=[\"PREFIX\",\"FIRST\",\"MIDDLE\",\"MAIDEN\",\"LAST\",\"SUFFIX\",\"NICKNAME\",\"TITLE\",\"DEPARTMENT\",\"COMPANY\"];\nZmEditContactView.SHOW_ID_LABELS=[ZmMsg.AB_FIELD_prefix,ZmMsg.AB_FIELD_firstName,ZmMsg.AB_FIELD_middleName,ZmMsg.AB_FIELD_maidenName,ZmMsg.AB_FIELD_lastName,ZmMsg.AB_FIELD_suffix,ZmMsg.AB_FIELD_nickname,ZmMsg.AB_FIELD_jobTitle,ZmMsg.AB_FIELD_department,ZmMsg.AB_FIELD_company];\nZmEditContactView.ALWAYS_SHOW={FIRST:true,LAST:true,TITLE:true,COMPANY:true};\nZmEditContactView.ATTRS={FILE_AS:ZmContact.F_fileAs,FOLDER:ZmContact.F_folderId,IMAGE:ZmContact.F_image,ZIMLET_IMAGE:ZmContact.F_zimletImage,PREFIX:ZmContact.F_namePrefix,SUFFIX:ZmContact.F_nameSuffix,MAIDEN:ZmContact.F_maidenName,FIRST:ZmContact.F_firstName,PHONETIC_FIRST:ZmContact.F_phoneticFirstName,MIDDLE:ZmContact.F_middleName,LAST:ZmContact.F_lastName,PHONETIC_LAST:ZmContact.F_phoneticLastName,NICKNAME:ZmContact.F_nickname,TITLE:ZmContact.F_jobTitle,DEPARTMENT:ZmContact.F_department,COMPANY:ZmContact.F_company,PHONETIC_COMPANY:ZmContact.F_phoneticCompany,NOTES:ZmContact.F_notes};\nZmEditContactView.updateFieldLists=function(){ZmEditContactView.LISTS={ADDRESS:{attrs:ZmContact.ADDRESS_FIELDS},EMAIL:{attrs:ZmContact.EMAIL_FIELDS,onlyvalue:true},PHONE:{attrs:ZmContact.PHONE_FIELDS},IM:{attrs:ZmContact.IM_FIELDS,onlyvalue:true},URL:{attrs:ZmContact.URL_FIELDS},OTHER:{attrs:ZmContact.OTHER_FIELDS}}\n};\nZmEditContactView.updateFieldLists();\nZmEditContactView.prototype.TEMPLATE=\"abook.Contacts#ZmEditContactView\";\nZmEditContactView.prototype.set=function(e,k){if(typeof arguments[0]==\"string\"){DwtForm.prototype.set.apply(this,arguments);\nreturn\n}this._contact=this._item=e;\nfor(var a in ZmEditContactView.ATTRS){var i=e.getAttr(ZmEditContactView.ATTRS[a]);\nif(a===\"FOLDER\"||a===\"IMAGE\"){continue\n}if(a===\"FILE_AS\"){i=i||ZmContact.FA_LAST_C_FIRST\n}this.setValue(a,i)\n}this.setValue(\"IMAGE\",(e&&e.getImageUrl(ZmContact.NO_MAX_IMAGE_WIDTH))||\"\",true);\nif(this.getControl(\"FOLDER\")){var b=e&&e.getAddressBook();\nif(!b&&(appCtxt.getCurrentViewType()==ZmId.VIEW_CONTACT_SIMPLE)){var j=appCtxt.getApp(ZmApp.CONTACTS).getOverview();\nb=j&&j.getSelected();\nif(b&&b.type!=ZmOrganizer.ADDRBOOK){b=null\n}if(b&&b.id&&b.id==ZmFolder.ID_DLS){b=null\n}}this._setFolder((b&&!b.isReadOnly())?b:ZmOrganizer.ID_ADDRBOOK)\n}if(this.getControl(\"TAG\")){this._setTags(e)\n}for(var a in ZmEditContactView.ATTRS){var c=\"SHOW_\"+a;\nvar d=this.getControl(c);\nif(d==null){continue\n}var h=a in ZmEditContactView.ALWAYS_SHOW||(this.getValue(a)||\"\")!=\"\";\nthis.setValue(c,h);\nd.setChecked(h,true)\n}this._listAttrs={};\nvar g=e.getNormalizedAttrs();\nfor(var a in ZmEditContactView.LISTS){switch(a){case\"ADDRESS\":this.__initRowsAddress(g,a,this._listAttrs);\nbreak;\ncase\"OTHER\":var f=ZmEditContactView.LISTS[a];\nthis.__initRowsOther(g,a,f.attrs,f.onlyvalue,this._listAttrs);\nbreak;\ndefault:var f=ZmEditContactView.LISTS[a];\nthis.__initRowsControl(g,a,f.attrs,f.onlyvalue,this._listAttrs)\n}}if(!k){this.reset(true)\n}this._handleDirty();\nthis.update();\nif(e){e.removeChangeListener(this._changeListener)\n}e.addChangeListener(this._changeListener);\nappCtxt.notifyZimlets(\"onContactEdit\",[this,this._contact,this._htmlElId])\n};\nZmEditContactView.prototype.getContact=function(){return this._contact\n};\nZmEditContactView.prototype.getModifiedAttrs=function(){var n=this.getDirtyItems();\nvar E={};\nvar g={};\nfor(var y=0;\ny<n.length;\ny++){var q=n[y];\nif(q==\"ACCOUNT\"){continue\n}var t=this.getValue(q);\nif(q in ZmEditContactView.LISTS){var o=t;\nvar A=[];\nfor(var x=0;\nx<o.length;\nx++){var C=o[x];\nif(q==\"ADDRESS\"){var d=C.type;\nA[d]=A[d]||1;\nvar h={};\nvar b=false;\nfor(var c in C){if(c===\"type\"){continue\n}var t=C[c];\nvar u=ZmContact.getAttributeName(d+c,A[d]);\nh[u]=t;\nb=b||t\n}if(b){A[d]++;\nfor(var l in h){g[l]=h[l]\n}}}else{var D=ZmEditContactView.LISTS[q]&&ZmEditContactView.LISTS[q].onlyvalue;\nvar k=D?C:C.value;\nif(!k){continue\n}var B=ZmEditContactView.LISTS[q];\nvar F=D?B.attrs[0]:C.type;\nif(q===\"OTHER\"&&AjxUtil.arrayContains(AjxUtil.values(ZmEditContactView.ATTRS),F)){continue\n}if(!E[F]){E[F]=0\n}var e=++E[F];\nF=ZmContact.getAttributeName(F,e);\ng[F]=k\n}}}else{var F=ZmEditContactView.ATTRS[q];\ng[F]=t\n}}var f=AjxUtil.keys(g);\nvar p=this._listAttrs;\nfor(var q in p){if(!this.isDirty(q)){continue\n}var z=AjxUtil.uniq(AjxUtil.map(p[q],ZmContact.getPrefix));\nfor(var y=0;\ny<z.length;\ny++){var r=AjxUtil.keys(this._contact.getAttrs(z[y]));\nvar w=AjxUtil.complement(f,r);\nfor(var x=0;\nx<w.length;\nx++){g[w[x]]=\"\"\n}}}if(AjxUtil.keys(g).length==0){return null\n}if(!g[ZmContact.F_folderId]&&!this._contact.id){g[ZmContact.F_folderId]=this.getValue(\"FOLDER\")\n}if(g[ZmContact.F_image]&&g[ZmContact.F_image]===this._contact.getAttr(ZmContact.F_zimletImage)){g[ZmContact.F_image]=\"\"\n}if(g[ZmContact.F_image]){var t=this.getValue(\"IMAGE\");\nvar s=/aid=(.*)/.exec(t);\nif(s){g[ZmContact.F_image]=\"aid_\"+s[1]\n}}return g\n};\nZmEditContactView.prototype.isEmpty=function(a){a=a||this._items;\nfor(var f in a){var d=a[f];\nif(this.isIgnore(f)||f==\"FILE_AS\"){continue\n}var e=this.getValue(f);\nif(e){if(!AjxUtil.isArray(e)){if(f==\"FOLDER\"){if(e!=d.ovalue){return false\n}}else{if(e!==\"\"){return false\n}}}else{for(var c=0;\nc<e.length;\nc++){var b=e[c];\nif(b){if(f==\"ADDRESS\"){if(!ZmEditContactViewAddress.equals(b,{type:b.type})){return false\n}}else{if(!(b.value===\"\"||b===\"\")){return false\n}}}}}}}return true\n};\nZmEditContactView.prototype.enableInputs=function(a){};\nZmEditContactView.prototype.cleanup=function(){this._contact=this._item=null;\nthis.clean=true\n};\nZmEditContactView.prototype.dispose=function(){ZmTagsHelper.disposeListeners(this);\nDwtComposite.prototype.dispose.apply(this,arguments)\n};\nZmEditContactView.prototype._setTags=function(a){var c=ZmTagsHelper.getTagsHtml(a||this._item,this);\nvar b=this.getControl(\"TAG\");\nif(!b){return\n}b.clearContent();\nif(c.length>0){b.setContent(c);\nb.setVisible(true)\n}else{b.setVisible(false)\n}};\nZmEditContactView._onBlur=function(){this._controller._updateTabTitle()\n};\nZmEditContactView.prototype.getList=function(){return null\n};\nZmEditContactView.prototype.getController=function(){return this._controller\n};\nZmEditContactView.prototype.getSelection=function(){return this.getContact()\n};\nZmEditContactView.prototype.getSelectionCount=function(){return 1\n};\nZmEditContactView.prototype.getTitle=function(){return[ZmMsg.zimbraTitle,ZmMsg.contact].join(\": \")\n};\nZmEditContactView.prototype._checkItemCount=function(){};\nZmEditContactView.prototype._handleResponseCheckReplenish=function(){};\nZmEditContactView.prototype._getFullName=function(b){var a={fileAs:this.getValue(\"FILE_AS\"),firstName:this.getValue(\"FIRST\"),lastName:this.getValue(\"LAST\"),company:this.getValue(\"COMPANY\")};\nreturn ZmContact.computeFileAs(a)||(b?null:ZmMsg.noName)\n};\nZmEditContactView.prototype._getDefaultFocusItem=function(){return this.getControl(appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS)?\"LAST\":\"FIRST\")\n};\nZmEditContactView.prototype._setFolder=function(b){var a=b instanceof ZmOrganizer?b:appCtxt.getById(b);\nthis.setLabel(\"FOLDER\",a.getName());\nthis.setValue(\"FOLDER\",a.id);\nthis.setImage(\"FOLDER\",a.getIconWithColor(),ZmMsg.locationLabel);\nif(appCtxt.multiAccounts){this.setValue(\"ACCOUNT\",a.getAccount().getDisplayName())\n}};\nZmEditContactView.prototype._getDialogXY=function(){var a=Dwt.toWindow(this.getHtmlElement(),0,0,null,true);\nreturn new DwtPoint(a.x+ZmEditContactView.DIALOG_X,a.y+ZmEditContactView.DIALOG_Y)\n};\nZmEditContactView.prototype._handleDirty=function(){var a=this.getDirtyItems();\nvar c=this._controller&&this._controller.getCurrentToolbar();\nif(c){var b=a.length>0?a.length>1||a[0]!=\"IMAGE\"||this._contact.id:false;\nvar e=AjxUtil.hashCopy(this._items);\ndelete e.FOLDER;\nvar d=this.isEmpty(e);\nc.enable(ZmOperation.SAVE,b&&!d)\n}this.setValue(\"DEBUG\",a.join(\", \"))\n};\nZmEditContactView.prototype._handleDetailCheck=function(b,c){this.setValue(b,!this.getValue(b));\nthis.update();\nvar a=this.getControl(c);\nif(a){a.disableFocusHdlr();\na.focus();\na.enableFocusHdlr();\nif(AjxEnv.isFirefox){a.enableKeyDownHdlr()\n}}};\nZmEditContactView.prototype._handleRemoveImage=function(){var b=this.getValue(\"IMAGE\",\"\");\nvar a=this.getValue(\"ZIMLET_IMAGE\",\"\");\nif(b!==a){this.set(\"IMAGE\",a);\nreturn\n}this.set(\"ZIMLET_IMAGE\",\"\");\nthis.set(\"IMAGE\",\"\")\n};\nZmEditContactView.prototype._handleFileAsChange=function(){var c=this.getValue(\"FILE_AS\");\nvar b=ZmEditContactView.ALWAYS_SHOW.COMPANY||c==ZmContact.FA_COMPANY||c==ZmContact.FA_LAST_C_FIRST_COMPANY||c==ZmContact.FA_FIRST_LAST_COMPANY||c==ZmContact.FA_COMPANY_LAST_C_FIRST||c==ZmContact.FA_COMPANY_FIRST_LAST;\nvar a=this.getValue(\"COMPANY\");\nif(b){this.setValue(\"SHOW_COMPANY\",true);\nthis.setVisible(\"COMPANY\",true)\n}else{if(!a){this.setValue(\"SHOW_COMPANY\",false);\nthis.setVisible(\"COMPANY\",false)\n}}};\nZmEditContactView.prototype._handleFolderButton=function(b){var a=appCtxt.getChooseFolderDialog();\na.registerCallback(DwtDialog.OK_BUTTON,new AjxCallback(this,this._handleChooseFolder));\nvar c={overviewId:a.getOverviewId(ZmApp.CONTACTS),title:ZmMsg.chooseAddrBook,treeIds:[ZmOrganizer.ADDRBOOK],skipReadOnly:true,skipRemote:false,noRootSelect:true,appName:ZmApp.CONTACTS};\nc.omit={};\nc.omit[ZmFolder.ID_TRASH]=true;\na.popup(c)\n};\nZmEditContactView.prototype._handleChooseFolder=function(a){var b=appCtxt.getChooseFolderDialog();\nb.popdown();\nthis._setFolder(a)\n};\nZmEditContactView.prototype._contactChangeListener=function(a){if(a.type!=ZmEvent.S_CONTACT){return\n}if(a.event==ZmEvent.E_TAGS||a.event==ZmEvent.E_REMOVE_ALL){this._setTags()\n}};\nZmEditContactView.prototype.__getDetailsMenu=function(){var c=new DwtMenu({parent:this.getControl(\"DETAILS\"),style:DwtMenu.POPUP_STYLE,id:\"ContactDetailsMenu\"});\nvar a=ZmEditContactView.SHOW_ID_PREFIXES;\nvar f=ZmEditContactView.SHOW_ID_LABELS;\nvar g=0;\nfor(var e=0;\ne<a.length;\ne++){var b=a[e];\nif(this.getControl(b)){var h=new DwtMenuItem({parent:c,style:DwtMenuItem.CHECK_STYLE,id:\"ContactDetailsMenu_\"+b});\nh.setText(f[e]);\nif(b in ZmEditContactView.ALWAYS_SHOW){h.setChecked(true,true);\nh.setEnabled(false)\n}var j=\"SHOW_\"+b;\nvar d=new AjxListener(this,this._handleDetailCheck,[j,b]);\nh.addSelectionListener(d);\nthis._registerControl({id:j,control:h,ignore:true});\ng++\n}}return g>2?c:null\n};\nZmEditContactView.prototype.__initRowsControl=function(l,b,e,o,g,h){var k=[];\nfor(var c=0;\nc<e.length;\nc++){var f=e[c];\nfor(var d=1;\ntrue;\nd++){var m=ZmContact.getAttributeName(f,d);\nif(m!=f&&AjxUtil.indexOf(e,m)!=-1){break\n}var n=l[m];\nif(!n){break\n}k.push(o?n:{type:f,value:n});\nif(!g[b]){g[b]=[]\n}g[b].push(m)\n}}if(!h){this.setValue(b,k)\n}return k\n};\nZmEditContactView.prototype.__initRowsOther=function(n,a,e,r,k){var m=this.__initRowsControl.call(this,n,a,e,r,k,true);\nvar c={};\nfor(var g in ZmEditContactView.ATTRS){c[ZmEditContactView.ATTRS[g]]=true\n}for(var f in ZmEditContactView.LISTS){var l=ZmEditContactView.LISTS[f];\nif(!l.attrs){continue\n}for(var d=0;\nd<l.attrs.length;\nd++){c[l.attrs[d]]=true\n}}for(var d=0;\nd<ZmContact.ADDR_PREFIXES.length;\nd++){var h=ZmContact.ADDR_PREFIXES[d];\nfor(var b=0;\nb<ZmContact.ADDR_SUFFIXES.length;\nb++){var q=ZmContact.ADDR_SUFFIXES[b];\nc[h+q]=true\n}}for(var o in n){var p=ZmContact.getPrefix(o);\nif(ZmContact.IS_IGNORE[p]){continue\n}if(!(p in c)){m.push({type:p,value:n[o]});\nif(!k[a]){k[a]=[]\n}k[a].push(o)\n}}this.setValue(a,m)\n};\nZmEditContactView.prototype.__initRowsAddress=function(m,b,g){var l=[];\nvar f=ZmContact.ADDR_PREFIXES;\nvar r=ZmContact.ADDR_SUFFIXES;\nfor(var c=0;\nc<f.length;\nc++){var h=f[c];\nfor(var d=1;\ntrue;\nd++){var p=null;\nfor(var e=0;\ne<r.length;\ne++){var q=r[e];\nvar n=ZmContact.getAttributeName(h+q,d);\nvar o=m[n];\nif(!o){continue\n}if(!p){p={}\n}p[q]=o;\nif(!g[b]){g[b]=[]\n}g[b].push(n)\n}if(!p){break\n}p.type=h;\nl.push(p)\n}}this.setValue(\"ADDRESS\",l)\n};\nZmEditContactViewImage=function(b){if(arguments.length==0){return\n}b.className=b.className||\"ZmEditContactViewImage\";\nb.posStyle=Dwt.RELATIVE_STYLE;\nb.id=b.parent.getHTMLElId()+\"_IMAGE\";\nDwtControl.apply(this,arguments);\nvar a=this.getHtmlElement();\na.innerHTML=[\"<div style='width:48;height:48'>\",\"<img id='\",this._htmlElId,\"_img' width='48' height='48'>\",\"</div>\",\"<div id='\",this._htmlElId,\"_badge' style='position:absolute;\",\"bottom:\",(AjxEnv.isMozilla?-4:0),\";right:\",(AjxEnv.isMozilla?3:0),\"px'>\"].join(\"\");\na.style.cursor=\"pointer\";\nthis._src=\"\";\nthis._imgEl=document.getElementById(this._htmlElId+\"_img\");\nthis._imgEl.onload=AjxCallback.simpleClosure(this._imageLoaded,this);\nthis._badgeEl=document.getElementById(this._htmlElId+\"_badge\");\nthis._setMouseEvents();\nthis.addListener(DwtEvent.ONMOUSEOVER,new AjxListener(Dwt.addClass,[a,DwtControl.HOVER]));\nthis.addListener(DwtEvent.ONMOUSEOUT,new AjxListener(Dwt.delClass,[a,DwtControl.HOVER]));\nthis.addListener(DwtEvent.ONMOUSEUP,new AjxListener(this,this._chooseImage));\nthis.setToolTipContent(ZmMsg.addImg)\n};\nZmEditContactViewImage.prototype=new DwtControl;\nZmEditContactViewImage.prototype.constructor=ZmEditContactViewImage;\nZmEditContactViewImage.prototype.isFocusable=true;\nZmEditContactViewImage.prototype.toString=function(){return\"ZmEditContactViewImage\"\n};\nZmEditContactViewImage.IMAGE_URL=\"/service/content/proxy?aid=@aid@\";\nZmEditContactViewImage.prototype.setValue=function(b,a){this._currentSrc=this._src;\nif(typeof this._originalSrc===\"undefined\"){this._originalSrc=this._src\n}this._src=b;\nif(!b){this._imgEl.src=ZmZimbraMail.DEFAULT_CONTACT_ICON;\nthis._badgeEl.className=\"ImgAdd\";\nthis.setToolTipContent(ZmMsg.addImg);\nthis._imgEl.alt=ZmMsg.addImg\n}else{this._imgEl.src=b;\nthis._badgeEl.className=\"ImgEditBadge\";\nthis.setToolTipContent(ZmMsg.editImg);\nthis._imgEl.alt=ZmMsg.editImg\n}this.parent.setDirty(\"IMAGE\",true);\nthis._imgEl.onerror=this._handleCorruptImageError.bind(this,a)\n};\nZmEditContactViewImage.prototype.getValue=function(){return this._src\n};\nZmEditContactViewImage.prototype._focus=function(){Dwt.addClass(this.getHtmlElement(),DwtControl.FOCUSED)\n};\nZmEditContactViewImage.prototype._blur=function(){Dwt.delClass(this.getHtmlElement(),DwtControl.FOCUSED)\n};\nZmEditContactViewImage.prototype._imageLoaded=function(){this._imgEl.removeAttribute(\"width\");\nthis._imgEl.removeAttribute(\"height\");\nvar a=this._imgEl.width;\nvar b=this._imgEl.height;\nthis._imgEl.setAttribute(a>b?\"width\":\"height\",48)\n};\nZmEditContactViewImage.prototype._chooseImage=function(){var e=appCtxt.getUploadDialog();\ne.setAllowedExtensions([\"png\",\"jpg\",\"jpeg\",\"gif\"]);\nvar a=null;\nvar h=new AjxCallback(this,this._handleImageSaved);\nvar f=ZmMsg.uploadImage;\nvar g=null;\nvar i=true;\nvar d=true;\nvar c=false;\nvar b=true;\ne.popup(null,a,h,f,g,i,d,c,b)\n};\nZmEditContactViewImage.prototype._handleImageSaved=function(d,c,b){var a=appCtxt.getUploadDialog();\na.popdown();\nthis.setValue(ZmEditContactViewImage.IMAGE_URL.replace(/@aid@/,b[0].guid),true);\nthis.parent.update()\n};\nZmEditContactViewImage.prototype._createElement=function(){return document.createElement(\"FIELDSET\")\n};\nZmEditContactViewImage.prototype._handleCorruptImageError=function(a){this.setValue(this._currentSrc);\nif(this._originalSrc==this._currentSrc){this.parent.setDirty(\"IMAGE\",false)\n}if(a){this._popupCorruptImageErrorDialog()\n}};\nZmEditContactViewImage.prototype._popupCorruptImageErrorDialog=function(){var a=this.corruptImageErrorDlg;\nif(a){a.popup()\n}else{a=appCtxt.getMsgDialog();\nthis.corruptImageErrorDlg=a;\na.setMessage(ZmMsg.errorCorruptImageFile,DwtMessageDialog.CRITICAL_STYLE,ZmMsg.corruptFile);\na.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._corruptImageErrorDialogOkListener));\na.popup()\n}};\nZmEditContactViewImage.prototype._corruptImageErrorDialogOkListener=function(){this.corruptImageErrorDlg.popdown();\nthis._chooseImage()\n};\nZmEditContactViewRows=function(f){if(arguments.length==0){return\n}if(!f.formItemDef){f.formItemDef={}\n}var e=f.formItemDef.rowitem;\nvar c=e&&e.params;\nvar d=this._options=(c&&c.options)||[];\nfor(var a=0;\na<d.length;\na++){var b=d[a];\nif(b.max){if(!this._maximums){this._maximums={}\n}this._maximums[b.value]={max:b.max,count:0}\n}}f.formItemDef.id=f.formItemDef.id||Dwt.getNextId();\nf.formItemDef.onremoverow=\"this.setDirty(true)\";\nf.className=f.className||\"ZmEditContactViewRows\";\nf.id=[f.parent.getHTMLElId(),f.formItemDef.id].join(\"_\");\nDwtFormRows.apply(this,arguments);\nthis.setScrollStyle(Dwt.VISIBLE)\n};\nZmEditContactViewRows.prototype=new DwtFormRows;\nZmEditContactViewRows.prototype.constructor=ZmEditContactViewRows;\nZmEditContactViewRows.prototype.toString=function(){return\"ZmEditContactViewRows\"\n};\nZmEditContactViewRows.prototype.TEMPLATE=\"abook.Contacts#ZmEditContactViewRows\";\nZmEditContactViewRows.prototype.setDirty=function(){DwtFormRows.prototype.setDirty.apply(this,arguments);\nthis.parent.setDirty(this._itemDef.id,this.isDirty())\n};\nZmEditContactViewRows.prototype.isMaxedOut=function(a){var b=this._maximums&&this._maximums[a];\nreturn b!=null&&b.count>=b.max\n};\nZmEditContactViewRows.prototype.isAllMaxedOut=function(){if(!this._options||this._options.length==0){return false\n}var c=0;\nfor(var a=0;\na<this._options.length;\na++){var b=this._options[a].value;\nc+=this.isMaxedOut(b)?1:0\n}return c>=this._options.length\n};\nZmEditContactViewInputSelectRows=function(a){if(arguments.length==0){return\n}ZmEditContactViewRows.apply(this,arguments)\n};\nZmEditContactViewInputSelectRows.prototype=new ZmEditContactViewRows;\nZmEditContactViewInputSelectRows.prototype.constructor=ZmEditContactViewInputSelectRows;\nZmEditContactViewInputSelectRows.prototype.toString=function(){return\"ZmEditContactViewInputSelectRows\"\n};\nZmEditContactViewInputSelectRows.prototype.getMaxRows=function(){return this.isAllMaxedOut()?this.getRowCount():ZmEditContactViewRows.prototype.getMaxRows.call(this)\n};\nZmEditContactViewInputSelectRows.prototype.setValue=function(d){if(arguments[0] instanceof Array){DwtFormRows.prototype.setValue.apply(this,arguments);\nthis._resetMaximums()\n}else{var c=String(arguments[0]);\nvar b=c&&this._subtract(c);\nDwtFormRows.prototype.setValue.apply(this,arguments);\nvar a=c&&this._add(c);\nif(b||a){this._adjustMaximums()\n}}};\nZmEditContactViewInputSelectRows.prototype.addRow=function(a,c){DwtFormRows.prototype.addRow.apply(this,arguments);\nc=c!=null?c:this.getRowCount()-1;\nvar g=this._add(c);\nif(g){this._adjustMaximums()\n}var f=this.getValue(c);\nif(f&&this.isMaxedOut(f.type)&&this._options.length>0&&this._maximums[f.type].count>this._maximums[f.type].max){var b=this._options;\nfor(var d=0;\nd<b.length;\nd++){var e=b[d];\nif(!this.isMaxedOut(e.value)){f.type=e.value;\nthis.setValue(c,f);\nbreak\n}}}if(this._rowCount>=this._maxRows){for(var d=0;\nd<this._rowCount;\nd++){this.setVisible(this._items[d]._addId,false)\n}}if(AjxEnv.isFirefox){this._updateLayout()\n}};\nZmEditContactViewInputSelectRows.prototype.removeRow=function(b){var a=this._subtract(b);\nDwtFormRows.prototype.removeRow.apply(this,arguments);\nif(a){this._adjustMaximums()\n}if(AjxEnv.isFirefox){this._updateLayout()\n}};\nZmEditContactViewInputSelectRows.prototype._setControlIds=function(d,a){DwtFormRows.prototype._setControlIds.call(this,d,a);\nvar b=this._items[d];\nvar c=b&&b.control;\nif(c&&c._setControlIds){c._setControlIds(d,a)\n}};\nZmEditContactViewInputSelectRows.prototype._subtract=function(b){var a=this.getValue(b);\nreturn this._subtractType(a&&a.type)\n};\nZmEditContactViewInputSelectRows.prototype._subtractType=function(a){if(!this._maximums||!this._maximums[a]){return false\n}this._maximums[a].count--;\nreturn true\n};\nZmEditContactViewInputSelectRows.prototype._add=function(b){var a=this.getValue(b);\nreturn this._addType(a&&a.type)\n};\nZmEditContactViewInputSelectRows.prototype._addType=function(a){if(!this._maximums||!this._maximums[a]){return false\n}this._maximums[a].count++;\nreturn true\n};\nZmEditContactViewInputSelectRows.prototype._adjustMaximums=function(){if(!this._maximums||!this._options){return\n}var b={};\nvar f=0;\nfor(var c=0;\nc<this._options.length;\nc++){var d=this._options[c].value;\nvar e=this.isMaxedOut(d);\nb[d]=!e;\nf+=e?1:0\n}var h=f==this._options.length;\nvar a=this.getRowCount();\nfor(var c=0;\nc<a;\nc++){var g=this.getControl(c);\nif(g.enableOptions){g.enableOptions(b)\n}this.setVisible(this._items[c]._addId,!h)\n}};\nZmEditContactViewInputSelectRows.prototype._resetMaximums=function(){if(!this._maximums){return\n}for(var c in this._maximums){this._maximums[c].count=0\n}var a=this.getRowCount();\nfor(var b=0;\nb<a;\nb++){var d=this.getValue(b);\nvar e=this._maximums[d&&d.type];\nif(e){e.count++\n}}};\nZmEditContactViewInputSelectRows.prototype._updateLayout=function(){for(var b=0,a=this.getRowCount();\nb<a;\nb++){this.getControl(b).reRenderSelect();\nthis.getControl(b).reRenderInput()\n}};\nZmEditContactViewInputSelect=function(a){if(arguments.length==0){return\n}this._formItemId=a.formItemDef.id;\nthis._options=a.options||[];\nthis._cols=a.cols;\nthis._rows=a.rows;\nthis._hint=a.hint;\nDwtComposite.apply(this,arguments);\nthis._tabGroup=new DwtTabGroup(this._htmlElId);\nthis._createHtml(a.template);\nif(this._input&&(a.inputWidth||a.inputHeight)){Dwt.setSize(this._input.getInputElement(),a.inputWidth,a.inputHeight)\n}};\nZmEditContactViewInputSelect.prototype=new DwtComposite;\nZmEditContactViewInputSelect.prototype.constructor=ZmEditContactViewInputSelect;\nZmEditContactViewInputSelect.prototype.toString=function(){return\"ZmEditContactViewInputSelect\"\n};\nZmEditContactViewInputSelect.prototype.TEMPLATE=\"abook.Contacts#ZmEditContactViewInputSelect\";\nZmEditContactViewInputSelect.prototype.setValue=function(b){var c=this._options.length>0;\nvar a=c?b&&b.value:b;\nif(c&&this._select){this._select.setSelectedValue((b&&b.type)||this._options[0].value)\n}if(this._input){if(this._select){this._input.setEnabled(this._select.getValue()!=\"_NONE\")\n}this._input.setValue(a||\"\")\n}};\nZmEditContactViewInputSelect.prototype.getValue=function(){var b=this._options.length>0;\nvar a=this._input?this._input.getValue():\"\";\nreturn b?{type:this._select?this._select.getValue():\"\",value:a}:a\n};\nZmEditContactViewInputSelect.prototype.setDirty=function(a){if(this.parent instanceof DwtForm){this.parent.setDirty(true)\n}};\nZmEditContactViewInputSelect.equals=function(d,c){if(d===c){return true\n}if(!d||!c){return false\n}var e=this._options.length>0;\nreturn e?d.type==c.type&&d.value==c.value:d==c\n};\nZmEditContactViewInputSelect.prototype.enableOptions=function(a){if(!this._select||!this._select.enableOption){return\n}var b=this.getValue().type;\nfor(var c in a){this._select.enableOption(c,c==b||a[c])\n}};\nZmEditContactViewInputSelect.prototype._focus=function(){this._input.focus()\n};\nZmEditContactViewInputSelect.prototype._setControlIds=function(b,a){var c=this.getHTMLElId();\nthis._setControlId(this,c+\"_value\");\nthis._setControlId(this._input,c);\nthis._setControlId(this._select,c+\"_select\")\n};\nZmEditContactViewInputSelect.prototype._setControlId=DwtFormRows.prototype._setControlId;\nZmEditContactViewInputSelect.prototype._createHtml=function(c){var a=this._tabIndexes=[];\nthis._createHtmlFromTemplate(c||this.TEMPLATE,{id:this._htmlElId});\na.sort(DwtForm.__byTabIndex);\nfor(var b=0;\nb<a.length;\nb++){var d=a[b].control;\nthis._tabGroup.addMember(d.getTabGroupMember()||d)\n}};\nZmEditContactViewInputSelect.prototype._createHtmlFromTemplate=function(b,c){DwtComposite.prototype._createHtmlFromTemplate.apply(this,arguments);\nvar a=this._tabIndexes;\nvar d=document.getElementById(c.id+\"_input\");\nif(d){this._input=this._createInput();\nthis._input.replaceElement(d);\nif(d.getAttribute(\"notab\")!=\"true\"){a.push({tabindex:d.getAttribute(\"tabindex\")||Number.MAX_VALUE,control:this._input})\n}}var f=document.getElementById(c.id+\"_select\");\nvar e=this._options.length>0;\nif(e&&f){this._select=this._createSelect(this._options);\nthis._select.addChangeListener(new AjxListener(this,this._handleSelectChange));\nthis._select.replaceElement(f);\nif(f.getAttribute(\"notab\")!=\"true\"){a.push({tabindex:f.getAttribute(\"tabindex\")||Number.MAX_VALUE,control:this._select})\n}this._select.setVisible(this._options.length>1);\nif(this._input){this._input.setEnabled(this._select.getValue()!=\"_NONE\")\n}}};\nZmEditContactViewInputSelect.prototype._createInput=function(){var a=new DwtInputField({parent:this,size:this._cols,rows:this._rows});\na.setHint(this._hint);\na.setHandler(DwtEvent.ONKEYDOWN,AjxCallback.simpleClosure(this._handleInputKeyDown,this,a));\na.setHandler(DwtEvent.ONKEYUP,AjxCallback.simpleClosure(this._handleInputKeyUp,this,a));\na.setHandler(DwtEvent.ONMOUSEDOWN,AjxCallback.simpleClosure(this._handleMouseDown,this,a));\nif(AjxEnv.isIE&&!AjxEnv.isIE9){a.setHandler(DwtEvent.ONMOUSEUP,this._handleMouseUp.bind(this,a))\n}a.setHandler(DwtEvent.ONPASTE,AjxCallback.simpleClosure(this._onPaste,this,a));\nreturn a\n};\nZmEditContactViewInputSelect.prototype._createSelect=function(c){var f=[this.getHTMLElId(),\"select\"].join(\"_\");\nvar a=new DwtSelect({parent:this,id:f});\nfor(var d=0;\nd<c.length;\nd++){var e=c[d];\nvar b=this.parent.isMaxedOut(e.value);\na.addOption(e.label||e.value,d==0&&!b,e.value);\nif(b){a.enableOption(e.value,false)\n}}return a\n};\nZmEditContactViewInputSelect.prototype.reRenderSelect=function(){if(this._select&&this._select.updateRendering){this._select.updateRendering()\n}};\nZmEditContactViewInputSelect.prototype.reRenderInput=function(){if(this._input){var a=this._input.getValue();\nif(a&&a!=\"\"){this._input.setValue(a+\" \");\nthis._input.setValue(a)\n}}};\nZmEditContactViewInputSelect.prototype._handleInputKeyDown=function(b,a){var c=b.getValue();\nb.setData(\"OLD_VALUE\",c);\nreturn true\n};\nZmEditContactViewInputSelect.prototype._handleInputKeyUp=function(b,a){var c=b.getData(\"OLD_VALUE\");\nvar d=b.getValue();\nif(c!=null&&c!=d){this.setDirty(true)\n}return true\n};\nZmEditContactViewInputSelect.prototype._handleMouseDown=function(b,a){var c=b.getValue();\nb.setData(\"OLD_VALUE\",c);\nreturn true\n};\nZmEditContactViewInputSelect.prototype._handleMouseUp=function(b,a){setTimeout(this._checkCleared.bind(this,b),0);\nreturn true\n};\nZmEditContactViewInputSelect.prototype._checkCleared=function(a){var b=a.getData(\"OLD_VALUE\");\nvar c=a.getValue();\nif(b!=null&&b!=c){this.setDirty(true)\n}};\nZmEditContactViewInputSelect.prototype._onPaste=function(b,a){var c=b.getData(\"OLD_VALUE\");\nif(c!=null){AjxTimedAction.scheduleAction(new AjxTimedAction(this,this._checkInput,[b]),100)\n}};\nZmEditContactViewInputSelect.prototype._checkInput=function(a){var b=a.getData(\"OLD_VALUE\");\nvar c=a.getValue();\nif(b!=null&&b!=c){this.setDirty(true)\n}return true\n};\nZmEditContactViewInputSelect.prototype._handleSelectChange=function(a,f){var c=a._args;\nvar e=this.parent._subtractType(c.oldValue);\nvar d=this.parent._addType(c.newValue);\nif(e||d){this.parent._adjustMaximums()\n}this.setDirty(true);\nif(this._input&&this._select){var b=this._select.getValue()!=\"_NONE\";\nthis._input.setEnabled(b);\nif(b&&!f){this._input.focus()\n}}};\nZmEditContactViewInputSelect.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nZmEditContactViewInputDoubleSelectRows=function(f){if(arguments.length==0){return\n}ZmEditContactViewInputSelectRows.apply(this,arguments);\nvar e=f.formItemDef.rowitem;\nvar d=e&&e.params;\nvar a=this._options2=(d&&d.options2)||[];\nfor(var b=0;\nb<a.length;\nb++){var c=a[b];\nif(c.max){if(!this._maximums2){this._maximums2={}\n}this._maximums2[c.value]={max:c.max,count:0}\n}}};\nZmEditContactViewInputDoubleSelectRows.prototype=new ZmEditContactViewInputSelectRows;\nZmEditContactViewInputDoubleSelectRows.prototype.constructor=ZmEditContactViewInputDoubleSelectRows;\nZmEditContactViewInputDoubleSelectRows.prototype.toString=function(){return\"ZmEditContactViewInputDoubleSelectRows\"\n};\nZmEditContactViewInputDoubleSelectRows.prototype._subtract=function(f){var e=this.getValue(f);\nvar d=this._subtractType(e&&e.type);\nvar c=this._subtractType2(e&&e.type2);\nreturn d&&c\n};\nZmEditContactViewInputDoubleSelectRows.prototype._subtractType2=function(a){if(!this._maximums2||!this._maximums2[a]){return false\n}this._maximums2[a].count--;\nreturn true\n};\nZmEditContactViewInputDoubleSelectRows.prototype._add=function(f){var e=this.getValue(f);\nvar d=this._addType(e&&e.type);\nvar c=this._addType2(e&&e.type2);\nreturn d||c\n};\nZmEditContactViewInputDoubleSelectRows.prototype._addType2=function(a){if(!this._maximums2||!this._maximums2[a]){return false\n}this._maximums2[a].count++;\nreturn true\n};\nZmEditContactViewInputDoubleSelectRows.prototype._adjustMaximums=function(){ZmEditContactViewInputSelectRows.prototype._adjustMaximums.call(this);\nif(!this._maximums2||!this._options2){return\n}var b={};\nvar f=0;\nfor(var c=0;\nc<this._options2.length;\nc++){var d=this._options2[c].value;\nvar e=this.isMaxedOut2(d);\nb[d]=!e;\nf+=e?1:0\n}var h=f==this._options2.length;\nvar a=this.getRowCount();\nfor(var c=0;\nc<a;\nc++){var g=this.getControl(c);\nif(g.enableOptions){g.enableOptions(b)\n}this.setVisible(this._items[c]._addId,!h)\n}};\nZmEditContactViewInputDoubleSelectRows.prototype._resetMaximums=function(){ZmEditContactViewInputSelectRows.prototype._resetMaximums.call(this);\nif(!this._maximums2){return\n}for(var c in this._maximums2){this._maximums2[c].count=0\n}var a=this.getRowCount();\nfor(var b=0;\nb<a;\nb++){var d=this.getValue(b);\nvar e=this._maximums2[d&&d.type2];\nif(e){e.count++\n}}};\nZmEditContactViewInputDoubleSelectRows.prototype.addRow=function(b,d){DwtFormRows.prototype.addRow.apply(this,arguments);\nd=d!=null?d:this.getRowCount()-1;\nvar h=this._add(d);\nif(h){this._adjustMaximums()\n}var g=this.getValue(d);\nvar a=false;\nif(g&&this.isMaxedOut(g.type)&&this._options.length>0&&this._maximums[g.type].count>this._maximums[g.type].max){var c=this._options;\nfor(var e=0;\ne<c.length;\ne++){var f=c[e];\nif(!this.isMaxedOut(f.value)){g.type=f.value;\na=true;\nbreak\n}}}if(g&&this.isMaxedOut2(g.type2)&&this._options2.length>0&&this._maximums2[g.type2].count>this._maximums2[g.type2].max){var c=this._options2;\nfor(var e=0;\ne<c.length;\ne++){var f=c[e];\nif(!this.isMaxedOut2(f.value)){g.type2=f.value;\na=true;\nbreak\n}}}if(a){this.setValue(d,g)\n}if(this._rowCount>=this._maxRows){for(var e=0;\ne<this._rowCount;\ne++){this.setVisible(this._items[e]._addId,false)\n}}};\nZmEditContactViewInputDoubleSelectRows.prototype.isMaxedOut2=function(a){var b=this._maximums2&&this._maximums2[a];\nreturn b!=null&&b.count>=b.max\n};\nZmEditContactViewInputDoubleSelectRows.prototype.isAllMaxedOut=function(){if(ZmEditContactViewInputSelectRows.prototype.isAllMaxedOut.call(this)){return true\n}if(!this._options2||this._options2.length==0){return false\n}var c=0;\nfor(var a=0;\na<this._options2.length;\na++){var b=this._options2[a].value;\nc+=this.isMaxedOut2(b)?1:0\n}return c>=this._options2.length\n};\nZmEditContactViewInputDoubleSelect=function(a){if(arguments.length==0){return\n}this._options2=a.options2||[];\nZmEditContactViewInputSelect.apply(this,arguments)\n};\nZmEditContactViewInputDoubleSelect.prototype=new ZmEditContactViewInputSelect;\nZmEditContactViewInputDoubleSelect.prototype.constructor=ZmEditContactViewInputDoubleSelect;\nZmEditContactViewInputDoubleSelect.prototype.toString=function(){return\"ZmEditContactViewInputDoubleSelect\"\n};\nZmEditContactViewInputDoubleSelect.prototype.TEMPLATE=\"abook.Contacts#ZmEditContactViewInputDoubleSelect\";\nZmEditContactViewInputDoubleSelect.prototype.setValue=function(c){var d=this._options.length>0;\nvar b=this._options2.length>0;\nvar a=d||b?c&&c.value:c;\nif(d&&this._select){this._select.setSelectedValue((c&&c.type)||this._options[0].value)\n}if(b&&this._select2){this._select2.setSelectedValue((c&&c.type2)||this._options2[0].value)\n}if(this._input){if(this._select||this._select2){this._input.setEnabled((this._select&&this._select.getValue()!=\"_NONE\")&&(this._select2&&this._select2.getValue()!=\"_NONE\"))\n}this._input.setValue(a||\"\")\n}};\nZmEditContactViewInputDoubleSelect.prototype.getValue=function(){var c=this._options.length>0;\nvar b=this._options2.length>0;\nvar a=this._input?this._input.getValue():\"\";\nreturn c||b?{type:this._select?this._select.getValue():\"\",type2:this._select2?this._select2.getValue():\"\",value:a}:a\n};\nZmEditContactViewInputDoubleSelect.equals=function(d,c){if(d===c){return true\n}if(!d||!c){return false\n}var f=this._options.length>0;\nvar e=this._options2.length>0;\nif(f){if(d.type!=c.type||d.value!=c.value){return false\n}}if(e){if(d.type2!=c.type2||d.value!=c.value){return false\n}}if(!f&&!e){if(d!=c){return false\n}}return true\n};\nZmEditContactViewInputDoubleSelect.prototype.enableOptions=function(a,d){if(this._select&&this._select.enableOption){var b=this.getValue().type;\nfor(var c in a){this._select.enableOption(c,c==b||a[c])\n}}if(this._select2&&this._select2.enableOption){var b=this.getValue().type2;\nfor(var c in d){this._select2.enableOption(c,c==b||d[c])\n}}};\nZmEditContactViewInputDoubleSelect.prototype._setControlIds=function(b,a){var c=this.getHTMLElId();\nthis._setControlId(this,c+\"_value\");\nthis._setControlId(this._input,c);\nthis._setControlId(this._select,c+\"_select\");\nthis._setControlId(this._select2,c+\"_select2\")\n};\nZmEditContactViewInputDoubleSelect.prototype._setControlId=DwtFormRows.prototype._setControlId;\nZmEditContactViewInputDoubleSelect.prototype._createHtmlFromTemplate=function(b,e){DwtComposite.prototype._createHtmlFromTemplate.apply(this,arguments);\nvar a=this._tabIndexes;\nvar f=document.getElementById(e.id+\"_input\");\nif(f){this._input=this._createInput();\nthis._input.replaceElement(f);\nif(f.getAttribute(\"notab\")!=\"true\"){a.push({tabindex:f.getAttribute(\"tabindex\")||Number.MAX_VALUE,control:this._input})\n}}var h=document.getElementById(e.id+\"_select\");\nvar g=this._options.length>0;\nif(g&&h){this._select=this._createSelect(this._options);\nthis._select.addChangeListener(new AjxListener(this,this._handleSelectChange));\nthis._select.replaceElement(h);\nif(h.getAttribute(\"notab\")!=\"true\"){a.push({tabindex:h.getAttribute(\"tabindex\")||Number.MAX_VALUE,control:this._select})\n}this._select.setVisible(this._options.length>1)\n}var c=document.getElementById(e.id+\"_select2\");\nvar d=this._options2.length>0;\nif(d&&c){this._select2=this._createSelect2(this._options2);\nthis._select2.addChangeListener(new AjxListener(this,this._handleSelectChange2));\nthis._select2.replaceElement(c);\nif(c.getAttribute(\"notab\")!=\"true\"){a.push({tabindex:h.getAttribute(\"tabindex\")||Number.MAX_VALUE,control:this._select2})\n}this._select2.setVisible(this._options2.length>1)\n}if(this._input){if(this._select||this._select2){this._input.setEnabled((this._select&&this._select.getValue()!=\"_NONE\")&&(this._select2&&this._select2.getValue()!=\"_NONE\"))\n}}};\nZmEditContactViewInputDoubleSelect.prototype._createSelect2=function(b){var e=[this.getHTMLElId(),\"select2\"].join(\"_\");\nvar a=new DwtSelect({parent:this,id:e});\nfor(var c=0;\nc<b.length;\nc++){var d=b[c];\na.addOption(d.label||d.value,c==0,d.value)\n}return a\n};\nZmEditContactViewInputDoubleSelect.prototype.reRenderSelect=function(){ZmEditContactViewInputSelect.prototype.reRenderSelect.call(this);\nthis._select2.updateRendering()\n};\nZmEditContactViewInputDoubleSelect.prototype._handleSelectChange=function(a,f){var c=a._args;\nvar e=this.parent._subtractType(c.oldValue);\nvar d=this.parent._addType(c.newValue);\nif(e||d){this.parent._adjustMaximums()\n}this.setDirty(true);\nif(this._input){var b=this._select.getValue()!=\"_NONE\"&&this._select2.getValue()!=\"_NONE\";\nthis._input.setEnabled(b);\nif(b&&!f){this._input.focus()\n}}};\nZmEditContactViewInputDoubleSelect.prototype._handleSelectChange2=function(a,f){var c=a._args;\nvar e=this.parent._subtractType2(c.oldValue);\nvar d=this.parent._addType2(c.newValue);\nif(e||d){this.parent._adjustMaximums()\n}this.setDirty(true);\nif(this._input){var b=this._select.getValue()!=\"_NONE\"&&this._select2.getValue()!=\"_NONE\";\nthis._input.setEnabled(b);\nif(b&&!f){this._input.focus()\n}}};\nZmEditContactViewOther=function(b){if(arguments.length==0){return\n}ZmEditContactViewInputSelect.apply(this,arguments);\nvar a=b.options&&b.options[0];\nthis.setValue({type:a&&a.value});\nif(this._select&&(b.selectInputWidth||b.selectInputHeight)){Dwt.setSize(this._select.input,b.selectInputWidth,b.selectInputHeight)\n}};\nZmEditContactViewOther.prototype=new ZmEditContactViewInputSelect;\nZmEditContactViewOther.prototype.constructor=ZmEditContactViewOther;\nZmEditContactViewOther.prototype.toString=function(){return\"ZmEditContactViewOther\"\n};\nZmEditContactViewOther.prototype.TEMPLATE=\"abook.Contacts#ZmEditContactViewOther\";\nZmEditContactViewOther.prototype.DATE_ATTRS={birthday:true,anniversary:true};\nZmEditContactViewOther.validator=function(d){if(AjxUtil.isArray(d)){if(!d.length){return true\n}var a=[];\nfor(var c=0;\nc<d.length;\nc++){var e=ZmEditContactViewOther.validator(d[c]);\nif(e||e===\"\"){a.push({type:d[c].type,value:e})\n}else{return false\n}}return a\n}else{if(d.type in ZmEditContactViewOther.prototype.DATE_ATTRS||d.type.replace(/^other/,\"\").toLowerCase() in ZmEditContactViewOther.prototype.DATE_ATTRS){var b=AjxStringUtil.trim(d.value);\nif(b.length){var f=ZmEditContactViewOther.parseDate(b);\nif(isNaN(f)||f==null){throw ZmMsg.errorDate\n}return ZmEditContactViewOther.formatDate(f)\n}return b\n}if(/\\d+$/.test(d.type)){throw AjxMessageFormat.format(ZmMsg.errorInvalidContactOtherFieldName,d.type)\n}return d.value\n}};\nZmEditContactViewOther.prototype.setValue=function(a){ZmEditContactViewInputSelect.prototype.setValue.apply(this,arguments);\nthis._resetPicker()\n};\nZmEditContactViewOther.prototype.getValue=function(){return{type:this._select.getValue()||this._select.getText(),value:this._input.getValue()}\n};\nZmEditContactViewOther.prototype._setControlIds=function(b,a){var c=this.getHTMLElId();\nZmEditContactViewInputSelect.prototype._setControlIds.apply(this,arguments);\nthis._setControlId(this._picker,c+\"_picker\")\n};\nZmEditContactViewOther.prototype._createHtmlFromTemplate=function(d,h){ZmEditContactViewInputSelect.prototype._createHtmlFromTemplate.apply(this,arguments);\nvar e=this._tabIndexes;\nvar j=document.getElementById(h.id+\"_picker\");\nif(j){var b=[this.getHTMLElId(),\"picker\"].join(\"_\");\nthis._picker=new DwtButton({parent:this,id:b});\nthis._picker.setImage(\"CalendarApp\",null,ZmMsg.chooseDate);\nthis._picker.popup=ZmEditContactViewOther.__DwtButton_popup;\nvar c=new DwtMenu({parent:this._picker,style:DwtMenu.GENERIC_WIDGET_STYLE});\nthis._picker.getHtmlElement().className+=\" ZmEditContactViewOtherCalendar\";\nthis._picker.setMenu(c);\nthis._picker.replaceElement(j);\nvar f=new AjxListener(this,this._handleDropDown);\nthis._picker.addSelectionListener(f);\nthis._picker.addDropDownSelectionListener(f);\nvar a=new DwtComposite({parent:c});\nvar g=new DwtCalendar({parent:a});\ng.setSkipNotifyOnPage(true);\ng.setDate(new Date());\ng.setFirstDayOfWeek(appCtxt.get(ZmSetting.CAL_FIRST_DAY_OF_WEEK)||0);\ng.addSelectionListener(new AjxListener(this,this._handleDateSelection,[g]));\ne.push({tabindex:j.getAttribute(\"tabindex\")||Number.MAX_VALUE,control:this._picker});\nthis._calendar=g;\nvar i=new DwtCheckbox({parent:a});\ni.setText(ZmMsg.includeYear);\ni.addSelectionListener(new AjxListener(this,this._handleDateSelection,[g]));\nthis._calendarIncludeYear=i\n}};\nZmEditContactViewOther.__DwtButton_popup=function(){var e=this;\nvar d=e.getSize();\nvar a=Dwt.toWindow(e.getHtmlElement(),0,0);\nvar f=e.getMenu();\nvar c=f.getSize();\nvar b=DwtShell.getShell(window).getSize();\nif((a.y+d.y)+c.y>b.y){e._menuPopupStyle=DwtButton.MENU_POPUP_STYLE_ABOVE\n}if(AjxEnv.isIE){f.getHtmlElement().style.width=\"150px\"\n}DwtButton.prototype.popup.call(e,f)\n};\nZmEditContactViewOther.prototype._createSelect=function(){var e=[this.getHTMLElId(),\"select\"].join(\"_\");\nvar a=new DwtComboBox({parent:this,inputParams:{size:14},id:e});\nvar b=this._options||[];\nfor(var c=0;\nc<b.length;\nc++){var d=b[c];\na.add(d.label||d.value,d.value,c==0)\n}a.addChangeListener(new AjxListener(this,this._resetPicker));\na.setSelectedValue=a.setValue;\nreturn a\n};\nZmEditContactViewOther.prototype._resetPicker=function(){if(this._picker){var a=this.getValue().type;\nthis._picker.setVisible(a in this.DATE_ATTRS)\n}};\nZmEditContactViewOther.parseDate=function(a){var d=a.match(/^--/);\nvar b=d?\"--MM-dd\":\"yyyy-MM-dd\";\nvar c=AjxDateFormat.parse(b,a);\nif(isNaN(c)||c==null){c=AjxDateUtil.simpleParseDateStr(a)\n}else{if(d){c.setFullYear(0)\n}}return c\n};\nZmEditContactViewOther.formatDate=function(a){var b=a.getFullYear()==0?\"--MM-dd\":\"yyyy-MM-dd\";\nreturn AjxDateFormat.format(b,a)\n};\nZmEditContactViewOther._getDateFormatter=function(){if(!ZmEditContactViewOther._formatter){ZmEditContactViewOther._formatter=new AjxDateFormat(\"yyyy-MM-dd\")\n}return ZmEditContactViewOther._formatter\n};\nZmEditContactViewOther.prototype._handleDropDown=function(a){var d=this.getValue().value;\nvar b=ZmEditContactViewOther.parseDate(d)||new Date();\nvar c=b.getFullYear()!==0;\nif(!c){b.setFullYear(new Date().getFullYear())\n}this._calendarIncludeYear.setSelected(c);\nthis._calendar.setDate(b);\nthis._picker.popup()\n};\nZmEditContactViewOther.prototype._handleDateSelection=function(c){this._picker.getMenu().popdown();\nif(!c){c=this._calendar\n}var a=c.getDate();\nif(!this._calendarIncludeYear.isSelected()){a=new Date(a.getTime());\na.setFullYear(0)\n}var b=this.getValue();\nb.value=ZmEditContactViewOther.formatDate(a);\nthis.setValue(b);\nthis.parent.setDirty(true)\n};\nZmEditContactViewOther.prototype._handleSelectChange=function(a){ZmEditContactViewInputSelect.prototype._handleSelectChange.call(this,a,true)\n};\nZmEditContactViewIM=function(a){if(arguments.length==0){return\n}ZmEditContactViewInputSelect.apply(this,arguments)\n};\nZmEditContactViewIM.prototype=new ZmEditContactViewInputSelect;\nZmEditContactViewIM.prototype.constructor=ZmEditContactViewIM;\nZmEditContactViewIM.prototype.toString=function(){return\"ZmEditContactViewIM\"\n};\nZmEditContactViewIM.RE_VALUE=/^(.*?):\\/\\/(.*)$/;\nZmEditContactViewIM.prototype.setValue=function(b){var a=ZmEditContactViewIM.RE_VALUE.exec(b);\nb=a?{type:a[1],value:a[2]}:{type:\"xmpp\",value:b};\nZmEditContactViewInputSelect.prototype.setValue.call(this,b)\n};\nZmEditContactViewIM.prototype.getValue=function(){var a=ZmEditContactViewInputSelect.prototype.getValue.call(this);\nreturn a.value?[a.type,a.value].join(\"://\"):\"\"\n};\nZmEditContactViewIMDouble=function(a){if(arguments.length==0){return\n}ZmEditContactViewInputDoubleSelect.apply(this,arguments)\n};\nZmEditContactViewIMDouble.prototype=new ZmEditContactViewInputDoubleSelect;\nZmEditContactViewIMDouble.prototype.constructor=ZmEditContactViewIMDouble;\nZmEditContactViewIMDouble.prototype.toString=function(){return\"ZmEditContactViewIMDouble\"\n};\nZmEditContactViewIMDouble.RE_VALUE=/^(.*?):\\/\\/(.*)$/;\nZmEditContactViewIMDouble.prototype.setValue=function(c){var d;\nif(!c||c==\"\"){d={type2:\"_NONE\",value:\"\",type:null}\n}else{var b=c.type?c.value:c;\nvar a=ZmEditContactViewIMDouble.RE_VALUE.exec(b);\nd=a?{type2:a[1],value:a[2],type:c.type?c.type:null}:{type2:c.type2||\"other\",value:b,type:c.type?c.type:null}\n}ZmEditContactViewInputDoubleSelect.prototype.setValue.call(this,d)\n};\nZmEditContactViewIMDouble.prototype.getValue=function(){var b=ZmEditContactViewInputDoubleSelect.prototype.getValue.call(this);\nvar a=(b.type2==\"_NONE\"||b.value==\"\")?\"\":[b.type2,b.value].join(\"://\");\nvar c=b.type2?{type:b.type,type2:b.type2,value:a}:a;\nreturn c\n};\nZmEditContactViewIMDouble.equals=function(d,c){if(d===c){return true\n}if(!d||!c){return false\n}return d.type==c.type&&d.type2==c.type2&&d.value==c.value\n};\nZmEditContactViewAddress=function(a){if(arguments.length==0){return\n}ZmEditContactViewInputSelect.call(this,a)\n};\nZmEditContactViewAddress.prototype=new ZmEditContactViewInputSelect;\nZmEditContactViewAddress.prototype.constructor=ZmEditContactViewAddress;\nZmEditContactViewAddress.prototype.toString=function(){return\"ZmEditContactViewAddress\"\n};\nZmEditContactViewAddress.prototype.TEMPLATE=\"abook.Contacts#ZmEditContactViewAddressSelect\";\nZmEditContactViewAddress.prototype.setValue=function(a){ZmEditContactViewInputSelect.prototype.setValue.apply(this,arguments);\na=a||{};\nthis._select.setSelectedValue(a.type);\nthis._input.setValue(\"STREET\",a.Street);\nthis._input.setValue(\"CITY\",a.City);\nthis._input.setValue(\"STATE\",a.State);\nthis._input.setValue(\"ZIP\",a.PostalCode);\nthis._input.setValue(\"COUNTRY\",a.Country);\nthis._input.setDirty(false);\nthis._input.update()\n};\nZmEditContactViewAddress.prototype.getValue=function(){return{type:this._select.getValue(),Street:this._input.getValue(\"STREET\"),City:this._input.getValue(\"CITY\"),State:this._input.getValue(\"STATE\"),PostalCode:this._input.getValue(\"ZIP\"),Country:this._input.getValue(\"COUNTRY\")}\n};\nZmEditContactViewAddress.equals=function(d,c){if(d===c){return true\n}if(!d||!c){return false\n}return d.type==c.type&&d.Street==c.Street&&d.City==c.City&&d.State==c.State&&d.PostalCode==c.PostalCode&&d.Country==c.Country\n};\nZmEditContactViewAddress.prototype._setControlIds=function(f,c){var g=this.getHTMLElId();\nZmEditContactViewInputSelect.prototype._setControlIds.apply(this,arguments);\nvar b=[\"STREET\",\"CITY\",\"STATE\",\"ZIP\",\"COUNTRY\"];\nfor(var d=0;\nd<b.length;\nd++){var a=b[d];\nvar e=this._input.getControl(a);\nthis._setControlId.call(e,e,[g,a].join(\"_\"))\n}};\nZmEditContactViewAddress.prototype._createInput=function(){var a={template:\"abook.Contacts#ZmEditContactViewAddress\",ondirty:\"this.parent._handleDirty()\",items:[{id:\"STREET\",type:\"DwtInputField\",width:343,rows:2,hint:ZmMsg.AB_FIELD_street,params:{forceMultiRow:true}},{id:\"CITY\",type:\"DwtInputField\",width:160,hint:ZmMsg.AB_FIELD_city},{id:\"STATE\",type:\"DwtInputField\",width:90,hint:ZmMsg.AB_FIELD_state},{id:\"ZIP\",type:\"DwtInputField\",width:80,hint:ZmMsg.AB_FIELD_postalCode},{id:\"COUNTRY\",type:\"DwtInputField\",width:343,hint:ZmMsg.AB_FIELD_country}]};\nreturn new DwtForm({parent:this,form:a})\n};\nZmEditContactViewAddress.prototype._handleDirty=function(){if(this._input&&this._input.isDirty()){this.parent.setDirty(true)\n}}\n}if(AjxPackage.define(\"zimbraMail.abook.view.ZmGroupView\")){ZmGroupView=function(b,a){if(arguments.length==0){return\n}DwtComposite.call(this,{parent:b,className:\"ZmContactView\",posStyle:DwtControl.ABSOLUTE_STYLE});\nthis.setScrollStyle(Dwt.CLIP);\nthis._controller=a;\nthis._view=ZmId.VIEW_GROUP;\nthis._tagList=appCtxt.getTagTree();\nthis._tagList.addChangeListener(new AjxListener(this,this._tagChangeListener));\nthis._changeListener=new AjxListener(this,this._groupChangeListener);\nthis._detailedSearch=appCtxt.get(ZmSetting.DETAILED_CONTACT_SEARCH_ENABLED);\nthis._ascending=true;\nthis._emailList=new AjxVector();\nthis._includeContactsWithNoEmail=true;\nthis._groupMemberMods={};\nthis._tabGroup=new DwtTabGroup(this._htmlElId)\n};\nZmGroupView.prototype=new DwtComposite;\nZmGroupView.prototype.constructor=ZmGroupView;\nZmGroupView.prototype.isZmGroupView=true;\nZmGroupView.prototype.toString=function(){return\"ZmGroupView\"\n};\nZmGroupView.DIALOG_X=50;\nZmGroupView.DIALOG_Y=100;\nZmGroupView.MAIL_POLICY_ANYONE=\"ANYONE\";\nZmGroupView.MAIL_POLICY_MEMBERS=\"MEMBERS\";\nZmGroupView.MAIL_POLICY_INTERNAL=\"INTERNAL\";\nZmGroupView.MAIL_POLICY_SPECIFIC=\"SPECIFIC\";\nZmGroupView.GRANTEE_TYPE_USER=\"usr\";\nZmGroupView.GRANTEE_TYPE_GUEST=\"gst\";\nZmGroupView.GRANTEE_TYPE_EMAIL=\"email\";\nZmGroupView.GRANTEE_TYPE_GROUP=\"grp\";\nZmGroupView.GRANTEE_TYPE_ALL=\"all\";\nZmGroupView.GRANTEE_TYPE_PUBLIC=\"pub\";\nZmGroupView.GRANTEE_TYPE_TO_MAIL_POLICY_MAP=[];\nZmGroupView.GRANTEE_TYPE_TO_MAIL_POLICY_MAP[ZmGroupView.GRANTEE_TYPE_USER]=ZmGroupView.MAIL_POLICY_SPECIFIC;\nZmGroupView.GRANTEE_TYPE_TO_MAIL_POLICY_MAP[ZmGroupView.GRANTEE_TYPE_GUEST]=ZmGroupView.MAIL_POLICY_SPECIFIC;\nZmGroupView.GRANTEE_TYPE_TO_MAIL_POLICY_MAP[ZmGroupView.GRANTEE_TYPE_GROUP]=ZmGroupView.MAIL_POLICY_MEMBERS;\nZmGroupView.GRANTEE_TYPE_TO_MAIL_POLICY_MAP[ZmGroupView.GRANTEE_TYPE_ALL]=ZmGroupView.MAIL_POLICY_INTERNAL;\nZmGroupView.GRANTEE_TYPE_TO_MAIL_POLICY_MAP[ZmGroupView.GRANTEE_TYPE_PUBLIC]=ZmGroupView.MAIL_POLICY_ANYONE;\nZmGroupView.prototype.getList=function(){return null\n};\nZmGroupView.prototype.getContact=function(){return this._contact\n};\nZmGroupView.prototype.getController=function(){return this._controller\n};\nZmGroupView.prototype.getSelection=function(){return this.getContact()\n};\nZmGroupView.prototype.getSelectionCount=function(){return 1\n};\nZmGroupView.prototype.isDistributionList=function(){return this._contact.isDistributionList()\n};\nZmGroupView.prototype.set=function(a,b){this._attr={};\nif(this._contact){this._contact.removeChangeListener(this._changeListener)\n}a.addChangeListener(this._changeListener);\nthis._contact=this._item=a;\nif(!this._htmlInitialized){this._createHtml();\nthis._addWidgets();\nthis._installKeyHandlers();\nthis._tabGroup.addMember(this._getTabGroupMembers())\n}this._setFields();\nthis._emailListOffset=0;\nthis._isDirty=b;\nif(a.isDistributionList()){if(this._usernameEditable){this._groupNameInput.addListener(DwtEvent.ONBLUR,this._controller.updateTabTitle.bind(this._controller))\n}if(this._domainEditable){document.getElementById(this._groupNameDomainId).onblur=this._controller.updateTabTitle.bind(this._controller)\n}}else{this._groupNameInput.addListener(DwtEvent.ONBLUR,this._controller.updateTabTitle.bind(this._controller))\n}this.search(null,null,true)\n};\nZmGroupView.prototype.postShow=function(){if(this._contact.isDistributionList()){this._dlMembersTabView.showMe()\n}};\nZmGroupView.prototype.getModifiedAttrs=function(){if(!this.isDirty()){return null\n}var d=this._attr=[];\nvar e=this._getGroupName();\nvar a=this._getFolderId();\nif(this.isDistributionList()){var b=this._contact.dlInfo;\nif(e!=this._contact.getEmail()){d[ZmContact.F_email]=e\n}if(b.displayName!=this._getDlDisplayName()){d[ZmContact.F_dlDisplayName]=this._getDlDisplayName()\n}if(b.description!=this._getDlDesc()){d[ZmContact.F_dlDesc]=this._getDlDesc()\n}if(b.hideInGal!=this._getDlHideInGal()){d[ZmContact.F_dlHideInGal]=this._getDlHideInGal()?\"TRUE\":\"FALSE\"\n}if(b.notes!=this._getDlNotes()){d[ZmContact.F_dlNotes]=this._getDlNotes()\n}if(b.subscriptionPolicy!=this._getDlSubscriptionPolicy()){d[ZmContact.F_dlSubscriptionPolicy]=this._getDlSubscriptionPolicy()\n}if(b.unsubscriptionPolicy!=this._getDlUnsubscriptionPolicy()){d[ZmContact.F_dlUnsubscriptionPolicy]=this._getDlUnsubscriptionPolicy()\n}if(!AjxUtil.arrayCompare(b.owners,this._getDlOwners())){d[ZmContact.F_dlListOwners]=this._getDlOwners()\n}if(b.mailPolicy!=this._getDlMailPolicy()||(this._getDlMailPolicy()==ZmGroupView.MAIL_POLICY_SPECIFIC&&!AjxUtil.arrayCompare(b.mailPolicySpecificMailers,this._getDlSpecificMailers()))){d[ZmContact.F_dlMailPolicy]=this._getDlMailPolicy();\nd[ZmContact.F_dlMailPolicySpecificMailers]=this._getDlSpecificMailers()\n}if(this._groupMemberMods){d[ZmContact.F_groups]=this._getModifiedMembers();\nthis._groupMemberMods={}\n}return d\n}if(this._contact.id==null||(this._contact.isGal&&!this.isDistributionList())){d[ZmContact.F_folderId]=a;\nd[ZmContact.F_fileAs]=ZmContact.computeCustomFileAs(e);\nd[ZmContact.F_nickname]=e;\nd[ZmContact.F_groups]=this._getGroupMembers();\nd[ZmContact.F_type]=\"group\"\n}else{if(!this.isDistributionList()&&this._contact.getFileAs()!=e){d[ZmContact.F_fileAs]=ZmContact.computeCustomFileAs(e);\nd[ZmContact.F_nickname]=e\n}if(this._groupMemberMods){d[ZmContact.F_groups]=this._getModifiedMembers();\nthis._groupMemberMods={}\n}var c=this._contact.addrbook?this._contact.addrbook.id:ZmFolder.ID_CONTACTS;\nif(a!=c){d[ZmContact.F_folderId]=a\n}}return d\n};\nZmGroupView.prototype._getModifiedMembers=function(){var a=[];\nfor(var b in this._groupMemberMods){if(this._groupMemberMods[b].op){a.push(this._groupMemberMods[b])\n}}return a\n};\nZmGroupView.prototype._getFullName=function(){return this._getGroupName()\n};\nZmGroupView.prototype._getGroupDomainName=function(){if(this.isDistributionList()){return this._domainEditable?AjxStringUtil.trim(document.getElementById(this._groupNameDomainId).value):this._emailDomain\n}return AjxStringUtil.trim(document.getElementById(this._groupNameDomainId).value)\n};\nZmGroupView.prototype._getGroupName=function(){if(this.isDistributionList()){var a=this._getDlAddressLocalPart();\nreturn a+\"@\"+this._getGroupDomainName()\n}return AjxStringUtil.trim(this._groupNameInput.getValue())\n};\nZmGroupView.prototype._getDlAddressLocalPart=function(){return this._usernameEditable?AjxStringUtil.trim(this._groupNameInput.getValue()):this._emailUsername\n};\nZmGroupView.prototype._getDlDisplayName=function(){return AjxStringUtil.trim(document.getElementById(this._dlDisplayNameId).value)\n};\nZmGroupView.prototype._getDlDesc=function(){return AjxStringUtil.trim(document.getElementById(this._dlDescId).value)\n};\nZmGroupView.prototype._getDlNotes=function(){return AjxStringUtil.trim(document.getElementById(this._dlNotesId).value)\n};\nZmGroupView.prototype._getDlHideInGal=function(){return document.getElementById(this._dlHideInGalId).checked\n};\nZmGroupView.prototype._getDlSpecificMailers=function(){return this._getUserList(this._dlListSpecificMailersId)\n};\nZmGroupView.prototype._getDlOwners=function(){return this._getUserList(this._dlListOwnersId)\n};\nZmGroupView.prototype._getUserList=function(e){var d=AjxStringUtil.trim(document.getElementById(e).value).split(\";\");\nvar a=[];\nfor(var c=0;\nc<d.length;\nc++){var b=AjxStringUtil.trim(d[c]);\nif(b!=\"\"){a.push(b)\n}}return a\n};\nZmGroupView.prototype._getDlSubscriptionPolicy=function(){return this._getDlPolicy(this._dlSubscriptionPolicyId,this._subsPolicyOpts)\n};\nZmGroupView.prototype._getDlUnsubscriptionPolicy=function(){return this._getDlPolicy(this._dlUnsubscriptionPolicyId,this._subsPolicyOpts)\n};\nZmGroupView.prototype._getDlMailPolicy=function(){return this._getDlPolicy(this._dlMailPolicyId,this._mailPolicyOpts)\n};\nZmGroupView.prototype._getDlPolicy=function(d,c){for(var b=0;\nb<c.length;\nb++){var a=c[b];\nif(document.getElementById(d[a]).checked){return a\n}}};\nZmGroupView.prototype.isEmpty=function(a){var c=this._getGroupName();\nvar b=(this._groupMembersListView.getList()&&this._groupMembersListView.getList().size()>0);\nreturn a?(c==\"\"||!b):(c==\"\"&&!b)\n};\nZmGroupView.prototype.isValidDlName=function(){if(!this.isDistributionList()){return true\n}if(!this._usernameEditable){return true\n}var a=this._getDlAddressLocalPart();\nreturn AjxEmailAddress.accountPat.test(a)\n};\nZmGroupView.prototype.isValidDlDomainName=function(){if(!this.isDistributionList()){return true\n}if(!this._domainEditable){return true\n}var a=this._getGroupDomainName();\nreturn this._allowedDomains[a]\n};\nZmGroupView.prototype.isValidOwners=function(){if(!this.isDistributionList()){return true\n}return this._getDlOwners().length>0\n};\nZmGroupView.prototype.isValidMailPolicy=function(){if(!this.isDistributionList()){return true\n}return this._getDlMailPolicy()!=ZmGroupView.MAIL_POLICY_SPECIFIC||this._getDlSpecificMailers().length>0\n};\nZmGroupView.prototype.isValid=function(){if(this.isDirty()&&this.isEmpty(true)){return false\n}if(!this.isValidDlName()){return false\n}if(!this.isValidDlDomainName()){return false\n}if(!this.isValidOwners()){return false\n}if(!this.isValidMailPolicy()){return false\n}return true\n};\nZmGroupView.prototype.getInvalidItems=function(){if(this.isValid()){return[]\n}var a=[];\nif(!this.isValidDlName()){a.push(\"dlName\")\n}if(this.isEmpty(true)){a.push(\"members\")\n}if(!this.isValidDlDomainName()){a.push(\"dlDomainName\")\n}if(!this.isValidOwners()){a.push(\"owners\")\n}if(!this.isValidMailPolicy()){a.push(\"mailPolicy\")\n}return a\n};\nZmGroupView.prototype.getErrorMessage=function(a){if(this.isValid()){return null\n}if(a==\"members\"){return this.isDistributionList()?ZmMsg.errorMissingDlMembers:ZmMsg.errorMissingGroup\n}if(a==\"dlName\"){return ZmMsg.dlInvalidName\n}if(a==\"dlDomainName\"){return ZmMsg.dlInvalidDomainName\n}if(a==\"owners\"){return ZmMsg.dlInvalidOwners\n}if(a==\"mailPolicy\"){return ZmMsg.dlInvalidMailPolicy\n}};\nZmGroupView.prototype.enableInputs=function(b){if(this.isDistributionList()){if(this._usernameEditable){document.getElementById(this._groupNameId).disabled=!b\n}if(this._domainEditable){document.getElementById(this._groupNameDomainId).disabled=!b\n}document.getElementById(this._dlDisplayNameId).disabled=!b;\ndocument.getElementById(this._dlDescId).disabled=!b;\ndocument.getElementById(this._dlHideInGalId).disabled=!b;\ndocument.getElementById(this._dlNotesId).disabled=!b;\nfor(var d=0;\nd<this._subsPolicyOpts.length;\nd++){var c=this._subsPolicyOpts[d];\ndocument.getElementById(this._dlSubscriptionPolicyId[c]).disabled=!b;\ndocument.getElementById(this._dlUnsubscriptionPolicyId[c]).disabled=!b\n}document.getElementById(this._dlListOwnersId).disabled=!b\n}else{document.getElementById(this._groupNameId).disabled=!b\n}if(!this._noManualEntry){this._groupMembers.disabled=!b\n}for(var a in this._searchField){this._searchField[a].disabled=!b\n}};\nZmGroupView.prototype.isDirty=function(){return this._isDirty\n};\nZmGroupView.prototype.getTitle=function(){return[ZmMsg.zimbraTitle,this.isDistributionList()?ZmMsg.distributionList:ZmMsg.group].join(\": \")\n};\nZmGroupView.prototype.setSize=function(b,a){DwtComposite.prototype.setSize.call(this,b,a)\n};\nZmGroupView.prototype.setBounds=function(h,g,b,j){DwtComposite.prototype.setBounds.call(this,h,g,b,j);\nif(this._addNewField){Dwt.setSize(this._addNewField,Dwt.DEFAULT,50)\n}this._groupMembersListView.setSize(Dwt.DEFAULT,j-150);\nvar e=Dwt.getSize(this._headerRow).y;\nvar f=this._tabBar?Dwt.getSize(this._tabBar).y:0;\nvar i=Dwt.getSize(this._searchFieldsRow).y;\nvar a=Dwt.getSize(this._manualAddRow).y;\nvar c=Dwt.getSize(this._navButtonsRow).y;\nvar d=j-e-f-i-a-c-40;\nthis._listview.setSize(Dwt.DEFAULT,d)\n};\nZmGroupView.prototype.cleanup=function(){for(var a in this._searchField){this._searchField[a].value=\"\"\n}this._listview.removeAll(true);\nthis._groupMembersListView.removeAll(true);\nthis._addButton.setEnabled(false);\nthis._addAllButton.setEnabled(false);\nthis._prevButton.setEnabled(false);\nthis._nextButton.setEnabled(false);\nif(this._addNewField){this._addNewField.value=\"\"\n}};\nZmGroupView.prototype._setFields=function(){if(appCtxt.isOffline&&appCtxt.accountList.size()>1&&this._searchInSelect){this._searchInSelect.clearOptions();\nthis._resetSearchInSelect()\n}this._setGroupName();\nif(this.isDistributionList()){this._setDlFields()\n}this._setGroupMembers();\nthis._setTags()\n};\nZmGroupView.prototype._setTitle=function(b){var c=document.getElementById(this._titleId);\nvar a=b||this._contact.getFileAs();\nc.innerHTML=AjxStringUtil.htmlEncode(a)||(this._contact.id?\"&nbsp;\":ZmMsg.newGroup)\n};\nZmGroupView.prototype._getTagCell=function(){return document.getElementById(this._tagsId)\n};\nZmGroupView.prototype.getSearchFieldValue=function(a){if(!a&&!this._detailedSearch){a=ZmContactPicker.SEARCH_BASIC\n}var b=this._searchField[a];\nreturn b&&AjxStringUtil.trim(b.value)||\"\"\n};\nZmGroupView.prototype._createHtml=function(){this._headerRowId=this._htmlElId+\"_headerRow\";\nthis._titleId=this._htmlElId+\"_title\";\nthis._tagsId=this._htmlElId+\"_tags\";\nthis._groupNameId=this._htmlElId+\"_groupName\";\nif(this.isDistributionList()){this._groupNameDomainId=this._htmlElId+\"_groupNameDomain\";\nthis._allowedDomains=appCtxt.createDistListAllowedDomainsMap;\nthis._emailDomain=appCtxt.createDistListAllowedDomains[0];\nthis._emailUsername=\"\";\nvar h=this._contact.getEmail();\nif(h){var k=h.split(\"@\");\nthis._emailUsername=k[0];\nthis._emailDomain=k[1]\n}var d=!h;\nvar f=appCtxt.createDistListAllowedDomains.length;\nthis._domainEditable=(f>1)&&(d||this._allowedDomains[this._emailDomain]);\nthis._usernameEditable=d||this._allowedDomains[this._emailDomain];\nthis._dlDisplayNameId=this._htmlElId+\"_dlDisplayName\";\nthis._dlDescId=this._htmlElId+\"_dlDesc\";\nthis._dlHideInGalId=this._htmlElId+\"_dlHideInGal\";\nthis._dlNotesId=this._htmlElId+\"_dlNotes\";\nthis._subsPolicyOpts=[ZmContactSplitView.SUBSCRIPTION_POLICY_ACCEPT,ZmContactSplitView.SUBSCRIPTION_POLICY_APPROVAL,ZmContactSplitView.SUBSCRIPTION_POLICY_REJECT];\nthis._dlSubscriptionPolicyId={};\nthis._dlUnsubscriptionPolicyId={};\nfor(var g=0;\ng<this._subsPolicyOpts.length;\ng++){var c=this._subsPolicyOpts[g];\nthis._dlSubscriptionPolicyId[c]=this._htmlElId+\"_dlSubscriptionPolicy\"+c;\nthis._dlUnsubscriptionPolicyId[c]=this._htmlElId+\"_dlUnsubscriptionPolicy\"+c\n}this._mailPolicyOpts=[ZmGroupView.MAIL_POLICY_ANYONE,ZmGroupView.MAIL_POLICY_MEMBERS,ZmGroupView.MAIL_POLICY_INTERNAL,ZmGroupView.MAIL_POLICY_SPECIFIC];\nthis._dlMailPolicyId={};\nfor(g=0;\ng<this._mailPolicyOpts.length;\ng++){c=this._mailPolicyOpts[g];\nthis._dlMailPolicyId[c]=this._htmlElId+\"_dlMailPolicy\"+c\n}this._dlListSpecificMailersId=this._htmlElId+\"_dlListSpecificMailers\";\nthis._dlListOwnersId=this._htmlElId+\"_dlListOwners\";\nvar e={dataClass:appCtxt.getAutocompleter(),matchValue:ZmAutocomplete.AC_VALUE_EMAIL,keyUpCallback:ZmGroupView._onKeyUp,contextId:this.toString()};\nthis._acAddrSelectList=new ZmAutocompleteListView(e);\nif(appCtxt.multiAccounts){var j=object.account||appCtxt.accountList.mainAccount;\nthis._acAddrSelectList.setActiveAccount(j)\n}}this._searchFieldId=this._htmlElId+\"_searchField\";\nvar b=false;\nif(appCtxt.get(ZmSetting.CONTACTS_ENABLED)){if(appCtxt.get(ZmSetting.GAL_ENABLED)||appCtxt.get(ZmSetting.SHARING_ENABLED)){b=true\n}}var e=this._templateParams={id:this._htmlElId,showSearchIn:b,detailed:this._detailedSearch,contact:this._contact,isEdit:true,usernameEditable:this._usernameEditable,domainEditable:this._domainEditable,username:this._emailUsername,domain:this._emailDomain,addrbook:this._contact.getAddressBook()};\nif(this.isDistributionList()){this.getHtmlElement().innerHTML=AjxTemplate.expand(\"abook.Contacts#DlView\",e);\nthis._tabViewContainerId=this._htmlElId+\"_tabViewContainer\";\nvar a=document.getElementById(this._tabViewContainerId);\nthis._tabView=new DwtTabView({parent:this,posStyle:Dwt.STATIC_STYLE,id:this._htmlElId+\"_tabView\"});\nthis._tabView.reparentHtmlElement(a);\nthis._dlMembersTabView=new ZmDlMembersTabView(this);\nthis._tabView.addTab(ZmMsg.dlMembers,this._dlMembersTabView);\nthis._dlPropertiesTabView=new ZmDlPropertiesTabView(this);\nthis._tabView.addTab(ZmMsg.dlProperties,this._dlPropertiesTabView)\n}else{this.getHtmlElement().innerHTML=AjxTemplate.expand(\"abook.Contacts#GroupView\",e)\n}this._headerRow=document.getElementById(this._headerRowId);\nthis._tabBar=document.getElementById(this._htmlElId+\"_tabView_tabbar\");\nthis._searchFieldsRow=document.getElementById(this._htmlElId+\"_searchFieldsRow\");\nthis._manualAddRow=document.getElementById(this._htmlElId+\"_manualAddRow\");\nthis._navButtonsRow=document.getElementById(this._htmlElId+\"_navButtonsRow\");\nthis._htmlInitialized=true\n};\nZmGroupView.prototype._addWidgets=function(){if(!this.isDistributionList()||this._usernameEditable){this._groupNameInput=new DwtInputField({parent:this,size:this.isDistributionList()?20:40,inputId:this._htmlElId+\"_groupName\"});\nthis._groupNameInput.setHint(this.isDistributionList()?ZmMsg.distributionList:ZmMsg.groupNameLabel);\nthis._groupNameInput.reparentHtmlElement(this._htmlElId+\"_groupNameParent\")\n}this._groupMembers=document.getElementById(this._htmlElId+\"_groupMembers\");\nthis._noManualEntry=this._groupMembers.disabled;\nvar b=this._htmlElId+\"_listSelect\";\nvar j=document.getElementById(b);\nif(j){this._searchInSelect=new DwtSelect({parent:this});\nthis._resetSearchInSelect();\nthis._searchInSelect.reparentHtmlElement(b);\nthis._searchInSelect.addChangeListener(new AjxListener(this,this._searchTypeListener))\n}this._searchButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_searchButton\")});\nthis._searchButton.setText(ZmMsg.search);\nthis._searchButton.addSelectionListener(new AjxListener(this,this._searchButtonListener));\nthis._listview=new ZmGroupListView(this);\nthis._listview.reparentHtmlElement(this._htmlElId+\"_listView\");\nthis._listview.addSelectionListener(new AjxListener(this,this._selectionListener));\nthis._listview.setUI(null,true);\nthis._listview._initialized=true;\nthis._groupMembersListView=new ZmGroupMembersListView(this);\nthis._groupMembersListView.reparentHtmlElement(this._htmlElId+\"_groupMembers\");\nthis._groupMembersListView.addSelectionListener(new AjxListener(this,this._groupMembersSelectionListener));\nthis._groupMembersListView.setUI(null,true);\nthis._groupMembersListView._initialized=true;\nvar a=new AjxListener(this,this._addListener);\nthis._addButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_addButton\")});\nthis._addButton.setText(ZmMsg.add);\nthis._addButton.addSelectionListener(a);\nthis._addButton.setEnabled(false);\nthis._addButton.setImage(\"LeftArrow\");\nthis._addAllButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_addAllButton\")});\nthis._addAllButton.setText(ZmMsg.addAll);\nthis._addAllButton.addSelectionListener(a);\nthis._addAllButton.setEnabled(false);\nthis._addAllButton.setImage(\"LeftArrow\");\nvar h=new AjxListener(this,this._pageListener);\nthis._prevButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_prevButton\")});\nthis._prevButton.setImage(\"LeftArrow\");\nthis._prevButton.addSelectionListener(h);\nthis._prevButton.setEnabled(false);\nthis._nextButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_nextButton\")});\nthis._nextButton.setImage(\"RightArrow\");\nthis._nextButton.addSelectionListener(h);\nthis._nextButton.setEnabled(false);\nthis._locationButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_LOCATION_FOLDER\")});\nthis._locationButton.setImage(\"ContactsFolder\");\nthis._locationButton.setEnabled(this._contact&&!this._contact.isShared()&&!this._contact.isDistributionList());\nthis._locationButton.addSelectionListener(new AjxListener(this,this._handleFolderButton));\nvar d=this._contact&&this._contact.getAddressBook();\nif(!d){var k=appCtxt.getApp(ZmApp.CONTACTS).getOverview();\nd=k&&k.getSelected();\nif(d&&d.type!=ZmOrganizer.ADDRBOOK){d=null\n}if(!this.isDistributionList()&&d&&d.id&&d.id==ZmFolder.ID_DLS){d=null\n}}this._setLocationFolder(d);\nthis._addNewField=document.getElementById(this._htmlElId+\"_addNewField\");\nif(this._addNewField){this._addNewButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_addNewButton\")});\nthis._addNewButton.setText(ZmMsg.add);\nthis._addNewButton.addSelectionListener(new AjxListener(this,this._addNewListener));\nthis._addNewButton.setImage(\"LeftArrow\")\n}var e={};\nvar f={};\nZmContactPicker.prototype.mapFields.call(this,e,f);\nthis._searchField={};\nfor(var g in e){var i=Dwt.byId(e[g]);\nif(i){this._searchField[g]=i\n}}this._searchRow={};\nfor(var c in f){row=Dwt.byId(f[c]);\nif(row){this._searchRow[c]=row\n}}this._updateSearchRows(this._searchInSelect&&this._searchInSelect.getValue()||ZmContactsApp.SEARCHFOR_CONTACTS)\n};\nZmGroupView.prototype._installKeyHandlers=function(){if(this.isDistributionList()){if(this._usernameEditable){var l=document.getElementById(this._groupNameId);\nDwt.setHandler(l,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp);\nDwt.associateElementWithObject(l,this)\n}if(this._domainEditable){var n=document.getElementById(this._groupNameDomainId);\nDwt.setHandler(n,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp);\nDwt.associateElementWithObject(n,this)\n}var c=document.getElementById(this._dlDisplayNameId);\nDwt.setHandler(c,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp);\nDwt.associateElementWithObject(c,this);\nvar d=document.getElementById(this._dlDescId);\nDwt.setHandler(d,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp);\nDwt.associateElementWithObject(d,this);\nvar h=document.getElementById(this._dlHideInGalId);\nDwt.setHandler(h,DwtEvent.ONCHANGE,ZmGroupView._onChange);\nDwt.associateElementWithObject(h,this);\nvar k=document.getElementById(this._dlNotesId);\nDwt.setHandler(k,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp);\nDwt.associateElementWithObject(k,this);\nfor(var e=0;\ne<this._subsPolicyOpts.length;\ne++){var b=this._subsPolicyOpts[e];\nvar j=document.getElementById(this._dlSubscriptionPolicyId[b]);\nDwt.setHandler(j,DwtEvent.ONCHANGE,ZmGroupView._onChange);\nDwt.associateElementWithObject(j,this);\nj=document.getElementById(this._dlUnsubscriptionPolicyId[b]);\nDwt.setHandler(j,DwtEvent.ONCHANGE,ZmGroupView._onChange);\nDwt.associateElementWithObject(j,this)\n}var g=document.getElementById(this._dlListOwnersId);\nDwt.associateElementWithObject(g,this);\nif(this._acAddrSelectList){this._acAddrSelectList.handle(g)\n}else{Dwt.setHandler(g,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp)\n}for(e=0;\ne<this._mailPolicyOpts.length;\ne++){b=this._mailPolicyOpts[e];\nj=document.getElementById(this._dlMailPolicyId[b]);\nDwt.setHandler(j,DwtEvent.ONCHANGE,ZmGroupView._onChange);\nDwt.associateElementWithObject(j,this)\n}var a=document.getElementById(this._dlListSpecificMailersId);\nDwt.associateElementWithObject(a,this);\nif(this._acAddrSelectList){this._acAddrSelectList.handle(a)\n}else{Dwt.setHandler(a,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp)\n}}else{var l=document.getElementById(this._groupNameId);\nDwt.setHandler(l,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp);\nDwt.associateElementWithObject(l,this)\n}if(!this._noManualEntry){Dwt.setHandler(this._groupMembers,DwtEvent.ONKEYUP,ZmGroupView._onKeyUp);\nDwt.associateElementWithObject(this._groupMembers,this)\n}for(var f in this._searchField){var m=this._searchField[f];\nDwt.setHandler(m,DwtEvent.ONKEYPRESS,ZmGroupView._keyPressHdlr);\nDwt.associateElementWithObject(m,this)\n}};\nZmGroupView.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nZmGroupView.prototype._getTabGroupMembers=function(){var a=[];\nif(this.isDistributionList()){if(this._usernameEditable){a.push(document.getElementById(this._groupNameId))\n}if(this._domainEditable){a.push(document.getElementById(this._groupNameDomainId))\n}a.push(document.getElementById(this._dlDisplayNameId));\na.push(document.getElementById(this._dlDescId));\na.push(document.getElementById(this._dlHideInGalId));\nfor(var d=0;\nd<this._mailPolicyOpts.length;\nd++){var c=this._mailPolicyOpts[d];\na.push(document.getElementById(this._dlMailPolicyId[c]))\n}for(var d=0;\nd<this._subsPolicyOpts.length;\nd++){var c=this._subsPolicyOpts[d];\na.push(document.getElementById(this._dlSubscriptionPolicyId[c]))\n}for(d=0;\nd<this._subsPolicyOpts.length;\nd++){c=this._subsPolicyOpts[d];\na.push(document.getElementById(this._dlUnsubscriptionPolicyId[c]))\n}a.push(document.getElementById(this._dlNotesId))\n}else{a.push(document.getElementById(this._groupNameId))\n}if(!this._noManualEntry){a.push(this._groupMembers)\n}for(var b in this._searchField){a.push(this._searchField[b])\n}a.push(this._searchButton);\na.push(this._searchInSelect);\nreturn a\n};\nZmGroupView.prototype._getDefaultFocusItem=function(){if(this.isDistributionList()){if(this._usernameEditable){return document.getElementById(this._groupNameId)\n}if(this._domainEditable){return document.getElementById(this._groupNameDomainId)\n}return document.getElementById(this._dlDisplayNameId)\n}return document.getElementById(this._groupNameId)\n};\nZmGroupView.prototype._getGroupMembers=function(){return this._groupMembersListView.getList().getArray()\n};\nZmGroupView.prototype._getFolderId=function(){return this._folderId||ZmFolder.ID_CONTACTS\n};\nZmGroupView.prototype._setGroupMembers=function(){var a=this._contact.getAllGroupMembers();\nif(!a){return\n}this._groupMembersListView.set(AjxVector.fromArray(a))\n};\nZmGroupView.prototype._setGroupName=function(){if(this.isDistributionList()){if(this._domainEditable){var a=document.getElementById(this._groupNameDomainId);\na.value=this._emailDomain\n}if(this._usernameEditable){this._groupNameInput.setValue(this._emailUsername)\n}return\n}var b=document.getElementById(this._groupNameId);\nif(!b){return\n}this._groupNameInput.setValue(this._contact.getFileAs())\n};\nZmGroupView.prototype._setDlFields=function(){var o=document.getElementById(this._dlDisplayNameId);\nvar p=this._contact.dlInfo;\no.value=p.displayName||\"\";\nvar k=document.getElementById(this._dlDescId);\nk.value=p.description||\"\";\nvar c=document.getElementById(this._dlHideInGalId);\nc.checked=p.hideInGal;\nvar l=p.subscriptionPolicy||ZmContactSplitView.SUBSCRIPTION_POLICY_ACCEPT;\nvar d=p.unsubscriptionPolicy||ZmContactSplitView.SUBSCRIPTION_POLICY_ACCEPT;\nfor(var e=0;\ne<this._subsPolicyOpts.length;\ne++){var a=this._subsPolicyOpts[e];\nvar g=document.getElementById(this._dlSubscriptionPolicyId[a]);\ng.checked=l==a;\nvar j=document.getElementById(this._dlUnsubscriptionPolicyId[a]);\nj.checked=d==a\n}var b=p.mailPolicy||ZmGroupView.MAIL_POLICY_ANYONE;\nfor(e=0;\ne<this._mailPolicyOpts.length;\ne++){a=this._mailPolicyOpts[e];\nvar m=document.getElementById(this._dlMailPolicyId[a]);\nm.checked=b==a\n}if(p.mailPolicy==ZmGroupView.MAIL_POLICY_SPECIFIC){var f=document.getElementById(this._dlListSpecificMailersId);\nf.value=p.mailPolicySpecificMailers.join(\"; \");\nif(f.value.length>0){f.value+=\";\"\n}}var n=document.getElementById(this._dlListOwnersId);\nn.value=p.owners.join(\"; \");\nif(n.value.length>0){n.value+=\";\"\n}var h=document.getElementById(this._dlNotesId);\nh.value=p.notes||\"\"\n};\nZmGroupView.prototype._resetSearchInSelect=function(){this._searchInSelect.addOption(ZmMsg.contacts,true,ZmContactsApp.SEARCHFOR_CONTACTS);\nif(appCtxt.get(ZmSetting.SHARING_ENABLED)){this._searchInSelect.addOption(ZmMsg.searchPersonalSharedContacts,false,ZmContactsApp.SEARCHFOR_PAS)\n}if(appCtxt.get(ZmSetting.GAL_ENABLED)&&appCtxt.getActiveAccount().isZimbraAccount){this._searchInSelect.addOption(ZmMsg.GAL,true,ZmContactsApp.SEARCHFOR_GAL)\n}if(!appCtxt.get(ZmSetting.INITIALLY_SEARCH_GAL)||!appCtxt.get(ZmSetting.GAL_ENABLED)){this._searchInSelect.setSelectedValue(ZmContactsApp.SEARCHFOR_CONTACTS)\n}};\nZmGroupView.prototype._setLocationFolder=function(b){if(b){var a=b instanceof ZmOrganizer?b:appCtxt.getById(b)\n}if(!a||a.isReadOnly()){a=appCtxt.getById(ZmOrganizer.ID_ADDRBOOK)\n}this._locationButton.setText(a.getName());\nthis._folderId=a.id\n};\nZmGroupView.prototype._handleFolderButton=function(b){var a=appCtxt.getChooseFolderDialog();\na.registerCallback(DwtDialog.OK_BUTTON,new AjxCallback(this,this._handleChooseFolder));\nvar c={overviewId:a.getOverviewId(ZmApp.CONTACTS),title:ZmMsg.chooseAddrBook,treeIds:[ZmOrganizer.ADDRBOOK],skipReadOnly:true,skipRemote:false,noRootSelect:true,appName:ZmApp.CONTACTS};\nc.omit={};\nc.omit[ZmFolder.ID_TRASH]=true;\na.popup(c)\n};\nZmGroupView.prototype._handleChooseFolder=function(a){var b=appCtxt.getChooseFolderDialog();\nb.popdown();\nthis._isDirty=true;\nthis._setLocationFolder(a)\n};\nZmGroupView.prototype._setTags=function(){var a=this._getTagCell();\nif(!a){return\n}a.innerHTML=ZmTagsHelper.getTagsHtml(this._contact,this)\n};\nZmGroupView.prototype._getDialogXY=function(){if(this.isDistributionList()){return new DwtPoint(ZmGroupView.DIALOG_X,ZmGroupView.DIALOG_Y)\n}var a=Dwt.toWindow(this.getHtmlElement(),0,0);\nreturn new DwtPoint(a.x+ZmGroupView.DIALOG_X,a.y+ZmGroupView.DIALOG_Y)\n};\nZmGroupView.prototype._groupMembersSelectionListener=function(c){var b=this._groupMembersListView.getSelection();\nif(c&&c.target&&this._groupMembersListView.delButtons[c.target.id]){this._delListener(c)\n}else{if(c&&c.target&&this._groupMembersListView.quickAddButtons[c.target.id]){if(AjxUtil.isArray(b)){var a=b[0].address||b[0];\nthis.quickAddContact(a)\n}}}};\nZmGroupView.prototype._selectionListener=function(b){var a=this._listview.getSelection();\nif(b.detail==DwtListView.ITEM_DBL_CLICKED){this._addItems(a)\n}else{this._addButton.setEnabled(a.length>0)\n}};\nZmGroupView.prototype._selectChangeListener=function(a){this._attr[ZmContact.F_folderId]=a._args.newValue;\nthis._isDirty=true\n};\nZmGroupView.prototype._searchTypeListener=function(b){var a=b._args.oldValue;\nvar c=b._args.newValue;\nif(a!=c){this._updateSearchRows(c);\nthis._searchButtonListener()\n}};\nZmGroupView.prototype._delListener=function(g){var b=this._groupMembersListView.getSelection();\nvar d=this._groupMembersListView.getSelectedItems();\nwhile(d.get(0)){this._groupMembersListView.removeItem(d.get(0))\n}for(var c=0;\nc<b.length;\nc++){var f=b[c];\nthis._groupMembersListView.getList().remove(f);\nvar a=f.__contact;\nvar e=f.type;\nvar h=f.groupRefValue||f.value;\nif(!this._groupMemberMods[h]){this._groupMemberMods[h]={op:\"-\",value:h,email:f.address,type:e}\n}else{this._groupMemberMods[h]={}\n}}this._groupMembersSelectionListener();\nthis._isDirty=true\n};\nZmGroupView.prototype._addNewListener=function(e){var b=this._addNewField.value;\nif(!b||b==\"\"){return\n}var a=AjxEmailAddress.parseEmailString(b).all.getArray();\nvar d=[];\nfor(var c=0;\nc<a.length;\nc++){d.push(ZmContactsHelper._wrapInlineContact(a[c].address))\n}d=ZmGroupView._dedupe(d,this._groupMembersListView.getList().getArray());\nthis._addToMembers(d);\nthis._addNewField.value=\"\"\n};\nZmGroupView.prototype._addListener=function(a){var b=(a.dwtObj==this._addButton)?this._listview.getSelection():this._listview.getList().getArray();\nthis._addItems(b)\n};\nZmGroupView.prototype._addItems=function(f){if(f.length==0){return\n}var g=[];\nfor(var c=0;\nc<f.length;\nc++){var l=f[c];\nvar e=l.__contact;\nif(l.isGroup&&!e.isDistributionList()){var d=e.attr[ZmContact.F_groups];\nfor(var a=0;\na<d.length;\na++){var k=d[a].value;\nvar h=ZmContact.getContactFromCache(k);\nvar b;\nif(h){b=ZmContactsHelper._wrapContact(h)\n}else{b=ZmContactsHelper._wrapInlineContact(k)\n}if(b){g.push(b)\n}}}else{g.push(f[c]);\nif(e.isGal){appCtxt.cacheSet(e.ref,e)\n}}}g=ZmGroupView._dedupe(g,this._groupMembersListView.getList().getArray());\nif(g.length>0){this._addToMembers(g)\n}};\nZmGroupView.prototype._addToMembers=function(e){var g=appCtxt.accountList.mainAccount.id;\nfor(var c=0;\nc<e.length;\nc++){var j=e[c];\nvar f=j.type;\nvar h=j.value;\nvar d=j.address;\nvar b=this._groupMemberMods[h];\nif(!b){if(f===ZmContact.GROUP_CONTACT_REF&&h&&h.indexOf(\":\")===-1){h=g+\":\"+h\n}this._groupMemberMods[h]={op:\"+\",value:h,type:f,email:d}\n}else{if(b.op==\"-\"){this._groupMemberMods[h]={}\n}}}var a=this._groupMembersListView.getList();\ne=e.concat(a?a.getArray():[]);\nthis._isDirty=true;\nthis._groupMembersListView.set(AjxVector.fromArray(e))\n};\nZmGroupView._dedupe=function(b,h){AjxUtil.dedup(b,function(i){return i.type+\"$\"+i.value\n});\nvar g=[];\nfor(var d=0;\nd<b.length;\nd++){var c=b[d];\nvar f=false;\nfor(var a=0;\na<h.length;\na++){var e=h[a];\nif(c.type==e.type&&c.value==e.value){f=true;\nbreak\n}}if(!f){g.push(c)\n}}return g\n};\nZmGroupView.prototype._setGroupMemberValue=function(b,a){if(this._noManualEntry){this._groupMembers.disabled=false\n}if(a){this._groupMembers.value+=b\n}else{this._groupMembers.value=b\n}if(this._noManualEntry){this._groupMembers.disabled=true\n}};\nZmGroupView.prototype._setResultsInView=function(b){var a=b.getArray();\nthis._listview.setItems(a);\nthis._addButton.setEnabled(a.length>0);\nthis._addAllButton.setEnabled(a.length>0)\n};\nZmGroupView.prototype._setNoResultsHtml=function(a){};\nZmGroupView.prototype.search=ZmContactPicker.prototype.search;\nZmGroupView.prototype._handleResponseSearch=ZmContactPicker.prototype._handleResponseSearch;\nZmGroupView.prototype._resetResults=ZmContactPicker.prototype._resetResults;\nZmGroupView.prototype._searchButtonListener=ZmContactPicker.prototype._searchButtonListener;\nZmGroupView.prototype._pageListener=ZmContactPicker.prototype._pageListener;\nZmGroupView.prototype._showResults=ZmContactPicker.prototype._showResults;\nZmGroupView.prototype.getSubList=ZmContactPicker.prototype.getSubList;\nZmGroupView.prototype._tagChangeListener=function(b){if(b.type!=ZmEvent.S_TAG){return\n}var a=b.getDetail(\"fields\");\nvar c=a&&(a[ZmOrganizer.F_COLOR]||a[ZmOrganizer.F_NAME]);\nif((b.event==ZmEvent.E_MODIFY&&c)||b.event==ZmEvent.E_DELETE||b.event==ZmEvent.MODIFY){this._setTags()\n}};\nZmGroupView.prototype._groupChangeListener=function(a){if(a.type!=ZmEvent.S_CONTACT){return\n}if(a.event==ZmEvent.E_TAGS||a.event==ZmEvent.E_REMOVE_ALL){this._setTags()\n}};\nZmGroupView.prototype._updateSearchRows=function(a){var c=(a==ZmContactsApp.SEARCHFOR_GAL)?ZmContactPicker.SHOW_ON_GAL:ZmContactPicker.SHOW_ON_NONGAL;\nfor(var b in this._searchRow){Dwt.setVisible(this._searchRow[b],AjxUtil.indexOf(c,b)!=-1)\n}};\nZmGroupView.prototype._resetSearchColHeaders=function(){var d=this._listview;\nd.headerColCreated=false;\nvar c=this._searchInSelect&&(this._searchInSelect.getValue()==ZmContactsApp.SEARCHFOR_GAL);\nfor(var a=0;\na<d._headerList.length;\na++){var b=d._headerList[a]._field;\nif(b==ZmItem.F_DEPARTMENT){d._headerList[a]._visible=c&&this._detailedSearch\n}}var e=c?null:ZmItem.F_NAME;\nd.createHeaderHtml(e)\n};\nZmGroupView.prototype._checkItemCount=function(){this._listview._checkItemCount()\n};\nZmGroupView.prototype._handleResponseCheckReplenish=function(a){this._listview._handleResponseCheckReplenish(a)\n};\nZmGroupView._onKeyUp=function(c){c=DwtUiEvent.getEvent(c);\nvar b=DwtKeyEvent.getCharCode(c);\nif(DwtKeyMapMgr.hasModifier(c)||DwtKeyMap.IS_MODIFIER[b]||b===DwtKeyEvent.KEY_TAB){return\n}var d=DwtUiEvent.getTarget(c);\nvar a=d?Dwt.getObjectFromElement(d):null;\nif(a){a._isDirty=true\n}return true\n};\nZmGroupView._onChange=function(b){b=DwtUiEvent.getEvent(b);\nvar c=DwtUiEvent.getTarget(b);\nvar a=c?Dwt.getObjectFromElement(c):null;\nif(a){a._isDirty=true\n}return true\n};\nZmGroupView._keyPressHdlr=function(c){c=DwtUiEvent.getEvent(c);\nif(DwtKeyMapMgr.hasModifier(c)){return\n}var d=DwtUiEvent.getTarget(c);\nvar b=d?Dwt.getObjectFromElement(d):null;\nif(b){var a=DwtKeyEvent.getCharCode(c);\nif(a==13||a==3){b._searchButtonListener(c);\nreturn false\n}}return true\n};\nZmGroupView.prototype.quickAddContact=function(b){var a=appCtxt.getContactQuickAddDialog();\na.setFields(b);\nvar c=new AjxCallback(this,this._handleQuickAddContact);\na.popup(c)\n};\nZmGroupView.prototype._handleQuickAddContact=function(b){var h=AjxUtil.get(b,\"_data\",\"BatchResponse\",\"CreateContactResponse\");\nvar a=h?ZmContact.createFromDom(h[0].cn[0],{}):null;\nif(!a){return\n}var c=this._groupMembersListView.getSelection();\nvar f=c[0];\nvar e=f.value;\nif(!this._groupMemberMods[e]){this._groupMemberMods[e]={op:\"-\",value:e,type:f.type}\n}else{this._groupMemberMods[e]={}\n}var d=this._groupMembersListView.getSelectedItems();\nthis._groupMembersListView.removeItem(d.get(0));\nthis._groupMembersListView.getList().remove(f);\nvar g=ZmContactsHelper._wrapContact(a);\nif(g){this._addItems([g])\n}};\nZmGroupListView=function(a){if(arguments.length==0){return\n}DwtListView.call(this,{parent:a,className:\"DwtChooserListView ZmEditGroupContact\",headerList:this._getHeaderList(a),view:this._view,posStyle:Dwt.RELATIVE_STYLE});\nDwt.setScrollStyle(this._elRef,Dwt.CLIP)\n};\nZmGroupListView.prototype=new DwtListView;\nZmGroupListView.prototype.constructor=ZmGroupListView;\nZmGroupListView.prototype.setItems=function(a){this._resetList();\nthis.addItems(a);\nvar b=this.getList();\nif(b&&b.size()>0){this.setSelection(b.get(0))\n}};\nZmGroupListView.prototype._getHeaderList=function(){return[(new DwtListHeaderItem({field:ZmItem.F_TYPE,icon:\"Contact\",width:ZmMsg.COLUMN_WIDTH_TYPE_CN})),(new DwtListHeaderItem({field:ZmItem.F_NAME,text:ZmMsg._name,width:ZmMsg.COLUMN_WIDTH_NAME_CN,resizeable:true})),(new DwtListHeaderItem({field:ZmItem.F_EMAIL,text:ZmMsg.email}))]\n};\nZmGroupListView.prototype._getCellContents=function(b,a,c,d,f,e){return ZmContactsHelper._getEmailField(b,a,c,d,f,e)\n};\nZmGroupListView.prototype._itemClicked=function(a,b){if(!b.shiftKey&&!b.ctrlKey&&b.button==DwtMouseEvent.RIGHT){return\n}DwtListView.prototype._itemClicked.call(this,a,b)\n};\nZmGroupListView.prototype._mouseDownAction=function(a,b){return !Dwt.ffScrollbarCheck(a)\n};\nZmGroupListView.prototype._mouseUpAction=function(a,b){return !Dwt.ffScrollbarCheck(a)\n};\nZmGroupListView.prototype._checkItemCount=function(){return true\n};\nZmGroupListView.prototype._handleResponseCheckReplenish=function(){return true\n};\nZmGroupMembersListView=function(a){if(arguments.length==0){return\n}ZmGroupListView.call(this,a);\nthis._list=new AjxVector();\nthis.delButtons={};\nthis.quickAddButtons={}\n};\nZmGroupMembersListView.prototype=new ZmGroupListView;\nZmGroupMembersListView.prototype.constructor=ZmGroupMembersListView;\nZmGroupMembersListView.prototype._getHeaderList=function(){return[(new DwtListHeaderItem({field:ZmItem.F_EMAIL,text:ZmMsg.membersLabel,view:this._view}))]\n};\nZmGroupMembersListView.prototype._getCellContents=function(e,j,k,i,c,b){if(i==ZmItem.F_EMAIL){var d={};\nd.isEdit=true;\nd.delButtonId=Dwt.getNextId(\"DelContact_\");\nthis.delButtons[d.delButtonId]=true;\nvar f=k.__contact;\nvar h=k.address;\nif(f&&!this.parent.isDistributionList()){d.imageUrl=f.getImageUrl();\nd.email=AjxStringUtil.htmlEncode(f.getEmail());\nd.title=AjxStringUtil.htmlEncode(f.getAttr(ZmContact.F_jobTitle));\nd.phone=AjxStringUtil.htmlEncode(f.getPhone());\nd.imgClassName=f.getIconLarge();\nvar g=appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS);\nvar a=f.getFullNameForDisplay(g);\nif(!g){a=AjxStringUtil.htmlEncode(a)\n}d.fullName=a\n}else{d.imgClassName=\"PersonInline_48\";\nd.email=AjxStringUtil.htmlEncode(h);\nif(!this.parent.isDistributionList()){d.isInline=true;\nd.quickAddId=Dwt.getNextId(\"QuickAdd_\");\nthis.quickAddButtons[d.quickAddId]=true\n}}e[j++]=AjxTemplate.expand(\"abook.Contacts#SplitView_group\",d)\n}return j\n};\nZmGroupMembersListView.prototype._getItemId=function(a){return(a&&a.id)?a.id:Dwt.getNextId()\n};\nZmDlPropertiesTabView=function(b,a){if(arguments.length==0){return\n}DwtTabViewPage.call(this,b,a,Dwt.ABSOLUTE_STYLE);\nthis.setScrollStyle(Dwt.SCROLL);\nvar c=this.getHtmlElement();\nc.style.top=this.parent._tabView.getY()+this.parent._tabView._tabBar.getH()+\"px\";\nc.style.bottom=0\n};\nZmDlPropertiesTabView.prototype=new DwtTabViewPage;\nZmDlPropertiesTabView.prototype.toString=function(){return\"ZmDlPropertiesTabView\"\n};\nZmDlPropertiesTabView.prototype._createHtml=function(){DwtTabViewPage.prototype._createHtml.call(this);\nthis.getHtmlElement().innerHTML=AjxTemplate.expand(\"abook.Contacts#DlPropertiesView\",this.parent._templateParams)\n};\nZmDlMembersTabView=function(b,a){if(arguments.length==0){return\n}DwtTabViewPage.call(this,b,a,Dwt.RELATIVE_STYLE)\n};\nZmDlMembersTabView.prototype=new DwtTabViewPage;\nZmDlMembersTabView.prototype.toString=function(){return\"ZmDlMembersTabView\"\n};\nZmDlMembersTabView.prototype._createHtml=function(){DwtTabViewPage.prototype._createHtml.call(this);\nthis.getHtmlElement().innerHTML=AjxTemplate.expand(\"abook.Contacts#GroupViewMembers\",this.parent._templateParams)\n}\n}if(AjxPackage.define(\"zimbraMail.abook.view.ZmContactsBaseView\")){ZmContactsBaseView=function(a){if(arguments.length==0){return\n}a.posStyle=a.posStyle||Dwt.ABSOLUTE_STYLE;\na.type=ZmItem.CONTACT;\na.pageless=true;\nZmListView.call(this,a);\nthis._handleEventType[ZmItem.GROUP]=true\n};\nZmContactsBaseView.prototype=new ZmListView;\nZmContactsBaseView.prototype.constructor=ZmContactsBaseView;\nZmContactsBaseView.prototype.toString=function(){return\"ZmContactsBaseView\"\n};\nZmContactsBaseView.prototype.set=function(d,c,b){if(this._itemsToAdd){this.addItems(this._itemsToAdd);\nthis._itemsToAdd=null\n}else{var a;\nif(d instanceof ZmContactList){d.addChangeListener(this._listChangeListener);\na=(d.isGal&&!d.isGalPagingSupported)?d.getVector().clone():d.getSubList(this.offset,this.getLimit(this.offset),b)\n}else{a=d\n}this._folderId=b;\nDwtListView.prototype.set.call(this,a,c)\n}this._setRowHeight();\nthis._rendered=true\n};\nZmContactsBaseView.prototype._setParticipantToolTip=function(a){};\nZmContactsBaseView.prototype.getListView=function(){return this\n};\nZmContactsBaseView.prototype.getTitle=function(){return[ZmMsg.zimbraTitle,this._controller.getApp().getDisplayName()].join(\": \")\n};\nZmContactsBaseView.prototype._changeListener=function(j){var a=this._controller.getFolderId();\nif(a!=null||j.event!=ZmEvent.E_MOVE){ZmListView.prototype._changeListener.call(this,j);\nif(j.event==ZmEvent.E_MODIFY){this._modifyContact(j);\nvar f=j.item||j._details.items[0];\nif(f instanceof ZmContact){this.setSelection(f,false,true)\n}}else{if(j.event==ZmEvent.E_CREATE){var h=j._details.items[0];\nvar d=appCtxt.getById(h.folderId);\nvar k=d&&(appCtxt.getActiveAccount().isMain?d.nId:d.id);\nvar c=j.getDetail(\"visible\");\nif(a&&d&&a==k&&c){var e=j.getDetail(\"sortIndex\");\nvar i=this.parent?this.parent.getAlphabetBar():null;\nvar b=i?i.isItemInAlphabetLetter(h):true;\nif(e!=null&&b){this.addItem(h,e)\n}if(b){this.setSelection(h,false,true)\n}}}else{if(j.event==ZmEvent.E_DELETE){var g=this._controller.getList();\nif(g){g.remove(j.item)\n}}}}}};\nZmContactsBaseView.prototype.setSelection=function(d,b,a){if(!d){return\n}var c=this._getElFromItem(d);\nif(c){ZmListView.prototype.setSelection.call(this,d,b);\nthis._pendingSelection=null\n}else{if(a){this._pendingSelection={item:d,skipNotify:b}\n}}};\nZmContactsBaseView.prototype.addItems=function(a){ZmListView.prototype.addItems.call(this,a);\nif(this._pendingSelection&&AjxUtil.indexOf(a,this._pendingSelection.item)!=-1){this.setSelection(this._pendingSelection.item,this._pendingSelection.skipNotify)\n}};\nZmContactsBaseView.prototype._modifyContact=function(d){var e=this.getList();\nvar b=d.item;\nif(b){var a=e.getArray();\nfor(var c=0;\nc<a.length;\nc++){if(a[c].id===b.id){if(a[c]===b){break\n}a[c]=b;\nthis.parent.setContact(b);\nbreak\n}}}if(d.getDetail(\"fileAsChanged\")){if(e){e.sort(ZmContact.compareByFileAs)\n}}};\nZmContactsBaseView.prototype._setNextSelection=function(){if(this.firstSelIndex<0){this.firstSelIndex=0\n}var b;\nif(this._list){b=this._list.get(this.firstSelIndex);\nif(this._controller.getFolderId()==ZmFolder.ID_TRASH){if(!b){b=this._list.get(0)\n}}else{if(b==null||(b&&b.folderId==ZmFolder.ID_TRASH)){b=null;\nvar d=this._list.getArray();\nif(this.firstSelIndex>0&&this.firstSelIndex==d.length){b=d[d.length-1]\n}else{for(var a=0;\na<d.length;\na++){if(d[a].folderId!=ZmFolder.ID_TRASH){b=d[a];\nbreak\n}}}if(b){var e=document.getElementById(this._getItemId(b));\nif(e){var c=this._data[e.id];\nthis.firstSelIndex=this._list?this._list.indexOf(c.item):-1\n}}}}}this.setSelection(b)\n};\nZmContactAlphabetBar=function(a){DwtComposite.call(this,{parent:a});\nthis._createHtml();\nthis._all=this._current=document.getElementById(this._alphabetBarId).rows[0].cells[0];\nthis._currentLetter=null;\nthis.setSelected(this._all,true);\nthis._enabled=true;\nthis.addListener(DwtEvent.ONCLICK,this._onClick.bind(this))\n};\nZmContactAlphabetBar.prototype=new DwtComposite;\nZmContactAlphabetBar.prototype.constructor=ZmContactAlphabetBar;\nZmContactAlphabetBar.prototype.role=\"toolbar\";\nZmContactAlphabetBar.prototype.toString=function(){return\"ZmContactAlphabetBar\"\n};\nZmContactAlphabetBar.prototype.enable=function(a){this._enabled=a;\nvar b=document.getElementById(this._alphabetBarId);\nif(b){b.className=a?\"AlphabetBarTable\":\"AlphabetBarTable AlphabetBarDisabled\"\n}};\nZmContactAlphabetBar.prototype.enabled=function(){return this._enabled\n};\nZmContactAlphabetBar.prototype.reset=function(b){var a=b||this._all;\nif(a!=this._current){this.setSelected(this._current,false);\nthis._current=a;\nthis._currentLetter=b&&b!=this._all?b.innerHTML:null;\nthis.setSelected(a,true);\nreturn true\n}return false\n};\nZmContactAlphabetBar.prototype.setButtonByIndex=function(b){var c=document.getElementById(this._alphabetBarId);\nvar a=c.rows[0].cells[b];\nif(a){this.reset(a)\n}};\nZmContactAlphabetBar.prototype.getCurrent=function(){return this._current\n};\nZmContactAlphabetBar.prototype.getCurrentLetter=function(){return this._currentLetter\n};\nZmContactAlphabetBar.prototype.setSelected=function(a,b){a.className=b?\"DwtButton-active AlphabetBarCell\":\"DwtButton AlphabetBarCell\";\na.setAttribute(\"aria-selected\",b);\nif(b){this.getHtmlElement().setAttribute(\"aria-activedescendant\",a.id);\nthis.setFocusElement(a)\n}};\nZmContactAlphabetBar.alphabetClicked=function(b,d,a){var c=AjxDispatcher.run(\"GetContactListController\");\nvar e=c&&c.getCurrentView()&&c.getCurrentView().getAlphabetBar();\nif(e&&e.enabled()){if(e.reset(b)){d=d&&String(d).substr(0,1);\na=a&&String(a).substr(0,1);\nc.searchAlphabet(d,a)\n}}};\nZmContactAlphabetBar.prototype.isItemInAlphabetLetter=function(g){var a=false;\nif(g){if(ZmMsg.alphabet&&ZmMsg.alphabet.length>0){var e=ZmMsg.alphabet.split(\",\")[0]\n}var b=g.getFileAs();\nvar c=this.getCurrentLetter();\nif(!c||c.toLowerCase()==e){a=true\n}else{if(c&&b){var d=String(b).substr(0,1).toLowerCase();\nvar f=c.substr(0,1).toLowerCase();\nif(d==f){a=true\n}else{if(AjxStringUtil.isDigit(f)&&AjxStringUtil.isDigit(d)){a=true\n}else{if(c.toLowerCase()==\"a-z\"&&d.match(\"[a-z]\")){a=true\n}}}}}}return a\n};\nZmContactAlphabetBar.prototype._createHtml=function(){this._alphabetBarId=this._htmlElId+\"_alphabet\";\nvar c=ZmMsg.alphabet.split(\",\");\nthis.startSortMap=ZmContactAlphabetBar._parseSortVal(ZmMsg.alphabetSortValue);\nthis.endSortMap=ZmContactAlphabetBar._parseSortVal(ZmMsg.alphabetEndSortValue);\nvar b={id:this._htmlElId,alphabet:c,numLetters:c.length};\nvar a=this.getHtmlElement();\na.innerHTML=AjxTemplate.expand(\"abook.Contacts#ZmAlphabetBar\",b);\nthis.setAttribute(\"aria-label\",ZmMsg.alphabetLabel);\nAjxUtil.foreach(Dwt.byClassName(\"AlphabetBarCell\",a),(function(d){this._makeFocusable(d,true);\nthis._setEventHdlrs([DwtEvent.ONCLICK],false,d)\n}).bind(this))\n};\nZmContactAlphabetBar.prototype.getInputElement=function(){return this._current\n};\nZmContactAlphabetBar.prototype.getKeyMapName=function(){return DwtKeyMap.MAP_TOOLBAR_HORIZ\n};\nZmContactAlphabetBar.prototype.handleKeyAction=function(a,d){var e=Dwt.hasClass(d.target,\"AlphabetBarCell\")?d.target:this._current;\nswitch(a){case DwtKeyMap.PREV:var c=Dwt.getPreviousElementSibling(e);\nif(c){this.setFocusElement(c)\n}return true;\ncase DwtKeyMap.NEXT:var b=Dwt.getNextElementSibling(e);\nif(b){this.setFocusElement(b)\n}return true;\ncase DwtKeyMap.SELECT:e.click();\nreturn true\n}};\nZmContactAlphabetBar._parseSortVal=function(e){if(!e){return{}\n}var c={};\nvar a=e.split(\",\");\nif(a&&a.length){for(var b=0;\nb<a.length;\nb++){var d=a[b].split(\":\");\nc[d[0]]=d[1]\n}}return c\n};\nZmContactAlphabetBar.prototype._onClick=function(e){var c=DwtUiEvent.getTarget(e);\nif(!Dwt.hasClass(c,\"AlphabetBarCell\")||!this.enabled()||!this.reset(c)){return\n}var b=AjxUtil.indexOf(c.parentNode.children,c);\nvar g=ZmMsg.alphabet.split(\",\");\nvar f=null,a=null;\nif(b>0){f=this.startSortMap[g[b]]||g[b].substr(0,1);\nif(b<g.length-1){a=this.endSortMap[g[b]]||g[b+1].substr(0,1)\n}}var d=AjxDispatcher.run(\"GetContactListController\");\nd.searchAlphabet(f,a)\n}\n}if(AjxPackage.define(\"zimbraMail.abook.view.ZmContactGroupMenu\")){ZmContactGroupMenu=function(b,a){ZmPopupMenu.call(this,b,null,b.getHTMLElId()+\"|GROUP_MENU\",a);\nb.setMenu(this);\nthis._addHash={};\nthis._removeHash={};\nthis._evtMgr=new AjxEventMgr();\nthis._desiredState=true;\nthis._items=null;\nthis._dirty=true;\nif(b instanceof DwtMenuItem){b.setHoverDelay(ZmContactGroupMenu._HOVER_TIME)\n}};\nZmContactGroupMenu.prototype=new ZmPopupMenu;\nZmContactGroupMenu.prototype.constructor=ZmContactGroupMenu;\nZmContactGroupMenu.KEY_GROUP_EVENT=\"_contactGroupEvent_\";\nZmContactGroupMenu.KEY_GROUP_ADDED=\"_contactGroupAdded_\";\nZmContactGroupMenu.MENU_ITEM_ADD_ID=\"group_add\";\nZmContactGroupMenu._HOVER_TIME=200;\nZmContactGroupMenu.prototype.toString=function(){return\"ZmContactGroupMenu\"\n};\nZmContactGroupMenu.prototype.addSelectionListener=function(a){this._evtMgr.addListener(DwtEvent.SELECTION,a)\n};\nZmContactGroupMenu.prototype.removeSelectionListener=function(a){this._evtMgr.removeListener(DwtEvent.SELECTION,a)\n};\nZmContactGroupMenu.prototype.setEnabled=function(a){this._desiredState=a;\nif(a&&!this._contactGroupList){return\n}this.parent.setEnabled(a)\n};\nZmContactGroupMenu.prototype.set=function(a,c,b){this._contactGroupList=c;\nthis._items=a;\nthis._dirty=true;\nthis._newDisabled=b;\nthis.parent.setEnabled(true);\nif(this.parent instanceof DwtMenuItem){this.parent.setHoverDelay(ZmContactGroupMenu._HOVER_TIME)\n}};\nZmContactGroupMenu.prototype._doPopup=function(b,f,e){if(this._dirty){this.removeChildren();\nif(this._contactGroupList){var c=[];\nfor(var d=0;\nd<this._contactGroupList.length;\nd++){var a=ZmContact.getContactFromCache(this._contactGroupList[d].id);\nif(a&&!ZmContact.isInTrash(a)){c.push(ZmContact.getAttr(this._contactGroupList[d],\"nickname\"))\n}else{this._contactGroupList[d]={id:false}\n}}this._render(c)\n}this._dirty=false;\nif(this.parent instanceof DwtMenuItem){this.parent.setHoverDelay(0)\n}}ZmPopupMenu.prototype._doPopup.call(this,b,f,e)\n};\nZmContactGroupMenu.prototype._render=function(b,a){for(var c=0;\nc<this._contactGroupList.length;\nc++){this._addNewGroup(this,this._contactGroupList[c],true,null,this._addHash)\n}if(this._contactGroupList.length){new DwtMenuItem({parent:this,style:DwtMenuItem.SEPARATOR_STYLE})\n}var d=this._menuItems[ZmContactGroupMenu.MENU_ITEM_ADD_ID]=new DwtMenuItem({parent:this,id:this._htmlElId+\"|NEWGROUP\"});\nd.setText(ZmMsg.newGroup);\nd.setImage(\"NewGroup\");\nif(this._newDisabled){d.setEnabled(false)\n}else{d.setData(ZmContactGroupMenu.KEY_GROUP_EVENT,ZmEvent.E_CREATE);\nd.addSelectionListener(this._menuItemSelectionListener.bind(this),0)\n}};\nZmContactGroupMenu.groupNameLength=20;\nZmContactGroupMenu.prototype._addNewGroup=function(g,e,d,b,c){var f=ZmContact.getAttr(e,\"nickname\")||e.fileAsStr;\nif(f){var a=new DwtMenuItem({parent:g,index:b});\nvar h=AjxStringUtil.clipByLength(f,ZmContactGroupMenu.groupNameLength);\na.setText(h);\na.setImage(\"Group\");\na.addSelectionListener(this._menuItemSelectionListener.bind(this),0);\na.setData(ZmContactGroupMenu.KEY_GROUP_EVENT,ZmEvent.E_MODIFY);\na.setData(ZmContactGroupMenu.KEY_GROUP_ADDED,d);\na.setData(Dwt.KEY_OBJECT,e)\n}};\nZmContactGroupMenu.prototype._menuItemSelectionListener=function(a){if(a.item.getData(ZmContactGroupMenu.KEY_GROUP_EVENT)){this._evtMgr.notifyListeners(DwtEvent.SELECTION,a.item)\n}};\nZmContactGroupMenu.prototype.setNewDisabled=function(a){this._newDisabled=a\n}\n}if(AjxPackage.define(\"zimbraMail.abook.view.ZmContactSplitView\")){ZmContactSplitView=function(b){if(arguments.length==0){return\n}b.className=b.className||\"ZmContactSplitView\";\nb.posStyle=b.posStyle||Dwt.ABSOLUTE_STYLE;\nb.id=Dwt.getNextId(\"ZmContactSplitView_\");\nDwtComposite.call(this,b);\nthis._controller=b.controller;\nthis.setScrollStyle(Dwt.CLIP);\nthis._changeListener=new AjxListener(this,this._contactChangeListener);\nthis._initialize(b.controller,b.dropTgt);\nvar a=appCtxt.getFolderTree();\nif(a){a.addChangeListener(new AjxListener(this,this._addrbookTreeListener))\n}ZmTagsHelper.setupListeners(this)\n};\nZmContactSplitView.prototype=new DwtComposite;\nZmContactSplitView.prototype.constructor=ZmContactSplitView;\nZmContactSplitView.prototype.isZmContactSplitView=true;\nZmContactSplitView.prototype.toString=function(){return\"ZmContactSplitView\"\n};\nZmContactSplitView.ALPHABET_HEIGHT=35;\nZmContactSplitView.NUM_DL_MEMBERS=10;\nZmContactSplitView.LIST_MIN_WIDTH=100;\nZmContactSplitView.CONTENT_MIN_WIDTH=200;\nZmContactSplitView.SUBSCRIPTION_POLICY_ACCEPT=\"ACCEPT\";\nZmContactSplitView.SUBSCRIPTION_POLICY_REJECT=\"REJECT\";\nZmContactSplitView.SUBSCRIPTION_POLICY_APPROVAL=\"APPROVAL\";\nZmContactSplitView.prototype.getListView=function(){return this._listPart\n};\nZmContactSplitView.prototype.getController=function(){return this._controller\n};\nZmContactSplitView.prototype.getAlphabetBar=function(){return this._alphabetBar\n};\nZmContactSplitView.prototype.setSize=function(b,a){DwtComposite.prototype.setSize.call(this,b,a);\nthis._sizeChildren(b,a)\n};\nZmContactSplitView.prototype.getTitle=function(){return[ZmMsg.zimbraTitle,this._controller.getApp().getDisplayName()].join(\": \")\n};\nZmContactSplitView.prototype.getLimit=function(a){return this._listPart.getLimit(a)\n};\nZmContactSplitView.prototype.setContact=function(a,c){if(a.isDistributionList()||!c){if(this._contact){this._contact.removeChangeListener(this._changeListener)\n}a.addChangeListener(this._changeListener)\n}var e=this._contact;\nthis._contact=this._item=a;\nif(this._contact.isLoaded){this._setContact(a,c,e)\n}else{var d=new AjxCallback(this,this._handleResponseLoad,[c,e]);\nvar b=new AjxCallback(this,this._handleErrorLoad);\nthis._contact.load(d,b,null,a.isGroup())\n}};\nZmContactSplitView.expandDL=function(a,c){var b=DwtControl.fromElementId(a);\nif(b){b._setContact(b._contact,true,null,c)\n}};\nZmContactSplitView.handleDLScroll=function(f){var e=DwtUiEvent.getTarget(f);\nvar g=DwtControl.findControl(e);\nif(!g){return\n}var a=g._dlScrollDiv;\nif(a.clientHeight==a.scrollHeight){return\n}var c=appCtxt.getApp(ZmApp.CONTACTS).getDL(g._dlContact.getEmail());\nvar b=g.getDLSize();\nif(c&&(c.more||(b<c.list.length))){var d={scrollDiv:a,rowHeight:g._rowHeight,threshold:10,limit:ZmContact.DL_PAGE_SIZE,listSize:b};\nvar h=ZmListView.getRowsNeeded(d);\nif(h){var i=new AjxCallback(null,ZmContactSplitView._handleResponseDLScroll,[g]);\ng._dlContact.getDLMembers(b,null,i)\n}}};\nZmContactSplitView._handleResponseDLScroll=function(g,m){var e=m.list;\nif(!(e&&e.length)){return\n}var c=[];\ng._listPart._getImageHtml(c,0,null);\nvar a={first:false,html:c};\nvar l=document.getElementById(g._dlLastRowId);\nvar k=l&&document.getElementById(g._detailsId);\nif(l){var f=l.rowIndex+1;\nfor(var b=0,d=e.length;\nb<d;\nb++){g._distributionList.list.push(e[b]);\na.value=g._objectManager.findObjects(e[b],false,ZmObjectManager.EMAIL);\nvar h=\"\";\nvar j=k.insertRow(f+b);\nif(b==d-1){j.id=g._dlLastRowId=Dwt.getNextId()\n}j.valign=\"top\";\nj.innerHTML=AjxTemplate.expand(\"abook.Contacts#SplitView_dlmember-expanded\",a)\n}}};\nZmContactSplitView.prototype.getDLSize=function(){return this._distributionList&&this._distributionList.list.length\n};\nZmContactSplitView.prototype._handleResponseLoad=function(c,d,b,a){if(a.id==this._contact.id){this._setContact(this._contact,c,d)\n}};\nZmContactSplitView.prototype._handleErrorLoad=function(a){this.clear()\n};\nZmContactSplitView.prototype.clear=function(){var a=document.getElementById(this._contactBodyId);\nif(a){a.innerHTML=\"\"\n}this._contactView.clear();\nthis._clearTags()\n};\nZmContactSplitView.prototype.enableAlphabetBar=function(a){if(this._alphabetBar){this._alphabetBar.enable(a)\n}};\nZmContactSplitView.prototype.showAlphabetBar=function(a){if(this._alphabetBar){this._alphabetBar.setVisible(a)\n}};\nZmContactSplitView.prototype._initialize=function(b,a){this.getHtmlElement().innerHTML=AjxTemplate.expand(\"abook.Contacts#SplitView\",{id:this._htmlElId});\nvar e=this._htmlElId+\"_alphabetbar\";\nvar d=document.getElementById(e);\nif(d&&ZmMsg.alphabet&&ZmMsg.alphabet.length>0){this._alphabetBar=new ZmContactAlphabetBar(this);\nthis._alphabetBar.reparentHtmlElement(e)\n}var h=this._htmlElId+\"_splitview\";\nthis._splitviewCell=document.getElementById(h);\nvar f=this._htmlElId+\"_listview\";\nthis._listviewCell=document.getElementById(f);\nthis._listPart=new ZmContactSimpleView({parent:this,controller:b,dropTgt:a});\nthis._listPart.reparentHtmlElement(f);\nvar g=this._htmlElId+\"_sash\";\nthis._sash=new DwtSash(this,DwtSash.HORIZONTAL_STYLE,null,5,Dwt.ABSOLUTE_STYLE);\nthis._sash.registerCallback(this._sashCallback,this);\nthis._sash.replaceElement(g,false,true);\nvar c=this._htmlElId+\"_contentCell\";\nthis._contentCell=document.getElementById(c);\nthis._iconCellId=this._htmlElId+\"_icon\";\nthis._titleCellId=this._htmlElId+\"_title\";\nthis._tagCellId=this._htmlElId+\"_tags_contact\";\nthis._contactBodyId=this._htmlElId+\"_body\";\nthis._contentId=this._htmlElId+\"_content\";\nthis._detailsId=this._htmlElId+\"_details\";\nthis._contactView=new ZmContactView({parent:this,controller:this._controller});\nthis._contactView.reparentHtmlElement(this._contentId);\nthis._objectManager=new ZmObjectManager(this._contactView);\nthis._contentCell.style.right=\"0px\";\nthis._tabGroup=new DwtTabGroup(\"ZmContactSplitView\");\nthis._tabGroup.addMember(this._contactView.getTabGroupMember())\n};\nZmContactSplitView.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nZmContactSplitView.prototype._tabStateChangeListener=function(a){this._setContact(this._contact,this._isGalSearch)\n};\nZmContactSplitView.prototype._sizeChildren=function(c,a){var b=Dwt.toWindow(this._listPart.getHtmlElement(),0,0);\nvar d=b.y-this.getY();\nthis._listPart.setSize(Dwt.DEFAULT,a-d);\nd=this._contactView.getY()-this.getY();\nthis._contactView.setSize(Dwt.DEFAULT,a-d)\n};\nZmContactSplitView.prototype._contactChangeListener=function(a){if(a.type!=ZmEvent.S_CONTACT||a.source!=this._contact||a.event==ZmEvent.E_DELETE){return\n}this._setContact(a.source)\n};\nZmContactSplitView.prototype._addrbookTreeListener=function(g,d){if(!this._contact){return\n}var b=g.getDetail(\"fields\");\nif(g.event==ZmEvent.E_MODIFY&&b&&b[ZmOrganizer.F_COLOR]){var e=g.getDetail(\"organizers\");\nif(!e&&g.source){e=[g.source]\n}for(var f=0;\nf<e.length;\nf++){var a=e[f];\nvar c=this._contact.isShared()?appCtxt.getById(this._contact.folderId).id:this._contact.folderId;\nif(a.id==c){this._setTags()\n}}}};\nZmContactSplitView.prototype._setContact=function(g,j,h,a,m){if(g.isDistributionList()&&!m){var f=this._setContact.bind(this,g,j,h,a,true);\ng.gatherExtraDlStuff(f);\nreturn\n}var b=g.getAddressBook();\nvar d=b?b.color:ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.ADDRBOOK];\nvar c={id:this._htmlElId,contact:g,addrbook:b,contactHdrClass:(ZmOrganizer.COLOR_TEXT[d]+\"Bg\"),isInTrash:(b&&b.isInTrash())};\nif(g.isGroup()){this._objectManager.reset();\nif(b){c.folderIcon=b.getIcon();\nc.folderName=b.getName()\n}if(g.isDistributionList()){var i=c.dlInfo=g.dlInfo\n}c.groupMembers=g.getAllGroupMembers();\nc.findObjects=this._objectManager.findObjects.bind(this._objectManager);\nthis._resetVisibility(true);\nthis._contactView.createHtml(\"abook.Contacts#SplitViewGroup\",c);\nif(g.isDistributionList()){if(this._subscriptionButton){this._subscriptionButton.dispose()\n}this._subscriptionButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_subscriptionButton\")});\nthis._subscriptionButton.setEnabled(true);\nthis._subscriptionMsg=document.getElementById(this._htmlElId+\"_subscriptionMsg\");\nthis._updateSubscriptionButtonAndMsg(g);\nvar e=new AjxListener(this,this._subscriptionListener,g);\nthis._subscriptionButton.addSelectionListener(e)\n}var l=this.getSize();\nthis._sizeChildren(l.x,l.y)\n}else{c.view=this;\nc.isGal=j;\nc.findObjects=this._objectManager.findObjects.bind(this._objectManager);\nc.attrs=g.getNormalizedAttrs();\nc.expandDL=a;\nif(g.isDL&&g.canExpand){this._dlContact=g;\nthis._dlScrollDiv=this._dlScrollDiv||document.getElementById(this._contentId);\nvar k=new AjxCallback(this,this._showDL,[c]);\ng.getDLMembers(0,null,k);\nreturn\n}this._showContact(c)\n}this._setTags();\nDwt.setLoadedTime(\"ZmContactItem\")\n};\nZmContactSplitView.prototype.dispose=function(){ZmTagsHelper.disposeListeners(this);\nDwtComposite.prototype.dispose.apply(this,arguments)\n};\nZmContactSplitView.prototype._showContact=function(a){this._objectManager.reset();\nthis._resetVisibility(false);\na.defaultImageUrl=ZmZimbraMail.DEFAULT_CONTACT_ICON;\nthis._contactView.createHtml(\"abook.Contacts#SplitView_content\",a);\nappCtxt.notifyZimlets(\"onContactView\",[a.contact,this._htmlElId])\n};\nZmContactSplitView.prototype._subscriptionListener=function(a,d){var b=!a.dlInfo.isMember;\nthis._subscriptionButton.setEnabled(false);\nvar c=this._handleSubscriptionResponse.bind(this,a,b);\na.toggleSubscription(c)\n};\nZmContactSplitView.prototype._handleSubscriptionResponse=function(h,c,j){var f=j._data.SubscribeDistributionListResponse.status;\nvar g=f==\"subscribed\";\nvar d=f==\"unsubscribed\";\nvar e=f==\"awaiting_approval\";\nthis._subscriptionButton.setEnabled(!e);\nif(!e){h.dlInfo.isMember=g\n}if(g||d){h.clearDlInfo();\nh._notify(ZmEvent.E_MODIFY)\n}var b=g?ZmMsg.dlSubscribed:d?ZmMsg.dlUnsubscribed:e&&c?ZmMsg.dlSubscriptionRequested:e&&!c?ZmMsg.dlUnsubscriptionRequested:\"\";\nvar i=appCtxt.getMsgDialog();\nvar a=h.getEmail();\ni.setMessage(AjxMessageFormat.format(b,a),DwtMessageDialog.INFO_STYLE);\ni.popup()\n};\nZmContactSplitView.prototype._updateSubscriptionButtonAndMsg=function(a){var d=a.dlInfo;\nvar e=d.isMember?d.unsubscriptionPolicy:d.subscriptionPolicy;\nif(e==ZmContactSplitView.SUBSCRIPTION_POLICY_REJECT){this._subscriptionButton.setVisible(false)\n}else{this._subscriptionButton.setVisible(true);\nthis._subscriptionButton.setText(d.isMember?ZmMsg.dlUnsubscribe:ZmMsg.dlSubscribe)\n}var c=d.isOwner&&d.isMember?ZmMsg.youAreOwnerAndMember:d.isOwner?ZmMsg.youAreOwner:d.isMember?ZmMsg.youAreMember:\"\";\nif(c!=\"\"){c=\"<li>\"+c+\"</li>\"\n}var b;\nif(!d.isMember){b=e==ZmContactSplitView.SUBSCRIPTION_POLICY_APPROVAL?ZmMsg.dlSubscriptionRequiresApproval:e==ZmContactSplitView.SUBSCRIPTION_POLICY_REJECT?ZmMsg.dlSubscriptionNotAllowed:\"\"\n}else{b=e==ZmContactSplitView.SUBSCRIPTION_POLICY_APPROVAL?ZmMsg.dlUnsubscriptionRequiresApproval:e==ZmContactSplitView.SUBSCRIPTION_POLICY_REJECT?ZmMsg.dlUnsubscriptionNotAllowed:\"\"\n}if(b!=\"\"){b=\"<li>\"+b+\"</li>\"\n}this._subscriptionMsg.innerHTML=c+b\n};\nZmContactSplitView._getListData=function(c,b,a){var d={id:c.id,attrs:c.attrs,labelId:c.id+\"_\"+b.replace(/[^\\w]/g,\"\"),label:b,first:true};\nif(a){d.findObjects=c.findObjects;\nd.objectType=a\n}d.isDL=c.contact.isDL;\nreturn d\n};\nZmContactSplitView._showContactList=function(e,f,d,g){e.names=f;\nvar c=[];\nfor(var b=0;\nb<f.length;\nb++){var a=f[b];\ne.name=a;\ne.type=(d&&d(e,a))||ZmMsg[\"AB_FIELD_\"+a];\ne.type=g?\"\":e.type;\nc.push(ZmContactSplitView._showContactListItem(e))\n}return c.join(\"\")\n};\nZmContactSplitView._showContactListItem=function(c){var f=(c.objectType==ZmObjectManager.EMAIL);\nvar d=0;\nvar e=[];\nwhile(true){c.name1=++d>1||ZmContact.IS_ADDONE[c.name]?c.name+d:c.name;\nvar l=c.attrs[c.name1];\nif(!l){break\n}c.name1=AjxStringUtil.htmlEncode(c.name1);\nc.type=AjxStringUtil.htmlEncode(c.type);\nl=AjxUtil.toArray(l);\nfor(var b=0;\nb<l.length;\nb++){var k=l[b];\nif(!f){k=AjxStringUtil.htmlEncode(k)\n}if(ZmContact.IS_DATE[c.name]){var a=ZmEditContactViewOther.parseDate(k);\nif(a){var g=a.getFullYear()!=0;\nvar h=g?AjxDateFormat.getDateInstance(AjxDateFormat.LONG):new AjxDateFormat(ZmMsg.formatDateLongNoYear);\nk=h.format(a)\n}}if(c.findObjects){k=c.findObjects(k,c.objectType)\n}if(c.encode){k=c.encode(k)\n}c.value=k;\ne.push(AjxTemplate.expand(\"#SplitView_list_item\",c))\n}c.first=false\n}return e.join(\"\")\n};\nZmContactSplitView.showContactEmails=function(b){var c=ZmContactSplitView._getListData(b,ZmMsg.emailLabel,ZmObjectManager.EMAIL);\nvar a=function(e,d){return e.isDL&&ZmMsg.distributionList\n};\nreturn ZmContactSplitView._showContactList(c,ZmEditContactView.LISTS.EMAIL.attrs,a,!b.isDL)\n};\nZmContactSplitView.showContactPhones=function(a){var b=ZmContactSplitView._getListData(a,ZmMsg.phoneLabel,ZmObjectManager.PHONE);\nreturn ZmContactSplitView._showContactList(b,ZmEditContactView.LISTS.PHONE.attrs)\n};\nZmContactSplitView.showContactIMs=function(a){var b=ZmContactSplitView._getListData(a,ZmMsg.imLabel);\nreturn ZmContactSplitView._showContactList(b,ZmEditContactView.LISTS.IM.attrs)\n};\nZmContactSplitView.showContactAddresses=function(d){var c=ZmContactSplitView._getListData(d,ZmMsg.addressLabel);\nvar l={work:ZmMsg.work,home:ZmMsg.home,other:ZmMsg.other};\nvar e=ZmContact.ADDR_PREFIXES;\nvar o=ZmContact.ADDR_SUFFIXES;\nvar g=[];\nfor(var f=0;\nf<e.length;\nf++){var k=0;\nvar h=e[f];\nc.type=l[h]||h;\nwhile(true){k++;\nc.address=null;\nfor(var b=0;\nb<o.length;\nb++){var n=o[b];\nvar a=[h,n,k>1?k:\"\"].join(\"\");\nvar m=d.attrs[a];\nif(!m){continue\n}m=AjxStringUtil.htmlEncode(m);\nif(!c.address){c.address={}\n}c.address[n]=m.replace(/\\n/g,\"<br/>\")\n}if(!c.address){break\n}c.name=[h,\"Address\",k>1?k:\"\"].join(\"\");\ng.push(AjxTemplate.expand(\"#SplitView_address_value\",c));\nc.first=false\n}}return g.join(\"\")\n};\nZmContactSplitView.showContactUrls=function(b){var c=ZmContactSplitView._getListData(b,ZmMsg.urlLabel,ZmObjectManager.URL);\nvar a=function(e,d){return ZmMsg[\"AB_FIELD_\"+d.replace(\"URL\",\"\")]\n};\nreturn ZmContactSplitView._showContactList(c,ZmEditContactView.LISTS.URL.attrs,a)\n};\nZmContactSplitView.showContactOther=function(g){var f=ZmContactSplitView._getListData(g,ZmMsg.otherLabel);\nf.findObjects=g.findObjects;\nvar h=[];\nh.push(ZmContactSplitView._showContactList(f,ZmEditContactView.LISTS.OTHER.attrs));\nvar n={};\nfor(var m in f.attrs){var l=ZmContact.getPrefix(m);\nif(l in ZmContact.IS_IGNORE){continue\n}n[l]=true\n}for(var b in ZmEditContactView.ATTRS){delete n[ZmEditContactView.ATTRS[b]]\n}for(var b in ZmEditContactView.LISTS){var k=ZmEditContactView.LISTS[b];\nif(!k.attrs){continue\n}for(var e=0;\ne<k.attrs.length;\ne++){delete n[k.attrs[e]]\n}}var d=ZmContact.ADDR_PREFIXES;\nvar o=ZmContact.ADDR_SUFFIXES;\nfor(var e=0;\ne<d.length;\ne++){for(var c=0;\nc<o.length;\nc++){delete n[d[e]+o[c]]\n}}for(var m in n){if(m===\"notesHtml\"){continue\n}f.name=m;\nf.type=AjxStringUtil.capitalizeWords(AjxStringUtil.fromMixed(m));\nh.push(ZmContactSplitView._showContactListItem(f))\n}return h.join(\"\")\n};\nZmContactSplitView.showContactNotes=function(a){var b=ZmContactSplitView._getListData(a,ZmMsg.notesLabel);\nb.encode=AjxStringUtil.nl2br;\nb.name=ZmContact.F_notes;\nb.names=[ZmContact.F_notes];\nreturn ZmContactSplitView._showContactListItem(b)\n};\nZmContactSplitView.showContactDLMembers=function(g){var h=[];\nvar e={contact:g.contact};\nif(g.dl){var l=g.dl.list;\nvar q=g.contact.canExpand&&(l.length>ZmContactSplitView.NUM_DL_MEMBERS||g.dl.more);\nvar c=g.view._listPart;\nvar a=c._expandId=Dwt.getNextId();\nvar j=\"\",p=\"\";\nvar m=[];\nvar k=Math.min(l.length,ZmContactSplitView.NUM_DL_MEMBERS);\nfor(var f=0;\nf<k;\nf++){m.push(g.findObjects?g.findObjects(l[f],true,ZmObjectManager.EMAIL):l[f])\n}if(q){if(!g.expandDL){m.push(\" ... \")\n}j=\"style='cursor:pointer;'\";\nvar n='\"'+g.id+'\"';\nvar d=g.expandDL?\"false\":\"true\";\np=\"onclick='ZmContactSplitView.expandDL(\"+n+\", \"+d+\");'\"\n}e.value=m.join(\", \");\ne.expandTdText=[j,p].join(\" \");\nif(!g.expandDL){e.html=[];\nc._getImageHtml(e.html,0,q?\"NodeCollapsed\":null,a);\nh.push(\"<tr valign='top'>\");\nh.push(AjxTemplate.expand(\"abook.Contacts#SplitView_dlmember-collapsed\",e));\nh.push(\"</tr>\")\n}else{e.first=true;\nfor(var f=0,k=l.length;\nf<k;\nf++){e.value=l[f];\nif(g.findObjects){e.value=g.findObjects(e.value,true,ZmObjectManager.EMAIL)\n}e.html=[];\nc._getImageHtml(e.html,0,e.first?\"NodeExpanded\":null,a);\nvar o=\"\";\nif(f==k-1){var b=g.view._dlLastRowId=Dwt.getNextId();\no=\"id='\"+b+\"'\"\n}h.push(\"<tr valign='top' \"+o+\">\");\nh.push(AjxTemplate.expand(\"abook.Contacts#SplitView_dlmember-expanded\",e));\nh.push(\"</tr>\");\ne.first=false\n}}}return h.join(\"\")\n};\nZmContactSplitView.showContactGroup=function(f){var d=[];\nif(!AjxUtil.isArray(f.groupMembers)){return\"\"\n}for(var c=0;\nc<f.groupMembers.length;\nc++){var h=f.groupMembers[c];\nvar g={};\nvar a=h.__contact;\nif(a){g.imageUrl=a.getImageUrl();\ng.defaultImageUrl=ZmZimbraMail.DEFAULT_CONTACT_ICON;\ng.imgClassName=a.getIconLarge();\ng.email=f.findObjects(a.getEmail(),true,ZmObjectManager.EMAIL);\ng.title=f.findObjects(a.getAttr(ZmContact.F_jobTitle),true,ZmObjectManager.TITLE);\ng.phone=f.findObjects(a.getPhone(),true,ZmObjectManager.PHONE);\nvar b=appCtxt.get(ZmSetting.PHONETIC_CONTACT_FIELDS);\nvar e=a.getFullNameForDisplay(b);\nif(!b){e=AjxStringUtil.htmlEncode(e)\n}g.fullName=e\n}else{g.imgClassName=\"PersonInline_48\";\ng.email=f.findObjects(h.value,true,ZmObjectManager.EMAIL)\n}d.push(AjxTemplate.expand(\"abook.Contacts#SplitView_group\",g))\n}return d.join(\"\")\n};\nZmContactSplitView.prototype._showDL=function(b,a){b.dl=this._distributionList=a;\nthis._showContact(b);\nthis._setTags();\nif(!this._rowHeight){var c=document.getElementById(this._detailsId);\nif(c){this._rowHeight=Dwt.getSize(c.rows[0]).y\n}}if(b.expandDL){Dwt.setHandler(this._dlScrollDiv,DwtEvent.ONSCROLL,ZmContactSplitView.handleDLScroll)\n}};\nZmContactSplitView.prototype._resetVisibility=function(a){};\nZmContactSplitView.prototype._setTags=function(){var a=ZmTagsHelper.getTagsHtml(this._item,this);\nthis._setTagsHtml(a)\n};\nZmContactSplitView.prototype._clearTags=function(){this._setTagsHtml(\"\")\n};\nZmContactSplitView.prototype._setTagsHtml=function(b){var a=document.getElementById(this._tagCellId);\nif(!a){return\n}a.innerHTML=b\n};\nZmContactSplitView.prototype._sashCallback=function(g){var e=this._sash.getSize().x;\nvar a=Dwt.getSize(this._splitviewCell).x;\nvar f=this._listPart.getSize().x;\nvar c=f+g;\nvar b=c+e;\nvar d=a-b;\nif(g<0&&c<=ZmContactSplitView.LIST_MIN_WIDTH){c=ZmContactSplitView.LIST_MIN_WIDTH;\nb=c+e;\nd=a-b\n}else{if(g>0&&d<=ZmContactSplitView.CONTENT_MIN_WIDTH){d=ZmContactSplitView.CONTENT_MIN_WIDTH;\nb=a-d;\nc=b-e\n}}g=c-f;\nthis._listPart.setSize(c,Dwt.DEFAULT);\nDwt.setBounds(this._contentCell,b,Dwt.DEFAULT,d,Dwt.DEFAULT);\nreturn g\n};\nZmContactView=function(a){DwtComposite.call(this,{parent:a.parent});\nthis._controller=a.controller;\nthis._tabGroup=new DwtTabGroup(\"ZmContactView\");\nthis.addListener(DwtEvent.ONSELECTSTART,this._selectStartListener.bind(this));\nthis._setMouseEventHdlrs()\n};\nZmContactView.prototype=new DwtControl;\nZmContactView.prototype.constructor=ZmContactView;\nZmContactView.prototype.isZmContactView=true;\nZmContactView.prototype.role=\"document\";\nZmContactView.prototype.toString=function(){return\"ZmContactView\"\n};\nZmContactView.prototype.getTabGroupMember=function(){return this._tabGroup\n};\nZmContactView.prototype._selectStartListener=function(a){a._stopPropagation=false;\na._returnValue=true\n};\nZmContactView.prototype.clear=function(){this.getTabGroupMember().removeAllMembers();\nDwt.removeChildren(this.getHtmlElement())\n};\nZmContactView.prototype.createHtml=function(a,b){this._createHtmlFromTemplate(a,b);\nvar c=Dwt.byClassName(\"rowValue\",this.getHtmlElement());\nthis.getTabGroupMember().removeAllMembers();\nthis.getTabGroupMember().addMember(c[0]);\nAjxUtil.foreach(c,this._makeRowFocusable.bind(this))\n};\nZmContactView.prototype._makeRowFocusable=function(c){this._makeFocusable(c);\nvar b=Dwt.byClassName(\"Object\",c);\nfor(var a=0;\na<b.length;\na++){this._makeFocusable(b[a]);\nthis.getTabGroupMember().addMember(b[a]);\nb[a].setAttribute(\"aria-describedby\",c.getAttribute(\"aria-labelledby\"))\n}};\nZmContactSimpleView=function(a){if(arguments.length==0){return\n}this._view=a.view=a.controller.getCurrentViewId();\na.className=\"ZmContactSimpleView\";\nZmContactsBaseView.call(this,a);\nthis._normalClass=DwtListView.ROW_CLASS+\" SimpleContact\";\nthis._selectedClass=[DwtListView.ROW_CLASS,DwtCssStyle.SELECTED].join(\"-\")\n};\nZmContactSimpleView.prototype=new ZmContactsBaseView;\nZmContactSimpleView.prototype.constructor=ZmContactSimpleView;\nZmContactSimpleView.prototype.isZmContactSimpleView=true;\nZmContactSimpleView.prototype.toString=function(){return\"ZmContactSimpleView\"\n};\nZmContactSimpleView.prototype.set=function(d,b,a,c){var e=a||this._controller.getFolderId();\nZmContactsBaseView.prototype.set.call(this,d,b,e);\nif(!(this._list instanceof AjxVector)||this._list.size()==0){this.parent.clear()\n}this.parent.showAlphabetBar(!c);\nthis.parent.enableAlphabetBar(e!=ZmOrganizer.ID_DLS)\n};\nZmContactSimpleView.prototype.setSelection=function(b,a){if(!b){this.parent.clear()\n}ZmContactsBaseView.prototype.setSelection.call(this,b,a)\n};\nZmContactSimpleView.prototype._setNoResultsHtml=function(){var b=document.createElement(\"div\");\nvar a=this._controller._contactSearchResults;\nif(a){a=!(this._controller._currentSearch&&this._controller._currentSearch.folderId)\n}if((a||this._folderId==ZmFolder.ID_TRASH)&&AjxTemplate.getTemplate(\"abook.Contacts#SimpleView-NoResults-Search\")){b.innerHTML=AjxTemplate.expand(\"abook.Contacts#SimpleView-NoResults-Search\")\n}else{b.innerHTML=AjxTemplate.expand(\"abook.Contacts#SimpleView-NoResults\")\n}this._addRow(b);\nthis.parent.clear()\n};\nZmContactSimpleView.prototype._changeListener=function(d){ZmContactsBaseView.prototype._changeListener.call(this,d);\nvar b=this._controller.getFolderId();\nif(!b&&d.event==ZmEvent.E_MOVE){if(!d._details.items){d._details.items=d.items\n}var a=d._details.items[0];\nvar c=appCtxt.getById(a.folderId);\nvar e=this._getElement(a,ZmItem.F_ITEM_ROW);\nif(e){e.className=(c&&c.isInTrash())?\"Trash\":\"\"\n}}};\nZmContactSimpleView.prototype._modifyContact=function(b){ZmContactsBaseView.prototype._modifyContact.call(this,b);\nif(b.getDetail(\"fileAsChanged\")){var a=this.getSelection()[0];\nthis._layout();\nthis.setSelection(a,true)\n}};\nZmContactSimpleView.prototype._layout=function(){while(this._parentEl.hasChildNodes()){cDiv=this._parentEl.removeChild(this._parentEl.firstChild);\nthis._data[cDiv.id]=null\n}var a=new Date();\nvar c=this._list.size();\nfor(var b=0;\nb<c;\nb++){var d=this._list.get(b);\nvar e=d?this._createItemHtml(d,{now:a}):null;\nif(e){this._addRow(e)\n}}};\nZmContactSimpleView.prototype.useListElement=function(){return true\n};\nZmContactSimpleView.prototype._createItemHtml=function(f,d,g,e){d=d||{};\nvar i=[];\nvar h=0;\nif(!d.isDragProxy){d.divClass=this._normalClass\n}if(g){h=this._getDivHtml(f,d,i,h,e)\n}else{var b=this._getDiv(f,d)\n}var c=this._folderId&&appCtxt.getById(this._folderId);\nif(b){if(d.isDragProxy){b.style.width=\"175px\";\nb.style.padding=\"4px\"\n}}h=this._getRow(i,h,f,d);\nif(appCtxt.get(ZmSetting.SHOW_SELECTION_CHECKBOX)){h=this._getImageHtml(i,h,\"CheckboxUnchecked\",this._getFieldId(f,ZmItem.F_SELECTION))\n}i[h++]=AjxImg.getImageHtml(f.getIcon(c),null,\"id=\"+this._getFieldId(f,\"type\"),null,null,[\"ZmContactIcon\"]);\ni[h++]=\"<div id='\"+this._getFieldId(f,\"fileas\")+\"'>\";\ni[h++]=AjxStringUtil.htmlEncode(f.getFileAs()||f.getFileAsNoName());\ni[h++]=\"</div>\";\ni[h++]=\"<div class='ZmListFlagsWrapper'>\";\nif(!d.isDragProxy){var a=c?c.link&&c.isReadOnly():f.isLocked();\nif(a){i[h++]=AjxImg.getImageHtml(\"ReadOnly\")\n}else{if(!f.isReadOnly()&&appCtxt.get(ZmSetting.TAGGING_ENABLED)){h=this._getImageHtml(i,h,f.getTagImageInfo(),this._getFieldId(f,ZmItem.F_TAG),[\"Tag\"])\n}}}i[h++]=\"</div></div></li>\";\nif(b){b.innerHTML=i.join(\"\");\nreturn b\n}else{return i.join(\"\")\n}};\nZmContactSimpleView.prototype._getToolTip=function(c){var b={contact:c.item,ev:c.ev};\nvar a=new AjxCallback(this,function(d){appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,b,d)\n});\nreturn{callback:a}\n};\nZmContactSimpleView.prototype._getDateToolTip=function(a,b){b._dateStr=b._dateStr||this._getDateToolTipText(a.modified,[\"<b>\",ZmMsg.lastModified,\"</b><br>\"].join(\"\"));\nreturn b._dateStr\n}\n}if(AjxPackage.define(\"zimbraMail.abook.view.ZmNewAddrBookDialog\")){ZmNewAddrBookDialog=function(c,b){var d=ZmMsg.createNewAddrBook;\nvar a=ZmOrganizer.ADDRBOOK;\nZmNewOrganizerDialog.call(this,c,b,d,a)\n};\nZmNewAddrBookDialog.prototype=new ZmNewOrganizerDialog;\nZmNewAddrBookDialog.prototype.constructor=ZmNewAddrBookDialog;\nZmNewAddrBookDialog.prototype.toString=function(){return\"ZmNewAddrBookDialog\"\n};\nZmNewAddrBookDialog.prototype._initColorSelect=function(){var a=this._colorSelect.getOptionWithValue(ZmOrganizer.DEFAULT_COLOR[this._organizerType]);\nthis._colorSelect.setSelectedOption(a)\n};\nZmNewAddrBookDialog.prototype._createRemoteContentHtml=function(b,a){return a\n};\nZmNewAddrBookDialog.prototype._setupFolderControl=function(){ZmNewOrganizerDialog.prototype._setupFolderControl.call(this);\nif(this._omit){this._omit[ZmFolder.ID_TRASH]=true;\nthis._omit[ZmFolder.ID_DLS]=true\n}var d=appCtxt.getFolderTree();\nif(!d){return\n}var b=d.getByType(this._organizerType);\nfor(var a=0;\na<b.length;\na++){var c=b[a];\nif(c.isReadOnly()){this._omit[c.id]=true\n}}}\n}if(AjxPackage.define(\"zimbraMail.abook.view.ZmNewContactGroupDialog\")){ZmNewContactGroupDialog=function(b,a){ZmDialog.call(this,{parent:b,className:a,title:ZmMsg.createNewContactGroup,id:\"CreateContactGroupDialog\"});\nthis._setNameField(this._htmlElId+\"_name\")\n};\nZmNewContactGroupDialog.prototype=new ZmDialog;\nZmNewContactGroupDialog.prototype.constructor=ZmNewContactGroupDialog;\nZmNewContactGroupDialog.prototype.toString=function(){return\"ZmNewContactGroupDialog\"\n};\nZmNewContactGroupDialog.prototype.popup=function(c,a){if(this._accountSelect){var b=a||appCtxt.getActiveAccount();\nthis._accountSelect.setSelectedValue(b.id)\n}ZmDialog.prototype.popup.call(this)\n};\nZmNewContactGroupDialog.prototype.cleanup=function(a){DwtDialog.prototype.cleanup.call(this,a)\n};\nZmNewContactGroupDialog.prototype._contentHtml=function(){return AjxTemplate.expand(\"share.Dialogs#ZmContactGroupDialog\",{id:this._htmlElId})\n};\nZmNewContactGroupDialog.prototype._okButtonListener=function(b){var a=this._getContactGroupData();\nif(a){DwtDialog.prototype._buttonListener.call(this,b,a)\n}};\nZmNewContactGroupDialog.prototype._getContactGroupData=function(){var a=AjxStringUtil.trim(this._nameField.value);\nif(a==\"\"){return this._showError(ZmMsg.errorGroupName)\n}var b={name:a};\nreturn b\n};\nZmNewContactGroupDialog.prototype._enterListener=function(b){var a=this._getContactGroupData();\nif(a){this._runEnterCallback(a)\n}};\nZmNewContactGroupDialog.prototype._getTabGroupMembers=function(){return[this._nameField]\n}\n}if(AjxPackage.define(\"zimbraMail.abook.view.ZmContactQuickAddDialog\")){ZmContactQuickAddDialog=function(){ZmDialog.call(this,{parent:appCtxt.getShell(),className:\"ZmContactQuickAddDialog\",title:ZmMsg.quickAddContact,standardButtons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]});\nthis.setContent(this._contentHtml());\nthis._initialize();\nthis.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._saveListener))\n};\nZmContactQuickAddDialog.prototype=new ZmDialog;\nZmContactQuickAddDialog.prototype.constructor=ZmContactQuickAddDialog;\nZmContactQuickAddDialog.prototype._contentHtml=function(){var a=\"<div style='width: 350px' id='CONTACT_QUICKADD_FORM'></div>\";\nreturn a\n};\nZmContactQuickAddDialog.prototype._initialize=function(){var b={};\nb.parent=this;\nb.template=\"abook.Contacts#QuickAddPrompt\";\nb.id=\"ZmContactQuickAddDialog\";\nb.form={items:[{id:\"FIRST_NAME\",type:\"DwtInputField\",label:\"First Name\",value:\"\",cols:35},{id:\"LAST_NAME\",type:\"DwtInputField\",label:\"Last Name\",value:\"\",cols:35},{id:\"EMAIL\",type:\"DwtInputField\",label:\"Email\",value:\"\",cols:35},{id:\"ADDR_BOOK\",type:\"DwtSelect\",items:[]}]};\nthis._quickAddForm=new DwtForm(b);\nvar a=document.getElementById(\"CONTACT_QUICKADD_FORM\");\nthis._quickAddForm.appendElement(a)\n};\nZmContactQuickAddDialog.prototype.popup=function(a){this._saveCallback=a;\nthis._updateAddressBooks();\nZmDialog.prototype.popup.call(this);\nthis._quickAddForm.getControl(\"FIRST_NAME\").focus()\n};\nZmContactQuickAddDialog.prototype.setFields=function(c){if(this._quickAddForm){var a=this._quickAddForm.getControl(\"EMAIL\");\na.setValue(c);\nvar d=this._quickAddForm.getControl(\"FIRST_NAME\");\nd.setValue(\"\");\nvar b=this._quickAddForm.getControl(\"LAST_NAME\");\nb.setValue(\"\")\n}};\nZmContactQuickAddDialog.prototype._saveListener=function(){var e=this._quickAddForm.getControl(\"FIRST_NAME\");\nvar d=this._quickAddForm.getControl(\"LAST_NAME\");\nvar c=this._quickAddForm.getControl(\"EMAIL\");\nvar g=this._quickAddForm.getControl(\"ADDR_BOOK\");\nvar b=new ZmContact(null,null,ZmItem.CONTACT);\nvar a={};\na[ZmContact.F_firstName]=e.getValue();\na[ZmContact.F_lastName]=d.getValue();\na[ZmContact.F_email]=c.getValue();\na[ZmContact.F_folderId]=g.getValue();\nvar f=new ZmBatchCommand(false,null,true);\nf.add(new AjxCallback(b,b.create,[a]));\nif(this._saveCallback){f.run(this._saveCallback,[b])\n}this.popdown()\n};\nZmContactQuickAddDialog.prototype._getAddressBooks=function(){var c=appCtxt.getFolderTree();\nvar b=c.getByType(ZmOrganizer.ADDRBOOK);\nfor(var a=0;\na<b.length;\na++){if(b[a].isReadOnly()){b.splice(a,1)\n}}return b\n};\nZmContactQuickAddDialog.prototype._updateAddressBooks=function(){var b=this._quickAddForm.getControl(\"ADDR_BOOK\");\nb.clearOptions();\nvar d=this._getAddressBooks();\nfor(var c=0;\nc<d.length;\nc++){if(d[c].id==ZmFolder.ID_DLS){continue\n}var a=new DwtSelectOption(d[c].nId,false,d[c].name);\nb.addOption(a)\n}};\nZmContactQuickAddDialog.prototype._getTabGroupMembers=function(){var c=this._quickAddForm.getControl(\"FIRST_NAME\");\nvar b=this._quickAddForm.getControl(\"LAST_NAME\");\nvar a=this._quickAddForm.getControl(\"EMAIL\");\nvar d=this._quickAddForm.getControl(\"ADDR_BOOK\");\nreturn[c,b,a,d]\n}\n}if(AjxPackage.define(\"zimbraMail.abook.controller.ZmContactListController\")){ZmContactListController=function(a,e,b,d,c){if(arguments.length==0){return\n}ZmListController.apply(this,arguments);\nthis._viewFactory={};\nthis._viewFactory[ZmId.VIEW_CONTACT_SIMPLE]=ZmContactSplitView;\nif(this.supportsDnD()){this._dragSrc=new DwtDragSource(Dwt.DND_DROP_MOVE);\nthis._dragSrc.addDragListener(this._dragListener.bind(this))\n}this._listChangeListener=this._handleListChange.bind(this);\nthis._listeners[ZmOperation.EDIT]=this._editListener.bind(this);\nthis._listeners[ZmOperation.PRINT]=null;\nthis._listeners[ZmOperation.PRINT_CONTACT]=this._printListener.bind(this);\nthis._listeners[ZmOperation.PRINT_ADDRBOOK]=this._printAddrBookListener.bind(this);\nthis._listeners[ZmOperation.NEW_GROUP]=this._groupListener.bind(this);\nthis._parentView={}\n};\nZmContactListController.prototype=new ZmListController;\nZmContactListController.prototype.constructor=ZmContactListController;\nZmContactListController.prototype.isZmContactListController=true;\nZmContactListController.prototype.toString=function(){return\"ZmContactListController\"\n};\nZmContactListController.ICON={};\nZmContactListController.ICON[ZmId.VIEW_CONTACT_SIMPLE]=\"ListView\";\nZmContactListController.MSG_KEY={};\nZmContactListController.MSG_KEY[ZmId.VIEW_CONTACT_SIMPLE]=\"contactList\";\nZmContactListController.SEARCH_TYPE_CANONICAL=1<<0;\nZmContactListController.SEARCH_TYPE_GAL=1<<1;\nZmContactListController.SEARCH_TYPE_NEW=1<<2;\nZmContactListController.SEARCH_TYPE_ANYWHERE=1<<3;\nZmContactListController.VIEWS=[ZmId.VIEW_CONTACT_SIMPLE];\nZmContactListController.prototype.show=function(a,d,c){this._searchType=d?ZmContactListController.SEARCH_TYPE_GAL:ZmContactListController.SEARCH_TYPE_CANONICAL;\nthis._folderId=c;\nvar f;\nif(a.isZmContactList){this.setList(a);\nthis._list._isShared=false;\nf=this._listView[this._currentViewId]&&this._listView[this._currentViewId].getSelection();\nthis._contactSearchResults=false\n}else{if(a.isZmSearchResult){this._searchType|=ZmContactListController.SEARCH_TYPE_NEW;\nthis.setList(a.getResults(ZmItem.CONTACT));\nif(a.search&&a.search.isAnywhere()){this._searchType|=ZmContactListController.SEARCH_TYPE_ANYWHERE\n}if(a.search&&a.search.userText&&this.getCurrentView()){this.getCurrentView().getAlphabetBar().reset()\n}if(d){this._list=this._list||new ZmContactList(a.search,true);\nthis._list._isShared=false;\nthis._list.isGalPagingSupported=AjxUtil.isSpecified(a.getAttribute(\"offset\"))\n}else{var e=c?appCtxt.getById(c):null;\nthis._list._isShared=e?e.link:false\n}this._list.setHasMore(a.getAttribute(\"more\"));\nf=this._listView[this._currentViewId]&&this._listView[this._currentViewId].getSelection();\nZmListController.prototype.show.apply(this,[a,this._currentViewId]);\nthis._contactSearchResults=true\n}}var b=this._currentViewId;\nif(this._listView[b]){this._listView[b].offset=0\n}this.switchView(b,true);\nif(f&&f.length&&this._listView[b]){this._listView[b].setSelection(f[0])\n}};\nZmContactListController.prototype.switchView=function(a,f,h,b){if(a&&((a!=this._currentViewId)||f)){this._currentViewId=a;\nthis._setup(a);\nvar e=this.getViewElements(a,this._parentView[a]);\nif(!h){this._initializeAlphabetBar(a)\n}this._setView({view:a,viewType:this._currentViewType,noPush:this.isSearchResults,elements:e,isAppView:true,stageView:b});\nif(this.isSearchResults){appCtxt.getAppViewMgr().setViewComponents(this.searchResultsController.getCurrentViewId(),e,true)\n}this._resetNavToolBarButtons();\nif(this.isGalSearch()&&!this._list.isGalPagingSupported){appCtxt.getSearchController().setDefaultSearchType(ZmId.SEARCH_GAL);\nif(this._list.hasMore()){var g=appCtxt.getMsgDialog();\ng.setMessage(ZmMsg.errorSearchNotExpanded);\ng.popup()\n}}this._setTabGroup(this._tabGroups[a]);\nif(!h){var c=this._listView[a].getList();\nif(c){this._listView[a].setSelection(c.get(0))\n}}}};\nZmContactListController.prototype.getFolderId=function(){return this._folderId\n};\nZmContactListController.prototype.isGalSearch=function(){return((this._searchType&ZmContactListController.SEARCH_TYPE_GAL)!=0)\n};\nZmContactListController.prototype.getCurrentView=function(){return this._parentView[this._currentViewId]\n};\nZmContactListController.prototype.getParentView=ZmContactListController.prototype.getCurrentView;\nZmContactListController.prototype.searchAlphabet=function(d,a){var b=this._folderId||ZmFolder.ID_CONTACTS;\nvar c=appCtxt.getById(b);\nvar e=c?c.createQuery():null;\nif(e){var f={query:e,types:[ZmItem.CONTACT],offset:0,limit:(this._listView[this._currentViewId].getLimit()),lastId:0,lastSortVal:d,endSortVal:a};\nappCtxt.getSearchController().search(f)\n}};\nZmContactListController.prototype._getMoreSearchParams=function(a){a.endSortVal=this._activeSearch&&this._activeSearch.search&&this._activeSearch.search.endSortVal\n};\nZmContactListController.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_CONTACTS\n};\nZmContactListController.prototype.handleKeyAction=function(a){var b=appCtxt.isExternalAccount();\nvar c=appCtxt.isWebClientOffline();\nswitch(a){case ZmKeyMap.EDIT:if(b||c){break\n}this._editListener();\nbreak;\ncase ZmKeyMap.PRINT:if(appCtxt.get(ZmSetting.PRINT_ENABLED)&&!c){this._printListener()\n}break;\ncase ZmKeyMap.PRINT_ALL:if(appCtxt.get(ZmSetting.PRINT_ENABLED)&&!c){this._printAddrBookListener()\n}break;\ncase ZmKeyMap.NEW_MESSAGE:if(b){break\n}this._composeListener();\nbreak;\ndefault:return ZmListController.prototype.handleKeyAction.call(this,a)\n}return true\n};\nZmContactListController.prototype.mapSupported=function(a){return(a==\"list\")\n};\nZmContactListController.prototype._getToolBarOps=function(){var a=[];\na.push(ZmOperation.EDIT,ZmOperation.SEP,ZmOperation.DELETE,ZmOperation.SEP,ZmOperation.MOVE_MENU,ZmOperation.TAG_MENU,ZmOperation.SEP,ZmOperation.PRINT);\nreturn a\n};\nZmContactListController.prototype._getSecondaryToolBarOps=function(){if(appCtxt.isExternalAccount()){return[]\n}var a=[ZmOperation.SEARCH_MENU];\nif(appCtxt.get(ZmSetting.MAIL_ENABLED)){a.push(ZmOperation.NEW_MESSAGE)\n}a.push(ZmOperation.SEP,ZmOperation.CONTACTGROUP_MENU);\nreturn a\n};\nZmContactListController.prototype._getActionMenuOps=function(){var a=this._participantOps();\na.push(ZmOperation.SEP,ZmOperation.CONTACTGROUP_MENU,ZmOperation.TAG_MENU,ZmOperation.DELETE,ZmOperation.MOVE,ZmOperation.PRINT_CONTACT);\nreturn a\n};\nZmContactListController.getDefaultViewType=function(){return ZmId.VIEW_CONTACT_SIMPLE\n};\nZmContactListController.prototype.getDefaultViewType=ZmContactListController.getDefaultViewType;\nZmContactListController.prototype._createNewView=function(c){var d={parent:this._container,posStyle:Dwt.ABSOLUTE_STYLE,controller:this,dropTgt:this._dropTgt};\nvar a=this.getCurrentViewType();\nthis._parentView[c]=new this._viewFactory[a](d);\nvar b=this._parentView[c].getListView();\nif(this._dragSrc){b.setDragSource(this._dragSrc)\n}return b\n};\nZmContactListController.prototype._getTagMenuMsg=function(a){return AjxMessageFormat.format(ZmMsg.AB_TAG_CONTACTS,a)\n};\nZmContactListController.prototype._getMoveDialogTitle=function(a){return AjxMessageFormat.format(ZmMsg.AB_MOVE_CONTACTS,a)\n};\nZmContactListController.prototype._getMoveParams=function(g){var f=ZmListController.prototype._getMoveParams.apply(this,arguments);\nf.hideNewButton=!appCtxt.get(ZmSetting.NEW_ADDR_BOOK_ENABLED);\nvar e={};\nvar d=appCtxt.getFolderTree();\nif(!d){return f\n}var b=d.getByType(ZmOrganizer.ADDRBOOK);\nfor(var a=0;\na<b.length;\na++){var c=b[a];\nif(c.link&&c.isReadOnly()){e[c.id]=true\n}}f.omit=e;\nf.description=ZmMsg.targetAddressBook;\nreturn f\n};\nZmContactListController.prototype._getSearchFolderId=function(){return this._folderId\n};\nZmContactListController.prototype._initializeToolBar=function(b){if(!this._toolbar[b]){ZmListController.prototype._initializeToolBar.call(this,b);\nvar a=this._toolbar[b];\nthis._setupPrintMenu(b);\na.addFiller();\nthis._initializeNavToolBar(b);\nthis._setupContactGroupMenu(a);\nappCtxt.notifyZimlets(\"initializeToolbar\",[this._app,this._toolbar[b],this,b],{waitUntilLoaded:true})\n}else{this._setupDeleteButton(this._toolbar[b])\n}};\nZmContactListController.prototype._initializeTabGroup=function(a){if(this._tabGroups[a]){return\n}ZmListController.prototype._initializeTabGroup.call(this,a);\nvar b=this._tabGroups[a];\nb.addMemberBefore(this._parentView[a].getAlphabetBar(),this._view[a].getTabGroupMember());\nb.addMember(this._parentView[a].getTabGroupMember())\n};\nZmContactListController.prototype._setupDeleteButton=function(b){var c=this._getSearchFolder();\nvar a=(c&&c.nId==ZmFolder.ID_TRASH);\nvar d=a?ZmMsg.deletePermanentTooltip:ZmMsg.deleteTooltip;\nvar e=b.getButton(ZmOperation.DELETE);\nif(e){e.setToolTipContent(ZmOperation.getToolTip(ZmOperation.DELETE,this.getKeyMapName(),d))\n}};\nZmContactListController.prototype._initializeNavToolBar=function(a){this._toolbar[a].addOp(ZmOperation.TEXT);\nvar b=this._itemCountText[a]=this._toolbar[a].getButton(ZmOperation.TEXT);\nb.addClassName(\"itemCountText\")\n};\nZmContactListController.prototype._initializeActionMenu=function(a){ZmListController.prototype._initializeActionMenu.call(this);\nvar b=this._actionMenu.getItemById(ZmOperation.KEY_ID,ZmOperation.PRINT_CONTACT);\nif(b){b.setText(ZmMsg.print)\n}ZmOperation.setOperation(this._actionMenu,ZmOperation.CONTACT,ZmOperation.EDIT_CONTACT);\nthis._setupContactGroupMenu(this._actionMenu)\n};\nZmContactListController.prototype.getSearchFromText=function(){return ZmMsg.findEmailFromContact\n};\nZmContactListController.prototype.getSearchToText=function(){return ZmMsg.findEmailToContact\n};\nZmContactListController.prototype._initializeAlphabetBar=function(b){if(b==this._currentViewId){return\n}var d=this._parentView[this._currentViewId];\nvar f=d?d.getAlphabetBar():null;\nvar e=f?f.getCurrent():null;\nvar a=e?e.getAttribute(\"_idx\"):null;\nif(a){var c=this._parentView[b].getAlphabetBar();\nif(c){c.setButtonByIndex(a)\n}}};\nZmContactListController.prototype._setViewContents=function(a){this._list.removeChangeListener(this._listChangeListener);\nthis._list.addChangeListener(this._listChangeListener);\nthis._listView[a].set(this._list,null,this._folderId,this.isSearchResults)\n};\nZmContactListController.prototype._handleSyncAll=function(){};\nZmContactListController.prototype._syncAllListener=function(a){var b=new AjxCallback(this,this._handleSyncAll);\nappCtxt.accountList.syncAll(b)\n};\nZmContactListController.prototype.runRefresh=function(){if(!appCtxt.isOffline){return\n}this._syncAllListener()\n};\nZmContactListController.prototype._sendReceiveListener=function(a){var b=appCtxt.accountList.getAccount(a.item.getData(ZmOperation.MENUITEM_ID));\nif(b){b.sync()\n}};\nZmContactListController.prototype._handleListChange=function(c){if(c.event==ZmEvent.E_MODIFY||c.event==ZmEvent.E_CREATE){if(!c.getDetail(\"visible\")){return\n}var a=c.getDetail(\"items\");\nvar b=a&&a.length&&a[0];\nif(b instanceof ZmContact&&this._currentViewType==ZmId.VIEW_CONTACT_SIMPLE&&b.folderId==this._folderId){var d=this._parentView[this._currentViewId].getAlphabetBar();\nif(!d||d.isItemInAlphabetLetter(b)){this._parentView[this._currentViewId].setContact(b,this.isGalSearch())\n}}}};\nZmContactListController.prototype._setupViewMenu=function(a,g){var d;\nif(g){d=this._toolbar[a].getButton(ZmOperation.VIEW_MENU);\nvar e=d.getMenu();\nif(!e){e=new ZmPopupMenu(d);\nd.setMenu(e);\nfor(var c=0;\nc<ZmContactListController.VIEWS.length;\nc++){var f=ZmContactListController.VIEWS[c];\nvar b=e.createMenuItem(f,{image:ZmContactListController.ICON[f],text:ZmMsg[ZmContactListController.MSG_KEY[f]],style:DwtMenuItem.RADIO_STYLE});\nb.setData(ZmOperation.MENUITEM_ID,f);\nb.addSelectionListener(this._listeners[ZmOperation.VIEW]);\nif(f==a){b.setChecked(true,true)\n}}}}else{d=this._toolbar[a].getButton(ZmOperation.VIEW_MENU);\nvar e=d?d.getMenu():null;\nvar b=e?e.getItemById(ZmOperation.MENUITEM_ID,a):null;\nif(b){b.setChecked(true,true)\n}}d.setImage(ZmContactListController.ICON[a])\n};\nZmContactListController.prototype._setupPrintMenu=function(b){var a=this._toolbar[b].getButton(ZmOperation.PRINT);\nif(!a){return\n}a.setToolTipContent(ZmMsg.printMultiTooltip);\na.noMenuBar=true;\nvar d=new ZmPopupMenu(a);\na.setMenu(d);\nvar e=ZmOperation.PRINT_CONTACT;\nvar c=d.createMenuItem(e,{image:ZmOperation.getProp(e,\"image\"),text:ZmMsg[ZmOperation.getProp(e,\"textKey\")]});\nc.setData(ZmOperation.MENUITEM_ID,e);\nc.addSelectionListener(this._listeners[ZmOperation.PRINT_CONTACT]);\ne=ZmOperation.PRINT_ADDRBOOK;\nc=d.createMenuItem(e,{image:ZmOperation.getProp(e,\"image\"),text:ZmMsg[ZmOperation.getProp(e,\"textKey\")]});\nc.setData(ZmOperation.MENUITEM_ID,e);\nc.addSelectionListener(this._listeners[ZmOperation.PRINT_ADDRBOOK])\n};\nZmContactListController.prototype._resetOperations=function(f,d){ZmBaseController.prototype._resetOperations.call(this,f,d);\nvar k;\nif(f instanceof ZmButtonToolBar){var h=f.getButton(ZmOperation.PRINT);\nvar e=h&&h.getMenu();\nif(e){k=e.getItem(1);\nk.setText(ZmMsg.printResults)\n}}this._setContactGroupMenu(f);\nvar j=(f instanceof ZmActionMenu)?ZmOperation.PRINT_CONTACT:ZmOperation.PRINT;\nvar a=this._folderId==ZmFolder.ID_DLS||d==1&&this._listView[this._currentViewId].getSelection()[0].isDistributionList();\nf.enable(j,!a);\nf.enable(ZmOperation.NEW_MESSAGE,d>0&&!appCtxt.isExternalAccount());\nvar c=this._folderId&&appCtxt.getById(this._folderId);\nf.enable([ZmOperation.CONTACTGROUP_MENU],d>0&&!a&&!appCtxt.isExternalAccount());\nvar r=this._getContactGroupMenu(f);\nif(r){r.setNewDisabled(c&&c.isReadOnly())\n}appCtxt.notifyZimlets(\"resetContactListToolbarOperations\",[f,d]);\nif(!this.isGalSearch()){f.enable([ZmOperation.SEARCH_MENU,ZmOperation.BROWSE,ZmOperation.NEW_MENU,ZmOperation.VIEW_MENU],true);\nif(c){var q=c.link;\nvar i=c.isInTrash();\nvar l=!c.isReadOnly();\nf.enable([ZmOperation.TAG_MENU],l&&d>0);\nf.enable([ZmOperation.DELETE,ZmOperation.MOVE,ZmOperation.MOVE_MENU],l&&d>0);\nf.enable([ZmOperation.EDIT,ZmOperation.CONTACT],l&&d==1&&!i);\nif(k){var g=q?ZmMsg.printResults:ZmMsg.printAddrBook;\nk.setText(g)\n}}else{var o=this._listView[this._currentViewId].getSelection()[0];\nvar l=(d==1&&!o.isReadOnly()&&!ZmContact.isInTrash(o));\nf.enable([ZmOperation.DELETE,ZmOperation.MOVE,ZmOperation.MOVE_MENU,ZmOperation.TAG_MENU],d>0);\nf.enable([ZmOperation.EDIT,ZmOperation.CONTACT],l)\n}}else{f.enable([ZmOperation.PRINT,ZmOperation.PRINT_CONTACT,ZmOperation.MOVE,ZmOperation.MOVE_MENU,ZmOperation.TAG_MENU],false);\nf.enable([ZmOperation.SEARCH_MENU,ZmOperation.BROWSE,ZmOperation.NEW_MENU,ZmOperation.VIEW_MENU],true);\nf.enable(ZmOperation.CONTACT,d==1);\nvar s=this._listView[this._currentViewId].getSelection();\nvar l=false;\nif(d==1){var o=s[0];\nvar p=o&&o.isDistributionList();\nl=p&&o.dlInfo&&o.dlInfo.isOwner\n}f.enable([ZmOperation.EDIT],l);\nf.enable([ZmOperation.CONTACT],p?l:d==1);\nvar n=ZmContactList.deleteGalItemsAllowed(s);\nf.enable([ZmOperation.DELETE],n)\n}var s=this._listView[this._currentViewId].getSelection();\nvar o=(s.length==1)?s[0]:null;\nvar m=d===1&&!appCtxt.isExternalAccount()&&!o.isGroup()&&o.getEmail();\nf.enable([ZmOperation.SEARCH_MENU,ZmOperation.BROWSE],m);\nif(f instanceof ZmPopupMenu){this._setContactText(o);\nvar b=f.getMenuItem(ZmOperation.TAG_MENU);\nif(b){b.setText(o&&o.isGroup()?ZmMsg.AB_TAG_GROUP:ZmMsg.AB_TAG_CONTACT)\n}}if(appCtxt.isExternalAccount()){f.enable([ZmOperation.MOVE,ZmOperation.EDIT,ZmOperation.CONTACT,ZmOperation.MOVE_MENU,ZmOperation.CONTACTGROUP_MENU,ZmOperation.DELETE,ZmOperation.SEARCH_MENU,ZmOperation.NEW_MESSAGE],false);\nf.setItemVisible(ZmOperation.TAG_MENU,false)\n}if(appCtxt.isWebClientOffline()){f.enable([ZmOperation.ACTIONS_MENU,ZmOperation.MOVE,ZmOperation.EDIT,ZmOperation.CONTACT,ZmOperation.MOVE_MENU,ZmOperation.CONTACTGROUP_MENU,ZmOperation.DELETE,ZmOperation.TAG_MENU,ZmOperation.PRINT,ZmOperation.PRINT_CONTACT,ZmOperation.SEND_CONTACTS_IN_EMAIL],false)\n}};\nZmContactListController.prototype._getActionContact=function(b){if(b){var a=this._listView[this._currentViewId].getSelection();\nif(a.length!=1){return null\n}return a[0]\n}if(this._actionEv){return this._actionEv.contact\n}};\nZmContactListController.prototype._searchListener=function(d,f,b){var a=this._getActionContact(f);\nif(!a){return\n}var c=a.getEmails(),e=appCtxt.getSearchController();\nif(d===AjxEmailAddress.FROM){e.fromSearch(c)\n}else{if(d===AjxEmailAddress.TO){e.toSearch(c)\n}}};\nZmContactListController.prototype._listSelectionListener=function(b){Dwt.setLoadingTime(\"ZmContactItem\");\nZmListController.prototype._listSelectionListener.call(this,b);\nif(b.detail==DwtListView.ITEM_SELECTED){if(this._currentViewType==ZmId.VIEW_CONTACT_SIMPLE){this._parentView[this._currentViewId].setContact(b.item,this.isGalSearch())\n}}else{if(b.detail==DwtListView.ITEM_DBL_CLICKED){var a=appCtxt.getById(b.item.folderId);\nif(b.item.isDistributionList()&&b.item.dlInfo.isOwner){this._editListener.call(this,b);\nreturn\n}if(!this.isGalSearch()&&(!a||(!a.isReadOnly()&&!a.isInTrash()))&&!appCtxt.isWebClientOffline()){AjxDispatcher.run(\"GetContactController\").show(b.item)\n}}}};\nZmContactListController.prototype._newListener=function(a,c,b){if(!a&&!c){return\n}c=c||a.item.getData(ZmOperation.KEY_ID);\nif(c==ZmOperation.NEW_MESSAGE){this._composeListener(a)\n}else{ZmListController.prototype._newListener.call(this,a,c,b)\n}};\nZmContactListController.prototype._composeListener=function(g){var f=this._listView[this._currentViewId].getSelection();\nif(f.length==0&&this._actionEv){f.push(this._actionEv.contact)\n}var c=\"\",a,d;\nfor(var e=0;\ne<f.length;\ne++){a=f[e];\nif(a.isGroup()&&!a.isDistributionList()){var b=a.getGroupMembers().good;\nif(b.size()){c+=b.toString(AjxEmailAddress.SEPARATOR)+AjxEmailAddress.SEPARATOR\n}}else{var h=new AjxEmailAddress(a.getEmail(),AjxEmailAddress.TO,a.getFullName());\nc+=h.toString()+AjxEmailAddress.SEPARATOR\n}}AjxDispatcher.run(\"Compose\",{action:ZmOperation.NEW_MESSAGE,inNewWindow:this._app._inNewWindow(g),toOverride:c})\n};\nZmContactListController.prototype._listActionListener=function(b){ZmListController.prototype._listActionListener.call(this,b);\nthis._actionEv.contact=b.item;\nvar c=this.getActionMenu();\nif(!this._actionEv.contact.getEmail()&&c){var a=c.getMenuItem(ZmOperation.SEARCH_MENU);\nif(a){a.setEnabled(false)\n}}c.popup(0,b.docX,b.docY);\nif(b.ersatz){c.setSelectedItem(0)\n}};\nZmContactListController.prototype._dropListener=function(c){var a=this._listView[this._currentViewId];\nvar d=a.getTargetItemDiv(c.uiEvent);\nvar b=a.getItemFromElement(d);\nif(c.action==DwtDropEvent.DRAG_ENTER){if(b&&(b.type==ZmItem.CONTACT)&&(b.isGal||b.isShared())){c.doIt=false;\na.dragSelect(d);\nreturn\n}}ZmListController.prototype._dropListener.call(this,c)\n};\nZmContactListController.prototype._editListener=function(b,a){a=a||this._listView[this._currentViewId].getSelection()[0];\nAjxDispatcher.run(\"GetContactController\").show(a,false)\n};\nZmContactListController.prototype._printListener=function(e){var h=this._listView[this._currentViewId].getSelection();\nvar d=[];\nfor(var c=0;\nc<h.length;\nc++){if(h[c].isDistributionList()){continue\n}d.push(h[c].id)\n}if(d.length==0){return\n}var b=\"/h/printcontacts?id=\"+d.join(\",\");\nif(this.isGalSearch()){b=\"/h/printcontacts?id=\"+d.join(\"&id=\");\nb=b+\"&st=gal\";\nvar g=this._currentSearch&&this._currentSearch.query;\nif(g&&h.length>1){b+=\"&sq=\"+g\n}else{if(h.length==1){b+=\"&sq=\"+h[0].getFileAs()\n}}}if(appCtxt.isOffline){var a=this._folderId||ZmFolder.ID_CONTACTS;\nvar f=appCtxt.getById(a).getAccount().name;\nb+=\"&acct=\"+f\n}window.open(appContextPath+b,\"_blank\")\n};\nZmContactListController.prototype._printAddrBookListener=function(h){var b;\nif(this._folderId&&!this._list._isShared){b=\"/h/printcontacts?sfi=\"+this._folderId\n}else{var j=((this._searchType&ZmContactListController.SEARCH_TYPE_ANYWHERE)!=0)?AjxDispatcher.run(\"GetContacts\"):this._list;\nvar a=[];\nvar f=j.getArray();\nfor(var e=0;\ne<f.length;\ne++){a.push(f[e].id)\n}b=\"/h/printcontacts\";\nif(this.isGalSearch()){b+=\"?id=\"+a.join(\"&id=\")\n}else{b+=\"?id=\"+a.join(\",\")\n}}if(this.isGalSearch()){b=b+\"&st=gal\";\nvar g=this._currentSearch&&this._currentSearch.query;\nif(g&&f&&f.length>1){b+=\"&sq=\"+g\n}else{if(f&&f.length==1){b+=\"&sq=\"+f[0].getFileAs()\n}}}if(appCtxt.isOffline){var d=this._folderId||ZmFolder.ID_CONTACTS;\nvar c=appCtxt.getById(d).getAccount().name;\nb+=\"&acct=\"+c\n}window.open(appContextPath+b,\"_blank\")\n};\nZmContactListController.prototype._preShowCallback=function(a){if((this._searchType&ZmContactListController.SEARCH_TYPE_NEW)!=0){this._searchType&=~ZmContactListController.SEARCH_TYPE_NEW\n}else{this._resetNavToolBarButtons(a)\n}return true\n};\nZmContactListController.prototype._doMove=function(o,c,q,k){o=AjxUtil.toArray(o);\nvar e=[];\nvar b=[];\nvar p=[];\nfor(var h=0;\nh<o.length;\nh++){var r=o[h];\nif(r.isGal){p.push(r)\n}else{if(!r.folderId||r.folderId!=c.id){if(!this._isItemMovable(r,k,c)){b.push(r)\n}else{e.push(r)\n}}}}var m=appCtxt.getById(this.getFolderId());\nvar a=(m&&m.isInTrash()&&!c.isInTrash());\nvar s=this._getAllDoneCallback();\nif(e.length){var f={items:e,folder:c,attrs:q,outOfTrash:a};\nvar n=f.list=this._getList(f.items);\nthis._setupContinuation(this._doMove,[c,q,k],f,s);\nn=a?this._list:n;\nn.moveItems(f)\n}if(b.length){var f={items:b,folder:c,attrs:q};\nvar n=f.list=this._getList(f.items);\nthis._setupContinuation(this._doMove,[c,q,k],f,s);\nn=a?this._list:n;\nn.copyItems(f)\n}if(p.length){var d=new ZmBatchCommand(true,null,true);\nfor(var g=0;\ng<p.length;\ng++){var l=p[g];\nl.attr[ZmContact.F_folderId]=c.id;\nd.add(new AjxCallback(l,l.create,[l.attr]))\n}d.run(new AjxCallback(this,this._handleMoveFromGal))\n}};\nZmContactListController.prototype._handleMoveFromGal=function(a){var c=a.getResponse().BatchResponse.CreateContactResponse;\nif(c!=null&&c.length>0){var b=AjxMessageFormat.format(ZmMsg.itemCopied,c.length);\nappCtxt.getAppController().setStatusMsg(b)\n}};\nZmContactListController.prototype._doDelete=function(b,a,c){ZmListController.prototype._doDelete.call(this,b,a,c);\nfor(var e=0;\ne<b.length;\ne++){appCtxt.getApp(ZmApp.CONTACTS).updateIdHash(b[e],true)\n}var d=this._listView[this._currentViewId].getSelectedItems().size();\nif(d==0){if(this._currentViewType==ZmId.VIEW_CONTACT_SIMPLE){this._listView[this._currentViewId].parent.clear()\n}this._resetOperations(this._toolbar[this._currentViewId],0)\n}};\nZmContactListController.prototype._moveListener=function(a){ZmListController.prototype._moveListener.call(this,a)\n};\nZmContactListController.prototype._checkReplenish=function(){var a=this._listView[this._currentViewId];\na.set(this._list);\na._setNextSelection()\n};\nZmContactListController.prototype._getContactGroupMenu=function(a){var b=a instanceof ZmButtonToolBar?a.getActionsMenu():a;\nreturn b?b.getContactGroupMenu():null\n};\nZmContactListController.prototype._setContactGroupMenu=function(e){if(!e||appCtxt.isExternalAccount()){return\n}var d=this._getContactGroupMenu(e);\nif(!d){return\n}var b=this.getItems();\nb=AjxUtil.toArray(b);\nvar f=this._getContactsFromCache();\nvar c=this._filterGroups(f);\nvar a=this._sortContactGroups(c);\nd.set(b,a,this._folderId==ZmFolder.ID_DLS)\n};\nZmContactListController.prototype._setupContactGroupMenu=function(b){if(!b){return\n}var a=this._getContactGroupMenu(b);\nif(a){a.addSelectionListener(this._listeners[ZmOperation.NEW_GROUP])\n}};\nZmContactListController.prototype._contactListChange=function(c){if(c&&c.source&&c.type==ZmId.ITEM_CONTACT){var b=c.source;\nvar d=DwtId.WIDGET_ITEM+\"__\"+this._currentViewId+\"__\"+c.source.id;\nvar a=this._listView[this._currentViewId];\na._setItemData(null,\"item\",b,d)\n}};\nZmContactListController.prototype._groupListener=function(f,e){if(this.isCurrent()){var b=f.getData(ZmContactGroupMenu.KEY_GROUP_EVENT);\nvar a=f.getData(ZmContactGroupMenu.KEY_GROUP_ADDED);\ne=e||this.getItems();\nif(b==ZmEvent.E_MODIFY){var i={};\nvar c=f.getData(Dwt.KEY_OBJECT).id;\nvar h=appCtxt.getApp(ZmApp.CONTACTS).getContactList().getById(c);\nif(h){h.addChangeListener(this._contactListChange.bind(this),0);\nvar d=this._getGroupMembers(e,h);\nif(d){i[ZmContact.F_groups]=d\n}this._doModify(h,i);\nthis._menuPopdownActionListener();\nvar g=this._list.getIndexById(h.id);\nif(g!=null){this._resetSelection(g)\n}}}else{if(b==ZmEvent.E_CREATE){this._pendingActionData=e;\nvar j=appCtxt.getNewContactGroupDialog();\nif(!this._newContactGroupCb){this._newContactGroupCb=new AjxCallback(this,this._newContactGroupCallback)\n}ZmController.showDialog(j,this._newContactGroupCb);\nj.registerCallback(DwtDialog.CANCEL_BUTTON,this._clearDialog,this,j)\n}}}};\nZmContactListController.prototype._newContactGroupCallback=function(c){var d=c.name;\nappCtxt.getNewContactGroupDialog().popdown();\nvar a=this.getItems();\nvar b={};\nb[ZmContact.F_groups]=this._getGroupMembers(a);\nb[ZmContact.F_folderId]=this._folderId;\nb[ZmContact.F_fileAs]=ZmContact.computeCustomFileAs(d);\nb[ZmContact.F_nickname]=d;\nb[ZmContact.F_type]=\"group\";\nthis._doCreate(this._list,b);\nthis._pendingActionData=null;\nthis._menuPopdownActionListener()\n};\nZmContactListController.prototype._getGroupMembers=function(n,p){var q={};\nvar k={};\nvar f=[];\nvar c;\nvar h={};\nvar a,l;\nfor(var g=0;\ng<n.length;\ng++){if(n[g].isDistributionList()||!n[g].isGroup()){h=this._createContactRefObj(n[g],p);\nif(h.value){k[h.value]=h\n}}else{var b=n[g].attr[ZmContact.F_groups];\nif(!b){h=this._createContactRefObj(n[g],p);\nif(h.value){k[h.value]=h\n}}else{for(var e=0;\ne<b.length;\ne++){a=b[e].value;\nl=ZmContact.getContactFromCache(a);\nif(l){c=l.isGal?ZmContact.GROUP_GAL_REF:ZmContact.GROUP_CONTACT_REF;\nh={value:l.isGal?l.ref:a,type:c};\nif(p){h.op=\"+\"\n}k[a]=h\n}else{if(b[e].type==ZmContact.GROUP_INLINE_REF){h={value:b[e].value,type:ZmContact.GROUP_INLINE_REF};\nif(p){h.op=\"+\"\n}k[a]=h\n}}}}}}var d=[];\nfor(var a in k){d.push(k[a])\n}if(p){var m=p.attr[ZmContact.F_groups];\nvar o=[];\nvar r=false;\nfor(var g=0;\ng<d.length;\ng++){r=false;\nfor(var e=0;\ne<m.length&&!r;\ne++){if(d[g].value==m[e].value){r=true\n}}if(!r){o.push(d[g])\n}}return o\n}else{return d\n}};\nZmContactListController.prototype._createContactRefObj=function(a,d){var c={};\nvar b=a.isGal?ZmContact.GROUP_GAL_REF:ZmContact.GROUP_CONTACT_REF;\nvar e=b==ZmContact.GROUP_CONTACT_REF?a.getId(true):(a.ref||a.id);\nif(e){var c={value:e,type:b};\nif(d){c.op=\"+\"\n}}return c\n};\nZmContactListController.prototype._getContactsFromCache=function(){var a=appCtxt.getApp(ZmApp.CONTACTS).getContactList();\nif(a){return a.getIdHash()\n}return{}\n};\nZmContactListController.prototype._sortContactGroups=function(b){var a=function(f,d){var e=ZmContact.getAttr(f,\"nickname\");\nvar c=ZmContact.getAttr(d,\"nickname\");\nif(!e||!c){return 0\n}if(e.toLowerCase()>c.toLowerCase()){return 1\n}if(e.toLowerCase()<c.toLowerCase()){return -1\n}return 0\n};\nreturn b.sort(a)\n};\nZmContactListController.prototype._filterGroups=function(b){var a=[];\nfor(var d in b){var c=ZmContact.getAttr(b[d],\"type\");\nif(c&&c.toUpperCase()==ZmItem.GROUP.toUpperCase()){a.push(b[d])\n}}return a\n};\nZmContactListController.prototype._paginate=function(b,d,c,a){if(this._list.isGal&&!this._list.isGalPAgingSupported){return\n}ZmListController.prototype._paginate.call(this,b,d,c,a)\n};\nZmContactListController.prototype._getDefaultFocusItem=function(){return this.getCurrentView().getListView()\n}\n}if(AjxPackage.define(\"zimbraMail.abook.controller.ZmContactController\")){ZmContactController=function(a,c,b,d){ZmListController.apply(this,arguments);\nthis._listeners[ZmOperation.SAVE]=this._saveListener.bind(this);\nthis._listeners[ZmOperation.CANCEL]=this._cancelListener.bind(this);\nthis._tabGroupDone={};\nthis._elementsToHide=ZmAppViewMgr.LEFT_NAV\n};\nZmContactController.prototype=new ZmListController();\nZmContactController.prototype.constructor=ZmContactController;\nZmContactController.prototype.isZmContactController=true;\nZmContactController.prototype.toString=function(){return\"ZmContactController\"\n};\nZmContactController.getDefaultViewType=function(){return ZmId.VIEW_CONTACT\n};\nZmContactController.prototype.getDefaultViewType=ZmContactController.getDefaultViewType;\nZmContactController.prototype.show=function(a,c,b){if(a.id&&a.isDistributionList()&&!b){var d=this.show.bind(this,a,c,true);\na.clearDlInfo();\na.gatherExtraDlStuff(d);\nreturn\n}this._contact=a;\nif(c){this._contactDirty=true\n}this.setList(a.list);\nif(!this.getCurrentToolbar()){this._initializeToolBar(this._currentViewId)\n}this._resetOperations(this.getCurrentToolbar(),1);\nthis._createView(this._currentViewId);\nthis._setViewContents();\nthis._initializeTabGroup(this._currentViewId);\nthis._app.pushView(this._currentViewId);\nthis.updateTabTitle()\n};\nZmContactController.prototype._createView=function(a){if(this._contactView){return\n}var b=this._contactView=this._createContactView();\nthis._view[a]=b;\nvar c={};\nc[ZmAppViewMgr.CB_PRE_HIDE]=this._preHideCallback.bind(this);\nc[ZmAppViewMgr.CB_PRE_UNLOAD]=this._preUnloadCallback.bind(this);\nc[ZmAppViewMgr.CB_POST_SHOW]=this._postShowCallback.bind(this);\nvar d=this.getViewElements(null,b,this._toolbar[a]);\nthis._app.createView({viewId:a,viewType:this._currentViewType,elements:d,hide:this._elementsToHide,controller:this,callbacks:c,tabParams:this._getTabParams()})\n};\nZmContactController.prototype._postShowCallback=function(){ZmController.prototype._postShowCallback.call(this);\nif(this._contactView.postShow){this._contactView.postShow()\n}};\nZmContactController.prototype._getDefaultTabText=function(){return this._contact.isDistributionList()?ZmMsg.distributionList:this._isGroup()?ZmMsg.group:ZmMsg.contact\n};\nZmContactController.prototype._getTabParams=function(){var a=this._isGroup()?ZmMsg.group:ZmMsg.contact;\nreturn{id:this.tabId,image:\"CloseGray\",hoverImage:\"Close\",text:null,textPrecedence:77,tooltip:a,style:DwtLabel.IMAGE_RIGHT}\n};\nZmContactController.prototype.updateTabTitle=function(){var a=this._contactView._getFullName(true);\nif(!a){a=this._getDefaultTabText()\n}a=a.substr(0,ZmAppViewMgr.TAB_BUTTON_MAX_TEXT);\nappCtxt.getAppViewMgr().setTabTitle(this._currentViewId,a)\n};\nZmContactController.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_EDIT_CONTACT\n};\nZmContactController.prototype.handleKeyAction=function(b){switch(b){case ZmKeyMap.SAVE:var a=this.getCurrentToolbar();\nvar c=a.getButton(ZmOperation.SAVE);\nif(!c.getEnabled()){break\n}this._saveListener();\nbreak;\ncase ZmKeyMap.CANCEL:this._cancelListener();\nbreak\n}return true\n};\nZmContactController.prototype.enableToolbar=function(a){if(a){this._resetOperations(this.getCurrentToolbar(),1)\n}else{this.getCurrentToolbar().enableAll(a)\n}};\nZmContactController.prototype._getToolBarOps=function(){return[ZmOperation.SAVE,ZmOperation.CANCEL,ZmOperation.SEP,ZmOperation.PRINT,ZmOperation.DELETE,ZmOperation.SEP,ZmOperation.TAG_MENU]\n};\nZmContactController.prototype._getActionMenuOps=function(){return null\n};\nZmContactController.prototype._isGroup=function(){return this._contact.isGroup()\n};\nZmContactController.prototype._createContactView=function(){return this._isGroup()?new ZmGroupView(this._container,this):new ZmEditContactView(this._container,this)\n};\nZmContactController.prototype._initializeToolBar=function(b){ZmListController.prototype._initializeToolBar.call(this,b);\nvar a=this._toolbar[b];\nvar d=a.getButton(ZmOperation.CANCEL);\nif(this._contact.id==undefined||(this._contact.isGal&&!this._contact.isDistributionList())){d.setText(ZmMsg.cancel)\n}else{d.setText(ZmMsg.close)\n}var c=a.getButton(ZmOperation.SAVE);\nif(c){c.setToolTipContent(ZmMsg.saveContactTooltip)\n}appCtxt.notifyZimlets(\"initializeToolbar\",[this._app,a,this,b],{waitUntilLoaded:true})\n};\nZmContactController.prototype._getTagMenuMsg=function(){return ZmMsg.AB_TAG_CONTACT\n};\nZmContactController.prototype._setViewContents=function(){var a=this._contactView;\nthis.editingContactList=this._contact.list;\na.set(this._contact,this._contactDirty);\nif(this._contactDirty){delete this._contactDirty\n}};\nZmContactController.prototype._paginate=function(a,b){};\nZmContactController.prototype._resetOperations=function(c,b){if(!c){return\n}if(!this._contact.id){c.enableAll(false);\nc.enable([ZmOperation.SAVE,ZmOperation.CANCEL],true)\n}else{if(this._contact.isGal){c.enableAll(false);\nc.enable([ZmOperation.SAVE,ZmOperation.CANCEL],true);\nvar a=ZmContactList.deleteGalItemsAllowed([this._contact]);\nc.enable(ZmOperation.DELETE,a)\n}else{if(this._contact.isReadOnly()){c.enableAll(true);\nc.enable(ZmOperation.TAG_MENU,false)\n}else{ZmListController.prototype._resetOperations.call(this,c,b)\n}}}};\nZmContactController.prototype._saveListener=function(v,y){var p=false;\nvar m=this._contactView;\nif(m instanceof DwtForm){m.validate()\n}if(!m.isValid()){var s=m.getInvalidItems();\nvar o=true;\nfor(var r=0;\nr<s.length;\nr++){d=m.getErrorMessage(s[r]);\nvar k=(s[r].indexOf(\"EMAIL\")!=-1);\nif(AjxUtil.isString(d)&&!k){d=d?AjxMessageFormat.format(ZmMsg.errorSavingWithMessage,d):ZmMsg.errorSaving;\nvar u=appCtxt.getMsgDialog();\nu.setMessage(d,DwtMessageDialog.CRITICAL_STYLE);\nu.popup();\nreturn\n}o=o&&k\n}if(!o){return\n}}var b=m.getModifiedAttrs();\nm.enableInputs(false);\nvar q=m.getContact();\nif(this.editingContactList){q.list=this.editingContactList\n}if(b&&AjxUtil.arraySize(b)>0){var c=b[ZmContact.F_folderId];\nvar j=c?appCtxt.getById(c):null;\nif(q.id!=null&&c&&(q.isShared()||(j&&j.link))&&!q.isGal){for(var x in b){if(x!=ZmContact.F_folderId&&x!=ZmContact.F_groups){q.attr[x]=b[x]\n}}q._setFolder(c)\n}else{if(q.id&&(!q.isGal||q.isDistributionList())){if(m.isEmpty()){var e=appCtxt.getMsgDialog();\ne.setMessage(ZmMsg.emptyContactSave,DwtMessageDialog.CRITICAL_STYLE);\ne.popup();\nm.enableInputs(true);\ny=true\n}else{var w=ZmContact.computeFileAs(q),g=ZmContact.computeFileAs(AjxUtil.hashUpdate(AjxUtil.hashCopy(q.getAttrs()),b,true)),l=w?w.toLowerCase()[0]:null,f=g?g.toLowerCase()[0]:null;\nthis._doModify(q,b);\nif(l!==f){p=true\n}}}else{var n=true;\nfor(var x in b){if(b[x]){n=false;\nbreak\n}}if(n){var d=this._isGroup()?ZmMsg.emptyGroup:ZmMsg.emptyContact;\nappCtxt.setStatusMsg(d,ZmStatusView.LEVEL_WARNING)\n}else{if(q.isDistributionList()){q.create(b)\n}else{var h=AjxDispatcher.run(\"GetContactListController\");\nvar t=(h&&h.getList())||new ZmContactList(null);\np=true;\nthis._doCreate(t,b)\n}}}}}else{if(q.isDistributionList()){this.popView()\n}if(m.isEmpty()){var d=this._isGroup()?ZmMsg.emptyGroup:ZmMsg.emptyContact;\nappCtxt.setStatusMsg(d,ZmStatusView.LEVEL_WARNING)\n}else{var d=q.isDistributionList()?ZmMsg.dlSaved:this._isGroup()?ZmMsg.groupSaved:ZmMsg.contactSaved;\nappCtxt.setStatusMsg(d,ZmStatusView.LEVEL_INFO)\n}}if(!y&&!q.isDistributionList()){this.popView()\n}else{m.enableInputs(true)\n}if(p){ZmContactAlphabetBar.alphabetClicked(null)\n}return true\n};\nZmContactController.prototype.popView=function(){this._app.popView(true);\nif(this._contactView){this._contactView.cleanup()\n}};\nZmContactController.prototype._cancelListener=function(a){this._app.popView()\n};\nZmContactController.prototype._printListener=function(b){var a=\"/h/printcontacts?id=\"+this._contact.id;\nif(appCtxt.isOffline){var c=this._contact.getAccount().name;\na+=\"&acct=\"+c\n}window.open(appContextPath+a,\"_blank\")\n};\nZmContactController.prototype._doDelete=function(b,a,c,d){ZmListController.prototype._doDelete.call(this,b,a,c);\nif(b.isDistributionList()){return\n}appCtxt.getApp(ZmApp.CONTACTS).updateIdHash(b,true);\nif(!d){this._contactView.enableInputs(false);\nthis._app.popView(true)\n}};\nZmContactController.prototype._preHideCallback=function(a,b){ZmController.prototype._preHideCallback.call(this);\nif(b){return true\n}var a=this._contactView;\nif(!a.isDirty()){a.cleanup();\nreturn true\n}var c=this._popShield=appCtxt.getYesNoCancelMsgDialog();\nc.reset();\nc.setMessage(ZmMsg.askToSave,DwtMessageDialog.WARNING_STYLE);\nc.registerCallback(DwtDialog.YES_BUTTON,this._popShieldYesCallback,this);\nc.registerCallback(DwtDialog.NO_BUTTON,this._popShieldNoCallback,this);\nc.popup(a._getDialogXY());\nreturn false\n};\nZmContactController.prototype._preUnloadCallback=function(a){return this._contactView.clean||!this._contactView.isDirty()\n};\nZmContactController.prototype._popShieldYesCallback=function(){this._popShield.popdown();\nif(this._saveListener(null,true)){this._popShieldCallback()\n}};\nZmContactController.prototype._popShieldNoCallback=function(){this._popShield.popdown();\nthis._popShieldCallback()\n};\nZmContactController.prototype._popShieldCallback=function(){appCtxt.getAppViewMgr().showPendingView(true);\nthis._contactView.cleanup()\n};\nZmContactController.prototype._menuPopdownActionListener=function(a){};\nZmContactController.prototype._getDefaultFocusItem=function(){return this._contactView._getDefaultFocusItem()\n}\n}if(AjxPackage.define(\"zimbraMail.abook.controller.ZmAddrBookTreeController\")){ZmAddrBookTreeController=function(){ZmFolderTreeController.call(this,ZmOrganizer.ADDRBOOK);\nthis._listeners[ZmOperation.NEW_ADDRBOOK]=this._newListener.bind(this);\nthis._listeners[ZmOperation.SHARE_ADDRBOOK]=this._shareAddrBookListener.bind(this);\nthis._app=appCtxt.getApp(ZmApp.CONTACTS)\n};\nZmAddrBookTreeController.prototype=new ZmFolderTreeController;\nZmAddrBookTreeController.prototype.constructor=ZmAddrBookTreeController;\nZmAddrBookTreeController.prototype.isZmAddrBookTreeController=true;\nZmAddrBookTreeController.prototype.toString=function(){return\"ZmAddrBookTreeController\"\n};\nZmAddrBookTreeController.prototype.show=function(c){c.include={};\nc.include[ZmFolder.ID_TRASH]=true;\nc.showUnread=false;\nvar a=ZmFolderTreeController.prototype.show.call(this,c);\nvar b=this.getDataTree().getById(ZmFolder.ID_TRASH);\nif(b){b.addChangeListener(new AjxListener(this,this._trashChangeListener,a))\n}return a\n};\nZmAddrBookTreeController.prototype._trashChangeListener=function(c,g){var d=g.getDetail(\"organizers\");\nif(!d&&g.source){d=[g.source]\n}for(var e=0;\ne<d.length;\ne++){var b=d[e];\nif(b.id==ZmFolder.ID_TRASH&&g.event==ZmEvent.E_MODIFY){var a=g.getDetail(\"fields\");\nif(a&&(a[ZmOrganizer.F_TOTAL]||a[ZmOrganizer.F_SIZE])){var f=c.getTreeItemById(b.id);\nif(f){f.setToolTipContent(b.getToolTip(true))\n}}}}};\nZmAddrBookTreeController.prototype.resetOperations=function(k,i,a){var b=ZmMsg.del;\nvar e=appCtxt.getById(a);\nvar c=e?e.nId:ZmOrganizer.normalizeId(a);\nvar h=(c==ZmFolder.ID_TRASH);\nvar d=(c==ZmFolder.ID_DLS);\nthis.setVisibleIfExists(k,ZmOperation.EMPTY_FOLDER,c==ZmFolder.ID_TRASH);\nif(h){k.enableAll(false);\nk.enable(ZmOperation.DELETE_WITHOUT_SHORTCUT,false);\nvar f=((e.numTotal>0)||(e.children&&(e.children.size()>0)));\nk.enable(ZmOperation.EMPTY_FOLDER,f);\nk.getOp(ZmOperation.EMPTY_FOLDER).setText(ZmMsg.emptyTrash)\n}else{if(d){k.enableAll(false)\n}else{k.enableAll(true);\nif(e){k.enable([ZmOperation.NEW_ADDRBOOK],!e.isReadOnly());\nif(e.isSystem()||appCtxt.isExternalAccount()){k.enable([ZmOperation.DELETE_WITHOUT_SHORTCUT,ZmOperation.RENAME_FOLDER],false)\n}else{if(e.link){k.enable([ZmOperation.SHARE_ADDRBOOK],!e.link||e.isAdmin())\n}}if(appCtxt.isOffline){var j=e.getAccount();\nk.enable([ZmOperation.SHARE_ADDRBOOK],!j.isMain&&j.isZimbraAccount)\n}}}}if(e){k.enable(ZmOperation.EXPAND_ALL,(e.size()>0))\n}var g=k.getOp(ZmOperation.DELETE_WITHOUT_SHORTCUT);\nif(g){g.setText(b)\n}this._enableRecoverDeleted(k,h);\nthis._resetButtonPerSetting(k,ZmOperation.SHARE_ADDRBOOK,appCtxt.get(ZmSetting.SHARING_ENABLED))\n};\nZmAddrBookTreeController.prototype._dropListener=function(d){var a=AjxUtil.toArray(d.srcData.data);\nfor(var b=0;\nb<a.length;\nb++){var c=a[b];\nif(!c.isZmContact){continue\n}if(c.isDistributionList()){d.doIt=false;\nreturn\n}}ZmFolderTreeController.prototype._dropListener.apply(this,arguments)\n};\nZmAddrBookTreeController.prototype._getAllowedSubTypes=function(){var a={};\na[ZmOrganizer.SEARCH]=true;\na[this.type]=true;\nreturn a\n};\nZmAddrBookTreeController.prototype._getSearchTypes=function(a){return[ZmItem.CONTACT]\n};\nZmAddrBookTreeController.prototype._getHeaderActionMenuOps=function(){var a=null;\nif(appCtxt.get(ZmSetting.NEW_ADDR_BOOK_ENABLED)){a=[ZmOperation.NEW_ADDRBOOK,ZmOperation.FIND_SHARES]\n}return a\n};\nZmAddrBookTreeController.prototype._getActionMenuOps=function(){var a=[];\nif(appCtxt.get(ZmSetting.NEW_ADDR_BOOK_ENABLED)){a.push(ZmOperation.NEW_ADDRBOOK)\n}a.push(ZmOperation.EMPTY_FOLDER,ZmOperation.RECOVER_DELETED_ITEMS,ZmOperation.SHARE_ADDRBOOK,ZmOperation.DELETE_WITHOUT_SHORTCUT,ZmOperation.RENAME_FOLDER,ZmOperation.EDIT_PROPS,ZmOperation.EXPAND_ALL);\nreturn a\n};\nZmAddrBookTreeController.prototype._getMoveDialogTitle=function(){return AjxMessageFormat.format(ZmMsg.moveAddrBook,this._pendingActionData.name)\n};\nZmAddrBookTreeController.prototype._getNewDialog=function(){return appCtxt.getNewAddrBookDialog()\n};\nZmAddrBookTreeController.prototype._shareAddrBookListener=function(b){this._pendingActionData=this._getActionedOrganizer(b);\nif(this._pendingActionData.id===\"1\"){var a=new AjxException(\"Root folder sharing is not allowed, ignoring action.\",AjxException.INVALID_PARAM);\nappCtxt.getAppController()._handleException(a);\nreturn\n}appCtxt.getSharePropsDialog().popup(ZmSharePropsDialog.NEW,this._pendingActionData)\n};\nZmAddrBookTreeController.dlFolderClicked=function(){var a={_jsns:\"urn:zimbraAccount\",ownerOf:1,attrs:\"zimbraDistributionListUnsubscriptionPolicy,zimbraDistributionListSubscriptionPolicy,zimbraHideInGal\"};\nvar c={GetAccountDistributionListsRequest:a};\nvar b=ZmAddrBookTreeController._handleAccountDistributionListResponse;\nappCtxt.getAppController().sendRequest({jsonObj:c,asyncMode:true,callback:b})\n};\nZmAddrBookTreeController.prototype._itemClicked=function(a){if(a.id==ZmFolder.ID_DLS){ZmAddrBookTreeController.dlFolderClicked()\n}else{if(a.type==ZmOrganizer.SEARCH){var c=this._opc.getTreeController(ZmOrganizer.SEARCH);\nc._itemClicked(a)\n}else{var d=appCtxt.getApp(ZmApp.CONTACTS);\nd.currentSearch=null;\nvar g=d.currentQuery=a.createQuery();\nvar f=appCtxt.getSearchController();\nf.setDefaultSearchType(ZmItem.CONTACT);\nvar i=a.getAccount();\nvar b={query:g,searchFor:ZmItem.CONTACT,fetch:true,sortBy:ZmSearch.NAME_ASC,callback:new AjxCallback(this,this._handleSearchResponse,[a]),accountName:(i&&i.name)};\nf.search(b);\nif(a.id!=ZmFolder.ID_TRASH){var e=AjxDispatcher.run(\"GetContactListController\");\nvar h=e.getCurrentView();\nif(h){h.getAlphabetBar().reset()\n}}}}};\nZmAddrBookTreeController.prototype._handleSearchResponse=function(b,a){if(b.nId==ZmFolder.ID_TRASH){this._treeView[this._app.getOverviewId()].setSelected(b,true)\n}};\nZmAddrBookTreeController._handleAccountDistributionListResponse=function(a){var b=new ZmContactList(null,true,ZmItem.CONTACT);\nvar g=a._data.GetAccountDistributionListsResponse.dl;\nif(g){for(var e=0;\ne<g.length;\ne++){var d=g[e];\nvar c=d._attrs;\nc.email=d.name;\nc.type=\"group\";\nc[ZmContact.F_dlDisplayName]=d.d||d.name;\nb.addFromDom(d)\n}}var f=AjxDispatcher.run(\"GetContactListController\");\nf.show(b,true,ZmFolder.ID_DLS)\n}\n}if(AjxPackage.define(\"zimbraMail.abook.view.ZmContactSearch\")){ZmContactSearch=function(a){a=a||{};\na.parent=a.parent||appCtxt.getShell();\na.className=a.className||\"ZmContactSearch\";\nDwtComposite.call(this,a);\nthis._options=a.options;\nthis._initialized=false;\nthis._searchErrorCallback=new AjxCallback(this,this._handleErrorSearch);\nif(!ZmContactSearch._controller){ZmContactSearch._controller=new ZmContactSearchController()\n}this._controller=ZmContactSearch._controller;\nthis._initialize()\n};\nZmContactSearch.prototype=new DwtComposite;\nZmContactSearch.prototype.constructor=ZmContactSearch;\nZmContactSearch.SEARCHFOR_SETTING={};\nZmContactSearch.SEARCHFOR_SETTING[ZmContactsApp.SEARCHFOR_CONTACTS]=ZmSetting.CONTACTS_ENABLED;\nZmContactSearch.SEARCHFOR_SETTING[ZmContactsApp.SEARCHFOR_GAL]=ZmSetting.GAL_ENABLED;\nZmContactSearch.SEARCHFOR_SETTING[ZmContactsApp.SEARCHFOR_PAS]=ZmSetting.SHARING_ENABLED;\nZmContactSearch.SEARCHFOR_SETTING[ZmContactsApp.SEARCHFOR_FOLDERS]=ZmSetting.CONTACTS_ENABLED;\nZmContactSearch.prototype.toString=function(){return\"ZmContactSearch\"\n};\nZmContactSearch.prototype.search=function(d,h,g,b){if(!AjxUtil.isSpecified(d)){d=true\n}var e=this._searchCleared?AjxStringUtil.trim(this._searchField.value):\"\";\nvar c;\nif(this._selectDiv){var a=this._selectDiv.getValue();\nthis._contactSource=(a==ZmContactsApp.SEARCHFOR_CONTACTS||a==ZmContactsApp.SEARCHFOR_PAS)?ZmItem.CONTACT:ZmId.SEARCH_GAL;\nif(a==ZmContactsApp.SEARCHFOR_PAS){c=ZmSearchController.generateQueryForShares(ZmId.ITEM_CONTACT)||\"is:local\"\n}else{if(a==ZmContactsApp.SEARCHFOR_CONTACTS){c=\"is:local\"\n}else{if(a==ZmContactsApp.SEARCHFOR_GAL){d=true\n}}}}else{this._contactSource=appCtxt.get(ZmSetting.CONTACTS_ENABLED,null,this._account)?ZmItem.CONTACT:ZmId.SEARCH_GAL;\nif(this._contactSource==ZmItem.CONTACT){c=\"is:local\"\n}}this._searchIcon.className=\"DwtWait16Icon\";\nvar f={obj:this,ascending:d,query:e,queryHint:c,offset:this._list.size(),lastId:g,lastSortVal:b,respCallback:(new AjxCallback(this,this._handleResponseSearch,[h])),errorCallback:this._searchErrorCallback,accountName:(this._account&&this._account.name)};\nZmContactsHelper.search(f)\n};\nZmContactSearch.prototype._handleResponseSearch=function(c,a){this._controller.show(a.getResponse(),c);\nvar b=this._controller._list;\nif(b){this._list=b.getVector();\nif(b&&b.size()==1){this._listView.setSelection(b.get(0))\n}}this._searchIcon.className=\"ImgSearch\";\nthis._searchButton.setEnabled(true)\n};\nZmContactSearch.prototype.getContacts=function(){return this._listView.getSelection()\n};\nZmContactSearch.prototype.setAccount=function(a){if(this._account!=a){this._account=a;\nthis._resetSelectDiv()\n}};\nZmContactSearch.prototype.reset=function(b,a){this._offset=0;\nif(this._list){this._list.removeAll()\n}this._list=new AjxVector();\nthis._searchField.disabled=false;\nthis._searchField.focus();\nb=b||this._searchField.value;\nif(b){this._searchField.className=\"\";\nthis._searchField.value=b;\nthis._searchCleared=true\n}else{this._searchField.className=\"searchFieldHint\";\nthis._searchField.value=ZmMsg.contactPickerHint;\nthis._searchCleared=false\n}this.setAccount(a||this._account)\n};\nZmContactSearch.prototype._initialize=function(){this._searchForHash=this._options.searchFor?AjxUtil.arrayAsHash(this._options.searchFor):{};\nthis.getHtmlElement().innerHTML=this._contentHtml();\nif(this._options.preamble){var d=document.getElementById(this._htmlElId+\"_preamble\");\nd.innerHTML=this._options.preamble\n}this._searchIcon=document.getElementById(this._htmlElId+\"_searchIcon\");\nthis._searchButton=new DwtButton({parent:this,parentElement:(this._htmlElId+\"_searchButton\")});\nthis._searchButton.setText(ZmMsg.search);\nthis._searchButton.addSelectionListener(new AjxListener(this,this._searchButtonListener));\nvar b=this._htmlElId+\"_folders\";\nvar c=document.getElementById(b);\nif(c){this._selectDiv=new DwtSelect({parent:this,parentElement:b});\nthis._resetSelectDiv();\nthis._selectDiv.addChangeListener(new AjxListener(this,this._searchTypeListener))\n}this._searchField=document.getElementById(this._htmlElId+\"_searchField\");\nDwt.setHandler(this._searchField,DwtEvent.ONKEYUP,ZmContactSearch._keyPressHdlr);\nDwt.setHandler(this._searchField,DwtEvent.ONCLICK,ZmContactSearch._onclickHdlr);\nthis._keyPressCallback=new AjxCallback(this,this._searchButtonListener);\nvar a=document.getElementById(this._htmlElId+\"_results\");\nif(a){params={parent:this,parentElement:a,options:this._options};\nthis._listView=this._controller._listView=new ZmContactSearchListView(params)\n}this._initialized=true\n};\nZmContactSearch.prototype._contentHtml=function(){var d;\nif(appCtxt.multiAccounts){var c=appCtxt.accountList.visibleAccounts;\nfor(var b=0;\nb<c.length;\nb++){this._setSearchFor(c[b]);\nif(this._searchFor.length>1){d=true;\nbreak\n}}}else{this._setSearchFor();\nd=(this._searchFor.length>1)\n}var a={id:this._htmlElId,showSelect:d};\nreturn(AjxTemplate.expand(\"abook.Contacts#ZmContactSearch\",a))\n};\nZmContactSearch.prototype._setSearchFor=function(c){c=c||this._account;\nthis._searchFor=[];\nif(this._options.searchFor&&this._options.searchFor.length){for(var b=0;\nb<this._options.searchFor.length;\nb++){var a=this._options.searchFor[b];\nif(appCtxt.get(ZmContactSearch.SEARCHFOR_SETTING[a],null,c)){this._searchFor.push(a)\n}}}this._searchForHash=AjxUtil.arrayAsHash(this._searchFor)\n};\nZmContactSearch.prototype._resetSelectDiv=function(){if(!this._selectDiv){return\n}this._selectDiv.clearOptions();\nthis._setSearchFor();\nvar a=this._searchForHash;\nif(a[ZmContactsApp.SEARCHFOR_CONTACTS]){this._selectDiv.addOption(ZmMsg.contacts,false,ZmContactsApp.SEARCHFOR_CONTACTS);\nif(a[ZmContactsApp.SEARCHFOR_PAS]){this._selectDiv.addOption(ZmMsg.searchPersonalSharedContacts,false,ZmContactsApp.SEARCHFOR_PAS)\n}}if(a[ZmContactsApp.SEARCHFOR_GAL]){this._selectDiv.addOption(ZmMsg.GAL,true,ZmContactsApp.SEARCHFOR_GAL)\n}if(!appCtxt.get(ZmSetting.INITIALLY_SEARCH_GAL,null,this._account)||!appCtxt.get(ZmSetting.GAL_ENABLED,null,this._account)){this._selectDiv.setSelectedValue(ZmContactsApp.SEARCHFOR_CONTACTS)\n}};\nZmContactSearch.prototype._searchButtonListener=function(a){this._offset=0;\nthis._list.removeAll();\nthis.search()\n};\nZmContactSearch._keyPressHdlr=function(c){var b=DwtControl.getTargetControl(c);\nvar a=DwtKeyEvent.getCharCode(c);\nif(!b._searchCleared){b._searchField.className=b._searchField.value=\"\";\nb._searchCleared=true\n}if(b._keyPressCallback&&(a==13||a==3)){b._keyPressCallback.run();\nreturn false\n}return true\n};\nZmContactSearch._onclickHdlr=function(b){var a=DwtControl.getTargetControl(b);\nif(!a._searchCleared){a._searchField.className=a._searchField.value=\"\";\na._searchCleared=true\n}};\nZmContactSearchController=function(a){ZmContactListController.call(this,appCtxt.getShell(),appCtxt.getApp(ZmApp.CONTACTS))\n};\nZmContactSearchController.prototype=new ZmContactListController;\nZmContactSearchController.prototype.constructor=ZmContactSearchController;\nZmContactSearchController.prototype.toString=function(){return\"ZmContactSearchController\"\n};\nZmContactSearchController.prototype.show=function(a,d){var b=a.getAttribute(\"more\");\nvar c=this._list=a.getResults(ZmItem.CONTACT);\nif(c.size()==0&&d){this._listView._setNoResultsHtml()\n}b=b||(this._offset+ZmContactsApp.SEARCHFOR_MAX)<this._list.size();\nthis._listView.set(c)\n};\nZmContactSearchListView=function(a){a=a||{};\na.posStyle=Dwt.STATIC_STYLE;\na.className=a.className||\"ZmContactSearchListView\";\na.headerList=this._getHeaderList();\nZmContactsBaseView.call(this,a);\nthis._options=a.options\n};\nZmContactSearchListView.prototype=new ZmContactsBaseView;\nZmContactSearchListView.prototype.constructor=ZmContactSearchListView;\nZmContactSearchListView.prototype.toString=function(){return\"ZmContactSearchListView\"\n};\nZmContactSearchListView.prototype._getHeaderList=function(){var a=[];\na.push(new DwtListHeaderItem({field:ZmItem.F_TYPE,width:ZmMsg.COLUMN_WIDTH_FOLDER_CN}));\na.push(new DwtListHeaderItem({field:ZmItem.F_NAME,text:ZmMsg._name,width:ZmMsg.COLUMN_WIDTH_NAME_CN}));\na.push(new DwtListHeaderItem({field:ZmItem.F_EMAIL,text:ZmMsg.email}));\nreturn a\n};\nZmContactSearchListView.prototype._getCellContents=function(c,b,a,d,f,e){if(d==ZmItem.F_TYPE){c[b++]=AjxImg.getImageHtml(a.getIcon())\n}else{if(d==ZmItem.F_NAME){c[b++]=AjxStringUtil.htmlEncode(a.getFileAs())\n}else{if(d==ZmItem.F_EMAIL){c[b++]=AjxStringUtil.htmlEncode(a.getEmail())\n}}}return b\n}\n}};\n"
                    },
                    "redirectURL": "",
                    "headersSize": 364,
                    "bodySize": 185492
                },
                "cache": {},
                "timings": {
                    "send": 0,
                    "wait": 0,
                    "receive": 0
                }
            }
        ],
        "_webSocketEntries": {},
        "_settings": {
            "_proxy": {}
        }
    }
}
