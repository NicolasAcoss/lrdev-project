{
    "log": {
        "version": "1.2",
        "creator": {
            "name": "DevWeb",
            "version": "1.2"
        },
        "pages": [
            {
                "startedDateTime": "2022-12-06T11:38:17.648742Z",
                "id": "page_1",
                "title": "https://mail.etu.univ-lorraine.fr/zimbra/js/CalendarCore_all.js.zgz",
                "pageTimings": {}
            }
        ],
        "entries": [
            {
                "pageref": "page_1",
                "startedDateTime": "2022-12-06T11:38:17.648742Z",
                "time": 0,
                "_isResource": false,
                "request": {
                    "method": "GET",
                    "url": "https://mail.etu.univ-lorraine.fr/zimbra/js/CalendarCore_all.js.zgz?v=220726112844",
                    "httpVersion": "HTTP/2.0",
                    "cookies": [
                        {
                            "name": "UL-AUTHTRACE",
                            "value": "TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA",
                            "httpOnly": false
                        },
                        {
                            "name": "JSESSIONID",
                            "value": "node01ewv5q86m64i21vkfxtflutla86873.node0",
                            "httpOnly": false
                        },
                        {
                            "name": "ZM_AUTH_TOKEN",
                            "value": "0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b",
                            "httpOnly": false
                        }
                    ],
                    "headers": [
                        {
                            "name": "accept",
                            "value": "*/*"
                        },
                        {
                            "name": "accept-encoding",
                            "value": "gzip, deflate, br"
                        },
                        {
                            "name": "accept-language",
                            "value": "fr,fr-FR;q=0.8,en-US;q=0.5,en;q=0.3"
                        },
                        {
                            "name": "cookie",
                            "value": "UL-AUTHTRACE=TRACE-4112-JXC2ao-ce1Zm2D1QbNJ8m16DlLYEFM9cZACAS-LEIA; JSESSIONID=node01ewv5q86m64i21vkfxtflutla86873.node0; ZM_AUTH_TOKEN=0_a80cf5ba65b244a73d683b9482d447f357160abf_69643d33363a62636630316235642d373166332d343464652d396163322d3235343836613061666531323b6578703d31333a313637303336363239323738353b747970653d363a7a696d6272613b753d313a613b7469643d31303a313932323132303830333b76657273696f6e3d31343a382e382e31355f47415f333836393b"
                        },
                        {
                            "name": "dnt",
                            "value": "1"
                        },
                        {
                            "name": "referer",
                            "value": "https://mail.etu.univ-lorraine.fr/"
                        },
                        {
                            "name": "sec-fetch-dest",
                            "value": "empty"
                        },
                        {
                            "name": "sec-fetch-mode",
                            "value": "cors"
                        },
                        {
                            "name": "sec-fetch-site",
                            "value": "same-origin"
                        },
                        {
                            "name": "te",
                            "value": "trailers"
                        },
                        {
                            "name": "user-agent",
                            "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:102.0) Gecko/20100101 Firefox/102.0"
                        }
                    ],
                    "queryString": [
                        {
                            "name": "v",
                            "value": "220726112844"
                        }
                    ],
                    "headersSize": -1,
                    "bodySize": -1
                },
                "response": {
                    "status": 200,
                    "statusText": "OK",
                    "httpVersion": "HTTP/2.0",
                    "cookies": null,
                    "headers": [
                        {
                            "name": "accept-ranges",
                            "value": "bytes"
                        },
                        {
                            "name": "cache-control",
                            "value": "public, max-age=2595600"
                        },
                        {
                            "name": "content-type",
                            "value": "text/javascript"
                        },
                        {
                            "name": "date",
                            "value": "Tue, 06 Dec 2022 10:38:17 GMT"
                        },
                        {
                            "name": "expires",
                            "value": "Thu, 5 Jan 2023 11:38:17 GMT"
                        },
                        {
                            "name": "last-modified",
                            "value": "Tue, 26 Jul 2022 15:29:24 GMT"
                        },
                        {
                            "name": "server",
                            "value": "nginx"
                        },
                        {
                            "name": "x-frame-options",
                            "value": "SAMEORIGIN"
                        },
                        {
                            "name": "x-recouv-allowed",
                            "value": "Recouv"
                        }
                    ],
                    "content": {
                        "size": 360042,
                        "mimeType": "",
                        "text": "\n/* \n* Zimbra Collaboration Suite Web Client\n* Copyright (C) 2004-2017 Synacor, Inc.\n* https://www.zimbra.com/license\n*/\nif(AjxPackage.define(\"CalendarCore\")){if(AjxPackage.define(\"zimbraMail.calendar.model.ZmCalendar\")){ZmCalendar=function(a){a.type=ZmOrganizer.CALENDAR;\nZmFolder.call(this,a)\n};\nZmCalendar.prototype=new ZmFolder;\nZmCalendar.prototype.constructor=ZmCalendar;\nZmCalendar.prototype.isZmCalendar=true;\nZmCalendar.prototype.toString=function(){return\"ZmCalendar\"\n};\nZmCalendar.ID_CALENDAR=ZmOrganizer.ID_CALENDAR;\nZmCalendar.create=function(a){a.errorCallback=new AjxCallback(null,ZmCalendar._handleErrorCreate,a);\nZmOrganizer.create(a)\n};\nZmCalendar._handleErrorCreate=function(b,a){if(b.url&&(a.code==ZmCsfeException.SVC_PARSE_ERROR)){msg=AjxMessageFormat.format(ZmMsg.calFeedInvalid,b.url);\nZmOrganizer._showErrorMsg(msg);\nreturn true\n}return ZmOrganizer._handleErrorCreate(b,a)\n};\nZmCalendar.prototype.getIcon=function(){if(this.nId==ZmOrganizer.ID_ROOT){return null\n}if(this.link){return\"SharedCalendarFolder\"\n}return\"CalendarFolder\"\n};\nZmCalendar.prototype.setFreeBusy=function(c,d,b,a){if(this.excludeFreeBusy==c){return\n}this._organizerAction({action:\"fb\",attrs:{excludeFreeBusy:c?\"1\":\"0\"},callback:d,errorCallback:b,batchCmd:a})\n};\nZmCalendar.prototype.setChecked=function(b,a){if(this.isChecked==b){return\n}this.checkAction(checkAction,a)\n};\nZmCalendar.prototype.checkAction=function(b,a){var c=b?\"check\":\"!check\";\nvar d=new AjxCallback(this,this.checkedCallback,[b]);\nthis._organizerAction({action:c,batchCmd:a,callback:d})\n};\nZmCalendar.prototype.checkedCallback=function(d,b){var a=appCtxt.getOverviewController();\nvar e=a.getTreeController(this.type);\nvar f=appCtxt.getCurrentApp().getOverviewId();\nvar c=e.getTreeView(f);\nif(c&&this.id&&c._treeItemHash[this.id]){c._treeItemHash[this.id].setChecked(d)\n}};\nZmCalendar.prototype.mayContain=function(f){if(!f){return true\n}var e=false;\nif(f instanceof ZmCalendar){e=((f.parent==this)||(f.id==this.id)||this.isChildOf(f)||(!this.isInTrash()&&this.hasChild(f.name))||this.link)\n}else{if(this.noSuchFolder){return e\n}if(this.nId==ZmOrganizer.ID_ROOT){e=true\n}else{if(this.link){e=this.isReadOnly()\n}}if(!e){var a=(f instanceof Array)?f:[f];\nvar d=a[0];\nif(d&&d.folderId){e=true;\nfor(var b=0;\nb<a.length;\nb++){var c=appCtxt.getById(a[b].folderId);\nif(a[b].isReadOnly()&&c.owner!=this.owner){e=true;\nbreak\n}if(d.viewMode==ZmCalItem.MODE_NEW||c!=this){e=false;\nbreak\n}}}}}return !e\n};\nZmCalendar.prototype.notifyCreate=function(c){var b=ZmFolderTree.createFromJs(this,c,this.tree);\nvar a=ZmOrganizer.getSortIndex(b,ZmFolder.sortCompareNonMail);\nthis.children.add(b,a);\nb._notify(ZmEvent.E_CREATE)\n};\nZmCalendar.prototype.notifyModify=function(c){ZmFolder.prototype.notifyModify.call(this,c);\nvar b=false;\nvar a={};\nif(c.f!=null&&!c._isRemote){this._parseFlags(c.f);\na.excludeFreeBusy=true;\nb=true\n}if(b){this._notify(ZmEvent.E_MODIFY,{fields:a})\n}};\nZmCalendar.prototype.notifyDelete=function(e){if(this.isRemote()&&!this._deleteAction){var a=appCtxt.getOverviewController();\nvar d=a.getTreeController(this.type);\nvar f=appCtxt.getCurrentApp().getOverviewId();\nvar b=d&&d.getTreeView(f);\nvar c=b&&b.getTreeItemById(this.id);\nthis.noSuchFolder=true;\nif(c){c.setText(this.getName(true))\n}}else{ZmFolder.prototype.notifyDelete.call(this,e)\n}};\nZmCalendar.prototype._delete=function(){this._deleteAction=true;\nZmFolder.prototype._delete.call(this)\n};\nZmCalendar.checkName=function(a){return ZmOrganizer.checkName(a)\n};\nZmCalendar.prototype.supportsPrivatePermission=function(){return true\n};\nZmCalendar.prototype.supportsPublicAccess=function(){return true\n};\nZmCalendar.prototype.getRestUrl=function(b,a){if(!appCtxt.multiAccounts){return ZmFolder.prototype.getRestUrl.call(this,a)\n}if(this.restUrl){return this.restUrl\n}url=this._generateRestUrl(b);\nreturn url\n};\nZmCalendar.prototype._generateRestUrl=function(f){var e=document.location;\nvar b=this.getOwner();\nvar c=b||appCtxt.get(ZmSetting.USERNAME);\nif(appCtxt.multiAccounts){c=appCtxt.get(ZmSetting.USERNAME,null,f)\n}var a=c.match(/^(.*)@(.*)$/);\nvar d=e.host||(a&&a[2]);\nif(e.port&&e.port!=80&&(b==appCtxt.get(ZmSetting.USERNAME))){d=d+\":\"+e.port\n}return[e.protocol,\"//\",d,\"/service/user/\",c,\"/\",AjxStringUtil.urlEncode(this.getSearchPath(true))].join(\"\")\n};\nZmCalendar.prototype.isReadOnly=function(){if(this.isFeed()){return true\n}return ZmFolder.prototype.isReadOnly.call(this)\n};\nZmCalendar.prototype.supportsPublicAccess=function(){return true\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmAppt\")){ZmAppt=function(b,a){ZmCalItem.call(this,ZmItem.APPT,b);\nif(a){return\n}this.freeBusy=\"B\";\nthis.privacy=\"PUB\";\nthis.transparency=\"O\";\nthis.startDate=new Date();\nthis.endDate=new Date(this.startDate.getTime()+ZmCalViewController.DEFAULT_APPOINTMENT_DURATION);\nthis.otherAttendees=false;\nthis.rsvp=true;\nthis.inviteNeverSent=true;\nthis._attendees={};\nthis._attendees[ZmCalBaseItem.PERSON]=[];\nthis._attendees[ZmCalBaseItem.LOCATION]=[];\nthis._attendees[ZmCalBaseItem.EQUIPMENT]=[];\nthis.origAttendees=null;\nthis.origLocations=null;\nthis.origEquipment=null;\nthis._fwdAddrs={}\n};\nZmAppt.prototype=new ZmCalItem;\nZmAppt.prototype.constructor=ZmAppt;\nZmAppt.MODE_DRAG_OR_SASH=++ZmCalItem.MODE_LAST;\nZmAppt.ATTENDEES_SEPARATOR=\"; \";\nZmAppt.ACTION_SAVE=\"SAVE\";\nZmAppt.ACTION_SEND=\"SEND\";\nZmAppt.prototype.toString=function(){return\"ZmAppt\"\n};\nZmAppt.prototype.getAttendees=function(a){return this._attendees[a]\n};\nZmAppt.prototype.getAttendeesText=function(a,b){return ZmApptViewHelper.getAttendeesString(this._attendees[a],a,b)\n};\nZmAppt.prototype.hasAttendeeForType=function(a){return(this._attendees[a].length>0)\n};\nZmAppt.prototype.hasAttendees=function(){return this.hasAttendeeForType(ZmCalBaseItem.PERSON)||this.hasAttendeeForType(ZmCalBaseItem.LOCATION)||this.hasAttendeeForType(ZmCalBaseItem.EQUIPMENT)\n};\nZmAppt.prototype.setForwardAddress=function(a){this._fwdAddrs=a\n};\nZmAppt.prototype.getForwardAddress=function(){return this._fwdAddrs\n};\nZmAppt.loadOfflineData=function(d,g){var a=new ZmAppt(g);\nvar i;\nvar e;\nvar h={_recurrence:ZmRecurrence,alarmActions:AjxVector};\nfor(var b in d){if(h[b]){var f=new h[b]();\nfor(var c in d[b]){f[c]=d[b][c]\n}a[b]=f\n}else{a[b]=d[b]\n}}return a\n};\nZmApptClone=function(){};\nZmAppt.quickClone=function(b){ZmApptClone.prototype=b;\nvar a=new ZmApptClone();\na.startDate=new Date(b.startDate.getTime());\na.endDate=new Date(b.endDate.getTime());\na._uniqId=Dwt.getNextId();\na.origAttendees=AjxUtil.createProxy(b.origAttendees);\na.origLocations=AjxUtil.createProxy(b.origLocations);\na.origEquipment=AjxUtil.createProxy(b.origEquipment);\na._validAttachments=AjxUtil.createProxy(b._validAttachments);\nif(a._orig==null){a._orig=b\n}a.type=ZmItem.APPT;\na.rsvp=b.rsvp;\na.freeBusy=b.freeBusy;\nif(b.isRecurring()){a._recurrence=b.getRecurrence()\n}return a\n};\nZmAppt.createFromDom=function(c,d,b,a){var e=new ZmAppt(d.list);\ne._loadFromDom(c,(b||{}));\nif(e.id&&!a){appCtxt.cacheSet(e.id,e)\n}return e\n};\nZmAppt.prototype.getFolder=function(){return appCtxt.getById(this.folderId)\n};\nZmAppt.prototype.getToolTip=function(a){var c=this.apptClone||this._orig||this;\nvar b=(!c._toolTip||(c.otherAttendees&&!c.ptstHashMap));\nif(b){return{callback:c._getToolTip.bind(c,a),loading:false}\n}else{return c._toolTip||c._getToolTip(a)\n}};\nZmAppt.prototype._getToolTip=function(a,c){this.apptClone=ZmAppt.quickClone(this);\nvar b=this._handleResponseGetToolTip.bind(this.apptClone,a,c);\nthis.apptClone.getDetails(null,b)\n};\nZmAppt.prototype._handleResponseGetToolTip=function(g,q){var o=this.getOrganizer();\nvar n=this.getSentBy();\nvar m=appCtxt.get(ZmSetting.USERNAME);\nif(n||(o&&o!=m)){o=(this.message&&this.message.invite&&this.message.invite.getOrganizerName())||o;\nif(n){var l=appCtxt.getApp(ZmApp.CONTACTS);\nvar j=l&&l.getContactByEmail(n);\nn=(j&&j.getFullName())||n\n}}else{o=null;\nn=null\n}var e={appt:this,cal:(this.folderId!=ZmOrganizer.ID_CALENDAR&&g)?g.getCalendar():null,organizer:o,sentBy:n,when:this.getDurationText(false,false),location:this.getLocation(),width:\"250\",hideAttendees:true};\nthis.updateParticipantStatus();\nif(this.ptstHashMap!=null){var b={};\nvar d;\nvar h=true;\nd=b[ZmMsg.ptstAccept]=this._getPtstStatus(ZmCalBaseItem.PSTATUS_ACCEPT);\nh=h&&!d.count;\nd=b[ZmMsg.ptstDeclined]=this._getPtstStatus(ZmCalBaseItem.PSTATUS_DECLINED);\nh=h&&!d.count;\nd=b[ZmMsg.ptstTentative]=this._getPtstStatus(ZmCalBaseItem.PSTATUS_TENTATIVE);\nh=h&&!d.count;\nd=b[ZmMsg.ptstNeedsAction]=this._getPtstStatus(ZmCalBaseItem.PSTATUS_NEEDS_ACTION);\nh=h&&!d.count;\ne.hideAttendees=h;\ne.ptstStatus=b;\nvar c=[];\nif(!this.rsvp){var k=this._attendees[ZmCalBaseItem.PERSON];\nfor(var f=0;\nf<k.length;\nf++){var p=k[f];\nc.push(p.getAttendeeText(null,true))\n}e.attendeesText=this.getAttendeeToolTipString(c)\n}}var a=this._toolTip=AjxTemplate.expand(\"calendar.Appointment#Tooltip\",e);\nif(q){q.run(a)\n}else{return a\n}};\nZmAppt.prototype._getPtstStatus=function(b){var a=this.ptstHashMap[b];\nreturn{count:a?a.length:0,attendees:this.getAttendeeToolTipString(a)}\n};\nZmAppt.prototype.getAttendeeToolTipString=function(e){var d;\nvar a=10;\nif(e&&e.length>a){var b=e.length;\nvar c=e.splice(0,a);\nd=c.join(\",\")+\" (\"+(b-a)+\" \"+ZmMsg.more+\")\"\n}else{if(e){d=e.join(\",\")\n}}return d\n};\nZmAppt.prototype.getProposedTimeSummary=function(d){var f=this._orig||this;\nvar a=[];\nvar c=0;\nif(!this._summaryHtmlLineFormatter){this._summaryHtmlLineFormatter=new AjxMessageFormat(\"<tr><th align='left'>{0}</th><td>{1} {2}</td></tr>\");\nthis._summaryTextLineFormatter=new AjxMessageFormat(\"{0} {1} {2}\")\n}var b=d?this._summaryHtmlLineFormatter:this._summaryTextLineFormatter;\nif(d){a[c++]=\"<p>\\n<table border='0'>\\n\"\n}var e=[ZmMsg.subjectLabel,this.name,\"\"];\na[c++]=b.format(e);\na[c++]=\"\\n\";\nif(d){a[c++]=\"</table>\"\n}a[c++]=\"\\n\";\nif(d){a[c++]=\"<p>\\n<table border='0'>\\n\"\n}c=this.getApptTimeSummary(a,c,d,true);\nif(d){a[c++]=\"</table>\\n\"\n}a[c++]=d?\"<div>\":\"\\n\\n\";\na[c++]=ZmItem.NOTES_SEPARATOR;\na[c++]=d?\"</div><br>\":\"\\n\\n\";\nreturn a.join(\"\")\n};\nZmAppt.prototype.getSummary=function(q){if(this.isProposeTimeMode){return this.getProposedTimeSummary(q)\n}var e=this._orig||this;\nvar u=!this.inviteNeverSent&&(this.viewMode==ZmCalItem.MODE_EDIT||this.viewMode==ZmCalItem.MODE_EDIT_SINGLE_INSTANCE||this.viewMode==ZmCalItem.MODE_EDIT_SERIES);\nvar x=[];\nvar w=0;\nif(!this._summaryHtmlLineFormatter){this._summaryHtmlLineFormatter=new AjxMessageFormat(\"<tr><th align='left'>{0}</th><td>{1} {2}</td></tr>\");\nthis._summaryTextLineFormatter=new AjxMessageFormat(\"{0} {1} {2}\")\n}var v=q?this._summaryHtmlLineFormatter:this._summaryTextLineFormatter;\nif(q){x[w++]=\"<p>\\n<table border='0'>\\n\"\n}var o=u&&(e.getName()!=this.getName());\nvar z=[ZmMsg.subjectLabel,AjxStringUtil.htmlEncode(this.name),o?ZmMsg.apptModifiedStamp:\"\"];\nx[w++]=v.format(z);\nx[w++]=\"\\n\";\nvar p=appCtxt.get(ZmSetting.USERNAME),k;\nvar j=this.getMailFromAddress();\nif(j){p=j\n}else{if(this.identity){p=this.identity.sendFromAddress;\nk=this.identity.sendFromDisplay\n}}var C=this.organizer?this.organizer:p;\nvar s=(!this.organizer&&k)?(new AjxEmailAddress(p,null,k)).toString():ZmApptViewHelper.getAddressEmail(C).toString();\nvar f=q?AjxStringUtil.htmlEncode(s):s;\nvar z=[ZmMsg.organizer+\":\",f,\"\"];\nx[w++]=v.format(z);\nx[w++]=\"\\n\";\nif(this.getFolder().isRemote()&&this.identity){var E=this.identity;\ns=new AjxEmailAddress(E.sendFromAddress,null,E.sendFromDisplay);\ns=s.toString();\nf=q?AjxStringUtil.htmlEncode(s):s;\nx[w++]=v.format([ZmMsg.sentBy+\":\",f,\"\"]);\nx[w++]=\"\\n\"\n}if(q){x[w++]=\"</table>\"\n}x[w++]=\"\\n\";\nif(q){x[w++]=\"<p>\\n<table border='0'>\\n\"\n}var t=this.getLocation();\nvar B=q?AjxStringUtil.htmlEncode(t):t;\nvar h=e?e.getLocation():\"\";\nvar n=(t==h&&h==\"\");\nif(!n||this.isForwardMode){z=[ZmMsg.locationLabel,B,(u&&t!=h&&!this.isForwardMode)?ZmMsg.apptModifiedStamp:\"\"];\nx[w++]=v.format(z);\nx[w++]=\"\\n\"\n}var b=this.getAttendeesText(ZmCalBaseItem.LOCATION,true);\nif(b){var g=ZmApptViewHelper.getAttendeesString(this.origLocations,ZmCalBaseItem.LOCATION,true);\no=(u&&(g!=b));\nvar A=q?AjxStringUtil.htmlEncode(b):b;\nz=[ZmMsg.resourcesLabel,A,o?ZmMsg.apptModifiedStamp:\"\"];\nx[w++]=v.format(z);\nx[w++]=\"\\n\"\n}var D=this.getAttendeesText(ZmCalBaseItem.EQUIPMENT,true);\nif(D){var m=ZmApptViewHelper.getAttendeesString(this.origEquipment,ZmCalBaseItem.EQUIPMENT,true);\no=(u&&(m!=D));\nvar l=q?AjxStringUtil.htmlEncode(D):D;\nz=[ZmMsg.resourcesLabel,l,o?ZmMsg.apptModifiedStamp:\"\"];\nx[w++]=v.format(z);\nx[w++]=\"\\n\"\n}w=this.getApptTimeSummary(x,w,q,u);\nw=this.getRecurrenceSummary(x,w,q,u);\nif(this._attendees[ZmCalBaseItem.PERSON].length){if(q){x[w++]=\"</table>\\n<p>\\n<table border='0'>\"\n}x[w++]=\"\\n\";\nvar y=ZmApptViewHelper.getAttendeesByRole(this._attendees[ZmCalBaseItem.PERSON],ZmCalBaseItem.PERSON,ZmCalItem.ROLE_REQUIRED,10);\nvar d=ZmApptViewHelper.getAttendeesByRole(this._attendees[ZmCalBaseItem.PERSON],ZmCalBaseItem.PERSON,ZmCalItem.ROLE_OPTIONAL,10);\nvar r=q?AjxStringUtil.htmlEncode(y):y;\nvar c=q?AjxStringUtil.htmlEncode(d):d;\nvar a=(d==\"\")?ZmMsg.invitees:ZmMsg.requiredInvitees;\nz=[a+\":\",r,\"\"];\nx[w++]=v.format(z);\nx[w++]=\"\\n\";\nz=[ZmMsg.optionalInvitees+\":\",c,\"\"];\nif(d!=\"\"){x[w++]=v.format(z)\n}}if(q){x[w++]=\"</table>\\n\"\n}x[w++]=q?\"<div>\":\"\\n\\n\";\nx[w++]=ZmItem.NOTES_SEPARATOR;\nx[w++]=q?\"</div><br>\":\"\\n\\n\";\nreturn x.join(\"\")\n};\nZmAppt.prototype.needsRecurrenceSummary=function(){return this._recurrence.repeatType!=\"NON\"&&this.viewMode!=ZmCalItem.MODE_EDIT_SINGLE_INSTANCE&&this.viewMode!=ZmCalItem.MODE_DELETE_INSTANCE\n};\nZmAppt.prototype.getLayoutInfo=function(){return this._layout\n};\nZmAppt.prototype.getApptTimeSummary=function(b,d,a,c){var j=a?this._summaryHtmlLineFormatter:this._summaryTextLineFormatter;\nvar h=this._orig||this;\nvar k=this.startDate;\nvar f=this.endDate;\nif(this.viewMode==ZmCalItem.MODE_DELETE_INSTANCE){k=this.getUniqueStartDate();\nf=this.getUniqueEndDate()\n}if(this.needsRecurrenceSummary()){var g=c?((h.startDate.getTime()!=k.getTime())||(h.endDate.getTime()!=f.getTime())):false;\nparams=[ZmMsg.time+\":\",this._getTextSummaryTime(c,ZmMsg.time,null,k,f,g),\"\"];\nb[d++]=j.format(params)\n}else{if(k.getFullYear()==f.getFullYear()&&k.getMonth()==f.getMonth()&&k.getDate()==f.getDate()){var g=c?((h.startDate.getTime()!=this.startDate.getTime())||(h.endDate.getTime()!=this.endDate.getTime())):false;\nparams=[ZmMsg.time+\":\",this._getTextSummaryTime(c,ZmMsg.time,k,k,f,g),\"\"];\nb[d++]=j.format(params)\n}else{var g=c?(h.startDate.getTime()!=this.startDate.getTime()):false;\nparams=[ZmMsg.startLabel,this._getTextSummaryTime(c,ZmMsg.start,k,k,null,g),\"\"];\nb[d++]=j.format(params);\ng=c?(h.endDate.getTime()!=this.endDate.getTime()):false;\nparams=[ZmMsg.endLabel,this._getTextSummaryTime(c,ZmMsg.end,f,null,f,g),\"\"];\nb[d++]=j.format(params)\n}}return d\n};\nZmAppt.prototype.getRecurrenceSummary=function(b,d,e,f){var c=e?this._summaryHtmlLineFormatter:this._summaryTextLineFormatter;\nvar g=this._orig||this;\nif(this.needsRecurrenceSummary()){var a=false;\nif(f){a=g._recurrence.repeatType!=this._recurrence.repeatType||g._recurrence.repeatCustom!=this._recurrence.repeatCustom||g._recurrence.repeatCustomType!=this._recurrence.repeatCustomType||g._recurrence.repeatCustomCount!=this._recurrence.repeatCustomCount||g._recurrence.repeatCustomOrdinal!=this._recurrence.repeatCustomOrdinal||g._recurrence.repeatCustomDayOfWeek!=this._recurrence.repeatCustomDayOfWeek||g._recurrence.repeatCustomMonthDay!=this._recurrence.repeatCustomMonthDay||g._recurrence.repeatEnd!=this._recurrence.repeatEnd||g._recurrence.repeatEndType!=this._recurrence.repeatEndType||g._recurrence.repeatEndCount!=this._recurrence.repeatEndCount||g._recurrence.repeatEndDate!=this._recurrence.repeatEndDate||g._recurrence.repeatWeeklyDays!=this._recurrence.repeatWeeklyDays||g._recurrence.repeatMonthlyDayList!=this._recurrence.repeatMonthlyDayList||g._recurrence.repeatYearlyMonthsList!=this._recurrence.repeatYearlyMonthsList\n}params=[ZmMsg.recurrence,\":\",this._recurrence.getBlurb(),a?ZmMsg.apptModifiedStamp:\"\"];\nb[d++]=c.format(params);\nb[d++]=\"\\n\"\n}return d\n};\nZmAppt.prototype.setAttendees=function(d,c){this._attendees[c]=[];\nd=(d instanceof Array)?d:[d];\nfor(var b=0;\nb<d.length;\nb++){var a=ZmApptViewHelper.getAttendeeFromItem(d[b],c);\nif(a){this._attendees[c].push(a)\n}}};\nZmAppt.prototype.setFromMailMessage=function(d,a){ZmCalItem.prototype.setFromMailMessage.call(this,d,a);\nvar e=appCtxt.multiAccounts?d.getAccount():null;\nvar c={};\nc[appCtxt.get(ZmSetting.USERNAME,null,e)]=true;\nvar b=d.getAddresses(AjxEmailAddress.FROM,c,true);\nb.addList(d.getAddresses(AjxEmailAddress.CC,c,true));\nb.addList(d.getAddresses(AjxEmailAddress.TO,c,true));\nthis._attendees[ZmCalBaseItem.PERSON]=b.getArray()\n};\nZmAppt.prototype.setFromMailMessageInvite=function(c){var a=c.invite;\nvar b=(!a.isRecurring())?ZmCalItem.MODE_FORWARD:ZmCalItem.MODE_FORWARD_SERIES;\nif(a.isRecurring()&&a.isException()){b=ZmCalItem.MODE_FORWARD_SINGLE_INSTANCE\n}this.setFromMessage(c,b);\nthis.name=c.subject;\nthis.location=c.invite.getLocation();\nthis.allDayEvent=c.invite.isAllDayEvent();\nif(c.apptId){this.invId=c.apptId\n}this.uid=c.invite.components?c.invite.components[0].uid:null;\nif(this.isForwardMode){this.forwardInviteMsgId=c.id;\nif(!a.isOrganizer()){this.name=ZmMsg.fwd+\": \"+c.subject\n}this.status=a.components?a.components[0].status:ZmCalendarApp.STATUS_CONF\n}if(this.isProposeTimeMode){this.proposeInviteMsgId=c.id;\nthis.convertToLocalTimezone();\nif(!this.ridZ){this.ridZ=c.invite.components?c.invite.components[0].ridZ:null\n}this.seq=c.invite.getSequenceNo()\n}};\nZmAppt.prototype.isPrivate=function(){return(this.privacy!=\"PUB\")\n};\nZmAppt.prototype.setPrivacy=function(a){this.privacy=a\n};\nZmAppt.prototype._setExtrasFromMessage=function(j){ZmCalItem.prototype._setExtrasFromMessage.apply(this,arguments);\nthis.freeBusy=j.invite.getFreeBusy();\nthis.privacy=j.invite.getPrivacy();\nvar g={};\nthis._replies=j.invite.getReplies();\nif(this._replies){for(var o=0;\no<this._replies.length;\no++){var s=this._replies[o].at;\nvar k=this._replies[o].ptst;\nif(s&&k){g[s]=k\n}}}this._attendees[ZmCalBaseItem.PERSON]=[];\nthis.origAttendees=[];\nvar f;\nvar l=j.invite.getAttendees();\nif(l){var q=window.parentAppCtxt||window.appCtxt;\nfor(var o=0;\no<l.length;\no++){var n=l[o];\nvar e=n.a;\nvar s=n.d;\nvar m=new AjxEmailAddress(e,null,s,null,n.isGroup,n.isGroup&&n.exp);\nq.setIsExpandableDL(n.a,m.canExpand);\nif(n.rsvp){f=true\n}var d=n.isGroup?ZmCalBaseItem.GROUP:ZmCalBaseItem.PERSON;\nvar h=ZmApptViewHelper.getAttendeeFromItem(m,d);\nif(h){h.setParticipantStatus(g[e]||n.ptst);\nh.setParticipantRole(n.role||ZmCalItem.ROLE_REQUIRED);\nthis._attendees[ZmCalBaseItem.PERSON].push(h);\nthis.origAttendees.push(h)\n}}}this._attendees[ZmCalBaseItem.LOCATION]=[];\nthis.origLocations=[];\nthis._ptstLocationMap={};\nthis._attendees[ZmCalBaseItem.EQUIPMENT]=[];\nthis.origEquipment=[];\nvar p=j.invite.getResources();\nif(p){for(var o=0;\no<p.length;\no++){var e=p[o].a;\nvar c=p[o].d;\nvar k=p[o].ptst;\nif(c&&k&&(this._ptstLocationMap[c]!=null)){this._ptstLocationMap[c].setParticipantStatus(g[e]||k)\n}if(p[o].rsvp){f=true\n}var b=AjxEmailAddress.split(p[o].a)[0];\nvar a=ZmApptViewHelper.getAttendeeFromItem(b,ZmCalBaseItem.LOCATION,false,false,true);\nif(a||this.isLocationResource(b,p[o].d)){if(!a){a=ZmApptViewHelper.getAttendeeFromItem(b,ZmCalBaseItem.LOCATION)\n}if(!a){continue\n}if(p[o].d){a.setAttr(ZmResource.F_locationName,p[o].d)\n}a.setParticipantStatus(g[b]||k);\nthis._attendees[ZmCalBaseItem.LOCATION].push(a);\nthis.origLocations.push(a)\n}else{var r=ZmApptViewHelper.getAttendeeFromItem(b,ZmCalBaseItem.EQUIPMENT);\nif(r){r.setParticipantStatus(g[b]||k);\nthis._attendees[ZmCalBaseItem.EQUIPMENT].push(r);\nthis.origEquipment.push(r)\n}}}}this.rsvp=f;\nif(j.invite.hasOtherAttendees()){if(this._orig){this._orig.setRsvp(f)\n}}if(!this.isDraft&&!this.hasAttendees()){this.inviteNeverSent=true\n}if(!this.status){this.status=j.invite.getStatus()\n}if(!this.transparency){this.transparency=j.invite.getTransparency()\n}};\nZmAppt.prototype.isLocationResource=function(g,b){var h=this.location;\nvar c=AjxEmailAddress.split(h);\nfor(var e=0;\ne<c.length;\ne++){var f=AjxStringUtil.trim(c[e]);\nif(!f){continue\n}if(b==f){return true\n}var a=AjxEmailAddress.parse(f);\nif(!a){continue\n}var d=a.getName()||a.getDispName();\nif(g==a.getAddress()||b==d){return true\n}}return false\n};\nZmAppt.prototype._getTextSummaryTime=function(e,h,b,a,d,j){var k=appCtxt.get(ZmSetting.CAL_SHOW_TIMEZONE);\nvar c=[];\nvar f=0;\nif(b){c[f++]=AjxDateUtil.longComputeDateStr(b);\nc[f++]=\", \"\n}if(this.isAllDayEvent()){c[f++]=ZmMsg.allDay\n}else{var g=AjxDateFormat.getTimeInstance();\nif(a){c[f++]=g.format(a)\n}if(a&&d){c[f++]=\" - \"\n}if(d){c[f++]=g.format(d)\n}c[f++]=\" \";\nc[f++]=AjxTimezone.getLongName(AjxTimezone.getClientId(this.timezone))\n}if(e&&((this._orig&&this._orig.isAllDayEvent()!=this.isAllDayEvent())||j)){c[f++]=\" \";\nc[f++]=ZmMsg.apptModifiedStamp\n}c[f++]=\"\\n\";\nreturn c.join(\"\")\n};\nZmAppt.prototype._loadFromDom=function(b,a){ZmCalItem.prototype._loadFromDom.call(this,b,a);\nthis.privacy=this._getAttr(b,a,\"class\");\nthis.transparency=this._getAttr(b,a,\"transp\");\nthis.otherAttendees=this._getAttr(b,a,\"otherAtt\");\nthis.location=this._getAttr(b,a,\"loc\");\nthis.isDraft=this._getAttr(b,a,\"draft\");\nthis.inviteNeverSent=this._getAttr(b,a,\"neverSent\")||false;\nthis.hasEx=this._getAttr(b,a,\"hasEx\")||false\n};\nZmAppt.prototype._getRequestNameForMode=function(b,a){switch(b){case ZmCalItem.MODE_NEW:case ZmCalItem.MODE_NEW_FROM_QUICKADD:case ZmAppt.MODE_DRAG_OR_SASH:return\"CreateAppointmentRequest\";\ncase ZmCalItem.MODE_EDIT_SINGLE_INSTANCE:return !a?\"CreateAppointmentExceptionRequest\":\"ModifyAppointmentRequest\";\ncase ZmCalItem.MODE_EDIT:case ZmCalItem.MODE_EDIT_SERIES:return\"ModifyAppointmentRequest\";\ncase ZmCalItem.MODE_DELETE:case ZmCalItem.MODE_DELETE_SERIES:case ZmCalItem.MODE_DELETE_INSTANCE:return\"CancelAppointmentRequest\";\ncase ZmCalItem.MODE_PURGE:return\"ItemActionRequest\";\ncase ZmCalItem.MODE_FORWARD:case ZmCalItem.MODE_FORWARD_SERIES:case ZmCalItem.MODE_FORWARD_SINGLE_INSTANCE:return\"ForwardAppointmentRequest\";\ncase ZmCalItem.MODE_FORWARD_INVITE:return\"ForwardAppointmentInviteRequest\";\ncase ZmCalItem.MODE_GET:return\"GetAppointmentRequest\";\ncase ZmCalItem.MODE_PROPOSE_TIME:return\"CounterAppointmentRequest\"\n}return null\n};\nZmAppt.prototype._addExtrasToRequest=function(b,a){ZmCalItem.prototype._addExtrasToRequest.call(this,b,a);\na.fb=this.freeBusy;\na[\"class\"]=this.privacy;\na.transp=this.transparency;\nvar c=false;\nif(!this.isSend&&this.hasAttendees()){c=this.isDraft||this.makeDraft\n}a.draft=c?1:0;\nif(!this.isSend&&this.hasAttendees()){b.echo=\"1\"\n}};\nZmAppt.prototype.setRsvp=function(a){this.rsvp=a\n};\nZmAppt.prototype.shouldRsvp=function(){return this.rsvp\n};\nZmAppt.prototype.updateParticipantStatus=function(){if(this._orig){return this._orig.updateParticipantStatus()\n}var b={};\nvar c=this._attendees[ZmCalBaseItem.PERSON];\nfor(var d=0;\nd<c.length;\nd++){var a=c[d];\nvar e=a.getParticipantStatus()||\"NE\";\nif(!b[e]){b[e]=[]\n}b[e].push(a.getAttendeeText(null,true))\n}this.ptstHashMap=b\n};\nZmAppt.prototype.addAttendeesToChckConflictsRequest=function(e){var d,f,c,a,b;\nfor(d in this._attendees){if(d==ZmCalBaseItem.PERSON){continue\n}if(this._attendees[d]&&this._attendees[d].length){f=e.usr=[];\nfor(c=0;\nc<this._attendees[d].length;\nc++){a=this._attendees[d][c];\nb=null;\nif(a._inviteAddress){b=a._inviteAddress;\ndelete a._inviteAddress\n}else{b=a.getEmail()\n}if(!b){continue\n}if(b instanceof Array){b=b[0]\n}f.push({name:b})\n}}}};\nZmAppt.prototype.send=function(c,d,a,b){this._mode=ZmAppt.ACTION_SEND;\nthis.isSend=true;\nZmCalItem.prototype.save.call(this,c,d,a,b)\n};\nZmAppt.prototype.save=function(d,e,b,c,a){this._mode=ZmAppt.ACTION_SAVE;\nthis.isSend=false;\nthis.makeDraft=AjxUtil.isUndefined(a)?this.hasAttendees():a;\nZmCalItem.prototype.save.call(this,d,e,b,c)\n};\nZmAppt.prototype._doCancel=function(d,e,c,b,a){this._mode=ZmAppt.ACTION_SEND;\nthis.isSend=true;\nZmCalItem.prototype._doCancel.call(this,d,e,c,b,a)\n};\nZmAppt.prototype._sendCancelMsg=function(a){this.send(null,a)\n};\nZmAppt.prototype._addAttendeesToRequest=function(g,c,b,h,d){var l=this._dispNamesNotifyList={};\nfor(var k in this._attendees){if(this._attendees[k]&&this._attendees[k].length){for(var f=0;\nf<this._attendees[k].length;\nf++){this._addAttendeeToRequest(g,c,b,this._attendees[k][f],k,d)\n}}}if(this._sendNotificationMail&&this.isOrganizer()&&c&&b&&this.isSend){for(var f=0;\nf<b.length;\nf++){var j,n=b[f],a=l[n];\nj={a:n,t:AjxEmailAddress.toSoapType[AjxEmailAddress.TO]};\nif(a){j.p=a\n}c.e.push(j)\n}}if(this.isOrganizer()){ZmCalItem.prototype._addAttendeesToRequest.call(this,g,c,b,h)\n}delete this._dispNamesNotifyList\n};\nZmAppt.prototype._addAttendeeToRequest=function(k,f,b,q,n,g){var o;\nif(q._inviteAddress){o=q._inviteAddress;\ndelete q._inviteAddress\n}else{o=q.getLookupEmail()||q.getEmail()\n}if(!o){return\n}var c=q.getFullName();\nif(k){var d={};\nvar j=ZmCalItem.ROLE_NON_PARTICIPANT;\nif(n==ZmCalBaseItem.PERSON){j=q.getParticipantRole()?q.getParticipantRole():ZmCalItem.ROLE_REQUIRED\n}d.role=j;\nvar r=q.getParticipantStatus();\nif(!r||n===ZmCalBaseItem.PERSON&&this.dndUpdate){r=ZmCalBaseItem.PSTATUS_NEEDS_ACTION\n}if(b){var a=false;\nfor(var h=0;\nh<b.length;\nh++){if(o==b[h]){a=true;\nbreak\n}}r=a?ZmCalBaseItem.PSTATUS_NEEDS_ACTION:(q.getParticipantStatus()||ZmCalBaseItem.PSTATUS_NEEDS_ACTION);\nif(a&&c){this._dispNamesNotifyList[o]=c\n}}d.ptst=r;\nvar p=this.rsvp?\"1\":\"0\";\nif(n!=ZmCalBaseItem.PERSON){d.cutype=ZmCalendarApp.CUTYPE_RESOURCE;\nif(this.isOrganizer()){p=\"1\"\n}}if(this._cancelFutureInstances){p=\"0\"\n}d.rsvp=p;\nif(o instanceof Array){o=o[0]\n}d.a=o;\nif(c){d.d=c\n}k.at.push(d)\n}if(this._sendNotificationMail&&this.isOrganizer()&&f&&!b&&!this.__newFolderId&&this.isSend){var l={};\nl.a=o;\nif(c){l.p=c\n}l.t=AjxEmailAddress.toSoapType[AjxEmailAddress.TO];\nf.e.push(l)\n}};\nZmAppt.prototype.replaceAttendee=function(d,c){var e=this._attendees[ZmCalBaseItem.PERSON];\nif(e&&e.length){for(var b=0;\nb<e.length;\nb++){if(e[b].getEmail()==d){e[b]=this._createAttendeeFromMail(c);\nbreak\n}}}this._attendees[ZmCalBaseItem.PERSON]=e\n};\nZmAppt.prototype._createAttendeeFromMail=function(b){var a=new ZmContact(null);\na.initFromEmail(b);\nreturn a\n};\nZmAppt.prototype._getInviteFromError=function(a){return(a._data.GetAppointmentResponse.appt[0].inv[0])\n};\nZmAppt.prototype.forwardInvite=function(p,g,h){var q={},r=this._getRequestNameForMode(ZmCalItem.MODE_FORWARD_INVITE,this.isException),c=q[r]={_jsns:\"urn:zimbraMail\"},b=c.m={},l=this.getRemoteFolderOwner(),f=this.getMailFromAddress(),k=b.e=[],j=this._fwdAddrs,o,n,a,d;\nif(this.forwardInviteMsgId){c.id=this.forwardInviteMsgId\n}b.su=this.name;\nthis.isForwardMode=true;\nthis._addNotesToRequest(b);\nif(this.isOrganizer()&&!l&&f){k.push({a:f,t:AjxEmailAddress.toSoapType[AjxEmailAddress.FROM]})\n}for(d=0;\nd<j.length;\nd++){o=j[d];\na=\"\";\nif(o._inviteAddress){n=o._inviteAddress;\ndelete o._inviteAddress\n}else{if(o.isAjxEmailAddress){n=o.address;\na=o.dispName||o.name\n}else{if(o instanceof ZmContact){n=o.getEmail();\na=o.getFullName()\n}}}if(!n){continue\n}if(n instanceof Array){n=n[0]\n}this._addAddressToRequest(b,n,AjxEmailAddress.toSoapType[AjxEmailAddress.TO],a)\n}this._sendRequest(null,l,p,g,q,r)\n};\nZmAppt.prototype.setForwardMode=function(a){this.isForwardMode=a\n};\nZmAppt.prototype.setProposeTimeMode=function(a){this.isProposeTimeMode=a\n};\nZmAppt.prototype.sendCounterAppointmentRequest=function(h,i,f){var o=ZmCalItem.MODE_PROPOSE_TIME,B={},v=this._getRequestNameForMode(o,this.isException),d=B[v]={_jsns:\"urn:zimbraMail\"},t=d.m={},w=t.e=[],c=t.inv={},r=c.comp=[],x=c.comp[0]={},p=this.getFolder(),k=p.getAccount(),b=this.getRemoteFolderOwner(),y=this.getFolder().getAccount().name,j=this._currentlyLoaded&&this._currentlyLoaded.cif,n=b&&y&&y!=b,g=this.getMailFromAddress(),q,l,u,A,z,C,a,s;\nthis._addInviteAndCompNum(d);\nt.su=ZmMsg.subjectNewTime+\": \"+this.name;\nif(this.isOrganizer()&&!b&&g){w.push({a:g,t:AjxEmailAddress.toSoapType[AjxEmailAddress.FROM]})\n}else{if(n||j){w.push({a:n?b:j,t:AjxEmailAddress.toSoapType[AjxEmailAddress.FROM]});\nw.push({a:y,t:AjxEmailAddress.toSoapType[AjxEmailAddress.SENDER]})\n}}if(this.organizer){q=ZmApptViewHelper.getOrganizerEmail(this.organizer);\nl=q.getAddress();\nw.push({a:l,t:AjxEmailAddress.toSoapType[AjxEmailAddress.TO]})\n}if(this.ridZ&&f!=ZmCalItem.MODE_EDIT_SERIES){u=x.exceptId={};\nu.d=this.ridZ\n}x.name=this.name;\nif(this.uid!=null&&this.uid!=-1){x.uid=this.uid\n}if(this.seq){x.seq=this.seq\n}this._addDateTimeToRequest(d,x);\nthis._addNotesToRequest(t);\nif(!(appCtxt.isOffline&&k.isMain)){A=(appCtxt.multiAccounts)?k.getEmail():appCtxt.get(ZmSetting.USERNAME);\nC=g||A;\nz=this.organizer||C;\na=x.or={};\na.a=z;\nif(p.isRemote()){a.sentBy=C\n}q=ZmApptViewHelper.getOrganizerEmail(this.organizer);\ns=q.getName();\nif(s){a.d=s\n}}this._sendRequest(null,b,h,i,B,v)\n};\nZmAppt.prototype.forward=function(g,h){var o=ZmCalItem.MODE_FORWARD,w=this.isException;\nif(this.viewMode==ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){o=ZmCalItem.MODE_FORWARD_SINGLE_INSTANCE;\nif(!this.isException){w=true\n}}else{if(this.viewMode==ZmCalItem.MODE_EDIT_SERIES){o=ZmCalItem.MODE_FORWARD_SERIES\n}}if(this.forwardInviteMsgId){this.forwardInvite(g,h,o);\nreturn\n}var A={},x=this._getRequestNameForMode(o,this.isException),c=A[x]={_jsns:\"urn:zimbraMail\"},s,n,t,j,p,b,y,q,r=c.m={},a=this.getRemoteFolderOwner(),f=this.getMailFromAddress(),v=r.e=[],k=this._fwdAddrs,l,d,B,u;\nif(this.uid!=null&&this.uid!=-1){c.id=this.id\n}if(w){s=c.exceptId={};\nif(this.isException){n=this.message?this.message:null;\nt=(n&&n.invite)?n.invite:null;\nj=t.getExceptId();\ns.d=j.d;\nif(j.tz){s.tz=j.tz\n}}else{p=this._orig?this._orig.allDayEvent:this.allDayEvent;\nif(p!=\"1\"){b=AjxDateUtil.getServerDateTime(this.getOrigStartDate(),this.startsInUTC);\nq=this.getOrigTimezone();\nif(!this.startsInUTC&&q){s.tz=q\n}s.d=b\n}else{b=AjxDateUtil.getServerDate(this.getOrigStartDate());\ns.d=b\n}}}if(this.timezone){var z=AjxTimezone.getClientId(this.timezone);\nZmTimezone.set(c,z,null,true);\ny=this.timezone\n}r.su=this.name;\nthis.isForwardMode=true;\nthis._addNotesToRequest(r);\nif(this.isOrganizer()&&!a&&f){v.push({a:f,t:AjxEmailAddress.toSoapType[AjxEmailAddress.FROM]})\n}for(u=0;\nu<k.length;\nu++){l=k[u];\nif(!l){continue\n}B=\"\";\nif(l._inviteAddress){d=l._inviteAddress;\ndelete l._inviteAddress\n}else{if(l.isAjxEmailAddress){d=l.address;\nB=l.dispName||l.name\n}else{if(l instanceof ZmContact){d=l.getEmail();\nB=l.getFullName()\n}}}if(!d){continue\n}if(d instanceof Array){d=d[0]\n}this._addAddressToRequest(r,d,AjxEmailAddress.toSoapType[AjxEmailAddress.TO],B)\n}this._sendRequest(null,a,g,h,A,x)\n};\nZmAppt.prototype._addAddressToRequest=function(a,f,c,b){var d={};\nd.a=f;\nd.t=c;\nif(b){d.p=b\n}a.e.push(d)\n};\nZmAppt.prototype.setProposedInvite=function(a){this.proposedInvite=a\n};\nZmAppt.prototype.getRecurrenceFromInvite=function(a){return(a&&a.comp&&a.comp[0])?a.comp[0].recur:null\n};\nZmAppt.prototype.setInvIdFromProposedInvite=function(e,f){var b=f.getRecurrenceId();\nif(f.components[0].ridZ){for(var d=0;\nd<e.length;\nd++){var a=e[d];\nif(a.comp[0].ridZ==b){this.invId=this.id+\"-\"+a.id;\nbreak\n}}if(!this.invId){this.invId=this.id+\"-\"+e[0].id;\nthis.ridZ=b;\nvar c=ZmInvite.createFromDom(e);\nif(c.isRecurring()){this.isException=true;\nthis.recurring=this.getRecurrenceFromInvite(e[0]);\nthis._origStartDate=f.getStartDateFromExceptId()\n}}}else{this.invId=this.id+\"-\"+e[0].id\n}};\nZmCalItem.prototype.clearRecurrence=function(){this._recurrence=new ZmRecurrence(this);\nthis.recurring=false\n};\nZmAppt.loadById=function(c,b,a){return ZmAppt.__load(c,null,b,a)\n};\nZmAppt.loadByUid=function(b,c,a){return ZmAppt.__load(null,b,c,a)\n};\nZmAppt.__load=function(g,b,f,a){var c={_jsns:\"urn:zimbraMail\",includeContent:1};\nif(g){c.id=g\n}else{if(b){c.uid=b\n}}var e={jsonObj:{GetAppointmentRequest:c},accountName:appCtxt.multiAccounts?appCtxt.accountList.mainAccount.name:null,asyncMode:Boolean(f),callback:new AjxCallback(ZmAppt.__loadResponse,[f]),errorCallback:a};\nvar d=appCtxt.getAppController().sendRequest(e);\nif(!f){return ZmAppt.__loadResponse(null,d)\n}};\nZmAppt.__loadResponse=function(g,f){var e=f&&f._data;\nvar b=e&&e.GetAppointmentResponse;\nvar a=b&&b.appt;\na=a&&a[0];\nif(!a){return null\n}var d=new ZmAppt();\nd._loadFromDom(a,{});\nif(a.inv){var c={invite:new ZmInvite.createFromDom(a.inv),getBodyPart:function(h){return(h==ZmMimeTable.TEXT_HTML?a.descHtml:a.desc)||\"\"\n}};\nd.setFromMessage(c)\n}if(g){g.run(d)\n}return d\n};\nZmAppt.prototype.checkDSTChangeOnEndDate=function(){var e=this.endDate;\nvar c=e.getTimezoneOffset();\nvar b=new Date(e);\nb.setTime(e.getTime()-AjxDateUtil.MSEC_PER_DAY);\nvar d=b.getTimezoneOffset();\nvar a=d-c;\nreturn a\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmApptList\")){ZmApptList=function(){ZmList.call(this,ZmItem.APPT)\n};\nZmApptList.prototype=new ZmList;\nZmApptList.prototype.constructor=ZmApptList;\nZmApptList.prototype.isZmApptList=true;\nZmApptList.prototype.toString=function(){return\"ZmApptList\"\n};\nZmApptList.prototype.loadFromSummaryJs=function(c,b){if(!c){return\n}for(var f=0;\nf<c.length;\nf++){var a=c[f];\nvar h=a?a.inst:null;\nif(h){var e={list:this};\nfor(var d=0;\nd<h.length;\nd++){var g=ZmAppt.createFromDom(a,e,h[d],b);\nif(g){this.add(g)\n}}}}};\nZmApptList.prototype.indexOf=function(a){return this._vector.indexOf(a)\n};\nZmApptList.sortVector=function(a){a.sort(ZmCalBaseItem.compareByTimeAndDuration)\n};\nZmApptList.mergeVectors=function(c){var a=new AjxVector();\nif(!c){return a\n}if(c.length==1){return c[0].clone()\n}for(var b=0;\nb<c.length;\nb++){a.addList(c[b])\n}ZmApptList.sortVector(a);\nreturn a\n};\nZmApptList.toVector=function(g,b,f,c,j){var l=new AjxVector();\nvar h=g.getVector();\nvar k=h.size();\nfor(var e=0;\ne<k;\ne++){var d=h.get(e);\nvar a=d.getFolder();\nif(d.isInRange(b,f)||(d.isAlarmInRange()&&j)){if(d.isAllDayEvent()&&!c){l.add(ZmAppt.quickClone(d))\n}else{ZmApptList._fanout(d,l,b,f,c,j)\n}}}ZmApptList.sortVector(l);\nreturn l\n};\nZmApptList._fanout=function(j,l,b,e,c,k){var a=ZmAppt.quickClone(j);\nvar d=0;\nvar h=j.getEndTime();\nif(a.isAllDayEvent()){var g=new Date(h);\ng.setHours(0,0,0,0);\na.setEndDate(g);\nh=g.getTime()\n}var f;\nif(b<j.getStartTime()){f=new Date(j.getStartTime());\nf.setDate(f.getDate()+1);\nf.setHours(0,0,0,0)\n}else{f=new Date(b)\n}while(true){if(a.isMultiDay()){if(a.getStartTime()>=a.getEndTime()){break\n}if(AjxDateUtil.isDayShifted(f)){AjxDateUtil.rollToNextDay(f)\n}var i=ZmAppt.quickClone(a);\ni._fanoutFirst=(d==0);\ni._orig=j;\ni.setEndDate(f);\ni._fanoutLast=(i.getEndTime()==h);\ni._fanoutNum=d;\ni.uniqStartTime=i.getStartTime();\nl.add(i);\nd++;\na.setStartDate(f);\nif(e<f.getTime()){break\n}f.setDate(f.getDate()+1);\nf.setHours(0,0,0,0)\n}else{if(j.isInRange(b,e)||(a.isAlarmInRange()&&k)){a._fanoutFirst=d==0;\na._fanoutLast=a.getEndTime()==h;\nif(!a._fanoutFirst){a._orig=j\n}a._fanoutNum=d;\na.uniqStartTime=a.getStartTime();\nl.add(a)\n}break\n}}};\nZmApptList.prototype.getSubset=function(f,b){var a=new ZmApptList();\nvar g=this.getVector();\nvar d=g.size();\nfor(var c=0;\nc<d;\nc++){var e=g.get(c);\nif(e.isInRange(f,b)){a.add(e)\n}}return a\n};\nZmApptList.prototype.moveItems=function(e){e=Dwt.getParams(arguments,[\"items\",\"folder\",\"attrs\",\"callback\",\"errorCallback\",\"finalCallback\",\"noUndo\",\"actionTextKey\"]);\nvar c=AjxUtil.hashCopy(e);\nc.items=AjxUtil.toArray(e.items);\nc.attrs=e.attrs||{};\nif(c.folder.id==ZmFolder.ID_TRASH){c.actionTextKey=(e.actionTextKey!==null)?(e.actionTextKey||\"actionTrash\"):null;\nc.action=\"trash\";\nvar f=appCtxt.getCurrentView();\nif(f){var d=f.getController();\nif(d){return d._deleteAppointment(c.items[0])\n}}}else{c.actionTextKey=(e.actionTextKey!==null)?(e.actionTextKey||\"actionMove\"):null;\nc.actionArg=e.folder.getName(false,false,true);\nc.action=\"move\";\nc.attrs.l=e.folder.id\n}if(appCtxt.multiAccounts){var b=e.items[0].getFolderId();\nvar a=appCtxt.getById(b);\nif((e.items[0].isDraft&&e.folder.id==ZmFolder.ID_DRAFTS)||(e.folder.isRemote())||(a.isRemote())){c.accountName=e.items[0].getAccount().name\n}}c.errorCallback=e.errorCallback;\nthis._itemAction(c)\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmApptCache\")){ZmApptCache=function(a){this._calViewController=a;\nthis.clearCache()\n};\nZmApptCache.prototype.toString=function(){return\"ZmApptCache\"\n};\nZmApptCache.prototype.clearCache=function(c){if(!c){this._cachedApptSummaries={};\nthis._cachedApptVectors={};\nthis._cachedIds={}\n}else{var h=this._cachedApptVectors[c];\nif(h){for(var d in h){var f=h[d];\nvar b=f.size();\nfor(var e=0;\ne<b;\ne++){var g=f.get(e);\nif(g.folderId==c){delete this._cachedIds[g.id]\n}}}}delete this._cachedApptSummaries[c];\ndelete this._cachedApptVectors[c]\n}this._cachedMergedApptVectors={};\nvar a=this._calViewController.getMiniCalCache();\na.clearCache()\n};\nZmApptCache._sortFolderId=function(d,c){return d-c\n};\nZmApptCache.prototype._getCachedMergedKey=function(c){var a=[];\na=a.concat(c.folderIds);\na.sort();\nvar b=c.query&&c.query.length>0?(c.query+\":\"):\"\";\nreturn(c.start+\":\"+c.end+\":\"+c.fanoutAllDay+\":\"+b+a.join(\":\"))\n};\nZmApptCache.prototype._getCachedVector=function(b,f,e,c,j){var g=this._cachedApptVectors[c];\nif(g==null){g=this._cachedApptVectors[c]={}\n}var a=j?(\":\"+j):\"\";\nvar i=b+\":\"+f+\":\"+e+a;\nvar d=g[i];\nif(d==null){var h=this._getCachedApptSummaries(b,f,c,j);\nif(h!=null){d=g[i]=ZmApptList.toVector(h,b,f,e)\n}}return d\n};\nZmApptCache.prototype._cacheVector=function(d,b,f,e,c,i){var g=this._cachedApptVectors[c];\nif(g==null){g=this._cachedApptVectors[c]={}\n}var a=i?(\":\"+i):\"\";\nvar h=b+\":\"+f+\":\"+e+a;\ng[h]=d\n};\nZmApptCache.prototype._cacheApptSummaries=function(c,h,b,a,f){var d=this._cachedApptSummaries[a];\nif(d==null){d=this._cachedApptSummaries[a]={}\n}var e=f?(\":\"+f):\"\";\nvar g=h+\":\"+b+e;\nd[g]={start:h,end:b,list:c}\n};\nZmApptCache.prototype._getCachedApptSummaries=function(b,d,c,h){var k=false;\nvar e=this._cachedApptSummaries[c];\nif(e==null){e=this._cachedApptSummaries[c]={}\n}var a=h?(\":\"+h):\"\";\nvar g=b+\":\"+d+a;\nvar i=this._cachedApptSummaries[g];\nif(i!=null){return i.list\n}for(var j in e){i=e[j];\nif(b>=i.start&&d<=i.end){k=true;\nbreak\n}}if(!k){return null\n}if(i.start==b&&i.end==d){return i.list\n}var f=i.list.getSubset(b,d);\ne[g]={start:b,end:d,list:f};\nreturn f\n};\nZmApptCache.prototype._updateCachedIds=function(a){var e=a.getVector();\nvar c=e.size();\nfor(var b=0;\nb<c;\nb++){var d=e.get(b);\nthis._cachedIds[d.id]=1\n}};\nZmApptCache.prototype.getApptSummaries=function(b){var a=this.setSearchParams(b);\nif(a){if(b.callback){b.callback.run(a)\n}return a\n}this._rawAppts=[];\nif(b.callback){this._search(b)\n}else{return this._search(b)\n}};\nZmApptCache.prototype.setSearchParams=function(f){if(f.folderIds&&(!(f.folderIds instanceof Array))){f.folderIds=[f.folderIds]\n}else{if(!f.folderIds||(f.folderIds&&f.folderIds.length==0)){return(new AjxVector())\n}}f.mergeKey=this._getCachedMergedKey(f);\nvar c=this._cachedMergedApptVectors[f.mergeKey];\nif(c!=null){return c.clone()\n}f.needToFetch=[];\nf.resultList=[];\nfor(var a=0;\na<f.folderIds.length;\na++){var e=f.folderIds[a];\nvar d=appCtxt.isOffline&&appCtxt.getById(e);\nif(d&&d.isRemote()&&d.getAccount().status==ZmZimbraAccount.STATUS_OFFLINE){continue\n}c=this._getCachedVector(f.start,f.end,f.fanoutAllDay,e);\nif(c!=null){f.resultList.push(c)\n}else{f.needToFetch.push(e)\n}}if(f.needToFetch.length==0){var b=ZmApptList.mergeVectors(f.resultList);\nthis._cachedMergedApptVectors[f.mergeKey]=b.clone();\nreturn b\n}this.setFolderSearchParams(f.needToFetch,f);\nf.offset=0;\nreturn null\n};\nZmApptCache.prototype.setFolderSearchParams=function(b,h){var e={};\nvar f=\"\";\nfor(var a=0;\na<b.length;\na++){var g=b[a];\nvar d=appCtxt.getById(g);\nvar c=d?d.getRemoteId():g;\ne[c]=g;\nif(f.length){f+=\" OR \"\n}f+=\"inid:\"+['\"',g,'\"'].join(\"\")\n}h.queryHint=f;\nh.folderIdMapper=e\n};\nZmApptCache.prototype._search=function(e){var f={SearchRequest:{_jsns:\"urn:zimbraMail\"}};\nvar d=f.SearchRequest;\nthis._setSoapParams(d,e);\nvar c=e.accountName||(appCtxt.multiAccounts?appCtxt.accountList.mainAccount.name:null);\nif(e.callback){appCtxt.getAppController().sendRequest({jsonObj:f,asyncMode:true,callback:(new AjxCallback(this,this._getApptSummariesResponse,[e])),errorCallback:(new AjxCallback(this,this._getApptSummariesError,[e])),offlineCallback:this.offlineSearchAppts.bind(this,null,null,e),noBusyOverlay:e.noBusyOverlay,accountName:c})\n}else{var b=appCtxt.getAppController().sendRequest({jsonObj:f,accountName:c,ignoreErrs:[\"mail.NO_SUCH_MOUNTPOINT\"]});\nvar a=new ZmCsfeResult(b,false);\nreturn this._getApptSummariesResponse(e,a)\n}};\nZmApptCache.prototype._initAccountLists=function(){if(!this._accountsSearchList){this._accountsSearchList=new AjxVector();\nthis._accountsMiniCalList=[]\n}};\nZmApptCache.prototype.batchRequest=function(b,c,a){this._accountsSearchList=new AjxVector();\nthis._accountsMiniCalList=[];\nthis._doBatchRequest(b,c,a)\n};\nZmApptCache.prototype._doBatchRequest=function(k,b,h){this._cachedVec=null;\nvar i=k.accountFolderIds.shift();\nif(k){k.folderIds=i\n}if(b){b.folderIds=i\n}var c;\nvar n={BatchRequest:{_jsns:\"urn:zimbra\",onerror:\"continue\"}};\nvar g=n.BatchRequest;\nif(k){if(!k.folderIds&&!appCtxt.multiAccounts){k.folderIds=this._calViewController.getCheckedCalendarFolderIds()\n}k.query=this._calViewController._userQuery;\nc=this.setSearchParams(k);\nif(c){this._cachedVec=c;\nthis._accountsSearchList.addList(c)\n}else{var a=g.SearchRequest={_jsns:\"urn:zimbraMail\"};\nthis._setSoapParams(a,k)\n}}if(h){if(!h.folderIds){h.folderIds=this._calViewController.getCheckedCalendarFolderIds(true)\n}c=this.setSearchParams(h);\nif(!c){var a={_jsns:\"urn:zimbraMail\"};\ng.SearchRequest=g.SearchRequest?[g.SearchRequest,a]:a;\nthis._setSoapParams(a,h)\n}else{if(h.callback){h.callback.run(c)\n}}}if(b){var d=this._calViewController.getMiniCalCache();\nvar m=d.getCacheData(b);\nif(m&&m.length>0){d.highlightMiniCal(m);\nif(b.callback){b.callback.run(m)\n}}else{var o=g.GetMiniCalRequest={_jsns:\"urn:zimbraMail\"};\nd._setSoapParams(o,b)\n}}if(k&&!g.SearchRequest&&!g.GetMiniCalRequest){if(k.accountFolderIds.length>0){this._doBatchRequest(k,b)\n}else{if(k.callback){k.callback.run(this._accountsSearchList)\n}}return\n}if((k&&k.callback)||b.callback){if(k&&g.SearchRequest){this._accountsSearchList=new AjxVector()\n}var j=(appCtxt.multiAccounts&&k.folderIds&&(k.folderIds.length>0))?appCtxt.getById(k.folderIds[0]).getAccount().name:null;\nvar f={jsonObj:n,asyncMode:true,callback:(new AjxCallback(this,this.handleBatchResponse,[k,b,h])),errorCallback:(new AjxCallback(this,this.handleBatchResponseError,[k,b,h])),offlineCallback:this.offlineSearchAppts.bind(this,k,b,h),noBusyOverlay:true,accountName:j};\nappCtxt.getAppController().sendRequest(f)\n}else{var e=appCtxt.getAppController().sendRequest({jsonObj:n});\nvar l=(e&&e.BatchResponse)?e.BatchResponse:null;\nreturn this.processBatchResponse(l,k,b)\n}};\nZmApptCache.prototype.processBatchResponse=function(j,i,a,f){if(!this._accountsSearchList){this._initAccountLists()\n}var c=this._accountsSearchList.clone();\nvar b=this._calViewController.getMiniCalCache();\nvar h=j&&j.GetMiniCalResponse;\nvar d=j&&j.SearchResponse;\nif(j&&j.Fault){if(this._processErrorCode(j)){if(i.accountFolderIds.length>0){this._doBatchRequest(i,a)\n}return\n}}if(h){var e=[];\nb.processBatchResponse(h,e);\nif(!appCtxt.multiAccounts){b.highlightMiniCal(e);\nb.updateCache(a,e);\nif(a.callback){a.callback.run(e)\n}}else{this._accountsMiniCalList=this._accountsMiniCalList.concat(e)\n}}if(!d||!i){if(i){if(i.accountFolderIds&&i.accountFolderIds.length>0){this._doBatchRequest(i,a)\n}else{if(i.callback){i.callback.run(c)\n}}}if(appCtxt.multiAccounts&&a){this._highliteMiniCal(b,a)\n}return\n}if(!(d instanceof Array)){d=[d]\n}if(d.length>1){this.processSearchResponse(d[1],f)\n}var g=this.processSearchResponse(d[0],i);\nc.addList(g);\nthis._accountsSearchList=c.clone();\nif(i.accountFolderIds&&i.accountFolderIds.length>0){this._doBatchRequest(i,a)\n}else{if(appCtxt.multiAccounts&&a){this._highliteMiniCal(b,a)\n}if(i.callback){i.callback.run(c,null,i.query)\n}else{return c\n}}};\nZmApptCache.prototype._highliteMiniCal=function(a,b){a.highlightMiniCal(this._accountsMiniCalList);\na.updateCache(b,this._accountsMiniCalList);\nif(b.callback){b.callback.run(this._accountsMiniCalList)\n}};\nZmApptCache.prototype.handleBatchResponseError=function(d,e,b,a){var c=a&&a._data&&a._data.BatchResponse;\nthis._calViewController.resetSearchFlags();\nthis._processErrorCode(c)\n};\nZmApptCache.prototype._processErrorCode=function(f){if(f&&f.Fault&&(f.Fault.length>0)){if(this._calViewController){this._calViewController.searchInProgress=false\n}var p=[];\nvar a={};\nvar k={};\nfor(var h=0;\nh<f.Fault.length;\nh++){var m=f.Fault[h];\nvar n=(m&&m.Detail)?m.Detail.Error:null;\nvar d=n?n.Code:null;\nvar q=n?n.a:null;\nif(d==ZmCsfeException.ACCT_NO_SUCH_ACCOUNT||d==ZmCsfeException.MAIL_NO_SUCH_MOUNTPOINT){for(var g in q){var l=q[g];\nif(l&&(l.t==\"IID\")&&(l.n==\"itemId\")){var c=l._content;\na[c]=true;\nif(d==ZmCsfeException.ACCT_NO_SUCH_ACCOUNT){k[c]=true\n}}}}else{p[m.requestId]=m\n}}var e=false;\nvar o={};\nfor(var c in a){if(c&&appCtxt.getById(c)){var b=appCtxt.getById(c);\nb.noSuchFolder=true;\nthis.handleDeleteMountpoint(b);\ne=true;\nif(k[c]&&b.zid){o[b.zid]=true\n}}}this.markAllInvalidAccounts(o);\nif(e){this.runErrorRecovery()\n}return e\n}return false\n};\nZmApptCache.prototype.markAllInvalidAccounts=function(b){if(this._calViewController){var d=this._calViewController.getCheckedCalendarFolderIds();\nfor(var a=0;\na<d.length;\na++){var c=appCtxt.getById(d[a]);\nif(c){if(c.zid&&b[c.zid]){c.noSuchFolder=true;\nthis.handleDeleteMountpoint(c)\n}}}this._calViewController._updateCheckedCalendars()\n}};\nZmApptCache.prototype.handleDeleteMountpoint=function(b){var a=appCtxt.getOverviewController().getTreeController(ZmOrganizer.CALENDAR);\nvar c=a.getTreeView(appCtxt.getCurrentApp().getOverviewId());\nvar d=c&&c.getTreeItemById(b.id);\nif(b&&d){d.setText(b.getName(true))\n}};\nZmApptCache.prototype.runErrorRecovery=function(){if(this._calViewController){this._calViewController.searchInProgress=false;\nthis._calViewController._updateCheckedCalendars();\nif(this._calViewController.onErrorRecovery){this._calViewController.onErrorRecovery.run()\n}}};\nZmApptCache.prototype.handleBatchResponse=function(d,e,b,a){var c=a&&a._data&&a._data.BatchResponse;\nreturn this.processBatchResponse(c,d,e,b)\n};\nZmApptCache.prototype._setSoapParams=function(b,f){b.sortBy=\"none\";\nb.limit=\"500\";\nb.locale={_content:AjxEnv.DEFAULT_LOCALE};\nb.calExpandInstStart=f.start;\nb.calExpandInstEnd=f.end;\nb.types=ZmSearch.TYPE[ZmItem.APPT];\nb.offset=f.offset;\nvar c=f.query;\nif((c&&c.indexOf(\"date:\")!=-1)){var e=c.split(\":\");\nc=null;\nvar a=new Date(parseInt(e[1]));\na.setHours(0,0,0,0);\nvar d=new Date(a.getTime());\nAjxDateUtil.rollToNextDay(d);\nb.calExpandInstStart=a.getTime();\nb.calExpandInstEnd=d.getTime()\n}if(f.queryHint){c=(c!=null)?(c+\" (\"+f.queryHint+\")\"):f.queryHint\n}b.query={_content:c}\n};\nZmApptCache.prototype._getApptSummariesResponse=function(e,a){if(!a){return\n}var f=e.callback;\nvar d;\ntry{d=a.getResponse()\n}catch(b){if(f){f.run(a)\n}return\n}var c=this.processSearchResponse(d.SearchResponse,e);\nif(f&&c){f.run(c,e.query,a)\n}else{return c\n}};\nZmApptCache.prototype._getApptSummariesError=function(l,r){var f=r?r.code:null;\nif(l.errorCallback){l.errorCallback.run(r);\nif(f!==ZmCsfeException.ACCT_NO_SUCH_ACCOUNT&&f!==ZmCsfeException.MAIL_NO_SUCH_MOUNTPOINT){return true\n}}else{if(f==ZmCsfeException.MAIL_QUERY_PARSE_ERROR){var q=appCtxt.getMsgDialog();\nq.setMessage(ZmMsg.errorCalendarParse);\nq.popup();\nreturn true\n}if(f==ZmCsfeException.MAIL_NO_SUCH_TAG){var h=r.getErrorMsg();\nappCtxt.setStatusMsg(h,ZmStatusView.LEVEL_WARNING);\nreturn true\n}}var b={};\nvar o={};\nvar k=(r.data&&r.data.itemId&&r.data.itemId.length)?r.data.itemId:[];\nif(f==ZmCsfeException.ACCT_NO_SUCH_ACCOUNT||f==ZmCsfeException.MAIL_NO_SUCH_MOUNTPOINT){for(var m=0;\nm<k.length;\nm++){var e=k[m];\nb[e]=true;\nif(f==ZmCsfeException.ACCT_NO_SUCH_ACCOUNT){o[e]=true\n}}}var g=this.handleDeletedFolderIds(b,o);\nif(g){var a=[];\nfor(var n=0;\nn<l.folderIds.length;\nn++){var c=l.folderIds[n];\nvar p=(c&&b[c]);\nif(!p){a.push(c)\n}}if(l.folderIds.length!=a.length){l.folderIds=a;\nif(l.folderIds.length==0){l.callback.run(new AjxVector(),\"\");\nreturn true\n}this.getApptSummaries(l)\n}}return g\n};\nZmApptCache.prototype.handleDeletedFolderIds=function(d,b){var a=false;\nvar c={};\nfor(var f in d){if(f&&appCtxt.getById(f)){var e=appCtxt.getById(f);\ne.noSuchFolder=true;\nthis.handleDeleteMountpoint(e);\na=true;\nif(b[f]&&e.zid){c[e.zid]=true\n}}}this.markAllInvalidAccounts(c);\nreturn a\n};\nZmApptCache.prototype.processSearchResponse=function(j,h){if(!j){if(this._cachedVec){var g=this._cachedVec.clone();\nthis._cachedVec=null;\nreturn g\n}return\n}if(j&&j.appt&&j.appt.length){this._rawAppts=this._rawAppts!=null?this._rawAppts.concat(j.appt):j.appt;\nif(j.more){var o=j.appt[j.appt.length-1];\nif(o){h.offset+=500;\nthis._search(h);\nreturn\n}}}if(this._rawAppts&&this._rawAppts.length){var f=h.fanoutAllDay;\nvar a=h.needToFetch;\nvar c=h.start;\nvar k=h.end;\nvar n=h.query;\nvar e=this.createFolder2ListMap(this._rawAppts,\"l\",h.folderIdMapper);\nif(a&&a.length){for(var l=0;\nl<a.length;\nl++){var b=a[l];\nvar m=new ZmApptList();\nm.loadFromSummaryJs(e[b]);\nlist=this.createCaches(m,h,b);\nh.resultList.push(list)\n}}}var d=ZmApptList.mergeVectors(h.resultList);\nthis._cachedMergedApptVectors[h.mergeKey]=d.clone();\nthis._rawAppts=null;\nreturn d\n};\nZmApptCache.prototype.createFolder2ListMap=function(a,c,f){var d={};\nvar e;\nfor(var b=0;\nb<a.length;\nb++){e=a[b];\nvar g=f&&f[e[c]];\nif(!d[g]){d[g]=[]\n}d[g].push(e)\n}return d\n};\nZmApptCache.prototype.createCaches=function(b,d,a){this._updateCachedIds(b);\nthis._cacheApptSummaries(b,d.start,d.end,a,d.query);\nvar c=ZmApptList.toVector(b,d.start,d.end,d.fanoutAllDay,d.includeReminders);\nthis._cacheVector(c,d.start,d.end,d.fanoutAllDay,a,d.query);\nreturn c\n};\nZmApptCache.prototype.containsAnyId=function(b){if(!b){return false\n}if(b instanceof Array){for(var a=0;\na<b.length;\na++){if(this._cachedIds[b[a]]){return true\n}}}else{if(this._cachedIds[b]){return true\n}}return false\n};\nZmApptCache.prototype.containsAnyItem=function(a){if(!a){return false\n}if(a instanceof Array){for(var b=0;\nb<a.length;\nb++){if(a[b].id&&this._cachedIds[a[b].id]){return true\n}}}else{if(a.id&&this._cachedIds[a.id]){return true\n}}return false\n};\nZmApptCache.prototype.offlineSearchAppts=function(e,f,a){var d=null;\nif(e){d=e\n}else{d=a\n}if(!d||!d.start||!d.end){if(d&&d.errorCallback){d.errorCallback.run()\n}return\n}var c=[d.start,d.end];\nvar b=this._offlineSearchAppts2.bind(this,e,f,a,d.errorCallback,c);\nZmOfflineDB.doIndexSearch(c,ZmApp.CALENDAR,null,b,d.errorCallback,\"startDate\")\n};\nZmApptCache.prototype._offlineSearchAppts2=function(j,a,f,d,k,b){var e;\nvar h={};\nfor(var c=0;\nc<b.length;\nc++){e=b[c];\nh[e.instanceId]=e.appt\n}var g=this._offlineSearchAppts3.bind(this,j,a,f,h);\nZmOfflineDB.doIndexSearch(k,ZmApp.CALENDAR,null,g,d,\"endDate\")\n};\nZmApptCache.prototype._offlineSearchAppts3=function(n,c,l,m,d){var k;\nvar b;\nvar h;\nfor(var g=0;\ng<d.length;\ng++){k=d[g];\nm[k.instanceId]=k.appt\n}var f=[];\nvar a;\nfor(var j in m){a=m[j];\nf.push(a)\n}var e=this._cachedVec;\nthis._cachedVec=null;\nif(l){b=this._cacheOfflineSearch(l,f);\nif(!n){if(l.callback&&b){l.callback.run(b,l.query,null)\n}else{return b\n}}}if(n){if(e){h=e.clone()\n}else{h=this._cacheOfflineSearch(n,f)\n}if(n.callback){n.callback.run(h,null,n.query)\n}else{}}if(c&&h){this.processOfflineMiniCal(c,h)\n}};\nZmApptCache.prototype.processOfflineMiniCal=function(h,b){var g={};\nvar f=[];\nvar c;\nvar e;\nfor(var d=0;\nd<b.size();\nd++){e=b.get(d);\nc=this._formatMiniCalEntry(e.startDate);\ng[c]=true\n}for(c in g){f.push(c)\n}var a=this._calViewController.getMiniCalCache();\na.highlightMiniCal(f);\na.updateCache(h,f);\nif(h.callback){h.callback.run(f)\n}};\nZmApptCache.prototype._formatMiniCalEntry=function(a){return a.getFullYear().toString()+AjxDateUtil._getMonth(a,true).toString()+AjxDateUtil._getDate(a,true).toString()\n};\nZmApptCache.prototype._cacheOfflineSearch=function(g,h){var f=g.resultList||[];\nvar m;\nvar a;\nvar o;\nvar n;\nvar c;\nvar e=this.createFolder2ListMap(h,\"folderId\",g.folderIdMapper);\nvar b=g.needToFetch;\nif(b&&b.length){for(var l=0;\nl<b.length;\nl++){c=b[l];\no=e[c];\nif(o){m=new ZmApptList();\nfor(var k=0;\nk<o.length;\nk++){a=ZmAppt.loadOfflineData(o[k],m);\nm.add(a)\n}n=this.createCaches(m,g,c);\nf.push(n)\n}}}var d=ZmApptList.mergeVectors(f);\nthis._cachedMergedApptVectors[g.mergeKey]=d.clone();\nreturn d\n};\nZmApptCache.prototype.updateOfflineAppt=function(h,e,d,a,g){var c=[h];\nvar b=this.updateErrorCallback.bind(this,e,d);\nvar f=this._updateOfflineAppt2.bind(this,e,d,a,b,g);\nZmOfflineDB.doIndexSearch([h],ZmApp.CALENDAR,null,f,b,\"invId\")\n};\nZmApptCache.prototype.updateErrorCallback=function(c,a,b){};\nZmApptCache.prototype._updateOfflineAppt2=function(n,m,d,h,o,c){if(c.length>0){var a;\nvar p=n.split(\".\");\nvar k=p[0];\nvar b=p[p.length-1];\nvar l;\nfor(var f=0;\nf<c.length;\nf++){a=c[f].appt;\nl=a;\nif(!a[k]){a[k]=d\n}else{for(var e=0;\ne<p.length-1;\ne++){l=l[p[e]];\nif(!l){break\n}}l[b]=m\n}}var h=this.updateErrorCallback.bind(this,l,m);\nvar g=this._updateOfflineAppt3.bind(this,l,m,o);\nZmOfflineDB.setItem(c,ZmApp.CALENDAR,g,h)\n}};\nZmApptCache.prototype._updateOfflineAppt3=function(b,a,c){this.clearCache();\nthis._calViewController.refreshCurrentView();\nif(c){c.run(b,a)\n}}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmFreeBusyCache\")){ZmFreeBusyCache=function(a){this._controller=a;\nthis.clearCache()\n};\nZmFreeBusyCache.STATUS_UNKNOWN=\"n\";\nZmFreeBusyCache.STATUS_TENTATIVE=\"t\";\nZmFreeBusyCache.STATUS_BUSY=\"b\";\nZmFreeBusyCache.STATUS_OUT=\"u\";\nZmFreeBusyCache.STATUS_FREE=\"f\";\nZmFreeBusyCache.STATUS_WORKING_HOURS=\"f\";\nZmFreeBusyCache.STATUS_NON_WORKING_HOURS=\"u\";\nZmFreeBusyCache.STATUS_UNKNOWN=\"n\";\nZmFreeBusyCache.prototype.toString=function(){return\"ZmFreeBusyCache\"\n};\nZmFreeBusyCache.prototype.clearCache=function(){this._schedule={};\nthis._workingHrs={}\n};\nZmFreeBusyCache.prototype.getFreeBusyKey=function(a,b){return a+\"-\"+b\n};\nZmFreeBusyCache.prototype.getWorkingHoursKey=function(b,a){return b+\"-\"+a\n};\nZmFreeBusyCache.prototype.getFreeBusySlot=function(c,g,b,l){var h=new Date(c);\nh.setHours(0,0,0,0);\nvar k=this._schedule[b]||[];\nvar a={id:b};\nvar f,j,d;\nfor(var e=k.length;\n--e>=0;\n){f=k[e];\nj=f.searchRange;\nif(j){d=(c>=j.startTime&&g<=j.endTime);\nif(!d){continue\n}}if(f.n){this._addFBInfo(f.n,b,ZmFreeBusyCache.STATUS_UNKNOWN,c,g,a,l)\n}if(f.t){this._addFBInfo(f.t,b,ZmFreeBusyCache.STATUS_TENTATIVE,c,g,a,l)\n}if(f.b){this._addFBInfo(f.b,b,ZmFreeBusyCache.STATUS_BUSY,c,g,a,l)\n}if(f.u){this._addFBInfo(f.u,b,ZmFreeBusyCache.STATUS_OUT,c,g,a,l)\n}if(f.f){this._addFBInfo(f.f,b,ZmFreeBusyCache.STATUS_FREE,c,g,a,l)\n}}return a\n};\nZmFreeBusyCache.prototype._addFBInfo=function(g,b,d,c,f,a,h){if(!a[d]){a[d]=[]\n}for(var e=0;\ne<g.length;\ne++){var j;\nif(g[e].s>=c&&g[e].e<=f){j={s:g[e].s,e:g[e].e}\n}else{if(c>=g[e].s&&f<=g[e].e){j={s:c,e:f}\n}else{if(c>=g[e].s&&c<=g[e].e){j={s:c,e:g[e].e}\n}else{if(f>=g[e].s&&f<=g[e].e){j={s:g[e].s,e:f}\n}}}}if(j){if(h&&d!=ZmFreeBusyCache.STATUS_FREE&&d!=ZmFreeBusyCache.STATUS_UNKNOWN){this._addByExcludingTime(h,j,a,d)\n}else{a[d].push(j)\n}}}if(a[d].length==0){a[d]=null\n}};\nZmFreeBusyCache.prototype._addByExcludingTime=function(g,a,e,b){var d=g.s;\nvar c=g.e;\nvar f;\nif(a.s==d&&a.e==c){return\n}if(a.s<d&&a.e>c){e[b].push({s:a.s,e:d});\nf={s:c,e:a.e}\n}else{if(a.s<d&&a.e>=d){f={s:a.s,e:d}\n}else{if(a.s<=c&&a.e>c){f={s:c,e:a.e}\n}else{if(a.s<=d&&a.e<=d){f={s:a.s,e:a.e}\n}else{if(a.s>=c&&a.e>=c){f={s:a.s,e:a.e}\n}}}}}if(f){e[b].push(f)\n}};\nZmFreeBusyCache.prototype.getFreeBusyInfo=function(c){var d=[],j,g=c.emails,k;\nfor(var f=g.length;\n--f>=0;\n){j=c.startTime+\"\";\nvar a=false;\nif(this._schedule[g[f]]){var h=this.getFreeBusySlot(c.startTime,c.endTime,g[f]);\nif(h.f||h.u||h.b||h.t||h.n){a=true\n}}if(!a){d.push(g[f])\n}}var b=new AjxCallback(this,this._handleResponseFreeBusy,[c]);\nvar e=new AjxCallback(this,this._handleErrorFreeBusy,[c]);\nif(d.length){return this._getFreeBusyInfo(c.startTime,c.endTime,d.join(\",\"),b,e,c.noBusyOverlay,c.account,c.excludedId)\n}else{if(c.callback){c.callback.run()\n}return null\n}};\nZmFreeBusyCache.prototype._handleResponseFreeBusy=function(d,a){var g;\nvar b=a.getResponse().GetFreeBusyResponse.usr||[];\nfor(var c=0;\nc<b.length;\nc++){var f=b[c];\nvar e=f.id;\nif(!e){continue\n}if(!this._schedule[e]){this._schedule[e]=[]\n}f.searchRange={startTime:d.startTime,endTime:d.endTime};\nthis._schedule[e].push(f)\n}if(d.callback){d.callback.run(a)\n}};\nZmFreeBusyCache.prototype._handleErrorFreeBusy=function(b,a){if(b.errorCallback){b.errorCallback.run(a)\n}};\nZmFreeBusyCache.prototype._getFreeBusyInfo=function(b,e,c,i,d,h,f,a){var g=AjxSoapDoc.create(\"GetFreeBusyRequest\",\"urn:zimbraMail\");\ng.setMethodAttribute(\"s\",b);\ng.setMethodAttribute(\"e\",e);\ng.setMethodAttribute(\"uid\",c);\nif(a){g.setMethodAttribute(\"excludeUid\",a)\n}return appCtxt.getAppController().sendRequest({soapDoc:g,asyncMode:true,callback:i,errorCallback:d,noBusyOverlay:h,accountName:(f?f.name:null)})\n};\nZmFreeBusyCache.prototype.getWorkingHours=function(f){var b=[],d,g=f.emails||[];\nfor(var c=g.length;\n--c>=0;\n){d=this.getWorkingHoursKey(g[c],(new Date(f.startTime)).getDay());\nif(!this._workingHrs[d]){b.push(g[c])\n}}var e=new AjxCallback(this,this._handleResponseWorkingHrs,[f]);\nvar a=new AjxCallback(this,this._handleErrorWorkingHrs,[f]);\nif(b.length){return this._getWorkingHours(f.startTime,f.endTime,b.join(\",\"),e,a,f.noBusyOverlay,f.account)\n}else{if(f.callback){f.callback.run()\n}return null\n}};\nZmFreeBusyCache.prototype._handleResponseWorkingHrs=function(d,a){var g;\nvar b=a.getResponse().GetWorkingHoursResponse.usr||[];\nfor(var c=0;\nc<b.length;\nc++){var f=b[c];\nvar e=f.id;\nif(!e){continue\n}this._addWorkingHrInfo(d.startTime,d.endTime,f)\n}if(d.callback){d.callback.run(a)\n}};\nZmFreeBusyCache.prototype._addWorkingHrInfo=function(b,a,d){var c=d.id;\nif(d.f){this._addWorkingHrSlot(d.f,c,ZmFreeBusyCache.STATUS_WORKING_HOURS)\n}if(d.u){this._addWorkingHrSlot(d.u,c,ZmFreeBusyCache.STATUS_NON_WORKING_HOURS)\n}if(d.n){this._addWorkingHrSlot(d.n,c,ZmFreeBusyCache.STATUS_UNKNOWN)\n}};\nZmFreeBusyCache.prototype._addWorkingHrSlot=function(e,h,a){var g,b,f,c;\nfor(var d=0;\nd<e.length;\nd++){g=e[d].s;\nb=new Date(g);\nf=this.getWorkingHoursKey(h,b.getDay());\nc=this._workingHrs[f];\nif(!c){this._workingHrs[f]=c={id:h}\n}if(!c[a]){c[a]=[]\n}c[a].push(e[d]);\nif(a==ZmFreeBusyCache.STATUS_UNKNOWN){this._workingHrs[h]=c\n}}};\nZmFreeBusyCache.prototype._handleErrorWorkingHrs=function(b,a){if(b.errorCallback){b.errorCallback.run(a)\n}};\nZmFreeBusyCache.prototype._getWorkingHours=function(e,b,f,h,a,c,g){var d=AjxSoapDoc.create(\"GetWorkingHoursRequest\",\"urn:zimbraMail\");\nd.setMethodAttribute(\"s\",e);\nd.setMethodAttribute(\"e\",b);\nd.setMethodAttribute(\"name\",f);\nreturn appCtxt.getAppController().sendRequest({soapDoc:d,asyncMode:true,callback:h,errorCallback:a,noBusyOverlay:c,accountName:(g?g.name:null)})\n};\nZmFreeBusyCache.prototype.getWorkingHrsSlot=function(e,b,g){var f=this.getWorkingHoursKey(g,(new Date(e)).getDay());\nvar c=this._workingHrs[f]||{};\nvar d={id:g};\nvar a=this._workingHrs[g];\nif(a){return a\n}if(c[ZmFreeBusyCache.STATUS_WORKING_HOURS]){d[ZmFreeBusyCache.STATUS_WORKING_HOURS]=c[ZmFreeBusyCache.STATUS_WORKING_HOURS]\n}if(c[ZmFreeBusyCache.STATUS_NON_WORKING_HOURS]){d[ZmFreeBusyCache.STATUS_NON_WORKING_HOURS]=c[ZmFreeBusyCache.STATUS_NON_WORKING_HOURS]\n}if(c[ZmFreeBusyCache.STATUS_UNKNOWN]){d[ZmFreeBusyCache.STATUS_UNKNOWN]=c[ZmFreeBusyCache.STATUS_UNKNOWN]\n}if(!d[ZmFreeBusyCache.STATUS_WORKING_HOURS]&&!d[ZmFreeBusyCache.STATUS_NON_WORKING_HOURS]&&!d[ZmFreeBusyCache.STATUS_UNKNOWN]){return null\n}return d\n};\nZmFreeBusyCache.prototype._addWHInfo=function(f,g,a,e,b,d){if(!d[a]){d[a]=[]\n}for(var c=0;\nc<f.length;\nc++){if(e>=f[c].s&&b<=f[c].e){d[a].push({s:e,e:b})\n}else{if(f[c].s>=e&&f[c].e<=b){d[a].push({s:f[c].s,e:f[c].e})\n}else{if(f[c].s>=e&&f[c].s<=b){d[a].push({s:f[c].s,e:b})\n}else{if(f[c].e>=e&&f[c].e<=b){d[a].push({s:e,e:f[c].e})\n}}}}}if(d[a].length==0){d[a]=null\n}};\nZmFreeBusyCache.prototype.convertWorkingHours=function(e,c){c=c||new Date();\nvar d=new Date(e.s);\nvar a=new Date(e.e);\nvar b=e.e-e.s;\ne.s=(new Date(c.getTime())).setHours(d.getHours(),d.getMinutes(),0,0);\ne.e=e.s+b\n}\n}if(AjxPackage.define(\"zimbraMail.abook.model.ZmContact\")){if(!window.ZmContact){ZmContact=function(d,c,a,b){if(arguments.length==0){return\n}a=a||ZmItem.CONTACT;\nZmItem.call(this,a,d,c);\nthis.attr={};\nthis.isGal=(this.list&&this.list.isGal)||b;\nif(b){this.folderId=ZmFolder.ID_DLS;\nthis.dlInfo={isMember:false,isOwner:true,subscriptionPolicy:null,unsubscriptionPolicy:null,description:\"\",displayName:\"\",notes:\"\",hideInGal:false,mailPolicy:null,owners:[appCtxt.get(ZmSetting.USERNAME)]}\n}this.participants=new AjxVector()\n};\nZmContact.prototype=new ZmItem;\nZmContact.prototype.constructor=ZmContact;\nZmContact.prototype.isZmContact=true;\nZmContact.F_anniversary=\"anniversary\";\nZmContact.F_assistantPhone=\"assistantPhone\";\nZmContact.F_attachment=\"attachment\";\nZmContact.F_birthday=\"birthday\";\nZmContact.F_callbackPhone=\"callbackPhone\";\nZmContact.F_carPhone=\"carPhone\";\nZmContact.F_company=\"company\";\nZmContact.F_companyPhone=\"companyPhone\";\nZmContact.F_custom=\"custom\";\nZmContact.F_description=\"description\";\nZmContact.F_department=\"department\";\nZmContact.F_dlist=\"dlist\";\nZmContact.F_dlDisplayName=\"dldisplayname\";\nZmContact.F_dlDesc=\"dldesc\";\nZmContact.F_dlHideInGal=\"dlhideingal\";\nZmContact.F_dlNotes=\"dlnotes\";\nZmContact.F_dlSubscriptionPolicy=\"dlsubspolicy\";\nZmContact.F_dlMailPolicy=\"dlmailpolicy\";\nZmContact.F_dlMailPolicySpecificMailers=\"dlmailpolicyspecificmailers\";\nZmContact.F_dlUnsubscriptionPolicy=\"dlunsubspolicy\";\nZmContact.F_dlListOwners=\"dllistowners\";\nZmContact.F_email=\"email\";\nZmContact.F_email2=\"email2\";\nZmContact.F_email3=\"email3\";\nZmContact.F_email4=\"email4\";\nZmContact.F_email5=\"email5\";\nZmContact.F_email6=\"email6\";\nZmContact.F_email7=\"email7\";\nZmContact.F_email8=\"email8\";\nZmContact.F_email9=\"email9\";\nZmContact.F_email10=\"email10\";\nZmContact.F_email11=\"email11\";\nZmContact.F_email12=\"email12\";\nZmContact.F_email13=\"email13\";\nZmContact.F_email14=\"email14\";\nZmContact.F_email15=\"email15\";\nZmContact.F_email16=\"email16\";\nZmContact.F_fileAs=\"fileAs\";\nZmContact.F_firstName=\"firstName\";\nZmContact.F_folderId=\"folderId\";\nZmContact.F_groups=\"groups\";\nZmContact.F_homeCity=\"homeCity\";\nZmContact.F_homeCountry=\"homeCountry\";\nZmContact.F_homeFax=\"homeFax\";\nZmContact.F_homePhone=\"homePhone\";\nZmContact.F_homePhone2=\"homePhone2\";\nZmContact.F_homePostalCode=\"homePostalCode\";\nZmContact.F_homeState=\"homeState\";\nZmContact.F_homeStreet=\"homeStreet\";\nZmContact.F_homeURL=\"homeURL\";\nZmContact.F_image=\"image\";\nZmContact.F_imAddress=\"imAddress\";\nZmContact.F_imAddress1=\"imAddress1\";\nZmContact.F_imAddress2=\"imAddress2\";\nZmContact.F_imAddress3=\"imAddress3\";\nZmContact.F_jobTitle=\"jobTitle\";\nZmContact.F_lastName=\"lastName\";\nZmContact.F_maidenName=\"maidenName\";\nZmContact.F_memberC=\"memberC\";\nZmContact.F_memberG=\"memberG\";\nZmContact.F_memberI=\"memberI\";\nZmContact.F_middleName=\"middleName\";\nZmContact.F_mobilePhone=\"mobilePhone\";\nZmContact.F_namePrefix=\"namePrefix\";\nZmContact.F_nameSuffix=\"nameSuffix\";\nZmContact.F_nickname=\"nickname\";\nZmContact.F_notes=\"notes\";\nZmContact.F_otherCity=\"otherCity\";\nZmContact.F_otherCountry=\"otherCountry\";\nZmContact.F_otherFax=\"otherFax\";\nZmContact.F_otherPhone=\"otherPhone\";\nZmContact.F_otherPostalCode=\"otherPostalCode\";\nZmContact.F_otherState=\"otherState\";\nZmContact.F_otherStreet=\"otherStreet\";\nZmContact.F_otherURL=\"otherURL\";\nZmContact.F_pager=\"pager\";\nZmContact.F_phoneticFirstName=\"phoneticFirstName\";\nZmContact.F_phoneticLastName=\"phoneticLastName\";\nZmContact.F_phoneticCompany=\"phoneticCompany\";\nZmContact.F_type=\"type\";\nZmContact.F_workAltPhone=\"workAltPhone\";\nZmContact.F_workCity=\"workCity\";\nZmContact.F_workCountry=\"workCountry\";\nZmContact.F_workEmail1=\"workEmail1\";\nZmContact.F_workEmail2=\"workEmail2\";\nZmContact.F_workEmail3=\"workEmail3\";\nZmContact.F_workFax=\"workFax\";\nZmContact.F_workMobile=\"workMobile\";\nZmContact.F_workPhone=\"workPhone\";\nZmContact.F_workPhone2=\"workPhone2\";\nZmContact.F_workPostalCode=\"workPostalCode\";\nZmContact.F_workState=\"workState\";\nZmContact.F_workStreet=\"workStreet\";\nZmContact.F_workURL=\"workURL\";\nZmContact.F_imagepart=\"imagepart\";\nZmContact.F_zimletImage=\"zimletImage\";\nZmContact.X_fileAs=\"fileAs\";\nZmContact.X_firstLast=\"firstLast\";\nZmContact.X_fullName=\"fullName\";\nZmContact.X_vcardXProps=\"vcardXProps\";\nZmContact.X_outlookUserField=\"outlookUserField\";\nZmContact.MC_cardOwner=\"cardOwner\";\nZmContact.MC_workCardMessage=\"workCardMessage\";\nZmContact.MC_homeCardMessage=\"homeCardMessage\";\nZmContact.MC_homePhotoURL=\"homePhotoURL\";\nZmContact.MC_workPhotoURL=\"workPhotoURL\";\nZmContact.GAL_MODIFY_TIMESTAMP=\"modifyTimeStamp\";\nZmContact.GAL_CREATE_TIMESTAMP=\"createTimeStamp\";\nZmContact.GAL_ZIMBRA_ID=\"zimbraId\";\nZmContact.GAL_OBJECT_CLASS=\"objectClass\";\nZmContact.GAL_MAIL_FORWARD_ADDRESS=\"zimbraMailForwardingAddress\";\nZmContact.GAL_CAL_RES_TYPE=\"zimbraCalResType\";\nZmContact.GAL_CAL_RES_LOC_NAME=\"zimbraCalResLocationDisplayName\";\n(function(){var a=1;\nZmContact.FA_LAST_C_FIRST=a++;\nZmContact.FA_FIRST_LAST=a++;\nZmContact.FA_COMPANY=a++;\nZmContact.FA_LAST_C_FIRST_COMPANY=a++;\nZmContact.FA_FIRST_LAST_COMPANY=a++;\nZmContact.FA_COMPANY_LAST_C_FIRST=a++;\nZmContact.FA_COMPANY_FIRST_LAST=a++;\nZmContact.FA_CUSTOM=a++\n})();\nZmContact.ADDRESS_FIELDS=[ZmContact.F_homeCity,ZmContact.F_homeCountry,ZmContact.F_homePostalCode,ZmContact.F_homeState,ZmContact.F_homeStreet,ZmContact.F_workCity,ZmContact.F_workCountry,ZmContact.F_workPostalCode,ZmContact.F_workState,ZmContact.F_workStreet,ZmContact.F_otherCity,ZmContact.F_otherCountry,ZmContact.F_otherPostalCode,ZmContact.F_otherState,ZmContact.F_otherStreet];\nZmContact.EMAIL_FIELDS=[ZmContact.F_email,ZmContact.F_workEmail1,ZmContact.F_workEmail2,ZmContact.F_workEmail3];\nZmContact.IM_FIELDS=[ZmContact.F_imAddress];\nZmContact.OTHER_FIELDS=[ZmContact.F_birthday,ZmContact.F_anniversary,ZmContact.F_custom];\nZmContact.PHONE_FIELDS=[ZmContact.F_mobilePhone,ZmContact.F_workPhone,ZmContact.F_workFax,ZmContact.F_companyPhone,ZmContact.F_homePhone,ZmContact.F_homeFax,ZmContact.F_pager,ZmContact.F_callbackPhone,ZmContact.F_assistantPhone,ZmContact.F_carPhone,ZmContact.F_otherPhone,ZmContact.F_otherFax,ZmContact.F_workAltPhone,ZmContact.F_workMobile];\nZmContact.PRIMARY_FIELDS=[ZmContact.F_image,ZmContact.F_namePrefix,ZmContact.F_firstName,ZmContact.F_phoneticFirstName,ZmContact.F_middleName,ZmContact.F_maidenName,ZmContact.F_lastName,ZmContact.F_phoneticLastName,ZmContact.F_nameSuffix,ZmContact.F_nickname,ZmContact.F_jobTitle,ZmContact.F_department,ZmContact.F_company,ZmContact.F_phoneticCompany,ZmContact.F_fileAs,ZmContact.F_folderId,ZmContact.F_notes];\nZmContact.URL_FIELDS=[ZmContact.F_homeURL,ZmContact.F_workURL,ZmContact.F_otherURL];\nZmContact.GAL_FIELDS=[ZmContact.GAL_MODIFY_TIMESTAMP,ZmContact.GAL_CREATE_TIMESTAMP,ZmContact.GAL_ZIMBRA_ID,ZmContact.GAL_OBJECT_CLASS,ZmContact.GAL_MAIL_FORWARD_ADDRESS,ZmContact.GAL_CAL_RES_TYPE,ZmContact.GAL_CAL_RES_LOC_NAME,ZmContact.F_type];\nZmContact.MYCARD_FIELDS=[ZmContact.MC_cardOwner,ZmContact.MC_homeCardMessage,ZmContact.MC_homePhotoURL,ZmContact.MC_workCardMessage,ZmContact.MC_workPhotoURL];\nZmContact.X_FIELDS=[ZmContact.X_firstLast,ZmContact.X_fullName,ZmContact.X_vcardXProps];\nZmContact.IGNORE_NORMALIZATION=[];\nZmContact.ADDR_PREFIXES=[\"work\",\"home\",\"other\"];\nZmContact.ADDR_SUFFIXES=[\"Street\",\"City\",\"State\",\"PostalCode\",\"Country\"];\nZmContact.updateFieldConstants=function(){for(var b=0;\nb<ZmContact.ADDR_PREFIXES.length;\nb++){for(var a=0;\na<ZmContact.ADDR_SUFFIXES.length;\na++){ZmContact.IGNORE_NORMALIZATION.push(ZmContact.ADDR_PREFIXES[b]+ZmContact.ADDR_SUFFIXES[a])\n}}ZmContact.DISPLAY_FIELDS=[].concat(ZmContact.ADDRESS_FIELDS,ZmContact.EMAIL_FIELDS,ZmContact.IM_FIELDS,ZmContact.OTHER_FIELDS,ZmContact.PHONE_FIELDS,ZmContact.PRIMARY_FIELDS,ZmContact.URL_FIELDS);\nZmContact.IGNORE_FIELDS=[].concat(ZmContact.GAL_FIELDS,ZmContact.MYCARD_FIELDS,ZmContact.X_FIELDS,[ZmContact.F_imagepart]);\nZmContact.ALL_FIELDS=[].concat(ZmContact.DISPLAY_FIELDS,ZmContact.IGNORE_FIELDS);\nZmContact.IS_DATE={};\nZmContact.IS_DATE[ZmContact.F_birthday]=true;\nZmContact.IS_DATE[ZmContact.F_anniversary]=true;\nZmContact.IS_IGNORE=AjxUtil.arrayAsHash(ZmContact.IGNORE_FIELDS);\nZmContact.DL_PAGE_SIZE=100;\nZmContact.GROUP_CONTACT_REF=\"C\";\nZmContact.GROUP_GAL_REF=\"G\";\nZmContact.GROUP_INLINE_REF=\"I\"\n};\nZmContact.updateFieldConstants();\nZmContact.IS_ADDONE={};\nZmContact.IS_ADDONE[ZmContact.F_custom]=true;\nZmContact.IS_ADDONE[ZmContact.F_imAddress]=true;\nZmContact.IS_ADDONE[ZmContact.X_outlookUserField]=true;\nZmContact.getAttributeName=function(b,a){a=a||1;\nreturn a>1||ZmContact.IS_ADDONE[b]?b+a:b\n};\nZmContact.prototype.toString=function(){return\"ZmContact\"\n};\nZmContact.createFromDom=function(c,b){var a=appCtxt.cacheGet(c.id);\nif(a==null||(a&&a.rev!=c.rev)){a=new ZmContact(c.id,b.list);\nif(b.isGal){a.isGal=b.isGal\n}a._loadFromDom(c);\nappCtxt.getApp(ZmApp.CONTACTS).getContactList().add(a)\n}else{if(c.m){a.attr[ZmContact.F_groups]=c.m\n}if(c.ref){a.ref=c.ref\n}if(c.tn){a._parseTagNames(c.tn)\n}AjxUtil.hashUpdate(a.attr,c._attrs);\na.list=b.list||new ZmContactList(null);\na._list=a._list||{};\na._list[a.list.id]=true\n}if(c.certificate){a.certificate=c.certificate\n}return a\n};\nZmContact.compareByFileAs=function(e,c){var d=(e instanceof ZmContact)?e.getFileAs(true):ZmContact.computeFileAs(e._attrs).toLowerCase();\nvar f=(c instanceof ZmContact)?c.getFileAs(true):ZmContact.computeFileAs(c._attrs).toLowerCase();\nif(!f||(d>f)){return 1\n}if(d<f){return -1\n}return 0\n};\nZmContact.computeFileAs=function(c){var b=(c instanceof ZmContact)?c.getAttrs():c;\nif(!b){return\n}if(b[ZmContact.F_dlDisplayName]){return b[ZmContact.F_dlDisplayName]\n}var f=parseInt(b.fileAs);\nvar e;\nvar a=0;\nswitch(f){case ZmContact.FA_LAST_C_FIRST:default:if(c&&c.isGal){if(b.fullName){return(b.fullName instanceof Array)?b.fullName[0]:b.fullName\n}return((b.email instanceof Array)?b.email[0]:b.email)\n}e=ZmContact.fileAsLastFirst(b.firstName,b.lastName,b.fullName,b.nickname);\nbreak;\ncase ZmContact.FA_FIRST_LAST:e=ZmContact.fileAsFirstLast(b.firstName,b.lastName,b.fullName,b.nickname);\nbreak;\ncase ZmContact.FA_COMPANY:if(b.company){e=b.company\n}break;\ncase ZmContact.FA_LAST_C_FIRST_COMPANY:var d=ZmContact.fileAsLastFirst(b.firstName,b.lastName,b.fullName,b.nickname);\ne=ZmContact.fileAsNameCompany(d,b.company);\nbreak;\ncase ZmContact.FA_FIRST_LAST_COMPANY:var d=ZmContact.fileAsFirstLast(b.firstName,b.lastName,b.fullName,b.nickname);\ne=ZmContact.fileAsNameCompany(d,b.company);\nbreak;\ncase ZmContact.FA_COMPANY_LAST_C_FIRST:var d=ZmContact.fileAsLastFirst(b.firstName,b.lastName);\ne=ZmContact.fileAsCompanyName(d,b.company);\nbreak;\ncase ZmContact.FA_COMPANY_FIRST_LAST:var d=ZmContact.fileAsFirstLast(b.firstName,b.lastName);\ne=ZmContact.fileAsCompanyName(d,b.company);\nbreak;\ncase ZmContact.FA_CUSTOM:return b.fileAs.substring(2);\nbreak\n}return e||b.fullName||\"\"\n};\nZmContact.fileAsFirstLast=function(d,c,b,a){if(d&&c){return AjxMessageFormat.format(ZmMsg.fileAsFirstLast,[d,c])\n}return d||c||b||a||\"\"\n};\nZmContact.fileAsLastFirst=function(d,c,b,a){if(d&&c){return AjxMessageFormat.format(ZmMsg.fileAsLastFirst,[d,c])\n}return c||d||b||a||\"\"\n};\nZmContact.fileAsNameCompany=function(b,a){if(b&&a){return AjxMessageFormat.format(ZmMsg.fileAsNameCompany,[b,a])\n}if(a){return AjxMessageFormat.format(ZmMsg.fileAsCompanyAsSecondaryOnly,[a])\n}return b\n};\nZmContact.fileAsCompanyName=function(b,a){if(a&&b){return AjxMessageFormat.format(ZmMsg.fileAsCompanyName,[b,a])\n}if(b){return AjxMessageFormat.format(ZmMsg.fileAsNameAsSecondaryOnly,[b])\n}return a\n};\nZmContact.computeCustomFileAs=function(a){return[ZmContact.FA_CUSTOM,\":\",a].join(\"\")\n};\nZmContact.getAttr=function(b,a){return(b instanceof ZmContact)?b.getAttr(a):(b&&b._attrs)?b._attrs[a]:null\n};\nZmContact.getPrefix=function(a){var b=a.replace(/\\d+$/,\"\");\nif(b===\"\"){return a\n}return b\n};\nZmContact.getNormalizedAttrs=function(l,f,h){var g={};\nif(l){var j=AjxUtil.keys(l);\nj.sort(ZmContact.__BY_ATTRIBUTE);\nvar k={};\nfor(var d=0;\nd<j.length;\nd++){var b=j[d];\nvar c=ZmContact.getPrefix(b);\nif(f&&f!=c){continue\n}if(AjxUtil.isArray(h)&&AjxUtil.indexOf(h,c)!=-1){g[b]=l[b]\n}else{if(!k[c]){k[c]=0\n}var e=ZmContact.getAttributeName(c,++k[c]);\ng[e]=l[b]\n}}}return g\n};\nZmContact.__RE_ATTRIBUTE=/^(.*?)(\\d+)$/;\nZmContact.__BY_ATTRIBUTE=function(d,c){var e=d.match(ZmContact.__RE_ATTRIBUTE)||[d,d,1];\nvar f=c.match(ZmContact.__RE_ATTRIBUTE)||[c,c,1];\nreturn e[1]==f[1]?Number(e[2])-Number(f[2]):e[1].localeCompare(f[1])\n};\nZmContact.setAttr=function(b,a,c){if(b instanceof ZmContact){b.setAttr(a,c)\n}else{b._attrs[a]=c\n}};\nZmContact.isInTrash=function(a){var b=(a instanceof ZmContact)?a.folderId:a.l;\nvar c=appCtxt.getById(b);\nreturn(c&&c.isInTrash())\n};\nZmContact.prototype.load=function(g,b,a,d){var f={GetContactsRequest:{_jsns:\"urn:zimbraMail\"}};\nif(d){f.GetContactsRequest.derefGroupMember=\"1\"\n}f.GetContactsRequest.returnCertInfo=\"1\";\nvar c=f.GetContactsRequest;\nc.cn=[{id:this.id}];\nvar e=new AjxCallback(this,this._handleLoadResponse,[g]);\nif(a){var f={GetContactsRequest:{_jsns:\"urn:zimbraMail\"}};\nif(d){f.GetContactsRequest.derefGroupMember=\"1\"\n}f.GetContactsRequest.returnCertInfo=\"1\";\nf.GetContactsRequest.cn={id:this.id};\na.addRequestParams(f,e,b)\n}else{appCtxt.getAppController().sendRequest({jsonObj:f,asyncMode:true,callback:e,errorCallback:b})\n}};\nZmContact.prototype._handleLoadResponse=function(h,j){var a=j.getResponse().GetContactsResponse;\nvar d=a.cn[0];\nthis.attr=d._attrs;\nif(d.m){for(var c=0;\nc<d.m.length;\nc++){var b=d.m[c];\nvar g=false;\nif(b.type==ZmContact.GROUP_GAL_REF){g=true\n}if(b.cn&&b.cn.length>0){var f=b.cn[0];\nf.ref=f.ref||(g&&b.value);\nvar e=ZmContact.createFromDom(f,{list:this.list,isGal:g});\ne.isDL=g&&e.attr[ZmContact.F_type]==\"group\";\nappCtxt.cacheSet(b.value,e)\n}}this._loadFromDom(d)\n}this.isLoaded=true;\nif(h){h.run(d,this)\n}};\nZmContact.prototype.clear=function(){};\nZmContact.prototype.isEmpty=function(){for(var a in this.attr){return false\n}return true\n};\nZmContact.prototype.isShared=function(){return this.addrbook&&this.addrbook.link\n};\nZmContact.prototype.isReadOnly=function(){if(this.isGal){return true\n}return this.isShared()?this.addrbook&&this.addrbook.isReadOnly():false\n};\nZmContact.prototype.isLocked=function(){if(!this.isDistributionList()){return this.isReadOnly()\n}if(!this.dlInfo){return false\n}var a=this.dlInfo;\nif(a.isOwner){return false\n}if(a.isMember){return a.unsubscriptionPolicy==ZmContactSplitView.SUBSCRIPTION_POLICY_REJECT\n}return a.subscriptionPolicy==ZmContactSplitView.SUBSCRIPTION_POLICY_REJECT\n};\nZmContact.prototype.isGroup=function(){return this.getAttr(ZmContact.F_type)==\"group\"||this.type==ZmItem.GROUP\n};\nZmContact.prototype.isDistributionList=function(){return this.isGal&&this.isGroup()\n};\nZmContact.prototype.getGroupMembers=function(){var c=this.getAllGroupMembers();\nvar b=[];\nfor(var a=0;\na<c.length;\na++){b.push(c[a].toString())\n}return AjxEmailAddress.parseEmailString(b.join(\", \"))\n};\nZmContact.prototype.getAllGroupMembers=function(){if(this.isDistributionList()){return this.dlMembers\n}var e=[];\nvar b=this.attr[ZmContact.F_groups];\nif(!b){return AjxEmailAddress.parseEmailString(this.attr[ZmContact.F_email])\n}for(var c=0;\nc<b.length;\nc++){var h=b[c];\nvar d=h.type;\nvar f=h.value;\nif(d==ZmContact.GROUP_INLINE_REF){e.push(ZmContactsHelper._wrapInlineContact(f))\n}else{var a=ZmContact.getContactFromCache(f);\nif(!a){continue\n}var g=ZmContactsHelper._wrapContact(a);\nif(g&&d===ZmContact.GROUP_CONTACT_REF){g.groupRefValue=f\n}if(g){e.push(g)\n}}}return e\n};\nZmContact.prototype.gatherExtraDlStuff=function(b){if(this.dlInfo&&!this.dlInfo.isMinimal){this.loadDlMembers(b);\nreturn\n}var a=this._handleGetDlInfoResponse.bind(this,b);\nthis.loadDlInfo(a)\n};\nZmContact.prototype._handleGetDlInfoResponse=function(h,b){var d=b._data.GetDistributionListResponse;\nvar f=d.dl[0];\nvar e=f._attrs;\nvar g=f.isMember;\nvar c=f.isOwner;\nvar a=[];\nthis.dlInfo={isMember:g,isOwner:c,subscriptionPolicy:e.zimbraDistributionListSubscriptionPolicy,unsubscriptionPolicy:e.zimbraDistributionListUnsubscriptionPolicy,description:e.description||\"\",displayName:e.displayName||\"\",notes:e.zimbraNotes||\"\",hideInGal:e.zimbraHideInGal==\"TRUE\",mailPolicy:c&&this._getMailPolicy(f,a),owners:c&&this._getOwners(f)};\nthis.dlInfo.mailPolicySpecificMailers=a;\nthis.loadDlMembers(h)\n};\nZmContact.prototype.loadDlMembers=function(b){if((!appCtxt.get(\"EXPAND_DL_ENABLED\")||this.dlInfo.hideInGal)&&!this.dlInfo.isOwner){this.dlMembers=[];\nif(b){b()\n}return\n}if(this.dlMembers){if(b){b()\n}return\n}var a=this._handleGetDlMembersResponse.bind(this,b);\nthis.getAllDLMembers(a)\n};\nZmContact.prototype._handleGetDlMembersResponse=function(e,a){var d=a.list;\nif(!d){this.dlMembers=[];\ne();\nreturn\n}var b=[];\nfor(var c=0;\nc<d.length;\nc++){b.push({type:ZmContact.GROUP_INLINE_REF,value:d[c],address:d[c]})\n}this.dlMembers=b;\ne()\n};\nZmContact.prototype._getOwners=function(b){var d=b.owners[0].owner;\nvar e=[];\nfor(var c=0;\nc<d.length;\nc++){var a=d[c].name;\ne.push(a)\n}return e\n};\nZmContact.prototype._getMailPolicy=function(c,b){var h;\nvar g=c.rights[0].right;\nvar e=g[0];\nvar f=e.grantee;\nif(!f){return ZmGroupView.MAIL_POLICY_ANYONE\n}for(var d=0;\nd<f.length;\nd++){var a=f[d];\nh=ZmGroupView.GRANTEE_TYPE_TO_MAIL_POLICY_MAP[a.type];\nif(h==ZmGroupView.MAIL_POLICY_SPECIFIC){b.push(a.name)\n}else{if(h==ZmGroupView.MAIL_POLICY_ANYONE){break\n}else{if(h==ZmGroupView.MAIL_POLICY_INTERNAL){break\n}else{if(h==ZmGroupView.MAIL_POLICY_MEMBERS){if(a.name==this.getEmail()){break\n}else{b.push(a.name);\nh=ZmGroupView.MAIL_POLICY_SPECIFIC\n}}}}}}h=h||ZmGroupView.MAIL_POLICY_ANYONE;\nreturn h\n};\nZmContact.prototype.loadDlInfo=function(c){var b=AjxSoapDoc.create(\"GetDistributionListRequest\",\"urn:zimbraAccount\",null);\nb.setMethodAttribute(\"needOwners\",\"1\");\nb.setMethodAttribute(\"needRights\",\"sendToDistList\");\nvar a=b.set(\"dl\",this.getEmail());\na.setAttribute(\"by\",\"name\");\nappCtxt.getAppController().sendRequest({soapDoc:b,asyncMode:true,callback:c})\n};\nZmContact.prototype.toggleSubscription=function(c){var b=AjxSoapDoc.create(\"SubscribeDistributionListRequest\",\"urn:zimbraAccount\",null);\nb.setMethodAttribute(\"op\",this.dlInfo.isMember?\"unsubscribe\":\"subscribe\");\nvar a=b.set(\"dl\",this.getEmail());\na.setAttribute(\"by\",\"name\");\nappCtxt.getAppController().sendRequest({soapDoc:b,asyncMode:true,callback:c})\n};\nZmContact.prototype.getId=function(a){if(a){return this.isShared()?this.id:appCtxt.accountList.mainAccount.id+\":\"+this.id\n}return this.id\n};\nZmContact.prototype.getIcon=function(a){if(this.isDistributionList()){return\"DistributionList\"\n}if(this.isGal){return\"GALContact\"\n}if(this.isShared()||(a&&a.link)){return\"SharedContact\"\n}if(this.isGroup()){return\"Group\"\n}return\"Contact\"\n};\nZmContact.prototype.getIconLarge=function(){if(this.isDistributionList()){return\"Group_48\"\n}return\"Person_48\"\n};\nZmContact.prototype.getFolderId=function(){return this.isShared()?this.folderId.split(\":\")[0]:this.folderId\n};\nZmContact.prototype.getAttr=function(a){var b=this.attr[a];\nreturn b?((b instanceof Array)?b[0]:b):\"\"\n};\nZmContact.prototype.setAttr=function(a,b){this.attr[a]=b\n};\nZmContact.prototype.setParticipantStatus=function(a){this.participantStatus=a\n};\nZmContact.prototype.getParticipantStatus=function(){return this.participantStatus\n};\nZmContact.prototype.setParticipantRole=function(a){this.participantRole=a\n};\nZmContact.prototype.getParticipantRole=function(){return this.participantRole\n};\nZmContact.prototype.removeAttr=function(a){delete this.attr[a]\n};\nZmContact.prototype.getAttrs=function(c){var b=this.attr;\nif(c){b={};\nfor(var a in this.attr){var d=ZmContact.getPrefix(a);\nif(d===c){b[a]=this.attr[a]\n}}}return b\n};\nZmContact.prototype.getNormalizedAttrs=function(a){return ZmContact.getNormalizedAttrs(this.attr,a,ZmContact.IGNORE_NORMALIZATION)\n};\nZmContact.prototype.create=function(g,e,c){if(this.isDistributionList()){this._createDl(g);\nreturn\n}var j={CreateContactRequest:{_jsns:\"urn:zimbraMail\"}};\nvar f=j.CreateContactRequest;\nvar h=f.cn={};\nvar d=g[ZmContact.F_folderId]||ZmFolder.ID_CONTACTS;\nvar b=appCtxt.getById(d);\nif(b&&b.isRemote()){d=b.getRemoteId()\n}h.l=d;\nh.a=[];\nh.m=[];\nfor(var a in g){if(a==ZmContact.F_folderId||a==\"objectClass\"||a==\"zimbraId\"||a==\"createTimeStamp\"||a==\"modifyTimeStamp\"){continue\n}if(a==ZmContact.F_groups){this._addContactGroupAttr(h,g)\n}else{this._addRequestAttr(h,a,g[a])\n}}this._addRequestAttr(h,ZmContact.X_fullName,ZmContact.computeFileAs(g));\nvar i=new AjxCallback(this,this._handleResponseCreate,[g,e!=null,c]);\nif(e){e.addRequestParams(j,i)\n}else{appCtxt.getAppController().sendRequest({jsonObj:j,asyncMode:true,callback:i})\n}};\nZmContact.prototype._handleResponseCreate=function(i,d,c,k){if(d){return\n}var f=k.getResponse().CreateContactResponse;\ncn=f?f.cn[0]:null;\nvar b=cn?cn.id:null;\nif(b){this._fileAs=null;\nthis._fullName=null;\nthis.id=b;\nthis.modified=cn.md;\nthis.folderId=cn.l||ZmOrganizer.ID_ADDRBOOK;\nfor(var j in i){if(!(i[j]==undefined||i[j]==\"\")){this.setAttr(j,i[j])\n}}var h=cn?cn.m:null;\nif(h){this.attr[ZmContact.F_groups]=h;\ncn._attrs[ZmContact.F_groups]=h\n}if(!c){var e=this.isGroup()?ZmMsg.groupCreated:ZmMsg.contactCreated;\nappCtxt.getAppController().setStatusMsg(e)\n}appCtxt.getApp(ZmApp.CONTACTS).getContactList().add(cn)\n}else{var e=this.isGroup()?ZmMsg.errorCreateGroup:ZmMsg.errorCreateContact;\nvar g=ZmMsg.errorTryAgain+\"\\n\"+ZmMsg.errorContact;\nappCtxt.getAppController().setStatusMsg(e,ZmStatusView.LEVEL_CRITICAL,g)\n}};\nZmContact.prototype.createFromVCard=function(b,a){var e={CreateContactRequest:{_jsns:\"urn:zimbraMail\"}};\nvar d=e.CreateContactRequest.cn={l:ZmFolder.ID_CONTACTS};\nd.vcard={mid:b,part:a};\nvar c={jsonObj:e,asyncMode:true,callback:(new AjxCallback(this,this._handleResponseCreateVCard)),errorCallback:(new AjxCallback(this,this._handleErrorCreateVCard))};\nappCtxt.getAppController().sendRequest(c)\n};\nZmContact.prototype._handleResponseCreateVCard=function(a){appCtxt.getAppController().setStatusMsg(ZmMsg.contactCreated)\n};\nZmContact.prototype._handleErrorCreateVCard=function(a){appCtxt.getAppController().setStatusMsg(ZmMsg.errorCreateContact,ZmStatusView.LEVEL_CRITICAL)\n};\nZmContact.prototype.modify=function(h,n,j,c){if(this.isDistributionList()){this._modifyDl(h);\nreturn\n}if(this.list.isGal){return\n}var p={ModifyContactRequest:{_jsns:\"urn:zimbraMail\",replace:\"0\",force:\"1\"}};\nvar l=p.ModifyContactRequest.cn={id:this.id};\nl.a=[];\nl.m=[];\nvar b=false;\nfor(var a in h){if(a==ZmContact.F_folderId){continue\n}if(a==ZmContact.F_groups){this._addContactGroupAttr(l,h)\n}else{this._addRequestAttr(l,a,(h[a]&&h[a].value)||h[a])\n}b=true\n}if(ZmContact.F_firstName in h||ZmContact.F_lastName in h||ZmContact.F_company in h||ZmContact.X_fileAs in h){var g={};\nvar f=[ZmContact.F_firstName,ZmContact.F_lastName,ZmContact.F_company,ZmContact.X_fileAs];\nfor(var e=0;\ne<f.length;\ne++){var k=f[e];\nvar m=h[k];\ng[k]=m!=null?m:this.getAttr(k)\n}var d=ZmContact.computeFileAs(g);\nthis._addRequestAttr(l,ZmContact.X_fullName,d)\n}if(b){if(c){c.addRequestParams(p,null,null)\n}else{var o=this._handleResponseModify.bind(this,h,n,j);\nappCtxt.getAppController().sendRequest({jsonObj:p,asyncMode:true,callback:o})\n}}else{if(h[ZmContact.F_folderId]){this._setFolder(h[ZmContact.F_folderId])\n}}};\nZmContact.prototype._createDl=function(a){this.attr=a;\nvar c=this._getCreateDlReq(a);\nvar b=[];\nthis._addMemberModsReqs(b,a);\nthis._addMailPolicyAndOwnersReqs(b,a);\nvar e={BatchRequest:{_jsns:\"urn:zimbra\",CreateDistributionListRequest:c,DistributionListActionRequest:b}};\nvar d=this._createDlResponseHandler.bind(this);\nappCtxt.getAppController().sendRequest({jsonObj:e,asyncMode:true,callback:d})\n};\nZmContact.prototype._addMailPolicyAndOwnersReqs=function(b,a){var d=a[ZmContact.F_dlMailPolicy];\nif(d){b.push(this._getSetMailPolicyReq(d,a[ZmContact.F_dlMailPolicySpecificMailers]))\n}var c=a[ZmContact.F_dlListOwners];\nif(c){b.push(this._getSetOwnersReq(c))\n}};\nZmContact.prototype._addMemberModsReqs=function(c,b){var a=b[ZmContact.F_groups];\nvar h=[];\nvar g=[];\nif(a){for(var f=0;\nf<a.length;\nf++){var e=a[f];\nvar d=(e.op==\"+\"?h:g);\nd.push(e)\n}}if(h.length>0){c.push(this._getAddOrRemoveReq(h,true))\n}if(g.length>0){c.push(this._getAddOrRemoveReq(g,false))\n}};\nZmContact.prototype._modifyDl=function(b){var f=[];\nvar j=b[ZmContact.F_email];\nvar e=false;\nif(j!==undefined){e=true;\nf.push(this._getRenameDlReq(j));\nthis.setAttr(ZmContact.F_email,j)\n}var i=this._getModifyDlAttributesReq(b);\nif(i){f.push(i)\n}var c=b[ZmContact.F_dlDisplayName];\nif(c!==undefined){this.setAttr(ZmContact.F_dlDisplayName,c)\n}var a=this.getFileAs();\nthis._resetCachedFields();\nvar d=a!=this.getFileAs();\nthis._addMemberModsReqs(f,b);\nthis._addMailPolicyAndOwnersReqs(f,b);\nif(f.length==0){this._modifyDlResponseHandler(false,null);\nreturn\n}var h={BatchRequest:{_jsns:\"urn:zimbra\",DistributionListActionRequest:f}};\nvar g=this._modifyDlResponseHandler.bind(this,d||e);\nappCtxt.getAppController().sendRequest({jsonObj:h,asyncMode:true,callback:g})\n};\nZmContact.prototype._getAddOrRemoveReq=function(a,d){var c={_jsns:\"urn:zimbraAccount\",dl:{by:\"name\",_content:this.getEmail()},action:{op:d?\"addMembers\":\"removeMembers\",dlm:[]}};\nfor(var b=0;\nb<a.length;\nb++){var e=a[b];\nc.action.dlm.push({_content:e.email})\n}return c\n};\nZmContact.prototype._getRenameDlReq=function(a){return{_jsns:\"urn:zimbraAccount\",dl:{by:\"name\",_content:this.getEmail()},action:{op:\"rename\",newName:{_content:a}}}\n};\nZmContact.prototype._getSetOwnersReq=function(b){var c=[];\nfor(var a=0;\na<b.length;\na++){c.push({type:ZmGroupView.GRANTEE_TYPE_USER,by:\"name\",_content:b[a]})\n}return{_jsns:\"urn:zimbraAccount\",dl:{by:\"name\",_content:this.getEmail()},action:{op:\"setOwners\",owner:c}}\n};\nZmContact.prototype._getSetMailPolicyReq=function(d,a){var c=[];\nif(d==ZmGroupView.MAIL_POLICY_SPECIFIC){for(var b=0;\nb<a.length;\nb++){c.push({type:ZmGroupView.GRANTEE_TYPE_EMAIL,by:\"name\",_content:a[b]})\n}}else{if(d==ZmGroupView.MAIL_POLICY_ANYONE){c.push({type:ZmGroupView.GRANTEE_TYPE_PUBLIC})\n}else{if(d==ZmGroupView.MAIL_POLICY_INTERNAL){c.push({type:ZmGroupView.GRANTEE_TYPE_ALL})\n}else{if(d==ZmGroupView.MAIL_POLICY_MEMBERS){c.push({type:ZmGroupView.GRANTEE_TYPE_GROUP,by:\"name\",_content:this.getEmail()})\n}else{throw\"invalid mailPolicy value \"+d\n}}}}return{_jsns:\"urn:zimbraAccount\",dl:{by:\"name\",_content:this.getEmail()},action:{op:\"setRights\",right:{right:\"sendToDistList\",grantee:c}}}\n};\nZmContact.prototype._addDlAttribute=function(c,e,b,d){var a=e[b];\nif(a===undefined){return\n}c.push({n:d,_content:a})\n};\nZmContact.prototype._getDlAttributes=function(b){var a=[];\nthis._addDlAttribute(a,b,ZmContact.F_dlDisplayName,\"displayName\");\nthis._addDlAttribute(a,b,ZmContact.F_dlDesc,\"description\");\nthis._addDlAttribute(a,b,ZmContact.F_dlNotes,\"zimbraNotes\");\nthis._addDlAttribute(a,b,ZmContact.F_dlHideInGal,\"zimbraHideInGal\");\nthis._addDlAttribute(a,b,ZmContact.F_dlSubscriptionPolicy,\"zimbraDistributionListSubscriptionPolicy\");\nthis._addDlAttribute(a,b,ZmContact.F_dlUnsubscriptionPolicy,\"zimbraDistributionListUnsubscriptionPolicy\");\nreturn a\n};\nZmContact.prototype._getCreateDlReq=function(a){return{_jsns:\"urn:zimbraAccount\",name:a[ZmContact.F_email],a:this._getDlAttributes(a),dynamic:false}\n};\nZmContact.prototype._getModifyDlAttributesReq=function(a){var b=this._getDlAttributes(a);\nif(b.length==0){return null\n}return{_jsns:\"urn:zimbraAccount\",dl:{by:\"name\",_content:this.getEmail()},action:{op:\"modify\",a:b}}\n};\nZmContact.prototype._modifyDlResponseHandler=function(c,a){if(this._handleErrorDl(a)){return\n}appCtxt.setStatusMsg(ZmMsg.dlSaved);\nthis.clearDlInfo();\nvar b={fileAsChanged:c};\nthis._popView(c);\nthis._notify(ZmEvent.E_MODIFY,b)\n};\nZmContact.prototype._createDlResponseHandler=function(a){if(this._handleErrorDl(a,true)){this.attr={};\nreturn\n}appCtxt.setStatusMsg(ZmMsg.distributionListCreated);\nthis._popView(true)\n};\nZmContact.prototype._popView=function(b){var a=AjxDispatcher.run(\"GetContactController\");\na.popView(true);\nif(!b){return\n}var c=AjxDispatcher.run(\"GetContactListController\");\nif(c.getFolderId()!=ZmFolder.ID_DLS){return\n}ZmAddrBookTreeController.dlFolderClicked()\n};\nZmContact.prototype._handleErrorDl=function(b,a){if(!b){return false\n}var f=b.getResponse().BatchResponse;\nvar d=f.Fault;\nif(!d){return false\n}var e=ZmCsfeCommand.faultToEx(d[0]);\nvar c=AjxDispatcher.run(\"GetContactController\");\nc.popupErrorDialog(a?ZmMsg.dlCreateFailed:ZmMsg.dlModifyFailed,e);\nreturn true\n};\nZmContact.prototype.clearDlInfo=function(){this.dlMembers=null;\nthis.dlInfo=null;\nvar a=appCtxt.getApp(ZmApp.CONTACTS);\na.cacheDL(this.getEmail(),null);\nappCtxt.cacheRemove(this.getId())\n};\nZmContact.prototype._handleResponseModify=function(e,h,f,i){var b=i.getResponse().ModifyContactResponse;\nvar g=b?b.cn[0]:null;\nvar a=g?g.id:null;\nvar d=g?g.m:null;\nif(d){this.attr[ZmContact.F_groups]=d;\ng._attrs[ZmContact.F_groups]=d\n}if(a&&a==this.id){if(!f){appCtxt.setStatusMsg(this.isGroup()?ZmMsg.groupSaved:ZmMsg.contactSaved)\n}if(e[ZmContact.F_folderId]&&this.folderId!=e[ZmContact.F_folderId]){this._setFolder(e[ZmContact.F_folderId])\n}appCtxt.getApp(ZmApp.CONTACTS).updateIdHash(g,false)\n}else{var c=ZmMsg.errorTryAgain+\"\\n\"+ZmMsg.errorContact;\nappCtxt.getAppController().setStatusMsg(ZmMsg.errorModifyContact,ZmStatusView.LEVEL_CRITICAL,c)\n}};\nZmContact.prototype._handleResponseMove=function(a,d){var c=a&&appCtxt.getById(a);\nvar b=1;\nif(c){appCtxt.setStatusMsg(ZmList.getActionSummary({actionTextKey:\"actionMove\",numItems:b,type:ZmItem.CONTACT,actionArg:c.name}))\n}this._notify(ZmEvent.E_MODIFY,d)\n};\nZmContact.prototype._setFolder=function(c){var d=appCtxt.getById(this.folderId);\nvar a=d?d.nId:null;\nif(a==c){return\n}var e=appCtxt.getById(c);\nif(this.isShared()||(e&&e.link)){if(this.list){this.list.moveItems({items:[this],folder:e})\n}}else{var g={ContactActionRequest:{_jsns:\"urn:zimbraMail\"}};\ng.ContactActionRequest.action={id:this.id,op:\"move\",l:c};\nvar f=new AjxCallback(this,this._handleResponseMove,[c]);\nvar b=appCtxt.multiAccounts&&appCtxt.accountList.mainAccount.name;\nappCtxt.getAppController().sendRequest({jsonObj:g,asyncMode:true,callback:f,accountName:b})\n}};\nZmContact.prototype.notifyModify=function(h,d){var m=ZmItem.prototype.notifyModify.apply(this,arguments);\nvar e=window.parentAppCtxt||window.appCtxt;\ne.clearAutocompleteCache(ZmAutocomplete.AC_TYPE_CONTACT);\nif(m){return m\n}var g=this.getFileAs();\nvar k=this.getFullName();\nthis._resetCachedFields();\nvar f={};\nif(h._attrs){var c=this.getAttrs();\nfor(var l in c){f[l]=c[l];\nif(h._attrs[l]==null){this.removeAttr(l)\n}}for(var l in h._attrs){this.setAttr(l,h._attrs[l])\n}if(h.m){this.setAttr(ZmContact.F_groups,h.m)\n}}var b={attr:h._attrs,oldAttr:f,fullNameChanged:(this.getFullName()!=k),fileAsChanged:(this.getFileAs()!=g),contact:this};\nfor(var i in this._list){var j=i&&appCtxt.getById(i);\nif(!j){continue\n}j.modifyLocal(h,b)\n}this._notify(ZmEvent.E_MODIFY,h)\n};\nZmContact.prototype.notifyDelete=function(){ZmItem.prototype.notifyDelete.call(this);\nvar a=window.parentAppCtxt||window.appCtxt;\na.clearAutocompleteCache(ZmAutocomplete.AC_TYPE_CONTACT)\n};\nZmContact.prototype.initFromEmail=function(a,b){if(a instanceof AjxEmailAddress){this.setAttr(ZmContact.F_email,a.getAddress());\nthis._initFullName(a,b)\n}else{this.setAttr(ZmContact.F_email,a)\n}};\nZmContact.prototype.initFromPhone=function(a,b){this.setAttr(b||ZmContact.F_companyPhone,a)\n};\nZmContact.prototype.getEmail=function(b){var a=(this.getAttr(ZmContact.F_email)||this.getAttr(ZmContact.F_workEmail1)||this.getAttr(ZmContact.F_email2)||this.getAttr(ZmContact.F_workEmail2)||this.getAttr(ZmContact.F_email3)||this.getAttr(ZmContact.F_workEmail3));\nif(b){a=AjxEmailAddress.parse(a);\nif(a){a.isGroup=this.isGroup();\na.canExpand=this.canExpand\n}}return a\n};\nZmContact.prototype.getPhone=function(){var a=(this.getAttr(ZmContact.F_mobilePhone)||this.getAttr(ZmContact.F_workPhone)||this.getAttr(ZmContact.F_homePhone)||this.getAttr(ZmContact.F_otherPhone));\nreturn a\n};\nZmContact.prototype.getLookupEmail=function(b){var a=this._lookupEmail;\nif(b&&a){a=AjxEmailAddress.parse(a);\na.isGroup=this.isGroup();\na.canExpand=this.canExpand\n}return a\n};\nZmContact.prototype.getEmails=function(){var f=[];\nvar c=this.getAttrs();\nfor(var b=0;\nb<ZmContact.EMAIL_FIELDS.length;\nb++){var e=ZmContact.EMAIL_FIELDS[b];\nfor(var d=1;\ntrue;\nd++){var a=ZmContact.getAttributeName(e,d);\nif(!c[a]){break\n}f.push(c[a])\n}}return f\n};\nZmContact.prototype.getFullName=function(a){var b=null;\nif(!this._fullName||a){var c=this.getAttr(ZmContact.X_fullName);\nif(c){this._fullName=(c instanceof Array)?c[0]:c\n}else{this._fullName=this.getFullNameForDisplay(false)\n}if(a){b=this.getFullNameForDisplay(a)\n}}if(!this._fullName){this._fullName=this.getFileAs()\n}return b||this._fullName\n};\nZmContact.prototype.getFullNameForDisplay=function(d){if(this.isDistributionList()){return this.getAttr(ZmContact.F_dlDisplayName)||this.getAttr(\"fullName\")\n}var e=this.getAttr(ZmContact.F_namePrefix);\nvar c=this.getAttr(ZmContact.F_firstName);\nvar k=this.getAttr(ZmContact.F_middleName);\nvar b=this.getAttr(ZmContact.F_maidenName);\nvar i=this.getAttr(ZmContact.F_lastName);\nvar j=this.getAttr(ZmContact.F_nameSuffix);\nvar g=ZmMsg.fullname;\nif(j){g=b?ZmMsg.fullnameMaidenSuffix:ZmMsg.fullnameSuffix\n}else{if(b){g=ZmMsg.fullnameMaiden\n}}if(appCtxt.get(ZmSetting.LOCALE_NAME)===\"ja\"){var a=this.getAttr(ZmContact.F_fileAs);\nif(!AjxUtil.isEmpty(a)&&a!==\"1\"&&a!==\"4\"&&a!==\"6\"&&a.slice(0,1)!==\"8\"){g=\"{0} {1} {2} {4}\"\n}}var h=new AjxMessageFormat(g);\nvar f=[e,c,k,b,i,j];\nif(!d){return AjxStringUtil.trim(h.format(f),true)\n}return this._getFullNameHtml(h,f)\n};\nZmContact.prototype._getFullNameHtml=function(j,c){var h=[];\nvar e=j.getSegments();\nfor(var d=0;\nd<e.length;\nd++){var f=e[d];\nif(f instanceof AjxFormat.TextSegment){h.push(f.format());\ncontinue\n}var g=f.getIndex();\nvar b=c[g];\nvar k=ZmContact.__RUBY_FIELDS[g]&&this.getAttr(ZmContact.__RUBY_FIELDS[g]);\nh.push(AjxStringUtil.htmlRubyEncode(b,k))\n}return h.join(\"\")\n};\nZmContact.__RUBY_FIELDS=[null,ZmContact.F_phoneticFirstName,null,null,ZmContact.F_phoneticLastName,null];\nZmContact.prototype.getToolTip=function(a,d,c){var b={contact:this,entryTitle:this.getFileAs(),hint:c};\nreturn(AjxTemplate.expand(\"abook.Contacts#Tooltip\",b))\n};\nZmContact.prototype.getFileAs=function(a){if(!this._fileAs){this._fileAs=ZmContact.computeFileAs(this);\nthis._fileAsLC=this._fileAs?this._fileAs.toLowerCase():null\n}if(a&&!this._fileAsLC){this._fileAsLC=this._fileAs.toLowerCase()\n}return a?this._fileAsLC:this._fileAs\n};\nZmContact.prototype.getFileAsNoName=function(){return[ZmMsg.noName,this.getEmail()].join(\" \")\n};\nZmContact.prototype.getHeader=function(){return this.id?this.getFileAs():ZmMsg.newContact\n};\nZmContact.NO_MAX_IMAGE_WIDTH=ZmContact.NO_MAX_IMAGE_HEIGHT=-1;\nZmContact.prototype.getImageUrl=function(e,d){var f=this.getAttr(ZmContact.F_image);\nvar c=f&&f.part||this.getAttr(ZmContact.F_imagepart);\nif(!c){return this.getAttr(ZmContact.F_zimletImage)\n}var g=appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI);\nvar b=\"\";\nif(e!==ZmContact.NO_MAX_IMAGE_WIDTH){e=e||48;\nb=[\"&max_width=\",e].join(\"\")\n}var a=\"\";\nif(d!==ZmContact.NO_MAX_IMAGE_HEIGHT){d=d||(e!==ZmContact.NO_MAX_IMAGE_WIDTH?e:48);\na=[\"&max_height=\",d].join(\"\")\n}return[g,\"&id=\",this.id,\"&part=\",c,b,a,\"&t=\",(new Date()).getTime()].join(\"\")\n};\nZmContact.prototype.addModifyZimletImageToBatch=function(b,c){var a={};\nif(this.getAttr(ZmContact.F_zimletImage)===c){return\n}a[ZmContact.F_zimletImage]=c;\nb.add(this.modify.bind(this,a,null,true))\n};\nZmContact.prototype.getCompanyField=function(){var b=this.getAttrs();\nif(b==null){return null\n}var c=parseInt(b.fileAs);\nvar d=[];\nvar a=0;\nif(c==ZmContact.FA_LAST_C_FIRST||c==ZmContact.FA_FIRST_LAST){if(b.jobTitle){d[a++]=b.jobTitle;\nif(b.company){d[a++]=\", \"\n}}if(b.company){d[a++]=b.company\n}}else{if(c==ZmContact.FA_COMPANY){if(b.lastName){d[a++]=b.lastName;\nif(b.firstName){d[a++]=\", \"\n}}if(b.firstName){d[a++]=b.firstName\n}if(b.jobTitle){d[a++]=\" (\"+b.jobTitle+\")\"\n}}else{if(b.jobTitle){d[a++]=b.jobTitle;\nif(b.company&&(b.fileAs==null||c==ZmContact.FA_LAST_C_FIRST||c==ZmContact.FA_FIRST_LAST)){d[a++]=\", \"\n}}if(b.company&&(b.fileAs==null||c==ZmContact.FA_LAST_C_FIRST||c==ZmContact.FA_FIRST_LAST)){d[a++]=b.company\n}}}if(d.length==0){return null\n}return d.join(\"\")\n};\nZmContact.prototype.getWorkAddrField=function(a){var b=this.getAttrs();\nreturn this._getAddressField(b.workStreet,b.workCity,b.workState,b.workPostalCode,b.workCountry)\n};\nZmContact.prototype.getHomeAddrField=function(a){var b=this.getAttrs();\nreturn this._getAddressField(b.homeStreet,b.homeCity,b.homeState,b.homePostalCode,b.homeCountry)\n};\nZmContact.prototype.getOtherAddrField=function(a){var b=this.getAttrs();\nreturn this._getAddressField(b.otherStreet,b.otherCity,b.otherState,b.otherPostalCode,b.otherCountry)\n};\nZmContact.prototype.getAddressBook=function(){if(!this.addrbook){this.addrbook=appCtxt.getById(this.folderId)\n}return this.addrbook\n};\nZmContact.prototype._getAddressField=function(g,f,d,c,e){if(g==null&&f==null&&d==null&&c==null&&e==null){return null\n}var b=[];\nvar a=0;\nif(g){b[a++]=g;\nif(f||d||c){b[a++]=\"\\n\"\n}}if(f){b[a++]=f;\nif(d){b[a++]=\", \"\n}else{if(c){b[a++]=\" \"\n}}}if(d){b[a++]=d;\nif(c){b[a++]=\" \"\n}}if(c){b[a++]=c\n}if(e){b[a++]=\"\\n\"+e\n}return b.join(\"\")\n};\nZmContact.prototype._initFullName=function(b,d){var a=b.getName();\na=AjxStringUtil.trim(a.replace(AjxEmailAddress.commentPat,\"\"));\nif(a&&a.length){this._setFullName(a,[\" \"])\n}else{if(!d){a=b.getAddress();\nif(a&&a.length){var c=a.indexOf(\"@\");\nif(c==-1){return\n}a=a.substr(0,c);\nthis._setFullName(a,[\".\",\"_\"])\n}}}};\nZmContact.prototype._setFullName=function(f,e){var d=e[0];\nfor(var a=0;\na<e.length;\na++){if(f.indexOf(e[a])!=-1){d=e[a];\nbreak\n}}var c=f.split(d);\nvar b=this[\"__setFullName_\"+AjxEnv.DEFAULT_LOCALE]||this.__setFullName;\nb.call(this,c,f,e)\n};\nZmContact.prototype.__setFullName=function(a,c,b){this.setAttr(ZmContact.F_firstName,a[0]);\nif(a.length==2){this.setAttr(ZmContact.F_lastName,a[1])\n}else{if(a.length==3){this.setAttr(ZmContact.F_middleName,a[1]);\nthis.setAttr(ZmContact.F_lastName,a[2])\n}}};\nZmContact.prototype.__setFullName_ja=function(a,c,b){if(a.length>2){this.__setFullName(a,c,b);\nreturn\n}this.setAttr(ZmContact.F_lastName,a[0]);\nif(a.length>1){this.setAttr(ZmContact.F_firstName,a[1])\n}};\nZmContact.prototype.__setFullName_ja_JP=ZmContact.prototype.__setFullName_ja;\nZmContact.prototype._addRequestAttr=function(e,c,d){var b={n:c};\nif(c==ZmContact.F_image&&AjxUtil.isString(d)&&d.length){if(d.indexOf(\"aid_\")!=-1){b.aid=d.substring(4)\n}else{b.part=d.substring(5)\n}}else{b._content=d||\"\"\n}if(d instanceof Array){if(!e._attrs){e._attrs={}\n}e._attrs[c]=d||\"\"\n}else{if(!e.a){e.a=[]\n}e.a.push(b)\n}};\nZmContact.prototype._addContactGroupAttr=function(f,d){var b=d[ZmContact.F_groups];\nfor(var c=0;\nc<b.length;\nc++){var e=b[c];\nif(!f.m){f.m=[]\n}var a={type:e.type,value:e.value};\nif(e.op){a.op=e.op\n}f.m.push(a)\n}};\nZmContact.prototype._resetCachedFields=function(){this._fileAs=this._fileAsLC=this._fullName=null\n};\nZmContact.prototype._loadFromDom=function(d){this.isLoaded=true;\nthis.rev=d.rev;\nthis.sf=d.sf||d._attrs.sf;\nif(!this.isGal){this.folderId=d.l\n}this.created=d.cd;\nthis.modified=d.md;\nthis.attr=d._attrs||{};\nif(d.m){this.attr[ZmContact.F_groups]=d.m\n}this.ref=d.ref||this.attr.dn;\nif(d.email){this.attr[ZmContact.F_email]=d.email\n}if(d.email2){this.attr[ZmContact.F_email2]=d.email2\n}if(d.email3){this.attr[ZmContact.F_email3]=d.email3\n}this.attr=ZmContact.mapAttrs(this.attr);\nvar a=this.attr[ZmContact.F_groups];\nif(!a||(a instanceof Array&&a.length==0)){this.type=ZmItem.CONTACT\n}else{this.type=ZmItem.GROUP\n}var c=window.parentAppCtxt||window.appCtxt;\nthis.addrbook=c.getById(this.folderId);\nthis._parseTagNames(d.tn);\nif(!this.isShared()){this._parseFlags(d.f)\n}else{this.isLoaded=false\n}this._fileAs=ZmContact.computeFileAs(this);\nthis.isDL=this.isDistributionList();\nif(this.isDL){this.dlInfo={isMinimal:true,isMember:d.isMember,isOwner:d.isOwner,subscriptionPolicy:this.attr.zimbraDistributionListSubscriptionPolicy,unsubscriptionPolicy:this.attr.zimbraDistributionListUnsubscriptionPolicy,displayName:d.d||\"\",hideInGal:this.attr.zimbraHideInGal==\"TRUE\"};\nthis.canExpand=d.exp!==false;\nvar e=this.getEmails();\nvar c=window.parentAppCtxt||window.appCtxt;\nfor(var b=0;\nb<e.length;\nb++){c.setIsExpandableDL(e[b],this.canExpand)\n}}if(d.certificate){this.certificate=d.certificate\n}};\nZmContact.prototype.getAttendeeText=function(c,b){var a=this.getEmail(true);\nreturn(a?a.toString(b||(c&&c!=ZmCalBaseItem.PERSON)):\"\")\n};\nZmContact.prototype.getAttendeeKey=function(){var b=this.getLookupEmail()||this.getEmail();\nvar a=this.getFullName();\nreturn b?b:a\n};\nZmContact.prototype.getUnknownFields=function(b){var g=ZmContact.__FIELD_MAP;\nif(!g){g=ZmContact.__FIELD_MAP={};\nfor(var e=0;\ne<ZmContact.DISPLAY_FIELDS;\ne++){g[ZmContact.DISPLAY_FIELDS[e]]=true\n}}var a=[];\nvar d=this.getAttrs();\nfor(var c in d){var f=ZmContact.getPrefix(c);\nif(g[c]){continue\n}a.push(f)\n}return this.getFields(a,b)\n};\nZmContact.prototype.getFields=function(c,k){var f;\nvar h=this.getAttrs();\nfor(var d=0;\nd<c.length;\nd++){for(var b=1;\ntrue;\nb++){var e=ZmContact.getAttributeName(c[d],b);\nif(!h[e]){break\n}if(!f){f={}\n}f[e]=h[e]\n}}if(k&&f){var j=AjxUtil.keys(f);\nj.sort(k);\nvar a={};\nfor(var b=0;\nb<j;\nb++){var g=j[b];\na[g]=c[g]\n}f=a\n}return f\n};\nZmContact.prototype.getDLMembers=function(f,d,j){var m={list:[],more:false,isDL:{}};\nif(!this.isDL){return m\n}var i=this.getEmail();\nvar b=appCtxt.getApp(ZmApp.CONTACTS);\nvar g=b.getDL(i);\nif(!g){g=m;\ng.more=true;\nb.cacheDL(i,g)\n}d=d||ZmContact.DL_PAGE_SIZE;\nvar a=f||0;\nvar c=(f+d)-1;\nif(g.list.length>=c+1||!g.more){var h=g.list.slice(f,c+1);\nm={list:h,more:g.more||(g.list.length>c+1),isDL:g.isDL};\nthis._handleResponseGetDLMembers(a,d,j,m);\nreturn\n}if(!g.total||(f<g.total)){var l={GetDistributionListMembersRequest:{_jsns:\"urn:zimbraAccount\",offset:f,limit:d}};\nvar e=l.GetDistributionListMembersRequest;\ne.dl={_content:this.getEmail()};\nvar k=new AjxCallback(this,this._handleResponseGetDLMembers,[f,d,j]);\nappCtxt.getAppController().sendRequest({jsonObj:l,asyncMode:true,callback:k})\n}else{this._handleResponseGetDLMembers(a,d,j,m)\n}};\nZmContact.prototype._handleResponseGetDLMembers=function(d,b,m,n,a){if(a||!n.list){var j=[];\na=a||n.getResponse();\na=a.GetDistributionListMembersResponse;\nvar g=appCtxt.getApp(ZmApp.CONTACTS).getDL(this.getEmail());\nvar l=g.more=a.more;\nvar k={};\nvar c=a.dlm;\nif(c&&c.length){for(var f=0,h=c.length;\nf<h;\nf++){var e=c[f]._content;\nj.push(e);\ng.list[d+f]=e;\nif(c[f].isDL){k[e]=g.isDL[e]=true\n}}}g.total=a.total;\nvar n={list:j,more:l,isDL:k}\n}if(m){m.run(n)\n}else{return n\n}};\nZmContact.prototype.getAllDLMembers=function(d){var a={list:[],more:false,isDL:{}};\nif(!this.isDL){return a\n}var b=appCtxt.getApp(ZmApp.CONTACTS).getDL(this.getEmail());\nif(b&&!b.more){a={list:b.list.slice(),more:false,isDL:b.isDL};\nd.run(a);\nreturn\n}var c=new AjxCallback(this,this._getNextDLChunk,[d]);\nthis.getDLMembers(b?b.list.length:0,null,c)\n};\nZmContact.prototype._getNextDLChunk=function(d,a){var b=appCtxt.getApp(ZmApp.CONTACTS).getDL(this.getEmail());\nif(a.more){var c=new AjxCallback(this,this._getNextDLChunk,[d]);\nthis.getDLMembers(b.list.length,null,c)\n}else{a.list=b.list.slice();\nd.run(a)\n}};\nZmContact.getContactFromCache=function(c){var d=appCtxt.accountList.mainAccount.id;\nvar b=null;\nif(c&&c.indexOf(d+\":\")!=-1){var a=c.split(d+\":\");\nb=a&&a.length>1?appCtxt.cacheGet(a[1]):appCtxt.cacheGet(c)\n}else{b=appCtxt.cacheGet(c)\n}if(b instanceof ZmContact){return b\n}return null\n};\nZmContact.ATTR_VARIANTS={};\nZmContact.IGNORE_ATTR_VARIANT={};\nZmContact.IGNORE_ATTR_VARIANT[ZmContact.F_groups]=true;\nZmContact.initAttrVariants=function(k){var j=Object.keys(k),d=j.length,g,b,e,h=[];\nvar c=k.IGNORE_ATTR_VARIANT||{};\nfor(b=0;\nb<d;\nb++){g=j[b];\nif(g.indexOf(\"F_\")===0){e=k[g];\nif(!c[e]){h.push(e)\n}}}var f=/^([a-zA-Z]+)(\\d+)$/;\nh.sort(function(m,i){var n=m.match(f),l=i.match(f);\nif(n&&l&&n[1]===l[1]){return n[2]-l[2]\n}else{return m>i?1:(m<i?-1:0)\n}});\nvar e,a;\nfor(b=0;\nb<h.length;\nb++){e=h[b];\na=e.replace(/\\d+$/,\"\").toLowerCase();\nif(!ZmContact.ATTR_VARIANTS[a]){ZmContact.ATTR_VARIANTS[a]=[]\n}ZmContact.ATTR_VARIANTS[a].push(e)\n}};\nZmContact.initAttrVariants(ZmContact);\nZmContact.mapAttrs=function(d){var c,g,b,f={};\nfor(c in d){g=d[c];\nif(g){b=ZmContact.ATTR_VARIANTS[c.toLowerCase()];\nif(b){g=AjxUtil.toArray(g);\nvar a=Math.min(g.length,b.length),e;\nfor(e=0;\ne<a;\ne++){f[b[e]]=g[e]\n}}else{f[c]=g\n}}}return f\n};\nZmContact._AB_FIELD={firstName:ZmMsg.AB_FIELD_firstName,lastName:ZmMsg.AB_FIELD_lastName,middleName:ZmMsg.AB_FIELD_middleName,fullName:ZmMsg.AB_FIELD_fullName,jobTitle:ZmMsg.AB_FIELD_jobTitle,company:ZmMsg.AB_FIELD_company,department:ZmMsg.AB_FIELD_department,email:ZmMsg.AB_FIELD_email,email2:ZmMsg.AB_FIELD_email2,email3:ZmMsg.AB_FIELD_email3,imAddress1:ZmMsg.AB_FIELD_imAddress1,imAddress2:ZmMsg.AB_FIELD_imAddress2,imAddress3:ZmMsg.AB_FIELD_imAddress3,image:ZmMsg.AB_FIELD_image,attachment:ZmMsg.AB_FIELD_attachment,workStreet:ZmMsg.AB_FIELD_street,workCity:ZmMsg.AB_FIELD_city,workState:ZmMsg.AB_FIELD_state,workPostalCode:ZmMsg.AB_FIELD_postalCode,workCountry:ZmMsg.AB_FIELD_country,workURL:ZmMsg.AB_FIELD_URL,workPhone:ZmMsg.AB_FIELD_workPhone,workPhone2:ZmMsg.AB_FIELD_workPhone2,workFax:ZmMsg.AB_FIELD_workFax,assistantPhone:ZmMsg.AB_FIELD_assistantPhone,companyPhone:ZmMsg.AB_FIELD_companyPhone,callbackPhone:ZmMsg.AB_FIELD_callbackPhone,homeStreet:ZmMsg.AB_FIELD_street,homeCity:ZmMsg.AB_FIELD_city,homeState:ZmMsg.AB_FIELD_state,homePostalCode:ZmMsg.AB_FIELD_postalCode,homeCountry:ZmMsg.AB_FIELD_country,homeURL:ZmMsg.AB_FIELD_URL,homePhone:ZmMsg.AB_FIELD_homePhone,homePhone2:ZmMsg.AB_FIELD_homePhone2,homeFax:ZmMsg.AB_FIELD_homeFax,mobilePhone:ZmMsg.AB_FIELD_mobilePhone,pager:ZmMsg.AB_FIELD_pager,carPhone:ZmMsg.AB_FIELD_carPhone,otherStreet:ZmMsg.AB_FIELD_street,otherCity:ZmMsg.AB_FIELD_city,otherState:ZmMsg.AB_FIELD_state,otherPostalCode:ZmMsg.AB_FIELD_postalCode,otherCountry:ZmMsg.AB_FIELD_country,otherURL:ZmMsg.AB_FIELD_URL,otherPhone:ZmMsg.AB_FIELD_otherPhone,otherFax:ZmMsg.AB_FIELD_otherFax,notes:ZmMsg.notes,birthday:ZmMsg.AB_FIELD_birthday};\nZmContact._AB_FILE_AS={1:ZmMsg.AB_FILE_AS_lastFirst,2:ZmMsg.AB_FILE_AS_firstLast,3:ZmMsg.AB_FILE_AS_company,4:ZmMsg.AB_FILE_AS_lastFirstCompany,5:ZmMsg.AB_FILE_AS_firstLastCompany,6:ZmMsg.AB_FILE_AS_companyLastFirst,7:ZmMsg.AB_FILE_AS_companyFirstLast}\n}}if(AjxPackage.define(\"zimbraMail.abook.model.ZmContactList\")){ZmContactList=function(a,c,b){if(arguments.length==0){return\n}b=b||ZmItem.CONTACT;\nZmList.call(this,b,a);\nthis.isGal=(c===true);\nthis.isCanonical=false;\nthis.isLoaded=false;\nthis._app=appCtxt.getApp(ZmApp.CONTACTS);\nif(!this._app){this._emailToContact=this._phoneToContact={};\nreturn\n}this._emailToContact=this._app._byEmail;\nthis._phoneToContact=this._app._byPhone;\nthis._alwaysUpdateHashes=true\n};\nZmContactList.prototype=new ZmList;\nZmContactList.prototype.constructor=ZmContactList;\nZmContactList.prototype.isZmContactList=true;\nZmContactList.prototype.toString=function(){return\"ZmContactList\"\n};\nZmContactList.URL=\"/Contacts\";\nZmContactList.URL_ARGS={fmt:\"cf\",t:2,all:\"all\"};\nZmContactList.CONTACT_SPLIT_CHAR=\"\\u001E\";\nZmContactList.FIELD_SPLIT_CHAR=\"\\u001D\";\nZmContactList.IS_CONTACT_FIELD={id:true,l:true,d:true,fileAsStr:true,rev:true};\nZmContactList.prototype.addLoadedCallback=function(a){if(this.isLoaded){a.run();\nreturn\n}if(!this._loadedCallbacks){this._loadedCallbacks=[]\n}this._loadedCallbacks.push(a)\n};\nZmContactList.prototype._finishLoading=function(){this.isLoaded=true;\nif(this._loadedCallbacks){var a;\nwhile(a=this._loadedCallbacks.shift()){a.run()\n}}};\nZmContactList.prototype.load=function(f,a,c){this.isCanonical=true;\nvar e=new AjxCallback(this,this._handleResponseLoad,[f]);\nif(appCtxt.isExternalAccount()){if(f){f.run()\n}return\n}var b=ZmContactList.URL_ARGS;\nif(AjxEnv.isIE){b=AjxUtil.hashCopy(b);\nb.sid=ZmCsfeCommand.getSessionId()\n}var d={asyncMode:true,noBusyOverlay:true,callback:e,errorCallback:a,offlineCallback:f};\nd.restUri=AjxUtil.formatUrl({path:[\"/home/\",(c||appCtxt.getUsername()),ZmContactList.URL].join(\"\"),qsArgs:b,qsReset:true});\nappCtxt.getAppController().sendRequest(d);\nAjxDispatcher.addPackageLoadFunction(\"Contacts\",new AjxCallback(this,this._loadSharedFolders));\nZmContactList.addDlFolder()\n};\nZmContactList.prototype._loadSharedFolders=function(){var a=appCtxt.getById(ZmOrganizer.ID_ROOT);\nvar b=[];\nappCtxt.getSharedFolders(a,ZmOrganizer.ADDRBOOK,b);\nif(b.length){var d=\"\";\nfor(var c=0;\nc<b.length;\nc++){d+=b[c].createQuery()+\" or \"\n}d=d.replace(/\\sor\\s$/,\"\");\nvar g=appCtxt.getSearchController();\nvar e=g.getSearchFieldValue();\nvar f={query:d,searchFor:ZmItem.CONTACT,fetch:true,sortBy:ZmSearch.NAME_ASC,callback:null,noRender:true};\ng.search(f);\ng.setSearchField(e)\n}};\nZmContactList.prototype._handleResponseLoad=function(p,s){var q=s.getResponse();\nif(q&&typeof q!==\"string\"){q=q._data\n}var a=[];\nif(q){var r=q.split(ZmContactList.CONTACT_SPLIT_CHAR);\nvar g=new ZmBatchCommand(true,null,true);\nfor(var f=0,m=r.length;\nf<m;\nf++){var k=r[f].split(ZmContactList.FIELD_SPLIT_CHAR);\nvar l={},o={};\nvar h=[];\nvar c=false;\nfor(var e=0,d=k.length;\ne<d;\ne+=2){if(ZmContactList.IS_CONTACT_FIELD[k[e]]){l[k[e]]=k[e+1]\n}else{var n=k[e+1];\nswitch(k[e]){case ZmContact.F_memberC:h.push({type:ZmContact.GROUP_CONTACT_REF,value:n});\nc=true;\nbreak;\ncase ZmContact.F_memberG:h.push({type:ZmContact.GROUP_GAL_REF,value:n});\nc=true;\nbreak;\ncase ZmContact.F_memberI:h.push({type:ZmContact.GROUP_INLINE_REF,value:n});\nc=true;\nbreak;\ndefault:o[k[e]]=n\n}}}if(o[ZmContact.F_type]===\"group\"){o[ZmContact.F_groups]=h\n}if(c){var b=new ZmContact(l.id,this);\ng.add(new AjxCallback(b,b.load,[null,null,g,true]))\n}l._attrs=o;\nthis._addContact(l)\n}g.run()\n}this._finishLoading();\nif(p){p.run()\n}};\nZmContactList.addDlFolder=function(){if(!appCtxt.get(ZmSetting.DLS_FOLDER_ENABLED)){return\n}var c=appCtxt.getById(ZmOrganizer.ID_DLS);\nvar a=appCtxt.getById(ZmOrganizer.ID_ROOT);\nif(!a){return\n}if(c&&a.getById(ZmOrganizer.ID_DLS)){return\n}if(!c){var b={id:ZmOrganizer.ID_DLS,name:ZmMsg.distributionLists,parent:a,tree:a.tree,type:ZmOrganizer.ADDRBOOK,numTotal:null,noTooltip:true};\nc=new ZmAddrBook(b);\na.children.add(c);\nc._isDL=true\n}else{c.parent=a;\na.children.add(c)\n}};\nZmContactList.prototype.add=function(b,a){if(!b.id||!this._idHash[b.id]){this._vector.add(b,a);\nif(b.id){this._idHash[b.id]=b\n}this._updateHashes(b,true)\n}};\nZmContactList.prototype.cache=function(h,b){var e=function(){return this.id\n};\nvar d=function(i){return this._vector.containsLike(i,e)\n};\nvar g=b.sub(d,this);\nthis.getVector().merge(h,g);\nvar f=g.getArray();\nfor(var a=0;\na<f.length;\na++){var c=f[a];\nc.list=this;\nif(c.id){this._idHash[c.id]=c\n}}};\nZmContactList.prototype._addContact=function(a){a.list=this;\nthis._updateHashes(a,true);\nvar b=[],c=[];\nif(a._attrs[ZmContact.F_firstName]){b.push(a._attrs[ZmContact.F_firstName])\n}if(a._attrs[ZmContact.F_middleName]){b.push(a._attrs[ZmContact.F_middleName])\n}if(a._attrs[ZmContact.F_lastName]){b.push(a._attrs[ZmContact.F_lastName])\n}if(b.length){a._attrs[ZmContact.X_fullName]=b.join(\" \")\n}if(a._attrs[ZmContact.F_firstName]){c.push(a._attrs[ZmContact.F_firstName])\n}if(a._attrs[ZmContact.F_lastName]){c.push(a._attrs[ZmContact.F_lastName])\n}a._attrs[ZmContact.X_firstLast]=c.join(\" \");\nthis.add(a)\n};\nZmContactList.prototype._realizeContact=function(contact,idx){if(contact instanceof ZmContact){return contact\n}if(contact&&contact.type==ZmItem.CONTACT){return contact\n}var args={list:this};\nvar obj=eval(ZmList.ITEM_CLASS[this.type]);\nvar realContact=obj&&obj.createFromDom(contact,args);\nif(this.isCanonical){var a=this.getArray();\nidx=idx||this.getIndexById(contact.id);\na[idx]=realContact;\nthis._updateHashes(realContact,true);\nthis._idHash[contact.id]=realContact\n}return realContact\n};\nZmContactList.prototype.getIndexById=function(d){var b=this.getArray();\nfor(var c=0;\nc<b.length;\nc++){if(b[c].id==d){return c\n}}return null\n};\nZmContactList.prototype.getSubList=function(g,f,d){if(d&&this.isCanonical){var l=[];\nvar j=this.getArray();\nvar b=0;\nthis.setHasMore(false);\nfor(var h=0;\nh<j.length;\nh++){j[h]=this._realizeContact(j[h],h);\nvar c=appCtxt.getById(j[h].folderId);\nif(c&&c.nId==ZmOrganizer.normalizeId(d)){if(b>=g){if(l.length==f){this.setHasMore(true);\nbreak\n}l.push(j[h])\n}b++\n}}return AjxVector.fromArray(l)\n}else{var e=ZmList.prototype.getSubList.call(this,g,f);\nif(e){var k=e.getArray();\nfor(var h=0;\nh<k.length;\nh++){k[h]=this._realizeContact(k[h],g+h)\n}}return e\n}};\nZmContactList.prototype.getById=function(b){if(!b||!this.isCanonical){return null\n}var a=this._idHash[b];\nreturn a?this._realizeContact(a):null\n};\nZmContactList.prototype.getContactByEmail=function(b){if(!b||!this.isCanonical){return null\n}var a=this._emailToContact[b.toLowerCase()];\nif(a){a=this._realizeContact(a);\na._lookupEmail=b;\nreturn a\n}else{return null\n}};\nZmContactList.prototype.getContactByPhone=function(a){if(!a||!this.isCanonical){return null\n}var c=this._getPhoneDigits(a);\nvar b=this._phoneToContact[c];\nif(b){b.contact=this._realizeContact(b.contact);\nreturn b\n}else{return null\n}};\nZmContactList.prototype.moveItems=function(h){h=Dwt.getParams(arguments,[\"items\",\"folder\",\"attrs\",\"outOfTrash\"]);\nh.items=AjxUtil.toArray(h.items);\nvar c=new ZmBatchCommand(true,null,true);\nvar b=new ZmBatchCommand(true,null,true);\nvar f=[];\nif(h.items[0]&&h.items[0] instanceof ZmItem){for(var d=0;\nd<h.items.length;\nd++){var a=h.items[d];\nif(a.isReadOnly()){continue\n}f.push(a)\n}}else{f=h.items\n}if(f.length>0){var e=AjxUtil.hashCopy(h);\ne.attrs=h.attrs||{};\nvar g=h.folder;\ne.attrs.l=g.isRemote()?g.getRemoteId():g.id;\ne.action=\"move\";\ne.accountName=appCtxt.multiAccounts&&appCtxt.accountList.mainAccount.name;\nif(e.folder.id==ZmFolder.ID_TRASH){e.actionTextKey=\"actionTrash\";\ne.accountName=appCtxt.multiAccounts&&h.items[0].getAccount().name\n}else{e.actionTextKey=\"actionMove\";\ne.actionArg=g.getName(false,false,true)\n}e.callback=h.outOfTrash&&new AjxCallback(this,this._handleResponseMoveItems,h);\nthis._itemAction(e)\n}};\nZmContactList.prototype._handleResponseMoveBatchCmd=function(b){var e=b.getResponse().BatchResponse.ContactActionResponse;\nvar d=e[0].action.id.split(\",\");\nfor(var c=0;\nc<d.length;\nc++){var a=appCtxt.cacheGet(d[c]);\nif(a&&a.isShared()){a.notifyDelete();\nappCtxt.cacheRemove(d[c])\n}}};\nZmContactList.prototype._handleResponseLoadMove=function(b,c){var a=new AjxCallback(this,this._itemAction,[c]);\nb.add(a);\nvar d=new AjxCallback(this,this._handleResponseMoveBatchCmd);\nb.run(d)\n};\nZmContactList.prototype._handleResponseBatchLoad=function(c,d,b,a){c.add(this._getCopyCmd(a,d))\n};\nZmContactList.prototype._getCopyCmd=function(a,d){var b=new ZmContact(null,this);\nfor(var c in a.attr){b.attr[c]=a.attr[c]\n}b.attr[ZmContact.F_folderId]=d.id;\nreturn new AjxCallback(b,b.create,[b.attr])\n};\nZmContactList.prototype.deleteItems=function(a){if(this.isGal){if(ZmContactList.deleteGalItemsAllowed(a.items)){this._deleteDls(a.items);\nreturn\n}return\n}ZmList.prototype.deleteItems.call(this,a)\n};\nZmContactList.deleteGalItemsAllowed=function(b){var f=appCtxt.createDistListAllowedDomainsMap;\nif(b.length==0){return false\n}for(var d=0;\nd<b.length;\nd++){var a=b[d];\nvar c=a.getEmail();\nvar e=c.split(\"@\")[1];\nvar g=a&&a.isDistributionList();\nif(!g||!f[e]||!a.dlInfo||!a.dlInfo.isOwner){return false\n}}return true\n};\nZmContactList.prototype._deleteDls=function(e,a){if(!a){var f=this._deleteDls.bind(this,e,true);\nthis._popupDeleteWarningDialog(f,false,e.length);\nreturn\n}var g=[];\nfor(var b=0;\nb<e.length;\nb++){var c=e[b];\nvar d=c.getEmail();\ng.push({_jsns:\"urn:zimbraAccount\",dl:{by:\"name\",_content:c.getEmail()},action:{op:\"delete\"}})\n}var j={BatchRequest:{_jsns:\"urn:zimbra\",DistributionListActionRequest:g}};\nvar h=this._deleteDlsResponseHandler.bind(this,e);\nappCtxt.getAppController().sendRequest({jsonObj:j,asyncMode:true,callback:h})\n};\nZmContactList.prototype._deleteDlsResponseHandler=function(a){if(appCtxt.getCurrentView().isZmGroupView){this.controller.popView()\n}appCtxt.setStatusMsg(a.length==1?ZmMsg.dlDeleted:ZmMsg.dlsDeleted);\nfor(var b=0;\nb<a.length;\nb++){var c=a[b];\nc.clearDlInfo();\nc._notify(ZmEvent.E_DELETE)\n}};\nZmContactList.prototype.setIsGal=function(a){this.isGal=a\n};\nZmContactList.prototype.notifyCreate=function(node){var obj=eval(ZmList.ITEM_CLASS[this.type]);\nif(obj){var item=obj.createFromDom(node,{list:this});\nvar index=this._sortIndex(item);\nvar listSize=this.size();\nvar visible=false;\nif(index<listSize||listSize==0||(index==listSize&&!this._hasMore)){this.add(item,index);\nthis.createLocal(item);\nvisible=true\n}this._notify(ZmEvent.E_CREATE,{items:[item],sortIndex:index,visible:visible})\n}};\nZmContactList.prototype.moveLocal=function(b,a){if(!this.isCanonical){ZmList.prototype.moveLocal.call(this,b,a)\n}if(a==ZmFolder.ID_TRASH){for(var c=0;\nc<b.length;\nc++){this._updateHashes(b[c],false)\n}}};\nZmContactList.prototype.deleteLocal=function(a){ZmList.prototype.deleteLocal.call(this,a);\nfor(var b=0;\nb<a.length;\nb++){this._updateHashes(a[b],false)\n}};\nZmContactList.prototype.modifyLocal=function(e,d){if(d){this._evt.items=d.items=[e];\nthis._evt.item=d.contact;\nthis._notify(ZmEvent.E_MODIFY,d)\n}var a=d.contact;\nif(this.isCanonical||a.attr[ZmContact.F_email]!=d.oldAttr[ZmContact.F_email]){var f=new ZmContact(null,this);\nf.id=d.contact.id;\nf.attr=d.oldAttr;\nthis._updateHashes(f,false);\nthis._updateHashes(a,true)\n}if(d.fileAsChanged){this.remove(a);\nvar b=this._sortIndex(a);\nvar c=this.size();\nif(b<c||c==0||(b==c&&!this._hasMore)){this.add(a,b)\n}}if(a.addrbook&&(a.addrbook.id!=a.folderId)){a.addrbook=appCtxt.getById(a.folderId)\n}};\nZmContactList.prototype.createLocal=function(a){this._updateHashes(a,true)\n};\nZmContactList.prototype._updateHashes=function(b,g){this._app.updateCache(b,g);\nfor(var d=0;\nd<ZmContact.EMAIL_FIELDS.length;\nd++){var h=ZmContact.EMAIL_FIELDS[d];\nfor(var e=1;\ntrue;\ne++){var c=ZmContact.getAttributeName(h,e);\nvar a=ZmContact.getAttr(b,c);\nif(!a){break\n}if(g){this._emailToContact[a.toLowerCase()]=b\n}else{delete this._emailToContact[a.toLowerCase()]\n}}}if(appCtxt.get(ZmSetting.VOICE_ENABLED)||this._alwaysUpdateHashes){for(var d=0;\nd<ZmContact.PHONE_FIELDS.length;\nd++){var h=ZmContact.PHONE_FIELDS[d];\nfor(var e=1;\ntrue;\ne++){var c=ZmContact.getAttributeName(h,e);\nvar a=ZmContact.getAttr(b,c);\nif(!a){break\n}var f=this._getPhoneDigits(a);\nif(f){if(g){this._phoneToContact[a]={contact:b,field:c}\n}else{delete this._phoneToContact[a]\n}}}}}};\nZmContactList.prototype._getPhoneDigits=function(a){return a.replace(/[^\\d]/g,\"\")\n};\nZmContactList.prototype._sortIndex=function(b){var c=this._vector.getArray();\nfor(var d=0;\nd<c.length;\nd++){if(ZmContact.compareByFileAs(c[d],b)>0){return d\n}}return c.length\n};\nZmContactList.prototype.getIdHash=function(){return this._idHash\n};\nZmContactList.prototype._handleResponseModifyItem=function(b,a){}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmResource\")){ZmResource=function(c,b,a){c=c?c:Dwt.getNextId();\nZmContact.call(this,c,b,ZmItem.RESOURCE);\nthis.resType=a\n};\nZmResource.F_capacity=\"zimbraCalResCapacity\";\nZmResource.F_contactMail=\"zimbraCalResContactEmail\";\nZmResource.F_locationName=\"zimbraCalResLocationDisplayName\";\nZmResource.F_mail=\"email\";\nZmResource.F_name=\"fullName\";\nZmResource.F_type=\"zimbraCalResType\";\nZmResource.F_description=\"description\";\nZmResource.ATTR_LOCATION=\"Location\";\nZmResource.ATTR_EQUIPMENT=\"Equipment\";\nZmContact.initAttrVariants(ZmResource);\nZmResource.createFromDom=function(c,b){var d=new ZmResource(c.id,b.list);\nd._loadFromDom(c);\nd.resType=(d.getAttr(ZmResource.F_type)==ZmResource.ATTR_LOCATION)?ZmCalBaseItem.LOCATION:ZmCalBaseItem.EQUIPMENT;\nif(!d.list){var a=appCtxt.getApp(ZmApp.CALENDAR);\nd.list=(d.resType==ZmCalBaseItem.LOCATION)?a.getLocations():a.getEquipment()\n}return d\n};\nZmResource.prototype=new ZmContact;\nZmResource.prototype.constructor=ZmResource;\nZmResource.prototype.toString=function(){return\"ZmResource\"\n};\nZmResource.prototype.isLocation=function(){return(this.resType==ZmCalBaseItem.LOCATION)\n};\nZmResource.prototype.getEmail=function(){var a=this.getAttr(ZmResource.F_mail);\nreturn a instanceof Array?a[0]:a\n};\nZmResource.prototype.getFullName=function(){return(this.getAttr(ZmResource.F_name)||this.getAttr(ZmResource.F_locationName))\n};\nZmResource.prototype.initFromEmail=function(a){if(a instanceof AjxEmailAddress){this.setAttr(ZmResource.F_mail,a.getAddress());\nthis.setAttr(ZmResource.F_name,a.getName())\n}else{this.setAttr(ZmResource.F_mail,a)\n}};\nZmResource.prototype.getAttendeeText=function(d,c){var g=\"\";\nvar b=this.getFullName();\nvar a=this._lookupEmail||this.getEmail();\nif(c){g=b||a||\"\"\n}else{var f=new AjxEmailAddress(a,null,b);\ng=f.toString()\n}return g\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.model.ZmResourceList\")){ZmResourceList=function(a,b){ZmContactList.call(this,b,true,ZmItem.RESOURCE);\nthis.resType=a;\nthis._nameToResource={};\nthis._emailToResource={};\nthis._app=appCtxt.getApp(ZmApp.CALENDAR)\n};\nZmResourceList.ATTRS=[ZmResource.F_name,ZmResource.F_mail,ZmResource.F_type,ZmResource.F_locationName,ZmResource.F_capacity,ZmResource.F_contactMail,ZmResource.F_description];\nZmResourceList.prototype=new ZmContactList;\nZmResourceList.prototype.constructor=ZmResourceList;\nZmResourceList.prototype.toString=function(){return\"ZmResourceList\"\n};\nZmResourceList.prototype.load=function(a){var c=[];\nvar d=(this.resType==ZmCalBaseItem.LOCATION)?ZmResource.ATTR_LOCATION:ZmResource.ATTR_EQUIPMENT;\nc.push({attr:ZmResource.F_type,op:\"eq\",value:d});\nvar e={conds:c,join:ZmSearch.JOIN_OR,attrs:ZmResourceList.ATTRS};\nif(a){var b=new ZmSearch(e);\nb.execute({callback:new AjxCallback(this,this._handleResponseLoad),batchCmd:a})\n}else{if(appCtxt.isOffline){if(appCtxt.isZDOnline()){this.searchCalResources(e)\n}}else{this.searchCalResources(e)\n}}};\nZmResourceList.prototype.searchCalResources=function(e){var l=AjxSoapDoc.create(\"SearchCalendarResourcesRequest\",\"urn:zimbraAccount\");\nvar a=l.getMethod();\nif(e.attrs){AjxUtil.arrayRemove(e.attrs,\"fullName\");\na.setAttribute(\"attrs\",e.attrs.join(\",\"))\n}var j=l.set(\"searchFilter\");\nif(e.conds&&e.conds.length){var g=l.set(\"conds\",null,j);\nif(e.join==ZmSearch.JOIN_OR){g.setAttribute(\"or\",1)\n}for(var f=0;\nf<e.conds.length;\nf++){var k=e.conds[f];\nif(k.attr==\"fullName\"&&k.op==\"has\"){var c=l.set(\"name\",k.value)\n}else{var b=l.set(\"cond\",null,g);\nb.setAttribute(\"attr\",k.attr);\nb.setAttribute(\"op\",k.op);\nb.setAttribute(\"value\",k.value)\n}}}var d=appCtxt.getAppController().sendRequest({soapDoc:l,asyncMode:false,timeout:e.timeout,noBusyOverlay:e.noBusyOverlay});\nvar n=new ZmCsfeResult(d,false);\nvar m=new ZmSearch(e);\nm.isCalResSearch=true;\nvar h=new ZmSearchResult(m);\nh.set(d.SearchCalendarResourcesResponse);\nn.set(h);\nthis._handleResponseLoad(n)\n};\nZmResourceList.prototype._handleResponseLoad=function(b){var f=b.getResponse();\nthis._vector=f.getResults(ZmItem.RESOURCE).getVector();\nvar c=this._vector.getArray();\nfor(var d=0;\nd<c.length;\nd++){var e=c[d];\nthis._updateHashes(e);\nthis._idHash[e.id]=e\n}this.isLoaded=true;\nthis._galAutocompleteEnabled=false\n};\nZmResourceList.prototype._updateHashes=function(c){this._app.updateResourceCache(c);\nvar b=c.getFullName();\nif(b){this._nameToResource[b.toLowerCase()]=c\n}var a=c.getEmail();\nif(a){this._emailToResource[a.toLowerCase()]=c\n}};\nZmResourceList.prototype.addFromDom=function(b,a){ZmList.prototype.addFromDom.call(this,b,a)\n};\nZmResourceList.prototype.getResourceByName=function(a){if(!a||!this.isCanonical){return null\n}return this._nameToResource[a.toLowerCase()]\n};\nZmResourceList.prototype.getResourceByEmail=function(a){if(!a||!this.isCanonical){return null\n}return this._emailToResource[a.toLowerCase()]\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.view.ZmApptViewHelper\")){ZmApptViewHelper=function(){};\nZmApptViewHelper.REPEAT_OPTIONS=[{label:ZmMsg.none,value:\"NON\",selected:true},{label:ZmMsg.everyDay,value:\"DAI\",selected:false},{label:ZmMsg.everyWeek,value:\"WEE\",selected:false},{label:ZmMsg.everyMonth,value:\"MON\",selected:false},{label:ZmMsg.everyYear,value:\"YEA\",selected:false},{label:ZmMsg.custom,value:\"CUS\",selected:false}];\nZmApptViewHelper.SHOWAS_OPTIONS=[{label:ZmMsg.free,value:\"F\",selected:false},{label:ZmMsg.organizerTentative,value:\"T\",selected:false},{label:ZmMsg.busy,value:\"B\",selected:true},{label:ZmMsg.outOfOffice,value:\"O\",selected:false}];\nZmApptViewHelper.getShowAsOptionLabel=function(c){for(var a=0;\na<ZmApptViewHelper.SHOWAS_OPTIONS.length;\na++){var b=ZmApptViewHelper.SHOWAS_OPTIONS[a];\nif(b.value==c){return b.label\n}}};\nZmApptViewHelper.getDateInfo=function(b,c){c.startDate=b._startDateField.value;\nc.endDate=b._endDateField.value;\nvar a=b._tzoneSelect||b._tzoneSelectStart;\nc.timezone=a?a.getValue():\"\";\nif(b._allDayCheckbox&&b._allDayCheckbox.checked){c.showTime=false;\nc.startTimeStr=c.endTimeStr=null;\nc.startHourIdx=c.startMinuteIdx=c.startAmPmIdx=c.endHourIdx=c.endMinuteIdx=c.endAmPmIdx=null;\nc.isAllDay=true\n}else{c.showTime=true;\nif(b._startTimeSelect instanceof DwtTimeSelect){c.startHourIdx=b._startTimeSelect.getSelectedHourIdx();\nc.startMinuteIdx=b._startTimeSelect.getSelectedMinuteIdx();\nc.startAmPmIdx=b._startTimeSelect.getSelectedAmPmIdx();\nc.endHourIdx=b._endTimeSelect.getSelectedHourIdx();\nc.endMinuteIdx=b._endTimeSelect.getSelectedMinuteIdx();\nc.endAmPmIdx=b._endTimeSelect.getSelectedAmPmIdx()\n}else{c.startHourIdx=c.startMinuteIdx=c.startAmPmIdx=c.endHourIdx=c.endMinuteIdx=c.endAmPmIdx=null\n}if(b._startTimeSelect instanceof DwtTimeInput){c.startTimeStr=b._startTimeSelect.getTimeString();\nc.endTimeStr=b._endTimeSelect.getTimeString()\n}else{c.startTimeStr=c.endTimeStr=null\n}c.isAllDay=false\n}};\nZmApptViewHelper.handleDateChange=function(b,a,j,g,c){var d=false;\nvar h=AjxDateUtil.simpleParseDateStr(b.value);\nvar e=AjxDateUtil.simpleParseDateStr(a.value);\nif(j){if(!g){if(h==null||isNaN(h)){h=new Date()\n}b.value=AjxDateUtil.simpleComputeDateStr(h)\n}if(e.valueOf()<h.valueOf()){a.value=b.value\n}else{if(c!=null){var i=e.getTime()-c.getTime();\nvar f=new Date(h.getTime()+i);\na.value=AjxDateUtil.simpleComputeDateStr(f)\n}}d=true\n}else{if(!g){if(e==null||isNaN(e)){e=new Date()\n}a.value=AjxDateUtil.simpleComputeDateStr(e)\n}if(h.valueOf()>e.valueOf()){b.value=a.value;\nd=true\n}}return d\n};\nZmApptViewHelper.getApptToolTipText=function(e,d){if(e._toolTip){return e._toolTip\n}var b=ZmAppt.quickClone(e);\nvar j=b.getOrganizer();\nvar i=b.getSentBy();\nvar h=appCtxt.get(ZmSetting.USERNAME);\nif(i||(j&&j!=h)){j=(b.message&&b.message.invite&&b.message.invite.getOrganizerName())||j;\nif(i){var g=appCtxt.getApp(ZmApp.CONTACTS);\nvar f=g&&g.getContactByEmail(i);\ni=(f&&f.getFullName())||i\n}}else{j=null;\ni=null\n}var c={appt:b,cal:(b.folderId!=ZmOrganizer.ID_CALENDAR&&d)?d.getCalendar():null,organizer:j,sentBy:i,when:b.getDurationText(false,false),location:b.getLocation(),width:\"250\",hideAttendees:true};\nvar a=e._toolTip=AjxTemplate.expand(\"calendar.Appointment#Tooltip\",c);\nreturn a\n};\nZmApptViewHelper.getDayToolTipText=function(t,s,j,a,e,d,k){if(!e){e=ZmMsg.noAppts\n}var g=new AjxBuffer();\nvar p=DwtCalendar.getDateFullFormatter();\nvar v=p.format(t);\ng.append(\"<div>\");\ng.append(\"<table cellpadding='0' cellspacing='0' border='0'>\");\nif(!a){g.append(\"<tr><td><div class='calendar_tooltip_month_day_label'>\",v,\"</div></td></tr>\")\n}g.append(\"<tr><td>\");\ng.append(\"<table cellpadding='1' cellspacing='0' border='0'>\");\nvar h=s?s.size():0;\nvar r=true;\nvar f=t.getTime();\nfor(var q=0;\nq<h;\nq++){var l=s.get(q);\nvar b=l.isAllDayEvent();\nif(b||k){var m=new Date(l.startDate.getTime());\nm.setHours(0,0,0,0);\nif(m.getTime()!=f){continue\n}}if(b&&!k){r=false;\nif(!d&&l.toString()==\"ZmAppt\"){g.append(\"<tr><td><div class=appt>\");\ng.append(ZmApptViewHelper.getApptToolTipText(l,j));\ng.append(\"</div></td></tr>\")\n}else{var c=AjxEnv.isIE?\"width:500px;\":\"min-width:300px;\";\ng.append(\"<tr><td><div style='\"+c+\"' class=appt>\");\ng.append(ZmApptViewHelper._allDayItemHtml(l,Dwt.getNextId(),j,true,true));\ng.append(\"</div></td></tr>\")\n}}else{r=false;\nif(!d&&l.toString()==\"ZmAppt\"){g.append(\"<tr><td><div class=appt>\");\ng.append(ZmApptViewHelper.getApptToolTipText(l,j));\ng.append(\"</div></td></tr>\")\n}else{var o=ZmCalendarApp.COLORS[j.getCalendarColor(l.folderId)];\nvar u=l.status==ZmCalBaseItem.PSTATUS_NEEDS_ACTION;\ng.append(\"<tr><td class='calendar_month_day_item'><div class='\",o,u?\"DarkC\":\"C\",\"'>\");\nif(u){g.append(\"<b>\")\n}var n;\nif(b){n=l._orig.getDurationText(false,false,true)\n}else{n=k?l._orig.getDurationText(false,false,true):l.getDurationText(false,false)\n}g.append(n);\nif(n!=\"\"){g.append(\"&nbsp;\");\nif(b){g.append(\"-&nbsp\")\n}}g.append(AjxStringUtil.htmlEncode(l.getName()));\nif(u){g.append(\"</b>\")\n}g.append(\"</div>\");\ng.append(\"</td></tr>\")\n}}}if(r){g.append(\"<tr><td>\"+e+\"</td></tr>\")\n}g.append(\"</table>\");\ng.append(\"</td></tr></table>\");\ng.append(\"</div>\");\nreturn g.toString()\n};\nZmApptViewHelper.populateFolderSelect=function(n,a,q,l){var r=ZmOrganizer.ITEM_ORGANIZER[l.type];\nvar k=[];\nvar e;\nvar f=appCtxt.accountList.visibleAccounts;\nfor(var j=0;\nj<f.length;\nj++){var p=f[j];\nvar g=ZmApp.SETTING[ZmItem.APP[l.type]];\nif((appCtxt.isOffline&&p.isMain)||!appCtxt.get(g,null,p)){continue\n}e=appCtxt.getFolderTree(p);\nk=k.concat(e.getByType(r))\n}if(appCtxt.isOffline){e=appCtxt.getFolderTree(appCtxt.accountList.mainAccount);\nk=k.concat(e.getByType(r))\n}n.clearOptions();\nfor(var j=0;\nj<k.length;\nj++){var c=k[j];\nvar p=c.getAccount();\nif(c.noSuchFolder||c.isFeed()||(c.link&&c.isReadOnly())||c.isInTrash()){continue\n}if(appCtxt.multiAccounts&&c.nId==ZmOrganizer.ID_CALENDAR&&p.isCalDavBased()){continue\n}var d=c.link?c.getRemoteId():c.id;\nq[d]=c.owner;\nif(c.isRemote()&&!c.owner&&c.parent&&c.parent.isRemote()){q[d]=c.parent.getOwner()\n}var h=((l.folderId==c.id)||(l.folderId==d));\nvar o=appCtxt.multiAccounts?p.getIcon():c.getIconWithColor();\nvar b=AjxStringUtil.htmlDecode(appCtxt.multiAccounts?([c.getName(),\" (\",p.getDisplayName(),\")\"].join(\"\")):c.getName());\nvar m=new DwtSelectOption(d,h,b,null,null,o);\nn.addOption(m,h)\n}ZmApptViewHelper.folderSelectResize(n)\n};\nZmApptViewHelper.getAttendeeFromItem=function(k,h,b,d,e){if(!k||!h){return null\n}if(h==ZmCalBaseItem.LOCATION&&!ZmApptViewHelper._locations){if(!appCtxt.get(ZmSetting.GAL_ENABLED)){return null\n}var f=ZmApptViewHelper._locations=appCtxt.getApp(ZmApp.CALENDAR).getLocations();\nif(!f.isLoaded){f.load()\n}}if(h==ZmCalBaseItem.EQUIPMENT&&!ZmApptViewHelper._equipment){if(!appCtxt.get(ZmSetting.GAL_ENABLED)){return null\n}var a=ZmApptViewHelper._equipment=appCtxt.getApp(ZmApp.CALENDAR).getEquipment();\nif(!a.isLoaded){a.load()\n}}var i=null;\nif(k.type==ZmItem.CONTACT||k.type==ZmItem.GROUP||k.type==ZmItem.RESOURCE){i=k\n}else{if(k instanceof AjxEmailAddress){var g=k.getAddress();\ni=ZmApptViewHelper._getAttendeeFromAddr(g,h);\nif(i&&(h===ZmCalBaseItem.PERSON||h===ZmCalBaseItem.GROUP)){i=AjxUtil.createProxy(i);\ni._inviteAddress=g;\ni.getEmail=function(){return this._inviteAddress||this.constructor.prototype.getEmail.apply(this)\n}\n}if(!e&&!i&&!d){if(h===ZmCalBaseItem.PERSON){i=new ZmContact(null,null,ZmItem.CONTACT)\n}else{if(h===ZmCalBaseItem.GROUP){i=new ZmContact(null,null,ZmItem.GROUP)\n}else{i=new ZmResource(h)\n}}i.initFromEmail(k,true)\n}i.canExpand=k.canExpand;\nvar j=window.parentAppCtxt||window.appCtxt;\nj.setIsExpandableDL(g,i.canExpand)\n}else{if(typeof k==\"string\"){k=AjxStringUtil.trim(k);\nk=k.replace(/;$/,\"\");\nvar c=AjxEmailAddress.parse(k);\nif(c){var g=c.getAddress();\ni=ZmApptViewHelper._getAttendeeFromAddr(g,h);\nif(!e&&!i&&!d){if(h===ZmCalBaseItem.PERSON||h===ZmCalBaseItem.FORWARD){i=new ZmContact(null,null,ZmItem.CONTACT)\n}else{if(h===ZmCalBaseItem.GROUP){i=new ZmContact(null,null,ZmItem.GROUP)\n}else{if(h===ZmCalBaseItem.LOCATION){i=new ZmResource(null,ZmApptViewHelper._locations,ZmCalBaseItem.LOCATION)\n}else{if(h===ZmCalBaseItem.EQUIPMENT){i=new ZmResource(null,ZmApptViewHelper._equipment,ZmCalBaseItem.EQUIPMENT)\n}}}}i.initFromEmail(c,true)\n}else{if(i&&(h===ZmCalBaseItem.PERSON||h===ZmCalBaseItem.GROUP)){i._inviteAddress=g;\ni.getEmail=function(){return this._inviteAddress||this.constructor.prototype.getEmail.apply(this)\n}\n}}}}}}return i\n};\nZmApptViewHelper._getAttendeeFromAddr=function(d,b){var a=null;\nif(b===ZmCalBaseItem.PERSON||b===ZmCalBaseItem.GROUP||b===ZmCalBaseItem.FORWARD){var c=appCtxt.getApp(ZmApp.CONTACTS);\na=c&&c.getContactByEmail(d)\n}else{if(b==ZmCalBaseItem.LOCATION){a=ZmApptViewHelper._locations.getResourceByEmail(d)\n}else{if(b==ZmCalBaseItem.EQUIPMENT){a=ZmApptViewHelper._equipment.getResourceByEmail(d)\n}}}return a\n};\nZmApptViewHelper.getOrganizerEmail=function(a,d){var b=a?a:appCtxt.get(ZmSetting.USERNAME,null,d);\nvar c=(b==appCtxt.get(ZmSetting.USERNAME,null,d))?appCtxt.get(ZmSetting.DISPLAY_NAME,null,d):null;\nreturn new AjxEmailAddress(b,null,c)\n};\nZmApptViewHelper.getAddressEmail=function(d,a){var e=d?d:appCtxt.get(ZmSetting.USERNAME);\nvar f;\nif(d==appCtxt.get(ZmSetting.USERNAME)){f=appCtxt.get(ZmSetting.DISPLAY_NAME)\n}else{var c=appCtxt.getIdentityCollection(),b=c?c.getIdentityBySendAddress(e):\"\";\nif(b){f=b.sendFromDisplay\n}}return new AjxEmailAddress(e,null,f)\n};\nZmApptViewHelper.getAttendeesString=function(e,f,d,b){if(!(e&&e.length)){return\"\"\n}var h=[];\nfor(var c=0;\nc<e.length;\nc++){var k=e[c];\nvar j=ZmApptViewHelper.getAttendeesText(k,f);\nif(d&&e.length==1){var g=k.getAttr(ZmResource.F_locationName);\nif(g){j=[j,\" (\",g,\")\"].join(\"\")\n}}if(b){j+=\" \"+(k.getParticipantRole()||ZmCalItem.ROLE_REQUIRED)\n}h.push(j)\n}return h.join(ZmAppt.ATTENDEES_SEPARATOR)\n};\nZmApptViewHelper.getAttendeesText=function(b,d,c){var a=b.getLookupEmail(true);\nif(a){return a.toString(c||(d&&d!==ZmCalBaseItem.PERSON&&d!==ZmCalBaseItem.GROUP))\n}return b.getAttendeeText(d,c)\n};\nZmApptViewHelper.getAttendeesByRoleCollapsed=function(g,j,c,f,k){if(!(g&&g.length)){return\"\"\n}var a=ZmApptViewHelper.getAttendeesArrayByRole(g,c);\nvar e=[];\nfor(var d=0;\nd<a.length;\nd++){var h=a[d];\ne.push(new AjxEmailAddress(h.getEmail(),j,h.getFullName(),h.getFullName()))\n}var l={};\nl.shortAddress=appCtxt.get(ZmSetting.SHORT_ADDRESS);\nvar b=ZmMailMsgView.getAddressesFieldHtmlHelper(e,l,c,f,k);\nreturn b.html\n};\nZmApptViewHelper.getAttendeesByRole=function(f,c,g,e){if(!(f&&f.length)){return\"\"\n}var b=[];\nvar d=ZmApptViewHelper.getAttendeesArrayByRole(f,g);\nfor(var a=0;\na<d.length;\na++){if(e&&a>e){b.push(\" ...\");\nbreak\n}if(a>0){b.push(ZmAppt.ATTENDEES_SEPARATOR)\n}b.push(d[a].getAttendeeText(c))\n}return b.join(\"\")\n};\nZmApptViewHelper.getAttendeesArrayByRole=function(g,h,f){if(!(g&&g.length)){return[]\n}var c=[];\nfor(var d=0;\nd<g.length;\nd++){var b=g[d];\nvar e=b.getParticipantRole()||ZmCalItem.ROLE_REQUIRED;\nif(e===h){c.push(b)\n}}return c\n};\nZmApptViewHelper._allDayItemHtml=function(c,o,n,g,i){var r=c.ptst==ZmCalBaseItem.PSTATUS_NEEDS_ACTION;\nvar h=c.ptst==ZmCalBaseItem.PSTATUS_ACCEPT;\nvar l=c.getFolder();\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nvar d=c.getVisibleTags();\nvar s=i?c.getTagImageFromNames(d):null;\nvar p=r?ZmCalBaseItem.PSTATUS_NEEDS_ACTION:c.fba;\nvar m=ZmApptViewHelper.getApptColor(r,l,d,\"header\");\nvar j=ZmCalBaseView._toColorsCss(m.appt);\nvar k=ZmApptViewHelper.getApptColor(r,l,d,\"body\");\nvar b=ZmCalBaseView._toColorsCss(k.appt);\nvar e=g?\"\":\"border-left:0;\";\nvar f=i?\"\":\"border-right:0;\";\nvar a=r?\"_new\":\"\";\nvar q={id:o,headerStyle:j,bodyStyle:b,newState:a,name:g?AjxStringUtil.htmlEncode(c.getName()):\"&nbsp;\",starttime:c.getDurationText(true,true),endtime:(!c._fanoutLast&&(c._fanoutFirst||(c._fanoutNum>0)))?\"\":ZmCalBaseItem._getTTHour(c.endDate),location:AjxStringUtil.htmlEncode(c.getLocation()),status:c.isOrganizer()?\"\":c.getParticipantStatusStr(),icon:g&&c.isPrivate()?\"ReadOnly\":null,showAsColor:g?ZmApptViewHelper._getShowAsColorFromId(p):\"\",showAsClass:g?\"\":\"appt_allday\"+a+\"_name\",boxBorder:ZmApptViewHelper.getBoxBorderFromId(p),borderLeft:e,borderRight:f,tagIcon:s};\nZmApptViewHelper.setupCalendarColor(i,m,d,q,\"headerStyle\",null,1,1);\nreturn AjxTemplate.expand(\"calendar.Calendar#calendar_appt_allday\",q)\n};\nZmApptViewHelper._getShowAsColorFromId=function(c){var a=\"#4AA6F1\";\nswitch(c){case ZmCalBaseItem.PSTATUS_NEEDS_ACTION:a=\"#FF3300\";\nbreak;\ncase\"F\":a=\"#FFFFFF\";\nbreak;\ncase\"B\":a=\"#4AA6F1\";\nbreak;\ncase\"T\":a=\"#BAE0E3\";\nbreak;\ncase\"O\":a=\"#7B5BAC\";\nbreak\n}var b=Dwt.createLinearGradientCss(\"#FFFFFF\",a,\"v\");\nif(!b){b=\"background-color: \"+a+\";\"\n}return b\n};\nZmApptViewHelper.getBoxBorderFromId=function(a){switch(a){case\"F\":return\"ZmSchedulerApptBorder-free\";\ncase ZmCalBaseItem.PSTATUS_NEEDS_ACTION:case\"B\":return\"ZmSchedulerApptBorder-busy\";\ncase\"T\":return\"ZmSchedulerApptBorder-tentative\";\ncase\"O\":return\"ZmSchedulerApptBorder-outOfOffice\"\n}return\"ZmSchedulerApptBorder-busy\"\n};\nZmApptViewHelper.filterAttendeesByRole=function(e,f){var b=[];\nfor(var c=0;\nc<e.length;\nc++){var a=e[c];\nvar d=a.getParticipantRole()||ZmCalItem.ROLE_REQUIRED;\nif(d==f){b.push(a)\n}}return b\n};\nZmApptViewHelper.getApptColor=function(f,b,g,d){var a=ZmCalBaseView._getColors(b.rgb||ZmOrganizer.COLOR_VALUES[b.color]);\nvar i=f?a.deeper[d]:a.standard[d];\nvar c=i;\nif(g&&(g.length==1)){var e=appCtxt.getAccountTagList(b);\nvar h=e.getByNameOrRemote(g[0]);\nif(h){c={bgcolor:h.getColor()}\n}}return{calendar:i,appt:c}\n};\nZmApptViewHelper.setupCalendarColor=function(j,a,i,c,f,k,h,d,b){var g=Dwt.createLinearGradientCss(\"#FFFFFF\",a.appt.bgcolor,\"v\");\nif(g){c[f]=g;\nif(k){c[k]=null\n}}if(j&&i&&(i.length==1)){if(!g){var e=c.tagIcon.match(AjxImg.RE_COLOR);\nif(e){c.tagIcon=(e&&e[1])+\"Overlay\"\n}}c.peelIcon=\"Peel,color=\"+a.calendar.bgcolor;\nc.peelTop=h;\nc.peelRight=d\n}};\nZmApptViewHelper.getAttachListHtml=function(h,l,p,k){var g=appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI);\nvar n=ZmMimeTable.getInfo(l.ct);\nvar o=n?n.image:\"GenericDoc\";\nvar q=l.s;\nvar d;\nif(q!=null){if(q<1024){d=q+\" B\"\n}else{if(q<1024^2){d=Math.round((q/1024)*10)/10+\" KB\"\n}else{d=Math.round((q/(1024*1024))*10)/10+\" MB\"\n}}}var j=[];\nvar f=0;\nj[f++]=\"<table border=0 cellpadding=0 cellspacing=0><tr>\";\nif(p){j[f++]=\"<td width=1%><input type='checkbox' checked value='\";\nj[f++]=l.part;\nj[f++]=\"' name='\";\nj[f++]=ZmCalItem.ATTACHMENT_CHECKBOX_NAME;\nj[f++]=\"'></td>\"\n}var c=[\"href='\",g,\"&id=\",h.invId,\"&amp;part=\",l.part].join(\"\");\nj[f++]=\"<td width=20><a target='_blank' class='AttLink' \";\nif(k){var e=k(l.part,ZmCalItem.ATT_LINK_IMAGE);\nj[f++]=\"id='\";\nj[f++]=e;\nj[f++]=\"' \"\n}j[f++]=c;\nj[f++]=\"'>\";\nj[f++]=AjxImg.getImageHtml(o);\nj[f++]=\"</a></td><td><a target='_blank' class='AttLink' \";\nif(appCtxt.get(ZmSetting.MAIL_ENABLED)&&l.ct==ZmMimeTable.MSG_RFC822){j[f++]=\" href='javascript:;' onclick='ZmCalItemView.rfc822Callback(\";\nj[f++]='\"';\nj[f++]=h.invId;\nj[f++]='\"';\nj[f++]=',\"';\nj[f++]=l.part;\nj[f++]=\"\\\"); return false;'\"\n}else{j[f++]=c;\nj[f++]=\"'\"\n}if(k){var m=k(l.part,ZmCalItem.ATT_LINK_MAIN);\nj[f++]=\" id='\";\nj[f++]=m;\nj[f++]=\"'\"\n}j[f++]=\">\";\nj[f++]=AjxStringUtil.htmlEncode(l.filename);\nj[f++]=\"</a>\";\nvar b=(appCtxt.get(ZmSetting.VIEW_ATTACHMENT_AS_HTML)&&l.body==null&&ZmMimeTable.hasHtmlVersion(l.ct));\nif(d||b){j[f++]=\"&nbsp;(\";\nif(d){j[f++]=d;\nj[f++]=\") \"\n}var a=\"\";\nif(k){a=k(l.part,ZmCalItem.ATT_LINK_DOWNLOAD)\n}if(b){j[f++]=\"<a style='text-decoration:underline' target='_blank' class='AttLink' \";\nif(k){j[f++]=\"id='\";\nj[f++]=a;\nj[f++]=\"' \"\n}j[f++]=c;\nj[f++]=\"&view=html'>\";\nj[f++]=ZmMsg.preview;\nj[f++]=\"</a>&nbsp;\"\n}if(l.ct!=ZmMimeTable.MSG_RFC822){j[f++]=\"<a style='text-decoration:underline' class='AttLink' onclick='ZmZimbraMail.unloadHackCallback();' \";\nif(k){j[f++]=\" id='\";\nj[f++]=a;\nj[f++]=\"' \"\n}j[f++]=c;\nj[f++]=\"&disp=a'>\";\nj[f++]=ZmMsg.download;\nj[f++]=\"</a>\"\n}}j[f++]=\"</td></tr></table>\";\nif(!l.mid){l.mid=h.invId;\nl.label=l.filename\n}return j.join(\"\")\n};\nZmApptViewHelper.folderSelectResize=function(b){var c=b._containerEl,d,a;\nif(c){d=c.childNodes[0];\nif(d){a=d.getElementsByTagName(\"img\")[0];\nif(a){a.onload=function(){c.style.width=d.offsetWidth||\"auto\";\na.onload=\"\"\n}\n}}}};\nZmApptViewHelper.warnIfApptStartingInPast=function(b,i,g){var d=new Date(),j=new Date(new Date().setHours(0,0,0)),h=new Date(new Date(b).setHours(0,0,0)),a=new Date(b),c=false,e=false;\nif(h!==null||!isNaN(h)){if(Date.parse(h)-Date.parse(j)<0){c=true\n}if(!g){var f=(a.getTime()-d.getTime())/1000;\nif(f<0){e=true\n}}}if(c&&e){ZmApptViewHelper._toggleMeetingInPastWarning(true,i,ZmMsg.meetingInPastWarning)\n}else{if(c){ZmApptViewHelper._toggleMeetingInPastWarning(true,i,ZmMsg.meetingDateInPastWarning)\n}else{if(e){ZmApptViewHelper._toggleMeetingInPastWarning(true,i,ZmMsg.meetingTimeInPastWarning)\n}else{ZmApptViewHelper._toggleMeetingInPastWarning(false,i,\"\")\n}}}};\nZmApptViewHelper._toggleMeetingInPastWarning=function(e,b,a){var d=document.getElementById(b+\"_meetingInPastWarning\");\nvar c=document.getElementById(b+\"_meetingInPastWarningMessageText\");\nc.innerHTML=a;\nd.style.display=e?\"\":Dwt.DISPLAY_NONE;\nc.style.display=e?\"\":Dwt.DISPLAY_NONE\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.controller.ZmCalItemComposeController\")){ZmCalItemComposeController=function(a,d,b,c){if(arguments.length==0){return\n}ZmBaseController.apply(this,arguments);\nthis._elementsToHide=ZmAppViewMgr.LEFT_NAV;\nthis._onAuthTokenWarningListener=this._onAuthTokenWarningListener.bind(this);\nappCtxt.addAuthTokenWarningListener(this._onAuthTokenWarningListener)\n};\nZmCalItemComposeController.prototype=new ZmBaseController;\nZmCalItemComposeController.prototype.constructor=ZmCalItemComposeController;\nZmCalItemComposeController.prototype.isZmCalItemComposeController=true;\nZmCalItemComposeController.prototype.toString=function(){return\"ZmCalItemComposeController\"\n};\nZmCalItemComposeController.DEFAULT_TAB_TEXT=ZmMsg.appointment;\nZmCalItemComposeController.SAVE_CLOSE=\"SAVE_CLOSE\";\nZmCalItemComposeController.SEND=\"SEND\";\nZmCalItemComposeController.SAVE=\"SAVE\";\nZmCalItemComposeController.APPT_MODE=\"APPT\";\nZmCalItemComposeController.MEETING_MODE=\"MEETING\";\nZmCalItemComposeController.prototype.show=function(a,d,c){this._mode=d;\nif(this._toolbar.toString()!=\"ZmButtonToolBar\"){this._createToolBar()\n}var b=this.initComposeView();\nthis._app.pushView(this._currentViewId);\nthis._composeView.set(a,d,c);\nthis._composeView.reEnableDesignMode();\nthis._initToolbar(d);\nif(b){this._setComposeTabGroup()\n}};\nZmCalItemComposeController.prototype._preHideCallback=function(a,b){ZmController.prototype._preHideCallback.call(this);\nreturn b?true:this.popShield()\n};\nZmCalItemComposeController.prototype._preUnloadCallback=function(a){return !this._composeView.isDirty()\n};\nZmCalItemComposeController.prototype._preShowCallback=function(){return true\n};\nZmCalItemComposeController.prototype._postShowCallback=function(a,c){var b=new AjxTimedAction(this,this._setFocus);\nAjxTimedAction.scheduleAction(b,10)\n};\nZmCalItemComposeController.prototype._postHideCallback=function(){};\nZmCalItemComposeController.prototype.popShield=function(){if(!this._composeView.isDirty()){this._composeView.cleanup();\nreturn true\n}var a=this._popShield=appCtxt.getYesNoCancelMsgDialog();\na.reset();\na.setMessage(ZmMsg.askToSave,DwtMessageDialog.WARNING_STYLE);\na.registerCallback(DwtDialog.YES_BUTTON,this._popShieldYesCallback,this);\na.registerCallback(DwtDialog.NO_BUTTON,this._popShieldNoCallback,this);\na.popup(this._composeView._getDialogXY());\nreturn false\n};\nZmCalItemComposeController.prototype._onAuthTokenWarningListener=function(){try{if(this._composeView&&this._composeView.isDirty()){var a=this._composeView.getCalItem();\nreturn this._saveCalItemFoRealz(a,null,null,true)\n}}catch(b){var c=AjxUtil.isString(b)?AjxMessageFormat.format(ZmMsg.errorSavingWithMessage,errorMsg):ZmMsg.errorSaving;\nappCtxt.setStatusMsg(c,ZmStatusView.LEVEL_CRITICAL)\n}};\nZmCalItemComposeController.prototype.getItemView=function(){return this._composeView\n};\nZmCalItemComposeController.prototype.getToolbar=function(){return this._toolbar\n};\nZmCalItemComposeController.prototype.saveCalItem=function(a){};\nZmCalItemComposeController.prototype.toggleSpellCheckButton=function(b){var a=this._toolbar.getButton(ZmOperation.SPELL_CHECK);\nif(a){a.setSelected((b||false))\n}};\nZmCalItemComposeController.prototype.initComposeView=function(c){if(!this._composeView){this._composeView=this._createComposeView();\nvar a={};\na[ZmAppViewMgr.CB_PRE_HIDE]=new AjxCallback(this,this._preHideCallback);\na[ZmAppViewMgr.CB_PRE_UNLOAD]=new AjxCallback(this,this._preUnloadCallback);\na[ZmAppViewMgr.CB_POST_SHOW]=new AjxCallback(this,this._postShowCallback);\na[ZmAppViewMgr.CB_PRE_SHOW]=new AjxCallback(this,this._preShowCallback);\na[ZmAppViewMgr.CB_POST_HIDE]=new AjxCallback(this,this._postHideCallback);\nif(this._toolbar.toString()!=\"ZmButtonToolBar\"){this._createToolBar()\n}var b=this.getViewElements(null,this._composeView,this._toolbar);\nthis._app.createView({viewId:this._currentViewId,viewType:this._currentViewType,elements:b,hide:this._elementsToHide,controller:this,callbacks:a,tabParams:this._getTabParams()});\nif(c){this._composeView.preload()\n}return true\n}return false\n};\nZmCalItemComposeController.prototype._getTabParams=function(){return{id:this.tabId,image:\"CloseGray\",hoverImage:\"Close\",text:ZmCalItemComposeController.DEFAULT_TAB_TEXT,textPrecedence:76,tooltip:ZmCalItemComposeController.DEFAULT_TAB_TEXT,style:DwtLabel.IMAGE_RIGHT}\n};\nZmCalItemComposeController.prototype._createComposeView=function(){};\nZmCalItemComposeController.prototype._setComposeTabGroup=function(a){};\nZmCalItemComposeController.prototype._setFocus=function(a,b){this._restoreFocus(a,b)\n};\nZmCalItemComposeController.prototype.getKeyMapName=function(){};\nZmCalItemComposeController.prototype.handleKeyAction=function(a){switch(a){case ZmKeyMap.SAVE:this._saveListener();\nbreak;\ncase ZmKeyMap.CANCEL:this._cancelListener();\nbreak;\ncase ZmKeyMap.HTML_FORMAT:if(appCtxt.get(ZmSetting.HTML_COMPOSE_ENABLED)){var d=this._composeView.getComposeMode();\nvar c=(d==Dwt.TEXT)?Dwt.HTML:Dwt.TEXT;\nthis._formatListener(null,c);\nvar b=this._toolbar.getButton(ZmOperation.COMPOSE_OPTIONS);\nif(b){b.getMenu().checkItem(ZmHtmlEditor.VALUE,c,true)\n}}break;\ndefault:return ZmController.prototype.handleKeyAction.call(this,a);\nbreak\n}return true\n};\nZmCalItemComposeController.prototype.mapSupported=function(a){return(a==\"editor\")\n};\nZmCalItemComposeController.prototype.getTabView=function(){return this._composeView\n};\nZmCalItemComposeController.prototype.setFormatBtnItem=function(c,d){var g;\nif(d){g=d\n}else{var b=appCtxt.get(ZmSetting.HTML_COMPOSE_ENABLED);\nvar a=appCtxt.get(ZmSetting.COMPOSE_AS_FORMAT);\ng=(b&&a==ZmSetting.COMPOSE_HTML)?Dwt.HTML:Dwt.TEXT\n}var e=this._toolbar.getButton(ZmOperation.COMPOSE_OPTIONS);\nif(e){var f=e.getMenu?e.getMenu():null;\nif(f){f.checkItem(ZmHtmlEditor.VALUE,g,c)\n}}};\nZmCalItemComposeController.prototype.setOptionsBtnItem=function(c,d){var f;\nif(d){f=d\n}else{var b=appCtxt.get(ZmSetting.HTML_COMPOSE_ENABLED);\nvar a=appCtxt.get(ZmSetting.COMPOSE_AS_FORMAT);\nf=(b&&a==ZmSetting.COMPOSE_HTML)?Dwt.HTML:Dwt.TEXT\n}var e=this._toolbar.getButton(ZmOperation.COMPOSE_OPTIONS);\nif(e){e.getMenu().checkItem(ZmHtmlEditor.VALUE,f,c)\n}};\nZmCalItemComposeController.prototype._initToolbar=function(e){if(this._toolbar.toString()!=\"ZmButtonToolBar\"){this._createToolBar()\n}this.enableToolbar(true);\nvar b=(e==null||e==ZmCalItem.MODE_NEW||e==ZmCalItem.MODE_NEW_FROM_QUICKADD);\nvar d=this._toolbar.getButton(ZmOperation.CANCEL);\nif(b){d.setText(ZmMsg.cancel)\n}else{d.setText(ZmMsg.close)\n}var c=this._toolbar.getButton(ZmOperation.SAVE);\nif(ZmCalItem.FORWARD_MAPPING[e]){c.setText(ZmMsg.send)\n}var a=this._toolbar.getButton(ZmOperation.PRINT);\nif(a){a.setEnabled(!b)\n}appCtxt.notifyZimlets(\"initializeToolbar\",[this._app,this._toolbar,this,this._currentViewId],{waitUntilLoaded:true})\n};\nZmCalItemComposeController.prototype._createToolBar=function(){var e=[ZmOperation.SEND_INVITE,ZmOperation.SAVE,ZmOperation.CANCEL,ZmOperation.SEP];\nif(appCtxt.get(ZmSetting.ATTACHMENT_ENABLED)){e.push(ZmOperation.ATTACHMENT)\n}if(appCtxt.get(ZmSetting.PRINT_ENABLED)){e.push(ZmOperation.PRINT)\n}if(appCtxt.isSpellCheckerAvailable()){e.push(ZmOperation.SPELL_CHECK)\n}e.push(ZmOperation.SEP,ZmOperation.COMPOSE_OPTIONS);\nthis._toolbar=new ZmButtonToolBar({parent:this._container,buttons:e,overrides:this._getButtonOverrides(e),context:this._currentViewId,controller:this});\nthis._toolbar.addSelectionListener(ZmOperation.SAVE,new AjxListener(this,this._saveListener));\nthis._toolbar.addSelectionListener(ZmOperation.CANCEL,new AjxListener(this,this._cancelListener));\nif(appCtxt.get(ZmSetting.PRINT_ENABLED)){this._toolbar.addSelectionListener(ZmOperation.PRINT,new AjxListener(this,this._printListener))\n}if(appCtxt.get(ZmSetting.ATTACHMENT_ENABLED)){this._toolbar.addSelectionListener(ZmOperation.ATTACHMENT,new AjxListener(this,this._attachmentListener))\n}var d=this._toolbar.getButton(ZmOperation.SEND_INVITE);\nd.setVisible(false);\nvar c=this._toolbar.getButton(ZmOperation.SPELL_CHECK);\nif(c){c.setAlign(DwtLabel.IMAGE_LEFT|DwtButton.TOGGLE_STYLE)\n}var f=this._toolbar.getButton(ZmOperation.COMPOSE_OPTIONS);\nif(f){f.setVisible(false)\n}if(f&&appCtxt.get(ZmSetting.HTML_COMPOSE_ENABLED)){f.setVisible(true);\nvar a=new DwtMenu({parent:f});\nf.setMenu(a);\nvar b=new DwtMenuItem({parent:a,style:DwtMenuItem.RADIO_STYLE,id:[ZmId.WIDGET_MENU_ITEM,this._currentViewId,ZmOperation.FORMAT_HTML].join(\"_\")});\nb.setImage(\"HtmlDoc\");\nb.setText(ZmMsg.formatAsHtml);\nb.setData(ZmHtmlEditor.VALUE,Dwt.HTML);\nb.addSelectionListener(new AjxListener(this,this._formatListener));\nb=new DwtMenuItem({parent:a,style:DwtMenuItem.RADIO_STYLE,id:[ZmId.WIDGET_MENU_ITEM,this._currentViewId,ZmOperation.FORMAT_TEXT].join(\"_\")});\nb.setImage(\"GenericDoc\");\nb.setText(ZmMsg.formatAsText);\nb.setData(ZmHtmlEditor.VALUE,Dwt.TEXT);\nb.addSelectionListener(new AjxListener(this,this._formatListener))\n}this._toolbar.addSelectionListener(ZmOperation.SPELL_CHECK,new AjxListener(this,this._spellCheckListener))\n};\nZmCalItemComposeController.prototype.showErrorMessage=function(b){var a=appCtxt.getMsgDialog();\na.reset();\nvar c=b?AjxMessageFormat.format(ZmMsg.errorSavingWithMessage,b):ZmMsg.errorSaving;\na.setMessage(c,DwtMessageDialog.CRITICAL_STYLE);\na.popup();\nthis.enableToolbar(true)\n};\nZmCalItemComposeController.prototype._saveCalItemFoRealz=function(a,c,d,e){var g=this._composeView.areRecurringChangesDirty();\nif(this._composeView.isDirty()||g||e){if(a.getFolder()&&a.getFolder().noSuchFolder){var f=AjxMessageFormat.format(ZmMsg.errorInvalidFolder,a.getFolder().name);\nthis.showErrorMessage(f);\nreturn false\n}if(this._composeView.isReminderOnlyChanged()){a.setMailNotificationOption(false)\n}var h=new AjxCallback(this,this._handleResponseSave,a);\nvar b=new AjxCallback(this,this._handleErrorSave,a);\nthis._doSaveCalItem(a,c,h,b,d)\n}else{if(this._action==ZmCalItemComposeController.SAVE&&!this._composeView.isDirty()){this.enableToolbar(true)\n}if(this.isCloseAction()){this._composeView.cleanup();\nthis.closeView()\n}}};\nZmCalItemComposeController.prototype._doSaveCalItem=function(a,c,e,b,d){if(this._action==ZmCalItemComposeController.SEND){a.send(c,e,b,d)\n}else{a.save(c,e,b,d)\n}};\nZmCalItemComposeController.prototype.isCloseAction=function(){return(this._action==ZmCalItemComposeController.SEND||this._action==ZmCalItemComposeController.SAVE_CLOSE)\n};\nZmCalItemComposeController.prototype._handleResponseSave=function(b,a){try{if(b.__newFolderId){var d=appCtxt.getById(b.__newFolderId);\nb.__newFolderId=null;\nthis._app.getListController()._doMove(b,d,null,false)\n}b.handlePostSaveCallbacks();\nif(this.isCloseAction()){this.closeView()\n}appCtxt.notifyZimlets(\"onSaveApptSuccess\",[this,b,a])\n}catch(c){}finally{this._composeView.cleanup()\n}};\nZmCalItemComposeController.prototype._handleErrorSave=function(a,c){var b=this._getErrorSaveStatus(a,c);\nreturn b.handled\n};\nZmCalItemComposeController.prototype._getErrorSaveStatus=function(a,d){var b=a.processErrorSave(d);\nb.handled=false;\nif(b.continueSave){this.saveCalItemContinue(a);\nb.handled=true\n}else{this.enableToolbar(true);\nif(b.errorMessage){b.handled=true;\nvar c=appCtxt.getMsgDialog();\nc.setMessage(b.errorMessage,DwtMessageDialog.CRITICAL_STYLE);\nc.popup()\n}appCtxt.notifyZimlets(\"onSaveApptFailure\",[this,a,d])\n}return b\n};\nZmCalItemComposeController.prototype._spellCheckAgain=function(){this._composeView.getHtmlEditor().discardMisspelledWords();\nthis._doSpellCheck();\nreturn false\n};\nZmCalItemComposeController.prototype.enableToolbar=function(a){this._toolbar.enableAll(a)\n};\nZmCalItemComposeController.prototype._saveListener=function(a){this._action=ZmCalItemComposeController.SAVE;\nthis.enableToolbar(false);\nif(this._doSave()===false){return\n}};\nZmCalItemComposeController.prototype._cancelListener=function(a){this._action=ZmCalItemComposeController.SAVE_CLOSE;\nthis._app.popView()\n};\nZmCalItemComposeController.prototype._printListener=function(){};\nZmCalItemComposeController.prototype._attachmentListener=function(a){this._composeView.addAttachmentField()\n};\nZmCalItemComposeController.prototype._formatListener=function(a,c){if(!c&&!(a&&a.item.getChecked())){return\n}c=c||a.item.getData(ZmHtmlEditor.VALUE);\nif(c==this._composeView.getComposeMode()){return\n}if(c==Dwt.TEXT){if(!this._textModeOkCancel){var b=this._composeView.getHTMLElId()+\"_formatWarning\";\nthis._textModeOkCancel=new DwtMessageDialog({id:b,parent:this._shell,buttons:[DwtDialog.OK_BUTTON,DwtDialog.CANCEL_BUTTON]});\nthis._textModeOkCancel.setMessage(ZmMsg.switchToText,DwtMessageDialog.WARNING_STYLE);\nthis._textModeOkCancel.registerCallback(DwtDialog.OK_BUTTON,this._textModeOkCallback,this);\nthis._textModeOkCancel.registerCallback(DwtDialog.CANCEL_BUTTON,this._textModeCancelCallback,this)\n}this._textModeOkCancel.popup(this._composeView._getDialogXY())\n}else{this._composeView.setComposeMode(c)\n}};\nZmCalItemComposeController.prototype._spellCheckListener=function(b){var a=this._toolbar.getButton(ZmOperation.SPELL_CHECK);\nvar c=this._composeView.getHtmlEditor();\nif(a.isToggled()){var d=new AjxCallback(this,this.toggleSpellCheckButton);\nif(!c.spellCheck(d)){this.toggleSpellCheckButton(false)\n}}else{c.discardMisspelledWords()\n}};\nZmCalItemComposeController.prototype._doSave=function(){try{if(this._composeView.isValid()){return this.saveCalItem()\n}}catch(a){if(AjxUtil.isString(a)){this.showErrorMessage(a)\n}else{}return false\n}};\nZmCalItemComposeController.prototype._doSpellCheck=function(){var c=this._composeView.getHtmlEditor().getTextVersion();\nvar b=AjxSoapDoc.create(\"CheckSpellingRequest\",\"urn:zimbraMail\");\nb.getMethod().appendChild(b.getDoc().createTextNode(c));\nvar a=new ZmCsfeCommand();\nvar d=new AjxCallback(this,this._spellCheckCallback);\na.invoke({soapDoc:b,asyncMode:true,callback:d})\n};\nZmCalItemComposeController.prototype._popShieldYesCallback=function(){this._popShield.popdown();\nthis._action=ZmCalItemComposeController.SAVE_CLOSE;\nif(this._doSave()){appCtxt.getAppViewMgr().showPendingView(true)\n}};\nZmCalItemComposeController.prototype._popShieldNoCallback=function(){this._popShield.popdown();\nthis.enableToolbar(true);\ntry{appCtxt.getAppViewMgr().showPendingView(true)\n}catch(a){}finally{this._composeView.cleanup()\n}};\nZmCalItemComposeController.prototype._closeView=function(){this._app.popView(true,this._currentViewId);\nthis._composeView.cleanup()\n};\nZmCalItemComposeController.prototype._textModeOkCallback=function(a){this._textModeOkCancel.popdown();\nthis._composeView.setComposeMode(Dwt.TEXT)\n};\nZmCalItemComposeController.prototype._textModeCancelCallback=function(a){this._textModeOkCancel.popdown();\nvar b=this._toolbar.getButton(ZmOperation.COMPOSE_OPTIONS);\nif(b){b.getMenu().checkItem(ZmHtmlEditor.VALUE,Dwt.HTML,true)\n}this._composeView.reEnableDesignMode()\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.controller.ZmApptComposeController\")){ZmApptComposeController=function(a,d,b,c){if(arguments.length==0){return\n}ZmCalItemComposeController.apply(this,arguments);\nthis._addedAttendees=[];\nthis._removedAttendees=[];\nthis._kbMgr=appCtxt.getKeyboardMgr()\n};\nZmApptComposeController.prototype=new ZmCalItemComposeController;\nZmApptComposeController.prototype.constructor=ZmApptComposeController;\nZmApptComposeController.prototype.isZmApptComposeController=true;\nZmApptComposeController.prototype.toString=function(){return\"ZmApptComposeController\"\n};\nZmApptComposeController._VALUE=\"value\";\nZmApptComposeController._DIALOG_OPTIONS={SEND:\"SEND\",CANCEL:\"CANCEL\",DISCARD:\"DISCARD\"};\nZmApptComposeController.getDefaultViewType=function(){return ZmId.VIEW_APPOINTMENT\n};\nZmApptComposeController.prototype.getDefaultViewType=ZmApptComposeController.getDefaultViewType;\nZmApptComposeController.prototype.show=function(a,c,b){ZmCalItemComposeController.prototype.show.call(this,a,c,b);\nthis._addedAttendees.length=this._removedAttendees.length=0;\nthis._setComposeTabGroup()\n};\nZmApptComposeController.prototype.forwardCalItem=function(a,c){var b=new AjxCallback(this,this._handleForwardInvite,c);\na.forward(b);\nreturn true\n};\nZmApptComposeController.prototype.sendCounterAppointmentRequest=function(d,b){var e=new AjxCallback(this,this._handleCounterAppointmentRequest,b);\nvar c=this._composeView?this._composeView.getApptEditView():null;\nvar a=c?c.getMode():null;\nd.sendCounterAppointmentRequest(e,null,a);\nreturn true\n};\nZmApptComposeController.prototype._handleCounterAppointmentRequest=function(a){appCtxt.setStatusMsg(ZmMsg.newTimeProposed);\nif(a instanceof AjxCallback){a.run()\n}};\nZmApptComposeController.prototype._handleForwardInvite=function(a){appCtxt.setStatusMsg(ZmMsg.forwardInviteSent);\nif(a instanceof AjxCallback){a.run()\n}};\nZmApptComposeController.prototype._badAddrsOkCallback=function(a,b){a.popdown();\nthis.forwardCalItem(b,new AjxCallback(this,this._apptForwardCallback))\n};\nZmApptComposeController.prototype._apptForwardCallback=function(){this.closeView()\n};\nZmApptComposeController.prototype._checkIsDirty=function(a,b){return this._composeView.checkIsDirty(a,b)\n};\nZmApptComposeController.prototype._getChangesDialog=function(){var c,b,a=this._composeView.isOrganizer();\nif(a){b=this._changesDialog;\nif(!b){b=this._changesDialog=new DwtOptionDialog({parent:appCtxt.getShell(),id:Dwt.getNextId(\"CHNG_DLG_ORG_\"),title:ZmMsg.apptSave,message:ZmMsg.apptSignificantChanges,options:[{name:ZmApptComposeController._DIALOG_OPTIONS.SEND,text:ZmMsg.apptSaveChanges},{name:ZmApptComposeController._DIALOG_OPTIONS.CANCEL,text:ZmMsg.apptSaveCancel},{name:ZmApptComposeController._DIALOG_OPTIONS.DISCARD,text:ZmMsg.apptSaveDiscard}]});\nb.registerCallback(DwtDialog.OK_BUTTON,this._changesDialogListener.bind(this))\n}}else{b=this._attendeeChangesDialog;\nif(!b){b=this._attendeeChangesDialog=new DwtDialog({parent:appCtxt.getShell(),id:Dwt.getNextId(\"CHNG_DLG_ATTNDE_\")});\nc=this._attendeeChangesDialogId=Dwt.getNextId();\nb.setContent(AjxTemplate.expand(\"calendar.Appointment#ChangesDialogAttendee\",{id:c}));\nb.setTitle(ZmMsg.apptSave);\nb.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._attendeeChangesDialogListener,c))\n}}return b\n};\nZmApptComposeController.prototype._changesDialogListener=function(){this.clearInvalidAttendees();\ndelete this._invalidAttendees;\nswitch(this._changesDialog.getSelection()){case ZmApptComposeController._DIALOG_OPTIONS.SEND:this._sendListener();\nbreak;\ncase ZmApptComposeController._DIALOG_OPTIONS.CANCEL:break;\ncase ZmApptComposeController._DIALOG_OPTIONS.DISCARD:this.closeView();\nbreak\n}this._changesDialog.popdown()\n};\nZmApptComposeController.prototype._attendeeChangesDialogListener=function(a){this.clearInvalidAttendees();\ndelete this._invalidAttendees;\nthis.closeView();\nthis._attendeeChangesDialog.popdown()\n};\nZmApptComposeController.prototype.saveCalItem=function(m){this._composeView.cancelLocationRequest();\nvar a=this._composeView.getAppt(m);\nvar k=this._composeView.getNumLocationConflictRecurrence?this._composeView.getNumLocationConflictRecurrence():ZmTimeSuggestionPrefDialog.DEFAULT_NUM_RECURRENCE;\nif(a){if(!a.isValidDuration()){this._composeView.showInvalidDurationMsg();\nthis.enableToolbar(true);\nreturn false\n}if(!a.isValidDurationRecurrence()){this._composeView.showInvalidDurationRecurrenceMsg();\nthis.enableToolbar(true);\nreturn false\n}if(appCtxt.get(ZmSetting.GROUP_CALENDAR_ENABLED)){if(this._requestResponses){a.setRsvp(this._requestResponses.getChecked())\n}a.setMailNotificationOption(true)\n}if(a.isProposeTime&&!a.isOrganizer()){return this.sendCounterAppointmentRequest(a)\n}if(a.isForward){var i=this._composeView.getForwardAddress();\nif(!i.gotAddress){var g=appCtxt.getMsgDialog();\ng.setMessage(ZmMsg.noForwardAddresses,DwtMessageDialog.CRITICAL_STYLE);\ng.popup();\nthis.enableToolbar(true);\nreturn false\n}if(i[ZmApptEditView.BAD]&&i[ZmApptEditView.BAD].size()){var c=appCtxt.getOkCancelMsgDialog();\nc.reset();\nvar d=AjxStringUtil.htmlEncode(i[ZmApptEditView.BAD].toString(AjxEmailAddress.SEPARATOR));\nvar e=AjxMessageFormat.format(ZmMsg.compBadAddresses,d);\nc.setMessage(e,DwtMessageDialog.WARNING_STYLE);\nc.registerCallback(DwtDialog.OK_BUTTON,this._badAddrsOkCallback,this,[c,a]);\nc.setVisible(true);\nc.popup();\nthis.enableToolbar(true);\nreturn false\n}return this.forwardCalItem(a)\n}if(!this._attendeeValidated&&this._invalidAttendees&&this._invalidAttendees.length>0){var l=appCtxt.getYesNoMsgDialog();\nl.registerCallback(DwtDialog.YES_BUTTON,this._clearInvalidAttendeesCallback,this,[a,m,l]);\nvar e=\"\";\nif(this._action==ZmCalItemComposeController.SAVE){e=AjxMessageFormat.format(ZmMsg.compSaveBadAttendees,AjxStringUtil.htmlEncode(this._invalidAttendees.join(\",\")))\n}else{e=AjxMessageFormat.format(ZmMsg.compBadAttendees,AjxStringUtil.htmlEncode(this._invalidAttendees.join(\",\")))\n}l.setMessage(e,DwtMessageDialog.WARNING_STYLE);\nl.popup();\nthis.enableToolbar(true);\nthis._attendeeValidated=true;\nreturn false\n}if(this._action==ZmCalItemComposeController.SAVE&&!a.inviteNeverSent){if(this._checkIsDirty(ZmApptEditView.CHANGES_SIGNIFICANT)){this._getChangesDialog().popup();\nthis.enableToolbar(true);\nreturn false\n}}var h=a.origAttendees;\nif(h&&h.length>0&&m==null){if(!a.inviteNeverSent&&!this._composeView.getApptEditView().isDirty(true)){var b=a.getAttendees(ZmCalBaseItem.PERSON);\nif(b.length>0){if(this._action==ZmCalItemComposeController.SEND&&this._attendeesUpdated(a,m,b,h)){return false\n}}}var f=AjxDispatcher.run(\"GetCalController\");\nif(f.isMovingBetwAccounts(a,a.__newFolderId)){var l=appCtxt.getMsgDialog();\nl.setMessage(ZmMsg.orgChange,DwtMessageDialog.WARNING_STYLE);\nl.popup();\nthis.enableToolbar(true);\nreturn false\n}}var j=this._initiateSaveWithChecks(a,m,k);\nreturn j\n}return false\n};\nZmApptComposeController.prototype._initiateSaveWithChecks=function(a,i,f){var e=a.getAttendees(ZmCalBaseItem.EQUIPMENT);\nvar g=a.getAttendees(ZmCalBaseItem.LOCATION);\nvar c=a.getAttendees(ZmCalBaseItem.PERSON);\nvar b;\nvar h=(c&&c.length>0)||(e&&e.length>0)||(g&&g.length>0);\nvar d=!a.isForward&&((e&&e.length>0)||(!a.alteredLocations&&g&&g.length>0));\nif(d){this.checkConflicts(a,f,i,b);\nreturn false\n}else{if(h){this.checkAttendeePermissions(a,i,b);\nreturn false\n}else{this._saveCalItemFoRealz(a,i,b)\n}}return true\n};\nZmApptComposeController.prototype.updateToolbarOps=function(e,b){var c=this._toolbar.getButton(ZmOperation.SAVE);\nvar a=this._toolbar.getButton(ZmOperation.SEND_INVITE);\nif(e==ZmCalItemComposeController.APPT_MODE){c.setText(ZmMsg.saveClose);\nc.setVisible(true);\na.setVisible(false)\n}else{a.setVisible(true);\nc.setVisible(true);\nc.setText(ZmMsg.save);\nvar d=this._toolbar.getButton(ZmOperation.CANCEL);\nd.setText(ZmMsg.close)\n}if(this._requestResponses){this._requestResponses.setEnabled(e!==ZmCalItemComposeController.APPT_MODE)\n}if((this._mode==ZmCalItem.MODE_PROPOSE_TIME)||ZmCalItem.FORWARD_MAPPING[this._mode]){a.setVisible(true);\nc.setVisible(false);\nif(this._requestResponses){this._requestResponses.setEnabled(this._mode!==ZmCalItem.MODE_PROPOSE_TIME)\n}}};\nZmApptComposeController.prototype._initToolbar=function(d){ZmCalItemComposeController.prototype._initToolbar.call(this,d);\nvar c=this._toolbar.getButton(ZmOperation.SAVE);\nc.removeSelectionListeners();\nif(ZmCalItem.FORWARD_MAPPING[d]){c.addSelectionListener(new AjxListener(this,this._sendBtnListener))\n}else{c.addSelectionListener(new AjxListener(this,this._saveBtnListener))\n}var a=this._toolbar.getButton(ZmOperation.SEND_INVITE);\na.removeSelectionListeners();\na.addSelectionListener(new AjxListener(this,this._sendBtnListener));\nvar c=this._toolbar.getButton(ZmOperation.SAVE);\nc.setToolTipContent(ZmMsg.saveToCalendar);\nvar b=this._toolbar.getButton(ZmOperation.ATTACHMENT);\nif(b){b.setEnabled(!(this._mode==ZmCalItem.MODE_PROPOSE_TIME||ZmCalItem.FORWARD_MAPPING[d]))\n}};\nZmApptComposeController.prototype._sendListener=function(b){var a=this._composeView.getApptEditView()._calItem;\nif(!a.inviteNeverSent){this._sendAfterExceptionCheck()\n}else{this._sendContinue()\n}return true\n};\nZmApptComposeController.prototype._sendAfterExceptionCheck=function(){var c=this._composeView.getApptEditView()._calItem;\nvar e=appCtxt.get(ZmSetting.CAL_EXCEPTION_ON_SERIES_TIME_CHANGE);\nvar a=(this._mode==ZmCalItem.MODE_EDIT_SERIES);\nvar d=c.isRecurring()&&c.hasEx&&a&&c.getAttendees(ZmCalBaseItem.PERSON)&&!e&&this._checkIsDirty(ZmApptEditView.CHANGES_TIME_RECURRENCE);\nif(d){var b=appCtxt.getYesNoCancelMsgDialog();\nb.setMessage(ZmMsg.recurrenceUpdateWarning,DwtMessageDialog.WARNING_STYLE);\nb.registerCallback(DwtDialog.YES_BUTTON,this._sendContinue,this,[b]);\nb.registerCallback(DwtDialog.NO_BUTTON,this._dontSend,this,[b]);\nb.getButton(DwtDialog.CANCEL_BUTTON).setText(ZmMsg.discard);\nb.registerCallback(DwtDialog.CANCEL_BUTTON,this._dontSendAndClose,this,[b]);\nb.popup()\n}else{this._sendContinue()\n}};\nZmApptComposeController.prototype._dontSend=function(a){this._revertWarningDialog(a)\n};\nZmApptComposeController.prototype._dontSendAndClose=function(a){this._revertWarningDialog(a);\nthis.closeView()\n};\nZmApptComposeController.prototype._revertWarningDialog=function(a){if(a){a.popdown();\na.getButton(DwtDialog.CANCEL_BUTTON).setText(ZmMsg.cancel)\n}};\nZmApptComposeController.prototype._sendContinue=function(a){this._revertWarningDialog(a);\nthis._action=ZmCalItemComposeController.SEND;\nthis.enableToolbar(false);\nif(this._doSave()===false){return\n}this.closeView()\n};\nZmApptComposeController.prototype.isSave=function(){return(this._action==ZmCalItemComposeController.SAVE)\n};\nZmApptComposeController.prototype._saveBtnListener=function(a){delete this._attendeeValidated;\nreturn this._saveListener(a,true)\n};\nZmApptComposeController.prototype._sendBtnListener=function(a){delete this._attendeeValidated;\nreturn this._sendListener(a)\n};\nZmApptComposeController.prototype._saveListener=function(d,e){var a=!this._composeView.isAttendeesEmpty();\nthis._action=a?ZmCalItemComposeController.SAVE:ZmCalItemComposeController.SAVE_CLOSE;\nif(!this._composeView.isOrganizer()){this._action=ZmCalItemComposeController.SAVE_CLOSE\n}this.enableToolbar(false);\nvar g=appCtxt.getOkCancelMsgDialog();\nif(g.isPoppedUp()){g.popdown()\n}if(!e&&this._action==ZmCalItemComposeController.SAVE){var c=this._composeView.getApptEditView()._calItem;\nvar b=(c&&c.inviteNeverSent);\nvar f=true;\nif(c.isDraft){f=false\n}if(f&&!b&&(this._checkIsDirty(ZmApptEditView.CHANGES_SIGNIFICANT)||this._checkIsDirty(ZmApptEditView.CHANGES_LOCAL))){f=false\n}if(f){g.setMessage(ZmMsg.saveApptInfoMsg);\ng.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._saveListener,[d,true]));\ng.popup();\nthis.enableToolbar(true);\nreturn\n}}if(this._doSave()===false){return\n}};\nZmApptComposeController.prototype._createToolBar=function(){ZmCalItemComposeController.prototype._createToolBar.call(this);\nvar d=this._toolbar.getButton(ZmOperation.COMPOSE_OPTIONS);\nif(d){d.setVisible(true);\nvar a=d.getMenu();\nif(a){var c=new DwtMenuItem({parent:a,style:DwtMenuItem.SEPARATOR_STYLE})\n}else{a=new DwtMenu({parent:d});\nd.setMenu(a)\n}var b=this._requestResponses=new DwtMenuItem({parent:a,style:DwtMenuItem.CHECK_STYLE});\nb.setText(ZmMsg.requestResponses);\nb.setChecked(true,true);\nc=new DwtMenuItem({parent:a,style:DwtMenuItem.SEPARATOR_STYLE});\nb=new DwtMenuItem({parent:a,style:DwtMenuItem.NO_STYLE});\nb.setText(ZmMsg.suggestionPreferences);\nb.addSelectionListener(this._prefListener.bind(this))\n}this._toolbar.addSelectionListener(ZmOperation.SPELL_CHECK,new AjxListener(this,this._spellCheckListener))\n};\nZmApptComposeController.prototype._prefListener=function(a){this._prefDialog=appCtxt.getSuggestionPreferenceDialog();\nthis._prefDialog.popup(this.getCalendarAccount())\n};\nZmApptComposeController.prototype.setRequestResponsesEnabled=function(a){if(this._requestResponses){this._requestResponses.setEnabled(a)\n}};\nZmApptComposeController.prototype.setRequestResponses=function(a){if(this._requestResponses){this._requestResponses.setChecked(a)\n}};\nZmApptComposeController.prototype.getRequestResponses=function(){if(this._requestResponses){return this._requestResponses.getEnabled()?this._requestResponses.getChecked():true\n}};\nZmApptComposeController.prototype.getNotifyList=function(b){var c=[];\nfor(var a=0;\na<b.length;\na++){c.push(b[a]._inviteAddress||b[a].address||b[a].getEmail())\n}return c\n};\nZmApptComposeController.prototype.isAttendeesEmpty=function(d){var e=d.getAttendees(ZmCalBaseItem.EQUIPMENT);\nvar a=d.getAttendees(ZmCalBaseItem.LOCATION);\nvar c=d.getAttendees(ZmCalBaseItem.PERSON);\nvar b=(c&&c.length>0)||(e&&e.length>0)||(a&&a.length>0);\nreturn !b\n};\nZmApptComposeController.prototype.checkConflicts=function(a,e,h,b){var d=a.getAttendees(ZmCalBaseItem.EQUIPMENT);\nvar f=a.getAttendees(ZmCalBaseItem.LOCATION);\nvar c=a.getAttendees(ZmCalBaseItem.PERSON);\nvar g=(c&&c.length>0)||(d&&d.length>0)||(f&&f.length>0);\nvar i=g?(new AjxCallback(this,this.checkAttendeePermissions,[a,h,b])):(new AjxCallback(this,this.saveCalItemContinue,[a,h,b]));\nthis._checkResourceConflicts(a,e,i,false,true,false)\n};\nZmApptComposeController.prototype.checkAttendeePermissions=function(g,c,f){var b=[];\nvar e=g.getAttendees(ZmCalBaseItem.PERSON);\nif(e&&e.length>0){for(var d=0;\nd<e.length;\nd++){b.push(e[d].getEmail())\n}}var a=g.getAttendees(ZmCalBaseItem.LOCATION);\nif(a&&a.length>0){for(var d=0;\nd<a.length;\nd++){b.push(a[d].getEmail())\n}}var h=g.getAttendees(ZmCalBaseItem.EQUIPMENT);\nif(h&&h.length>0){for(var d=0;\nd<h.length;\nd++){b.push(h[d].getEmail())\n}}if(b.length){this.checkPermissionRequest(b,g,c,f);\nreturn false\n}this._saveCalItemFoRealz(g,c,f)\n};\nZmApptComposeController.prototype.getCheckResourceConflicts=function(b,c,d,a){return this.checkResourceConflicts.bind(this,b,c,d,a)\n};\nZmApptComposeController.prototype.checkResourceConflicts=function(b,c,d,a){return this._checkResourceConflicts(b,c,d,true,a,true)\n};\nZmApptComposeController.prototype._checkResourceConflicts=function(a,f,g,c,i,h){var d=a.viewMode;\nvar e;\nif(d!=ZmCalItem.MODE_NEW_FROM_QUICKADD&&d!=ZmCalItem.MODE_NEW){if(a.isRecurring()&&d!=ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){var b=this._checkResourceConflicts.bind(this,a,f,g,c,i,h);\ne=this.getRecurInfo(a,b)\n}else{e=this._checkResourceConflicts(a,f,g,c,i,h)\n}}else{e=this._checkResourceConflicts(a,f,g,c,i,h)\n}return e\n};\nZmApptComposeController.prototype._checkResourceConflicts=function(a,j,k,d,o,n,f){var h=a.viewMode,m={CheckRecurConflictsRequest:{_jsns:\"urn:zimbraMail\"}},e=m.CheckRecurConflictsRequest,c=new Date(a.startDate),b=e.comp=[],g=e.comp[0]={},l,i;\nc.setHours(0,0,0,0);\ne.s=c.getTime();\ne.e=ZmApptComposeController.getCheckResourceConflictEndTime(a,c,j);\nif(d){e.all=\"1\"\n}if(h!=ZmCalItem.MODE_NEW_FROM_QUICKADD&&h!=ZmCalItem.MODE_NEW){e.excludeUid=a.uid\n}a._addDateTimeToRequest(e,g,true);\nif(f){l=a.getRecurrence();\ni=(f&&f.comp)?f.comp[0].recur:null;\nl.parseExcludeInfo(i)\n}if(h!=ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){a._recurrence.setJson(g)\n}this.setExceptFromRecurInfo(e,f);\na.addAttendeesToChckConflictsRequest(e);\nreturn appCtxt.getAppController().sendRequest({jsonObj:m,asyncMode:true,callback:(new AjxCallback(this,this._handleResourceConflict,[a,k,o,n])),errorCallback:(new AjxCallback(this,this._handleResourceConflictError,[a,k])),noBusyOverlay:true})\n};\nZmApptComposeController.prototype.setExceptFromRecurInfo=function(b,d){var a=d&&d.except,c,m,h,j,k,g,l,f;\nif(!a){return\n}for(c in a){m=a[c].s?a[c].s[0]:null;\nh=a[c].e?a[c].e[0]:null;\nj=a[c].exceptId?a[c].exceptId[0]:null;\nk=b.except={};\nif(m){g=k.s={};\ng.d=m.d;\nif(m.tz){g.tz=m.tz\n}}if(h){l=k.e={};\nl.d=h.d;\nif(h.tz){l.tz=h.tz\n}}if(j){f=k.exceptId={};\nf.d=j.d;\nif(j.tz){f.tz=j.tz\n}}}};\nZmApptComposeController.getCheckResourceConflictEndTime=function(a,b,h){var c=new Date(b.getTime());\nvar i=a.getRecurrence();\nvar f;\nvar e=i.repeatCustomCount*h;\nif(i.repeatType==ZmRecurrence.NONE){if(a.allDayEvent===\"1\"){f=new Date(a.endDate.getTime()+AjxDateUtil.MSEC_PER_DAY)\n}else{f=a.endDate\n}}else{if(i.repeatType==ZmRecurrence.DAILY){f=AjxDateUtil.roll(c,AjxDateUtil.DAY,e)\n}else{if(i.repeatType==ZmRecurrence.WEEKLY){f=AjxDateUtil.roll(c,AjxDateUtil.WEEK,e)\n}else{if(i.repeatType==ZmRecurrence.MONTHLY){f=AjxDateUtil.roll(c,AjxDateUtil.MONTH,e)\n}else{if(i.repeatType==ZmRecurrence.YEARLY){f=AjxDateUtil.roll(c,AjxDateUtil.YEAR,e)\n}}}}}var g=f.getTime();\nif(i.repeatEndDate){var d=i.repeatEndDate.getTime()+AjxDateUtil.MSEC_PER_DAY;\nif(g>d){g=d\n}}return g\n};\nZmApptComposeController.prototype.getRecurInfo=function(c,a){var b=AjxSoapDoc.create(\"GetRecurRequest\",\"urn:zimbraMail\");\nb.setMethodAttribute(\"id\",c.id);\nreturn appCtxt.getAppController().sendRequest({soapDoc:b,asyncMode:true,callback:(new AjxCallback(this,this._handleRecurInfo,[c,a])),errorCallback:(new AjxCallback(this,this._handleRecurInfoError,[c,a])),noBusyOverlay:true})\n};\nZmApptComposeController.prototype._handleRecurInfo=function(c,d,a){var b=a.getResponse().GetRecurResponse;\nif(d){d.run(b)\n}};\nZmApptComposeController.prototype._handleRecurInfoError=function(b,c,a){if(c){c.run()\n}};\nZmApptComposeController.prototype.checkPermissionRequest=function(f,a,h,b){var k={CheckRightsRequest:{_jsns:\"urn:zimbraAccount\"}};\nvar c=k.CheckRightsRequest;\nc.target=[];\nfor(var d=0;\nd<f.length;\nd++){var g={type:\"account\",by:\"name\",key:f[d]};\ng.right=[{_content:\"invite\"}];\nc.target.push(g)\n}var j=new AjxCallback(this,this.handleCheckRightsResponse,[a,h,f,b]);\nvar e=new AjxCallback(this,this.handleCheckRightsResponse,[a,h,f,b]);\nappCtxt.getAppController().sendRequest({jsonObj:k,asyncMode:true,callback:j,errorCallback:e,noBusyOverlay:true})\n};\nZmApptComposeController.prototype.handleCheckRightsResponse=function(a,k,j,c,g){var b=g&&g._data&&g._data.CheckRightsResponse;\nif(b&&b.target){var d=[];\nfor(var h in b.target){if(!b.target[h].allow){d.push(j[h])\n}}if(d.length>0){var e=AjxMessageFormat.format(ZmMsg.invitePermissionDenied,[d.join(\",\")]);\nvar f=appCtxt.getMsgDialog();\nf.reset();\nf.setMessage(e,DwtMessageDialog.INFO_STYLE);\nf.popup();\nthis.enableToolbar(true);\nreturn\n}}this.saveCalItemContinue(a,k,c)\n};\nZmApptComposeController.prototype._saveAfterPermissionCheck=function(d,b,c,a){a.popdown();\nthis.saveCalItemContinue(d,b,c)\n};\nZmApptComposeController.prototype.saveCalItemContinue=function(c,a,b){this._saveCalItemFoRealz(c,a,b)\n};\nZmApptComposeController.prototype.handleCheckPermissionResponseError=function(d,b,e,c,a){var f=a&&a._data&&a._data.BatchResponse;\nthis.saveCalItemContinue(d,b,c)\n};\nZmApptComposeController.prototype._handleResourceConflict=function(c,h,b,g,a){var e=false;\nvar d=null;\nif(a){var f=a.getResponse().CheckRecurConflictsResponse;\nd=this._conflictingInstances=f.inst;\nif(d&&d.length>0){if(b){this.showConflictDialog(c,h,d)\n}e=true;\nthis.enableToolbar(true)\n}}if((g||!e)&&h){h.run(d)\n}};\nZmApptComposeController.prototype.showConflictDialog=function(a,d,b){var c=this.getConflictDialog();\nc.initialize(b,a,d);\nc.popup()\n};\nZmApptComposeController.prototype.getConflictDialog=function(){if(!this._resConflictDialog){this._resConflictDialog=new ZmResourceConflictDialog(this._shell)\n}return this._resConflictDialog\n};\nZmApptComposeController.prototype._handleResourceConflictError=function(a,b){if(b){b.run()\n}};\nZmApptComposeController.prototype.getFreeBusyInfo=function(e,b,f,h,a,c){var d=AjxSoapDoc.create(\"GetFreeBusyRequest\",\"urn:zimbraMail\");\nd.setMethodAttribute(\"s\",e);\nd.setMethodAttribute(\"e\",b);\nd.setMethodAttribute(\"uid\",f);\nvar g=(appCtxt.multiAccounts)?this._composeView.getApptEditView().getCalendarAccount():null;\nreturn appCtxt.getAppController().sendRequest({soapDoc:d,asyncMode:true,callback:h,errorCallback:a,noBusyOverlay:c,accountName:(g?g.name:null)})\n};\nZmApptComposeController.prototype._createComposeView=function(){return(new ZmApptComposeView(this._container,null,this._app,this))\n};\nZmApptComposeController.prototype._setComposeTabGroup=function(b){var c=this._createTabGroup();\nvar d=appCtxt.getRootTabGroup();\nc.newParent(d);\nc.addMember(this._toolbar);\nvar f=this._composeView.getApptEditView();\nf._addTabGroupMembers(c);\nvar e=f._savedFocusMember||f._getDefaultFocusItem()||c.getFirstMember(true);\nvar a=new AjxTimedAction(this,this._setFocus,[e,!b]);\nAjxTimedAction.scheduleAction(a,10)\n};\nZmApptComposeController.prototype._getDefaultFocusItem=function(){return this._composeView.getApptEditView()._getDefaultFocusItem()\n};\nZmApptComposeController.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_EDIT_APPOINTMENT\n};\nZmApptComposeController.prototype._attendeesUpdated=function(a,k,b,e){var g={};\nfor(var f=0;\nf<e.length;\nf++){var h=e[f].getEmail();\ng[h]=true\n}var j={};\nvar d=a.getForwardAddress();\nfor(var f=0;\nf<d.length;\nf++){var h=d[f].getAddress();\nj[h]=true\n}var c={};\nfor(var f=0;\nf<b.length;\nf++){var h=b[f].getEmail();\nc[h]=true\n}for(var f=0;\nf<b.length;\nf++){var h=b[f].getEmail();\nif(!g[h]&&!j[h]){this._addedAttendees.push(h)\n}}for(var f=0;\nf<e.length;\nf++){var h=e[f].getEmail();\nif(!c[h]){this._removedAttendees.push(h)\n}}if(this._addedAttendees.length>0||this._removedAttendees.length>0){if(!this._notifyDialog){this._notifyDialog=new ZmApptNotifyDialog(this._shell);\nthis._notifyDialog.addSelectionListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._notifyDlgOkListener));\nthis._notifyDialog.addSelectionListener(DwtDialog.CANCEL_BUTTON,new AjxListener(this,this._notifyDlgCancelListener))\n}a.setMailNotificationOption(true);\nthis._notifyDialog.initialize(a,k,this._addedAttendees,this._removedAttendees);\nthis._notifyDialog.popup();\nthis.enableToolbar(true);\nreturn true\n}return false\n};\nZmApptComposeController.prototype._cancelListener=function(b){var c=false;\nif(this._composeView.gotNewAttachments()){c=true\n}else{var a=this._composeView.getAppt(this._attId);\nif(a&&!a.inviteNeverSent){c=this._checkIsDirty(ZmApptEditView.CHANGES_SIGNIFICANT)\n}}if(c){this._getChangesDialog().popup();\nthis.enableToolbar(true);\nreturn\n}this._app.getCalController().setNeedsRefresh(true);\nZmCalItemComposeController.prototype._cancelListener.call(this,b)\n};\nZmApptComposeController.prototype._printListener=function(){var a=this._composeView._apptEditView._calItem;\nvar b=[\"/h/printappointments?id=\",a.invId,\"&tz=\",AjxTimezone.getServerId(AjxTimezone.DEFAULT)];\nif(appCtxt.isOffline){b.push(\"&zd=true\",\"&acct=\",this._composeView.getApptEditView().getCalendarAccount().name)\n}window.open(appContextPath+b.join(\"\"),\"_blank\")\n};\nZmApptComposeController.prototype._notifyDlgOkListener=function(b){var a=this._notifyDialog.notifyNew()?this._addedAttendees:null;\nthis._saveCalItemFoRealz(this._notifyDialog.getAppt(),this._notifyDialog.getAttId(),a)\n};\nZmApptComposeController.prototype._notifyDlgCancelListener=function(a){this._addedAttendees.length=this._removedAttendees.length=0\n};\nZmApptComposeController.prototype._changeOrgCallback=function(b,a,c){c.popdown();\nthis._saveCalItemFoRealz(b,a)\n};\nZmApptComposeController.prototype._saveCalItemFoRealz=function(a,b,c,d){d=d||(this._action==ZmCalItemComposeController.SEND);\nif(a.isForward){c=this.getForwardNotifyList(a)\n}this._composeView.getApptEditView().resetParticipantStatus();\nZmCalItemComposeController.prototype._saveCalItemFoRealz.call(this,a,b,c,d)\n};\nZmApptComposeController.prototype.getForwardNotifyList=function(a){var b=a.getForwardAddress();\nvar e=[];\nfor(var d=0;\nd<b.length;\nd++){var c=b[d].getAddress();\ne.push(c)\n}return e\n};\nZmApptComposeController.prototype._doSaveCalItem=function(e,c,f,b,d){delete this._attendeeValidated;\nif(this._action==ZmCalItemComposeController.SEND){e.send(c,f,b,d)\n}else{var a=e.hasAttendees();\nif(a){this._draftFlag=e.isDraft||e.inviteNeverSent||this._checkIsDirty(ZmApptEditView.CHANGES_INSIGNIFICANT)\n}else{this._draftFlag=false\n}e.save(c,f,b,d,this._draftFlag)\n}};\nZmApptComposeController.prototype._handleResponseSave=function(b,a){if(b.__newFolderId){var d=appCtxt.getById(b.__newFolderId);\nb.__newFolderId=null;\nthis._app.getListController()._doMove(b,d,null,false)\n}var e;\nvar c=b.getViewMode();\nif(c==ZmCalItem.MODE_NEW||c==ZmCalItem.MODE_NEW_FROM_QUICKADD||c==ZmAppt.MODE_DRAG_OR_SASH){e=true\n}if(this.isCloseAction()){b.handlePostSaveCallbacks();\nthis.closeView()\n}else{this.enableToolbar(true);\nif(e){c=b.isRecurring()?ZmCalItem.MODE_EDIT_SERIES:ZmCalItem.MODE_EDIT\n}b.setFromSavedResponse(a);\nif(this._action==ZmCalItemComposeController.SAVE){b.isDraft=this._draftFlag;\nb.draftUpdated=true\n}this._composeView.set(b,c)\n}var f=e?ZmMsg.apptCreated:ZmMsg.apptSaved;\nif(b.hasAttendees()){if(this._action==ZmCalItemComposeController.SAVE||this._action==ZmCalItemComposeController.SAVE_CLOSE){f=ZmMsg.apptSaved\n}else{if(c!=ZmCalItem.MODE_NEW){f=ZmMsg.apptSent\n}}}appCtxt.setStatusMsg(f);\nappCtxt.notifyZimlets(\"onSaveApptSuccess\",[this,b,a])\n};\nZmApptComposeController.prototype._resetNavToolBarButtons=function(a){};\nZmApptComposeController.prototype._clearInvalidAttendeesCallback=function(b,a,c){c.popdown();\nthis.clearInvalidAttendees();\ndelete this._invalidAttendees;\nif(this._action==ZmCalItemComposeController.SAVE){this._saveListener()\n}else{this._sendListener()\n}};\nZmApptComposeController.prototype.clearInvalidAttendees=function(){this._invalidAttendees=[]\n};\nZmApptComposeController.prototype.addInvalidAttendee=function(a){if(AjxUtil.indexOf(this._invalidAttendees,a)==-1){this._invalidAttendees.push(a)\n}};\nZmApptComposeController.prototype.closeView=function(){this._closeView()\n};\nZmApptComposeController.prototype.forwardInvite=function(a){this.show(a,ZmCalItem.MODE_FORWARD_INVITE)\n};\nZmApptComposeController.prototype.proposeNewTime=function(a){this.show(a,ZmCalItem.MODE_PROPOSE_TIME)\n};\nZmApptComposeController.prototype.initComposeView=function(c){if(!this._composeView){this._composeView=this._createComposeView();\nvar d=this._composeView.getApptEditView();\nthis._savedFocusMember=d._getDefaultFocusItem();\nvar a={};\na[ZmAppViewMgr.CB_PRE_HIDE]=new AjxCallback(this,this._preHideCallback);\na[ZmAppViewMgr.CB_PRE_UNLOAD]=new AjxCallback(this,this._preUnloadCallback);\na[ZmAppViewMgr.CB_POST_SHOW]=new AjxCallback(this,this._postShowCallback);\na[ZmAppViewMgr.CB_PRE_SHOW]=new AjxCallback(this,this._preShowCallback);\na[ZmAppViewMgr.CB_POST_HIDE]=new AjxCallback(this,this._postHideCallback);\nif(!this._toolbar){this._createToolBar()\n}var b=this.getViewElements(null,this._composeView,this._toolbar);\nthis._app.createView({viewId:this._currentViewId,viewType:this._currentViewType,elements:b,hide:this._elementsToHide,controller:this,callbacks:a,tabParams:this._getTabParams()});\nif(c){this._composeView.preload()\n}return true\n}else{this._savedFocusMember=this._composeView.getApptEditView()._getDefaultFocusItem()\n}return false\n};\nZmApptComposeController.prototype.getCalendarAccount=function(){return(appCtxt.multiAccounts)?this._composeView.getApptEditView().getCalendarAccount():null\n};\nZmApptComposeController.prototype.getAttendees=function(a){return this._composeView.getAttendees(a)\n};\nZmApptComposeController.prototype._postHideCallback=function(){ZmCalItemComposeController.prototype._postHideCallback();\nif(appCtxt.getCurrentAppName()==ZmApp.CALENDAR||appCtxt.get(ZmSetting.CAL_ALWAYS_SHOW_MINI_CAL)){appCtxt.getAppViewMgr().displayComponent(ZmAppViewMgr.C_TREE_FOOTER,true)\n}};\nZmApptComposeController.prototype._postShowCallback=function(a,c){var b=new AjxTimedAction(this,this._setFocus);\nAjxTimedAction.scheduleAction(b,10)\n};\nZmApptComposeController.prototype.getWorkingInfo=function(e,b,f,h,a,c){var d=AjxSoapDoc.create(\"GetWorkingHoursRequest\",\"urn:zimbraMail\");\nd.setMethodAttribute(\"s\",e);\nd.setMethodAttribute(\"e\",b);\nd.setMethodAttribute(\"name\",f);\nvar g=(appCtxt.multiAccounts)?this._composeView.getApptEditView().getCalendarAccount():null;\nreturn appCtxt.getAppController().sendRequest({soapDoc:d,asyncMode:true,callback:h,errorCallback:a,noBusyOverlay:c,accountName:(g?g.name:null)})\n};\nZmApptComposeController.prototype._resetToolbarOperations=function(){};\nZmSimpleApptComposeController=function(a,d,b,c){ZmApptComposeController.apply(this,arguments);\nthis._closeCallback=null;\nthis.initComposeView()\n};\nZmSimpleApptComposeController.prototype=new ZmApptComposeController;\nZmSimpleApptComposeController.prototype.constructor=ZmSimpleApptComposeController;\nZmSimpleApptComposeController.prototype.toString=function(){return\"ZmSimpleApptComposeController\"\n};\nZmSimpleApptComposeController.getDefaultViewType=function(){return ZmId.VIEW_SIMPLE_ADD_APPOINTMENT\n};\nZmSimpleApptComposeController.prototype.doSimpleSave=function(d,e,f,b,a){var c=false;\nthis._action=e;\nthis._closeCallback=null;\nif(!d.isValidDuration()){this._composeView.showInvalidDurationMsg()\n}else{if(d){this._simpleCloseCallback=f;\nthis._simpleErrorCallback=b;\nthis._simpleCancelCallback=a;\nc=this._initiateSaveWithChecks(d,null,ZmTimeSuggestionPrefDialog.DEFAULT_NUM_RECURRENCE)\n}}return c\n};\nZmSimpleApptComposeController.prototype._handleResponseSave=function(b,a){if(this._simpleCloseCallback){this._simpleCloseCallback.run()\n}appCtxt.notifyZimlets(\"onSaveApptSuccess\",[this,b,a])\n};\nZmSimpleApptComposeController.prototype._getErrorSaveStatus=function(a,c){var b=ZmCalItemComposeController.prototype._getErrorSaveStatus.call(this,a,c);\nif(!b.continueSave&&this._simpleErrorCallback){this._simpleErrorCallback.run(this)\n}return b\n};\nZmSimpleApptComposeController.prototype.initComposeView=function(){if(!this._composeView){this._composeView=this._createComposeView();\nthis._composeView.isDirty=function(){return true\n};\nreturn true\n}return false\n};\nZmSimpleApptComposeController.prototype.enableToolbar=function(a){};\nZmSimpleApptComposeController.prototype.showConflictDialog=function(a,d,b){var c=this.getConflictDialog();\nc.initialize(b,a,d,this._simpleCancelCallback);\nc.popup()\n}\n}if(AjxPackage.define(\"zimbraMail.calendar.controller.ZmCalViewController\")){ZmCalViewController=function(b,c,e,j){ZmListController.apply(this,arguments);\nvar g=this._handleApptRespondAction.bind(this);\nvar a=this._handleApptEditRespondAction.bind(this);\nZmCalViewController.OP_TO_VIEW={};\nZmCalViewController.OP_TO_VIEW[ZmOperation.DAY_VIEW]=ZmId.VIEW_CAL_DAY;\nZmCalViewController.OP_TO_VIEW[ZmOperation.WEEK_VIEW]=ZmId.VIEW_CAL_WEEK;\nZmCalViewController.OP_TO_VIEW[ZmOperation.WORK_WEEK_VIEW]=ZmId.VIEW_CAL_WORK_WEEK;\nZmCalViewController.OP_TO_VIEW[ZmOperation.MONTH_VIEW]=ZmId.VIEW_CAL_MONTH;\nZmCalViewController.OP_TO_VIEW[ZmOperation.CAL_LIST_VIEW]=ZmId.VIEW_CAL_LIST;\nZmCalViewController.OP_TO_VIEW[ZmOperation.FB_VIEW]=ZmId.VIEW_CAL_FB;\nZmCalViewController.VIEW_TO_OP={};\nfor(var f in ZmCalViewController.OP_TO_VIEW){ZmCalViewController.VIEW_TO_OP[ZmCalViewController.OP_TO_VIEW[f]]=f\n}this._listeners[ZmOperation.REPLY_ACCEPT]=g;\nthis._listeners[ZmOperation.REPLY_DECLINE]=g;\nthis._listeners[ZmOperation.REPLY_TENTATIVE]=g;\nthis._listeners[ZmOperation.EDIT_REPLY_ACCEPT]=a;\nthis._listeners[ZmOperation.EDIT_REPLY_DECLINE]=a;\nthis._listeners[ZmOperation.EDIT_REPLY_TENTATIVE]=a;\nthis._listeners[ZmOperation.SHOW_ORIG]=this._showOrigListener.bind(this);\nthis._listeners[ZmOperation.VIEW_APPOINTMENT]=this._handleMenuViewAction.bind(this);\nthis._listeners[ZmOperation.OPEN_APPT_INSTANCE]=this._handleMenuViewAction.bind(this);\nthis._listeners[ZmOperation.OPEN_APPT_SERIES]=this._handleMenuViewAction.bind(this);\nthis._listeners[ZmOperation.TODAY]=this._todayButtonListener.bind(this);\nthis._listeners[ZmOperation.NEW_APPT]=this._newApptAction.bind(this);\nthis._listeners[ZmOperation.NEW_ALLDAY_APPT]=this._newAllDayApptAction.bind(this);\nthis._listeners[ZmOperation.SEARCH_MAIL]=this._searchMailAction.bind(this);\nthis._listeners[ZmOperation.MOVE]=this._apptMoveListener.bind(this);\nthis._listeners[ZmOperation.DELETE_INSTANCE]=this._deleteListener.bind(this);\nthis._listeners[ZmOperation.DELETE_SERIES]=this._deleteListener.bind(this);\nthis._listeners[ZmOperation.FORWARD_APPT]=this._forwardListener.bind(this);\nthis._listeners[ZmOperation.PROPOSE_NEW_TIME]=this._proposeTimeListener.bind(this);\nthis._listeners[ZmOperation.REINVITE_ATTENDEES]=this._reinviteAttendeesListener.bind(this);\nthis._listeners[ZmOperation.FORWARD_APPT_INSTANCE]=this._forwardListener.bind(this);\nthis._listeners[ZmOperation.FORWARD_APPT_SERIES]=this._forwardListener.bind(this);\nthis._listeners[ZmOperation.REPLY]=this._replyListener.bind(this);\nthis._listeners[ZmOperation.REPLY_ALL]=this._replyAllListener.bind(this);\nthis._listeners[ZmOperation.DUPLICATE_APPT]=this._duplicateApptListener.bind(this);\nthis._listeners[ZmOperation.PRINT_CALENDAR]=this._printCalendarListener.bind(this);\nthis._treeSelectionListener=this._calTreeSelectionListener.bind(this);\nthis._maintTimedAction=new AjxTimedAction(this,this._maintenanceAction);\nthis._pendingWork=ZmCalViewController.MAINT_NONE;\nthis.apptCache=new ZmApptCache(this);\nthis._currentViewIdOverride=ZmId.VIEW_CAL;\nZmCalViewController.OPS=[ZmOperation.DAY_VIEW,ZmOperation.WORK_WEEK_VIEW,ZmOperation.WEEK_VIEW,ZmOperation.MONTH_VIEW,ZmOperation.CAL_LIST_VIEW];\nif(appCtxt.get(ZmSetting.FREE_BUSY_VIEW_ENABLED)){ZmCalViewController.OPS.push(ZmOperation.FB_VIEW)\n}var h=new AjxListener(this,this._viewActionMenuItemListener);\nfor(var d=0;\nd<ZmCalViewController.OPS.length;\nd++){var f=ZmCalViewController.OPS[d];\nthis._listeners[f]=h\n}this._errorCallback=this._handleError.bind(this);\nif(this.supportsDnD()){this._dragSrc=new DwtDragSource(Dwt.DND_DROP_MOVE);\nthis._dragSrc.addDragListener(this._dragListener.bind(this))\n}this._clearCacheFolderMap={};\nthis._apptSessionId={}\n};\nZmCalViewController.prototype=new ZmListController;\nZmCalViewController.prototype.constructor=ZmCalViewController;\nZmCalViewController.prototype.isZmCalViewController=true;\nZmCalViewController.prototype.toString=function(){return\"ZmCalViewController\"\n};\nZmCalViewController.DEFAULT_APPOINTMENT_DURATION=30*60*1000;\nZmCalViewController.MAINT_NONE=0;\nZmCalViewController.MAINT_MINICAL=1;\nZmCalViewController.MAINT_VIEW=2;\nZmCalViewController.MAINT_REMINDER=4;\nZmCalViewController.ACTION_CODE_TO_VIEW={};\nZmCalViewController.ACTION_CODE_TO_VIEW[ZmKeyMap.CAL_DAY_VIEW]=ZmId.VIEW_CAL_DAY;\nZmCalViewController.ACTION_CODE_TO_VIEW[ZmKeyMap.CAL_WEEK_VIEW]=ZmId.VIEW_CAL_WEEK;\nZmCalViewController.ACTION_CODE_TO_VIEW[ZmKeyMap.CAL_WORK_WEEK_VIEW]=ZmId.VIEW_CAL_WORK_WEEK;\nZmCalViewController.ACTION_CODE_TO_VIEW[ZmKeyMap.CAL_MONTH_VIEW]=ZmId.VIEW_CAL_MONTH;\nZmCalViewController.ACTION_CODE_TO_VIEW[ZmKeyMap.CAL_LIST_VIEW]=ZmId.VIEW_CAL_LIST;\nZmCalViewController.ACTION_CODE_TO_VIEW[ZmKeyMap.CAL_FB_VIEW]=ZmId.VIEW_CAL_FB;\nZmCalViewController.CHECKED_STATE_KEY=\"CalendarsChecked\";\nZmCalViewController.prototype.postInitListeners=function(){if(ZmZimlet.listeners&&ZmZimlet.listeners.ZmCalViewController){for(var a in ZmZimlet.listeners.ZmCalViewController){if(ZmZimlet.listeners.ZmCalViewController[a] instanceof AjxListener){this._listeners[a]=ZmZimlet.listeners.ZmCalViewController[a]\n}else{this._listeners[a]=new AjxListener(this,ZmZimlet.listeners.ZmCalViewController[a])\n}}}};\nZmCalViewController.getDefaultViewType=function(){var a=appCtxt.get(ZmSetting.CALENDAR_INITIAL_VIEW);\nif(a===\"schedule\"){a=ZmSetting.CAL_DAY\n}return ZmCalendarApp.VIEW_FOR_SETTING[a]||ZmId.VIEW_CAL_WORK_WEEK\n};\nZmCalViewController.prototype.getDefaultViewType=ZmCalViewController.getDefaultViewType;\nZmCalViewController.prototype.firstDayOfWeek=function(){return appCtxt.get(ZmSetting.CAL_FIRST_DAY_OF_WEEK)||0\n};\nZmCalViewController.prototype.setCurrentViewId=function(a){if(a!=ZmId.VIEW_CAL){ZmController.prototype.setCurrentViewId.call(this,a)\n}};\nZmCalViewController.prototype.show=function(m,b,d){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nif(!m||m==ZmId.VIEW_CAL){m=this.getCurrentViewType()||this.getDefaultViewType()\n}if(!this._viewMgr){this.createViewMgr(b);\nthis._setup(m)\n}if(!this._viewMgr.getView(m)){this._setup(m)\n}var c=this._viewMgr.getCurrentView();\nvar e=c&&c.hasFocus();\nthis._viewMgr.setView(m);\nvar a=this.getViewElements(ZmId.VIEW_CAL,this._viewMgr);\nthis._currentViewId=this._currentViewType=this._viewMgr.getCurrentViewName();\nthis._setView({view:ZmId.VIEW_CAL,viewType:this._currentViewType,elements:a,isAppView:true});\nthis.setCurrentListView(null);\nvar k=this._listView[this._currentViewId]=this._viewMgr.getCurrentView();\nthis._resetToolbarOperations(m);\nswitch(m){case ZmId.VIEW_CAL_DAY:this._miniCalendar.setSelectionMode(DwtCalendar.DAY);\nthis._navToolBar[ZmId.VIEW_CAL].setToolTip(ZmOperation.PAGE_BACK,ZmMsg.previousDay);\nthis._navToolBar[ZmId.VIEW_CAL].setToolTip(ZmOperation.PAGE_FORWARD,ZmMsg.nextDay);\nbreak;\ncase ZmId.VIEW_CAL_WORK_WEEK:this._miniCalendar.setSelectionMode(DwtCalendar.WORK_WEEK);\nthis._navToolBar[ZmId.VIEW_CAL].setToolTip(ZmOperation.PAGE_BACK,ZmMsg.previousWorkWeek);\nthis._navToolBar[ZmId.VIEW_CAL].setToolTip(ZmOperation.PAGE_FORWARD,ZmMsg.nextWorkWeek);\nbreak;\ncase ZmId.VIEW_CAL_WEEK:this._miniCalendar.setSelectionMode(DwtCalendar.WEEK);\nthis._navToolBar[ZmId.VIEW_CAL].setToolTip(ZmOperation.PAGE_BACK,ZmMsg.previousWeek);\nthis._navToolBar[ZmId.VIEW_CAL].setToolTip(ZmOperation.PAGE_FORWARD,ZmMsg.nextWeek);\nbreak;\ncase ZmId.VIEW_CAL_MONTH:this._miniCalendar.setSelectionMode(DwtCalendar.DAY);\nthis._navToolBar[ZmId.VIEW_CAL].setToolTip(ZmOperation.PAGE_BACK,ZmMsg.previousMonth);\nthis._navToolBar[ZmId.VIEW_CAL].setToolTip(ZmOperation.PAGE_FORWARD,ZmMsg.nextMonth);\nbreak;\ncase ZmId.VIEW_CAL_LIST:this._miniCalendar.setSelectionMode(DwtCalendar.DAY);\nbreak\n}if(m==ZmId.VIEW_CAL_LIST){this._navToolBar[ZmId.VIEW_CAL].setVisible(false)\n}else{if(m!=ZmId.VIEW_CAL_MONTH){this._viewMgr.getView(m).initializeTimeScroll()\n}this._navToolBar[ZmId.VIEW_CAL].setVisible(true);\nvar f=m==ZmId.VIEW_CAL_MONTH?k.getShortCalTitle():k.getCalTitle();\nthis._navToolBar[ZmId.VIEW_CAL].setText(f);\nif(!d){var l=ZmCalViewController.MAINT_VIEW;\nif(window.inlineCalSearchResponse){this.processInlineCalSearch();\nwindow.inlineCalSearchResponse=null;\nl=ZmCalViewController.MAINT_MINICAL|ZmCalViewController.MAINT_VIEW|ZmCalViewController.MAINT_REMINDER\n}this._scheduleMaintenance(l)\n}if(!this.isSearchResults){this.updateTimeIndicator(m)\n}}if(e){k.focus()\n}if(!this._calTreeController){this._calTreeController=appCtxt.getOverviewController().getTreeController(ZmOrganizer.CALENDAR);\nif(this._calTreeController){if(appCtxt.multiAccounts){var j=this._app.getOverviewContainer().getOverviews();\nfor(var g in j){this._calTreeController.addSelectionListener(g,this._treeSelectionListener)\n}}else{this._calTreeController.addSelectionListener(this._app.getOverviewId(),this._treeSelectionListener)\n}var h=appCtxt.getFolderTree();\nif(h){h.addChangeListener(new AjxListener(this,this._calTreeChangeListener))\n}}}};\nZmCalViewController.prototype.updateTimeIndicator=function(a){a=a||this.getCurrentViewType();\nthis._viewMgr.getView(a).startIndicatorTimer(this.isSearchResults)\n};\nZmCalViewController.prototype.getCalTreeController=function(){return this._calTreeController\n};\nZmCalViewController.prototype.createViewMgr=function(a){var b=a||(this._miniCalendar?this._miniCalendar.getDate():new Date());\nif(!this._miniCalendar){this._createMiniCalendar(b)\n}this._viewMgr=new ZmCalViewMgr(this._container,this,this._dropTgt);\nthis._viewMgr.setDate(b);\nthis._viewMgr.addTimeSelectionListener(new AjxListener(this,this._timeSelectionListener));\nthis._viewMgr.addDateRangeListener(new AjxListener(this,this._dateRangeListener));\nthis._viewMgr.addViewActionListener(new AjxListener(this,this._viewActionListener))\n};\nZmCalViewController.prototype.getCheckedCalendars=function(a){if(!this._checkedCalendars){this._updateCheckedCalendars()\n}return a?this._checkedCalendarsAll:this._checkedCalendars\n};\nZmCalViewController.prototype.getMainAccountCheckedCalendarIds=function(){if(!this._checkedAccountCalendarIds){this._updateCheckedCalendars()\n}return(this._checkedAccountCalendarIds.length==0)?[]:this._checkedAccountCalendarIds[0].slice(0)\n};\nZmCalViewController.prototype.getOfflineSearchCalendarIds=function(){if(!this._offlineSearchCalendarIds){var a=null;\nif(appCtxt.isWebClientOffline()){a=this._retrieveCalendarCheckedState()\n}this._updateCheckedCalendars(a)\n}return(this._offlineSearchCalendarIds)\n};\nZmCalViewController.prototype._storeCalendarCheckedState=function(){var a=this._checkedCalendarIds.join(\":\");\nlocalStorage.setItem(ZmCalendarApp.CHECKED_STATE_KEY,a)\n};\nZmCalViewController.prototype._retrieveCalendarCheckedState=function(){var b=localStorage.getItem(ZmCalendarApp.CHECKED_STATE_KEY);\nvar a=b.split(\":\");\nvar d={};\nfor(var c=0;\nc<a.length;\nc++){d[a[c]]=true\n}return d\n};\nZmCalViewController.prototype.getUncheckedCalendarIdsByOwner=function(c){var f=appCtxt.getTree(ZmId.ORG_CALENDAR,appCtxt.getActiveAccount()),g=f.getByType(ZmId.ORG_CALENDAR),a=g.length,e=[],d,b;\nfor(b=0;\nb<a;\nb++){d=g[b];\nif(!d.isChecked&&d.owner&&d.owner==c){e.push(d.id)\n}}return e\n};\nZmCalViewController.prototype.getCheckedCalendarFolderIds=function(a,b){if(!this._checkedCalendarIds){this.getCheckedCalendars(b);\nif(!this._checkedCalendarIds){return[ZmOrganizer.ID_CALENDAR]\n}}return a?this._checkedLocalCalendarIds:this._checkedCalendarIds\n};\nZmCalViewController.prototype.getOwnedCalendarIds=function(a,c){var b,e,f,d=[];\nif(!this._calTreeController){this._calTreeController=appCtxt.getOverviewController().getTreeController(ZmOrganizer.CALENDAR)\n}f=this._calTreeController.getOwnedCalendars(this._app.getOverviewId(),a);\nfor(b=0;\nb<f.length;\nb++){e=f[b];\nif(e){if(!c&&(e.nId==ZmFolder.ID_TRASH)){continue\n}d.push(appCtxt.multiAccounts?e.id:e.nId)\n}}return d\n};\nZmCalViewController.prototype.getReminderCalendarFolderIds=function(){if(!this._reminderCalendarIds){this._updateCheckedCalendars();\nif(!this._reminderCalendarIds){return[ZmOrganizer.ID_CALENDAR]\n}}return this._reminderCalendarIds\n};\nZmCalViewController.prototype.getCheckedOrganizers=function(f,h){var a=appCtxt.getOverviewController();\nvar g=appCtxt.getApp(ZmApp.CALENDAR).getOverviewId(h);\nvar e=ZmOrganizer.CALENDAR;\nvar b=a.getTreeView(g,e);\nvar c=b.getSelected();\nif(!f){for(var d=0;\nd<c.length;\nd++){if(c[d].id==ZmOrganizer.ID_TRASH){c.splice(d,1);\nbreak\n}}}return c\n};\nZmCalViewController.prototype.getCheckedOrganizerIds=function(){return AjxUtil.map(this.getCheckedOrganizers(),ZmCalViewController.__map_id)\n};\nZmCalViewController.__map_id=function(a){return a.id\n};\nZmCalViewController.prototype._updateCheckedCalendars=function(d){var n=[];\nif(this._calTreeController){if(appCtxt.multiAccounts){var g=this._app.getOverviewContainer().getOverviews();\nfor(var f in g){n=n.concat(this._calTreeController.getCalendars(f))\n}}else{if(!this._app._overviewPanelContent){this._app.setOverviewPanelContent(true)\n}n=this._calTreeController.getCalendars(this._app.getOverviewId())\n}}else{this._app._createDeferredFolders(ZmApp.CALENDAR);\nvar q=window.parentAppCtxt||window.appCtxt;\nvar k=q.accountList.visibleAccounts;\nfor(var f=0;\nf<k.length;\nf++){var l=k[f];\nif(!q.get(ZmSetting.CALENDAR_ENABLED,null,l)){continue\n}var c=q.getFolderTree(l);\nvar m=c&&c.getByType(ZmOrganizer.CALENDAR);\nif(m){for(var e=0;\ne<m.length;\ne++){if(l.isCalDavBased()&&m[e].nId==ZmOrganizer.ID_CALENDAR){continue\n}n.push(m[e])\n}}}}this._checkedCalendars=[];\nthis._checkedCalendarIds=[];\nthis._checkedLocalCalendarIds=[];\nthis._checkedAccountCalendarIds=[];\nthis._offlineSearchCalendarIds=[];\nthis._reminderCalendarIds=[];\nvar a={};\nvar h=null;\nfor(var f=0;\nf<n.length;\nf++){var b=n[f];\nif(!b.noSuchFolder){this._offlineSearchCalendarIds.push(b.id)\n}if(!b.noSuchFolder&&(b.id!=ZmOrganizer.ID_TRASH)&&(b.isRemote&&!b.isRemote())){this._reminderCalendarIds.push(b.id)\n}var p=b.isChecked;\nif(d){p=d[b.id]?true:false;\nb.isChecked=p\n}if(p){if(b.id==ZmOrganizer.ID_TRASH){h=b\n}else{this._checkedCalendars.push(b)\n}if(!b.noSuchFolder){this._checkedCalendarIds.push(b.id);\nif(b.isRemote&&!b.isRemote()){this._checkedLocalCalendarIds.push(b.id)\n}var o=(appCtxt.multiAccounts)?b.getAccount().id:appCtxt.accountList.mainAccount.id;\nif(!a[o]){a[o]=[]\n}a[o].push(b.id)\n}}}this._checkedCalendarsAll=h?this._checkedCalendars.concat(h):this._checkedCalendars;\nfor(var f in a){this._checkedAccountCalendarIds.push(a[f])\n}if(!d){this._storeCalendarCheckedState()\n}return this._checkedCalendars\n};\nZmCalViewController.prototype._calTreeSelectionListener=function(e){if(e.detail!=DwtTree.ITEM_CHECKED){return\n}this._updateCheckedCalendars();\nif(!this._calItemStatus){this._calItemStatus={}\n}if(e.item){var a=e.item.getData&&e.item.getData(Dwt.KEY_OBJECT);\nif(a&&a.nId==ZmOrganizer.ID_TRASH){var f=false;\nvar h=a.getAccount();\nvar b=this.getCheckedOrganizers(true,h);\nfor(var c=0;\nc<b.length;\nc++){var g=b[c].nId;\nif(g==ZmOrganizer.ID_TRASH){f=true;\nbreak\n}}this._viewMgr.setSubContentVisible(f);\nreturn\n}e.items=[e.item]\n}if(e.items&&e.items.length){for(var c=0;\nc<e.items.length;\nc++){var d=e.items[c];\nthis.__addCalItemStatus(d,d.getChecked())\n}}if(!this._updateCalItemStateActionId){this._updateCalItemStateActionId=AjxTimedAction.scheduleAction(new AjxTimedAction(this,this._updateCalItemState),1200)\n}};\nZmCalViewController.prototype.__addCalItemStatus=function(e,d){e.setChecked(d);\nvar a=e.getData(Dwt.KEY_OBJECT);\nif(a&&a.type==ZmOrganizer.CALENDAR){AjxDebug.println(AjxDebug.CALENDAR,\" ---------------- calendar \"+a.name+\" [\"+a.id+\"] is \"+(d?\"checked\":\"unchecked\"));\nthis._calItemStatus[a.id]={item:a,checked:d}\n}var b=e.getItems();\nfor(var c=0;\nc<b.length;\nc++){e=b[c];\nthis.__addCalItemStatus(e,d)\n}};\nZmCalViewController.prototype._updateCalItemState=function(){if(!this._calItemStatus){return\n}var b=appCtxt.isOffline&&appCtxt.accountList.mainAccount.name;\nvar a=new ZmBatchCommand(null,b,true);\nvar f=0;\nfor(var c in this._calItemStatus){var e=this._calItemStatus[c];\nif(e.item){var d=e.item;\nif((d.isRemote()&&(!d.isMountpoint||!d.zid))){d.isChecked=e.checked;\nd.checkedCallback(e.checked);\nthis._handleCheckedCalendarRefresh(d)\n}else{a.add(new AjxCallback(d,d.checkAction,[e.checked]));\nf++\n}}}if(appCtxt.multiAccounts){this.apptCache.clearCache()\n}if(f>0){if(appCtxt.isWebClientOffline()){var g=this._handleOfflineCalendarCheck.bind(this,a);\na.run(null,null,g)\n}else{this._calItemStatus={};\na.run()\n}}this._updateCalItemStateActionId=null\n};\nZmCalViewController.prototype._handleOfflineCalendarCheck=function(a){var h=a.getRequestBody();\nthis.apptCache.clearCache();\nvar b=[];\nfor(var c in this._calItemStatus){var f=this._calItemStatus[c];\nif(f.item){var e=f.item;\nb.push(e.id);\nif(!(e.isRemote()&&(!e.isMountpoint||!e.zid))){e.isChecked=f.checked;\ne.checkedCallback(f.checked);\nthis._handleCheckedCalendarRefresh(e)\n}}}this._calItemStatus={};\nvar g=$.extend(true,{},h);\ng.methodName=\"BatchRequest\";\ng.id=\"C\"+b.join(\":\");\nvar d={update:true,methodName:g.methodName,id:g.id,value:g};\nZmOfflineDB.setItemInRequestQueue(d)\n};\nZmCalViewController.prototype._handleCheckedCalendarRefresh=function(a){this._updateCheckedCalendars();\nthis._refreshAction(true)\n};\nZmCalViewController.prototype._calTreeChangeListener=function(c){if(c.event==ZmEvent.E_DELETE){this._updateCheckedCalendars()\n}if(c.event==ZmEvent.E_MODIFY){var b=c.getDetails(),a=b?b.fields:null;\nif(a&&(a[ZmOrganizer.F_COLOR]||a[ZmOrganizer.F_RGB])){this._refreshAction(true)\n}}};\nZmCalViewController.prototype.getApptCache=function(){return this.apptCache\n};\nZmCalViewController.prototype.getCalendar=function(a){return appCtxt.getById(a)\n};\nZmCalViewController.prototype.getCalendars=function(f){f=f||{};\nvar e=f.account;\nvar d=f.includeLinks;\nvar h=f.onlyWritable;\nthis._updateCheckedCalendars();\nvar g=[];\nvar b=appCtxt.getFolderTree(e).getByType(ZmOrganizer.CALENDAR);\nfor(var c=0;\nc<b.length;\nc++){var a=b[c];\nif((a.zid&&!d)||(appCtxt.multiAccounts&&a.nId==ZmOrganizer.ID_CALENDAR&&a.getAccount().isCalDavBased())){continue\n}if(e&&a.getAccount()!=e){continue\n}if(h&&a.isReadOnly()){continue\n}g.push(a)\n}g.sort(ZmCalViewController.__BY_NAME);\nreturn g\n};\nZmCalViewController.__BY_NAME=function(d,c){return d.name.localeCompare(c.name)\n};\nZmCalViewController.prototype.getDefaultCalendarFolderId=function(){return appCtxt.get(ZmSetting.CAL_DEFAULT_ID)\n};\nZmCalViewController.prototype.getCalendarColor=function(a){if(!a){return ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.CALENDAR]\n}var b=this.getCalendar(a);\nreturn b?b.color:ZmOrganizer.DEFAULT_COLOR[ZmOrganizer.CALENDAR]\n};\nZmCalViewController.prototype._refreshButtonListener=function(a){if(this.searchInProgress){return\n}this.setCurrentListView(null);\nif(appCtxt.isOffline){appCtxt.accountList.syncAll()\n}var d=appCtxt.getApp(ZmApp.CALENDAR);\nthis._userQuery=null;\nif(d===appCtxt.getCurrentApp()){var c=appCtxt.getSearchController();\nc.setSearchField(\"\");\nc.getSearchToolbar().blur()\n}d.currentSearch=null;\nd.currentQuery=null;\nthis._refreshMaintenance=true;\nthis.searchInProgress=false;\nthis._refreshAction(false);\nvar b=appCtxt.getOverviewController().getOverview(d.getOverviewId());\nif(b){b.clearSelection()\n}};\nZmCalViewController.prototype._apptMoveListener=function(c){var a=this.getSelection();\nvar b=(a.length>1)?this._divvyItems(a):null;\nif(b&&b.readonly.length>0){var f=appCtxt.getMsgDialog();\nvar e=[];\nif(b.normal.length>0){e=e.concat(b.normal)\n}if(b.recurring.length>0){e=e.concat(this._dedupeSeries(b.recurring))\n}var g=(e.length>0)?(new AjxCallback(this,this._moveListener,[c,e])):null;\nvar d=new AjxListener(this,this._handleReadonlyOk,[g,f]);\nf.setButtonListener(DwtDialog.OK_BUTTON,d);\nf.setMessage(ZmMsg.moveReadonly);\nf.popup()\n}else{this._moveListener(c,this._dedupeSeries(a))\n}};\nZmCalViewController.prototype._isItemMovable=function(c,a,b){return(!a&&!b.isReadOnly()&&!appCtxt.isWebClientOffline())\n};\nZmCalViewController.prototype._moveCallback=function(a){if(this.isMovingBetwAccounts(this._pendingActionData,a.id)){var b=appCtxt.getMsgDialog();\nb.setMessage(ZmMsg.orgChange,DwtMessageDialog.WARNING_STYLE);\nb.popup();\nreturn false\n}else{if(this.isMovingBetwAcctsAsAttendee(this._pendingActionData,a.id)){var b=appCtxt.getMsgDialog();\nb.setMessage(ZmMsg.apptInviteOnly,DwtMessageDialog.WARNING_STYLE);\nb.popup()\n}else{this._doMove(this._pendingActionData,a,null,false);\nthis._clearDialog(appCtxt.getChooseFolderDialog());\nthis._pendingActionData=null\n}}};\nZmCalViewController.prototype._changeOrgCallback=function(b,a){b.popdown();\nZmListController.prototype._moveCallback.call(this,a)\n};\nZmCalViewController.prototype._doTag=function(b,a,g){var d=this._getTaggableItems(b);\nif(g){if(d.length>0&&d.length==b.length){ZmListController.prototype._doTag.call(this,d,a,g)\n}else{var f;\nvar e=appCtxt.getMsgDialog();\nif(d.length>0&&d.length<b.length){var c=new AjxListener(this,this._handleDoTag,[e,d,a,g]);\ne.setButtonListener(DwtDialog.OK_BUTTON,c);\nf=ZmMsg.tagReadonly\n}else{if(d.length==0){f=ZmMsg.nothingToTag\n}}e.setMessage(f);\ne.popup()\n}}else{if(d.length>0){ZmListController.prototype._doTag.call(this,d,a,g)\n}}};\nZmCalViewController.prototype._doRemoveAllTags=function(a){var b=this._getTaggableItems(a);\nZmListController.prototype._doRemoveAllTags.call(this,b)\n};\nZmCalViewController.prototype._handleDoTag=function(c,b,a,d){c.popdown();\nZmListController.prototype._doTag.call(this,b,a,d)\n};\nZmCalViewController.prototype._getTaggableItems=function(a){var d=(a.length>1)?this._divvyItems(a):null;\nif(d&&(d.readonly.length>0||d.shared.length>0)){a=[];\nfor(var c in d){if(c==\"shared\"){continue\n}var f=d[c];\nfor(var b=0;\nb<f.length;\nb++){var e=f[b];\nvar g=e.getFolder();\nif(g&&!g.isRemote()){a.push(e)\n}}}}return a\n};\nZmCalViewController.prototype._getToolBarOps=function(){var a=[ZmOperation.DELETE,ZmOperation.SEP,ZmOperation.MOVE_MENU,ZmOperation.TAG_MENU,ZmOperation.SEP,ZmOperation.PRINT_CALENDAR,ZmOperation.SEP,ZmOperation.TODAY,ZmOperation.FILLER,ZmOperation.DAY_VIEW,ZmOperation.WORK_WEEK_VIEW,ZmOperation.WEEK_VIEW,ZmOperation.MONTH_VIEW,ZmOperation.CAL_LIST_VIEW];\nif(appCtxt.get(ZmSetting.FREE_BUSY_VIEW_ENABLED)){a.push(ZmOperation.FB_VIEW)\n}return a\n};\nZmCalViewController.prototype._initializeToolBar=function(b){if(this._toolbar[ZmId.VIEW_CAL]){return\n}ZmListController.prototype._initializeToolBar.call(this,ZmId.VIEW_CAL_DAY);\nvar d=this._toolbar[ZmId.VIEW_CAL_DAY];\nthis._toolbar[ZmId.VIEW_CAL_FB]=this._toolbar[ZmId.VIEW_CAL_WEEK]=this._toolbar[ZmId.VIEW_CAL_WORK_WEEK]=this._toolbar[ZmId.VIEW_CAL_MONTH]=this._toolbar[ZmId.VIEW_CAL_LIST]=this._toolbar[ZmId.VIEW_CAL_DAY];\nthis._toolbar[ZmId.VIEW_CAL]=d;\nd.enable([ZmOperation.PAGE_BACK,ZmOperation.PAGE_FORWARD],true);\nd.enable([ZmOperation.WEEK_VIEW,ZmOperation.MONTH_VIEW,ZmOperation.DAY_VIEW],true);\nvar e=AjxUtil.indexOf(this._getToolBarOps(),ZmOperation.FILLER)+1;\nvar c=new ZmNavToolBar({parent:d,index:e,className:\"ZmNavToolbar ZmCalendarNavToolbar\",context:ZmId.VIEW_CAL,posStyle:Dwt.ABSOLUTE_STYLE});\nthis._setNavToolBar(c,ZmId.VIEW_CAL);\nvar a=d.getButton(ZmOperation.PRINT_CALENDAR);\nif(a){a.setToolTipContent(ZmMsg.printCalendar)\n}d.getButton(ZmOperation.DELETE).setToolTipContent(ZmMsg.hardDeleteTooltip);\nappCtxt.notifyZimlets(\"initializeToolbar\",[this._app,d,this,b],{waitUntilLoaded:true})\n};\nZmCalViewController.prototype._initializeTabGroup=function(b){if(this._tabGroups[b]){return\n}ZmListController.prototype._initializeTabGroup.apply(this,arguments);\nif(b===ZmId.VIEW_CAL_LIST){var c=this._view[b];\nvar a=c._getSearchBarTabGroup();\nthis._tabGroups[b].addMemberBefore(a,c)\n}};\nZmCalViewController.prototype.runRefresh=function(){this._refreshButtonListener()\n};\nZmCalViewController.prototype._setView=function(a){if(!this.isSearchResults){ZmListController.prototype._setView.apply(this,arguments)\n}};\nZmCalViewController.prototype._setViewContents=function(a){};\nZmCalViewController.prototype._getTagMenuMsg=function(a){return AjxMessageFormat.format(ZmMsg.tagAppts,a)\n};\nZmCalViewController.prototype._createNewView=function(a){return this._viewMgr.createView(a)\n};\nZmCalViewController.prototype._viewActionMenuItemListener=function(b){Dwt.setLoadingTime(\"ZmCalItemView\");\nif(appCtxt.multiAccounts){this.apptCache.clearCache()\n}var c=b.item.getData(ZmOperation.KEY_ID);\nvar a=ZmCalViewController.OP_TO_VIEW[c];\nif(this.getCurrentViewType()===a){return\n}this.show(a)\n};\nZmCalViewController.prototype._viewMenuItemListener=function(a){};\nZmCalViewController.prototype._createMiniCalendar=function(a){var b=appCtxt.getCalManager();\nif(b._miniCalendar==null){b._createMiniCalendar(a);\nthis._miniCalendar=b.getMiniCalendar()\n}else{this._miniCalendar=b.getMiniCalendar();\nif(a!=null){this._miniCalendar.setDate(a,true)\n}}this._minicalMenu=b._miniCalMenu;\nthis._miniCalDropTarget=b._miniCalDropTarget\n};\nZmCalViewController.prototype.recreateMiniCalendar=function(){var d=appCtxt.getCalManager();\nif(d._miniCalendar!=null){var c=d.getMiniCalendar();\nvar b=c.getHtmlElement();\nvar a=c.getDate();\nif(b){b.parentNode.removeChild(b)\n}this._miniCalendar=null;\nd._miniCalendar=null;\nd._createMiniCalendar(a);\nthis._miniCalendar=d.getMiniCalendar();\nthis._createMiniCalendar()\n}};\nZmCalViewController.prototype._miniCalDropTargetListener=function(g){if(appCtxt.isWebClientOffline()){return\n}var h=((g.srcData.data instanceof Array)&&g.srcData.data.length==1)?g.srcData.data[0]:g.srcData.data;\nvar f=appCtxt.get(ZmSetting.TASKS_ENABLED)&&g.uiEvent.shiftKey;\nif(g.action==DwtDropEvent.DRAG_ENTER){if(h instanceof Array&&h.length>1){var b=false;\nfor(var e=0;\ne<h.length;\ne++){if(!f&&(h[e] instanceof ZmContact)){if(h[e].isGroup()&&h[e].getGroupMembers().good.size()>0){b=true\n}else{var d=h[e].getEmail();\nif(d&&d!=\"\"){b=true\n}}}else{g.doIt=false;\nreturn\n}}if(!b){g.doIt=false;\nreturn\n}}else{if(!this._miniCalDropTarget.isValidTarget(h)){g.doIt=false;\nreturn\n}if(!f&&h.isZmContact){if(h.isGroup()&&!h.isDistributionList()){g.doIt=(h.getGroupMembers().good.size()>0)\n}else{var d=h.getEmail();\ng.doIt=(d!=null&&d!=\"\")\n}}}}else{if(g.action==DwtDropEvent.DRAG_DROP){var a=this._miniCalendar.getDndDate();\nif(a){var c=new Date();\na.setHours(c.getHours());\na.setMinutes(c.getMinutes());\na=AjxDateUtil.roundTimeMins(a,30);\nif((h instanceof ZmContact)||((h instanceof Array)&&h[0] instanceof ZmContact)){this.newApptFromContact(h,a)\n}else{if(f){AjxDispatcher.require([\"TasksCore\",\"Tasks\"]);\nappCtxt.getApp(ZmApp.TASKS).newTaskFromMailItem(h,a)\n}else{this.newApptFromMailItem(h,a)\n}}}}}};\nZmCalViewController.prototype.newApptFromMailItem=function(c,a){var b=c.subject||\"\";\nif(c instanceof ZmConv){c=c.getFirstHotMsg()\n}c.load({getHtml:false,markRead:true,forceLoad:true,noTruncate:true,callback:new AjxCallback(this,this._msgLoadedCallback,[c,a,b])})\n};\nZmCalViewController.prototype._msgLoadedCallback=function(e,a,d){var c=this._newApptObject(a,null,null,e);\nc.setFromMailMessage(e,d);\nif(appCtxt.get(ZmSetting.GROUP_CALENDAR_ENABLED)){var b=this._attAttendeeDlg=appCtxt.getYesNoMsgDialog();\nb.reset();\nb.setMessage(ZmMsg.addRecipientstoAppt,DwtMessageDialog.WARNING_STYLE,ZmMsg.addAttendees);\nb.registerCallback(DwtDialog.YES_BUTTON,this._addAttendeeYesCallback,this,[c]);\nb.registerCallback(DwtDialog.NO_BUTTON,this._addAttendeeNoCallback,this,[c]);\nb.popup()\n}else{this.newAppointment(c,ZmCalItem.MODE_NEW,true)\n}};\nZmCalViewController.prototype._addAttendeeYesCallback=function(a){this._attAttendeeDlg.popdown();\nthis.newAppointment(a,ZmCalItem.MODE_NEW,true)\n};\nZmCalViewController.prototype._addAttendeeNoCallback=function(a){this._attAttendeeDlg.popdown();\na.setAttendees(null,ZmCalBaseItem.PERSON);\nthis.newAppointment(a,ZmCalItem.MODE_NEW,true)\n};\nZmCalViewController.prototype.newApptFromContact=function(g,a){var f=[];\nvar l=AjxUtil.toArray(g);\nfor(var d=0;\nd<l.length;\nd++){var m=l[d];\nif(m.isGroup()&&!m.isDistributionList()){var c=m.getGroupMembers().good.getArray();\nfor(var b=0;\nb<c.length;\nb++){var k=c[b].address;\nif(k&&k!==\"\"){f.push(k)\n}}}else{var k=m.getEmail();\nif(k&&k!==\"\"){f.push(k)\n}}}if(f.length>0){var h=this._newApptObject(a);\nh.setAttendees(f,ZmCalBaseItem.PERSON);\nthis.newAppointment(h,ZmCalItem.MODE_NEW)\n}};\nZmCalViewController.prototype.newApptFromEmailAddr=function(a,b){if(!a||a==\"\"){return\n}var c=this._newApptObject(b);\nc.setAttendees(a,ZmCalBaseItem.PERSON);\nthis.newAppointment(c,ZmCalItem.MODE_NEW)\n};\nZmCalViewController.prototype.getMiniCalendar=function(a){if(!this._miniCalendar){this._createMiniCalendar(null,a)\n}return this._miniCalendar\n};\nZmCalViewController.prototype._todayButtonListener=function(a){this.setCurrentListView(null);\nthis.setDate(new Date(),0,false)\n};\nZmCalViewController.prototype._newApptAction=function(c){var f=this._minicalMenu?this._minicalMenu.__detail:null;\nif(f!=null){delete this._minicalMenu.__detail\n}else{f=this._viewMgr?this._viewMgr.getDate():null\n}var e=this._viewVisible?this._viewMgr.getDate():new Date();\nif(f==null){f=e\n}else{f.setHours(e.getHours());\nf.setMinutes(e.getMinutes())\n}var b=null;\nif(this._viewActionMenu&&this._viewActionMenu._calendarId){b=this._viewActionMenu._calendarId;\nthis._viewActionMenu._calendarId=null\n}var a=new AjxCallback(this,this._handleLoadNewApptAction,[f,b]);\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"],false,a,null,true)\n};\nZmCalViewController.prototype._handleLoadNewApptAction=function(b,a){appCtxt.getAppViewMgr().popView(true,ZmId.VIEW_LOADING);\nthis.newAppointmentHelper(b,null,a)\n};\nZmCalViewController.prototype._searchMailAction=function(a){var b=this._minicalMenu?this._minicalMenu.__detail:null;\nif(b!=null){delete this._minicalMenu.__detail;\nappCtxt.getSearchController().dateSearch(b,ZmId.SEARCH_MAIL)\n}};\nZmCalViewController.prototype._newAllDayApptAction=function(c){var e=this._minicalMenu?this._minicalMenu.__detail:null;\nif(e!=null){delete this._minicalMenu.__detail\n}else{e=this._viewMgr?this._viewMgr.getDate():null\n}if(e==null){e=new Date()\n}var b=null;\nif(this._viewActionMenu&&this._viewActionMenu._calendarId){b=this._viewActionMenu._calendarId;\nthis._viewActionMenu._calendarId=null\n}var a=new AjxCallback(this,this._handleLoadNewAllDayApptAction,[e,b]);\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"],false,a,null,true)\n};\nZmCalViewController.prototype._handleLoadNewAllDayApptAction=function(b,a){appCtxt.getAppViewMgr().popView(true,ZmId.VIEW_LOADING);\nthis.newAllDayAppointmentHelper(b,null,a)\n};\nZmCalViewController.prototype._postShowCallback=function(){ZmController.prototype._postShowCallback.call(this);\nthis._viewVisible=true;\nif(this._viewMgr.needsRefresh()){this._scheduleMaintenance(ZmCalViewController.MAINT_MINICAL|ZmCalViewController.MAINT_VIEW)\n}};\nZmCalViewController.prototype._postHideCallback=function(){if(appCtxt.multiAccounts){var a=this._app.getOverviewContainer();\nvar d=a.getOverviews();\nvar c;\nfor(var b in d){a.getOverview(b).zShow(false)\n}}else{c=this._app.getOverview();\nc.zShow(false)\n}this._viewVisible=false\n};\nZmCalViewController.prototype.isCurrent=function(){var a=this._viewMgr&&this._viewMgr.getCurrentViewName();\nreturn(this._currentViewId===a)\n};\nZmCalViewController.prototype._paginate=function(a,c){this.setCurrentListView(null);\nvar b=this._listView[a];\nvar e=b.getRollField();\nvar f=new Date(this._viewMgr.getDate());\nf=AjxDateUtil.roll(f,e,c?1:-1);\nthis.setDate(f,0,true);\nthis._viewMgr.getView(a).checkIndicatorNeed(a,f)\n};\nZmCalViewController.prototype.setDate=function(c,d,b){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nif(this._miniCalendar.getDate()==null||this._miniCalendar.getDate().getTime()!=c.getTime()){this._miniCalendar.setDate(c,true,b)\n}if(this._viewMgr!=null){this._viewMgr.setDate(c,d,b);\nvar a=this._viewMgr.getCurrentViewName();\nvar f=this._viewMgr.getCurrentView();\nvar e=f.getCalTitle();\nDwt.setTitle([ZmMsg.zimbraTitle,\": \",e].join(\"\"));\nif(!b&&this._currentViewType==ZmId.VIEW_CAL_WORK_WEEK&&!f.workingHours[c.getDay()].isWorkingDay&&(c.getDay()==0||c.getDay()==6)){this.show(ZmId.VIEW_CAL_WEEK)\n}if(ZmId.VIEW_CAL_MONTH==this._currentViewType){e=this._viewMgr.getCurrentView().getShortCalTitle()\n}if(ZmId.VIEW_CAL_FB==this._currentViewType&&b&&appCtxt.get(ZmSetting.FREE_BUSY_VIEW_ENABLED)){f._navDateChangeListener(c)\n}this._navToolBar[ZmId.VIEW_CAL].setText(e)\n}};\nZmCalViewController.prototype._dateSelectionListener=function(a){this.setDate(a.detail,0,a.force)\n};\nZmCalViewController.prototype._miniCalSelectionListener=function(b){if(b.item instanceof DwtCalendar){var a=new AjxCallback(this,this._handleLoadMiniCalSelection,[b]);\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"],false,a,null,true)\n}};\nZmCalViewController.prototype._handleLoadMiniCalSelection=function(a){this.setDate(a.detail,0,a.item.getForceRollOver());\nif(!this._viewVisible){this.show()\n}};\nZmCalViewController.prototype.newApptObject=function(a,c,b,d){return this._newApptObject(a,c,b,d)\n};\nZmCalViewController.prototype._newApptObject=function(d,f,c,a){var g=new ZmAppt();\ng.setStartDate(AjxDateUtil.roundTimeMins(d,parseInt(appCtxt.get(ZmSetting.CAL_SCALING),10)));\ng.setEndDate(g.getStartTime()+(f?f:ZmCalViewController.DEFAULT_APPOINTMENT_DURATION));\ng.resetRepeatWeeklyDays();\ng.resetRepeatMonthlyDayList();\ng.resetRepeatYearlyMonthsList(d.getMonth()+1);\ng.resetRepeatCustomDayOfWeek();\nvar h=appCtxt.get(ZmSetting.CAL_REMINDER_WARNING_TIME);\nif(h){g.setReminderMinutes(h)\n}if(c){g.setFolderId(c)\n}else{if(appCtxt.multiAccounts&&a){g.setFolderId(a.getAccount().getDefaultCalendar().id)\n}else{var e=this.getCheckedCalendarFolderIds();\nif(e&&e.length==1){var i=e[0];\nvar b=appCtxt.getById(i);\nif(b){var k=b.getMainShare();\nvar j=(b.isFeed()||(b.link&&k&&!k.isWrite()));\nif(b&&!j){g.setFolderId(i)\n}}}}}g.setPrivacy((appCtxt.get(ZmSetting.CAL_APPT_VISIBILITY)==ZmSetting.CAL_VISIBILITY_PRIV)?\"PRI\":\"PUB\");\nreturn g\n};\nZmCalViewController.prototype._timeSelectionListener=function(c){if(!this._app.containsWritableFolder()){return\n}var a=this._viewMgr.getCurrentView();\nif(a.getSelectedItems().size()>0){a.deselectAll();\nthis._resetOperations(this._toolbar[ZmId.VIEW_CAL_DAY],0)\n}this.setDate(c.detail,0,c.force);\nif(c._isDblClick){this._apptFromView=a;\nvar b=this._newApptObject(c.detail);\nb.setAllDayEvent(c.isAllDay);\nif(c.folderId){b.setFolderId(c.folderId)\n}this._showQuickAddDialog(b,c.shiftKey)\n}};\nZmCalViewController.prototype._printCalendarListener=function(f){var d,b=this._viewMgr.getCurrentViewName(),a=this._printDialog,e=ZmCalBaseView.parseWorkingHours(ZmCalBaseView.getWorkingHours()),c=this._viewMgr.getDate()||new Date();\nif(!a){a=this.createPrintDialog()\n}var h=ZmApp.ORGANIZER[this._app._name]||ZmOrganizer.FOLDER;\nvar g={overviewId:appCtxt.getOverviewId([\"ZmCalPrintDialog\",this._app._name],null),treeIds:[h],treeStyle:DwtTree.CHECKEDITEM_STYLE,appName:this._app._name,currentViewId:b,workHours:e[c.getDay()],currentDate:c,timeRange:this.getViewMgr().getView(b).getTimeRange()};\na.popup(g);\nthis._printDialog=a\n};\nZmCalViewController.prototype.createPrintDialog=function(){var b,c={},a=this._viewMgr.getDate()||new Date();\nc.parent=this._shell;\nb=new ZmCalPrintDialog(c);\nreturn b\n};\nZmCalViewController.prototype._printListener=function(e){var c=[];\nvar g=this.getSelection();\nif(g.length==0){var f=this.getActionMenu();\nvar d=f.__appt;\nif(d){c.push(d.invId)\n}else{this._printCalendarListener(e)\n}}else{for(var b=0;\nb<g.length;\nb++){c.push(g[b].invId)\n}}if(c.length==0){return\n}var a=[\"/h/printappointments?id=\",c.join(\",\"),\"&tz=\",AjxTimezone.getServerId(AjxTimezone.DEFAULT)];\nif(appCtxt.isOffline){if(c.length==1){var d=this.getSelection()[0];\na.push(\"&acct=\",d.getFolder().getAccount().name)\n}a.push(\"&zd=\",\"true\")\n}a=a.join(\"\");\nwindow.open(appContextPath+a,\"_blank\")\n};\nZmCalViewController.prototype._deleteListener=function(a){var b=(a&&a.item instanceof DwtMenuItem)?a.item.parent.getData(ZmOperation.KEY_ID):null;\nthis._doDelete(this.getSelection(),null,null,b)\n};\nZmCalViewController.prototype._replyListener=function(b){var c=(b&&b.item instanceof DwtMenuItem)?b.item.parent.getData(ZmOperation.KEY_ID):null;\nvar a=this.getSelection();\nif(a&&a.length){this._replyAppointment(a[0],false)\n}};\nZmCalViewController.prototype._replyAllListener=function(b){var c=(b&&b.item instanceof DwtMenuItem)?b.item.parent.getData(ZmOperation.KEY_ID):null;\nvar a=this.getSelection();\nif(a&&a.length){this._replyAppointment(a[0],true)\n}};\nZmCalViewController.prototype._forwardListener=function(a){var b=(a&&a.item instanceof DwtMenuItem)?a.item.parent.getData(ZmOperation.KEY_ID):null;\nthis._doForward(this.getSelection(),b)\n};\nZmCalViewController.prototype._duplicateApptListener=function(c){var e=(c&&c.item instanceof DwtMenuItem)?c.item.parent.getData(ZmOperation.KEY_ID):null;\nvar a=this.getSelection();\nvar b=a[0];\nvar d=(b.isRecurring()&&e==ZmOperation.VIEW_APPT_INSTANCE);\nthis.duplicateAppt(b,{isException:d})\n};\nZmCalViewController.prototype.duplicateAppt=function(a,c){Dwt.setLoadingTime(\"ZmCalendarApp-cloneAppt\");\nvar d=ZmAppt.quickClone(a);\nvar b=ZmCalItem.MODE_EDIT;\nif(a.isRecurring()){b=c.isException?ZmCalItem.MODE_COPY_SINGLE_INSTANCE:ZmCalItem.MODE_EDIT_SERIES\n}d.getDetails(b,new AjxCallback(this,this._duplicateApptContinue,[d,ZmCalItem.MODE_NEW,c]));\nDwt.setLoadedTime(\"ZmCalendarApp-cloneAppt\")\n};\nZmCalViewController.prototype._duplicateApptContinue=function(b,f,e){if(e.isException){b.clearRecurrence()\n}if(e.startDate){b.setStartDate(e.startDate)\n}if(e.endDate){b.setEndDate(e.endDate)\n}if(!b.isOrganizer()||b.isReadOnly()){var h=b.organizer;\nvar a=b.getFolder().getAccount().getEmail();\nb.replaceAttendee(a,h);\nb.organizer=a;\nb.isOrg=true;\nif(b.isShared()){b.isSharedCopy=true;\nif(!b.getFolderId()){b.setFolderId(ZmOrganizer.ID_CALENDAR)\n}}var d=appCtxt.getMsgDialog();\nvar g=new AjxCallback(this,this.newAppointment,[b,f,true]);\nvar c=new AjxListener(this,this._handleReadonlyOk,[g,d]);\nd.setButtonListener(DwtDialog.OK_BUTTON,c);\nd.setMessage(ZmMsg.confirmApptDuplication);\nd.popup()\n}else{b.organizer=null;\nthis.newAppointment(b,f,true)\n}};\nZmCalViewController.prototype._proposeTimeListener=function(c){var f=c.item.parent.getData(ZmOperation.KEY_ID);\nvar a=this.getSelection();\nif(this._viewMgr.getCurrentViewName()==ZmId.VIEW_CAL_LIST&&a.length>1){return\n}var d=ZmCalItem.MODE_EDIT;\nif(f==ZmOperation.VIEW_APPT_INSTANCE||f==ZmOperation.VIEW_APPT_SERIES){d=(f==ZmOperation.VIEW_APPT_INSTANCE)?ZmCalItem.MODE_EDIT_SINGLE_INSTANCE:ZmCalItem.MODE_EDIT_SERIES\n}var b=a[0];\nvar e=ZmAppt.quickClone(b);\ne.setProposeTimeMode(true);\ne.getDetails(d,new AjxCallback(this,this._proposeTimeContinue,[e,d]))\n};\nZmCalViewController.prototype._proposeTimeContinue=function(a,b){a.setViewMode(b);\nAjxDispatcher.run(\"GetApptComposeController\").proposeNewTime(a)\n};\nZmCalViewController.prototype._reinviteAttendeesListener=function(c){var a=this.getSelection();\nif(this._viewMgr.getCurrentViewName()==ZmId.VIEW_CAL_LIST&&a.length>1){return\n}var b=this._sendAppt.bind(this,a[0]);\na[0].getDetails(null,b,this._errorCallback)\n};\nZmCalViewController.prototype._sendAppt=function(b){var c=b.viewMode;\nb.viewMode=ZmCalItem.MODE_EDIT;\nvar d=new AjxCallback(this,this._handleResponseSave,b);\nvar a=new AjxCallback(this,this._handleErrorSave,b);\nb.send(null,d,a);\nb.viewMode=c\n};\nZmCalViewController.prototype._handleResponseSave=function(a){appCtxt.setStatusMsg(ZmMsg.apptSent)\n};\nZmCalViewController.prototype._handleErrorSave=function(a,d){var b=a.processErrorSave(d);\nvar e=false;\nif(b.continueSave){this._sendAppt(a);\ne=true\n}else{if(b.errorMessage){e=true;\nvar c=appCtxt.getMsgDialog();\nc.setMessage(b.errorMessage,DwtMessageDialog.CRITICAL_STYLE);\nc.popup()\n}appCtxt.notifyZimlets(\"onSaveApptFailure\",[this,a,d])\n}return e\n};\nZmCalViewController.prototype._doForward=function(a,d){if(this._viewMgr.getCurrentViewName()==ZmId.VIEW_CAL_LIST&&a.length>1){return\n}var b=a[0];\nvar c=ZmCalItem.MODE_FORWARD;\nif(d==ZmOperation.VIEW_APPT_INSTANCE||d==ZmOperation.VIEW_APPT_SERIES){c=(d==ZmOperation.VIEW_APPT_INSTANCE)?ZmCalItem.MODE_FORWARD_SINGLE_INSTANCE:ZmCalItem.MODE_FORWARD_SERIES\n}this._forwardAppointment(b,c)\n};\nZmCalViewController.prototype._doDelete=function(h,f,k,e){var g=false;\nif(h.length>0){var c=h[0].getFolder();\ng=c&&c.nId==ZmOrganizer.ID_TRASH\n}if((this._viewMgr.getCurrentViewName()==ZmId.VIEW_CAL_LIST||g)&&h.length>1){var j=this._divvyItems(h);\nif(j.readonly.length>0){var i=appCtxt.getMsgDialog();\nvar l=(j.recurring.length>0)?this._showTypeDialog.bind(this,[j.recurring,ZmCalItem.MODE_DELETE]):null;\nvar b=new AjxListener(this,this._handleReadonlyOk,[l,i]);\ni.setButtonListener(DwtDialog.OK_BUTTON,b);\ni.setMessage(ZmMsg.deleteReadonly);\ni.popup()\n}else{if(j.recurring.length>0){this._showTypeDialog(j.recurring,ZmCalItem.MODE_DELETE)\n}else{this._promptDeleteApptList(j.normal)\n}}}else{var a=h[0];\nif(e==ZmOperation.VIEW_APPT_INSTANCE||e==ZmOperation.VIEW_APPT_SERIES){var d=(e==ZmOperation.VIEW_APPT_INSTANCE)?ZmCalItem.MODE_DELETE_INSTANCE:ZmCalItem.MODE_DELETE_SERIES;\nthis._promptDeleteAppt(a,d)\n}else{this._deleteAppointment(a)\n}}};\nZmCalViewController.prototype._handleReadonlyOk=function(b,a){a.popdown();\nif(b){b.run()\n}};\nZmCalViewController.prototype._handleMultiDelete=function(d,f){var a=new ZmBatchCommand(true,null,true);\nfor(var c=0;\nc<d.length;\nc++){var e=d[c];\nvar b=[f,null,null,null,null];\na.add(new AjxCallback(e,e.getDetails,b))\n}a.run(this._handleGetDetails.bind(this,d,f))\n};\nZmCalViewController.prototype._handleGetDetails=function(e,g){var a=new ZmBatchCommand(true,null,true);\nfor(var d=0;\nd<e.length;\nd++){var f=e[d];\nvar c=[g,null,null,null];\na.add(new AjxCallback(f,f.cancel,c))\n}a.run();\nvar b=ZmList.getActionSummary({actionTextKey:\"actionDelete\",numItems:a.size(),type:ZmItem.APPT});\nappCtxt.setStatusMsg(b);\nappCtxt.notifyZimlets(\"onAppointmentDelete\",e)\n};\nZmCalViewController.prototype.getSelection=function(){return ZmListController.prototype.getSelection.call(this,this.getCurrentListView())\n};\nZmCalViewController.prototype.getSelectionCount=function(){return ZmListController.prototype.getSelectionCount.call(this,this.getCurrentListView())\n};\nZmCalViewController.prototype._divvyItems=function(b){var g=[];\nvar a=[];\nvar h=[];\nvar f=[];\nfor(var c=0;\nc<b.length;\nc++){var d=b[c];\nif(d.type!=ZmItem.APPT){continue\n}if(d.isFolderReadOnly()){a.push(d)\n}else{if(d.isRecurring()&&!d.isException){h.push(d)\n}else{g.push(d)\n}}var e=d.getFolder();\nif(e&&e.isRemote()){f.push(d)\n}}return{normal:g,readonly:a,recurring:h,shared:f}\n};\nZmCalViewController.prototype._promptDeleteApptList=function(b){if(b.length===0){return\n}var c=b[0].getFolder();\nvar a=c&&c.nId==ZmOrganizer.ID_TRASH;\nvar d=(a)?ZmMsg.confirmCancelApptListPermanently:ZmMsg.confirmCancelApptList;\nvar e=this._handleMultiDelete.bind(this,b,ZmCalItem.MODE_DELETE);\nappCtxt.getConfirmationDialog().popup(d,e)\n};\nZmCalViewController.prototype._promptDeleteAppt=function(a,b){if(!a){return\n}if(a instanceof Array){this._continueDelete(a,b)\n}else{if(a.isOrganizer()){if(b==ZmCalItem.MODE_DELETE_SERIES){this._promptDeleteFutureInstances(a,b)\n}else{this._promptCancelReply(a,b)\n}}else{this._promptDeleteNotify(a,b)\n}}};\nZmCalViewController.prototype._confirmDeleteApptDialog=function(){if(!ZmCalViewController._confirmDialog){var b=new DwtDialog_ButtonDescriptor(DwtDialog.YES_BUTTON,ZmMsg.editMessage,DwtDialog.ALIGN_LEFT);\nvar d=[DwtDialog.NO_BUTTON,DwtDialog.CANCEL_BUTTON];\nvar c=[b];\nZmCalViewController._confirmDialog=new DwtConfirmDialog(this._shell,null,\"CNF_DEL_SENDEDIT\",d,c);\nvar a=ZmCalViewController._confirmDialog.getButton(DwtDialog.NO_BUTTON);\na.setText(ZmMsg.sendCancellation)\n}return ZmCalViewController._confirmDialog\n};\nZmCalViewController.prototype._promptCancelReply=function(c,h){var f=new AjxCallback(this,this._continueDelete,[c,h]);\nvar d;\nvar e=c&&c.getFolder();\nvar b=e&&e.nId==ZmOrganizer.ID_TRASH;\nif(!b&&c.otherAttendees&&!c.inviteNeverSent&&appCtxt.get(ZmSetting.MAIL_ENABLED)){d=this._confirmDeleteApptDialog();\nvar a=new AjxCallback(this,this._continueDeleteReply,[c,h]);\nd.setTitle(ZmMsg.confirmDeleteApptTitle);\nd.popup(ZmMsg.confirmCancelApptReply,a,f)\n}else{d=appCtxt.getConfirmationDialog(\"CNF_DEL_YESNO\");\nvar g=b?ZmMsg.confirmPermanentCancelAppt:ZmMsg.confirmCancelAppt;\nif(c.isRecurring()&&!c.isException&&!b){g=(h==ZmCalItem.MODE_DELETE_INSTANCE)?AjxMessageFormat.format(ZmMsg.confirmCancelApptInst,AjxStringUtil.htmlEncode(c.name)):ZmMsg.confirmCancelApptSeries\n}d.setTitle(ZmMsg.confirmDeleteApptTitle);\nd.popup(g,f)\n}};\nZmCalViewController.prototype._promptDeleteFutureInstances=function(a,b){if(a.getAttendees(ZmCalBaseItem.PERSON).length>0){this._delFutureInstNotifyDlgWithAttendees=this._delFutureInstNotifyDlgWithAttendees?this._delFutureInstNotifyDlgWithAttendees:(new ZmApptDeleteNotifyDialog({parent:this._shell,title:AjxMsg.confirmTitle,confirmMsg:ZmMsg.confirmCancelApptSeries,choiceLabel1:ZmMsg.confirmCancelApptWholeSeries,choiceLabel2:ZmMsg.confirmCancelApptFutureInstances,choice2WarningMsg:ZmMsg.deleteApptWarning}));\nthis._delFutureInstNotifyDlg=this._delFutureInstNotifyDlgWithAttendees\n}else{this._delFutureInstNotifyDlgWithoutAtteendees=this._delFutureInstNotifyDlgWithoutAtteendees?this._delFutureInstNotifyDlgWithoutAtteendees:(new ZmApptDeleteNotifyDialog({parent:this._shell,title:ZmMsg.confirmDeleteApptTitle,confirmMsg:ZmMsg.confirmCancelApptSeries,choiceLabel1:ZmMsg.confirmDeleteApptWholeSeries,choiceLabel2:ZmMsg.confirmDeleteApptFutureInstances,choice2WarningMsg:ZmMsg.deleteApptWarning}));\nthis._delFutureInstNotifyDlg=this._delFutureInstNotifyDlgWithoutAtteendees\n}this._delFutureInstNotifyDlg.popup(new AjxCallback(this,this._deleteFutureInstYesCallback,[a,b]))\n};\nZmCalViewController.prototype._deleteFutureInstYesCallback=function(c,f){var b=this._delFutureInstNotifyDlg.isDefaultOptionChecked();\nif(!b){c.setCancelFutureInstances(true)\n}var e=new AjxCallback(this,this._continueDelete,[c,f]);\nvar d=this._confirmDeleteApptDialog();\nif(c.otherAttendees&&!c.inviteNeverSent&&appCtxt.get(ZmSetting.MAIL_ENABLED)){var a=new AjxCallback(this,this._continueDeleteReply,[c,f]);\nd.popup(ZmMsg.sendCancellationConfirmation,a,e)\n}else{this._continueDelete(c,f)\n}};\nZmCalViewController.prototype._promptDeleteNotify=function(b,d){if(!this._deleteNotifyDialog){this._deleteNotifyDialog=new ZmApptDeleteNotifyDialog({parent:this._shell,title:AjxMsg.confirmTitle,confirmMsg:\"\",choiceLabel1:ZmMsg.dontNotifyOrganizer,choiceLabel2:ZmMsg.notifyOrganizer})\n}var c=ZmMsg.confirmCancelAppt;\nif(b.isRecurring()){c=(d==ZmCalItem.MODE_DELETE_INSTANCE)?AjxMessageFormat.format(ZmMsg.confirmCancelApptInst,AjxStringUtil.htmlEncode(b.name)):ZmMsg.confirmCancelApptSeries\n}var a=document.getElementById(this._deleteNotifyDialog._confirmMessageDivId);\na.innerHTML=c;\nthis._deleteNotifyDialog.popup(new AjxCallback(this,this._deleteNotifyYesCallback,[b,d]))\n};\nZmCalViewController.prototype._deleteNotifyYesCallback=function(a,b){var c=!this._deleteNotifyDialog.isDefaultOptionChecked();\nif(c){this._cancelBeforeDelete(a,b)\n}else{this._continueDelete(a,b)\n}};\nZmCalViewController.prototype._cancelBeforeDelete=function(b,c){var a=ZmOperation.REPLY_DECLINE;\nvar d=new AjxCallback(this,this._cancelBeforeDeleteContinue,[b,a,c]);\nb.getDetails(null,d,this._errorCallback)\n};\nZmCalViewController.prototype._cancelBeforeDeleteContinue=function(c,b,f){var d=this._getMsgController();\nd.setMsg(c.message);\nvar a=f==ZmCalItem.MODE_DELETE_INSTANCE?new Date(c.uniqStartTime):null;\nvar e=new AjxCallback(this,this._continueDelete,[c,f]);\nd._sendInviteReply(b,c.compNum||0,a,c.getRemoteFolderOwner(),false,null,null,e)\n};\nZmCalViewController.prototype._deleteAppointment=function(b){if(!b){return\n}var c=b.getFolder();\nvar a=c&&c.nId==ZmOrganizer.ID_TRASH;\nif(b.isRecurring()&&!a&&!b.isException){this._showTypeDialog(b,ZmCalItem.MODE_DELETE)\n}else{this._promptDeleteAppt(b,ZmCalItem.MODE_DELETE)\n}};\nZmCalViewController.prototype._continueDeleteReply=function(a,c){var b=ZmOperation.REPLY_CANCEL;\nvar d=new AjxCallback(this,this._continueDeleteReplyRespondAction,[a,b,c]);\na.getDetails(c,d,this._errorCallback)\n};\nZmCalViewController.prototype._continueDeleteReplyRespondAction=function(b,d,f){var c=this._getMsgController();\nvar e=b.message;\ne._appt=b;\ne._mode=f;\nc.setMsg(e);\nvar a=f==ZmCalItem.MODE_DELETE_INSTANCE?new Date(b.uniqStartTime):null;\ne._instanceDate=a;\nc._editInviteReply(d,0,a)\n};\nZmCalViewController.prototype._continueDelete=function(b,c){if(b instanceof Array){var a=(c===ZmCalItem.MODE_DELETE_SERIES)?this._dedupeSeries(b):b;\nthis._handleMultiDelete(a,c)\n}else{var d=new AjxCallback(this,this._handleResponseContinueDelete,b);\nb.cancel(c,null,d,this._errorCallback)\n}};\nZmCalViewController.prototype._handleResponseContinueDelete=function(b){var c=appCtxt.getCurrentView();\nif(c&&c.isZmApptView){c.close()\n}var a=ZmList.getActionSummary({actionTextKey:\"actionDelete\",numItems:1,type:ZmItem.APPT});\nappCtxt.setStatusMsg(a);\nappCtxt.notifyZimlets(\"onAppointmentDelete\",[b])\n};\nZmCalViewController.prototype._dedupeSeries=function(c){var e=[];\nvar d={};\nfor(var a=0;\na<c.length;\na++){var b=c[a];\nif(!d[b.id]){d[b.id]=true;\ne.push(b)\n}}return e\n};\nZmCalViewController.prototype._getMoveParams=function(g){var f=ZmListController.prototype._getMoveParams.apply(this,arguments);\nvar e={};\nvar d=appCtxt.getFolderTree();\nif(!d){return f\n}var b=d.getByType(ZmOrganizer.CALENDAR);\nfor(var a=0;\na<b.length;\na++){var c=b[a];\nif(c.link&&c.isReadOnly()){e[c.id]=true\n}}f.omit=e;\nf.description=ZmMsg.targetCalendar;\nreturn f\n};\nZmCalViewController.prototype._getMoveDialogTitle=function(a){return AjxMessageFormat.format(ZmMsg.moveAppts,a)\n};\nZmCalViewController.prototype._showTypeDialog=function(a,b){if(this._typeDialog==null){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\",\"CalendarAppt\"]);\nthis._typeDialog=new ZmCalItemTypeDialog({id:\"CAL_ITEM_TYPE_DIALOG\",parent:this._shell});\nthis._typeDialog.registerCallback(DwtDialog.OK_BUTTON,this._typeOkListener,this);\nthis._typeDialog.registerCallback(DwtDialog.CANCEL_BUTTON,this._typeCancelListener,this)\n}this._typeDialog.initialize(a,b,ZmItem.APPT);\nthis._typeDialog.popup()\n};\nZmCalViewController.prototype.showApptReadOnlyView=function(a,b){var c=ZmAppt.quickClone(a);\nc.getDetails(b,new AjxCallback(this,this._showApptReadOnlyView,[c,b]))\n};\nZmCalViewController.prototype._showApptReadOnlyView=function(b,c){var a=this._app.getApptViewController(this._apptSessionId[b.invId]);\nthis._apptSessionId[b.invId]=a.getSessionId();\na.show(b,c)\n};\nZmCalViewController.prototype._showQuickAddDialog=function(c,b){if(appCtxt.isExternalAccount()||appCtxt.isWebClientOffline()){return\n}var d=appCtxt.get(ZmSetting.CAL_USE_QUICK_ADD);\nif((d&&!b)||(!d&&b)){if(AjxTimezone.TIMEZONE_CONFLICT||AjxTimezone.DEFAULT_RULE.autoDetected){var a=this.getTimezonePicker();\nvar e=new AjxCallback(this,this.handleTimezoneSelectionQuickAdd,[c,b]);\na.setCallback(e);\na.popup()\n}else{this._showQuickAddDialogContinue(c,b)\n}}else{this.newAppointment(c)\n}};\nZmCalViewController.prototype._showQuickAddDialogContinue=function(b,a){if(this._quickAddDialog==null){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\",\"CalendarAppt\"]);\nthis._quickAddDialog=new ZmApptQuickAddDialog(this._shell);\nthis._quickAddDialog.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._quickAddOkListener));\nthis._quickAddDialog.addSelectionListener(ZmApptQuickAddDialog.MORE_DETAILS_BUTTON,new AjxListener(this,this._quickAddMoreListener))\n}this._quickAddDialog.initialize(b);\nthis._quickAddDialog.popup()\n};\nZmCalViewController.prototype.newAppointmentHelper=function(a,e,b,c){var d=this._newApptObject(a,e,b);\nthis._showQuickAddDialog(d,c)\n};\nZmCalViewController.prototype.newAllDayAppointmentHelper=function(a,e,b,c){var d=this._newApptObject(a,null,b);\nif(e){d.setEndDate(e)\n}d.setAllDayEvent(true);\nd.freeBusy=\"F\";\nthis._showQuickAddDialog(d,c)\n};\nZmCalViewController.prototype.newAppointment=function(e,d,h,c){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nvar f=c||(this._viewVisible?this._viewMgr.getDate():new Date());\nvar a=e||this._newApptObject(f,(appCtxt.get(ZmSetting.CAL_DEFAULT_APPT_DURATION)*1000));\nif(this._viewVisible&&this._viewMgr.getCurrentView().getAtttendees){var b=this._viewMgr.getCurrentView().getAtttendees();\nif(b&&b.length>0){a.setAttendees(b,ZmCalBaseItem.PERSON)\n}}if(AjxTimezone.TIMEZONE_CONFLICT||AjxTimezone.DEFAULT_RULE.autoDetected){var i=this.getTimezonePicker();\nvar g=new AjxCallback(this,this.handleTimezoneSelection,[a,d,h]);\ni.setCallback(g);\ni.popup()\n}else{this._app.getApptComposeController().show(a,d,h)\n}};\nZmCalViewController.prototype.handleTimezoneSelection=function(b,d,c,a){this.updateTimezoneInfo(b,a);\nthis._app.getApptComposeController().show(b,d,c)\n};\nZmCalViewController.prototype.handleTimezoneSelectionQuickAdd=function(c,b,a){this.updateTimezoneInfo(c,a);\nthis._showQuickAddDialogContinue(c,b)\n};\nZmCalViewController.prototype.updateTimezoneInfo=function(d,b){d.setTimezone(b);\nappCtxt.set(ZmSetting.DEFAULT_TIMEZONE,b);\nAjxTimezone.TIMEZONE_CONFLICT=false;\nthis.updateDefaultTimezone(b);\nvar c=appCtxt.getSettings();\nvar a=c.getSetting(ZmSetting.DEFAULT_TIMEZONE);\nc.save([a],new AjxCallback(this,this._timezoneSaveCallback))\n};\nZmCalViewController.prototype.updateDefaultTimezone=function(a){for(var b=0;\nb<AjxTimezone.MATCHING_RULES.length;\nb++){if(AjxTimezone.MATCHING_RULES[b].serverId==a){AjxTimezone.DEFAULT_RULE=AjxTimezone.MATCHING_RULES[b];\nAjxTimezone.DEFAULT=AjxTimezone.getClientId(AjxTimezone.DEFAULT_RULE.serverId);\nbreak\n}}};\nZmCalViewController.prototype._timezoneSaveCallback=function(){appCtxt.setStatusMsg(ZmMsg.timezonePrefSaved)\n};\nZmCalViewController.prototype.getTimezonePicker=function(){if(!this._timezonePicker){this._timezonePicker=appCtxt.getTimezonePickerDialog()\n}return this._timezonePicker\n};\nZmCalViewController.prototype.editAppointment=function(a,b){Dwt.setLoadingTime(\"ZmCalendarApp-editAppt\");\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nif(b!=ZmCalItem.MODE_NEW){var c=ZmAppt.quickClone(a);\nc.getDetails(b,new AjxCallback(this,this._showApptComposeView,[c,b]))\n}else{this._app.getApptComposeController().show(a,b)\n}Dwt.setLoadedTime(\"ZmCalendarApp-editAppt\")\n};\nZmCalViewController.prototype._replyAppointment=function(b,a){Dwt.setLoadingTime(\"ZmCalendarApp-replyAppt\");\nAjxDispatcher.require([\"MailCore\",\"Mail\"]);\nvar d=ZmAppt.quickClone(b);\nvar c=new AjxCallback(this,this._replyDetailsHandler,[d,a]);\nd.getDetails(null,c,this._errorCallback,true,true);\nDwt.setLoadedTime(\"ZmCalendarApp-replyAppt\")\n};\nZmCalViewController.prototype._replyDetailsHandler=function(a,c,i){var e=new ZmMailMsg(-1,null,true);\nvar d=a.message;\nif(d){var n=d.getInviteDescriptionContent(ZmMimeTable.TEXT_HTML);\nif(n){var l=n.getContent();\nl&&e.setInviteDescriptionContent(ZmMimeTable.TEXT_HTML,l)\n}var o=d.getInviteDescriptionContent(ZmMimeTable.TEXT_PLAIN);\nif(o){var q=o.getContent();\nq&&e.setInviteDescriptionContent(ZmMimeTable.TEXT_PLAIN,q)\n}if(l||q){e._loaded=true\n}e.invite=d.invite;\ne.id=d.id;\ne.date=d.date\n}e.setSubject(a.name);\nvar p=a.getOrganizer();\nvar f=AjxEmailAddress.parse(p);\nvar k=appCtxt.getActiveAccount().name;\ne.getHeaderStr=AjxCallback.returnFalse;\nvar g=a.isOrganizer();\nvar h=a.getFolder();\nvar m=h?h.isRemote():false;\nif(!g||m){f.setType(AjxEmailAddress.FROM);\ne.addAddress(f)\n}if(c){var b=AjxUtil.arrayAsHash([k,f.getAddress()]),j=a.getAttendees(ZmCalBaseItem.PERSON);\nthis._addAttendeesToReply(j,e,ZmCalItem.ROLE_REQUIRED,AjxEmailAddress.FROM,b);\nthis._addAttendeesToReply(j,e,ZmCalItem.ROLE_OPTIONAL,AjxEmailAddress.CC,b)\n}var r={action:c?ZmOperation.CAL_REPLY_ALL:ZmOperation.CAL_REPLY,msg:e};\nAjxDispatcher.run(\"GetComposeController\").doAction(r)\n};\nZmCalViewController.prototype._addAttendeesToReply=function(a,c,e,g,b){var k=ZmApptViewHelper.getAttendeesArrayByRole(a,e),h=k.length,f,j;\nfor(f=0;\nf<h;\nf++){j=k[f].getAttendeeText(ZmCalBaseItem.PERSON);\nif(j&&!b[j]){var d=new AjxEmailAddress(j);\nd.setType(g);\nc.addAddress(d)\n}}};\nZmCalViewController.prototype._forwardAppointment=function(a,b){Dwt.setLoadingTime(\"ZmCalendarApp-fwdAppt\");\nAjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nif(b!=ZmCalItem.MODE_NEW){var c=ZmAppt.quickClone(a);\nc.getDetails(b,new AjxCallback(this,this._showApptForwardComposeView,[c,b]))\n}else{this._showApptForwardComposeView(a,b)\n}Dwt.setLoadedTime(\"ZmCalendarApp-fwdAppt\")\n};\nZmCalViewController.prototype._showAppointmentDetails=function(b){if(!b.__creating){var d=b.getFolder();\nvar c=Boolean(d.url);\nif(b.isRecurring()){if(b.isException||b.editViewMode){var e=b.editViewMode||ZmCalItem.MODE_EDIT_SINGLE_INSTANCE;\nif(b.isReadOnly()||d.isReadOnly()||c||appCtxt.isWebClientOffline()){this.showApptReadOnlyView(b,e)\n}else{this.editAppointment(b,e)\n}}else{this._showTypeDialog(b,ZmCalItem.MODE_EDIT)\n}}else{var a=d.nId==ZmOrganizer.ID_TRASH;\nif(b.isReadOnly()||d.isReadOnly()||c||a||appCtxt.isWebClientOffline()){var e=b.isRecurring()?(b.isException?ZmCalItem.MODE_EDIT_SINGLE_INSTANCE:ZmCalItem.MODE_EDIT_SERIES):ZmCalItem.MODE_EDIT;\nthis.showApptReadOnlyView(b,e)\n}else{this.editAppointment(b,ZmCalItem.MODE_EDIT)\n}}}else{this.newAppointment(b)\n}};\nZmCalViewController.prototype._typeOkListener=function(a){if(this._typeDialog){this._typeDialog.popdown()\n}if(this._typeDialog.mode==ZmCalItem.MODE_DELETE){this._promptDeleteAppt(this._typeDialog.calItem,this._typeDialog.isInstance()?ZmCalItem.MODE_DELETE_INSTANCE:ZmCalItem.MODE_DELETE_SERIES)\n}else{this._performApptAction(this._typeDialog.calItem,this._typeDialog.mode,this._typeDialog.isInstance())\n}};\nZmCalViewController.prototype._performApptAction=function(b,g,e){if(g==ZmCalItem.MODE_DELETE){var i=e?ZmCalItem.MODE_DELETE_INSTANCE:ZmCalItem.MODE_DELETE_SERIES;\nif(b instanceof Array){this._continueDelete(b,i)\n}else{if(b.isOrganizer()){this._continueDelete(b,i)\n}else{this._promptDeleteNotify(b,i)\n}}}else{if(g==ZmAppt.MODE_DRAG_OR_SASH){var d=e?ZmCalItem.MODE_EDIT_SINGLE_INSTANCE:ZmCalItem.MODE_EDIT_SERIES;\nvar c=this._updateApptDateState;\nvar h=[c.appt,d,c.startDateOffset,c.endDateOffset,c.callback,c.errorCallback];\nvar k=new AjxCallback(this,this._handleResponseUpdateApptDate,h);\ndelete this._updateApptDateState;\nb.getDetails(d,k,c.errorCallback)\n}else{var a=e?ZmCalItem.MODE_EDIT_SINGLE_INSTANCE:ZmCalItem.MODE_EDIT_SERIES;\nvar f=b.getFolder();\nvar j=Boolean(f.url);\nif(b.isReadOnly()||f.isReadOnly()||j||appCtxt.isWebClientOffline()){this.showApptReadOnlyView(b,a)\n}else{this.editAppointment(b,a)\n}}}};\nZmCalViewController.prototype._typeCancelListener=function(a){if(this._typeDialog.mode==ZmAppt.MODE_DRAG_OR_SASH){this._refreshAction(true)\n}this._typeDialog.popdown()\n};\nZmCalViewController.prototype._quickAddOkListener=function(d){var f=this._quickAddDialog.isValid();\nvar c=this._quickAddDialog.getAppt();\nvar g=this._quickAddCallback.bind(this,true);\nvar b=this._quickAddCallback.bind(this,false);\nvar a=c.getAttendees(ZmCalBaseItem.LOCATION);\nvar e=(a.length==0)?ZmCalItemComposeController.SAVE_CLOSE:ZmCalItemComposeController.SEND;\nthis._saveSimpleAppt(f,c,e,g,b)\n};\nZmCalViewController.prototype._saveSimpleAppt=function(i,a,d,b,f,h){try{if(i&&a){if(a.getFolder()&&a.getFolder().noSuchFolder){throw AjxMessageFormat.format(ZmMsg.errorInvalidFolder,a.getFolder().name)\n}if(!this._simpleComposeController){this._simpleComposeController=this._app.getSimpleApptComposeController()\n}this._simpleComposeController.doSimpleSave(a,d,b,f,h)\n}}catch(g){if(typeof g==\"string\"){var e=new DwtMessageDialog({parent:this._shell});\nvar c=g?AjxMessageFormat.format(ZmMsg.errorSavingWithMessage,g):ZmMsg.errorSaving;\ne.setMessage(c,DwtMessageDialog.CRITICAL_STYLE);\ne.popup()\n}else{ZmController.handleScriptError(g)\n}}};\nZmCalViewController.prototype._quickAddCallback=function(a){if(a){this._quickAddDialog.popdown()\n}appCtxt.setStatusMsg(a?ZmMsg.apptCreated:ZmMsg.apptCreationError)\n};\nZmCalViewController.prototype._quickAddMoreListener=function(b){var a=this._quickAddDialog.getAppt();\nif(a){this._quickAddDialog.popdown();\nthis.newAppointment(a,ZmCalItem.MODE_NEW_FROM_QUICKADD,this._quickAddDialog.isDirty())\n}};\nZmCalViewController.prototype._showApptComposeView=function(a,b){this._app.getApptComposeController().show(a,b)\n};\nZmCalViewController.prototype._showApptForwardComposeView=function(a,b){a.name=ZmMsg.fwd+\": \"+a.name;\nthis._app.getApptComposeController().show(a,b)\n};\nZmCalViewController.prototype.dndUpdateApptDate=function(e,b,h,g,a,d){e.dndUpdate=true;\nif(!e.isRecurring()){var c=ZmCalItem.MODE_EDIT;\nvar f=new AjxCallback(this,this._handleResponseUpdateApptDate,[e,c,b,h,g,a]);\ne.getDetails(c,f,a)\n}else{if(d.shiftKey||d.altKey){var c=d.altKey?ZmCalItem.MODE_EDIT_SERIES:ZmCalItem.MODE_EDIT_SINGLE_INSTANCE;\nvar f=new AjxCallback(this,this._handleResponseUpdateApptDate,[e,c,b,h,g,a]);\ne.getDetails(c,f,a)\n}else{this._updateApptDateState={appt:e,startDateOffset:b,endDateOffset:h,callback:g,errorCallback:a};\nif(e.isException){this._performApptAction(e,ZmAppt.MODE_DRAG_OR_SASH,true)\n}else{this._showTypeDialog(e,ZmAppt.MODE_DRAG_OR_SASH)\n}}}appCtxt.notifyZimlets(\"onApptDrop\",[e,b,h])\n};\nZmCalViewController.prototype._handleResponseUpdateApptDate=function(a,b,i,c,k,d,l){if(a.inviteNeverSent||!a.otherAttendees){this._handleResponseUpdateApptDateSave.apply(this,arguments);\nreturn\n}var h=[a,b,i,c,k,d,l];\nvar j=new AjxCallback(this,this._handleResponseUpdateApptDateEdit,h);\nvar g=new AjxCallback(this,this._handleResponseUpdateApptDateSave,h);\nvar f=new AjxCallback(this,this._handleResponseUpdateApptDateIgnore,h);\nvar e=appCtxt.getConfirmationDialog();\ne.popup(ZmMsg.confirmModifyApptReply,j,g,f)\n};\nZmCalViewController.prototype._handleResponseUpdateApptDateEdit=function(e,d,c,h,g,b,a){var f=ZmAppt.quickClone(e);\nf.editViewMode=d;\nif(c){f.setStartDate(new Date(f.getStartTime()+c))\n}if(h){f.setEndDate(new Date(f.getEndTime()+h))\n}this._showAppointmentDetails(f)\n};\nZmCalViewController.prototype._handleResponseUpdateApptDateEdit2=function(b,c,d,a,e){if(a){b.setStartDate(new Date(b.getStartTime()+a))\n}if(e){b.setEndDate(new Date(b.getEndTime()+e))\n}this._continueDeleteReplyRespondAction(b,c,d)\n};\nZmCalViewController.prototype._handleResponseUpdateApptDateSave=function(a,b,g,c,h,d,j){var f=appCtxt.get(ZmSetting.CAL_EXCEPTION_ON_SERIES_TIME_CHANGE);\nvar e=a.isRecurring()&&a.hasEx&&a.getAttendees(ZmCalBaseItem.PERSON)&&!f&&b==ZmCalItem.MODE_EDIT_SERIES;\nif(e){var i=new AjxCallback(this,this._handleResponseUpdateApptDateSaveContinue,[a,b,g,c,h,d,j]);\nthis._showExceptionWarning(i)\n}else{this._handleResponseUpdateApptDateSaveContinue(a,b,g,c,h,d,j)\n}};\nZmCalViewController.prototype._handleResponseUpdateApptDateSaveContinue=function(a,b,k,e,m,f,p){try{if(p){p.getResponse()\n}var j=a.startDate;\nvar d=a.endDate;\nvar l=a.getDuration();\na.setViewMode(b);\nif(k){var i=(b==ZmCalItem.MODE_EDIT_SINGLE_INSTANCE)?a.getUniqueStartDate():new Date(a.getStartTime());\na.setStartDate(new Date(i.getTime()+k));\na.resetRepeatWeeklyDays()\n}if(e){var o;\nif(b===ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){if(a.allDayEvent){o=a.getStartTime()+l-AjxDateUtil.MSEC_PER_DAY\n}else{o=a.getUniqueEndDate().getTime()+e\n}}else{o=a.getEndTime()+e\n}a.setEndDate(new Date(o))\n}if(b==ZmCalItem.MODE_EDIT_SINGLE_INSTANCE){a.setOrigTimezone(AjxTimezone.getServerId(AjxTimezone.DEFAULT))\n}if(!a.getTimezone()){a.setTimezone(AjxTimezone.getServerId(AjxTimezone.DEFAULT))\n}var n=new AjxCallback(this,this._handleResponseUpdateApptDateSave2,[m]);\nvar g=new AjxCallback(this,this._handleResponseUpdateApptDateSave2,[f,a,j,d]);\nappCtxt.getShell().setBusy(true);\nvar c=a.inviteNeverSent?ZmCalItemComposeController.SAVE_CLOSE:ZmCalItemComposeController.SEND;\nthis._saveSimpleAppt(true,a,c,n,g,g)\n}catch(h){appCtxt.getShell().setBusy(false);\nif(h.msg){this.popupErrorDialog(AjxMessageFormat.format(ZmMsg.mailSendFailure,h.msg))\n}else{this.popupErrorDialog(ZmMsg.errorGeneric,h)\n}if(f){f.run(h)\n}}if(m){m.run(p)\n}};\nZmCalViewController.prototype._showExceptionWarning=function(c,b){var a=appCtxt.getYesNoMsgDialog();\na.setMessage(ZmMsg.recurrenceUpdateWarning,DwtMessageDialog.WARNING_STYLE);\na.registerCallback(DwtDialog.YES_BUTTON,this._handleExceptionWarningResponse,this,[a,c]);\na.registerCallback(DwtDialog.NO_BUTTON,this._handleExceptionWarningResponse,this,[a,b]);\na.popup()\n};\nZmCalViewController.prototype._handleExceptionWarningResponse=function(a,b){if(b){b.run()\n}else{this._refreshAction(true)\n}if(a){a.popdown()\n}};\nZmCalViewController.prototype._handleResponseUpdateApptDateSave2=function(d,b,c,a){if(b){b.setStartDate(c);\nb.setEndDate(a);\nb.resetRepeatWeeklyDays()\n}if(d){d.run()\n}appCtxt.getShell().setBusy(false)\n};\nZmCalViewController.prototype._handleResponseUpdateApptDateIgnore=function(e,d,c,g,f,b,a){this._refreshAction(true);\nif(f){f.run(a)\n}};\nZmCalViewController.prototype.getDayToolTipText=function(d,i,h,j,a){try{var b=new Date(d.getTime());\nb.setHours(0,0,0,0);\nvar c=b.getTime();\nvar f=b.getTime()+AjxDateUtil.MSEC_PER_DAY;\nvar e={start:c,end:f,fanoutAllDay:true};\nif(h){e.callback=new AjxCallback(this,this._handleToolTipSearchResponse,[b,i,h,j]);\nthis.getApptSummaries(e)\n}else{var k=this.getApptSummaries(e);\nreturn ZmApptViewHelper.getDayToolTipText(b,k,this,i,null,j,a)\n}}catch(g){return\"<b>\"+ZmMsg.errorGettingAppts+\"</b>\"\n}};\nZmCalViewController.prototype._handleToolTipSearchResponse=function(g,e,f,b,a){try{var d=ZmApptViewHelper.getDayToolTipText(g,a,this,e,null,b);\nf.run(d)\n}catch(c){f.run(\"<b>\"+ZmMsg.errorGettingAppts+\"</b>\")\n}};\nZmCalViewController.prototype.getUserStatusToolTipText=function(c,e,n,k,o,m){try{if(!m){m=[];\nif(this._calTreeController){var l=this._calTreeController.getOwnedCalendars(this._app.getOverviewId(),k);\nfor(var f=0;\nf<l.length;\nf++){var b=l[f];\nif(b&&(b.nId!=ZmFolder.ID_TRASH)){m.push(appCtxt.multiAccounts?b.id:b.nId)\n}}}if((m.length==0)||!k){return\"<b>\"+ZmMsg.statusFree+\"</b>\"\n}}var d=c.getTime();\nvar g=e.getTime();\nvar h=new Date(c.getTime());\nh.setHours(0,0,0,0);\nvar a=new Date(h.getTime()+AjxDateUtil.MSEC_PER_DAY);\nthis.getApptSummaries({start:h.getTime(),end:a.getTime(),fanoutAllDay:true,folderIds:m});\nvar p=this.getApptSummaries({start:d,end:g,fanoutAllDay:true,folderIds:m});\nreturn ZmApptViewHelper.getDayToolTipText(c,p,this,n,o)\n}catch(j){return\"<b>\"+ZmMsg.meetingStatusUnknown+\"</b>\"\n}};\nZmCalViewController.prototype._miniCalDateRangeListener=function(a){this._scheduleMaintenance(ZmCalViewController.MAINT_MINICAL)\n};\nZmCalViewController.prototype._dateRangeListener=function(a){a.item.setNeedsRefresh(true);\nthis._scheduleMaintenance(ZmCalViewController.MAINT_VIEW)\n};\nZmCalViewController.prototype.processInlineCalSearch=function(){var d=window.inlineCalSearchResponse;\nif(!d){return\n}var f=d.search;\nvar c=d.Body;\nif(f instanceof Array){f=f[0]\n}var a=this._currentViewId||this.getDefaultViewType();\nvar b=(a==ZmId.VIEW_CAL_MONTH);\nvar e={start:f.s,end:f.e,fanoutAllDay:b,callback:null};\ne.folderIds=f.l?f.l.split(\",\"):[];\ne.query=\"\";\nvar g=this.getMiniCalendarParams();\ng.folderIds=e.folderIds;\nthis.apptCache.setSearchParams(e);\nthis.apptCache.processBatchResponse(c.BatchResponse,e,g)\n};\nZmCalViewController.prototype.setCurrentView=function(a){};\nZmCalViewController.prototype._resetNavToolBarButtons=function(a){this._navToolBar[ZmId.VIEW_CAL].enable([ZmOperation.PAGE_BACK,ZmOperation.PAGE_FORWARD],true)\n};\nZmCalViewController.prototype._resetToolbarOperations=function(a){ZmListController.prototype._resetToolbarOperations.call(this)\n};\nZmCalViewController.prototype._setNavToolbarPosition=function(b,a){if(!b||!a){return\n}b.setVisible(a!=ZmId.VIEW_CAL_LIST)\n};\nZmCalViewController.prototype._resetOperations=function(p,e){if(!p){return\n}p.enableAll(true);\nvar o=this._viewMgr.getCurrentViewName();\np.enable(ZmOperation.TAG_MENU,appCtxt.get(ZmSetting.TAGGING_ENABLED)&&!appCtxt.isWebClientOffline());\nif(o==ZmId.VIEW_CAL_LIST&&e>1){return\n}this._setNavToolbarPosition(this._navToolBar[ZmId.VIEW_CAL],o);\nvar a=this.getSelection()[0];\nvar d=a&&a.getFolder();\nvar l=d&&d.nId==ZmOrganizer.ID_TRASH;\ne=(l&&this.getCurrentListView())?this.getCurrentListView().getSelectionCount():e;\nvar k=d?d.isReadOnly():false;\nvar m=Boolean(d&&d.url);\nvar n=d?d.isRemote():false;\nvar c=m||k||(e==0)||appCtxt.isWebClientOffline();\nvar j=a&&a.isPrivate()&&d.isRemote()&&!d.hasPrivateAccess();\nvar i=!l&&d&&!d.isReadOnly()&&appCtxt.get(ZmSetting.GROUP_CALENDAR_ENABLED)&&!appCtxt.isWebClientOffline();\nvar h=!l&&a&&(e==1)&&!appCtxt.isWebClientOffline();\nvar b=l&&(e&&e>1);\np.enable([ZmOperation.REPLY,ZmOperation.REPLY_ALL],(h&&!b));\np.enable(ZmOperation.TAG_MENU,((!k&&!m&&e>0)||b)&&!appCtxt.isWebClientOffline());\np.enable(ZmOperation.VIEW_APPOINTMENT,!j&&!b);\np.enable([ZmOperation.FORWARD_APPT,ZmOperation.FORWARD_APPT_INSTANCE,ZmOperation.FORWARD_APPT_SERIES],i&&!b&&!appCtxt.isWebClientOffline());\np.enable(ZmOperation.PROPOSE_NEW_TIME,!l&&(a&&!a.isOrganizer())&&!b&&!appCtxt.isWebClientOffline());\np.enable(ZmOperation.SHOW_ORIG,e==1&&a&&a.getRestUrl()!=null&&!b&&!appCtxt.isWebClientOffline());\np.enable([ZmOperation.DELETE,ZmOperation.MOVE,ZmOperation.MOVE_MENU],!c||b);\np.enable(ZmOperation.VIEW_APPT_INSTANCE,!l);\nvar g=((a&&a.isPrivate()&&d.isRemote())?d.hasPrivateAccess():true);\np.enable(ZmOperation.DUPLICATE_APPT,g&&!b&&this._app.containsWritableFolder()&&!appCtxt.isWebClientOffline());\np.enable(ZmOperation.SHOW_ORIG,g&&!b&&!appCtxt.isWebClientOffline());\np.enable(ZmOperation.PRINT_CALENDAR,!appCtxt.isWebClientOffline());\nvar f=ZmCalViewController.VIEW_TO_OP[o];\nif(f&&p.setSelected){p.setSelected(f)\n}if(appCtxt.isWebClientOffline()){p.enable(ZmOperation.CAL_LIST_VIEW,false)\n}};\nZmCalViewController.prototype._listSelectionListener=function(c){ZmListController.prototype._listSelectionListener.call(this,c);\nif(c.detail==DwtListView.ITEM_SELECTED){this._viewMgr.getCurrentView()._apptSelected()\n}else{if(c.detail==DwtListView.ITEM_DBL_CLICKED){var b=c.item;\nif(b.isPrivate()&&b.getFolder().isRemote()&&!b.getFolder().hasPrivateAccess()){var a=appCtxt.getMsgDialog();\na.setMessage(ZmMsg.apptIsPrivate,DwtMessageDialog.INFO_STYLE);\na.popup()\n}else{this._apptIndexShowing=this._list.indexOf(b);\nthis._apptFromView=this._viewMgr.getCurrentView();\nthis._showAppointmentDetails(b)\n}}}};\nZmCalViewController.prototype.getViewMgr=function(){return this._viewMgr\n};\nZmCalViewController.prototype._handleMenuViewAction=function(k){var j=this.getActionMenu();\nvar b=j.__appt;\ndelete j.__appt;\nvar l=b.getOrig();\nb=l&&l.isMultiDay()?l:b;\nvar e=b.getFolder();\nvar g=e&&e.nId==ZmOrganizer.ID_TRASH;\nvar i=Boolean(e.url);\nvar f=ZmCalItem.MODE_EDIT;\nvar a=k.item;\nvar d=a.parent;\nvar c=d.getData(ZmOperation.KEY_ID);\nswitch(c){case ZmOperation.VIEW_APPT_INSTANCE:f=ZmCalItem.MODE_EDIT_SINGLE_INSTANCE;\nbreak;\ncase ZmOperation.VIEW_APPT_SERIES:f=ZmCalItem.MODE_EDIT_SERIES;\nbreak\n}if(b.isReadOnly()||i||g||appCtxt.isWebClientOffline()){var h=ZmAppt.quickClone(b);\nvar m=new AjxCallback(this,this._showApptReadOnlyView,[h,f]);\nh.getDetails(f,m,this._errorCallback)\n}else{this.editAppointment(b,f)\n}};\nZmCalViewController.prototype._handleApptRespondAction=function(c){var b=this.getSelection()[0];\nif(!b){return\n}var a=c.item.getData(ZmOperation.KEY_ID);\nvar e=c.item.parent.getData(ZmOperation.KEY_ID);\nvar d=new AjxCallback(this,this._handleResponseHandleApptRespondAction,[b,a,e,null]);\nb.getDetails(null,d,this._errorCallback)\n};\nZmCalViewController.prototype._handleResponseHandleApptRespondAction=function(c,b,g,f){var e=this._getMsgController();\ne.setMsg(c.message);\nvar a=g==ZmOperation.VIEW_APPT_INSTANCE?new Date(c.uniqStartTime):null;\nif(b==ZmOperation.REPLY_DECLINE){var d=new AjxCallback(this,this._sendInviteReply,[b,a]);\nthis._promptDeclineNotify(c,d,f)\n}else{e._sendInviteReply(b,c.compNum||0,a,c.getRemoteFolderOwner(),false,null,null,f)\n}};\nZmCalViewController.prototype._promptDeclineNotify=function(a,b,d){if(!this._declineNotifyDialog){var c=ZmMsg.confirmDeclineAppt;\nthis._declineNotifyDialog=new ZmApptDeleteNotifyDialog({parent:this._shell,title:AjxMsg.confirmTitle,confirmMsg:c,choiceLabel1:ZmMsg.dontNotifyOrganizer,choiceLabel2:ZmMsg.notifyOrganizer})\n}this._declineNotifyDialog.popup(new AjxCallback(this,this._declineNotifyYesCallback,[a,b,d]))\n};\nZmCalViewController.prototype._declineNotifyYesCallback=function(a,b,d){var c=!this._declineNotifyDialog.isDefaultOptionChecked();\nif(b){b.run(a,c,d)\n}};\nZmCalViewController.prototype._sendInviteReply=function(b,a,c,f,e){var d=this._getMsgController();\nd._sendInviteReply(b,c.compNum||0,a,c.getRemoteFolderOwner(),!f,null,null,e)\n};\nZmCalViewController.prototype._handleApptEditRespondAction=function(b){var a=this.getSelection()[0];\nvar e=b.item.getData(ZmOperation.KEY_ID);\nvar d=b.item.parent.parent.parent.getData(ZmOperation.KEY_ID);\nvar c=new AjxCallback(this,this._handleResponseHandleApptEditRespondAction,[a,e,d]);\na.getDetails(null,c,this._errorCallback)\n};\nZmCalViewController.prototype._handleResponseHandleApptEditRespondAction=function(b,f,e){var c=this._getMsgController();\nvar d=b.message;\nd.subject=d.subject||b.name;\nif(!d.getAddress(AjxEmailAddress.REPLY_TO)){d.setAddress(AjxEmailAddress.REPLY_TO,new AjxEmailAddress(b.organizer))\n}c.setMsg(d);\nswitch(f){case ZmOperation.EDIT_REPLY_ACCEPT:f=ZmOperation.REPLY_ACCEPT;\nbreak;\ncase ZmOperation.EDIT_REPLY_DECLINE:f=ZmOperation.REPLY_DECLINE;\nbreak;\ncase ZmOperation.EDIT_REPLY_TENTATIVE:f=ZmOperation.REPLY_TENTATIVE;\nbreak\n}var a=e==ZmOperation.VIEW_APPT_INSTANCE?new Date(b.uniqStartTime):null;\nc._editInviteReply(f,0,a,b.getRemoteFolderOwner())\n};\nZmCalViewController.prototype._handleError=function(b){if(b.code==\"mail.INVITE_OUT_OF_DATE\"||b.code==\"mail.NO_SUCH_APPT\"){var a=appCtxt.getMsgDialog();\na.registerCallback(DwtDialog.OK_BUTTON,this._handleError2,this,[a]);\na.setMessage(ZmMsg.apptOutOfDate,DwtMessageDialog.INFO_STYLE);\na.popup();\nreturn true\n}return false\n};\nZmCalViewController.prototype._handleError2=function(a){a.unregisterCallback(DwtDialog.OK_BUTTON);\na.popdown();\nthis._refreshAction(false)\n};\nZmCalViewController.prototype._initCalViewMenu=function(b){for(var a=0;\na<ZmCalViewController.OPS.length;\na++){var c=ZmCalViewController.OPS[a];\nb.addSelectionListener(c,this._listeners[c]);\nb.enable(c,((c!=ZmOperation.CAL_LIST_VIEW)||!appCtxt.isWebClientOffline()))\n}};\nZmCalViewController.prototype._getViewActionMenuOps=function(){if(this._app.containsWritableFolder()){return[ZmOperation.NEW_APPT,ZmOperation.NEW_ALLDAY_APPT,ZmOperation.SEP,ZmOperation.TODAY,ZmOperation.CAL_VIEW_MENU]\n}else{return[ZmOperation.TODAY,ZmOperation.CAL_VIEW_MENU]\n}};\nZmCalViewController.prototype._initializeActionMenu=function(){this._actionMenu=this._createActionMenu(this._getActionMenuOps());\nif(appCtxt.get(ZmSetting.TAGGING_ENABLED)){this._setupTagMenu(this._actionMenu)\n}var f=this._getRecurrenceModeOps();\nvar h={parent:this._shell,menuItems:f};\nthis._recurrenceModeActionMenu=new ZmActionMenu(h);\nfor(var d=0;\nd<f.length;\nd++){var c=f[d];\nvar b=this._recurrenceModeActionMenu.getMenuItem(c);\nvar e=this._getActionMenuOps(c);\nvar g=this._createActionMenu(e,b,c);\nif(appCtxt.get(ZmSetting.TAGGING_ENABLED)){this._setupTagMenu(g)\n}b.setMenu(g);\nvar a=this._recurrenceModeMenuPopup.bind(b);\nb.addListener(AjxEnv.isIE?DwtEvent.ONMOUSEENTER:DwtEvent.ONMOUSEOVER,a)\n}this._recurrenceModeActionMenu.addPopdownListener(this._menuPopdownListener)\n};\nZmCalViewController.prototype._createActionMenu=function(d,a,c){var h={parent:a||this._shell,menuItems:d,context:this._getMenuContext()+(c?\"_\"+c:\"\")};\nvar f=new ZmActionMenu(h);\nd=f.opList;\nfor(var b=0;\nb<d.length;\nb++){var e=d[b];\nif(e==ZmOperation.INVITE_REPLY_MENU){var g=f.getOp(ZmOperation.INVITE_REPLY_MENU).getMenu();\ng.addSelectionListener(ZmOperation.EDIT_REPLY_ACCEPT,this._listeners[ZmOperation.EDIT_REPLY_ACCEPT]);\ng.addSelectionListener(ZmOperation.EDIT_REPLY_TENTATIVE,this._listeners[ZmOperation.EDIT_REPLY_TENTATIVE]);\ng.addSelectionListener(ZmOperation.EDIT_REPLY_DECLINE,this._listeners[ZmOperation.EDIT_REPLY_DECLINE])\n}else{if(e==ZmOperation.CAL_VIEW_MENU){var g=f.getOp(ZmOperation.CAL_VIEW_MENU).getMenu();\nthis._initCalViewMenu(g)\n}}if(this._listeners[e]){f.addSelectionListener(e,this._listeners[e])\n}}f.addPopdownListener(this._menuPopdownListener);\nreturn f\n};\nZmCalViewController.prototype._recurrenceModeMenuPopup=function(b){if(!this.getEnabled()){return\n}var c=this.getMenu();\nvar a=this.getData(ZmOperation.KEY_ID);\nc.setData(ZmOperation.KEY_ID,a)\n};\nZmCalViewController.prototype._getActionMenuOps=function(c){var e=ZmOperation.DELETE;\nvar b=ZmOperation.VIEW_APPOINTMENT;\nvar a=ZmOperation.FORWARD_APPT;\nif(c==ZmOperation.VIEW_APPT_INSTANCE){e=ZmOperation.DELETE_INSTANCE;\nb=ZmOperation.OPEN_APPT_INSTANCE;\na=ZmOperation.FORWARD_APPT_INSTANCE\n}else{if(c==ZmOperation.VIEW_APPT_SERIES){e=ZmOperation.DELETE_SERIES;\nb=ZmOperation.OPEN_APPT_SERIES;\na=ZmOperation.FORWARD_APPT_SERIES\n}}var d=[b,ZmOperation.PRINT,ZmOperation.SEP,ZmOperation.REPLY_ACCEPT,ZmOperation.REPLY_TENTATIVE,ZmOperation.REPLY_DECLINE,ZmOperation.INVITE_REPLY_MENU,ZmOperation.PROPOSE_NEW_TIME,ZmOperation.REINVITE_ATTENDEES,ZmOperation.DUPLICATE_APPT,ZmOperation.SEP,ZmOperation.REPLY,ZmOperation.REPLY_ALL,a,e,ZmOperation.SEP];\nif(c!=ZmOperation.VIEW_APPT_INSTANCE){d.push(ZmOperation.MOVE)\n}d.push(ZmOperation.TAG_MENU);\nd.push(ZmOperation.SHOW_ORIG);\nreturn d\n};\nZmCalViewController.prototype._getRecurrenceModeOps=function(){return[ZmOperation.VIEW_APPT_INSTANCE,ZmOperation.VIEW_APPT_SERIES]\n};\nZmCalViewController.prototype._enableActionMenuReplyOptions=function(b,e){if(!(b&&e)){return\n}var g=appCtxt.isExternalAccount();\nvar w=b.isFolderReadOnly();\nvar n=b.isShared();\nvar l=b.isOrganizer();\nvar p;\nvar a=b.getLocalFolderId();\nvar d=this.getCheckedCalendars(true);\nfor(var u=0;\nu<d.length;\nu++){if(d[u].id==a){p=d[u];\nbreak\n}}if(!p){p=b.getFolder()\n}var s=p&&p.link?p.getMainShare():null;\nvar m=s?s.isWorkflow():true;\nvar h=p&&p.nId==ZmOrganizer.ID_TRASH;\nvar c=b.isPrivate()&&p.isRemote()&&!p.hasPrivateAccess();\nvar o=!h&&b.otherAttendees;\nvar y=!h&&p&&!p.isReadOnly()&&appCtxt.get(ZmSetting.GROUP_CALENDAR_ENABLED);\nvar t=!l&&!w;\ne.setItemVisible(ZmOperation.REPLY_ACCEPT,t);\ne.setItemVisible(ZmOperation.REPLY_DECLINE,t);\ne.setItemVisible(ZmOperation.REPLY_TENTATIVE,t);\ne.setItemVisible(ZmOperation.INVITE_REPLY_MENU,t);\ne.setItemVisible(ZmOperation.PROPOSE_NEW_TIME,t);\ne.setItemVisible(ZmOperation.REINVITE_ATTENDEES,!h&&l&&!w&&!b.inviteNeverSent&&b.otherAttendees);\ne.setItemVisible(ZmOperation.TAG_MENU,appCtxt.get(ZmSetting.TAGGING_ENABLED));\ne.enableAll(true);\nif(t){var k=o&&m&&!c&&!g;\ne.enable(ZmOperation.REPLY_ACCEPT,k&&b.ptst!=ZmCalBaseItem.PSTATUS_ACCEPT);\ne.enable(ZmOperation.REPLY_DECLINE,k&&b.ptst!=ZmCalBaseItem.PSTATUS_DECLINED);\ne.enable(ZmOperation.REPLY_TENTATIVE,k&&b.ptst!=ZmCalBaseItem.PSTATUS_TENTATIVE);\ne.enable(ZmOperation.INVITE_REPLY_MENU,k);\nvar v=k&&e.getMenuItem(ZmOperation.INVITE_REPLY_MENU);\nvar r=v&&v.getMenu();\nif(r){r.enable(ZmOperation.EDIT_REPLY_ACCEPT,b.ptst!=ZmCalBaseItem.PSTATUS_ACCEPT);\nr.enable(ZmOperation.EDIT_REPLY_DECLINE,b.ptst!=ZmCalBaseItem.PSTATUS_DECLINED);\nr.enable(ZmOperation.EDIT_REPLY_TENTATIVE,b.ptst!=ZmCalBaseItem.PSTATUS_TENTATIVE)\n}}e.enable([ZmOperation.FORWARD_APPT,ZmOperation.FORWARD_APPT_INSTANCE,ZmOperation.FORWARD_APPT_SERIES],y);\nvar f=b.getFolder().getAccount().getEmail();\ne.enable(ZmOperation.REPLY,o&&!l&&f!==b.organizer);\ne.enable(ZmOperation.REPLY_ALL,o);\nvar x;\nif(appCtxt.isWebClientOffline()){x=[ZmOperation.REINVITE_ATTENDEES,ZmOperation.PROPOSE_NEW_TIME,ZmOperation.REPLY,ZmOperation.REPLY_ALL,ZmOperation.DUPLICATE_APPT,ZmOperation.DELETE,ZmOperation.DELETE_INSTANCE,ZmOperation.DELETE_SERIES,ZmOperation.FORWARD_APPT,ZmOperation.FORWARD_APPT_INSTANCE,ZmOperation.FORWARD_APPT_SERIES,ZmOperation.SHOW_ORIG,ZmOperation.DUPLICATE_APPT,ZmOperation.MOVE,ZmOperation.PRINT,ZmOperation.TAG_MENU,ZmOperation.MOVE_MENU];\ne.enable(x,false)\n}else{if(g){x=[ZmOperation.REINVITE_ATTENDEES,ZmOperation.PROPOSE_NEW_TIME,ZmOperation.REPLY,ZmOperation.REPLY_ALL,ZmOperation.DUPLICATE_APPT,ZmOperation.DELETE,ZmOperation.DELETE_INSTANCE,ZmOperation.DELETE_SERIES];\ne.enable(x,false)\n}if(w){x=[ZmOperation.REINVITE_ATTENDEES,ZmOperation.PROPOSE_NEW_TIME,ZmOperation.DELETE,ZmOperation.DELETE_INSTANCE,ZmOperation.DELETE_SERIES,ZmOperation.MOVE,ZmOperation.TAG_MENU,ZmOperation.MOVE_MENU];\ne.enable(x,false)\n}}var j=e.getMenuItem(ZmOperation.DELETE);\nif(j&&!h){j.setText((l&&b.otherAttendees)?ZmMsg.cancel:ZmMsg.del);\nvar q=Boolean(p.url);\nj.setEnabled(!p.isReadOnly()&&!q&&!c&&!appCtxt.isWebClientOffline())\n}if(this._recurrenceModeActionMenu&&!h){this._recurrenceModeActionMenu.enable(ZmOperation.VIEW_APPT_SERIES,!b.exception)\n}};\nZmCalViewController.prototype._listActionListener=function(j){ZmListController.prototype._listActionListener.call(this,j);\nvar f=this.getSelectionCount();\nvar b=j.item;\nvar i=this.getActionMenu();\ni.enableAll(f===1);\nif(f>1){var k=appCtxt.isExternalAccount();\nvar l=b.isFolderReadOnly();\nvar g=!k&&!l;\ni.enable([ZmOperation.TAG_MENU,ZmOperation.MOVE_MENU,ZmOperation.MOVE,ZmOperation.DELETE],g);\ni.popup(0,j.docX,j.docY);\nreturn\n}var d=b&&b.getFolder();\nvar h=d&&d.nId==ZmOrganizer.ID_TRASH;\nvar c=(b.isRecurring()&&!b.isException&&!h)?this._recurrenceModeActionMenu:i;\nthis._enableActionMenuReplyOptions(b,c);\nvar e=(c==i)&&b.exception?ZmOperation.VIEW_APPT_INSTANCE:null;\ni.__appt=b;\nc.setData(ZmOperation.KEY_ID,e);\nif(b.isRecurring()&&!b.isException&&!h){var a=c.getMenuItem(ZmOperation.VIEW_APPT_INSTANCE);\nthis._setTagMenu(a.getMenu());\nthis._enableActionMenuReplyOptions(b,a.getMenu());\na=c.getMenuItem(ZmOperation.VIEW_APPT_SERIES);\nthis._setTagMenu(a.getMenu());\nthis._enableActionMenuReplyOptions(b,a.getMenu())\n}c.popup(0,j.docX,j.docY)\n};\nZmCalViewController.prototype._clearViewActionMenu=function(){this._viewActionMenu=null\n};\nZmCalViewController.prototype._viewActionListener=function(j){if(!this._viewActionMenu){var b=this._getViewActionMenuOps();\nif(!b){return\n}var l={};\nl[ZmOperation.TODAY]={textKey:\"todayGoto\"};\nvar f={parent:this._shell,menuItems:b,overrides:l};\nthis._viewActionMenu=new ZmActionMenu(f);\nb=this._viewActionMenu.opList;\nfor(var g=0;\ng<b.length;\ng++){var a=b[g];\nif(a==ZmOperation.CAL_VIEW_MENU){var c=this._viewActionMenu.getOp(ZmOperation.CAL_VIEW_MENU).getMenu();\nthis._initCalViewMenu(c)\n}else{if(this._listeners[a]){this._viewActionMenu.addSelectionListener(a,this._listeners[a]);\nif((a==ZmOperation.NEW_APPT)||(a==ZmOperation.NEW_ALLDAY_APPT)){this._viewActionMenu.enable(a,!appCtxt.isWebClientOffline())\n}}}}this._viewActionMenu.addPopdownListener(this._menuPopdownListener)\n}if(this._viewVisible&&this._currentViewType==ZmId.VIEW_CAL_DAY){var k=j.target.getAttribute(ZmCalDayTabView.ATTR_CAL_ID);\nif(!k){var h=this._viewMgr.getView(this._currentViewId);\nvar e=Dwt.toWindow(j.target,j.elementX,j.elementY,j.target,true);\nvar d=h._getColFromX(e.x);\nk=(d&&d.cal)?d.cal.id:null\n}this._viewActionMenu._calendarId=k\n}else{this._viewActionMenu._calendarId=null\n}this._viewActionMenu.__view=j.item;\nthis._viewActionMenu.popup(0,j.docX,j.docY)\n};\nZmCalViewController.prototype._dropListener=function(c){var a=this._listView[this._currentViewId];\nvar g=a.getTargetItemDiv(c.uiEvent);\nvar b=g?a.getItemFromElement(g):null;\nif(c.action==DwtDropEvent.DRAG_ENTER){if(b&&b.type==ZmItem.APPT){var f=b.getFolder();\nvar e=f?f.isReadOnly():false;\nvar d=Boolean(f&&f.url);\nif(d||e||appCtxt.isWebClientOffline()){c.doIt=false;\na.dragSelect(g);\nreturn\n}}}ZmListController.prototype._dropListener.call(this,c)\n};\nZmCalViewController.prototype.sendRequest=function(b){try{return appCtxt.getAppController().sendRequest({soapDoc:b})\n}catch(a){return null\n}};\nZmCalViewController.prototype.getApptSummaries=function(a){if(!a.folderIds){a.folderIds=this.getCheckedCalendarFolderIds()\n}a.query=this._userQuery;\nreturn this.apptCache.getApptSummaries(a)\n};\nZmCalViewController.prototype.handleUserSearch=function(d,e){AjxDispatcher.require([\"MailCore\",\"CalendarCore\",\"Calendar\"]);\nif(d.origin===ZmId.SEARCH){this.show(ZmId.VIEW_CAL_LIST,null,true)\n}else{this.show(null,null,true)\n}this.apptCache.clearCache();\nthis._viewMgr.setNeedsRefresh();\nthis._userQuery=d.query;\nvar b=this._listView[this._currentViewId];\nif(b){var a=b.getTimeRange();\nd.start=a.start;\nd.end=a.end\n}else{if(this._miniCalendar){var c=this._miniCalendar.getDateRange();\nd.start=c.start.getTime();\nd.end=c.end.getTime()\n}else{}}d.fanoutAllDay=b&&b._fanoutAllDay();\nd.callback=this._searchResponseCallback.bind(this,e);\nthis.getApptSummaries(d)\n};\nZmCalViewController.prototype._searchResponseCallback=function(d,b,c,a){this.show(null,null,true);\nthis._userQuery=c;\nthis._maintGetApptCallback(ZmCalViewController.MAINT_VIEW,this._listView[this._currentViewId],b,true,c);\nif(d){d.run(a)\n}};\nZmCalViewController.prototype.notifyCreate=function(a){if(a&&a.l){var b=appCtxt.getById(a.l);\nif(b&&b.id){this._clearCacheFolderMap[b.id]=true\n}}};\nZmCalViewController.prototype.notifyDelete=function(c){if(this._modifyAppts){var a=this._viewMgr.getSubContentView().getApptList();\nfor(var b=0;\nb<c.length;\nb++){var d=ZmCalViewController.__AjxVector_getById(a,c[b]);\nif(d){a.remove(d);\nthis._modifyAppts.removes++\n}}}if(this._clearCache){return\n}this._clearCache=this.apptCache.containsAnyId(c);\nthis.handleEditConflict(c)\n};\nZmCalViewController.prototype.handleEditConflict=function(c){if(appCtxt.getCurrentViewId()==ZmId.VIEW_APPOINTMENT){var a=appCtxt.getCurrentView();\nvar d=a.getAppt(true);\nvar e=d&&d.getFolder();\nvar b=\",\"+c+\",\";\nif(b.indexOf(\",\"+e.id+\",\")>=0){this._app.getApptComposeController()._closeView()\n}}};\nZmCalViewController.prototype.notifyModify=function(c){var f=c.appt;\nif(f&&this._viewMgr){var j=this._viewMgr.getSubContentView();\nif(j){for(var e=0;\ne<f.length;\ne++){var d=f[e];\nif(d.l==ZmOrganizer.ID_TRASH){this._modifyAppts.adds++;\nZmAppt.loadByUid(d.uid,new AjxCallback(this,this._updateSubContent))\n}else{var g=j.getApptList();\nvar a=ZmCalViewController.__AjxVector_getById(g,d.id);\nif(a){g.remove(a);\nthis._modifyAppts.removes++\n}}}}}if(this._clearCache){return\n}for(var b in c){var h=c[b];\nthis._clearCache=this._clearCache||this.apptCache.containsAnyItem(h)\n}};\nZmCalViewController.__AjxVector_getById=function(a,e){var d=a.getArray();\nfor(var b=0;\nb<d.length;\nb++){var c=d[b];\nif(c.id==e){return c\n}}return null\n};\nZmCalViewController.prototype._updateSubContent=function(b){if(b){var a=this._viewMgr.getSubContentView();\nif(a){if(!a.hasItem(b.id)){a.getApptList().add(b)\n}a.setNeedsRefresh(true);\nif(!this._modifyAppts||--this._modifyAppts.adds<=0){a.refresh();\nthis._clearCache=true;\nthis.refreshHandler()\n}}}};\nZmCalViewController.prototype.preNotify=function(b){this._modifyAppts=null;\nif(b.deleted||(b.modified&&b.modified.appt)){var a=this._viewMgr&&this._viewMgr.getSubContentView();\nif(a){this._modifyAppts={adds:0,removes:0}\n}}};\nZmCalViewController.prototype.postNotify=function(f){if(this._modifyAppts){var e=this._modifyAppts.removes;\nvar g=this._modifyAppts.adds;\nif(e||g){var b=this._viewMgr.getSubContentView();\nif(b){b.setNeedsRefresh(true);\nb.refresh();\nthis._clearCache=true\n}}this._modifyAppts.removes=0\n}var d=false;\nfor(var c in this._clearCacheFolderMap){this.apptCache.clearCache(c);\nd=true\n}this._clearCacheFolderMap={};\nvar h=(appCtxt.isOffline&&this.searchInProgress)?1000:0;\nif(this._clearCache){var a=new AjxTimedAction(this,this._refreshAction);\nAjxTimedAction.scheduleAction(a,h);\nthis._clearCache=false\n}else{if(d){var a=new AjxTimedAction(this,this._refreshAction,[true]);\nAjxTimedAction.scheduleAction(a,h)\n}}};\nZmCalViewController.prototype.setNeedsRefresh=function(a){if(this._viewMgr!=null&&this._viewMgr.setNeedsRefresh){this._viewMgr.setNeedsRefresh(a)\n}};\nZmCalViewController.prototype.isMovingBetwAccounts=function(a,d){a=(!(a instanceof Array))?[a]:a;\nvar g=false;\nfor(var c=0;\nc<a.length;\nc++){var e=a[c];\nif(!e.isReadOnly()&&e._orig&&e.otherAttendees&&!appCtxt.isWebClientOffline()){var b=e._orig.getFolder();\nvar f=appCtxt.getById(d);\nif(b&&f){if((b.id!=d)&&((b.link&&!f.link)||(!b.link&&f.link))){g=true;\nbreak\n}}}}return g\n};\nZmCalViewController.prototype.isMovingBetwAcctsAsAttendee=function(a,d){a=(!(a instanceof Array))?[a]:a;\nvar g=false;\nfor(var c=0;\nc<a.length;\nc++){var e=a[c];\nif(e.isReadOnly()&&e._orig){var b=e._orig.getFolder();\nvar f=appCtxt.getById(d);\nif(b&&f){if((b.id!=d)&&b.owner!=f.owner){g=true;\nbreak\n}}}}return g\n};\nZmCalViewController.prototype.refreshHandler=function(){var a=new AjxTimedAction(this,this._refreshAction);\nAjxTimedAction.scheduleAction(a,0)\n};\nZmCalViewController.prototype._refreshAction=function(b){var d=false;\nif(b){var a=this._app.getReminderController().getRefreshParams();\nvar c=this.apptCache._getCachedMergedKey(a);\nb=Boolean(this.apptCache._cachedMergedApptVectors[c])\n}if(!b){this.apptCache.clearCache();\nd=true\n}if(this._viewMgr!=null){this._viewMgr.setNeedsRefresh(true);\nthis._scheduleMaintenance(ZmCalViewController.MAINT_MINICAL|ZmCalViewController.MAINT_VIEW|ZmCalViewController.MAINT_REMINDER,d)\n}else{if(this._miniCalendar!=null){this._scheduleMaintenance(ZmCalViewController.MAINT_MINICAL|ZmCalViewController.MAINT_REMINDER,d)\n}else{this._scheduleMaintenance(ZmCalViewController.MAINT_REMINDER,d)\n}}};\nZmCalViewController.prototype._maintErrorHandler=function(a){};\nZmCalViewController.prototype._maintGetApptCallback=function(j,h,f,e,g){if(f instanceof ZmCsfeException){this.searchInProgress=false;\nthis._handleError(f,new AjxCallback(this,this._maintErrorHandler));\nreturn\n}this._userQuery=g;\nif(j&ZmCalViewController.MAINT_VIEW){this._list=new ZmApptList();\nthis._list.getVector().addList(f);\nvar b=h.getSelection();\nh.set(f);\nif(b&&b.length>0){var a=b[0].id;\nfor(var d=0;\nd<this._list.size();\nd++){if(this._list.getArray()[d].id==a){h.setSelection(this._list.getArray[d],true);\nbreak\n}}}this._resetToolbarOperations()\n}if(j&ZmCalViewController.MAINT_REMINDER){this._app.getReminderController().refresh()\n}this.searchInProgress=false;\nif(this._pendingWork!=ZmCalViewController.MAINT_NONE){var c=this._pendingWork;\nthis._pendingWork=ZmCalViewController.MAINT_NONE;\nthis._scheduleMaintenance(c)\n}};\nZmCalViewController.prototype.refreshCurrentView=function(){var a=this.getCurrentView();\nif(a){a.setNeedsRefresh(true);\nthis._scheduleMaintenance(ZmCalViewController.MAINT_VIEW)\n}};\nZmCalViewController.prototype._scheduleMaintenance=function(a,b){this.onErrorRecovery=new AjxCallback(this,this._errorRecovery,[a,b]);\nif((!this.searchInProgress||b)&&(this._pendingWork==ZmCalViewController.MAINT_NONE)){this._pendingWork|=a;\nAjxTimedAction.scheduleAction(this._maintTimedAction,0)\n}else{this._pendingWork|=a\n}};\nZmCalViewController.prototype.resetSearchFlags=function(){this.searchInProgress=false;\nthis._pendingWork=ZmCalViewController.MAINT_NONE\n};\nZmCalViewController.prototype._errorRecovery=function(a,e){var d=(a&ZmCalViewController.MAINT_MINICAL);\nvar c=(a&ZmCalViewController.MAINT_VIEW);\nvar b=(a&ZmCalViewController.MAINT_REMINDER);\nif(d||c||b){this.getCurrentView().setNeedsRefresh(true)\n}this._scheduleMaintenance(a,e)\n};\nZmCalViewController.prototype._maintenanceAction=function(){var i=this._pendingWork;\nthis.searchInProgress=true;\nthis._pendingWork=ZmCalViewController.MAINT_NONE;\nvar a=(i&ZmCalViewController.MAINT_MINICAL);\nvar b=(i&ZmCalViewController.MAINT_VIEW);\nvar f=(i&ZmCalViewController.MAINT_REMINDER);\nif(i==ZmCalViewController.MAINT_REMINDER){this._app.getReminderController().refresh();\nthis.searchInProgress=false\n}else{if(a||b||f){var h=this._viewMgr?this._viewMgr.getView(this._currentViewId):null;\nvar e=h&&h.needsRefresh();\nif(e){var c=h.getTimeRange();\nvar d={start:c.start,end:c.end,fanoutAllDay:h._fanoutAllDay(),callback:(new AjxCallback(this,this._maintGetApptCallback,[i,h])),accountFolderIds:([].concat(this._checkedAccountCalendarIds)),query:this._userQuery};\nvar g;\nif(f){g=this._app.getReminderController().getRefreshParams();\ng.callback=null\n}this.apptCache.batchRequest(d,this.getMiniCalendarParams(),g);\nh.setNeedsRefresh(false)\n}else{this.searchInProgress=false\n}}}};\nZmCalViewController.prototype.getKeyMapName=function(){return ZmKeyMap.MAP_CALENDAR\n};\nZmCalViewController.prototype.handleKeyAction=function(b){var g=appCtxt.isWebClientOffline();\nswitch(b){case ZmKeyMap.CAL_DAY_VIEW:case ZmKeyMap.CAL_WEEK_VIEW:case ZmKeyMap.CAL_WORK_WEEK_VIEW:case ZmKeyMap.CAL_MONTH_VIEW:this.show(ZmCalViewController.ACTION_CODE_TO_VIEW[b]);\nbreak;\ncase ZmKeyMap.CAL_LIST_VIEW:if(!g){this.show(ZmCalViewController.ACTION_CODE_TO_VIEW[b])\n}break;\ncase ZmKeyMap.CAL_FB_VIEW:if(appCtxt.get(ZmSetting.FREE_BUSY_VIEW_ENABLED)&&!g){this.show(ZmCalViewController.ACTION_CODE_TO_VIEW[b])\n}break;\ncase ZmKeyMap.TODAY:this._todayButtonListener();\nbreak;\ncase ZmKeyMap.REFRESH:this._refreshButtonListener();\nbreak;\ncase ZmKeyMap.QUICK_ADD:if(appCtxt.get(ZmSetting.CAL_USE_QUICK_ADD)&&!g){var a=this._viewMgr?this._viewMgr.getDate():new Date();\nthis.newAppointmentHelper(a,ZmCalViewController.DEFAULT_APPOINTMENT_DURATION)\n}break;\ncase ZmKeyMap.EDIT:if(!g){var d=this.getSelection()[0];\nif(d){var c=new DwtSelectionEvent();\nc.detail=DwtListView.ITEM_DBL_CLICKED;\nc.item=d;\nthis._listSelectionListener(c)\n}}break;\ncase ZmKeyMap.CANCEL:var f=this._viewMgr.getCurrentView();\nif((this._currentViewType==ZmId.VIEW_CAL_WORK_WEEK)||(this._currentViewType==ZmId.VIEW_CAL_WEEK)||(this._currentViewType==ZmId.VIEW_CAL_MONTH)){var e=DwtMouseEventCapture.getTargetObj();\nif(e){f._restoreApptLoc(e);\nf._cancelNewApptDrag(e);\ne.startDate=e.appt?e.appt._orig.startDate:null;\nZmCalBaseView._apptMouseUpHdlr(null)\n}}break;\ndefault:return ZmListController.prototype.handleKeyAction.call(this,b)\n}return true\n};\nZmCalViewController.prototype._getDefaultFocusItem=function(){return this._toolbar[ZmId.VIEW_CAL]\n};\nZmCalViewController.prototype._getMsgController=function(){if(!this._msgController){if(appCtxt.get(ZmSetting.MAIL_ENABLED)){this._msgController=AjxDispatcher.run(\"GetMsgController\")\n}else{AjxDispatcher.require(\"Mail\");\nthis._msgController=new ZmMsgController(this._container,this._app)\n}}return this._msgController\n};\nZmCalViewController.prototype.getMiniCalendarParams=function(){var a=this.getMiniCalendar().getDateRange();\nreturn{start:a.start.getTime(),end:a.end.getTime(),fanoutAllDay:true,noBusyOverlay:true,folderIds:this.getCheckedCalendarFolderIds(),tz:AjxTimezone.DEFAULT}\n};\nZmCalViewController.prototype.getMiniCalCache=function(){if(!this._miniCalCache){this._miniCalCache=new ZmMiniCalCache(this)\n}return this._miniCalCache\n};\nZmCalViewController.prototype.getCalendarName=function(a){var b=appCtxt.getById(a);\nreturn b&&b.getName()\n};\nZmCalViewController.prototype._checkItemCount=function(){};\nZmCalViewController.prototype._showOrigListener=function(b){var c=this.getActionMenu();\nvar a=c&&c.__appt;\nif(a){setTimeout(this._showApptSource.bind(this,a),100)\n}};\nZmCalViewController.prototype._showApptSource=function(b){var a=appCtxt.get(ZmSetting.CSFE_MSG_FETCHER_URI)+\"&id=\"+AjxStringUtil.urlComponentEncode(b.id||b.invId)+\"&mime=text/plain&noAttach=1&icalAttach=none\";\nwindow.open(a,\"_blank\",\"menubar=yes,resizable=yes,scrollbars=yes\")\n};\nZmCalViewController.prototype.getAppointmentByInvite=function(a,f){var d=a.getAppointmentId();\nif(d){var e={GetAppointmentRequest:{_jsns:\"urn:zimbraMail\"}};\nvar c=e.GetAppointmentRequest;\nc.id=d;\nc.includeContent=\"1\";\nvar b=(appCtxt.multiAccounts?appCtxt.accountList.mainAccount.name:null);\nappCtxt.getAppController().sendRequest({jsonObj:e,asyncMode:true,callback:(new AjxCallback(this,this._getApptItemInfoHandler,[a,f])),errorCallback:(new AjxCallback(this,this._getApptItemInfoErrorHandler,[a,f])),accountName:b})\n}};\nZmCalViewController.prototype._getApptItemInfoHandler=function(d,h,b){var g=b.getResponse();\ng=g.GetAppointmentResponse;\nvar c=new ZmApptList();\nvar a=g.appt[0];\nvar f=ZmAppt.createFromDom(a,{list:c},null);\nvar e=a.inv;\nf.setInvIdFromProposedInvite(e,d);\nif(h){h.run(f)\n}};\nZmCalViewController.prototype._getApptItemInfoErrorHandler=function(c,d,b){var a=appCtxt.getMsgDialog();\na.reset();\na.setMessage(ZmMsg.unableToAcceptTime,DwtMessageDialog.INFO_STYLE);\na.popup();\nreturn true\n};\nZmCalViewController.prototype.acceptProposedTime=function(d,b,c){this._proposedTimeCallback=c;\nif(d){var e=new AjxCallback(this,this._acceptProposedTimeContinue,[b]);\nthis.getAppointmentByInvite(b,e)\n}else{var a=appCtxt.getMsgDialog();\na.reset();\na.setMessage(ZmMsg.unableToAcceptTime,DwtMessageDialog.INFO_STYLE);\na.popup()\n}};\nZmCalViewController.prototype._acceptProposedTimeContinue=function(a,b){var c=b.isRecurring()?(b.isException?ZmCalItem.MODE_EDIT_SINGLE_INSTANCE:ZmCalItem.MODE_EDIT_SERIES):ZmCalItem.MODE_EDIT;\nb.setProposedInvite(a);\nb.setProposedTimeCallback(this._proposedTimeCallback);\nthis.editAppointment(b,c)\n};\nZmCalViewController.prototype.proposeNewTime=function(g){var a=this.newApptObject(new Date(),null,null,g),f=ZmCalItem.MODE_EDIT,e=g.invite.getAppointmentId();\na.setProposeTimeMode(true);\na.setFromMailMessageInvite(g);\nif(e){var c=g.id;\nvar d=g.id.indexOf(\":\");\nvar h=null;\nif(d!==-1){h=c.substr(0,d);\nc=c.substr(d+1)\n}var b=[e,c].join(\"-\");\nif(h){b=[h,b].join(\":\")\n}a.invId=b;\na.getDetails(f,new AjxCallback(this,this.proposeNewTimeContinue,[a,f]))\n}else{a.setViewMode(f);\nAjxDispatcher.run(\"GetApptComposeController\").proposeNewTime(a)\n}};\nZmCalViewController.prototype.proposeNewTimeContinue=function(a,b){a.setViewMode(b);\nAjxDispatcher.run(\"GetApptComposeController\").proposeNewTime(a)\n};\nZmCalViewController.prototype.forwardInvite=function(d){var a=d.invite;\nvar c=a.getAppointmentId();\nif(c&&a.isOrganizer()){var e=new AjxCallback(this,this.forwardInviteContinue,[a,d]);\nthis.getAppointmentByInvite(a,e)\n}else{var b=this.newApptObject(new Date(),null,null,d);\nb.setForwardMode(true);\nb.setFromMailMessageInvite(d);\nAjxDispatcher.run(\"GetApptComposeController\").forwardInvite(b)\n}};\nZmCalViewController.prototype.forwardInviteContinue=function(a,d,b){b.setForwardMode(true);\nb.setFromMailMessageInvite(d);\nvar c=b.isRecurring()?(b.isException?ZmCalItem.MODE_EDIT_SINGLE_INSTANCE:ZmCalItem.MODE_EDIT_SERIES):ZmCalItem.MODE_EDIT;\nvar e=ZmAppt.quickClone(b);\ne.getDetails(c,new AjxCallback(this,this._forwardInviteCompose,[e]))\n};\nZmCalViewController.prototype._forwardInviteCompose=function(a){AjxDispatcher.run(\"GetApptComposeController\").forwardInvite(a)\n};\nZmCalViewController.prototype.getFreeBusyInfo=function(e,b,f,h,a,c){var d=AjxSoapDoc.create(\"GetFreeBusyRequest\",\"urn:zimbraMail\");\nd.setMethodAttribute(\"s\",e);\nd.setMethodAttribute(\"e\",b);\nd.setMethodAttribute(\"uid\",f);\nvar g=(appCtxt.multiAccounts)?this._composeView.getApptEditView().getCalendarAccount():null;\nreturn appCtxt.getAppController().sendRequest({soapDoc:d,asyncMode:true,callback:h,errorCallback:a,noBusyOverlay:c,accountName:(g?g.name:null)})\n};\nZmCalViewController.prototype.getWorkingInfo=function(e,b,f,h,a,c){var d=AjxSoapDoc.create(\"GetWorkingHoursRequest\",\"urn:zimbraMail\");\nd.setMethodAttribute(\"s\",e);\nd.setMethodAttribute(\"e\",b);\nd.setMethodAttribute(\"name\",f);\nvar g=(appCtxt.multiAccounts)?this._composeView.getApptEditView().getCalendarAccount():null;\nreturn appCtxt.getAppController().sendRequest({soapDoc:d,asyncMode:true,callback:h,errorCallback:a,noBusyOverlay:c,accountName:(g?g.name:null)})\n};\nZmCalViewController.prototype.setCurrentListView=function(b){if(!b){return\n}if(this._currentListView!=b){var a=this._currentListView&&this._currentListView.hasFocus();\nthis._currentListView=b;\nthis._resetToolbarOperations();\nif(a){this._currentListView.focus()\n}}};\nZmCalViewController.prototype.getCurrentListView=function(){return this._currentListView||this.getCurrentView()\n};\nZmCalViewController.prototype.createAppointmentFromOOOPref=function(a,d,c,e){var b=new ZmAppt();\nb.setAllDayEvent(c);\nb.setStartDate(a);\nb.setEndDate(d);\nb.name=ZmMsg.outOfOffice;\nb.freeBusy=(appCtxt.get(ZmSetting.VACATION_CALENDAR_TYPE)==\"BUSY\")?\"B\":\"O\";\nb.message=appCtxt.get(ZmSetting.VACATION_MSG);\nb.convertToLocalTimezone();\nb.save(null,e)\n}\n}}if(AjxPackage.define(\"calendar.Appointment\")){AjxTemplate.register(\"calendar.Appointment#ComposeViewColumns\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<colgroup><col width=\"80\"><col><col width=\"90\"><col width=\"130\"><col width=\"100\"></colgroup>';\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ComposeViewColumns\"},false);\nAjxTemplate.register(\"calendar.Appointment\",AjxTemplate.getTemplate(\"calendar.Appointment#ComposeViewColumns\"),AjxTemplate.getParams(\"calendar.Appointment#ComposeViewColumns\"));\nAjxTemplate.register(\"calendar.Appointment#ComposeView\",function(c,h,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nb[d++]=\"<div id='\";\nb[d++]=f.id;\nb[d++]=\"_main'>\";\nvar a=\"width:\"+(AjxEnv.isIE?30:32)+\"px; overflow:visible; white-space:nowrap\";\nvar g=AjxEnv.isSafari&&!AjxEnv.isSafariNightly?\"height:52px;\":\"height:21px; overflow:hidden\";\nb[d++]=\"<div id='\";\nb[d++]=f.id;\nb[d++]=\"_top'><table role=\\\"presentation\\\" width='100%' class='calendar_edit_view_separator'><tr><td valign='top'><table role=\\\"presentation\\\" width=100% style='margin-top:5px;' id='\";\nb[d++]=f.id;\nb[d++]=\"_table' class='ZPropertySheet' cellspacing='6'>\";\nb[d++]=AjxTemplate.expand(\"#ComposeViewColumns\");\nb[d++]=\"<tr id='\";\nb[d++]=f.id;\nb[d++]=\"_invitemsg_container' style='display:none;'><td class='ZmFieldLabelRight'>&nbsp;</td><td colspan='4'><table role=\\\"presentation\\\"><tr><td id=\\\"\";\nb[d++]=f.id;\nb[d++]='_invitemsgicon\" >';\nb[d++]=AjxImg.getImageHtml(\"Information\");\nb[d++]='</td><td id=\"';\nb[d++]=f.id;\nb[d++]=\"_invitemsg\\\"><!-- Invite message --></td></tr></table></td></tr><tr id='\";\nb[d++]=f.id;\nb[d++]=\"_forward_options' style='display:none;'><td class='ZmFieldLabelRight'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_picker'>\";\nb[d++]=ZmMsg.toLabel;\nb[d++]=\"</div></td><td colspan='4' id='\";\nb[d++]=f.id;\nb[d++]=\"_to_control'></td></tr>\";\nif(f.isAppt&&!appCtxt.multiAccounts){b[d++]='<tr id=\"';\nb[d++]=f.id;\nb[d++]=\"_identityContainer\\\"><td class='ZmFieldLabelRight'>\";\nb[d++]=ZmMsg.fromLabel;\nb[d++]=\"</td><td colspan='4' id=\\\"\";\nb[d++]=f.id;\nb[d++]='_identity\"></td></tr>'\n}b[d++]=\"<tr><td class='ZmFieldLabelRight'>\";\nb[d++]=ZmMsg.subjectLabel;\nb[d++]=\"</td><td colspan='4' id='\";\nb[d++]=f.id;\nb[d++]=\"_subject'></td></tr>\";\nif(f.isGroupCalEnabled){b[d++]='<tr id=\"';\nb[d++]=f.id;\nb[d++]=\"_attendeesContainer\\\"><td class='ZmFieldLabelRight'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_req_att_picker'>\";\nb[d++]=ZmMsg.attendeesLabel;\nb[d++]=\"</div></td><td colspan='3' id='\";\nb[d++]=f.id;\nb[d++]=\"_person'></td><td><div id='\";\nb[d++]=f.id;\nb[d++]=\"_show_optional' role='link' class='FakeAnchor' style='white-space:nowrap;'>\";\nb[d++]=ZmMsg.showOptional;\nb[d++]=\"</div></td></tr><tr id='\";\nb[d++]=f.id;\nb[d++]=\"_optionalContainer'><td class='ZmFieldLabelRight'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_opt_att_picker'>\";\nb[d++]=ZmMsg.optionalLabel;\nb[d++]=\"</div></td><td colspan='3' id='\";\nb[d++]=f.id;\nb[d++]=\"_optional'></td></tr><tr><td></td><td colspan='4'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_attendee_status' class='ZmLocationStatusConflict' style=\\\"float:left;\\\" x-display='inline-block'>\";\nb[d++]=AjxImg.getImageHtml(\"Warning_12\",\"display:inline-block;padding-right:4px;float:left;\")+ZmMsg.attendeeConflict;\nb[d++]=\"</div><div id='\";\nb[d++]=f.id;\nb[d++]=\"_suggest_time' role='link' class='FakeAnchor ZmSuggestLink' x-display='inline-block'>\";\nb[d++]=ZmMsg.suggestATime;\nb[d++]=\"</div></td></tr>\"\n}b[d++]=\"<tr><td class='ZmFieldLabelRight'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_loc_picker'>\";\nb[d++]=ZmMsg.locationLabel;\nb[d++]=\"</div></td>\";\nif(f.isGalEnabled&&f.isGroupCalEnabled){b[d++]=\"<td colspan='3' id='\";\nb[d++]=f.id;\nb[d++]=\"_location'></td><td><div id='\";\nb[d++]=f.id;\nb[d++]=\"_show_resources' role='link' class='FakeAnchor' style='white-space:nowrap;'>\";\nb[d++]=ZmMsg.showEquipment;\nb[d++]=\"</div></td>\"\n}else{b[d++]=\"<td colspan='4' id='\";\nb[d++]=f.id;\nb[d++]=\"_location'></td>\"\n}b[d++]=\"</tr><tr><td></td><td colspan='4'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_location_status'  class='ZmLocationStatusConflict' x-display='inline-block'></div><div id='\";\nb[d++]=f.id;\nb[d++]=\"_location_status_action' role='link' class='FakeAnchor ZmSuggestLink' x-display='inline-block'></div><div id='\";\nb[d++]=f.id;\nb[d++]=\"_suggest_location' role='link' class='FakeAnchor ZmSuggestLink' x-display='inline-block'>\";\nb[d++]=ZmMsg.suggestALocation;\nb[d++]=\"</div></td></tr>\";\nif(f.isGalEnabled&&f.isGroupCalEnabled){b[d++]=\"<tr id='\";\nb[d++]=f.id;\nb[d++]=\"_resourcesContainer'><td class='ZmFieldLabelRight'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_res_btn'>\";\nb[d++]=ZmMsg.equipmentLabel;\nb[d++]=\"</div></td><td colspan='3' id='\";\nb[d++]=f.id;\nb[d++]=\"_resourcesData'></td><td>&nbsp;</td></tr>\"\n}b[d++]=\"<tr><td style='\";\nb[d++]=AjxEnv.isWebKitBased?\"padding-top:14px;\":\"\";\nb[d++]=\"' class='ZmFieldLabelRight'>\";\nb[d++]=(f.isAppt?ZmMsg.startLabel:(ZmMsg.startDate+\":\"));\nb[d++]='</td><td rowspan=\"2\" colspan=\"3\" align=\"right\"><table role=\"presentation\" width=\"100%\"><tr><td style=\\'';\nb[d++]=AjxEnv.isIE?\"overflow:visible;\":\"\";\nb[d++]=\"'><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr>\";\nb[d++]=AjxTemplate.expand(\"#ApptTimeSection_StartDate\",f);\nb[d++]=\"<td id='\";\nb[d++]=f.id;\nb[d++]=\"_tzoneSelectStart'></td><td align=\\\"left\\\" nowrap=\\\"true\\\"><input type='checkbox' id='\";\nb[d++]=f.id;\nb[d++]=\"_allDayCheckbox'><label for=\\\"\";\nb[d++]=f.id;\nb[d++]=\"_allDayCheckbox\\\" style='margin-left:.25em;white-space:nowrap;'>\";\nb[d++]=ZmMsg.allDay;\nb[d++]='</label></td></tr></table></td><td colspan=\"2\" rowspan=\"2\" align=\"right\"><table role=\"presentation\" class=\\'ZPropertySheet\\' cellspacing=\\'6\\'><tr><td id=\\'';\nb[d++]=f.id;\nb[d++]=\"_repeatLabel' class='ZmFieldLabelRight'>\";\nb[d++]=ZmMsg.repeatLabel;\nb[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_repeat_options' colspan=\\\"2\\\"><div id='\";\nb[d++]=f.id;\nb[d++]=\"_repeatSelect' class=\\\"ZmApptComposeField\\\"></div><div id='\";\nb[d++]=f.id;\nb[d++]=\"_repeatDesc' class=\\\"ZmApptComposeField FakeAnchor\\\"></div></td></tr><tr><td id='\";\nb[d++]=f.id;\nb[d++]=\"_reminder_options' class='ZmFieldLabelRight'>\";\nb[d++]=ZmMsg.reminderLabel;\nb[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderSelectContainer' class='miniTimeButton ZmSelector'><table role=\\\"presentation\\\"><tr><td id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderSelectInput'></td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderSelect'> </td></tr></table></td></tr></table></td></tr><tr><td style='\";\nb[d++]=AjxEnv.isIE?\"overflow:visible;\":\"\";\nb[d++]=\"'><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr>\";\nb[d++]=AjxTemplate.expand(\"#ApptTimeSection_EndDate\",f);\nb[d++]=\"<td id='\";\nb[d++]=f.id;\nb[d++]=\"_tzoneSelectEnd'></td></tr></table></td></tr></table></td><td></td></tr><tr><td style='\";\nb[d++]=AjxEnv.isWebKitBased?\"padding-top:6px;\":\"\";\nb[d++]=\"' class='ZmFieldLabelRight'>\";\nb[d++]=(f.isAppt?ZmMsg.endLabel:ZmMsg.dateDueLabel);\nb[d++]=\"</td><td><div id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderConfigure'></div></td></tr><tr id=\\\"\";\nb[d++]=f.id;\nb[d++]='_meetingInPastWarning\" style=\"display:none\"><td></td><td><div class=\"ImgInformation\" style=\"float: left; margin: 0 0.5rem 0 0;\"></div><div id=\"';\nb[d++]=f.id;\nb[d++]='_meetingInPastWarningMessageText\" style=\"font-size: 0.95rem;\"></div></td></tr><tr><td class=\\'ZmFieldLabelRight\\'>';\nb[d++]=f.isAppt?ZmMsg.displayLabel:ZmMsg.taskFolder;\nb[d++]=\"</td><td><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td id='\";\nb[d++]=f.id;\nb[d++]=\"_showAsSelect' align=\\\"right\\\" style='padding-left:0;'></td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_folderSelect'></td><td><input type='checkbox' id='\";\nb[d++]=f.id;\nb[d++]=\"_privateCheckbox'><label for=\\\"\";\nb[d++]=f.id;\nb[d++]=\"_privateCheckbox\\\" style='margin-left:.25em;white-space:nowrap;'>\";\nb[d++]=ZmMsg._private;\nb[d++]=\"</label></td></tr></table></td><td></td><td colspan='2'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderEmailCheckbox'></div></td></tr>\";\nif(appCtxt.get(ZmSetting.CAL_DEVICE_EMAIL_REMINDERS_ENABLED)){b[d++]=\"<tr><td colspan='2'></td><td></td><td colspan='2'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderDeviceEmailCheckbox'></div></td></tr>\"\n}b[d++]=\"<tr id='\";\nb[d++]=f.id;\nb[d++]=\"_attachment_container' style=\\\"display:none;\\\"></tr><tr><td colspan='5' id='\";\nb[d++]=f.id;\nb[d++]='_scheduler_option\\' style=\\'padding:7px;\\'><div style=\"float:left;\" class=\"calendar_edit_field\">';\nb[d++]=ZmMsg.scheduler;\nb[d++]='</div><div style=\"float:left; padding-left:5px;\" id=\"';\nb[d++]=f.id;\nb[d++]='_scheduleButton\" class=\"FakeAnchor\">';\nb[d++]=ZmMsg.show;\nb[d++]='</div><div id=\"';\nb[d++]=f.id;\nb[d++]='_scheduleImage\" class=\"ImgSelectPullDownArrow\" style=\"float:left;\"></div></td></tr><tr><td colspan=\\'5\\' id=\\'';\nb[d++]=f.id;\nb[d++]=\"_scheduler'></td></tr></table></td><td width=\\\"8\\\"></td></tr></table></div><!-- appointment notes --><div id='\";\nb[d++]=f.id;\nb[d++]=\"_notes' style='padding:5px;' class='calendar_edit_notes_separator'></div></div><div id='\";\nb[d++]=f.id;\nb[d++]=\"_suggestions' class='ZmSuggestView'> </div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"calendar.Appointment#ComposeView\"},false);\nAjxTemplate.register(\"calendar.Appointment#SuggestionsView\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]=\"_suggest_container' class='ZmSuggestContainer'><div class='ZmSuggestHeader'><div id='\";\na[c++]=e.id;\na[c++]=\"_suggestion_name'\\t\\t\\tclass='ZmSuggestLabel'>&nbsp;</div><div id='\";\na[c++]=e.id;\na[c++]=\"_suggest_options_image'\\tclass='ZmSuggestOptionsButton'>\";\na[c++]=AjxImg.getImageHtml(\"Options\");\na[c++]=\"</div><div id='\";\na[c++]=e.id;\na[c++]=\"_suggest_close'\\t\\t\\tclass='ZmSuggestCloseButton'>\";\na[c++]=AjxImg.getImageHtml(\"CloseGray\");\na[c++]=\"</div></div><div class='ZmSuggestBody'><div id='\";\na[c++]=e.id;\na[c++]=\"_suggest_minical'\\t\\t\\tclass='ZmSuggestMiniCal'></div><div id='\";\na[c++]=e.id;\na[c++]=\"_suggest_view'\\t\\t\\tclass='ZmSuggestResults'></div></div></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#SuggestionsView\"},false);\nAjxTemplate.register(\"calendar.Appointment#EditView\",function(c,h,f,b){var e=Boolean(b);\nf=(typeof f==\"string\"?{id:f}:f)||{};\nb=b||[];\nvar d=b.length;\nvar a=\"width:\"+(AjxEnv.isIE?30:32)+\"px; overflow:visible; white-space:nowrap\";\nvar g=AjxEnv.isSafari&&!AjxEnv.isSafariNightly?\"height:52px;\":\"height:21px; overflow:hidden\";\nb[d++]=\"<div id='\";\nb[d++]=f.id;\nb[d++]=\"_top'><table role=\\\"presentation\\\" width=100% style='table-layout:fixed;' id='\";\nb[d++]=f.id;\nb[d++]=\"_table'><colgroup><col width='\";\nb[d++]=AjxEnv.is800x600orLower?\"235\":\"50%\";\nb[d++]=\"' /><col width='\";\nb[d++]=AjxEnv.is800x600orLower?\"*\":\"50%\";\nb[d++]=\"' /></colgroup><tr id='\";\nb[d++]=f.id;\nb[d++]=\"_forward_options' style='display:none;'><td colspan=2><!-- appointment forward UI --><table role=\\\"presentation\\\" width=100% class='ZPropertySheet' cellspacing='6'><tr><td align=right valign=top width='1%' style='\";\nb[d++]=a;\nb[d++]=\"'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_picker'>\";\nb[d++]=ZmMsg.toLabel;\nb[d++]=\"</div></td><td colspan=2 id='\";\nb[d++]=f.id;\nb[d++]=\"_to_control'></td></tr></table></td></tr><tr><!-- appointment details section --><td valign=top><fieldset><legend>\";\nb[d++]=ZmMsg.details;\nb[d++]=\"</legend><div><table role=\\\"presentation\\\" width=100% class='ZPropertySheet' cellspacing='6'><colgroup><col width='1%' /><col /><col /></colgroup>\";\nif(f.isAppt&&!appCtxt.multiAccounts){b[d++]='<tr id=\"';\nb[d++]=f.id;\nb[d++]='_identityContainer\"><td width=\"1%\" class=\\'ZmFieldLabelRight\\'>';\nb[d++]=ZmMsg.fromLabel;\nb[d++]=\"</td><td colspan='2' id=\\\"\";\nb[d++]=f.id;\nb[d++]='_identity\"></td></tr>'\n}b[d++]=\"<tr><td width=\\\"1%\\\" class='ZmFieldLabelRight'>*&nbsp;\";\nb[d++]=ZmMsg.subjectLabel;\nb[d++]=\"</td><td colspan=2 id='\";\nb[d++]=f.id;\nb[d++]=\"_subject'></td></tr><tr><td width='1%' class='ZmApptTabViewPageField' style='white-space:nowrap;'>\";\nb[d++]=ZmMsg.locationLabel;\nb[d++]=\"</td><td colspan='2' id='\";\nb[d++]=f.id;\nb[d++]=\"_location'></td></tr>\";\nif(f.isAppt){b[d++]=\"<tr><td width=\\\"100%\\\" colspan=3><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6' width='100%'><tr><td class='ZmFieldLabelRight' style='margin-right:.25em;'>\";\nb[d++]=ZmMsg.showAsLabel;\nb[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_showAsSelect'></td><td class='ZmFieldLabelRight' style='margin-right:.25em;' width='100%'>\";\nb[d++]=ZmMsg.markAs;\nb[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_privacySelect'></td></tr></table></td></tr>\"\n}else{b[d++]=\"<tr><td class='ZmFieldLabelRight'>\";\nb[d++]=ZmMsg.priorityLabel;\nb[d++]=\"</td><td colspan=2 id='\";\nb[d++]=f.id;\nb[d++]=\"_priority'></td></tr>\"\n}b[d++]=\"<tr id='\";\nb[d++]=f.id;\nb[d++]=\"_folderRow'><td class='ZmFieldLabelRight'>\";\nb[d++]=f.isAppt?ZmMsg.calendarLabel:ZmMsg.taskFolder;\nb[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_folderSelect'></td></tr><tr>\";\nif(!f.isAppt){b[d++]=\"<td colspan=10>\";\nb[d++]=f.isAppt?\"&nbsp;\":\"\";\nb[d++]=\"</td>\"\n}b[d++]='</tr><tr><td colspan=10></td></tr></table></div></fieldset></td><!-- appointment date/time section --><td valign=top><fieldset><legend id=\"';\nb[d++]=f.id;\nb[d++]='_timeLegend\">';\nb[d++]=(f.isAppt?ZmMsg.time:ZmMsg.progress);\nb[d++]=\"</legend><div style='overflow:hidden; \";\nb[d++]=AjxEnv.isIE?\" width:99%\":\"\";\nb[d++]=\"'><table role=\\\"presentation\\\" width=100% class=\\\"ZPropertySheet\\\" cellspacing='6'><colgroup><col width='1%' /><col /><col /></colgroup>\";\nb[d++]=(f.isAppt?\"\":AjxTemplate.expand(\"calendar.Appointment#TaskDueSection\",f));\nb[d++]=AjxTemplate.expand(\"calendar.Appointment#ApptTimeSection\",f);\nif(!f.isAppt){b[d++]=\"<tr><td class='ZmFieldLabelRight' id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderLabel'>\";\nb[d++]=ZmMsg.reminderLabel;\nb[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderSelectContainer' width=\\\"50px\\\"><table role=\\\"presentation\\\"><tr><td class='ZmFieldLabelCenter'><div id='\";\nb[d++]=f.id;\nb[d++]='_reminderCheckbox\\'></div></td><td class=\"quickAddDateFld\">';\nb[d++]=AjxTemplate.expand(\"#DateField\",{id:f.id+\"_remindDateField\",value:f.currDate,label:ZmMsg.reminder});\nb[d++]='</td><td class=\"miniCalendarButton ZmSelector\" id=\\'';\nb[d++]=f.id;\nb[d++]=\"_remindMiniCalBtn'> </td></tr></table></td><td id='\";\nb[d++]=f.id;\nb[d++]='_remindTimeSelect\\' colspan=2></td></tr><tr><td>&nbsp;</td><td colspan=\"3\"><table role=\"presentation\"><tr><td style=\"padding:0px 0px 0px 8px;\"><div id=\\'';\nb[d++]=f.id;\nb[d++]=\"_reminderConfigure'></div></td></tr></table></td></tr><tr><td></td><td colspan=\\\"3\\\"><div id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderEmailCheckbox'></div></td></td></tr>\";\nif(appCtxt.get(ZmSetting.CAL_DEVICE_EMAIL_REMINDERS_ENABLED)){b[d++]='<tr><td></td><td colspan=\"3\"><div id=\\'';\nb[d++]=f.id;\nb[d++]=\"_reminderDeviceEmailCheckbox'></div></td></td></tr>\"\n}}if(f.isAppt){b[d++]=\"<tr id='\";\nb[d++]=f.id;\nb[d++]=\"_repeat_options'><td valign=top class='ZmFieldLabelRight' style='line-height:1.8rem' id='\";\nb[d++]=f.id;\nb[d++]=\"_repeatLabel'>\";\nb[d++]=ZmMsg.repeatLabel;\nb[d++]='</td><td valign=top colspan=10><table role=\"presentation\" width=100%><tr><td width=100 id=\\'';\nb[d++]=f.id;\nb[d++]=\"_repeatSelect' style='padding-right:5px;'></td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_repeatDesc' style='text-decoration:underline'></td></tr></table></td></tr><tr id='\";\nb[d++]=f.id;\nb[d++]=\"_reminder_options'><td valign=top class='ZmFieldLabelRight' style='line-height:22px; line-height:1.8rem' id='\";\nb[d++]=f.id;\nb[d++]=\"_repeatLabel'>\";\nb[d++]=ZmMsg.reminderLabel;\nb[d++]=\"</td><td valign=top colspan=9 align='left' id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderSelectContainer' class='miniTimeButton ZmSelector'><table role=\\\"presentation\\\"><tr><td id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderSelectInput'></td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderSelect'> </td></tr></table></td><td style=\\\"padding:0px 0px 0px 8px;\\\"><div id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderConfigure'></div></td></tr><tr><td><div id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderEmailCheckbox'></div></td></tr>\";\nif(appCtxt.get(ZmSetting.CAL_DEVICE_EMAIL_REMINDERS_ENABLED)){b[d++]=\"<tr><td><div id='\";\nb[d++]=f.id;\nb[d++]=\"_reminderDeviceEmailCheckbox'></div></td></tr>\"\n}}b[d++]=\"</table></div></fieldset></td></tr>\";\nif(f.isAppt&&f.isGroupCalEnabled){b[d++]=\"<tr><td colspan='2'><!-- appointment attendees / resources --><table role=\\\"presentation\\\" width=100% class='ZPropertySheet' cellspacing='6'><tr id='\";\nb[d++]=f.id;\nb[d++]=\"_organizer_options'><td width='1%' align='right' valign='top' class='ZmApptTabViewPageField'><legend>\";\nb[d++]=ZmMsg.organizerLabel;\nb[d++]=\"</legend></td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_organizer'></td></tr><tr><td rowspan='2' width='1%' align='right' valign='top' class='ZmApptTabViewPageField'><legend>\";\nb[d++]=ZmMsg.attendeesLabel;\nb[d++]=\"</legend></td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_person'></td></tr><tr id='\";\nb[d++]=f.id;\nb[d++]=\"_notification_options'><td><table role=\\\"presentation\\\"><tr><td><input type='checkbox' id='\";\nb[d++]=f.id;\nb[d++]=\"_requestResponses'></td><td class='ZmFieldLabelLeft' style='padding-left:5px;'><label for='\";\nb[d++]=f.id;\nb[d++]=\"_requestResponses'>\";\nb[d++]=ZmMsg.requestResponses;\nb[d++]=\"</label></td><td><input type='checkbox' id='\";\nb[d++]=f.id;\nb[d++]=\"_sendNotificationMail'></td><td class='ZmFieldLabelLeft' style='padding-left:5px;'><label for='\";\nb[d++]=f.id;\nb[d++]=\"_sendNotificationMail'>\";\nb[d++]=ZmMsg.sendNotificationMail;\nb[d++]=\"<label></td></tr></table></td></tr>\";\nif(f.isGalEnabled){b[d++]=\"<tr><td colspan='2'><div id='\";\nb[d++]=f.id;\nb[d++]=\"_resourcesContainer' style='display:none'><table role=\\\"presentation\\\" width=100%><tr><td valign=top width=1% align=right class='ZmApptTabViewPageField'>\";\nb[d++]=ZmMsg.resourcesLabel;\nb[d++]=\"</td><td id='\";\nb[d++]=f.id;\nb[d++]=\"_resourcesData'></td></tr></table></div></td></tr>\"\n}b[d++]=\"</table></td></tr>\"\n}b[d++]=\"</table></div><!-- appointment notes --><div id='\";\nb[d++]=f.id;\nb[d++]=\"_notes' style='padding:5px;'></div>\";\nreturn e?b.length:b.join(\"\")\n},{id:\"calendar.Appointment#EditView\"},false);\nAjxTemplate.register(\"calendar.Appointment#AttachContainer\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<fieldset class='ZmFieldset'><legend class='ZmLegend'>\";\na[c++]=ZmMsg.attachments;\na[c++]=\"</legend><form style='margin:0;padding:0' method='POST' action='\";\na[c++]=e.url;\na[c++]=\"' id='\";\na[c++]=e.uploadFormId;\na[c++]=\"' enctype='multipart/form-data'><div id='\";\na[c++]=e.attachDivId;\na[c++]=\"'></div></form></fieldset>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#AttachContainer\"},false);\nAjxTemplate.register(\"calendar.Appointment#AttachAdd\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<input type='file' size=40 name='\";\na[c++]=e.uploadFieldName;\na[c++]=\"' id='\";\na[c++]=e.attachInputId;\na[c++]=\"' multiple style='margin:0 5px;'><span style='cursor:pointer;color:blue;text-decoration:underline;' id='\";\na[c++]=e.attachRemoveId;\na[c++]=\"'>\";\na[c++]=ZmMsg.remove;\na[c++]=\"</span><span id='\";\na[c++]=e.sizeId;\na[c++]=\"'>&nbsp;</span>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#AttachAdd\"},false);\nAjxTemplate.register(\"calendar.Appointment#ZmApptQuickAddDialog\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<table role=\"presentation\" class=\"ZPropertySheet\" cellspacing=\\'6\\'><tr><td valign=top><table role=\"presentation\" style=\"margin-left:25px; width:330px;\" class=\"ZPropertySheet\" cellspacing=\\'6\\'><tr><td id=\\'';\na[c++]=e.id;\na[c++]=\"_subject_label' class='ZmApptTabViewPageField'><sup>*</sup>\";\na[c++]=ZmMsg.subjectLabel;\na[c++]=\"</td><td colspan='2' id='\";\na[c++]=e.id;\na[c++]=\"_subject'></td></tr><tr><td id='\";\na[c++]=e.id;\na[c++]=\"_location_label' class='ZmApptTabViewPageField'>\";\na[c++]=ZmMsg.locationLabel;\na[c++]=\"</td><td colspan='2' id='\";\na[c++]=e.id;\na[c++]=\"_location'></td></tr><tr><td></td><td colspan='2'><div id='\";\na[c++]=e.id;\na[c++]=\"_suggest_location' style=\\\"height:1.4em;\\\" role='link' class='FakeAnchor'>\";\na[c++]=ZmMsg.suggestALocation;\na[c++]=\"</div></td></tr><tr><td id='\";\na[c++]=e.id;\na[c++]=\"_display_label' class='ZmApptTabViewPageField'>\";\na[c++]=ZmMsg.displayLabel;\na[c++]=\"</td><td colspan='2'><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6' width='100%'><tr><td id='\";\na[c++]=e.id;\na[c++]=\"_showAs' width='100%'></td><td id='\";\na[c++]=e.id;\na[c++]=\"_privacy_label' class='ZmApptTabViewPageField'>\";\na[c++]=ZmMsg.markAs;\na[c++]=\"</td><td id='\";\na[c++]=e.id;\na[c++]=\"_privacy'></td></tr></table></td></tr><tr id='\";\na[c++]=e.id;\na[c++]=\"_folderRow'><td id='\";\na[c++]=e.id;\na[c++]=\"_calendar_label' class='ZmApptTabViewPageField'>\";\na[c++]=ZmMsg.calendarLabel;\na[c++]=\"</td><td colspan='2' id='\";\na[c++]=e.id;\na[c++]=\"_calendar'></td></tr><tr><td colspan='3'></td></tr><tr><td class='ZmApptTabViewPageField'>\";\na[c++]=ZmMsg.startTimeLabel;\na[c++]='</td><td colspan=2><table role=\"presentation\"><tr><td class=\"quickAddDateFld\">';\na[c++]=AjxTemplate.expand(\"#DateField\",{id:e.id+\"_startDate\",label:ZmMsg.startDate});\na[c++]='</td><td class=\"miniCalendarButton ZmSelector\" id=\\'';\na[c++]=e.id;\na[c++]=\"_startMiniCal'></td><td id='\";\na[c++]=e.id;\na[c++]=\"_startTimeAt'><div style='margin:0 5px;'>\";\na[c++]=ZmMsg.at;\na[c++]=\"</div></td><td id='\";\na[c++]=e.id;\na[c++]=\"_startTime'></td></tr></table></td></tr><tr><td class='ZmApptTabViewPageField'>\";\na[c++]=ZmMsg.endTimeLabel;\na[c++]='</td><td colspan=\\'2\\'><table role=\"presentation\"><tr><td class=\"quickAddDateFld\">';\na[c++]=AjxTemplate.expand(\"#DateField\",{id:e.id+\"_endDate\",label:ZmMsg.endDate});\na[c++]='</td><td class=\"miniCalendarButton ZmSelector\" id=\\'';\na[c++]=e.id;\na[c++]=\"_endMiniCal'></td><td id='\";\na[c++]=e.id;\na[c++]=\"_endTimeAt'><div style='margin:0 5px;'>\";\na[c++]=ZmMsg.at;\na[c++]=\"</div></td><td id='\";\na[c++]=e.id;\na[c++]=\"_endTime'></td></tr></table></td></tr><tr id=\\\"\";\na[c++]=e.id;\na[c++]='_meetingInPastWarning\" style=\"display:none\"><td></td><td><div class=\"ImgInformation\" style=\"float: left; margin: 0 0.5rem 0 0;\"></div><div id=\"';\na[c++]=e.id;\na[c++]=\"_meetingInPastWarningMessageText\\\" style=\\\"font-size: 0.95rem;\\\"></div></td></tr><tr><td colspan='3'></td></tr><tr><td class='ZmApptTabViewPageField'>\";\na[c++]=ZmMsg.repeatLabel;\na[c++]=\"</td><td id='\";\na[c++]=e.id;\na[c++]=\"_repeat'></td><td><span class='ZmApptTabViewPageField' style='width:100%' id='\";\na[c++]=e.id;\na[c++]=\"_repeatDesc'></span></td></tr><tr><td class='ZmApptTabViewPageField'>\";\na[c++]=ZmMsg.reminderLabel;\na[c++]=\"</td><td colspan='2'><table role=\\\"presentation\\\"><tr><td colspan='2' id='\";\na[c++]=e.id;\na[c++]=\"_reminderSelect'></td><td><div id='\";\na[c++]=e.id;\na[c++]=\"_reminderEmailCheckbox'></div></td>\";\nif(appCtxt.get(ZmSetting.CAL_DEVICE_EMAIL_REMINDERS_ENABLED)){a[c++]=\"<td><div id='\";\na[c++]=e.id;\na[c++]=\"_reminderDeviceEmailCheckbox'></div></td>\"\n}a[c++]=\"</tr></table></td></tr></table></td><td id='\";\na[c++]=e.id;\na[c++]=\"_suggestions' class='ZmSuggestView' valign=top><div id='\";\na[c++]=e.id;\na[c++]=\"_suggest_view'></div></td></tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ZmApptQuickAddDialog\"},false);\nAjxTemplate.register(\"calendar.Appointment#TaskDueSection\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<tr><td class='ZmFieldLabelRight' id='\";\na[c++]=e.id;\na[c++]=\"_statusLabel'>\";\na[c++]=ZmMsg.statusLabel;\na[c++]=\"</td><td width=175 id='\";\na[c++]=e.id;\na[c++]=\"_status'></td><td><table role=\\\"presentation\\\" class='ZmCompletionSelector ZmSelector'><tr><td id='\";\na[c++]=e.id;\na[c++]=\"_pCompleteSelectInput'></td><td id='\";\na[c++]=e.id;\na[c++]=\"_pCompleteSelect'></td><tr></table></td></tr><tr><td></td><td colspan='3' id='\";\na[c++]=e.id;\na[c++]=\"_due_message'></td></tr>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#TaskDueSection\"},false);\nAjxTemplate.register(\"calendar.Appointment#ApptTimeSection\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\nif(e.isAppt){a[c++]=\"<tr><td></td><td width=1%><table role=\\\"presentation\\\"><tr><td><input type='checkbox' id='\";\na[c++]=e.id;\na[c++]=\"_allDayCheckbox'></td><td class='ZmFieldLabelLeft'><label for='\";\na[c++]=e.id;\na[c++]=\"_allDayCheckbox' style='margin-left:.25em;'>\";\na[c++]=ZmMsg.allDayEvent;\na[c++]=\"</label></td></tr></table></td><td></td><td id='\";\na[c++]=e.id;\na[c++]=\"_tzoneSelect'></td></tr>\"\n}a[c++]=\"<tr><td class='ZmFieldLabelRight'>\";\na[c++]=(e.isAppt?ZmMsg.startLabel:(ZmMsg.startDate+\":\"));\na[c++]=\"</td><td \";\nif(!e.isAppt){a[c++]=\" colspan='3' \"\n}a[c++]=\" ><table role=\\\"presentation\\\"><tr><td class='quickAddDateFld'>\";\na[c++]=AjxTemplate.expand(\"#DateField\",{id:e.id+\"_startDateField\",value:e.currDate,label:ZmMsg.startDate});\na[c++]=\"</td><td class='miniCalendarButton ZmSelector' id='\";\na[c++]=e.id;\na[c++]=\"_startMiniCalBtn'></td></tr></table></td>\";\nif(e.isAppt){a[c++]=\"<td id='\";\na[c++]=e.id;\na[c++]=\"_startTimeAtLbl' class='ZmFieldLabelCenter'>\";\na[c++]=ZmMsg.at;\na[c++]=\"</td><td id='\";\na[c++]=e.id;\na[c++]=\"_startTimeSelect'></td>\"\n}a[c++]=\"</tr><tr><td class='ZmFieldLabelRight'>\";\na[c++]=(e.isAppt?ZmMsg.endLabel:ZmMsg.dateDueLabel);\na[c++]=\"</td><td \";\nif(!e.isAppt){a[c++]=\" colspan='3' \"\n}a[c++]=\"><table role=\\\"presentation\\\"><tr><td class='quickAddDateFld'>\";\na[c++]=AjxTemplate.expand(\"#DateField\",{id:e.id+\"_endDateField\",value:e.currDate,label:ZmMsg.endDate});\na[c++]=\"</td><td class='miniCalendarButton ZmSelector' id='\";\na[c++]=e.id;\na[c++]=\"_endMiniCalBtn'></td></tr></table></td>\";\nif(e.isAppt){a[c++]=\"<td id='\";\na[c++]=e.id;\na[c++]=\"_endTimeAtLbl' class='ZmFieldLabelCenter'>\";\na[c++]=ZmMsg.at;\na[c++]=\"</td><td id='\";\na[c++]=e.id;\na[c++]=\"_endTimeSelect'></td>\"\n}a[c++]=\"</tr>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ApptTimeSection\"},false);\nAjxTemplate.register(\"calendar.Appointment#ApptTimeSection_New\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<tr><td width=\\\"60\\\" class='ZmFieldLabelRight'>\";\na[c++]=(e.isAppt?ZmMsg.startLabel:(ZmMsg.startDate+\":\"));\na[c++]='</td><td><table role=\"presentation\"><tr><td class=\"quickAddDateFld\">';\na[c++]=AjxTemplate.expand(\"#DateField\",{id:e.id+\"_startDateField\",value:e.currDate,label:ZmMsg.startDate});\na[c++]='</td><td class=\"miniCalendarButton ZmSelector\" id=\\'';\na[c++]=e.id;\na[c++]=\"_startMiniCalBtn'></td></tr></table></td>\";\nif(e.isAppt){a[c++]=\"<td id='\";\na[c++]=e.id;\na[c++]=\"_startTimeAtLbl' class='ZmFieldLabelCenter'>\";\na[c++]=ZmMsg.at;\na[c++]=\"</td><td id='\";\na[c++]=e.id;\na[c++]=\"_startTimeSelect'></td><td id='\";\na[c++]=e.id;\na[c++]=\"_tzoneSelect'></td>\"\n}a[c++]=\"</tr><tr><td width=\\\"60\\\" class='ZmFieldLabelRight'>\";\na[c++]=(e.isAppt?ZmMsg.endLabel:ZmMsg.dateDueLabel);\na[c++]='</td><td><table role=\"presentation\"><tr><td class=\"quickAddDateFld\">';\na[c++]=AjxTemplate.expand(\"#DateField\",{id:e.id+\"_endDateField\",value:e.currDate,label:ZmMsg.startDate});\na[c++]='</td><td class=\"miniCalendarButton ZmSelector\" id=\\'';\na[c++]=e.id;\na[c++]=\"_endMiniCalBtn'></td></tr></table></td>\";\nif(e.isAppt){a[c++]=\"<td id='\";\na[c++]=e.id;\na[c++]=\"_endTimeAtLbl' class='ZmFieldLabelCenter'>\";\na[c++]=ZmMsg.at;\na[c++]=\"</td><td id='\";\na[c++]=e.id;\na[c++]=\"_endTimeSelect'></td><td><table role=\\\"presentation\\\"><tr><td><input type='checkbox' id='\";\na[c++]=e.id;\na[c++]=\"_allDayCheckbox'></td><td class='ZmFieldLabelLeft'><label for='\";\na[c++]=e.id;\na[c++]=\"_allDayCheckbox' style='margin-left:.25em;'> \";\na[c++]=ZmMsg.allDayEvent;\na[c++]=\"</label></td></tr></table></td>\"\n}a[c++]=\"</tr>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ApptTimeSection_New\"},false);\nAjxTemplate.register(\"calendar.Appointment#ApptTimeSection_EndDate\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<td style=\\'padding-left:0;\\'><table role=\"presentation\"><tr><td class=\"quickAddDateFld\">';\na[c++]=AjxTemplate.expand(\"#DateField\",{id:e.id+\"_endDateField\",value:e.currDate,label:ZmMsg.endDate});\na[c++]='</td><td class=\"miniCalendarButton ZmSelector\" id=\\'';\na[c++]=e.id;\na[c++]=\"_endMiniCalBtn'></td></tr></table></td>\";\nif(e.isAppt){a[c++]=\"<td id='\";\na[c++]=e.id;\na[c++]=\"_endTimeSelect'></td>\"\n}return d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ApptTimeSection_EndDate\"},false);\nAjxTemplate.register(\"calendar.Appointment#ApptTimeSection_StartDate\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<td style=\\'padding-left:0;\\'><table role=\"presentation\"><tr><td class=\"quickAddDateFld\">';\na[c++]=AjxTemplate.expand(\"#DateField\",{id:e.id+\"_startDateField\",value:e.currDate,label:ZmMsg.startDate});\na[c++]='</td><td class=\"miniCalendarButton ZmSelector\" id=\\'';\na[c++]=e.id;\na[c++]=\"_startMiniCalBtn'></td></tr></table></td>\";\nif(e.isAppt){a[c++]=\"<td id='\";\na[c++]=e.id;\na[c++]=\"_startTimeSelect'></td>\"\n}return d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ApptTimeSection_StartDate\"},false);\nAjxTemplate.register(\"calendar.Appointment#DateField\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<input autocomplete='off' class='ZmDateFieldInput' type='text' size=14 id='\";\na[c++]=e.id;\na[c++]=\"' aria-label='\";\na[c++]=e.label;\na[c++]=\"' value='\";\na[c++]=e.value;\na[c++]=\"'>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#DateField\"},false);\nAjxTemplate.register(\"calendar.Appointment#ScheduleView\",function(d,h,g,b){var f=Boolean(b);\ng=(typeof g==\"string\"?{id:g}:g)||{};\nb=b||[];\nvar e=b.length;\nb[e++]=\"<table role=\\\"presentation\\\" width=100% class='ZPropertySheet' cellspacing='6'><tr><td width=100%><!-- date/time section --><table role=\\\"presentation\\\">\";\nb[e++]=AjxTemplate.expand(\"calendar.Appointment#ApptTimeSection\",g);\nb[e++]=\"</table></td><td style='text-align:right'><!-- key/legend section --><table role=\\\"presentation\\\" class='ZmGraphKey'><tr><td class='ZmGraphKeyHeader'>\";\nb[e++]=ZmMsg.key;\nb[e++]=\"</td></tr><tr><td class='ZmGraphKeyBody'><table role=\\\"presentation\\\"><tr><td><div class='ZmGraphKeyColorBox ZmScheduler-free'></div></td><td class='ZmGraphKeyColorText'>\";\nb[e++]=ZmMsg.free;\nb[e++]=\"</td><td>&nbsp;</td><td><div class='ZmGraphKeyColorBox ZmScheduler-busy'></div></td><td class='ZmGraphKeyColorText'>\";\nb[e++]=ZmMsg.busy;\nb[e++]=\"</td><td>&nbsp;</td><td><div class='ZmGraphKeyColorBox ZmScheduler-tentative'></div></td><td class='ZmGraphKeyColorText'>\";\nb[e++]=ZmMsg.tentative;\nb[e++]=\"</td><td>&nbsp;</td></tr><tr><td><div class='ZmGraphKeyColorBox ZmScheduler-unknown'></div></td><td class='ZmGraphKeyColorText'>\";\nb[e++]=ZmMsg.unknown;\nb[e++]=\"</td><td>&nbsp;</td><td><div class='ZmGraphKeyColorBox ZmScheduler-outOfOffice'></div></td><td class='ZmGraphKeyColorText'>\";\nb[e++]=ZmMsg.outOfOffice;\nb[e++]=\"</td><td>&nbsp;</td></tr></table></td></tr></table></td></tr></table><div style='margin-top:10'><!-- free/busy section --><table role=\\\"presentation\\\" style='padding-left:3px;' width=100% id='\";\nb[e++]=g.id;\nb[e++]=\"_attendeesTable'><colgroup><col style='width:165px' /><col style='width:626px' /></colgroup><tr><td align='center' id='\";\nb[e++]=g.id;\nb[e++]=\"_navToolbar' \";\nb[e++]=AjxEnv.isIE?\" width=100%\":\"\";\nb[e++]=\"></td><td><table role=\\\"presentation\\\" class='ZmSchedulerGridHeaderTable'><tr>\";\nfor(var c=0;\nc<=24;\nc++){var a=AjxDateUtil.isLocale24Hour()?c:((c%12)||12);\nb[e++]=\"<td><div class='ZmSchedulerGridHeaderCell'>\";\nb[e++]=a;\nb[e++]=\"</div></td>\"\n}b[e++]=\"</tr></table></td></tr></table></div>\";\nreturn f?b.length:b.join(\"\")\n},{id:\"calendar.Appointment#ScheduleView\"},false);\nAjxTemplate.register(\"calendar.Appointment#InlineScheduleView\",function(d,h,g,b){var f=Boolean(b);\ng=(typeof g==\"string\"?{id:g}:g)||{};\nb=b||[];\nvar e=b.length;\nb[e++]=\"<div class='ZmScheduler'><!-- free/busy section --><table role=\\\"presentation\\\" width=100% id='\";\nb[e++]=g.id;\nb[e++]=\"_attendeesTable'><colgroup><col style='width:250px' /><col style='width:710px' /></colgroup><tr><td align='center' id='\";\nb[e++]=g.id;\nb[e++]=\"_navToolbar'>&nbsp;</td><td valign=bottom><table role=\\\"presentation\\\" width=100% class='ZmSchedulerGridHeaderTable' style='\";\nb[e++]=AjxEnv.isIE?\"width:101%\":\"\";\nb[e++]=\"'><tr>\";\nfor(var c=0;\nc<=24;\nc++){var a=AjxDateUtil.isLocale24Hour()?c:((c%12)||12);\nb[e++]=\"<td width=2%><div class='ZmSchedulerGridHeaderCell'>\";\nb[e++]=a;\nb[e++]=\"</div></td>\"\n}b[e++]=\"</tr></table></td></tr></table><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td id='\";\nb[e++]=g.id;\nb[e++]=\"_graphKeySpacer'><span id='\";\nb[e++]=g.id;\nb[e++]=\"_showMoreLink' class=\\\"FakeAnchor\\\" style='display:none;'>\";\nb[e++]=ZmMsg.showMore;\nb[e++]=\"</span></td><td><div class='ZmGraphKeyColorBox ZmScheduler-working'></div></td><td class='ZmGraphKeyColorText' style='padding-right:1em;'>\";\nb[e++]=ZmMsg.free;\nb[e++]=\"</td><td><div class='ZmGraphKeyColorBox ZmScheduler-free'></div></td><td class='ZmGraphKeyColorText' style='padding-right:1em;'>\";\nb[e++]=ZmMsg.nonWorking;\nb[e++]=\"</td><td><div class='ZmGraphKeyColorBox ZmScheduler-busy'></div></td><td class='ZmGraphKeyColorText' style='padding-right:1em;'>\";\nb[e++]=ZmMsg.busy;\nb[e++]=\"</td><td><div class='ZmGraphKeyColorBox ZmScheduler-tentative'></div></td><td class='ZmGraphKeyColorText' style='padding-right:1em;'>\";\nb[e++]=ZmMsg.tentative;\nb[e++]=\"</td><td><div class='ZmGraphKeyColorBox ZmScheduler-unknown'></div></td><td class='ZmGraphKeyColorText' style='padding-right:1em;'>\";\nb[e++]=ZmMsg.unknown;\nb[e++]=\"</td><td><div class='ZmGraphKeyColorBox ZmScheduler-outOfOffice'></div></td><td class='ZmGraphKeyColorText' style='padding-right:1em;'>\";\nb[e++]=ZmMsg.outOfOffice;\nb[e++]=\"</td></tr></table></div>\";\nreturn f?b.length:b.join(\"\")\n},{id:\"calendar.Appointment#InlineScheduleView\"},false);\nAjxTemplate.register(\"calendar.Appointment#AttendeeName\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<table role=\"presentation\" width=100%><tr>';\nif(e.isAllAttendees){a[c++]=\"<td class='ZmSchedulerAllLabel'>\";\na[c++]=ZmMsg.allAttendees;\na[c++]=\"</td>\"\n}else{if(e.organizer||!e.isComposeMode){a[c++]=\"<td width=45 align=left class='\";\na[c++]=e.isComposeMode?\"ZmSchedulerOrgIconTd\":\"ZmSchedulerViewAttendeeTd\";\na[c++]=\"' style='padding-left: 7px;'>\";\na[c++]=AjxImg.getImageHtml(\"Person\");\na[c++]=\"</td>\"\n}else{a[c++]=\"<td width=50 id='\";\na[c++]=e.sched[\"dwtSelectId\"];\na[c++]=\"'></td>\"\n}}if(!e.isAllAttendees){a[c++]=\"<td \";\nif(!e.organizer){a[c++]=\"class='ZmSchedulerNameTd'\"\n}else{a[c++]=\" class='ZmSchedulerInputDisabledTd' \"\n}a[c++]=\" id='\";\na[c++]=e.sched[\"dwtNameId\"];\na[c++]=\"'>\";\nif(e.organizer){a[c++]=\"<div class='ZmSchedulerInputDisabled'>\";\na[c++]=e.organizer;\na[c++]=\"</div>\"\n}a[c++]=\"</td><td width=28 id='\";\na[c++]=e.sched[\"dwtNameId\"];\na[c++]=\"_ptst' align='center' class='ZmSchedulerPTSTTd'>&nbsp;</td>\"\n}a[c++]=\"</tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#AttendeeName\"},false);\nAjxTemplate.register(\"calendar.Appointment#AttendeeFreeBusy\",function(b,d,h,g){var e=Boolean(g);\nh=(typeof h==\"string\"?{id:h}:h)||{};\ng=g||[];\nvar f=g.length;\ng[f++]='<table role=\"presentation\" id=\\'';\ng[f++]=h.sched[\"dwtTableId\"];\ng[f++]=\"' class='ZmSchedulerGridTable\";\ng[f++]=h.isAllAttendees?\"-allAttendees\":\"\";\ng[f++]=\"' \";\ng[f++]=AjxEnv.isIE?\"width=99%\":\"width=100%\";\ng[f++]=\"><tr>\";\nvar a=\"ZmSchedulerGridDiv\",i;\nfor(var c=0;\nc<h.cellCount;\nc++){i=a;\nif(c==h.dateBorder.start){i=a+\"-start\"\n}else{if(c==h.dateBorder.end){i=a+\"-end\"\n}else{if(c%2==0){i=a+\"-halfHour\"\n}}}if((c==0)&&(h.dateBorder.start==-1)){i+=\" \"+a+\"-leftStart\"\n}g[f++]=\"<td class='ZmScheduler-free' width=2%><div id='\";\ng[f++]=h.sched[\"dwtTableId\"];\ng[f++]=\"_\";\ng[f++]=c;\ng[f++]=\"' class='\";\ng[f++]=i;\ng[f++]=\"'></div></td>\"\n}g[f++]=\"</tr></table>\";\nreturn e?g.length:g.join(\"\")\n},{id:\"calendar.Appointment#AttendeeFreeBusy\"},false);\nAjxTemplate.register(\"calendar.Appointment#Tooltip\",function(b,g,f,a){var e=Boolean(a);\nf=(typeof f==\"string\"?{id:f}:f)||{};\na=a||[];\nvar d=a.length;\na[d++]='<table role=\"presentation\" style=\\'width:';\na[d++]=f.width;\na[d++]=\"px'><tr valign='center'><td colspan='2' align='left'><div style='border-bottom:1px solid black;'><table role=\\\"presentation\\\" style='width:100%;'><tr><td>\";\nif(f.cal&&f.cal.link){a[d++]=AjxImg.getImageHtml(\"GroupSchedule\")\n}else{a[d++]=AjxImg.getImageHtml(\"Appointment\")\n}a[d++]=\"</td><td style='font-weight:bold;white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(f.appt.getName());\na[d++]=\"</td>\";\nif(f.appt.isException){a[d++]=\"<td>\";\na[d++]=AjxImg.getImageHtml(\"ApptExceptionIndicator\");\na[d++]=\"</td>\"\n}else{if(f.appt.isRecurring()){a[d++]=\"<td>\";\na[d++]=AjxImg.getImageHtml(\"ApptRecurIndicator\");\na[d++]=\"</td>\"\n}}a[d++]=\"<td style='width:100%'></td>\";\nif(f.appt.otherAttendees){a[d++]=\"<td style='text-align:right;'>\";\na[d++]=AjxImg.getImageHtml(\"ApptMeetingIndicator\");\na[d++]=\"</td>\"\n}a[d++]=\"</tr></table></div></td></tr>\";\nif(f.cal&&f.cal.getName()){a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><b><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.calendarLabel);\na[d++]=\"</div></b></td><td align='left'><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(f.cal.getName());\na[d++]=\"</div></td></tr>\"\n}if(f.organizer){a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><b><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.organizerLabel);\na[d++]=\"</div></b></td><td align='left'><div style='white-space:nowrap;'>\";\na[d++]=AjxStringUtil.htmlEncode(f.organizer);\na[d++]=\"</div></td></tr>\"\n}if(f.sentBy){a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><b><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.sentBy);\na[d++]=\"</div></b></td><td align='left'><div style='white-space:nowrap;'>\";\na[d++]=AjxStringUtil.htmlEncode(f.sentBy);\na[d++]=\"</div></td></tr>\"\n}if(!f.appt.isDraft&&f.appt.otherAttendees){a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><b><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.myStatusLabel);\na[d++]=\"</div></b></td><td align='left'><div style='white-space:nowrap;'>\";\na[d++]=AjxStringUtil.htmlEncode(f.appt.getParticipantStatusStr());\na[d++]=\"</div></td></tr>\"\n}if(f.when&&f.when!=\"\"){a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><b><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.whenLabel);\na[d++]=\"</div></b></td><td align='left'><div style='white-space:nowrap;'>\";\na[d++]=AjxStringUtil.htmlEncode(f.when);\na[d++]=\"</div></td></tr>\"\n}if(f.location&&f.location!=\"\"){a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><b><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.locationLabel);\na[d++]=\"</div></b></td><td align='left'><div style='white-space:nowrap;'>\";\na[d++]=AjxStringUtil.htmlEncode(f.location);\na[d++]=\"</div></td></tr>\"\n}a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><div style='font-weight:bold;white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.displayLabel);\na[d++]=\"</div></td><td align='left' nowrap><span style=\\\"float:left\\\">\";\na[d++]=AjxImg.getImageHtml(\"showAs\"+f.appt.freeBusy);\na[d++]='</span><span style=\"float:left\">&nbsp;';\na[d++]=AjxStringUtil.htmlEncode(ZmApptViewHelper.getShowAsOptionLabel(f.appt.freeBusy));\na[d++]=\"</span></td></tr>\";\nif(f.appt.fragment&&f.appt.fragment!=\"\"){a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><b><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.notesLabel);\na[d++]=\"</div></b></td><td align='left'>\";\na[d++]=AjxStringUtil.htmlEncode(f.appt.fragment);\na[d++]=\"</td></tr>\"\n}if(!f.appt.isDraft&&f.appt.isOrganizer()&&f.appt.otherAttendees&&!f.hideAttendees){a[d++]=\"<tr valign='center'><td colspan='2'><div class='calendar_tooltip_attendees'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.attendees);\na[d++]=\"</div></td></tr>\";\nif(f.attendeesText){a[d++]=\"<tr valign='top'><td colspan='2' align='left' style='padding-right:5px;'>\";\na[d++]=AjxStringUtil.htmlEncode(f.attendeesText);\na[d++]=\"</td></tr>\"\n}else{var h=f.ptstStatus;\nfor(var c in h){if(!h[c].attendees){continue\n}a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;' nowrap><b>\";\na[d++]=AjxMessageFormat.format(ZmMsg.makeLabel,AjxStringUtil.htmlEncode(c)+\"&nbsp;(&nbsp;\"+h[c].count+\"&nbsp;)&nbsp;\");\na[d++]=\"</b></td><td nowrap>\";\na[d++]=AjxStringUtil.htmlEncode(h[c].attendees);\na[d++]=\"</td></tr>\"\n}}}if(appCtxt.accountList.size()>1){a[d++]=\"<tr valign='top'><td align='right' style='padding-right:5px;'><b><div style='white-space:nowrap'>\";\na[d++]=AjxStringUtil.htmlEncode(ZmMsg.accountLabel);\na[d++]=\"</div></b></td><td align='left'>\";\na[d++]=AjxStringUtil.htmlEncode(f.appt.getFolder().account.getDisplayName());\na[d++]=\"</td></tr>\"\n}a[d++]=\"</table>\";\nreturn e?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#Tooltip\"},false);\nAjxTemplate.register(\"calendar.Appointment#ReadOnlyView\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div class='ApptHeaderDiv'>\";\nif(!e.isTask){a[c++]=\"<div class='InvResponseBar'><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td id='\";\na[c++]=e.id;\na[c++]=\"_responseActionSelectCell' width='1%'></td><td id='\";\na[c++]=e.id;\na[c++]=\"_responseActionMsgCell'></td></tr></table></div>\"\n}a[c++]=\"<div class='MsgHeader'><table role=\\\"presentation\\\" id='\";\na[c++]=e.id;\na[c++]=\"_hdrTable' class='ZPropertySheet' cellspacing='6'><tr><td class='SubjectCol' colspan='2'>\";\na[c++]=e.subject;\na[c++]=\"</td></tr>\";\nif(e.location){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.location,val:e.location})\n}if(e.equipment){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.resources,val:e.equipment})\n}if(e.dateStr){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.date,val:e.dateStr})\n}if(e.startDate){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.startDate,val:e.startDate})\n}if(e.dueDate){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.dueDate,val:e.dueDate})\n}if(e.priority){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.priority,val:e.priority})\n}if(e.status){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.status,val:e.status})\n}if(e.pComplete){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.percentComplete,val:e.pComplete})\n}a[c++]=\"<!-- exception warning -->\";\nif(e.isException){a[c++]=\"<tr valign='center'><td colspan='2'><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td>\";\na[c++]=AjxImg.getImageHtml(\"ApptException\");\na[c++]=\"</td><td><strong>\";\na[c++]=ZmMsg.apptExceptionNote;\na[c++]=\"</strong></td></tr></table></td></tr>\"\n}if(e.isAttendees&&e.org){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.organizer,val:e.org})\n}if(e.isAttendees&&e.obo){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.onBehalfOf,val:e.obo})\n}if(e.reqAttendees){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.attendees,val:e.reqAttendees})\n}if(e.optAttendees){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.optionalAttendees,val:e.optAttendees})\n}if(e.recurStr){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.repeats,val:e.recurStr})\n}if(e.attachStr){a[c++]=AjxTemplate.expand(\"calendar.Appointment#AddEntry\",{lbl:ZmMsg.attachments,val:e.attachStr})\n}a[c++]=\"</table></div></div><div id='\";\na[c++]=e._infoBarId;\na[c++]=\"'></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ReadOnlyView\"},false);\nAjxTemplate.register(\"calendar.Appointment#AddEntry\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<tr><td class='LabelColName' width='1%'>\";\na[c++]=AjxMessageFormat.format(ZmMsg.makeLabel,AjxStringUtil.htmlEncode(e.lbl));\na[c++]=\" </td><td class='LabelColValue'>\";\na[c++]=e.val;\na[c++]=\"</td></tr>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#AddEntry\"},false);\nAjxTemplate.register(\"calendar.Appointment#ApptDetailsDialog\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr valign='center'><td class='LabelColName'>\";\na[c++]=ZmMsg.icsLabel;\na[c++]=\"</td><td class='LabelColValue'><a href=\\\"\";\na[c++]=e.icsUrl;\na[c++]='\" target=\"_blank\">';\na[c++]=e.icsUrl;\na[c++]=\"</a></td></tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ApptDetailsDialog\"},false);\nAjxTemplate.register(\"calendar.Appointment#ApptTimeInput\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<table role=\\\"presentation\\\" class='miniTimeButton ZmSelector'><tr><td id='\";\na[c++]=e.id;\na[c++]=\"_timeSelectInput'></td><td id='\";\na[c++]=e.id;\na[c++]=\"_timeSelectBtn'> </td></tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ApptTimeInput\"},false);\nAjxTemplate.register(\"calendar.Appointment#TimeSuggestion\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<table role=\"presentation\" id=\\'';\na[c++]=e.id;\na[c++]='\\' width=\"100%\" class=\"Row ZPropertySheet\" cellspacing=\"6\"><tr><td width=\"16\" >';\na[c++]=AjxImg.getImageHtml(e.attendeeImage);\na[c++]=\"</td><td>\";\na[c++]=e.timeLabel;\na[c++]=\"</td>\";\nif(e.totalLocations>0){a[c++]='<td align=\"right\" width=\"20\" id=\\'';\na[c++]=e.id;\na[c++]='_loc\\'><span class=\"FakeAnchor\">';\na[c++]=e.locationCountStr;\na[c++]='</span></td><td width=\"16\">';\na[c++]=AjxImg.getImageHtml(e.locationImage);\na[c++]=\"</td>\"\n}a[c++]=\"</tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#TimeSuggestion\"},false);\nAjxTemplate.register(\"calendar.Appointment#LocationSuggestion\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]='\\' class=\"ZmLocationSuggestion\">';\na[c++]=AjxStringUtil.htmlEncode(e.locationName);\nif(e.locationDescription){a[c++]=\"<br>\";\na[c++]=AjxStringUtil.htmlEncode(e.locationDescription)\n}a[c++]=\"</div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#LocationSuggestion\"},false);\nAjxTemplate.register(\"calendar.Appointment#ResolveLocationConflictHeader\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<div class=\"ZmResolveLocationConflictHeader\"><div class=\"ZmResolveLocationConflictName\">';\na[c++]=ZmMsg.date;\na[c++]='</div><div class=\"ZmResolveLocationConflictAlternate\">';\na[c++]=ZmMsg.location;\na[c++]=\"</div></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ResolveLocationConflictHeader\"},false);\nAjxTemplate.register(\"calendar.Appointment#ResolveLocationConflict\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]=\"' class=\\\"ZmResolveLocationConflict \";\na[c++]=e.className;\na[c++]='\"><div class=\"ZmResolveLocationConflictName\">';\na[c++]=e.date;\na[c++]='</div><div class=\"ZmResolveLocationConflictAlternate\" id=\\'';\na[c++]=e.id;\na[c++]=\"_alternatives'></div></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ResolveLocationConflict\"},false);\nAjxTemplate.register(\"calendar.Appointment#TimeSuggestion-NoAttendees\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div class='NoResults' id='\";\na[c++]=e.id;\na[c++]=\"'>\";\na[c++]=ZmMsg.noAttendees;\na[c++]=\"</div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#TimeSuggestion-NoAttendees\"},false);\nAjxTemplate.register(\"calendar.Appointment#TimeSuggestion-NoSuggestions\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div class='NoSuggestions'><div style='margin-bottom:2em;'>\";\na[c++]=e.message;\na[c++]='</div><span class=\"FakeAnchor\" id=\"';\na[c++]=e.id;\na[c++]='_showall\">';\na[c++]=ZmMsg.showTimesAnyway;\na[c++]=\"</span></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#TimeSuggestion-NoSuggestions\"},false);\nAjxTemplate.register(\"calendar.Appointment#TimeSuggestion-ShowSuggestions\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div class='NoSuggestions'>\\n\";\na[c++]=\"\\t\\t\";\na[c++]=e.message;\na[c++]=\"\\n\";\na[c++]=\"\\t</div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#TimeSuggestion-ShowSuggestions\"},false);\nAjxTemplate.register(\"calendar.Appointment#TimeSuggestion-Loading\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div class='SuggestionMessage'><div class='DwtWait32Icon'></div><div style='margin-top:1em;'>\";\na[c++]=ZmMsg.searching;\na[c++]=\"</div></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#TimeSuggestion-Loading\"},false);\nAjxTemplate.register(\"calendar.Appointment#LocationSuggestion-Warning\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<div class=\"ZmLocationSuggestionWarning\"><div class=\"ZmLocationSuggestionWarningImage\">';\na[c++]=AjxImg.getImageHtml(\"Warning_12\");\na[c++]='</div><div class=\"ZmLocationSuggestionWarningText\">';\na[c++]=ZmMsg.locationSuggestionWarning;\na[c++]=\"</div></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#LocationSuggestion-Warning\"},false);\nAjxTemplate.register(\"calendar.Appointment#AlternateLocation-Loading\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div class='SuggestionMessage'><div class='DwtWait32Icon'></div><div style='margin-top:1em;'>\";\na[c++]=ZmMsg.loadingAlternateLocations;\na[c++]=\"</div></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#AlternateLocation-Loading\"},false);\nAjxTemplate.register(\"calendar.Appointment#TimeLocationPreference\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<table role=\"presentation\" id=\"';\na[c++]=e.id;\na[c++]='_timepref\" class=\"ZPropertySheet\" cellspacing=\"6\" style=\\'margin-bottom:1em;\\'><tbody><tr><td class=\"SuggestionPrefTitle\" colspan=\"3\">';\na[c++]=ZmMsg.timePreferences;\na[c++]='</td></tr><tr><td class=\"ZmFieldLabelRight\">';\na[c++]=ZmMsg.suggestionTimes;\na[c++]=':</td><td align=\"right\"><input type=\"checkbox\" id=\"';\na[c++]=e.id;\na[c++]='_my_working_hrs_pref\"></td><td width=\"100%\"><label for=\"';\na[c++]=e.id;\na[c++]='_my_working_hrs_pref\">';\na[c++]=ZmMsg.schedulerPrefMyWorkingHours;\na[c++]='</label></td></tr><tr><td>&nbsp;</td><td align=\"right\"><input type=\"checkbox\" id=\"';\na[c++]=e.id;\na[c++]='_others_working_hrs_pref\"></td><td width=\"100%\"><label for=\"';\na[c++]=e.id;\na[c++]='_others_working_hrs_pref\">';\na[c++]=ZmMsg.schedulerPrefOtherWorkingHours;\na[c++]='</label></td></tr><tr><td class=\"ZmFieldLabelRight\">';\na[c++]=ZmMsg.recurrence;\na[c++]=':</td><td align=\"right\" id=\\'';\na[c++]=e.id;\na[c++]='_recurrence\\'></td><td width=\"100%\">';\na[c++]=ZmMsg.calculateAvailability;\na[c++]=\"</td></tr></tbody></table>\";\nif(appCtxt.get(ZmSetting.GAL_ENABLED)){a[c++]='<table role=\"presentation\" id=\"';\na[c++]=e.id;\na[c++]='_locationpref\" class=\"ZPropertySheet\" cellspacing=\"6\"><tbody><tr><td class=\"SuggestionPrefTitle\" colspan=\"5\">';\na[c++]=ZmMsg.locationPreferences;\na[c++]=\"</td></tr><tr><td class='ZmFieldLabelRight'>\";\na[c++]=ZmMsg._name;\na[c++]=':</td><td><input type=\"text\" id=\"';\na[c++]=e.id;\na[c++]='_name\" nowrap=\"\" size=\"30\" autocomplete=\"off\"></td><td class=\\'ZmFieldLabelRight\\' style=\\'padding-left:2em;\\'>';\na[c++]=ZmMsg.site;\na[c++]=':</td><td><input type=\"text\" id=\"';\na[c++]=e.id;\na[c++]='_site\" nowrap=\"\" size=\"30\" autocomplete=\"off\"></td></tr><tr><td class=\\'ZmFieldLabelRight\\'>';\na[c++]=ZmMsg.minimumCapacity;\na[c++]=':</td><td><input type=\"text\" id=\"';\na[c++]=e.id;\na[c++]='_capacity\" nowrap=\"\" size=\"30\" autocomplete=\"off\"></td><td class=\\'ZmFieldLabelRight\\' style=\\'padding-left:2em;\\'>';\na[c++]=ZmMsg.building;\na[c++]=':</td><td><input type=\"text\" id=\"';\na[c++]=e.id;\na[c++]='_building\" nowrap=\"\" size=\"30\" autocomplete=\"off\"></td></tr><tr><td class=\\'ZmFieldLabelRight\\'>';\na[c++]=ZmMsg.description;\na[c++]=':</td><td><input type=\"text\" id=\"';\na[c++]=e.id;\na[c++]='_desc\" nowrap=\"\" size=\"30\" autocomplete=\"off\"></td><td class=\\'ZmFieldLabelRight\\' style=\\'padding-left:2em;\\'>';\na[c++]=ZmMsg.floor;\na[c++]=':</td><td><input type=\"text\" id=\"';\na[c++]=e.id;\na[c++]='_floor\" nowrap=\"\" size=\"30\" autocomplete=\"off\"></td></tr></tbody></table>'\n}return d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#TimeLocationPreference\"},false);\nAjxTemplate.register(\"calendar.Appointment#SuggestionTooltip\",function(b,g,f,a){var e=Boolean(a);\nf=(typeof f==\"string\"?{id:f}:f)||{};\na=a||[];\nvar d=a.length;\na[d++]=\"<span='font-weight:bold;'>\";\na[d++]=ZmMsg.busy;\na[d++]=\"</span>\";\nfor(var c=0;\nc<f.attendees.length;\nc++){a[d++]='<br><span class=\"suggestion_tooltip_attendee\">';\na[d++]=AjxStringUtil.htmlEncode(f.attendees[c]);\na[d++]=\"</span>\"\n}return e?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#SuggestionTooltip\"},false);\nAjxTemplate.register(\"calendar.Appointment#LocationSuggestionTooltip\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div class='ZmLocationSuggestionTooltip'><div class='ZmLocationTooltipTitle'>\";\na[c++]=AjxStringUtil.htmlEncode(e.name);\na[c++]=\"</div>\";\nif(e.description!=\"\"){a[c++]=AjxStringUtil.htmlEncode(e.description);\na[c++]=\"<br>\"\n}if(e.contactMail!=\"\"){a[c++]=ZmMsg.contact+\": \"+AjxStringUtil.htmlEncode(e.contactMail);\na[c++]=\"<br>\"\n}if(e.capacity!=\"\"){a[c++]=ZmMsg.capacity+\": \"+AjxStringUtil.htmlEncode(e.capacity);\na[c++]=\"<br>\"\n}a[c++]=\"</div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#LocationSuggestionTooltip\"},false);\nAjxTemplate.register(\"calendar.Appointment#ChangesDialogAttendee\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<table role=\\\"presentation\\\" width='300'><tr><td>\";\na[c++]=ZmMsg.apptSignificantChangesAttendee;\na[c++]=\"</td></tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#ChangesDialogAttendee\"},false)\n}if(AjxPackage.define(\"calendar.Calendar\")){AjxTemplate.register(\"calendar.Calendar#calendar_appt\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]=\"_body' class='appt_body \";\na[c++]=e.bodyColor;\na[c++]=\" \";\na[c++]=e.boxBorder;\na[c++]=\"'><table role=\\\"presentation\\\" id='\";\na[c++]=e.id;\na[c++]=\"_tableBody' style=\\\"width:100%; height:100%;\";\na[c++]=e.bodyStyle;\na[c++]='\">';\nif(e.headerStyle){a[c++]='<tr style=\"';\na[c++]=e.headerStyle;\na[c++]='\">'\n}else{a[c++]=\"<tr class='\";\na[c++]=e.headerColor;\na[c++]=\"'>\"\n}a[c++]='<td style=\"';\na[c++]=e.showAsColor;\na[c++]='\" width=4 rowspan=\"';\na[c++]=e.hideTime?2:3;\na[c++]=\"\\\"></td><td class='appt\";\na[c++]=e.newState;\na[c++]=\"_time'><table role=\\\"presentation\\\" style='background: none repeat scroll 0 0 transparent;border:0;border-collapse:collapse;border-spacing:0;width:100%'><tr><td id='\";\na[c++]=e.id;\na[c++]=\"_st' style='padding-right:3px;white-space:nowrap;'>\";\na[c++]=e.starttime;\na[c++]=\"</td>\";\nif(e.icon){a[c++]=\"<td style='padding-right:3px;'>\";\na[c++]=AjxImg.getImageHtml(e.icon,\"width:16\");\na[c++]=\"</td>\"\n}if(e.isException){a[c++]=\"<td style='padding-right:3px;'>\";\na[c++]=AjxImg.getImageHtml(\"ApptExceptionIndicator\");\na[c++]=\"</td>\"\n}else{if(e.isRecurring){a[c++]=\"<td style='padding-right:3px;'>\";\na[c++]=AjxImg.getImageHtml(\"ApptRecurIndicator\");\na[c++]=\"</td>\"\n}}a[c++]=\"<td style='width:100%'></td>\";\nif(e.otherAttendees){a[c++]=\"<td style='padding-right:3px;'>\";\na[c++]=AjxImg.getImageHtml(\"ApptMeetingIndicator\");\nif(e.isDraft){a[c++]='<div style=\"position:absolute;top:5px;\">';\na[c++]=AjxImg.getImageHtml(\"Edit\",\"width:16\");\na[c++]=\"</div>\"\n}a[c++]=\"</td>\"\n}a[c++]=AjxTemplate.expand(\"#calendar_tag_icon\",e);\na[c++]=\"</tr></table></td></tr><tr valign=top><td class=appt\";\na[c++]=e.newState;\na[c++]=\"_name style='height:100%'>\\n\";\na[c++]=\"\\t\\t\\t\\t\\t\";\na[c++]=e.name;\na[c++]=\"\\n\";\na[c++]=\"\\t\\t\\t\\t\\t\";\nif(e.location){a[c++]=\"\\n\";\na[c++]=\"\\t\\t\\t\\t\\t\\t\";\na[c++]=e.location;\na[c++]=\"\\n\";\na[c++]=\"\\t\\t\\t\\t\\t\"\n}a[c++]=\"</td></tr>\";\nif(!e.hideTime){a[c++]=\"<tr><td class=appt_end_time id='\";\na[c++]=e.id;\na[c++]=\"_et'>\";\na[c++]=e.endtime;\na[c++]=\"</td></tr>\"\n}a[c++]=\"</table></div>\";\nreturn d?a.length:a.join(\"\")\n},{width:\"10\",id:\"calendar.Calendar#calendar_appt\",height:\"7\"},false);\nAjxTemplate.register(\"calendar.Calendar\",AjxTemplate.getTemplate(\"calendar.Calendar#calendar_appt\"),AjxTemplate.getParams(\"calendar.Calendar#calendar_appt\"));\nAjxTemplate.register(\"calendar.Calendar#calendar_tag_icon\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\nif(e.tagIcon){a[c++]=\"<td id='\";\na[c++]=e.id;\na[c++]=\"_tag' width=20px style='padding-right:3px;'>\";\na[c++]=AjxImg.getImageHtml(e.tagIcon,\"width:16\");\na[c++]=\"</td>\"\n}if(e.peelIcon){a[c++]=\"<td id='\";\na[c++]=e.id;\na[c++]='_peel\\' width=12 valign=\"top\">';\na[c++]=AjxImg.getImageHtml(\"PeelSpacer\",\"width:12\");\na[c++]=\"<div style='position:absolute;z-index:1;top:\";\na[c++]=e.peelTop;\na[c++]=\"px;right:\";\na[c++]=e.peelRight;\na[c++]=\"px;'>\";\na[c++]=AjxImg.getImageHtml(e.peelIcon,\"width:12\");\na[c++]=\"</div></td>\"\n}return d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#calendar_tag_icon\"},false);\nAjxTemplate.register(\"calendar.Calendar#calendar_appt_bottom_only\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]=\"_body' class='appt_body \";\na[c++]=e.bodyColor;\na[c++]=\" \";\na[c++]=e.boxBorder;\na[c++]=\"'><table role=\\\"presentation\\\" id='\";\na[c++]=e.id;\na[c++]=\"_tableBody' style=\\\"width:100%;height:100%;\";\na[c++]=e.bodyStyle;\na[c++]=\"\\\"><tr valign=top><td width='4px' style='\";\na[c++]=e.showAsColor;\na[c++]=\"' ></td><td class=appt\";\na[c++]=e.newState;\na[c++]=\"_name style='height:100%'>\\n\";\na[c++]=\"\\t\\t\\t\\t\\t\";\na[c++]=e.name;\na[c++]=\"\\n\";\na[c++]=\"\\t\\t\\t\\t\\t\";\nif(e.location){a[c++]=\"\\n\";\na[c++]=\"\\t\\t\\t\\t\\t\\t\";\na[c++]=e.location;\na[c++]=\"\\n\";\na[c++]=\"\\t\\t\\t\\t\\t\"\n}a[c++]=\"</td></tr><tr><td colspan=2 class=appt_end_time id='\";\na[c++]=e.id;\na[c++]=\"_et'>\";\na[c++]=e.endtime;\na[c++]=\"</td></tr></table></div>\";\nreturn d?a.length:a.join(\"\")\n},{width:\"10\",id:\"calendar.Calendar#calendar_appt_bottom_only\",height:\"7\"},false);\nAjxTemplate.register(\"calendar.Calendar#calendar_appt_30\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]=\"_body' class='appt_30_body  \";\na[c++]=e.headerColor;\na[c++]=\" \";\na[c++]=e.boxBorder;\na[c++]=\"'><table role=\\\"presentation\\\" id='\";\na[c++]=e.id;\na[c++]=\"_tableBody' width=100% style=\\\"width:100%;height:100%;\";\na[c++]=e.headerStyle;\na[c++]='\">';\nif(e.headerStyle){a[c++]='<tr style=\"';\na[c++]=e.headerStyle;\na[c++]='\">'\n}else{a[c++]=\"<tr class='\";\na[c++]=e.headerColor;\na[c++]=\"'>\"\n}a[c++]=\"<td width='4px' style=\\\"\";\na[c++]=e.showAsColor;\na[c++]='\" ></td><td class=appt_30';\na[c++]=e.newState;\na[c++]='_name style=\"white-space:nowrap;\">';\na[c++]=e.name;\na[c++]=\"</td>\";\nif(e.icon){a[c++]=\"<td valign=top width=16>\";\na[c++]=AjxImg.getImageHtml(e.icon,\"width:16\");\na[c++]=\"</td>\"\n}if(e.tagIcon){a[c++]=\"<td valign=top width=16  style='padding-right:3px;'>\";\na[c++]=AjxImg.getImageHtml(e.tagIcon,\"width:16\");\na[c++]=\"</td>\"\n}if(e.peelIcon){a[c++]=\"<td width=12>\";\na[c++]=AjxImg.getImageHtml(\"PeelSpacer\",\"width:12\");\na[c++]=\"</td><div style='position:absolute;top:1;right:1;'>\";\na[c++]=AjxImg.getImageHtml(e.peelIcon,\"width:12\");\na[c++]=\"</div>\"\n}a[c++]=\"</tr></table></div>\";\nreturn d?a.length:a.join(\"\")\n},{width:\"4\",id:\"calendar.Calendar#calendar_appt_30\",height:\"4\"},false);\nAjxTemplate.register(\"calendar.Calendar#calendar_appt_allday\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]=\"_body' class='appt_allday_body \";\na[c++]=e.headerColor;\na[c++]=\" \";\na[c++]=e.boxBorder;\na[c++]=\"'><table role=\\\"presentation\\\" id='\";\na[c++]=e.id;\na[c++]=\"_tableBody' style=\\\"table-layout:fixed;height:100%;\";\na[c++]=e.headerStyle;\na[c++]=e.borderLeft;\na[c++]=e.borderRight;\na[c++]='\">';\nif(e.headerStyle){a[c++]='<tr style=\"';\na[c++]=e.headerStyle;\na[c++]='\">'\n}else{a[c++]=\"<tr class='\";\na[c++]=e.headerColor;\na[c++]=\"'>\"\n}a[c++]=\"<td class='\";\na[c++]=e.showAsClass;\na[c++]=\"' style=\\\"min-width:4px; \";\na[c++]=e.showAsColor;\na[c++]='\" ></td><td width=100% class=appt_allday';\na[c++]=e.newState;\na[c++]='_name><div style=\"overflow: hidden; white-space: nowrap;\">';\na[c++]=e.name;\na[c++]=\"</div></td>\";\nif(e.icon){a[c++]=\"<td width=16px style='padding-right:3px;'><div class='appt_icon'>\";\na[c++]=AjxImg.getImageHtml(e.icon,\"width:16\");\na[c++]=\"</div></td>\"\n}a[c++]=AjxTemplate.expand(\"#calendar_tag_icon\",e);\na[c++]=\"</tr></table></div>\";\nreturn d?a.length:a.join(\"\")\n},{width:\"4\",id:\"calendar.Calendar#calendar_appt_allday\",height:\"4\"},false);\nAjxTemplate.register(\"calendar.Calendar#calendar_fb_appt\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]=\"_body' class='appt_allday_body'><div style=\\\"padding:3px;overflow:hidden;height:21px;\\\">\";\na[c++]=e.name;\na[c++]=\"</div></div>\";\nreturn d?a.length:a.join(\"\")\n},{width:\"4\",id:\"calendar.Calendar#calendar_fb_appt\",height:\"4\"},false);\nAjxTemplate.register(\"calendar.Calendar#month_appt\",function(b,d,h,g){var e=Boolean(g);\nh=(typeof h==\"string\"?{id:h}:h)||{};\ng=g||[];\nvar f=g.length;\nvar i=h.multiday&&!h.last;\nvar c=h.multiday&&!h.first;\nvar a=i?\"padding-right:14px;\":\"\";\ng[f++]=\"<div id='\";\ng[f++]=h.id;\ng[f++]=\"_body' style='position:relative;'><table role=\\\"presentation\\\" id='\";\ng[f++]=h.id;\ng[f++]=\"_tableBody' width=100% style=\\\"table-layout:fixed; \";\ng[f++]=h.headerStyle;\ng[f++]=\"\\\"><tr><td width='4px' style=\\\"\";\ng[f++]=h.showAsColor;\ng[f++]=\"\\\" ></td><td width=100%><div id='\";\ng[f++]=h.id;\ng[f++]=\"_st_su' style='overflow:hidden;white-space:nowrap; \";\ng[f++]=a;\ng[f++]=\"'>\";\nif(i){g[f++]=\"<div class='calendar_month_day_item_continues'>&raquo;</div>\"\n}if(c){g[f++]=\"\\n\";\ng[f++]=\"                        &laquo;&nbsp;\\n\";\ng[f++]=\"                    \"\n}else{g[f++]=\"<span id='\";\ng[f++]=h.id;\ng[f++]=\"_start_time' class='start_time'>\";\ng[f++]=h.duration;\ng[f++]=\"</span>\"\n}g[f++]=\"<span id='\";\ng[f++]=h.id;\ng[f++]=\"_subject' class='subject'>\";\ng[f++]=AjxStringUtil.htmlEncode(h.appt.getName());\ng[f++]=\"</span></div></td>\";\ng[f++]=AjxTemplate.expand(\"#calendar_tag_icon\",h);\ng[f++]=\"</tr></table></div>\";\nreturn e?g.length:g.join(\"\")\n},{id:\"calendar.Calendar#month_appt\"},false);\nAjxTemplate.register(\"calendar.Calendar#TypeDialog\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div style='width:274px' id='\";\na[c++]=e.id;\na[c++]=\"_question'></div><p><table role=\\\"presentation\\\" align=center width=1%><tr><td width=1%><input checked value='1' type='radio' id='\";\na[c++]=e.id;\na[c++]=\"_defaultRadio' name='\";\na[c++]=e.id;\na[c++]=\"_instSeriesName'></td><td style='white-space:nowrap'><label id='\";\na[c++]=e.id;\na[c++]=\"_instanceMsg' for='\";\na[c++]=e.id;\na[c++]=\"_defaultRadio'> </label></td></tr><tr><td width=1%><input value='2' type='radio' id='\";\na[c++]=e.id;\na[c++]=\"_openSeries' name='\";\na[c++]=e.id;\na[c++]=\"_instSeriesName'></td><td style='white-space:nowrap'><label id='\";\na[c++]=e.id;\na[c++]=\"_seriesMsg' for='\";\na[c++]=e.id;\na[c++]=\"_openSeries'> </label></td></tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#TypeDialog\"},false);\nAjxTemplate.register(\"calendar.Calendar#PrintDialog\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]=\"_printDialogContainer'><table role=\\\"presentation\\\" align=center width=600><tr><td width=30% valign=top><div id='\";\na[c++]=e.id;\na[c++]=\"_calTreeContainer' style=\\\"margin-right:5px;\\\"></div></td><td width=70% valign=top><div id='\";\na[c++]=e.id;\na[c++]=\"_printErrorMsgContainer'></div><div id='\";\na[c++]=e.id;\na[c++]=\"_printOptionsContainer'><table role=\\\"presentation\\\" class=\\\"ZPropertySheet\\\" cellspacing=\\\"6\\\"><tr><td width=25><input checked value='sel_date' type='radio' id='\";\na[c++]=e.id;\na[c++]=\"_selDateRadio' name='\";\na[c++]=e.id;\na[c++]=\"_selDateRange'></td><td width=80><label for='\";\na[c++]=e.id;\na[c++]=\"_selDateRadio'> \";\na[c++]=ZmMsg.calPrintSelDate;\na[c++]=\"</label></td><td id='\";\na[c++]=e.id;\na[c++]=\"_selDateContainer'></td><td>&nbsp;</td><td id='\";\na[c++]=e.id;\na[c++]=\"_todayButtonContainer'></td></tr><tr><td width=25><input value=\\\"date_range\\\" type='radio' id='\";\na[c++]=e.id;\na[c++]=\"_dateRangeRadio' name='\";\na[c++]=e.id;\na[c++]=\"_selDateRange'></td><td width=80><label for='\";\na[c++]=e.id;\na[c++]=\"_dateRangeRadio'>\";\na[c++]=ZmMsg.calPrintDateRange;\na[c++]=\"</label></td><td id='\";\na[c++]=e.id;\na[c++]=\"_dateRangeFromContainer'></td><td>&nbsp; \";\na[c++]=ZmMsg.calPrintTo;\na[c++]=\" &nbsp;</td><td id='\";\na[c++]=e.id;\na[c++]='_dateRangeToContainer\\'></td></tr></table><div class=\"horizSep\"></div><table role=\"presentation\" class=\"ZPropertySheet\" cellspacing=\"6\" width=100%><tr style=\\'display:block;\\'><td align=right width=111>';\na[c++]=ZmMsg.calPrintView;\na[c++]=\"</td><td colspan=4><div id='\";\na[c++]=e.id;\na[c++]=\"_printViewContainer'></div></td></tr><tr id='\";\na[c++]=e.id;\na[c++]=\"_hoursContainer' style='display:block;'><td align=right width=111>\";\na[c++]=ZmMsg.calPrintHours;\na[c++]=\"</td><td id='\";\na[c++]=e.id;\na[c++]=\"_fromHoursContainer'></td><td>&nbsp; \";\na[c++]=ZmMsg.calPrintTo;\na[c++]=\" &nbsp;</td><td id='\";\na[c++]=e.id;\na[c++]=\"_toHoursContainer'></td><td></td></tr><tr style='display:block;'><td align=right valign=top width=111>\";\na[c++]=ZmMsg.calPrintOptions;\na[c++]='</td><td colspan=4><table role=\"presentation\" class=\"ZCheckboxTable\" width=100%><tr id=\\'';\na[c++]=e.id;\na[c++]=\"_workDaysOnlyContainer'><td><input value=\\\"1\\\" type='checkbox' id='\";\na[c++]=e.id;\na[c++]=\"_workDaysOnly' name='\";\na[c++]=e.id;\na[c++]=\"_workDaysOnly'></td><td><label for='\";\na[c++]=e.id;\na[c++]=\"_workDaysOnly'>\";\na[c++]=ZmMsg.calPrintWorkDaysOnly;\na[c++]=\"</label></td></tr><tr id='\";\na[c++]=e.id;\na[c++]=\"_oneWeekPerPageContainer'><td><input value=\\\"1\\\" type='checkbox' id='\";\na[c++]=e.id;\na[c++]=\"_oneWeekPerPage' name='\";\na[c++]=e.id;\na[c++]=\"_oneWeekPerPage'></td><td><label for='\";\na[c++]=e.id;\na[c++]=\"_oneWeekPerPage'>\";\na[c++]=ZmMsg.calPrintOneWeekPerPage;\na[c++]=\"</label></td></tr><tr id='\";\na[c++]=e.id;\na[c++]=\"_oneDayPerPageContainer'><td><input value=\\\"1\\\" type='checkbox' id='\";\na[c++]=e.id;\na[c++]=\"_oneDayPerPage' name='\";\na[c++]=e.id;\na[c++]=\"_oneDayPerPage'></td><td><label for='\";\na[c++]=e.id;\na[c++]=\"_oneDayPerPage'>\";\na[c++]=ZmMsg.calPrintOneDayPerPage;\na[c++]=\"</label></td></tr><tr id='\";\na[c++]=e.id;\na[c++]=\"_includeMiniCalContainer'><td><input value=\\\"1\\\" type='checkbox' id='\";\na[c++]=e.id;\na[c++]=\"_includeMiniCal' name='\";\na[c++]=e.id;\na[c++]=\"_includeMiniCal'></td><td><label for='\";\na[c++]=e.id;\na[c++]=\"_includeMiniCal'>\";\na[c++]=ZmMsg.calPrintIncludeMiniCal;\na[c++]=\"</label></td></tr></table></td></tr></table></div></td></tr></table><div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#PrintDialog\"},false);\nAjxTemplate.register(\"calendar.Calendar#SharedCalendarDialog\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div id='\";\na[c++]=e.id;\na[c++]='_shareCalendarView1\\'><table role=\"presentation\" width=300><tr><td valign=top align=right>';\na[c++]=ZmMsg.sourceLabel;\na[c++]='</td><td><table role=\"presentation\" class=\"ZRadioButtonTable\" width=100%><tr><td width=\"5\"><input type=\"radio\" name=\"extCalType\" id=\"';\na[c++]=e.id;\na[c++]='_shareRadioGoogle\"></td><td align=left><label for=\"';\na[c++]=e.id;\na[c++]='_shareRadioGoogle\">';\na[c++]=ZmMsg.sharedCalTitleGoogle;\na[c++]='</label></td></tr><tr><td width=\"5\"><input type=\"radio\" name=\"extCalType\" id=\"';\na[c++]=e.id;\na[c++]='_shareRadioYahoo\"></td><td align=left><label for=\"';\na[c++]=e.id;\na[c++]='_shareRadioYahoo\">';\na[c++]=ZmMsg.sharedCalTitleYahoo;\na[c++]='</label></td></tr><tr><td width=\"5\"><input type=\"radio\" name=\"extCalType\" id=\"';\na[c++]=e.id;\na[c++]='_shareRadioOther\"></td><td align=left><label for=\"';\na[c++]=e.id;\na[c++]='_shareRadioOther\">';\na[c++]=ZmMsg.sharedCalTitleOther;\na[c++]=\"</label></td></tr></table></td></tr></table></div><div id='\";\na[c++]=e.id;\na[c++]='_shareCalendarView2\\'><table role=\"presentation\" width=300><tr><td>&nbsp;</td><td><table role=\"presentation\" class=\"ZPropertySheet\" cellspacing=\"6\" width=100%><tr><td align=right width=80>';\na[c++]=ZmMsg.sharedCalTypeLabel;\na[c++]='</td><td id=\"';\na[c++]=e.id;\na[c++]='_syncType\"></td></tr><tr id=\"';\na[c++]=e.id;\na[c++]='_syncUserNameContainer\"><td align=right width=80>';\na[c++]=ZmMsg.sharedCalUserNameLabel;\na[c++]='</td><td id=\"';\na[c++]=e.id;\na[c++]='_syncUserName\"></td></tr><tr id=\"';\na[c++]=e.id;\na[c++]='_syncPasswordContainer\"><td align=right width=80>';\na[c++]=ZmMsg.sharedCalPasswordLabel;\na[c++]='</td><td id=\"';\na[c++]=e.id;\na[c++]='_syncPassword\"></td></tr><tr id=\"';\na[c++]=e.id;\na[c++]='_syncUrlContainer\"><td align=right width=80>';\na[c++]=ZmMsg.sharedCalCalDAVServerLabel;\na[c++]='</td><td id=\"';\na[c++]=e.id;\na[c++]='_syncUrl\"></td></tr><tr id=\"';\na[c++]=e.id;\na[c++]='_syncIcsUrlContainer\"><td align=right width=80>';\na[c++]=ZmMsg.sharedCalIcsUrlLabel;\na[c++]='</td><td id=\"';\na[c++]=e.id;\na[c++]='_syncIcsUrl\"></td></tr><tr id=\"';\na[c++]=e.id;\na[c++]='_syncMsgContainer\" style=\"display:none;\"><td colspan=2 id=\"';\na[c++]=e.id;\na[c++]=\"_syncMsg\\\"></td></tr></table></td></tr></table></div><div id='\";\na[c++]=e.id;\na[c++]=\"_shareCalendarView3'></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#SharedCalendarDialog\"},false);\nAjxTemplate.register(\"calendar.Calendar#ApptDragProxy\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<div class='\";\na[c++]=e.color;\na[c++]='\\'><table role=\"presentation\"><tr><td rowspan=2>';\na[c++]=AjxImg.getImageHtml(\"Appointment\");\na[c++]=\"</td><td><b>\";\na[c++]=e.shortDate;\na[c++]=\"</b> \";\na[c++]=e.dur;\na[c++]=\"</td></tr><tr><td><b>\";\na[c++]=e.apptName;\na[c++]=\"</b></td></tr></table></div>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#ApptDragProxy\"},false);\nAjxTemplate.register(\"calendar.Calendar#ListViewFolder\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<table role=\"presentation\"><tr><td width=16 id=\"';\na[c++]=e.id;\na[c++]='_image\">';\na[c++]=AjxImg.getImageHtml(e.folder.getIconWithColor());\na[c++]='</td><td width=100% id=\"';\na[c++]=e.id;\na[c++]='_name\">';\na[c++]=e.folderName;\na[c++]=\"</td></tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#ListViewFolder\"},false);\nAjxTemplate.register(\"calendar.Calendar#ListViewSearchBar\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<table role=\"presentation\" width=100%><tr><td id=\"';\na[c++]=e.id;\na[c++]='_searchBarControls\"></td><td id=\"';\na[c++]=e.id;\na[c++]=\"_searchBarDate\\\" class='calendar_date_search-dateRange'></td></tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#ListViewSearchBar\"},false);\nAjxTemplate.register(\"calendar.Calendar#ListViewSearchBarInput\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<table role=\\\"presentation\\\" width=100%><tr><td class='calendar_date_search_td'><input autocomplete='off' style='height:22px;' type='text' size=14 id='\";\na[c++]=e.id;\na[c++]=\"DateInput' value='\";\na[c++]=e.value;\na[c++]=\"'></td><td class=\\\"miniCalendarButton\\\" id='\";\na[c++]=e.id;\na[c++]=\"MiniCal'></td></tr></table>\";\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#ListViewSearchBarInput\"},false);\nAjxTemplate.register(\"calendar.Calendar#ReminderDialogRow\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<tr id='\";\na[c++]=e.rowId;\na[c++]=\"'><td style=\\\"max-width:350px;\\\" valign=top><div id='\";\na[c++]=e.openLinkId;\na[c++]=\"' class='ZmApptOpenLink'></div><div id='\";\na[c++]=e.reminderDescContainerId;\na[c++]=\"'>\";\nif(e.durationText!=\"\"){a[c++]=\"\\n\";\na[c++]=\"\\t\\t\\t    \";\na[c++]=e.durationText;\na[c++]=\"<br>\"\n}if(e.organizer){a[c++]=ZmMsg.organizerLabel;\na[c++]=\" \";\na[c++]=e.organizer;\na[c++]=\"<br>\"\n}if(e.calName){if(e.type==ZmItem.APPT){a[c++]=ZmMsg.calendarLabel;\na[c++]=\" \";\na[c++]=e.calName;\na[c++]=\"<br>\"\n}else{if(e.type==ZmItem.TASK){a[c++]=ZmMsg.tasks;\na[c++]=\": \";\na[c++]=e.calName;\na[c++]=\"<br>\"\n}}}if(e.accountName){a[c++]=ZmMsg.accountLabel;\na[c++]=\" \";\na[c++]=e.accountName;\na[c++]=\"<br>\"\n}if(e.location){a[c++]=ZmMsg.locationLabel;\na[c++]=\" \";\na[c++]=e.location;\na[c++]=\"<br>\"\n}a[c++]='</div></td><td valign=top align=right><table role=\"presentation\" style=\"margin-left:15px;\"><tr id=\\'';\na[c++]=e.actionsRowId;\na[c++]=\"'><td valign=top align=right><table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6'><tr><td valign=top id='\";\na[c++]=e.snoozeSelectInputId;\na[c++]=\"' style=\\\"padding-right:0;\\\"></td><td valign=top id='\";\na[c++]=e.snoozeSelectBtnId;\na[c++]='\\' style=\"padding-left:0\" width=\"1%\"></td><td valign=top id=\\'';\na[c++]=e.snoozeBtnId;\na[c++]=\"'></td><td valign=top id='\";\na[c++]=e.dismissBtnId;\na[c++]=\"'></td></tr></table></td></tr><tr><td style='white-space:nowrap;' align='right' id='\";\na[c++]=e.deltaId;\na[c++]=\"'></td></tr></table></td></tr>\";\nif(!e.noSep){a[c++]='<tr name=\"rdsep\"><td colspan=3><div class=\"horizSep\"></div></td></tr>'\n}return d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#ReminderDialogRow\"},false);\nAjxTemplate.register(\"calendar.Calendar#ReminderDialogAllSection\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]=\"<table role=\\\"presentation\\\" class='ZPropertySheet' cellspacing='6' cellpadding=0 border=0 width=\\\"100%\\\"><tr><td width=100% valign=middle align=right><span id='\";\na[c++]=e.snoozeAllLabelId;\na[c++]=\"'></span></td><td valign=top id='\";\na[c++]=e.snoozeSelectInputId;\na[c++]=\"' style=\\\"padding-right:0\\\"></td><td valign=top id='\";\na[c++]=e.snoozeSelectBtnId;\na[c++]=\"' style=\\\"padding-left:0\\\"></td><td valign=top id='\";\na[c++]=e.snoozeBtnId;\na[c++]=\"' class=\\\"DwtDialogButtonBar\\\"></td><td valign=top id='\";\na[c++]=e.dismissBtnId;\na[c++]='\\' class=\"DwtDialogButtonBar\"></td></tr></table>';\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Calendar#ReminderDialogAllSection\"},false);\nAjxTemplate.register(\"calendar.Appointment#DnDProxy\",function(b,f,e,a){var d=Boolean(a);\ne=(typeof e==\"string\"?{id:e}:e)||{};\na=a||[];\nvar c=a.length;\na[c++]='<table role=\"presentation\" class=\"dnd_calendar_month_day_table\"><tr></tr></table>';\nreturn d?a.length:a.join(\"\")\n},{id:\"calendar.Appointment#DnDProxy\"},false)\n};\n"
                    },
                    "redirectURL": "",
                    "headersSize": 364,
                    "bodySize": 360042
                },
                "cache": {},
                "timings": {
                    "send": 0,
                    "wait": 0,
                    "receive": 0
                }
            }
        ],
        "_webSocketEntries": {},
        "_settings": {
            "_proxy": {}
        }
    }
}
